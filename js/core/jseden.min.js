function noop(){}function randomString(a){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");"number"!=typeof a&&(a=Math.floor(Math.random()*b.length_));for(var c="",d=0;d<a;d++)c+=b[Math.floor(Math.random()*b.length)];return c}function get_time_diff(a){var b=1e3*a,c=Date.now();if(b-=6e4*(new Date).getTimezoneOffset(),isNaN(b))return"";if(b<c)var d=c-b;else var d=b-c;var e=Math.floor(d/1e3/60/1440),f=new Date(d);if(e>5)return new Date(b).toDateString();var g="";if(e>0)g+=e,g+=e>1?" days ago":" day ago";else if(f.getUTCHours()>0){var h=f.getUTCHours();g+=h,g+=h>1?" hours ago":" hour ago"}else{var i=f.getUTCMinutes();if(i>0)g+=i,g+=i>1?" minutes ago":" minute ago";else{var j=f.getUTCSeconds();g+=j,g+=" seconds ago"}}return g}function generateTimeStamp(a){for(var b,c=/(\d*)(minutes|minute|min|hours|hour|days|day|weeks|week|months|month|mon|years|year|Quarters|Quarter|seconds|second|sec|s|m|h|d|M|y|Y|Q|ms|w)/g,d=0;null!==(b=c.exec(a));)switch(console.log("Reltime:",b),b[2]){case"second":case"seconds":case"s":d+=1e3*parseInt(b[1]);break;case"minute":case"minutes":case"m":d+=6e4*parseInt(b[1]);break;case"hour":case"hours":case"h":d+=36e5*parseInt(b[1]);break;case"days":case"d":d+=36e5*parseInt(b[1])*24}return d}function hashCode(a){var b=0;if(0==a.length)return b;for(i=0;i<a.length;i++)char=a.charCodeAt(i),b=(b<<5)-b+char,b&=b;return b}function getTextWidth(a,b){var c=getTextWidth.canvas||(getTextWidth.canvas=document.createElement("canvas")),d=c.getContext("2d");return d.font=b,d.measureText(a).width}function unListen(a){for(var b in this.listeners)for(var c=this.listeners[b],d=0;d<c.length;d++)if(c[d].target===a){c.splice(d,1);break}}function listenTo(a,b,c){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push({target:b,callback:c})}function emit(a,b){var c=this.listeners[a];if(c){var d;for(d=0;d<c.length;++d){var e=c[d].target;if(c[d].callback.apply(e,b))return!0}return!1}}function concatAndResolveUrl(a,b){for(var c=a.split("/"),d=b.split("/"),e=[],f=0,g=c.length;f<g;f++)if(".."==c[f])e.pop();else{if("."==c[f])continue;e.push(c[f])}for(var f=0,g=d.length;f<g;f++)if(".."==d[f])e.pop();else{if("."==d[f])continue;e.push(d[f])}return e.join("/")}function WindowHighlighter(a){this.edenUI=a,this.lastDialog=void 0,this.lastDialogMinimized=!1,this.lastDialogHidden=!1,this.previousZIndex=void 0}function ScopeCache(a,b,c,d){this.up_to_date=a,this.value=b,this.scope=c,this.scopes=void 0,this.override=d}function BoundValue(a,b){this.value=a,this.scope=b}function ScopeOverride(a,b,c,d,e){if(this.name=a,this.start=b,this.end=c,this.increment=d,this.current=e&&b?b[0]:b,this.isin=e,this.index=1,0==this.increment)throw new Error(Eden.RuntimeError.INFINITERANGE);if(this.isin&&void 0===this.end&&!(this.start instanceof Array))throw new Error(Eden.RuntimeError.NOLISTRANGE)}function Scope(a,b,c,d,e,f){this.parent=b,this.context=a,this.cache=void 0,this.overrides=c,this.cause=e,this.causecount=0,this.range=d,this.isolate=!1,f||this.rebuild(),console.trace("Scope Creation")}function ScopeList(){this.raw=[],this.caches=[]}function Symbol(a,b){this.context=a,this.name=b,this.cache=a?a.scope.add(b):new ScopeCache(!0,void 0,void 0,!1),this.definition=void 0,this.def_scope=void 0,this.fullexp=!1,this.extend=void 0,this.needsGlobalNotify=0,this.has_evaled=!1,this.dependencies={},this.subscribers={},this.dynamicDependencies={},this.dynamicDependencyTable=[],this.dynamicDependencyRefCount={},this.observers={},this.observees={},this.jsObservers={},this.origin=void 0,this.garbage=!1}function fireActions(a){for(var b in a){var c=a[b];c&&c.trigger()}}function fireJSActions(a){for(var b=0;b<a.length;b++)a[b].fireJSObservers()}function Pointer(a){this.value=a}function copy(a){var b,c;if(a instanceof Array){for(c=a.slice(),b=0;b<a.length;++b)c[b]=copy(c[b]);return c}return a}function Folder(a,b,c){this.type="script",this.executed=1,this.start=0,this.end=0,this.prefix="",this.postfix="",this.id="ACTIVE",this.name=a||"ACTIVE",this.base={origin:void 0},this.errors=[],this.lock=1,this.numlines=0,this.root=c||this,this.scope=new Scope(this,void 0,{}),this.symbols={},this.evalResults={},this.globalobservers=[],this.autocalc_state=!0,this.needsExpire=[],this.needsTrigger={},this.firetimer=void 0,this.needsGlobalNotify=[],this.globalNotifyIndex=0,this.expiryCount=new Pointer(0),this.potentialGarbage={},this.saved_autocalc_state=!0,this.saved_autocalc_level=0,this.currentObservables=[],Object.defineProperty(this,"statements",{enumerable:!0,get:function(){var a=this;return Object.keys(this.symbols).map(function(b){return a.symbols[b]})}}),Object.defineProperty(this,"parent",{enumerable:!0,get:function(){return eden.project.ast.script}})}function touchHandler(a){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");c.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[a.type],!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c),-1==a.target.className.indexOf("ui-dialog-titlebar")&&-1==a.target.className.indexOf("ui-resizable-handle")||a.preventDefault()}function Construit(options,callback){root=new Folder,eden=new Eden(root);var menuBar="false"!=URLUtil.getParameterByName("menus"),pluginsStr=URLUtil.getParameterByName("plugins"),exec=URLUtil.getParameterByName("exec"),load=URLUtil.getParameterByName("load"),lang=URLUtil.getParameterByName("lang"),restore=URLUtil.getParameterByName("restore"),vid=URLUtil.getParameterByName("vid"),readPassword=URLUtil.getParameterByName("r"),writePassword=URLUtil.getParameterByName("w"),master=URLUtil.getParameterByName("master"),myid=URLUtil.getParameterByName("id"),query=URLUtil.getParameterByName("q"),mode=URLUtil.getParameterByName("mode"),urlparams=URLUtil.getParameters();for(var x in urlparams)urlparams[x].length>1?eden.root.lookup("jseden_url_"+x).assign(urlparams[x],eden.root.scope,Symbol.localJSAgent):eden.root.lookup("jseden_url_"+x).assign(urlparams[x][0],eden.root.scope,Symbol.localJSAgent);""==lang&&(lang="en");var plugins,defaultPlugins=["Canvas2D","DependencyMap","HTMLContent","PluginManager","ScriptInput","SymbolLookUpTable","SymbolViewer","Debugger","VersionViewer"];if(""==pluginsStr)plugins=defaultPlugins;else{var includeDefaultPlugins=" "==pluginsStr[0];includeDefaultPlugins&&(pluginsStr=pluginsStr.slice(1)),plugins=pluginsStr.split(","),includeDefaultPlugins&&(plugins=plugins.concat(defaultPlugins)),""!=views&&"default"!=views||(plugins.push("Canvas2D"),plugins.push("ScriptInput"))}$(document).ready(function(){function invalidVersion(a){$(".loadmessage").html(a)}var browser=$.browser,bversion=browser.version.split(".");bversion=parseInt(bversion[0]),browser.msie?bversion<13&&invalidVersion("Microsoft Internet Explorer is not supported, use Edge, Firefox or Chrome."):browser.mozilla?bversion<29&&invalidVersion("Please upgrade your version of Firefox/Mozilla."):browser.webkit&&!browser.chrome?invalidVersion("Your browser is not supported by JS-Eden, please use Edge, Firefox or Chrome."):browser.chrome?bversion<39&&invalidVersion("Please upgrade your version of Chrome"):invalidVersion(browser.opera?"Opera is not supported, use Chrome or Firefox.":"Your browser is not supported by JS-Eden, use Firefox or Chrome."),edenUI=new EdenUI(eden),edenUI.scrollBarSize2=window.innerHeight-$(window).height(),Eden.Project.init(),eden.ismobile=mobilecheck(),eden.root.lookup("jseden_mobile").assign(eden.ismobile,eden.root.scope,Symbol.defaultAgent),$.ajax({url:"version.json",dataType:"json",success:function(a){a.tag&&(document.title=document.title+" "+a.tag);var b=a.tag.slice(1).split("."),c=b[2].split("-");eden.root.lookup("jseden_version_major").assign(parseInt(b[0]),eden.root.scope,Symbol.defaultAgent),eden.root.lookup("jseden_version_minor").assign(parseInt(b[1]),eden.root.scope,Symbol.defaultAgent),eden.root.lookup("jseden_version_patch").assign(parseInt(c[0]),eden.root.scope,Symbol.defaultAgent),eden.root.lookup("jseden_version_commit").assign(parseInt(c[1]),eden.root.scope,Symbol.defaultAgent),eden.root.lookup("jseden_version_name").assign(a.tag,eden.root.scope,Symbol.defaultAgent),eden.root.lookup("jseden_version_sha").assign(a.sha,eden.root.scope,Symbol.defaultAgent)},cache:!1}),$(document).on("keydown",null,"ctrl+m",function(){edenUI.cycleNextView()}).on("keyup",null,"ctrl",function(){edenUI.stopViewCycling()}).on("keydown",null,"backspace",function(a){var b=a.target,c=b.tagName.toUpperCase();"INPUT"==c||"TEXTAREA"==c||b.isContentEditable||a.preventDefault()}),"false"!=edenUI.getOptionValue("optConfirmUnload")&&window.addEventListener("beforeunload",confirmUnload);var loadLanguage=function(lang,callback){$.getScript("js/language/"+lang+".js",function(data){Language.language=lang,eval(data),menuBar&&(edenUI.menu=new EdenUI.MenuBar),options&&options.noload||(edenUI.feedback=new EdenUI.Feedback,edenUI.explorer=new EdenUI.Explorer),callback()})},loadPlugins=function(a,b){var c=function(){if(a.length>0){var d=a.shift();edenUI.loadPlugin(d,c)}else b()};c()};doneLoading=function(a){window.scrollTo(0,0),edenUI.finishedLoading(),exec&&(";"!=exec.slice(-1)&&(exec+=";"),eden.execute2(exec)),""==myid&&""==master||(eden.peer=new Eden.Peer(""!=master?master:void 0,""!=myid?myid:void 0)),callback&&callback(a)},loadLanguage(lang,function(){options&&options.noload?Eden.DB.connect(Eden.DB.repositories[Eden.DB.repoindex],function(){console.log("DONE LOADING"),doneLoading(!0)}):loadPlugins(plugins,function(){$.getJSON("config.json",function(a){rt.config=a,Eden.DB.connect(Eden.DB.repositories[Eden.DB.repoindex],function(){""!=load?(null!==mode&&""!=mode&&eden.root.lookup("jseden_project_mode").assign(mode,eden.root.scope,Symbol.defaultAgent),Eden.Project.load(parseInt(load),null===vid||""==vid?void 0:parseInt(vid),null===readPassword||""==readPassword?void 0:readPassword,function(){doneLoading(!0)})):""!=restore?(null!==mode&&""!=mode&&eden.root.lookup("jseden_project_mode").assign(mode,eden.root.scope,Symbol.defaultAgent),Eden.project.restore(),doneLoading(!0)):doneLoading(!1)}),Eden.DB.repoindex=(Eden.DB.repoindex+1)%Eden.DB.repositories.length})})})})}function EdenSyntaxData(){this.value=void 0,this.error=!1,this.line=0}function EdenStream(a){this.code=a,this.position=0,this.position_stack=[0],this.prevposition=0,this.line=1,this.prevline=1,this.data=new EdenSyntaxData}function edenTokenTest(a){for(var b=new EdenStream(a),c=[],d={};b.valid();)c.push(b.readToken(d));return c}function sortByCount(a){var b=a.reduce(function(a,b){return a[b]=(a[b]||0)+1,a},{});return Object.keys(b).sort(function(a,c){return b[a]<b[c]})}function reduceByCount(a,b){var c=a.reduce(function(a,b){return a[b]=(a[b]||0)+1,a},{}),d=[];for(var e in c)c[e]>=b&&d.push(e);return d}function negativeFilter(a,b){for(var c=b.reduce(function(a,b){return a[b]=(a[b]||0)+1,a},{}),d=[],e=0;e<a.length;e++)c[a[e]]||d.push(a[e]);return d}function sortByLoaded(a){for(var b=[],c=[],d=0;d<a.length;d++)Eden.Agent.agents[a[d]]?b.push(a[d]):c.push(a[d]);return b.push.apply(b,c),b}function runEdenAction(a,b,c){function d(d){if(d&&d.length>0){var g=f.value.params,h=f.value.nscope;if(h.range){h.range=!1;for(var i=[];;){var j=h.clone();if(i.push(new Eden.AST.ScopedScript(d,j)),0==h.next())break}h.range=!0,e.executeStatements(i,void 0,a,function(){runEdenAction.call(e,a,b,c)},{parameters:g},h)}else e.executeStatements(d,void 0,a,function(){runEdenAction.call(e,a,b,c)},{parameters:g},h)}else{var k=new Eden.RuntimeWarning(f.value,Eden.RuntimeWarning.EMPTYDO,f.value.selector);k.line=f.value.line,f.value.warning=k,eden.emit("warning",[a,k]),runEdenAction.call(e,a,b,c)}}var e=this;void 0===b&&(a.active=!1);var f=b.next();if(0==f.done)if("object"==typeof f.value){if(Eden.AST.debug&&"debug"==f.value.type){var g=function(){runEdenAction.call(e,a,b,c)};f.value.next=g,f.value.statement&&Eden.AST.debugbreakpoint===f.value.statement?Eden.AST.debugbreakpoint_cb&&Eden.AST.debugbreakpoint_cb(f.value):Eden.AST.debugstep_cb&&setTimeout(function(){Eden.AST.debugstep_cb(f.value)},0)}else if("import"==f.value.type)f.value.executed=1,Eden.Selectors.query(f.value.selector,void 0,{context:f.value.parent,minimum:1,options:{external:!0,index:!0}},function(d){if(void 0===d){var g=new Eden.RuntimeError(e,Eden.RuntimeError.UNKNOWN,f.value,"Selector '"+f.value.selector+"' has no results");g.line=f.value.line,f.value.errors.push(g)}else f.value.statements=d;runEdenAction.call(e,a,b,c)});else if("do"==f.value.type){var h;f.value.name?Eden.Selectors.query(f.value.selector,void 0,{context:f.value.parent,minimum:1},d):(h=f.value.script.statements,d(h))}}else 0==f.value?runEdenAction.call(this,a,b,c):f.value>0&&setTimeout(function(){runEdenAction.call(e,a,b,c)},f.value);else a.active=!1,c&&c()}mobilecheck=function(){if(void 0!==Eden.mobile)return Eden.mobile;var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),Eden.mobile=a,a},Utils={flatten:function(a){for(var b=[],c=0,d=a.length;c<d;++c)b=b.concat(a[c]instanceof Array?this.flatten(a[c]):a[c]);return b},construct:function(){var a=function(){};return function(b){a.prototype=b.prototype;for(var c=new a,d=[],e=1;e<arguments.length;e++)d.push(arguments[e]);return b.apply(c,d),c}}()},DiffUtil={},DiffUtil.diff=function(a,b){var c=new diff_match_patch,d=c.diff_main(a,b);c.diff_cleanupSemantic(d),console.log(d);for(var e={remove:{},insert:{}},f=0,g=0,h=0,i=0,j=0;j<d.length;j++){var k=d[j][1].match(/\n/g);if(0!=d[j][0]){if(1==d[j][0]){lines=d[j][1].split("\n");for(var l=0;l<lines.length&&(l!=lines.length-1||0!=lines[l].length);l++)void 0===e.insert[g+l]&&(e.insert[g+l]={oline:f,chars:[]}),e.insert[g+l].chars.push({start:h,length:lines[l].length}),l>0&&(e.insert[g+l].consecutive=!0),e.insert[g+l].partial=null===k,h+=lines[l].length,l<lines.length-1&&h++;null!==k&&(g+=k.length)}else if(-1==d[j][0]){lines=d[j][1].split("\n");for(var l=0;l<lines.length&&(l!=lines.length-1||0!=lines[l].length);l++)void 0===e.remove[f+l]&&(e.remove[f+l]={nline:g,chars:[]}),e.remove[f+l].chars.push({start:i,length:lines[l].length}),e.remove[f+l].partial=null===k,l>0&&(e.remove[f+l].consecutive=!0),i+=lines[l].length,l<lines.length-1&&i++;null!==k&&(f+=k.length)}}else null!==k&&(f+=k.length,g+=k.length),i+=d[j][1].length,h+=d[j][1].length}for(var m=a.split("\n"),n=b.split("\n"),o=[0],j=0;j<m.length-1;j++)o.push(m[j].length+o[j]+1);for(var p=[0],j=0;j<n.length-1;j++)p.push(n[j].length+p[j]+1);for(var q in e.insert)if(e.insert[q].chars.length>0){for(var j=0;j<e.insert[q].chars.length;j++)e.insert[q].chars[j].start-=p[q];e.insert[q].iline=n[q]}for(var q in e.remove)if(e.remove[q].chars.length>0){for(var j=0;j<e.remove[q].chars.length;j++)e.remove[q].chars[j].start-=o[q];e.remove[q].rline=m[q]}return console.log(e),e};var Language={language:"en",loadSymbols:function(a){for(var b in this.symbols)b!=this.symbols[b]&&void 0===a.symbols[this.symbols[b]]&&(a.symbols[this.symbols[b]]=a.lookup(b))},addKeywords:function(a){for(var b in a)this.keywords[b]=a[b]},addSymbols:function(a){for(var b in a)this.symbols[b]=a[b]},importoptions:{readonly:"readonly",remote:"remote",local:"local",rebase:"rebase",noexec:"noexec",reload:"reload",force:"force",async:"async",create:"create",remove:"remove"},selectors:{"has-name":!0,name:!0,type:!0,definition:!0,assignment:!0,script:!0,when:!0,for:!0,if:!0,last:!0,nth:!0,executed:!0,not:!0,unexecuted:!0,remote:!0,value:!0,active:!0,depends:!0},doxytags:{title:"title",author:"author",version:"version",param:"param",return:"return",debug:"debug",local:"local",role:"role",shared:"shared",oracle:"oracle",handle:"handle",deprecated:"deprecated",see:"see","{":"{","}":"}",hidden:"hidden",script:"script"},keywords:{func:"func",function:"function",oracle:"oracle",handle:"handle",proc:"proc",auto:"auto",para:"para",action:"action",procedure:"procedure",local:"local",if:"if",is:"is",in:"in",else:"else",for:"for",while:"while",do:"do",switch:"switch",case:"case",default:"default",break:"break",continue:"continue",return:"return",when:"when",wait:"wait",import:"import",insert:"insert",append:"append",delete:"delete",require:"require",after:"after",shift:"shift",with:"with",and:"and",or:"or",not:"not"},symbols:{int:"int",str:"str",round:"round",min:"min",max:"max",random:"random",floor:"floor",ceil:"ceil",abs:"abs",acos:"acos",asin:"asin",atan:"atan",cos:"cos",exp:"exp",ln:"ln",log:"log",mod:"mod",randomInteger:"randomInteger",randomFloat:"randomFloat",sin:"sin",sqrt:"sqrt",sum:"sum",tan:"tan",length:"length",error:"error",substr:"substr",type:"type",createView:"createView",createCanvas:"createCanvas",zonesAt:"zonesAt",execute:"execute",indexOf:"indexOf",forget:"forget",eager:"eager",time:"time",writeln:"writeln",apply:"apply",todo:"todo",char:"char",isBoolean:"isBoolean",isCallable:"isCallable",isChar:"isChar",isDefined:"isDefined",isValue:"isValue",isFunc:"isFunc",isInt:"isInt",isNaN:"isNaN",isNumber:"isNumber",isObject:"isObject",isPoint:"isPoint",isProc:"isProc",showView:"showView",array:"array",sublist:"sublist",reverse:"reverse",search:"search",sort:"sort",tail:"tail",concat:"concat",decodeHTML:"decodeHTML"},values:{true:"true",false:"false"},errors:{}};"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.Language=Language),Point=function(a,b){this.x=a,this.y=b},Point.prototype.toString=function(a){return"Point("+Eden.edenCodeForValue(this.x,void 0,a)+", "+Eden.edenCodeForValue(this.y,void 0,a)+")"},Point.prototype.getEdenCode=Point.prototype.toString,Point3D=function(a,b,c){this.x=a,this.y=b,this.z=c},Point3D.prototype.toString=function(a){return"Point3D::("+Eden.edenCodeForValue(this.x,void 0,a)+", "+Eden.edenCodeForValue(this.y,void 0,a)+")"},Point3D.prototype.getEdenCode=Point.prototype.toString,Point3D.normal=function(a,b,c){var d=vec3.create();vec3.set(d,a[0],a[1],a[2]);var e=vec3.create();vec3.set(e,b[0],b[1],b[2]);var f=vec3.create();vec3.set(f,c[0],c[1],c[2]);var g=vec3.create();return vec3.subtract(e,d,e),vec3.subtract(f,d,f),vec3.cross(g,e,f),new Point3D(g[0],g[1],g[2])};var rt={index:function(a){return"number"==typeof a?a-1:a},length:function(a){if(null!==a&&void 0!==a)return a instanceof BoundValue?a.value.length:a.length},equal:function(a,b){var c;if(a===b)return!0;if(a instanceof Array&&b instanceof Array){if(a.length!==b.length)return!1;for(c=0;c<a.length;++c)if(!rt.equal(a[c],b[c]))return!1;return!0}return!1},add:function(a,b){return void 0===a||void 0===b?void 0:a instanceof Point?new Point(a.x+b.x,a.y+b.y):a+b},subtract:function(a,b){return void 0===a||void 0===b?void 0:a instanceof Point?new Point(a.x-b.x,a.y-b.y):a-b},multiply:function(a,b){if(void 0!==a&&void 0!==b)return a*b},divide:function(a,b){if(void 0!==a&&void 0!==b)return a/b},mod:function(a,b){if(void 0!==a&&void 0!==b)return a%b},pow:function(a,b){if(void 0!==a&&void 0!==b)return Math.pow(a,b)},concat:function(a,b){if(void 0!==a&&void 0!==b){if(Array.isArray(a)){if(Array.isArray(b))return a.concat(b);throw new Error(Eden.RuntimeError.LEFTCONCAT)}if(Array.isArray(b))throw new Error(Eden.RuntimeError.RIGHTCONCAT);return String(a)+b}},regExpMatch:function(a,b){return void 0===a||void 0===b?void 0:b instanceof RegExp?b.test(a):new RegExp(b).test(a)},regExpNotMatch:function(a,b){return void 0===a||void 0===b?void 0:b instanceof RegExp?!b.test(a):!new RegExp(b).test(a)}};this.rt=rt,"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.rt=rt),WindowHighlighter.prototype.highlight=function(a){this.lastDialog=edenUI.getDialogWindow(a);var b=edenUI.getDialogContent(a);if(b.dialog("isOpen")){var c=b.data("dialog-extend-minimize-controls");c?(this.previousZIndex=c.css("z-index"),b.dialogExtend("restore"),this.lastDialog.removeClass("window-activated"),this.lastDialogMinimized=!0):(this.previousZIndex=this.lastDialog.css("z-index"),this.lastDialog.css("z-index",2147483646),this.lastDialogMinimized=!1),this.lastDialogHidden=!1}else this.previousZIndex=void 0,edenUI.showView(a),edenUI.moveView(a),this.lastDialogHidden=!0;this.lastDialogLeft=this.lastDialog[0].offsetLeft,this.lastDialogWidth=this.lastDialog[0].offsetWidth,this.lastDialogTop=this.lastDialog[0].offsetTop,this.lastDialogHeight=this.lastDialog[0].offsetHeight;var d=window.pageXOffset,e=window.pageYOffset;(this.lastDialogLeft>=d+window.innerWidth||this.lastDialogLeft+this.lastDialogWidth<d||this.lastDialogTop>=e+window.innerHeight||this.lastDialogTop+this.lastDialogHeight<e)&&b.parent().offset({left:d+(window.innerWidth-this.lastDialogWidth)/2,top:e+(window.innerHeight-this.lastDialogHeight)/2}),this.lastDialog.addClass("menubar-window-raise"),this.lastDialog.css("z-index",2147483646)},WindowHighlighter.prototype.stopHighlight=function(a,b){if(this.lastDialog){this.lastDialog.removeClass("menubar-window-raise");var c=edenUI.getDialogContent(a);if(c.parent().offset({left:this.lastDialogLeft,top:this.lastDialogTop+edenUI.menuBarHeight}),b){var d=window.pageXOffset,e=window.pageYOffset,f=!1;this.lastDialogLeft+this.lastDialogWidth>d+window.innerWidth?(d=this.lastDialogLeft+this.lastDialogWidth-window.innerWidth,f=!0):this.lastDialogLeft<d&&(d=this.lastDialogLeft,f=!0),this.lastDialogTop+this.lastDialogHeight>e+window.innerHeight-edenUI.menuBarHeight?(e=this.lastDialogTop+this.lastDialogHeight-window.innerHeight-edenUI.menuBarHeight+edenUI.scrollBarSize2+edenUI.bottomBarHeight,f=!0):this.lastDialogTop<e&&(e=this.lastDialogTop-edenUI.menuBarHeight,f=!0),f&&window.scrollTo(d,e)}else this.lastDialogHidden?edenUI.hideView(a):this.lastDialogMinimized&&c.dialogExtend("minimize");void 0!==this.previousZIndex&&this.lastDialog.css("z-index",this.previousZIndex),this.lastDialog=void 0,this.lastDialogMinimized=!1,this.lastDialogHidden=!1,this.previousZIndex=void 0}},WindowHighlighter.prototype.unpin=function(a){a===this.lastDialog&&(this.previousZIndex=void 0)},Scope.prototype.hasCause=function(a){for(var b=this,c=a;b;){if(b.cause.name==c)return!0;b=b.parent}return!1},Scope.prototype.baseCause=function(){for(var a=this;a.parent&&a.parent.parent;)a=a.parent;return a.cause.name},Scope.prototype.allCauses=function(){for(var a=[],b=this;b;)b.cause&&a.push(b.cause),b=b.parent;return a},Scope.prototype.allOverrides=function(){},Scope.prototype.hasOverride=function(a){for(var b=this;b;){for(var c=0;c<b.overrides.length;c++)if(b.overrides[c].name==a)return!0;b=b.parent}return!1},Scope.prototype.primaryCause=function(){return this.cause&&"null"==this.cause.name&&this.parent&&this.parent.cause?this.parent.cause.name:"null"},Scope.prototype.isRange=function(){return this.range},Scope.prototype.clear=function(){this!==eden.root&&(this.cache=void 0)},Scope.prototype.resetCache=function(){for(var a in this.cache)this.cache[a].up_to_date=this.cache[a].override},Scope.prototype.rebuild=function(){if(void 0===this.cache){this.cache={},this.add("cause"),this.add("has"),this.add("from");for(var a=0;a<this.overrides.length;a++)this.addOverride(this.overrides[a])}},Scope.prototype.refresh=function(){for(var a=0;a<this.overrides.length;a++)this.updateOverride(this.overrides[a])},Scope.prototype.cloneAt=function(a){for(var b=[],c=0;c<this.overrides.length;c++)b.push(new ScopeOverride(this.overrides[c].name,this.overrides[c].start,this.overrides[c].end));for(var d=new Scope(this.context,this.parent,b,this.range,this.cause),c=0;c<a;c++)d.next();return d.range=!1,d},Scope.prototype.clone=function(){return this},Scope.prototype.lookup=function(a){var b=this.cache[a];if(b)return b;if(this.parent){return this.parent.lookup(a)}return this.cache[a]=new ScopeCache(!0,void 0,void 0,!1),this.cache[a]},Scope.prototype.value=function(a){var b=this.cache[a];return void 0!==b?b.up_to_date?b.value:this.context.lookup(a).value(this):this.parent?this.parent.value(a):void 0},Scope.prototype.assign=function(a,b,c){this.isolate?void 0===this.cache[a]?this.cache[a]=new ScopeCache(!0,b,this,!0):(this.cache[a].up_to_date=!0,this.cache[a].override=!0,this.cache[a].value=b,this.cache[a].scope=this):this.context.lookup(a).assign(b,this,c)},Scope.prototype.mutate=function(a,b,c){this.context.lookup(a).mutate(this,b,c)},Scope.prototype.listAssign=function(a,b,c,d,e){this.context.lookup(a).listAssign(b,this,c,!1,e)},Scope.prototype.define=function(a,b,c,d){this.context.lookup(a).define(b,c,d)},Scope.prototype.boundValue=function(a){return this.context.lookup(a).boundValue(this)},Scope.prototype.scope=function(a){var b=this.cache[a];return b&&b.up_to_date?b.scope:this.context.lookup(a).boundValue(this).scope},Scope.prototype.lookup2=function(a){if(0==this.isolate)return this.lookup(a);var b=this.cache[a];return void 0===b&&(b=new ScopeCache(!0,void 0,void 0,!1),this.cache[a]=b),b},Scope.prototype.add=function(a){var b=new ScopeCache(!1,void 0,this,!1);return this.cache[a]=b,b},Scope.prototype.addOverride=function(a){if(!this.updateOverride(a)&&this.context){var b=this.context.lookup(a.name);for(var c in b.subscribers)this.updateSubscriber(c)}},Scope.prototype.updateOverride=function(a){var b,c,d=a.name;return a.current instanceof BoundValue?(b=a.current.value,c=a.current.scope):(b=a.current,c=this),void 0===this.cache[d]?(this.cache[d]=new ScopeCache(!0,b,c,!0),!1):(this.cache[d].value=b,this.cache[d].scope=c,this.cache[d].up_to_date=!0,this.cache[d].override=!0,!0)},Scope.prototype.updateSubscriber=function(a){if(void 0===this.cache[a]){this.cache[a]=new ScopeCache(!1,void 0,this);var b=this.context.lookup(a);for(var c in b.subscribers)this.updateSubscriber(c)}else this.cache[a].up_to_date=!1,this.cache[a].value=void 0,this.cache[a].scope=this},Scope.prototype.first=function(){for(var a=this.overrides.length-1;a>=0;a--){var b=this.overrides[a];if(void 0!==b.end){if(b.isin){var c=isbound?b.start.value.length:b.start?b.start.length:0;return b.index<c}if(b.current<=b.end)return!0}}return!1},Scope.prototype.mergeCache=function(a){this.range;this.cache={};for(var b in a)this.cache[b]=new ScopeCache(!1,void 0,this)},Scope.prototype.reset=function(){this.refresh()},Scope.prototype.next=function(){for(var a in this.cache)this.cache[a].up_to_date=this.cache[a].override;for(var b=this.overrides.length-1;b>=0;b--){var c=this.overrides[b];if(void 0!==c.end||c.isin){var d=c.start instanceof BoundValue,e=d?c.start.value.length:c.start?c.start.length:0;if(c.isin){if(c.index<e)return c.current=d?c.start.value[c.index]:c.start[c.index],c.index++,this.refresh(),!0;c.index=1,c.current=d?c.start.value[0]:c.start[0]}else{if(c.current<c.end)return c.increment?c.current+=c.increment:c.current++,this.refresh(),!0;c.current=c.start}}}return!1},Object.defineProperty(Symbol.prototype,"type",{get:function(){return this.origin&&this.origin.type?this.origin.type:"assignment"}}),Object.defineProperty(Symbol.prototype,"lvalue",{get:function(){return this.origin?this.origin.lvalue:void 0}}),Object.defineProperty(Symbol.prototype,"expression",{get:function(){return this.origin?this.origin.expression:void 0}}),Object.defineProperty(Symbol.prototype,"doxyComment",{get:function(){return this.origin?this.origin.doxyComment:void 0}}),Object.defineProperty(Symbol.prototype,"parent",{get:function(){return eden.root}}),Object.defineProperty(Symbol.prototype,"stamp",{get:function(){return this.origin?this.origin.stamp:void 0}}),Object.defineProperty(Symbol.prototype,"id",{get:function(){return this.origin&&this.origin.id?this.origin.id:this.name}}),Object.defineProperty(Symbol.prototype,"executed",{get:function(){return 1}}),Symbol.prototype.getStartLine=function(a){return this.origin?this.origin.getStartLine(a):-1},Symbol.prototype.getASTOrigin=function(){if(this.origin){for(var a=this.origin;a.parent;)a=a.parent;if(a.base)return a.base.origin}},Symbol.prototype.getOrigin=function(){if(this.origin)return this.origin.getOrigin()},InternalAgent=function(a,b){this.name=a,this.local=b,this.internal=!0},InternalAgent.prototype.getOrigin=function(){return"*Default"!=this.name?eden.project:void 0},InternalAgent.prototype.numlines=0,Symbol.hciAgent=new InternalAgent("*Input Device",!0),Symbol.jsAgent=new InternalAgent("*JavaScript",!1),Symbol.localJSAgent=new InternalAgent("*JavaScript",!0),Symbol.netAgent=new InternalAgent("*net",!0),Symbol.defaultAgent=new InternalAgent("*Default",!0),Symbol.NONOTIFY=0,Symbol.CREATED=1,Symbol.EXPIRED=2,Symbol.REDEFINED=3,Symbol.ASSIGNED=4,Symbol.prototype.boundValue=function(a,b){var c=this.value(a),d=a.lookup(this.name);return b?new BoundValue(c[b[0]],d.scopes[b[0]]):new BoundValue(c,d.scope)},Symbol.prototype.value=function(a){if(a&&a.isRange())return this.multiValue(a);var b=a;this.garbage=!1,void 0===b&&(b=this.context.scope);var c=void 0===this.context||b===this.context.scope?this.cache:b.lookup(this.name);return this.definition&&(c.up_to_date||this.evaluate(b,c)),c.value},Symbol.prototype.multiValue=function(a){var b=[];if(a.range=!1,!a.first())return[];for(;;){var c=this.value(a);if(void 0!==c&&b.push(c),0==a.next())break}return a.range=!0,(void 0===this.context||a===this.context.scope?this.cache:a.lookup(this.name)).scope=a,b},Symbol.prototype.evaluateIfDependenciesExist=function(){this.evaluate(this.context.scope,this.context.scope.lookup(this.name))},Symbol.prototype.getValueScope=function(a){return a.lookup(this.name).scope},Symbol.prototype.evaluate=function(a,b){this.context&&this.context.beginEvaluation(this);try{if(b.up_to_date=!0,this.has_evaled=!0,this.fullexp&&this.origin&&"definition"==this.origin.type?(this.origin.rebuild(this),this.fullexp=!1):this.fullexp=!1,b.value=this.definition.call(this,this.context,a,b),this.extend)for(var c in this.extend)this.extend[c].code(this.context,a,b.value)}catch(c){c instanceof Eden.RuntimeError&&eden.emit("error",[this,c]),console.error(this.name,c),b.value=void 0,b.up_to_date=!0}this.context&&this.context.endEvaluation(this)},Symbol.prototype.clearEvalIDs=function(){var a=this.context;for(var b in this.evalIDs)a.clearEval(this.evalIDs[b]);this.evalIDs={},this.evalResolved=!1},Symbol.prototype.clearObservees=function(){for(var a in this.observees){this.observees[a].removeObserver(this.name)}this.observees={}},Symbol.prototype.subscribe=function(){
for(var a=Utils.flatten(arguments),b=0;b<a.length;++b){var c=a[b],d=this.context.lookup(c);if(d.name!=this.name){d.addSubscriber(this.name,this);var e=d.name;this.dependencies[e]=d,delete this.dynamicDependencies[e]}}return this},Symbol.prototype.subscribeDynamic=function(a,b,c){if(c&&c!==eden.root.scope&&c.cause)return c.cause.subscribeDynamic(c.causecount++,b);if(!(b in this.dependencies)){var d,e,f=this.dynamicDependencyTable[a];void 0!==f&&(e=this.dynamicDependencyRefCount[f],1==e?(d=this.context.lookup(f),d.removeSubscriber(this.name),delete this.dynamicDependencies[d.name],delete this.dynamicDependencyRefCount[f]):this.dynamicDependencyRefCount[f]=e-1),b in this.dynamicDependencies?this.dynamicDependencyRefCount[b]++:(d=this.context.lookup(b),d.addSubscriber(this.name,this),this.dynamicDependencies[d.name]=d,this.dynamicDependencyRefCount[b]=1)}return this.dynamicDependencyTable[a]=b,b},Symbol.prototype.clearDependencies=function(){var a;for(var b in this.dependencies)a=this.dependencies[b],a.removeSubscriber(this.name);this.dependencies={};for(var b in this.dynamicDependencies)a=this.dynamicDependencies[b],a.removeSubscriber(this.name);this.dynamicDependencies={},this.dynamicDependencyTable=[],this.dynamicDependencyRefCount={}},Symbol.prototype.getSource=function(){return this.origin&&!this.origin.internal?this.origin.getSource():this.name+" = "+Eden.edenCodeForValue(this.value())+";"},Symbol.prototype.define=function(a,b,c,d){if(this.garbage=!1,this.fullexp=!0,this.definition=a,this.origin=b,this.needsGlobalNotify=Symbol.REDEFINED,this.clearObservees(),this.clearDependencies(),this.subscribe(c),this.extend)for(var e in this.extend)this.subscribe(this.extend[e].deps);return this.context&&this.context.expireSymbol(this),eden.peer&&d&&eden.peer.define(b,this.name,d,c),this},Symbol.prototype.expireSubscribers=function(){for(var a in this.subscribers)this.subscribers[a].needsGlobalNotify=Symbol.EXPIRED,this.context.expireSymbol(this.subscribers[a])},Symbol.prototype.observe=function(a){a=Utils.flatten(arguments);for(var b=0;b<a.length;++b){var c=this.context.lookup(a[b]);this.observees[c.name]=c,c.addObserver(this.name,this)}return this.context&&this.context.triggerSymbol(this),this},Symbol.prototype.stopObserving=function(a){this.observees[a].removeObserver(this.name),this.observees[a]=void 0},Symbol.prototype.append=function(a,b,c){var d=this.value(b);d.push(a),this.assign(d,b,c)},Symbol.prototype.assign=function(a,b,c){this.garbage=!1,this.cache.value!==a&&(a=copy(a)),"autocalc"===this.name&&(!0===a?a=1:!1===a&&(a=0),this.context&&this.context.autocalc(1===a)),this.clearEvalIDs(),this.origin=c,this.definition=void 0,this.needsGlobalNotify=Symbol.ASSIGNED,this.has_evaled=!0,this.extend=void 0;var d=void 0===this.context||b==this.context.scope?this.cache:b.lookup2(this.name);return d.value=a,d.up_to_date=!0,this.clearObservees(),this.clearDependencies(),this.context&&this.context.expireSymbol(this),eden.peer&&eden.peer.assign(c,this.name,a),this},Symbol.prototype.assigned=function(a){return this.garbage=!1,this.clearEvalIDs(),this.evalResolved=!0,this.origin=a,this.definition=void 0,this.clearObservees(),this.clearDependencies(),this},Symbol.prototype.mutate=function(a,b,c,d){this.garbage=!1;this.origin=c,this.value(a),this.definition=void 0,this.needsGlobalNotify=Symbol.ASSIGNED;for(var e=[],f=1;f<arguments.length;f++)e.push(arguments[f]);return b.apply(void 0,[this].concat(e)),this.context&&this.context.expireSymbol(this),this},Symbol.prototype.loggers={console:function(a){console.log("<JSEDEN:"+this.name+"> "+a)}},Symbol.prototype.logError=function(a){for(var b in this.loggers){this.loggers[b].call(this,a)}},Symbol.prototype.getEdenCode=function(){return"&"+this.name},Symbol.prototype.trigger=function(){try{this.value().call(this,this.context,this.context.scope)}catch(b){var a=new Eden.RuntimeError(void 0,Eden.RuntimeError.PROCAGENT,void 0,"Triggered proc failed: "+b);eden.emit("error",[this,a])}},Symbol.prototype.fireJSObservers=function(){for(var a in this.jsObservers)try{this.jsObservers[a](this,this.value())}catch(d){var b=new Eden.RuntimeError(void 0,Eden.RuntimeError.JSOBSERVER,void 0,"JavaScript observer '"+a+"' failed: "+d);eden.emit("error",[this,b]);if(this.context){var c=this.cache.value;"object"==typeof c&&c.jsExceptions}else!1;throw d}},Symbol.prototype.expire=function(a,b,c,d){if(d&&this.origin&&"definition"==this.origin.type&&this.origin.expire(),this.has_evaled||d&&this.needsGlobalNotify!=Symbol.EXPIRED){for(var e in this.observers)c[e]=this.observers[e];this.definition&&(this.cache.up_to_date=!1,this.has_evaled=!1,a[this.name]=b.value,b.value++,d&&(this.def_scope=void 0,this.fullexp=!0)),this.needsGlobalNotify=Symbol.EXPIRED;for(var f in this.subscribers){var g=this.subscribers[f];g&&g.expire(a,b,c,d)}}},Symbol.prototype.isDependentOn=function(a){if(a==this.name||this.dependencies[a])return!0;var b;for(var c in this.dependencies)if(b=this.dependencies[c],b.isDependentOn(a))return!0;for(var c in this.dynamicDependencies)if(b=this.dynamicDependencies[c],b.isDependentOn(a))return!0;return!1},Symbol.prototype.getDependencies=function(){var a=[];for(var b in this.dependencies)a.push(b);return console.log("Dependencies"),a},Symbol.prototype.assertNotDependentOn=function(a,b){if(void 0===b&&(b=[]),b.push(this.name),this.dependencies[a]){var c=b.join(" -> ")+" -> "+a+" -> "+b[0];throw new Error("Cyclic dependency detected: "+c)}var d;for(var e in this.dependencies)d=this.dependencies[e],d.assertNotDependentOn(a,b);for(var e in this.dynamicDependencies)d=this.dynamicDependencies[e],d.assertNotDependentOn(a,b);b.pop()},Symbol.prototype.addSubscriber=function(a,b){this.garbage=!1,this.subscribers[a]=b},Symbol.prototype.removeSubscriber=function(a){delete this.subscribers[a],void 0===this.origin&&this.canSafelyBeForgotten()&&this.forget()},Symbol.prototype.canSafelyBeForgotten=function(){for(var a in this.subscribers)return!1;for(var b in this.observers)return!1;return!0},Symbol.prototype.forget=function(){this.origin=void 0,this.clearEvalIDs(),this.evalResolved=!0,this.definition=void 0,this.cache.value=void 0,this.cache.up_to_date=!0,this.context&&this.context.expireSymbol(this),this.clearObservees(),this.clearDependencies(),this.garbage=!0;for(var a in this.jsObservers)this.jsObservers[a].call(this,this,void 0);this.jsObservers={},this.context.queueForGarbageCollection(this)},Symbol.prototype.addObserver=function(a,b){this.garbage=!1,this.observers[a]=b},Symbol.prototype.addJSObserver=function(a,b){if("function"!=typeof b)throw new Error("Failed adding JavaScript observer "+b);this.jsObservers[a]=b,0==this.cache.up_to_date&&this.value()},Symbol.prototype.removeObserver=function(a){delete this.observers[a],void 0===this.origin&&this.canSafelyBeForgotten()&&this.forget()},Symbol.prototype.removeJSObserver=function(a){delete this.jsObservers[a]},Symbol.prototype.addExtension=function(a,b,c,d,e){if(!this.definition)throw new Error(Eden.RuntimeError.EXTENDSTATIC);void 0===this.extend&&(this.extend={}),this.extend[a]={code:b,source:c,deps:e},this.subscribe(e),this.needsGlobalNotify=Symbol.REDEFINED,this.context&&this.context.expireSymbol(this)},Symbol.prototype.listAssign=function(a,b,c,d,e){if(this.definition)throw new Error(Eden.RuntimeError.ASSIGNTODEFINED);for(var f=this.value(b),g=0;g<e.length-1;g++)f&&(f=f[e[g]]);if(!f)throw new Error(Eden.RuntimeError.ASSIGNDIMENSION);return f[e[e.length-1]]=a,this.origin=c,this.needsGlobalNotify=Symbol.ASSIGNED,this.context&&this.context.expireSymbol(this),eden.peer&&eden.peer.listAssign(c,this.name,a,e),this},edenCopy=copy,Folder.prototype.getNumberOfLines=function(){return this.numlines+1},Folder.prototype.hasErrors=function(){return!1},Folder.prototype.getOrigin=function(){return eden.project},Folder.prototype.getStatementByLine=function(a){},Folder.prototype.getStartLine=function(a){return this.parent?this.parent.getRelativeLine(this,a):-1},Folder.prototype.getRange=function(a){var b=this.getStartLine(a);return[b,b+this.getNumberOfLines()]},Folder.prototype.getInnerSource=function(){var a="";this.numlines=0;for(var b in this.symbols){var c=this.symbols[b];if(c.origin&&c.origin.getOrigin){var d=c.origin.getOrigin();if(!d||d&&!d.remote){var e=c.getSource();e&&(a+=e+"\n",this.numlines+=c.origin.numlines+1)}}}return a},Folder.prototype.destroy=function(){},Folder.prototype.getSource=function(){var a="action ACTIVE {\n";return a+=this.getInnerSource(),a+="}"},Folder.prototype.execute=function(){},Folder.prototype.lookup=function(a){return void 0===this.symbols[a]&&(this.symbols[a]=new Symbol(this,a),this.notifyGlobals(this.symbols[a],1)),this.symbols[a]},Folder.prototype.currentObservableName=function(){return 0==this.currentObservables.length?void 0:this.currentObservables[this.currentObservables.length-1].name},Folder.prototype.beginEvaluation=function(a){this.currentObservables.push(a)},Folder.prototype.endEvaluation=function(a){this.currentObservables.pop()},Folder.prototype.queueForGarbageCollection=function(a){this.potentialGarbage[a.name]=a},Folder.prototype.collectGarbage=function(){for(var a in this.potentialGarbage)this.potentialGarbage[a].garbage&&delete this.symbols[a];this.potentialGarbage={}},Folder.prototype.putEval=function(a,b){this.evalResults[a]=b},Folder.prototype.getEval=function(a){return this.evalResults[a]},Folder.prototype.clearEval=function(a){delete this.evalResults[a]},Folder.prototype.addGlobal=function(a){this.globalobservers.push(a)},Folder.prototype.removeGlobal=function(a){for(var b=0;b<this.globalobservers.length;b++)if(this.globalobservers[b]===a)return this.globalobservers.splice(b,1),!0;return!1},Folder.prototype.notifyGlobals=function(a,b){for(var c=0;c<this.globalobservers.length;c++)void 0!==this.globalobservers[c]&&this.globalobservers[c].call(this,a,b)},Folder.prototype.autocalc=function(a){this.autocalc_state=a,this.expireAndFireActions()},Folder.prototype.beginAutocalcOff=function(){1==++this.saved_autocalc_level&&(this.saved_autocalc_state=this.autocalc_state,this.autocalc_state&&this.autocalc(!1))},Folder.prototype.endAutocalcOff=function(){0==--this.saved_autocalc_level&&this.saved_autocalc_state&&this.autocalc(!0)},Folder.prototype.expireSymbol=function(a){-1==this.needsExpire.indexOf(a)&&this.needsExpire.push(a),this.expireAndFireActions()},Folder.prototype.triggerSymbol=function(a){if(this.needsTrigger[a.name]=a,void 0===this.firetimer){var b=this;this.firetimer=setTimeout(function(){this.firetimer=void 0,b.expireAndFireActions()},0)}},Folder.prototype.expireAndFireActions=function(){if(this.autocalc_state){this.expiryCount.value=0;for(var a={},b=0;b<this.needsExpire.length;b++){var c=this.needsExpire[b];c.expire(a,this.expiryCount,this.needsTrigger,c.needsGlobalNotify==Symbol.REDEFINED)}var d=this.needsExpire;this.needsExpire=[];var e=Object.keys(a);e.sort(function(b,c){return a[b]-a[c]});for(var f=[],b=0;b<e.length;b++){var c=this.symbols[e[b]];c.needsGlobalNotify=Symbol.EXPIRED,f.push(c)}var g=this.needsTrigger;if(this.needsTrigger={},fireActions(g),fireJSActions(d),fireJSActions(f),0==this.needsGlobalNotify.length){if(f.push.apply(f,d),f.length>0){this.needsGlobalNotify=f;var h=this;setTimeout(function(){h.processGlobalNotifyQueue()},0)}}else{var i=this.needsGlobalNotify;i.push.apply(i,f),i.push.apply(i,d)}}},Folder.prototype.processGlobalNotifyQueue=function(){for(var a=this.needsGlobalNotify,b=0;b<a.length;){this.globalNotifyIndex++;var c=a[b];if(c.needsGlobalNotify){var d=c.needsGlobalNotify;c.needsGlobalNotify=0,this.notifyGlobals(c,d)}b=this.globalNotifyIndex}this.needsGlobalNotify=[],this.globalNotifyIndex=0},Folder.prototype.forgetAll=function(){var a,b,c,d,e,f,g=void 0;if(arguments.length>4)return eden.error(new Error("forgetAll: This function requires at most 4 arguments."),"error"),[[],void 0,[]];if(0==arguments.length)a="";else if("string"==typeof arguments[0])a=arguments[0];else{if(!Array.isArray(arguments[0]))return void 0===arguments[0]?[[],void 0,[]]:(eden.error(new Error("forgetAll: The first argument must be a string, not a "+typeof arguments[0]),"error"),[[],void 0,[]]);g=arguments[0]}if(arguments.length>1){if("boolean"!=typeof arguments[1])return eden.error(new Error("forgetAll: The second argument must be a boolean, not a "+typeof arguments[1]),"error"),[[],void 0,[]];b=arguments[1]}else b=!0;if(void 0!==g&&arguments.length>2)return eden.error(new Error("forgetAll: Cannot specify case sensitivity when selecting using a list."),"error"),[[],void 0,[]];if(arguments.length>=3){if("boolean"!=typeof arguments[2])return eden.error(new Error("forgetAll: The third argument must be a boolean, not a "+typeof arguments[2]),"error"),[[],void 0,[]];c=arguments[2]}else c=void 0===g||2!=arguments.length||arguments[1];if(arguments.length>3){if("boolean"!=typeof arguments[3])return eden.error(new Error("forgetAll: The forth argument must be a boolean, not a "+typeof arguments[3]),"error"),[[],void 0,[]];d=arguments[3]}else d=!1;var h,i={},j=[],k={};if(void 0!==g)for(var l=0;l<g.length;l++){var m;if(g[l]instanceof Symbol)m=g[l].name,f=g[l];else{if("string"!=typeof g[l]){if(void 0===g)continue;return eden.error(new Error("forgetAll: All list items must be strings or pointers.  Item "+l+" is a "+typeof g[l]),"error"),[[],void 0,[]]}m=g[l],f=root.lookup(m)}if(d||!Eden.isitSystemSymbol(m))if(h=eden.initialDefinition(m))k[m]=h;else{var n=[];for(var o in f.subscribers)n.push(o);for(var p in f.observers)n.push(p);i[m]=n}else j.push(m)}else{e=b?new RegExp(a):new RegExp(a,"i");var q=/^_[vV]iew(s?)_/;for(var m in root.symbols)if(e.test(m)){if(!d&&(Eden.isitSystemSymbol(m)||q.test(m)))continue;f=root.symbols[m];var n=[];for(var o in f.subscribers)n.push(o);for(var p in f.observers)n.push(p);i[m]=n}}var r={},s=function(a){if(a in r)return r[a];if(a in k)return!0;if(!(a in i))return r[a]=!1,!1;var b=i[a];if(0==b.length)return r[a]=!0,!0;for(var c=0;c<b.length;c++){if(!s(b[c]))return r[a]=!1,!1}return r[a]=!0,!0},t=[];for(m in i){s(m)?t.push(m):j.push(m)}var u,v=Object.keys(k),w=t.concat(v);if(w.length>0&&c)if(w.length<=50)u=confirm("You are about to delete the following "+w.length+" symbols.  Is this correct?\n\n"+w.join("\n"));else{var x=w.length-50;u=confirm("You are about to delete "+w.length+" symbols.  Is this correct?\n\n"+w.slice(0,50).join("\n")+"\n...\n("+x+" more)")}else u=!0;if(u){root.beginAutocalcOff();for(m in k);for(var l=0;l<t.length;l++){var m=t[l];if(void 0!==(f=root.symbols[m])){"refreshView"in f.jsObservers&&(f.assign(void 0,root.scope),edenUI.plugins.Canvas2D&&edenUI.plugins.Canvas2D.destroyViews&&edenUI.plugins.Canvas2D.destroyViews(m)),f.forget();var y=m.match(/^_view_(.*)_content$/);null!==y&&edenUI.destroyView(y[1],!0)}}return root.collectGarbage(),root.endAutocalcOff(),[t,j,v]}return[[],j,[]]},function(a){function b(a,b){this.getLabel=function(){return a},this.getMenuPriority=function(){return b}}function c(a){this.eden=a,this.views={},this.viewInstances={},this.embeddedInstances={},this.activeDialogs={},this.plugins={};var b=this;this.loaded=!1,this.branding={},$.ajax({url:"branding.json",dataType:"json",success:function(a){b.branding=a}}),this.$uimsg=$("<div class='message-box'></div>"),this.$uimsg.appendTo("body"),this.$uimsg.hide(),this.messagetimeout=void 0,this.messagedisplaytime=5e3,this.eden.listenTo("executeFileLoad",this,function(a){edenUI.updateStatus("Loading "+a)}),this.eden.listenTo("executeError",this,function(a,b){console.error("DEPRECATED ERROR REPORTING",a);var c,e=d.htmlEscape(a.message);b.errorNumber,b.path&&b.path;c="string"==typeof a?a:a.message,edenUI.showMessage("error","Error: "+c)}),this.listeners={},this.windowHighlighter=new WindowHighlighter(this),this.currentView=void 0,this.viewCategories={},this.numberOfViewCategories=0,this.addViewCategory("comprehension","Comprehension"),this.addViewCategory("interpretation","Making Definitions"),this.addViewCategory("history","History &amp; State"),this.addViewCategory("visualization","Visualization"),this.addViewCategory("extension","Extensions"),this.addViewCategory("environment","Management"),$(document).on("click",function(a){if(a.ctrlKey||a.metaKey)for(var b=[],c=a.target;"BODY"!=c.nodeName;){var d=c.getAttribute("data-observables");d&&""!=d&&b.push.apply(b,d.split(",")),c=c.parentNode}})}function d(a){this.root=a,a.base=this,this.dictionary={},this.f={},this.s={},this.errorNumber=0,this.listeners={},this.reportErrors=!0,this.workers=[],this.workerlock={};for(var b=this,c=0;c<4;c++)this.workers[c]=new Worker("js/core/worker.js"),this.workers[c].onmessage=function(a){console.log("Worker:",a.data),b.workerlock[a.data.observable]=!1,eden.root.symbols[a.data.observable].cache.value=a.data.data,eden.root.symbols[a.data.observable].expireSubscribers()}}"undefined"!=typeof require&&"undefined"!=typeof exports&&(Polyglot=require("./polyglot").Polyglot,rt=require("./runtime").rt),c.prototype.brieflyHighlightView=function(a){var b=$("#"+viewName+"-dialog").dialog.parent();b.addClass("window-activated"),setTimeout(function(){b.removeClass("window-activated")},600)},c.prototype.cycleNextView=function(){this.stopHighlightingView(this.currentView,!0,!1);var a=Object.keys(this.activeDialogs);if(void 0===this.currentView)this.currentView=a[0];else for(i=0;i<a.length;i++)if(this.currentView==a[i]){this.currentView=a[(i+1)%a.length];break}this.highlightView(this.currentView,!0)},c.prototype.stopViewCycling=function(){this.stopHighlightingView(this.currentView,!0,!0)},c.plugins={},c.prototype.loadPlugin=function(a,b,d){2===arguments.length&&(d=b,b={name:"/loadPlugin"});var e=this,f=function(){e.emit("loadPlugin",[a]),d&&d.call(b)};void 0===this.plugins[a]?(this.plugins[a]=!0,this.plugins[a]=new c.plugins[a](this,f)):f()},c.prototype.addViewCategory=function(a,c){this.viewCategories[a]=new b(c,this.numberOfViewCategories),this.numberOfViewCategories++},c.prototype.updateStatus=function(a){this.loaded?this.showMessage("info",a):(console.log(a),$(".loadmessage").html(a))},c.prototype.hideMessage=function(){edenUI.$uimsg.hide("slow")},c.prototype.showMessage=function(a,b){"info"==a?this.$uimsg.html("<div class='message-infotext'>"+b+"</div>"):"error"==a&&this.$uimsg.html("<div class='message-errortext'>"+b+"</div>"),this.$uimsg.show("fast"),clearTimeout(this.messagetimeout),this.messagetimeout=setTimeout(this.hideMessage,this.messagedisplaytime)},c.prototype.finishedLoading=function(){this.loaded=!0},c.prototype.listenTo=listenTo,c.prototype.emit=emit,c.showTooltip=function(a,b){var c=document.getElementById("tooltip"),d=a.clientX+2,e=a.clientY+20,f=window.pageXOffset+window.innerWidth-d-15;f<200&&(d-=200-f,f=200),c.style.left=d+"px",c.style.maxWidth=f+"px",c.style.top=e+"px",c.innerHTML=b,c.style.display="block"},c.closeTooltip=function(){document.getElementById("tooltip").style.display="none"},c.prototype.options={},c.prototype.getOptionValue=function(a){if(a in this.options)return this.options[a];try{if(window.localStorage)return window.localStorage.getItem(a)}catch(a){return null}},c.prototype.setOptionValue=function(a,b){this.options[a]=String(b),this.emit("optionChange",[a,String(b)]);try{if(window.localStorage)return window.localStorage.setItem(a,b),!0}catch(a){return!1}},c.prototype.setDefaultOptionValue=function(a,b){null===this.getOptionValue(a)&&(this.options[a]=String(b),this.emit("optionChange",[a,String(b)]))},c.prototype.unsetOptionValue=function(a){delete this.options[a],this.emit("optionChange",[a,null]);try{window.localStorage&&window.localStorage.removeItem(a)}catch(a){}},c.prototype.fullscreen=function(a,b){var c=eden.root.lookup(b),d=c.value();if(document.webkitExitFullscreen)if(d){document.onwebkitfullscreenchange=function(){document.webkitIsFullScreen||(c.assign(!1,eden.root.scope,Symbol.hciAgent),edenUI.menu.show())};var e=document.getElementById(a+"-canvascontent");e.webkitRequestFullscreen(),edenUI.menu.hide()}else document.webkitExitFullscreen(),edenUI.menu.show();else if(document.mozCancelFullScreen)if(d){document.onmozfullscreenchange=function(){document.mozFullScreen||(c.assign(!1,eden.root.scope,Symbol.hciAgent),edenUI.menu.show())};var e=document.getElementById(a+"-canvascontent");e.mozRequestFullScreen(),edenUI.menu.hide()}else document.mozCancelFullScreen(),edenUI.menu.show()},c.prototype.regExpFromStr=function(a,b,c,d){var e,f,g,h=!0;"object"==typeof a&&(g=a,a=g[0].value),void 0===b&&(b="");var i;if(void 0===d)i=!/[\\+^$|({[]|(\.\*[^\s*?])/.test(a)&&"false"!==this.getOptionValue("optSimpleWildcards");else if("simple"==d)i=!0;else{if("regexp"!=d)throw new Error("EdenUI.regExpFromStr: Unsupported search language "+d);i=!1}if(/[A-Z]/.test(a)||(b+="i"),i){a=a.replace(/([\\+^$.|(){[])/g,"\\$1").replace(/([*?])/g,".$1");for(var j=a.split(new RegExp("\\s+(?:"+Language.ui.search.disjunction+"|or)\\s+","i")),k=0;k<j.length;k++){var l=j[k];c||/[?*]/.test(l)?j[k]="^("+l+")$":l.length<3&&(j[k]="^("+l+")")}e=j.join("|"),f=new RegExp(e,b)}else try{e=a,c&&(e="^("+e+")$"),f=new RegExp(e,b)}catch(d){h=!1;var m=a.match(/^([^*+?\\(){[]([^\\()[]*(\\.)?)*)?/)[0];c&&(m="^("+m+")"),f=new RegExp(m,b)}return g&&(h?g.removeClass("invalid_form"):g.addClass("invalid_form")),f},d.prototype.workerRegister=function(a,b){for(var c=0;c<this.workers.length;c++)this.workers[c].postMessage({cmd:"register",name:a,source:b})},d.prototype.workerCall=function(a,b,c,d){this.workerlock[a]||(this.workerlock[a]=!0,this.workers[c].postMessage({cmd:"call",name:b,args:d,observable:a}))},d.prototype.updateDictionary=function(a,b,c){this.dictionary[a]=b,eden.peer&&!c&&eden.peer.doxy(a,b)},d.prototype.isValidIdentifier=function(a){return Boolean(a&&/^[_a-zA-Z]\w*$/.test(a))},d.load=function(a,b,e,f){console.log("Loading project: "+a+"@"+b),d.DB.load(a,b,void 0,function(d){if("object"==typeof d&&c.MenuBar.saveTitle(d.title),eden.root.lookup("_jseden_loaded").assign(!0,eden.root.scope),!f){var g=URLUtil.getParameterByName("master"),h=URLUtil.getParameterByName("id"),i="?load="+a+"&tag="+b;""!=h&&(i+="&id="+h),""!=g&&(i+="&master="+g),window.history.pushState({project:a,tag:b},"",i)}e&&e()})},d.loadFromString=function(a,b){eden.execute2(a),eden.root.lookup("_jseden_loaded").assign(!0,eden.root.scope),b&&b(data)},d.reset=function(){edenUI.destroyAllViews(),eden.reset()},d.prototype.reset=function(){this.root.forgetAll("",!0,!1),this.root.collectGarbage(),this.errorNumber=0,this.reportErrors=!0},d.prototype.listenTo=listenTo,d.prototype.emit=emit,d.prototype.error=function(a,b){eden.emit("error",[Symbol.jsAgent,new d.RuntimeError(void 0,0,void 0,a)])},d.prototype.executeEden=function(a,b,c,d,e){console.error("DEPRECATED USE OF OLD PARSER",a),e&&e()},d.prototype.include=function(a,b,c,d){console.error("DEPRECATED USE OF INCLUDE: ",a),d&&d()},d.prototype.execute2=function(a,b,c){var e=b;void 0!==b&&"string"!=typeof b||(e={name:"*execute"},b&&(e.name=b));var f=new d.AST(a,void 0,e,{noindex:!0});0==f.script.errors.length?f.execute(e,c):(console.error(f.script.errors[0].prettyPrint()),c&&c(!1))},d.prototype.execute=d.prototype.execute2,d.prototype.agentFromFile=function(a,b,c){var e;e=void 0===d.Agent.agents[a]?new d.Agent(void 0,a):d.Agent.agents[a],e.loadFromFile(b,c)},d.edenCodeForValue=function(a,b,c){var e=typeof a,f="";if("undefined"==e)f="@";else if(null===a)f="${{ null }}$";else if("string"==e)f=a.indexOf("\n")>=0?"<<END\n"+a.replace(/\n/g,"\\n")+"\nEND":'"'+a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"';else if(Array.isArray(a))if(void 0===b&&(b=[]),-1!=b.indexOf(a))f+="<<circular reference>>";else{b.push(a),f="[";for(var g=0;g<a.length-1;g++)f=f+d.edenCodeForValue(a[g],b,c)+", ";a.length>0&&(f+=d.edenCodeForValue(a[a.length-1],b,c)),f+="]",b.pop()}else if("object"==e){if("getEdenCode"in a?f=a.getEdenCode(c):"keys"in a&&Array.isArray(a.keys)&&a.keys.length>0&&"parent"in a&&a.parent instanceof Symbol?f="&"+a.parent.name.slice(1)+"["+a.keys[0]+"]":"object"==typeof window&&"object"==typeof document&&"function"==typeof Element&&(a==window?f="${{ window }}$":a==document?f="${{ document }}$":a==document.documentElement?f="${{ document.documentElement }}$":a==document.body?f="${{ document.body }}$":a instanceof Element&&a.id&&(f='${{ document.getElementById("'+a.id+'") }}$')),""==f)if(void 0===b&&(b=[]),-1!=b.indexOf(a))f+="<<circular reference>>";else{b.push(a),f="Object(";for(var h in a)h in Object.prototype||(f=f+h+", "+d.edenCodeForValue(a[h],b,c)+", ");"Object("!=f&&(f=f.slice(0,-2)),f+=")",b.pop()}}else f="function"==e?"${{\n\t"+a.toString().replace(/\n/g,"\n\t")+"\n}}$":"number"==e&&c?a.toFixed(c):String(a);return f},d.edenCodeForValues=function(){for(var a="",b=0;b<arguments.length-1;b++)a=a+d.edenCodeForValue(arguments[b])+", ";return a+=d.edenCodeForValue(arguments[arguments.length-1])},d.edenCodeForValuesP=function(a){for(var b="",c=1;c<arguments.length-1;c++)b=b+d.edenCodeForValue(arguments[c],void 0,a)+", ";return b+=d.edenCodeForValue(arguments[arguments.length-1],void 0,a)},d.prettyPrintValue=function(a,b,c,e,f,g){void 0===f&&(f=!0);var h=typeof b,i="",j=!1;if("undefined"==h)i="@";else if(null===b)i="${{ null }}$";else if("string"==h)i='"'+b.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"',void 0!==c&&i.length>c+1&&(i=i.slice(0,c)+"...",j=!0);else if(Array.isArray(b))if(void 0===g&&(g=[]),-1!=g.indexOf(b))i+="...";else{g.push(b),i="[";for(var k=0;k<b.length-1;k++){if(i=d.prettyPrintValue(i,b[k],c,e,f,g)+",",void 0!==c&&i.length>=c-1){"..."!=i.slice(-3)&&(i+="..."),j=!0;break}i+=" "}b.length>0&&!j&&(i=d.prettyPrintValue(i,b[b.length-1],c,e,f,g)),i+="]",g.pop()}else if("object"==h){if(b instanceof Symbol?i=b.getEdenCode():"keys"in b&&Array.isArray(b.keys)&&b.keys.length>0&&"parent"in b&&b.parent instanceof Symbol?i="&"+b.parent.name.slice(1)+"["+b.keys[0]+"]":"object"==typeof window&&"object"==typeof document&&"function"==typeof Element&&(b==window?i="${{ window }}$":b==document?i="${{ document }}$":b==document.documentElement?i="${{ document.documentElement }}$":b==document.body?i="${{ document.body }}$":b instanceof Element&&b.id&&(i='${{ document.getElementById("'+b.id+'") }}$')),""==i)if(b.toString!=Object.prototype.toString)i=b.toString(),void 0!==c&&i.length>c&&(i=i.slice(0,c)+"...",j=!0);else if(void 0===g&&(g=[]),-1!=g.indexOf(b))i+="...";else{g.push(b),i="{";var l=!1;for(var m in b)if(!(m in Object.prototype)){if(l){i=i.slice(0,-1)+"...",j=!0;break}if(i=i+m+": ",i=d.prettyPrintValue(i,b[m],c,e,f,g),"..."==i.slice(-3)){j=!0;break}void 0!==c&&i.length>=c&&(l=!0),i+=", "}"{"==i||j||(i=i.slice(0,-2)),i+="}",g.pop()}}else"function"==h?e?(i="${{\n\t"+b.toString().replace(/\n/g,"\n\t")+"\n}}$",void 0!==c&&i.length>c&&(i=i.slice(0,c)+"...",j=!0)):i="func":i=String(b);if(a)return a+i;var n=d.htmlEscape(i,!f);return n=n.replace(/\.\.\./g,"&hellip;"),f||(n=n.replace(/\n/g,"\\n")),n},d.htmlEscape=function(a,b,c){return void 0===a?"":(a=String(a),a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/"/g,"&quot;"),a=a.replace(/'/g,"&#39;"),c?a=b?a.replace(/\n/g," "):a.replace(/\n/g,"<br/>"):b||(a=a.replace(/\n/g,"<br/>\n")),a)},d.prototype.nextEvalID=0,d.prototype.initialDefinition=function(){console.error("INIT DEF DEP")},d.prototype.getDefinition=function(a,b){return b.eden_definition?b.eden_definition+";":a+" = "+b.context.scope.lookup(b.name).value+";"},a.EdenUI=c,a.Eden=d,"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.Eden=d)}("undefined"!=typeof window?window:global),Eden.DB={directory:{},meta:{},remoteMeta:{},remoteURL:void 0,username:void 0,userid:void 0,repositories:["http://jseden.dcs.warwick.ac.uk/construalmanager","http://localhost:18882"],repoindex:0,retrycount:0,connected:!1,searchServer:"http://jseden.dcs.warwick.ac.uk"},Eden.DB.listeners={},Eden.DB.emit=emit,Eden.DB.listenTo=listenTo,Eden.DB.isConnecting=function(){return void 0!==Eden.DB.remoteURL},Eden.DB.isConnected=function(){return Eden.DB.connected},Eden.DB.isLoggedIn=function(){return void 0!==Eden.DB.username},Eden.DB.logOut=function(a){Eden.DB.isLoggedIn()&&$.ajax({url:Eden.DB.remoteURL+"/logout",type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(b){function c(){Eden.DB.isConnected()&&void 0===Eden.DB.username&&setTimeout(function(){Eden.DB.getLoginName(function(a){a?(Eden.DB.emit("login",[a]),eden.root.lookup("jseden_pm_user").assign(a,eden.root.scope,Symbol.localJSAgent)):c()})},5e3)}Eden.DB.username=void 0,Eden.DB.emit("logout",[]),a&&a(),c()},error:function(a){Eden.DB.disconnect(!0)}})},Eden.DB.connect=function(a,b){function c(a){for(var b in a)a[b].missing=!0,a[b].children&&c(a[b].children)}function d(){Eden.DB.isConnected()&&setTimeout(function(){Eden.DB.getLoginName(function(a){a?d():Eden.DB.disconnect()})},3e5)}function e(){Eden.DB.isConnected()&&void 0===Eden.DB.username&&setTimeout(function(){Eden.DB.getLoginName(function(a){a?(Eden.DB.emit("login",[a]),eden.root.lookup("jseden_pm_user").assign(a,eden.root.scope,Symbol.localJSAgent),d()):e()})},5e3)}Eden.DB.remoteURL=a,c(Eden.DB.directory),Eden.DB.refreshint=setInterval(function(){for(var a in Eden.DB.directory)Eden.DB.directory[a].missing=!0},2e4),Eden.DB.getLoginName(function(c){Eden.DB.isConnected()?(Eden.DB.retrycount=0,b&&b(Eden.DB.isConnected()),Eden.DB.emit("connected",[a]),eden.root.lookup("jseden_pm_connected").assign(!0,eden.root.scope,Symbol.localJSAgent),c?(Eden.DB.emit("login",[c]),eden.root.lookup("jseden_pm_user").assign(c,eden.root.scope,Symbol.localJSAgent)):e()):b&&b(Eden.DB.isConnected())})},Eden.DB.disconnect=function(a){Eden.DB.remoteURL=void 0,Eden.DB.connected&&(Eden.DB.emit("disconnected",[]),eden.root.lookup("jseden_pm_connected").assign(!1,eden.root.scope,Symbol.localJSAgent)),Eden.DB.connected=!1,Eden.DB.refreshint&&(clearInterval(Eden.DB.refreshint),Eden.DB.refreshint=void 0),a&&(Eden.DB.retrycount<12&&Eden.DB.retrycount++,setTimeout(function(){Eden.DB.repoindex>=Eden.DB.repositories.length&&(Eden.DB.repoindex=Eden.DB.repositories.length-1),Eden.DB.connect(Eden.DB.repositories[Eden.DB.repoindex]),Eden.DB.repoindex=(Eden.DB.repoindex+1)%Eden.DB.repositories.length},200*Math.pow(2,Math.ceil(Eden.DB.retrycount/Eden.DB.repositories.length))))},Eden.DB.getLoginName=function(a){Eden.DB.isConnecting()?$.ajax({url:Eden.DB.remoteURL+"/user/details",type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(b){Eden.DB.connected=!0,null==b||b.error?(Eden.DB.username=void 0,a()):(Eden.DB.username=b.name,Eden.DB.userid=b.id,!b.id||""!=b.name&&b.name||(Eden.DB.username="NoName"),a(Eden.DB.username))},error:function(b,c,d){Eden.DB.disconnect(!0),a(void 0)}}):a()},Eden.DB.save=function(a,b,c){Eden.DB.isConnected()?$.ajax({url:this.remoteURL+"/project/add",type:"post",crossDomain:!0,xhrFields:{withCredentials:!0},data:{projectID:a.id,title:a.title,source:a.generate(),tags:a.tags.join(" "),minimisedTitle:a.name,from:a.vid,image:a.thumb,listed:b,metadata:JSON.stringify({description:a.desc}),parentProject:a.parentid},success:function(b){null===b||b.error?(console.error(b),Eden.DB.emit("error",[b?b.description:"No response from server"]),c&&c(!1)):(console.log("Saved",b),a.id=b.projectID,a.vid=b.saveID,a.readPassword=b.readPassword,c&&c(!0))},error:function(a,b,d){Eden.DB.handleError(a,b,d),c&&c(!1)}}):(console.error("Cannot upload, not connected to server"),c&&c(!1),eden.error("Cannot upload "+path+", not connected to server"))},Eden.DB.getVersions=function(a,b){Eden.DB.isConnected()?$.ajax({url:Eden.DB.remoteURL+"/project/versions?projectID="+a,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){b(a)},error:function(a){Eden.DB.disconnect(!0)}}):b(void 0)},Eden.DB.load=function(a,b,c,d){3==arguments.length&&(d=c,c=void 0),Eden.DB.isConnected()?$.ajax({url:Eden.DB.remoteURL+"/project/get?projectID="+a+(b?"&to="+b:"")+(c?"&readPassword="+c:""),type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(c){null==c||c.error?(d(void 0,"No such version"),console.error("No such version "+b+" for "+a),console.log(c),
Eden.DB.emit("error",[c?c.description:"No response from server"])):d(c)},error:function(a,b,c){Eden.DB.handleError(a,b,c),d(void 0,"Disconnected")}}):d&&d(void 0,"Disconnected")},Eden.DB.search=function(a,b,c,d,e){var f=this.remoteURL+"/project/";f+=""==a?"search?limit="+c+"&offset="+(b-1)*c:"search?limit="+c+"&offset="+(b-1)*c+"&query="+encodeURIComponent(a),d&&(f+="&by="+d),$.ajax({url:f,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){return a&&a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),void e(void 0)):a?void e(a):void e(void 0)},error:function(a,b,c){Eden.DB.handleError(a,b,c),e(void 0)}})},Eden.DB.getMeta=function(a,b){var c=this.remoteURL+"/project/";c+="search?limit=20&query=.id("+a+")",$.ajax({url:c,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){return a&&a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),void b(void 0)):a?void b(a):void b(void 0)},error:function(a,b,c){Eden.DB.handleError(a,b,c)}})},Eden.DB.remove=function(a,b){$.ajax({url:this.remoteURL+"/project/remove",type:"post",crossDomain:!0,xhrFields:{withCredentials:!0},data:{projectID:a},success:function(a){null===a||a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),b&&b(!1)):(console.log("Removed",a),b&&b(!0))},error:function(a,c,d){Eden.DB.handleError(a,c,d),b&&b(!1)}})},Eden.DB.rate=function(a,b){$.ajax({url:this.remoteURL+"/project/rate",type:"post",crossDomain:!0,xhrFields:{withCredentials:!0},data:{projectID:a,stars:b},success:function(a){(null===a||a.error)&&(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]))},error:function(a,b,c){Eden.DB.handleError(a,b,c)}})},Eden.DB.searchSelector=function(a,b,c){$.ajax({url:this.remoteURL+"/code/search?selector="+a.replace("#","%23")+"&outtype="+b,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){if((null===a||a.error)&&(Eden.DB.emit("error",[a?a.description:"No response from server"]),c([])),a)return void c(a);c([])},error:function(a,b,d){c([]),Eden.DB.handleError(a,b,d)}})},Eden.DB.postComment=function(a,b,c){var d=a?a.id:-1,e=a?a.vid:-1;Eden.DB.isLoggedIn()&&$.ajax({url:this.remoteURL+"/comment/post",type:"post",crossDomain:!0,xhrFields:{withCredentials:!0},data:{projectID:d,versionID:e,publiclyVisible:c?0:1,comment:b},success:function(a){(null===a||a.error)&&(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]))},error:function(a,b,c){Eden.DB.handleError(a,b,c)}})},Eden.DB.searchComments=function(a,b,c,d,e,f){var g=a?a.id:-1;Eden.DB.isConnected()&&$.ajax({url:this.remoteURL+"/comment/search?projectID="+g+(e?"&newerThan="+e:"")+"&offset="+(c-1)*d+"&limit="+d,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){if(a)return void f(a);f([])},error:function(a,b,c){f([]),Eden.DB.handleError(a,b,c)}})},Eden.DB.removeComment=function(a){Eden.DB.isLoggedIn()&&$.ajax({url:this.remoteURL+"/comment/delete",type:"post",crossDomain:!0,xhrFields:{withCredentials:!0},data:{commentID:a},success:function(a){(null===a||a.error)&&(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]))},error:function(a,b,c){Eden.DB.handleError(a,b,c)}})},Eden.DB.follow=function(a,b){Eden.DB.isLoggedIn()&&$.ajax({url:this.remoteURL+"/social/followproject?projectID="+a,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){null===a||a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),b&&b(!1)):b&&b(!0)},error:function(a,c,d){Eden.DB.handleError(a,c,d),b&&b(!1)}})},Eden.DB.adminCommentActivity=function(a,b,c){Eden.DB.isLoggedIn()&&$.ajax({url:this.remoteURL+"/comment/activity?limit=10&offset="+b+(a?"&newerThan="+a:""),type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){null===a||a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),c&&c(!1)):c&&c(a)},error:function(a,b,d){Eden.DB.handleError(a,b,d),c&&c(!1)}})},Eden.DB.handleError=function(a,b,c){console.log("DB ERROR",b,c),"error"!=b||c?"error"==b?Eden.DB.emit("error",[c]):"timeout"==b?(Eden.DB.emit("error",["Network timeout"]),Eden.disconnect(!0)):(Eden.DB.emit("error","Unknown network error"),Eden.disconnect(!0)):(Eden.DB.disconnect(!0),Eden.DB.emit("error",["Not connected to construal cloud"]))},Eden.DB.adminProjectActivity=function(a,b,c){Eden.DB.isLoggedIn()&&$.ajax({url:this.remoteURL+"/project/activity?limit=15&offset="+b+(a?"&newerThan="+a:""),type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){null===a||a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),c&&c(!1)):c&&c(a)},error:function(a,b,d){Eden.DB.handleError(a,b,d),c&&c(!1)}})},Eden.DB.getPopularTags=function(a,b){$.ajax({url:this.remoteURL+"/project/tags?tag="+a,type:"get",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){null===a||a.error?(console.error(a),Eden.DB.emit("error",[a?a.description:"No response from server"]),b&&b(!1)):b&&b(a)},error:function(a,c,d){Eden.DB.handleError(a,c,d),b&&b(!1)}})},function(){function a(a,b){return root.lookup("view_"+a+"_"+b)}function b(a){return $("#"+a+"-dialog")}EdenUI.prototype.menuBarHeight=45,EdenUI.prototype.dialogBorderWidth=1,EdenUI.prototype.titleBarHeight=0,EdenUI.prototype.largeTitleBar=41.22+EdenUI.prototype.dialogBorderWidth,EdenUI.prototype.scrollBarSize=14+EdenUI.prototype.dialogBorderWidth,EdenUI.prototype.scrollBarSize2=window.innerHeight-$(window).height(),EdenUI.prototype.dialogFrameWidth=2*EdenUI.prototype.dialogBorderWidth,EdenUI.prototype.dialogFrameHeight=EdenUI.prototype.titleBarHeight+EdenUI.prototype.dialogBorderWidth,EdenUI.prototype.bottomBarHeight=34.906,EdenUI.prototype.gridSizeX=Math.floor(30*window.innerWidth/1920),EdenUI.prototype.gridSizeY=Math.floor(30*window.innerHeight/1920),EdenUI.prototype.minimumWindowWidthShowing=72+EdenUI.prototype.dialogBorderWidth,EdenUI.prototype.createEmbedded=function(a,b){if(this.embeddedInstances[a])return this.embeddedInstances[a];var c;return edenUI.views[b].embed?c=edenUI.views[b].embed(a,a,""):edenUI.views[b].embedded&&(c=edenUI.views[b].embedded(a,a,"")),c?(this.embeddedInstances[a]=c,c):void 0},EdenUI.prototype.createView=function(c,d,e){function f(a){return"view_"+c+"_"+a}function g(a,b){n.resizeView(c)}function h(a,b){n.moveView(c)}function i(a,b){var d=z.dialogExtend("state");"hidden"==b?"minimized"!=d&&n.minimizeView(c):"maximized"==b||z.dialog("isOpen")&&"minimized"!=d&&"collapsed"!=d||n.showView(c)}function j(a,b){var c=b;void 0!==w.titleBarInfo&&(c=c+" ("+w.titleBarInfo+")"),z.dialog("option","title",c),edenUI.menu.updateViewsMenu()}function k(a,b){lockVal=b,b?(z.siblings(".ui-dialog-titlebar").css("display","none"),z.dialog("option","resizable",!1),n.resizeView(c)):(z.siblings(".ui-dialog-titlebar").css("display","block"),z.dialog("option","resizable",!0),n.resizeView(c))}function l(a,b){var c=z.get(0).parentNode.style;b?(c.border="none",c.boxShadow="none"):(c.border="1px solid #777",c.boxShadow="0 0 15px #4a6887")}function m(a,b){b?n.pinView(c):n.unpinView(c)}if(!(d in this.views))return void this.eden.error(new Error("View type "+d+" is unavailable.  Check that the associated plug-in is loaded."));"name"in this.views[d]&&(c=this.views[d].name);var n=this,o=Symbol.defaultAgent,p=this.activeDialogs[c],q=a(c,"visibility"),r=q.value(),s=a(c,"title"),t=s.value();if(p==d)return"visible"!=r&&q.assign("visible",root.scope,o),this.brieflyHighlightView(c),this.viewInstances[c];this.eden.root.beginAutocalcOff(),void 0!==p&&(t==this.views[p].title&&(t=void 0),this.destroyView(c,!1)),this.titleBarHeight="ScriptView"==p?this.largeTitleBar:this.titleBarHeight;var u=this.menuBarHeight,v=this.views[d].title,w=this.views[d].dialog(c+"-dialog",v);void 0===w&&(w={}),this.viewInstances[c]=w;var x,y=(w.position,edenUI.getOptionValue("optCollapseToTitleBar"));x="true"==y?"collapse":"maximize";var z=b(c);z.dialog({closeOnEscape:!1,position:{using:function(){}},beforeClose:function(){return w.closing?(w.closing=!1,!0):n.closeView(c)},focus:function(){}});var A=[f("type"),f("x"),f("y"),f("width"),f("height"),f("lock"),f("noborder"),f("title"),f("visibility")];z.get(0).setAttribute("data-observables",A.join(","));var B=this.getDialogWindow(c);z.dialogExtend({dblclick:x,minimizable:!0,maximizable:!0,beforeMinimize:function(a){return $(a.target).parent().removeClass("window-activated"),n.hideView(c),!1},minimize:function(){var a=b(c).data("dialog-extend-minimize-controls");a.css("position","relative"),a.css("top",""),a.css("left","")},maximize:function(a){var b=B[0],c=z[0];b.style.top=u+"px";var d=window.innerHeight-u-n.scrollBarSize2-2*n.dialogBorderWidth;"true"!=edenUI.getOptionValue("optHideOnMinimize")&&(d-=n.bottomBarHeight),b.style.height=d+"px",c.style.height=d-n.titleBarHeight+"px"},restore:function(a){z.dialog("moveToTop"),n.brieflyHighlightView(a.target.id.slice(0,-7)),z.dialog("widget").draggable("option","containment",[-Number.MAX_VALUE,u,Number.MAX_VALUE,Number.MAX_VALUE])}}),this.activeDialogs[c]=d;var C=a(c,"type");C.value()!=d&&(C.removeJSObserver("changeType"),C.assign(d,root.scope,Symbol.localJSAgent),C.addJSObserver("changeType",function(a,b){void 0!==b&&-1!==root.lookup("views_list").value().indexOf(c)&&n.createView(c,b)}));var D=root.lookup("views_list"),E=D.value();Array.isArray(E)?-1===E.indexOf(c)&&(E=E.slice(),E.push(c),D.assign(E,root.scope,Symbol.localJSAgent)):D.assign([c],root.scope,Symbol.localJSAgent);var F=a(c,"lock"),G=F.value();widthSym=a(c,"width"),widthSym.addJSObserver("plugins",g),widthSym.definition||void 0!==widthSym.value()||widthSym.assign(z.dialog("option","width"),root.scope,o);var H=a(c,"height");H.addJSObserver("plugins",g),H.definition||void 0!==H.value()||H.assign(z.dialog("option","height")-(G?0:this.titleBarHeight),root.scope,o),g();var I=z.closest(".ui-dialog").position(),J=a(c,"x");J.addJSObserver("plugins",h),J.definition||void 0!==J.value()||J.assign(I.left,root.scope,o);var K=a(c,"y");K.addJSObserver("plugins",h),K.definition||void 0!==K.value()||K.assign(I.top,root.scope,o),h(),"visible"!=r&&(void 0===r?q.assign("visible",root.scope,o):i(q,r)),q.addJSObserver("changeState",i);var L=w.titleBarInfo;delete w.titleBarInfo,Object.defineProperty(w,"titleBarInfo",{get:function(){return L},set:function(a){L=a;var b=s.value();void 0!==a&&(b=b+" ("+a+")"),z.dialog("option","title",b)},enumerable:!0}),s.addJSObserver("updateTitleBar",j),void 0===t?s.assign(v,root.scope,o):j(s,t),F.addJSObserver("changeState",k),void 0!==G&&k(F,G);var M=a(c,"noborder");M.addJSObserver("changeState",l);var N=M.value();void 0!==N&&l(M,N);var O=a(c,"pin");O.addJSObserver("changeState",m);var P=O.value();return void 0!==P?m(O,P):this.unpinView(c),z.dialog("widget").draggable("option","containment",[-Number.MAX_VALUE,u,Number.MAX_VALUE,Number.MAX_VALUE]),z.resizeExtend=0,z.on("dialogresizestop",function(b,d){z.previousWidth=void 0,z.momentum=0,z.resizeExtend=0;var e=a(c,"width"),f=a(c,"height"),g=n.eden.root;g.beginAutocalcOff(),e.assign(d.size.width,g.scope,Symbol.hciAgent),f.assign(d.size.height-n.titleBarHeight,g.scope,Symbol.hciAgent),g.endAutocalcOff()}),z.on("dialogdragstop",function(b,d){var e=n.eden.root;e.beginAutocalcOff(),console.log(d),a(c,"x").assign(d.position.left,eden.root.scope,Symbol.hciAgent),a(c,"y").assign(d.position.top,eden.root.scope,Symbol.hciAgent),e.endAutocalcOff()}),z.on("dialogdragstart",function(){if(a(c,"x").definition||a(c,"y").definition)return!1}),z.on("dialogresizestart",function(){if(a(c,"width").definition||a(c,"height").definition)return!1}),this.eden.root.endAutocalcOff(),this.emit("createView",[c,d]),a(c,"nostack").value()?z.get(0).parentNode.className+=" ui-back":z.get(0).parentNode.className+=" ui-front",w},EdenUI.prototype.closeView=function(a){return this.hideView(a),edenUI.eden.root.collectGarbage(),!0},EdenUI.prototype.destroyAllViews=function(){for(var a in this.viewInstances)this.destroyView(a,!0)},EdenUI.prototype.destroyView=function(a,c){if(a in this.viewInstances&&!this.viewInstances[a].closing){this.viewInstances[a].closing=!0,this.viewInstances[a].destroy&&this.viewInstances[a].destroy(),root.forgetAll("^View_"+a+"_",!0,!1,!0),c?root.forgetAll("^view_"+a+"_",!0,!1,!0):root.lookup("view_"+a+"_title").removeJSObserver("updateTitleBar");var d=b(a);if(d.dialog("destroy"),d.remove(),d.html(""),delete this.activeDialogs[a],delete this.viewInstances[a],c){var e=root.lookup("views_list"),f=e.value();if(Array.isArray(f)){var g=f.indexOf(a);if(-1!==g){var h;0==g?h=f.slice(1):(f.splice(g,1),h=f),e.assign(h,root.scope,Symbol.hciAgent)}}}this.emit("destroyView",[a])}},EdenUI.prototype.getDialogContent=function(a){return b(a)},EdenUI.prototype.getDialogWindow=function(a){return b(a).parent()},EdenUI.prototype.showView=function(a){var c=b(a);c.dialog("open").dialog("moveToTop");var d=c.dialogExtend("state");return"normal"!=d&&"maximized"!=d&&c.dialogExtend("restore"),this.activeDialogs[a]},EdenUI.prototype.updateView=function(a,b){var c=this.viewInstances[a];c&&c.update&&c.update(b)},EdenUI.prototype.highlightView=function(a,b){if(b)this.windowHighlighter.highlight(a);else{(this.getDialogContent(a).data("dialog-extend-minimize-controls")||this.getDialogWindow(a)).addClass("window-highlighted")}},EdenUI.prototype.stopHighlightingView=function(a,b,c){if(b)this.windowHighlighter.stopHighlight(a,c),c&&this.getDialogContent(a).dialog("moveToTop");else{(this.getDialogContent(a).data("dialog-extend-minimize-controls")||this.getDialogWindow(a)).removeClass("window-highlighted")}},EdenUI.prototype.brieflyHighlightView=function(a){var b=this.getDialogWindow(a);b.addClass("window-activated"),setTimeout(function(){b.removeClass("window-activated")},600)},EdenUI.prototype.hideView=function(a){a in this.viewInstances&&(this.viewInstances[a].closing=!0,b(a).dialog("close"))},EdenUI.prototype.minimizeView=function(a){if("true"==edenUI.getOptionValue("optHideOnMinimize"))this.hideView(a);else{if(!(a in this.viewInstances))return;b(a).dialogExtend("minimize")}},EdenUI.prototype.minimizeObscuredViews=function(a){if("true"!=edenUI.getOptionValue("optHideOnMinimize")){var c=b(a),d=c.closest(".ui-dialog");if(!d.is(this.windowHighlighter.lastDialog)&&"normal"==c.dialogExtend("state"))for(var e=c.get(0),f=d.position(),g=f.left,h=f.top,i=c.dialog("option","width")+2*EdenUI.prototype.dialogBorderWidth,j=c.dialog("option","height")+2*EdenUI.prototype.dialogBorderWidth,k=d.hasClass("ui-top"),l=$(".ui-dialog-content"),m=0;m<l.length;m++){var n=$(l[m]);if(l[m]!==e&&"normal"==n.dialogExtend("state")){var o=n.closest(".ui-dialog");if(!o.hasClass("ui-front")||k){var p=o.position(),q=p.left,r=p.top,s=n.dialog("option","width")+2*EdenUI.prototype.dialogBorderWidth,t=n.dialog("option","height")+2*EdenUI.prototype.dialogBorderWidth;q>=g-0&&q+s<=g+i+0&&r>=h-0&&r+t<=h+j+0&&n.dialogExtend("minimize")}}}}},EdenUI.prototype.moveView=function(c){var d,e,f=b(c),g=a(c,"x"),h=a(c,"y"),i=g.value(),j=h.value(),k=this.minimumWindowWidthShowing-f.dialog("option","width");d=i<k?k:i,e=j<0?0:j;var l=f.parent().get(0);l.style.left=d+"px",l.style.top=e+"px"},EdenUI.prototype.resizeView=function(c){var d=this.viewInstances[c];if(!d.resizing){var e=b(c),f=e.parent().position(),g=f.left,h=f.top,i=a(c,"width"),j=i.value(),k=a(c,"height"),l=k.value()+this.titleBarHeight,m=a(c,"lock"),n=(m||this.titleBarHeight,this.scrollBarSize,this.dialogBorderWidth,this.titleBarHeight,window.innerWidth,document.body.scrollLeft,window.innerHeight+document.body.scrollTop-this.scrollBarSize2);this.bottomBarHeight,Symbol.hciAgent.name;i.origin!==Symbol.hciAgent&&e.dialog("option","width",j),k.origin!==Symbol.hciAgent&&e.dialog("option","height",l),"resize"in d&&d.resize(j,l)}},EdenUI.prototype.pinView=function(a){var b=this.getDialogWindow(a);b.removeClass("ui-front"),b.addClass("ui-top"),this.viewInstances[a].pinned=!0},EdenUI.prototype.unpinView=function(a){var b=this.getDialogWindow(a);this.viewInstances[a].pinned&&(b.removeClass("ui-top"),b.get(0).style.zIndex=9999,b.addClass("ui-front"),this.viewInstances[a].pinned=!1,this.windowHighlighter.unpin(b))},EdenUI.prototype.newProject=function(){this.eden.reset(),this.destroyView("jspe",!0),"Canvas2D"in this.plugins&&this.eden.executeEden('createCanvas("picture");',"new project","",Symbol.hciAgent,noop),"ScriptInput"in this.plugins&&this.eden.executeEden('createView("input", "ScriptInput");',"new project","",Symbol.hciAgent,noop),this.views.ErrorLog.errorWindow&&this.views.ErrorLog.errorWindow.html(""),Eden.Agent.removeAll()},EdenUI.prototype.modalDialog=function(a,b,c,d,e){var f=$('<div id="modal"></div>'),g=function(a){return function(b){f.dialog("destroy"),f.remove(),e(a)}},h=$("<div>"+b+"</div>");f.append(h);for(var i=[],j=0;j<c.length;j++){var k={text:c[j],click:g(j)};i.push(k)}var l=c.length,m={text:"Cancel",click:g(l)};i.push(m),f.dialog({buttons:i,modal:!0,resizable:!1,show:"fade",title:a,close:function(){e(l)},open:function(){$(this).parent().find("button")[d].focus()},width:375}),$(".ui-widget-overlay").css("z-index",10001),f.parent().css("z-index",10002)}}(),URLUtil={},URLUtil.getParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=window.location.href,e=c.exec(d);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},URLUtil.getParameters=function(){var a=window.location.href,b=a.split("?")[1];if(!b)return{};for(var c=b.split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("=");void 0===d[f[0]]&&(d[f[0]]=[]),f.length>1&&d[f[0]].push(decodeURIComponent(f[1]))}return d},URLUtil.getArrayParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");for(var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b,"g"),d=window.location.href,e=c.exec(d),f=[];null!==e;){var g=decodeURIComponent(e[1].replace(/\+/g," "));f.push(g),e=c.exec(d)}return f},URLUtil.isCrossDomain=function(a){var b=a.match(/^([a-zA-Z][a-zA-Z\d+.\-]*:)(\/\/)?([^\/@]*@)?([^\/:]+)(:\d+)?(\/|$)/);return null!==b&&(b[1]!=window.location.protocol||b[4]!=document.domain||b[5].slice(1)!=window.location.port)},URLUtil.downloadFile=function(a){var b=a.url,c=a.dataType,d=a.sync,e=a.success,f=a.error;if(void 0===c&&(c="text"),"function"!=typeof f)throw new Error("An error handling function must be specified.");if("function"!=typeof e)return void f(null,"error","A success callback function must be specified.");if(void 0===b)return void f(null,"error","A URL must be specified.");b=String(b);var g=rt.config.proxyBaseURL,h=this.isCrossDomain(b);if(!0===d&&h&&this.isCrossDomain(g))return void f(null,"error","Synchronous downloading not possible");if("boolean"!=typeof d)return void f(null,"error","The sync option must be a boolean, not a "+typeof d);if(h){var i="crossDomainCallback"+Math.floor(9007199254740991*Math.random());return window[i]=function(a){try{if(a.success){var b,d=a.success,g=!1;switch(c){case"text":b=d;break;case"json":try{b=JSON.parse(d)}catch(a){f(null,"parserror",a),g=!0}break;default:f(null,"error","No cross-domain interpretation available for data type "+c),g=!0}g||e(b,"success",null)}else f(null,"error",a.error)}finally{delete window[i]}},$.ajax({url:g+"?url="+encodeURI(b)+"&callback="+i,dataType:"script",async:!d,error:f})}return a.async=!d,$.ajax(a)};var root,eden,edenUI,doneLoading;"isInteger"in Number||(Number.isInteger=function(a){return parseInt(a)===a});var doingNavigateAway=!1,confirmUnload=function(a){if(!doingNavigateAway){eden.project.localSave();var b="Leaving this page will discard the current script. Your work will not be saved.";return a.returnValue=b,b}};EdenStream.prototype.pushPosition=function(){this.position_stack.push(this.position)},EdenStream.prototype.popPosition=function(){this.position=this.position_stack.pop()},EdenStream.prototype.discardPosition=function(){this.position_stack.pop()},EdenStream.prototype.get=function(){return this.position<this.code.length?this.code.charCodeAt(this.position++):0},EdenStream.prototype.peek=function(){return this.position<this.code.length?this.code.charCodeAt(this.position):0},EdenStream.prototype.peek2=function(){return this.position+1>=this.code.length?0:this.code.charCodeAt(this.position+1)},EdenStream.prototype.peek3=function(){return this.position+2>=this.code.length?0:this.code.charCodeAt(this.position+2)},EdenStream.prototype.readLine=function(){var a=this.code.indexOf("\n",this.position);if(-1==a){var b=this.code.substring(this.position);return this.position=this.code.length,b}var b=this.code.substring(this.position,a+1);return this.position=a+1,this.line++,b},EdenStream.prototype.peekLine=function(){var a=this.code.indexOf("\n",this.position);if(-1==a){var b=this.code.substring(this.position);return b}var b=this.code.substring(this.position,a+1);return b},EdenStream.prototype.move=function(a){this.position=a},EdenStream.prototype.reset=function(){this.position=0,this.position_stack=[0],this.prevposition=0,this.line=1},EdenStream.prototype.tokenText=function(){return this.code.substr(this.prevposition,this.position-this.prevposition)},EdenStream.prototype.isBEOL=function(){if(10==this.peek2())return!0;for(var a=this.prevposition-1,b=this.code.charCodeAt(a);9==b||32==b;)a--,b=this.code.charCodeAt(a);return 10==b},EdenStream.prototype.skip=function(){this.position++},EdenStream.prototype.eof=function(){return this.position>=this.code.length},EdenStream.prototype.valid=function(){return this.position<this.code.length},EdenStream.prototype.unget=function(){this.position--},EdenStream.prototype.skipWhiteSpace=function(){for(;this.valid();){var a=this.peek();if(10==a&&this.line++,9!=a&&10!=a&&13!=a&&32!=a&&160!=a)break;this.skip()}},EdenStream.prototype.skipLine=function(){for(;this.valid()&&10!=this.peek();)this.skip()},EdenStream.prototype.isAlphaNumeric=function(a){return a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||95==a||a>=128||36==a},EdenStream.prototype.isNumeric=function(a){return a>=48&&a<=57},EdenStream.prototype.tokenType=function(a){return"OBSERVABLE"==a?"identifier":"JAVASCRIPT"==a?"javascript":"NUMBER"==a?"number":"STRING"==a?"string":"CHARACTER"==a?"character":"BOOLEAN"==a?"boolean":"string"!=typeof a?(console.error(a),"INVALID"):this.isAlphaNumeric(a.charCodeAt(0))?"keyword":"("==a||"["==a||"{"==a?"openbracket":")"==a||"]"==a||"}"==a?"closebracket":","==a||"."==a||";"==a||":"==a?"separator":"operator"},EdenStream.prototype.parseAlphaNumeric=function(a){var b="";if(0==this.isAlphaNumeric(this.peek()))return!1;for(;this.valid()&&this.isAlphaNumeric(this.peek());)b+=String.fromCharCode(this.get());return a.value=b,!0},EdenStream.prototype.parseString=function(a,b){for(var c="";this.valid()&&this.peek()!=b;){var d=String.fromCharCode(this.get());if("\n"==d)return this.unget(),a.error=!0,void(a.value="LINEBREAK");"\\"==d?(d=String.fromCharCode(this.get()),c+="\\"+d):c+=d}this.valid()&&this.peek()==b?(this.skip(),a.error=!1):a.error=!0,a.value=c},EdenStream.prototype.parseCharacter=function(a){var b=String.fromCharCode(this.get());if("'"==b)return a.value="",void(a.error=!0);"\\"==b&&(b=String.fromCharCode(this.get())),a.value=b,this.valid()&&39==this.peek()?this.skip():a.error=!0},EdenStream.prototype.parseNumber=function(a){for(var b="";this.valid()&&this.isNumeric(this.peek());)b+=String.fromCharCode(this.get());if(46==this.peek()&&this.isNumeric(this.peek2()))for(this.skip(),b+=".";this.valid()&&this.isNumeric(this.peek());)b+=String.fromCharCode(this.get());a.value=parseFloat(b)},EdenStream.prototype.readToken=function(a){if(this.prevline=this.line,this.skipWhiteSpace(),this.prevposition=this.position,this.eof())return"EOF";var b=this.code.charCodeAt(this.position);switch(this.position++,b){case 33:return 61==this.peek()?(this.skip(),"!="):126==this.peek()?(this.skip(),"!~"):"!";case 34:return a?'"':(this.parseString(this.data,34),"STRING");case 35:return 35==this.peek()?(this.skip(),"##"):"#";case 36:if(123==this.peek()&&123==this.peek2())return this.skip(),this.skip(),"${{";break;case 37:return"%";case 38:return 38==this.peek()?(this.skip(),"&&"):61==this.peek()?(this.skip(),"&="):"&";case 39:return a?"'":(this.parseString(this.data,39),"STRING");case 40:return"(";case 41:return")";case 42:return 61==this.peek()?(this.skip(),"*="):47==this.peek()?(this.skip(),"*/"):"*";case 43:return 43==this.peek()?(this.skip(),"++"):61==this.peek()?(this.skip(),"+="):"+";case 44:return",";case 45:return 45==this.peek()?(this.skip(),"--"):61==this.peek()?(this.skip(),"-="):"-";case 46:return 46==this.peek()?(this.skip(),".."):".";case 47:return 47==this.peek()&&61==this.peek2()?(this.skip(),"//="):47==this.peek()?(this.skip(),"//"):61==this.peek()?(this.skip(),"/="):42==this.peek()?(this.skip(),"/*"):"/";case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.unget(),this.parseNumber(this.data),"NUMBER";case 58:return 58==this.peek()?(this.skip(),"::"):":";case 59:return";";case 60:return 60==this.peek()?(this.skip(),"<<"):61==this.peek()?(this.skip(),"<="):"<";case 61:return 61==this.peek()?(this.skip(),"=="):126==this.peek()?(this.skip(),"=~"):"=";case 62:return 62==this.peek()?(this.skip(),">>"):61==this.peek()?(this.skip(),">="):">";case 63:return"?";case 64:return"@";case 91:return"[";case 92:return'"';case 93:return"]";case 94:return"^";case 96:return"`";case 123:return"{";case 124:return 124==this.peek()?(this.skip(),"||"):61==this.peek()?(this.skip(),"|="):"|";case 125:return 125==this.peek()&&36==this.peek2()?(this.skip(),this.skip(),"}}$"):"}";case 126:return 62==this.peek()?(this.skip(),"~>"):"~"}if(this.unget(),this.parseAlphaNumeric(this.data))return Language.keywords.hasOwnProperty(this.data.value)?Language.keywords[this.data.value]:Language.values.hasOwnProperty(this.data.value)?(this.data.value=Language.values[this.data.value],"BOOLEAN"):"OBSERVABLE";throw this.skip(),new Error("Invalid Token: "+b)},"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.EdenStream=EdenStream,exports.EdenSyntaxData=EdenSyntaxData),Eden.SyntaxError=function(a,b,c){this.type="syntax",this.context=a,this.errno=b,this.extra=c,this.token=a.token,this.prevtoken=a.previous,this.line=a.stream.prevline,this.position=a.stream.position,this.prevposition=a.stream.prevposition},Eden.SyntaxError.UNKNOWN=0,Eden.SyntaxError.EXPCLOSEBRACKET=1,Eden.SyntaxError.BADFACTOR=2,Eden.SyntaxError.ACTIONCOLON=3,Eden.SyntaxError.ACTIONNOWATCH=4,Eden.SyntaxError.ACTIONCOMMAS=5,Eden.SyntaxError.ACTIONOPEN=6,Eden.SyntaxError.ACTIONCLOSE=7,Eden.SyntaxError.LOCALNAME=8,Eden.SyntaxError.LOCALSEMICOLON=9,Eden.SyntaxError.WHENTYPE=10,Eden.SyntaxError.LISTINDEXEXP=11,Eden.SyntaxError.LISTINDEXCLOSE=12,Eden.SyntaxError.LVALUE=13,Eden.SyntaxError.SEMICOLON=14,Eden.SyntaxError.STATEMENT=15,Eden.SyntaxError.DEFINITION=16,Eden.SyntaxError.FUNCCALLEND=17,Eden.SyntaxError.LISTLITCLOSE=18,Eden.SyntaxError.TERNIFCOLON=19,Eden.SyntaxError.IFCONDOPEN=20,Eden.SyntaxError.IFCONDCLOSE=21,Eden.SyntaxError.PARAMNAME=22,Eden.SyntaxError.PARAMSEMICOLON=23,Eden.SyntaxError.FUNCOPEN=24,Eden.SyntaxError.FUNCCLOSE=25,Eden.SyntaxError.FUNCNAME=26,Eden.SyntaxError.FOROPEN=27,Eden.SyntaxError.FORCLOSE=28,Eden.SyntaxError.FORSTART=29,Eden.SyntaxError.FORCOND=30,Eden.SyntaxError.SUBSCRIBEOPEN=31,Eden.SyntaxError.SUBSCRIBECLOSE=32,Eden.SyntaxError.SWITCHOPEN=33,Eden.SyntaxError.SWITCHCLOSE=34,Eden.SyntaxError.DEFAULTCOLON=35,Eden.SyntaxError.CASELITERAL=36,Eden.SyntaxError.CASECOLON=37,Eden.SyntaxError.INSERTCOMMA=38,Eden.SyntaxError.DELETECOMMA=39,Eden.SyntaxError.APPENDCOMMA=40,Eden.SyntaxError.SCOPENAME=41,Eden.SyntaxError.SCOPEEQUALS=42,Eden.SyntaxError.SCOPECLOSE=43,Eden.SyntaxError.BACKTICK=44,Eden.SyntaxError.WHILEOPEN=45,Eden.SyntaxError.WHILECLOSE=46,Eden.SyntaxError.WHILENOSTATEMENT=47,Eden.SyntaxError.NEGNUMBER=48,Eden.SyntaxError.DEFINELISTIX=49,Eden.SyntaxError.OUTOFBOUNDS=50,Eden.SyntaxError.PROPERTYNAME=51,Eden.SyntaxError.WHILEOFDO=52,Eden.SyntaxError.PARAMNUMBER=53,Eden.SyntaxError.AFTEROPEN=55,Eden.SyntaxError.AFTERCLOSE=56,Eden.SyntaxError.ACTIONNAME=57,Eden.SyntaxError.WHENOPEN=58,Eden.SyntaxError.WHENCLOSE=59,Eden.SyntaxError.DONAME=60,Eden.SyntaxError.PROCNAME=61,Eden.SyntaxError.IMPORTPATH=62,Eden.SyntaxError.IMPORTOPTION=63,Eden.SyntaxError.IMPORTCOMB=64,Eden.SyntaxError.IFNOSTATEMENT=65,Eden.SyntaxError.AFTERNOSTATEMENT=66,Eden.SyntaxError.WHENNOSTATEMENT=67,Eden.SyntaxError.LITCHAREMPTY=68,Eden.SyntaxError.LITCHARCLOSE=69,Eden.SyntaxError.LITSTRLINE=70,Eden.SyntaxError.LITSTRCLOSE=71,Eden.SyntaxError.IMPORTTAG=72,Eden.SyntaxError.SWITCHSCRIPT=73,Eden.SyntaxError.RANGEBANNED=74,Eden.SyntaxError.HEREDOCTOKEN=75,Eden.SyntaxError.SELECTORACTION=76,Eden.SyntaxError.SELECTORATTRIB=77,Eden.SyntaxError.SELECTORTAG=78,Eden.SyntaxError.SELECTORBTICK=79,Eden.SyntaxError.SELECTOROPTION=80,Eden.SyntaxError.QUERYOPEN=81,Eden.SyntaxError.QUERYCLOSE=82,Eden.SyntaxError.QUERYSELECTOPEN=83,Eden.SyntaxError.QUERYSELECTCLOSE=84,Eden.SyntaxError.QUERYSELECTCOMMA=85,Eden.SyntaxError.BLOCKCOMMENT=86,Eden.SyntaxError.NEWLINE=87,Eden.SyntaxError.db=[{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return"}"==this.token||"]"==this.token?0:";"==this.token?1:2},suggestion:{expected:[")"],next:[";","+","-","==","<=",">=","!=","/","*","%","^"]}},{message:function(){if("{"==this.token)return 0;if(")"==this.token){return"operator"==this.context.stream.tokenType(this.prevtoken)?3:1}var a=this.context.stream.tokenType(this.token);return"keyword"==a?4:"operator"==a?3:2},suggestion:{expected:["NUMBER","STRING","OBSERVABLE","&","!","("],next:["NUMBER","STRING","OBSERVABLE","&","!","(",";","+","-","==","<=",">=","!=","/","*","%","^"]}},{message:function(){return"{"==this.token?1:"OBSERVABLE"==this.token?0:"keyword"==this.context.stream.tokenType(this.token)?3:2},suggestion:{expected:[":"],next:["OBSERVABLE"]}},{message:function(){if("{"==this.token)return 2;if("("==this.token)return 3;if("["==this.token&&(":"==this.prevtoken||","==this.prevtoken))return 6;if("NUMBER"==this.token||"STRING"==this.token)return 4;if(","==this.token)return 5;var a=this.context.stream.tokenType(this.token);return"keyword"==a?0:1},suggestion:{expected:["OBSERVABLE"],next:[",","{"]}},{message:function(){return"{"==this.token?0:"("!=this.token||this.context.stream.isBEOL()?"keyword"==this.context.stream.tokenType(this.token)?2:3:1},suggestion:{expected:["OBSERVABLE"],next:[",","{"]}},{message:function(){if(("("==this.token||"["==this.token)&&this.context.stream.isBEOL())return 6;if("("==this.token)return 0;if("["==this.token)return 1;if(";"==this.token)return 2;var a=this.context.stream.tokenType(this.token);return"keyword"==a||"identifier"==a?3:"separator"==a?4:5},suggestion:{expected:["{"],next:["local","OBSERVABLE","if","for","switch","while","return"]}},{message:function(){return(")"==this.token||"]"==this.token)&&this.context.stream.isBEOL()?0:1},suggestion:{expected:["}"],next:["proc","func","if","for","OBSERVABLE","switch","while","return","continue","break"]}},{message:function(){return"keyword"==this.context.stream.tokenType(this.token)?0:";"==this.token?1:2},suggestion:{expected:["OBSERVABLE"],next:[";"]}},{message:function(){return"is"==this.token||"="==this.token?1:0},suggestion:{expected:[";"],next:["local","OBSERVABLE","if","for","switch","while","return"]}},{message:function(){return 0},suggestion:{expected:["touch","change","("],next:["OBSERVABLE",":","NUMBER","STRING","!","&"]}},{message:function(){return 0},suggestion:{expected:["(","OBSERVABLE","NUMBER"],next:["]","OBSERVABLE","NUMBER","+","-","/","*","%","^"]}},{message:function(){return 1},suggestion:{expected:["]"],next:["[",".","=","+=","-=","==","+","-","/","*",";","/=","*=","%","^","is"]}},{message:function(){return 0},suggestion:{expected:["OBSERVABLE"],next:[".","[","is","=","+=","-=","++","--","*=","/="]}},{message:function(){if("."==this.token){
var a=this.position>=2?this.context.stream.code.charCodeAt(this.position-2):0;return"NUMBER"==this.prevtoken&&32!=a&&160!=a?1:2}return"OBSERVABLE"==this.token?this.context.stream.isBEOL()?3:4:0},suggestion:{expected:[";"],next:["proc","when","OBSERVABLE","if","for","while","EOF","switch","func"]}},{message:function(){return 0},suggestion:{expected:["proc","func","when","if","for","while","switch","OBSERVABLE","{"],next:["OBSERVABLE","(","change","touch","is","=","+=","-=","*=","proc","func","when","if","for","while","switch"]}},{message:function(){return 0},suggestion:{expected:["=","is","+=","-=","/=","*="],next:["(","OBSERVABLE","NUMBER","STRING","!"]}},{message:function(){return 0},suggestion:{expected:[")"],next:[";","(","[","+","-","/","*","%","^"]}},{message:function(){return 0},suggestion:{expected:["]"],next:[]}},{message:function(){return 0},suggestion:{expected:[":"],next:[]}},{message:function(){return 0},suggestion:{expected:["("],next:[]}},{message:function(){return 0},suggestion:{expected:[")"],next:[]}},{message:function(){return 0},suggestion:{expected:["OBSERVABLE"],next:[";"]}},{message:function(){return 0},suggestion:{expected:[";"],next:["para","local","OBSERVABLE","if","for","switch","while","return"]}},{message:function(){if(("("==this.token||"["==this.token)&&this.context.stream.isBEOL())return 6;if("("==this.token)return 0;if("["==this.token)return 1;if(";"==this.token)return 2;var a=this.context.stream.tokenType(this.token);return"keyword"==a||"identifier"==a?3:"separator"==a?4:5},suggestion:{expected:["{"],next:["local","OBSERVABLE","if","for","switch","while","return"]}},{message:function(){return 0},suggestion:{expected:["}"],next:[";"]}},{message:function(){return 0},suggestion:{expected:["OBSERVABLE"],next:["{"]}},{message:function(){return 0},suggestion:{expected:["("],next:[]}},{message:function(){return 0},suggestion:{expected:[")"],next:[]}},{message:function(){return 0},suggestion:{expected:[";"],next:[]}},{message:function(){return 0},suggestion:{expected:[";"],next:[]}},{message:function(){return 0},suggestion:{expected:["["],next:[]}},{message:function(){return 0},suggestion:{expected:["]"],next:[]}},{message:function(){return 0},suggestion:{expected:["("],next:[]}},{message:function(){return 0},suggestion:{expected:["]"],next:[]}},{message:function(){return 0},suggestion:{expected:[":"],next:[]}},{message:function(){return 0},suggestion:{expected:["NUMBER","STRING"],next:[]}},{message:function(){return 0},suggestion:{expected:[":"],next:[]}},{message:function(){return 0},suggestion:{expected:[","],next:[]}},{message:function(){return 0},suggestion:{expected:[","],next:[]}},{message:function(){return 0},suggestion:{expected:[","],next:[]}},{message:function(){return 0},suggestion:{expected:["OBSERVABLE"],next:[]}},{message:function(){return 0},suggestion:{expected:["="],next:[]}},{message:function(){return 0},suggestion:{expected:["}"],next:[]}},{message:function(){return 0},suggestion:{expected:["`"],next:[]}},{message:function(){return 0},suggestion:{expected:["("],next:[]}},{message:function(){return 0},suggestion:{expected:[")"],next:[]}},{message:function(){return 0},suggestion:{expected:[")"],next:[]}},{message:function(){return 0},suggestion:{expected:["NUMBER"],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){var a=this.context.stream.tokenType(this.token);return"keyword"==a?0:"boolean"==a||"character"==a||"string"==a||"number"==a?1:":"==this.token?4:"{"==this.token?5:"closebracket"==this.token?3:2},suggestion:{expected:["OBSERVABLE"],next:[":"]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}},{message:function(){return 0},suggestion:{expected:[],next:[]}}],Eden.SyntaxError.prototype.extractBefore=function(a){for(var b=this.prevposition;b>0&&a>0&&10!=this.context.stream.code.charCodeAt(b);)b--,a--;return 10==this.context.stream.code.charCodeAt(b)&&b++,this.context.stream.code.substr(b,this.prevposition-b)},Eden.SyntaxError.prototype.extractToken=function(){return this.context.stream.code.substr(this.prevposition,this.position-this.prevposition)},Eden.SyntaxError.prototype.extractAfter=function(a){for(var b=this.position;b<this.context.stream.code.length&&a>0&&10!=this.context.stream.code.charCodeAt(b);)b++,a--;return this.context.stream.code.substr(this.position,b-this.position)},Eden.SyntaxError.prototype.buildSuggestion=function(){var a=Eden.SyntaxError.db[this.errno].suggestion;return-1!=a.next.indexOf(this.token)?this.extractBefore(10)+a.expected[0]+" "+this.extractToken()+this.extractAfter(10):this.extractBefore(10)+a.expected[0]+" "+this.extractAfter(10)},Eden.SyntaxError.prototype.messageText=function(){var a=Eden.SyntaxError.db[this.errno],b=Language.errors[this.errno][a.message.call(this)];return void 0===this.extra?b:b+": "+this.extra},Eden.SyntaxError.prototype.prettyPrint=function(){this.context.stream.pushPosition(),this.context.stream.move(this.position);var a=Eden.SyntaxError.db[this.errno],b=Language.errors[this.errno][a.message.call(this)],c="Error:\n    "+b+"\n    Source : "+this.context.src+", line "+this.line+"\n    Code   : "+this.errno;return c+="\n    Here   : "+this.extractBefore(10)+">>> "+this.extractToken()+" <<<"+this.extractAfter(10),a.suggestion&&(c+="\n    Suggestion : "+this.buildSuggestion()),this.context.stream.popPosition(),c},Eden.SyntaxError.prototype.toString=function(){return this.prettyPrint()},Eden.RuntimeError=function(a,b,c,d){this.type="runtime",this.line=-1,this.statement=c,this.extra=d,this.errno=b,this.context=a,this.lastsymbol=eden.root.lastlookup,console.error(d)},Eden.RuntimeError.UNKNOWN=0,Eden.RuntimeError.ASSIGNEXEC=1,Eden.RuntimeError.FUNCCALL=2,Eden.RuntimeError.ACTIONNAME=3,Eden.RuntimeError.NOAGENT=4,Eden.RuntimeError.NOTSUPPORTED=5,Eden.RuntimeError.ASSIGNTODEFINED=6,Eden.RuntimeError.ASSIGNDIMENSION=7,Eden.RuntimeError.EXTENDSTATIC=8,Eden.RuntimeError.INFINITERANGE=9,Eden.RuntimeError.NOLISTRANGE=10,Eden.RuntimeError.LEFTCONCAT=11,Eden.RuntimeError.RIGHTCONCAT=12,Eden.RuntimeError.AGENTSOURCE=13,Eden.RuntimeError.JSOBSERVER=14,Eden.RuntimeError.PROCAGENT=15,Eden.RuntimeError.ARGUMENTS=16,Eden.RuntimeError.NOTCHILD=17,Eden.RuntimeError.prototype.messageText=function(){var a=!this.statement||"functioncall"!=this.statement.type&&"definition"!=this.statement.type&&"assignment"!=this.statement.type?"":"'"+this.statement.lvalue.name+"': ";switch(this.errno){case Eden.RuntimeError.ACTIONNAME:case Eden.RuntimeError.NOAGENT:case Eden.RuntimeError.NOTSUPPORTED:case Eden.RuntimeError.AGENTSOURCE:case Eden.RuntimeError.JSOBSERVER:case Eden.RuntimeError.PROCAGENT:case Eden.RuntimeError.ARGUMENTS:case Eden.RuntimeError.EXTENDSTATIC:return a+this.extra;case Eden.RuntimeError.ASSIGNTODEFINED:return a+"cannot assign to a defined list, use 'is'";case Eden.RuntimeError.ASSIGNDIMENSION:return a+"list does not have this many dimensions";case Eden.RuntimeError.RIGHTCONCAT:return a+"Concatenation: When the right hand side is a list then the left hand side must also be a list";case Eden.RuntimeError.LEFTCONCAT:return a+"Concatenation: When the left hand side is a list then the right hand side must also be a list";case Eden.RuntimeError.INFINITERANGE:return a+"range scope is infinite";case Eden.RuntimeError.NOLISTRANGE:return a+"range 'in' is not a list"}return String(this.extra).search("is not a function")>=0?a+"function used does not exist":this.errno==Eden.RuntimeError.FUNCCALL&&String(this.extra).search("Cannot read property 'call'")>=0?a+"procedure does not exist":String(this.extra).match(/Cannot read property .* of undefined/)?a+"uses an undefined list":this.extra},Eden.RuntimeError.prototype.edenSource=function(){if(this.statement)if("definition"==this.statement.type){var a=eden.root.symbols[this.statement.lvalue.name];if(a&&a.definition)return a.getSource()}else if(this.context)return this.context.getSource(this.statement)},Eden.RuntimeError.prototype.javascriptSource=function(){return this.statement.generate({scopes:[],dependencies:{}},"scope")},Eden.RuntimeError.prototype.details=function(){var a="";return"definition"!=this.statement.type&&"assignment"!=this.statement.type||(a+="Symbol: "+this.statement.lvalue.name+"\n"),String(this.extra).search("SyntaxError")>=0?a+="JavaScript: "+this.javascriptSource()+"\n":a+="Source: "+this.edenSource()+"\n",this.extra.message&&(a+="Original: "+this.extra.message+"\n"),a},Eden.RuntimeError.prototype.prettyPrint=function(){return this.extra&&this.extra.stack?"Run-time Error:\n"+this.extra.stack:"Run-time Error:\n"},Eden.Selectors={cache:{}},Eden.Selectors.getScriptBase=function(a){for(var b=a;b.parent;)b=b.parent;return b.base.origin.name},Eden.Selectors.buildScriptTree=function(a){for(var b={},c=0;c<a.length;c++)for(var d=a[c].split(/[\.\:]+/),e=b,f=0;f<d.length;f++)void 0===e[d[f]]&&(e[d[f]]={}),e=e[d[f]];return b},Eden.Selectors.getID=function(a){for(var b=a,c=[];b;)eden.project&&b===eden.project.ast.script?c.splice(0,0,":project"):"script"==b.type&&b.name?void 0===b.parent?c.splice(0,0,b.name+".id("+b.id+")"):c.splice(0,0,b.name):c.splice(0,0,".id("+b.id+")"),(b=b.parent)&&("script"==b.type&&b.parent&&"script"!=b.parent.type?b="codeblock"==b.parent.type?b.parent.parent:b.parent:"codeblock"==b.type&&(b=b.parent));return c.join(" > ")},Eden.Selectors.getPath=function(a){},Eden.Selectors.testType=function(a){if("binaryop"==a.type)switch(a.op){case"+":case"-":case"/":case"*":case"^":case"%":return"number";case"//":return"list";case"==":case"<":case">":case"<=":case">=":case"||":case"&&":case"!=":return"boolean";default:return"unknown"}else if("literal"==a.type)switch(a.datatype){case"NUMBER":return"number";case"BOOLEAN":return"boolean";case"STRING":return"string";case"LIST":return"list";default:return"unknown"}return"unknown"},Eden.Selectors.getChildren=function(a,b){var c=[];if(void 0===a)return c;for(var d=0;d<a.length;d++)if("script"==a[d].type)c.push.apply(c,a[d].statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].statements,b));else if("for"==a[d].type)a[d].statement&&"script"==a[d].statement.type&&(c.push.apply(c,a[d].statement.statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].statement.statements,b)));else if("if"==a[d].type)a[d].statement&&"script"==a[d].statement.type&&(c.push.apply(c,a[d].statement.statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].statement.statements,b))),a[d].elsestatement&&"script"==a[d].elsestatement.type&&(c.push.apply(c,a[d].elsestatement.statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].elsestatement.statements,b)));else if("when"==a[d].type)a[d].statement&&"script"==a[d].statement.type&&(c.push.apply(c,a[d].statement.statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].statement.statements,b)));else if("while"==a[d].type)a[d].statement&&"script"==a[d].statement.type&&(c.push.apply(c,a[d].statement.statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].statement.statements,b)));else if("do"==a[d].type)a[d].script&&"script"==a[d].script.type&&(c.push.apply(c,a[d].script.statements),b&&c.push.apply(c,Eden.Selectors.getChildren(a[d].script.statements,b)));else if("section"==a[d].type){for(var e=a[d].nextSibling,f=[];e&&("section"!=e.type||e.depth>a[d].depth);)"dummy"!=e.type&&(c.push(e),f.push(e)),e=e.nextSibling;b&&c.push.apply(c,Eden.Selectors.getChildren(f,b))}return c=c.filter(function(a){return"dummy"!=a.type})},Eden.Selectors.allowedOptions={external:!0,history:!0,all:!0,indexed:!0,index:!0,nosort:!0,remote:!0},Eden.Selectors.resultTypes={brief:!0,comment:!0,source:!0,innersource:!0,title:!0,path:!0,name:!0,symbol:!0,line:!0,depends:!0,value:!0,tags:!0,rawcomment:!0,id:!0,remote:!0,root:!0,enabled:!0,executed:!0,exprtree:!0},Eden.Selectors.expressionToLists=function(a){switch(a.type){case"binaryop":return[Eden.Selectors.expressionToLists(a.l),a.op,Eden.Selectors.expressionToLists(a.r)];case"ternaryop":return[Eden.Selectors.expressionToLists(a.first),"if",Eden.Selectors.expressionToLists(a.condition),"else",Eden.Selectors.expressionToLists(a.second)];case"unaryop":return[a.op,Eden.Selectors.expressionToLists(a.r)];case"length":return[Eden.Selectors.expressionToLists(a.l),"#"];case"index":return Eden.Selectors.expressionToLists(a.expression)}if(console.log(a),"functioncall"==a.type){console.log("FUNCCALL");for(var b=[],c=0;c<a.params.length;c++)b.push(Eden.Selectors.expressionToLists(a.params[c]));return["(",b,")"]}if("literal"==a.type)switch(a.datatype){case"NUMBER":case"STRING":case"BOOLEAN":return a.value;case"LIST":for(var b=[],c=0;c<a.value.length;c++)b.push(Eden.Selectors.expressionToLists(a.value[c]));return b}else if("primary"==a.type){if(0==a.extras.length)return a.observable;for(var d=[a.observable],c=0;c<a.extras.length;c++)d.push(Eden.Selectors.expressionToLists(a.extras[c]));return d}},Eden.Selectors.listsToExpression=function(a){if(!Array.isArray(a))return a;for(var b=[],c=0;c<a.length;c++)b.push(Eden.Selectors.listsToExpression(a[c]));return"("+b.join(" ")+")"},Eden.Selectors.processResults=function(a,b){if(void 0!==b){for(var c=Array.isArray(b)?b:b.split(","),d=[],e=0;e<a.length;e++){for(var f=a[e],g=[],h=0;h<c.length;h++){var i=void 0;switch(c[h]){case"brief":f.doxyComment&&(i=f.doxyComment.brief());break;case"comment":f.doxyComment&&(i=f.doxyComment.stripped());break;case"source":i=f.getSource();break;case"innersource":i="script"==f.type?f.getInnerSource():f.getSource();break;case"outersource":i=f.getOuterSource();break;case"exprtree":f.expression&&(i=Eden.Selectors.expressionToLists(f.expression));break;case"title":if(f.base&&f.base.mainDoxyComment){f.base.mainDoxyComment.stripped();var j=f.base.mainDoxyComment.getControls();j&&j["@title"]&&(i=j["@title"][0])}break;case"type":i=f.type;break;case"name":f.lvalue&&f.lvalue.name?i=f.lvalue.name:f.name&&"do"!=f.type?i=f.name:void 0===f.parent&&f.base&&f.base.origin?i=f.base.origin.name:void 0!==f.path&&(i=f.path);break;case"symbol":f.lvalue&&f.lvalue.name&&(i=f.lvalue.name);break;case"line":void 0!==f.line&&(i=f.line);break;case"depends":i=f.dependencies?Object.keys(f.dependencies):[];break;case"value":if(f instanceof Symbol)i=f.value();else try{i=f.expression?f.expression.execute({scopes:[]},eden.project.ast,eden.root.scope):void 0}catch(a){}break;case"active":i=f.lvalue&&eden.root.symbols[f.lvalue.name]&&eden.root.symbols[f.lvalue.name].origin&&eden.root.symbols[f.lvalue.name].origin.id==f.id;break;case"executed":i=f.executed>0;break;case"historic":i=-1==f.executed;break;case"tags":f.doxyComment&&(i=f.doxyComment.getHashTags());break;case"rawcomment":f.doxyComment&&(i=f.doxyComment.content);break;case"controls":case"id":i=f.id;break;case"path":i=Eden.Selectors.getID(f);break;case"remote":for(var k=f;k.parent;)k=k.parent;if(!k.base||!k.base.origin){i=!1;break}i=k.base.origin.remote;break;case"root":i=void 0===f.parent}g.push(i)}c.length>1?d.push(g):1==c.length&&g.length>0&&d.push(g[0])}return d}return a},Eden.Selectors.outerBracket=function(a){for(var b=0,c=0;c<a.length;c++)if("("==a.charAt(c))b++;else if(")"==a.charAt(c)&&0==--b)return c;return a.length},Eden.Selectors.makeRegex=function(a){return a="/"==a.charAt(0)?"/"==a.charAt(a.length-1)?a.substring(1,a.length-1):a.substring(1):"^"+a.replace(/([\\+^$.|(){[])/g,"\\$1").replace(/([*?])/g,".$1")+"$",new RegExp(a)},Eden.Selectors.SortNode=function(){this.type="sort",this.query=void 0},Eden.Selectors.DotNode=function(a){this.type="dot",this.label=a},Eden.Selectors.parse=function(a,b){var c=b;if(a&&""!=a){for(;a.length>0&&"@"==a.charAt(0);){c||(c={}),a=a.substring(1);var d=a.search(/[^a-z]+/);-1==d&&(d=a.length);var e=a.substring(0,d);a=a.substring(d).trim(),c[e]=!0}return Eden.Selectors._parse(a,c)}},Eden.Selectors._parse=function(a,b){var c;if(a&&""!=a){if(">"==a.charAt(0))">"==a.charAt(1)?(c=new Eden.Selectors.NavigateNode(">",!0),a=a.substring(2).trim()):(c=new Eden.Selectors.NavigateNode(">",!1),a=a.substring(1).trim());else if("<"==a.charAt(0))"<"==a.charAt(1)?(c=new Eden.Selectors.NavigateNode("<",!0),a=a.substring(2).trim()):(c=new Eden.Selectors.NavigateNode("<",!1),a=a.substring(1).trim());else if(","==a.charAt(0))c=new Eden.Selectors.UnionNode,a=a.substring(1).trim();else if(":"==a.charAt(0)||"."==a.charAt(0)){var d=a.substring(1),e=d.search(/[^a-zA-Z0-9\-]/);-1==e?e=a.length:e++;var f=a.substring(0,e),g=void 0;if(e<a.length&&"("==a.charAt(e)){var h=Eden.Selectors.outerBracket(a);g=a.substring(e+1,h),a=a.substring(h+1).trim()}else a=a.substring(e).trim();if(f.charAt(1).match(/[0-9]+/)){var i=parseInt(f.substring(1));c=new Eden.Selectors.PropertyNode(i)}else c=new Eden.Selectors.PropertyNode(f,g)}else if("^"==a.charAt(0)){var d=a.substring(1),e=d.search(/[^a-zA-Z0-9\-]/);-1==e&&(e=d.length);var f=d.substring(0,e),g=void 0;if(e<d.length&&"("==d.charAt(e)){var h=Eden.Selectors.outerBracket(d);g=d.substring(e+1,h),d=d.substring(h+1).trim()}else d=d.substring(e);c=new Eden.Selectors.SortNode,c.addSort(f),a=d.trim()}else if("#"==a.charAt(0)){var j=a.match(/#[a-zA-Z0-9_*?]+/);if(null===j)return;j=j[0],c=new Eden.Selectors.TagNode(j),a=a.substring(j.length).trim()}else if(a.charAt(0).match(/[a-zA-Z*?]+/)){var e=a.search(/[^a-zA-Z0-9_*?\s]+/);-1==e&&(e=a.length);var k=a.substring(0,e).trim();c=new Eden.Selectors.NameNode(k),a=a.substring(e).trim()}else if("/"==a.charAt(0)){for(var e=-1,l=1;l<a.length;l++){if("/"==a.charAt(l)){e=l+1;break}"\\"==a.charAt(l)&&l++}-1==e&&(e=a.length);var k=a.substring(0,e).trim();c=new Eden.Selectors.NameNode(k),a=a.substring(e).trim()}else a="";var m=Eden.Selectors._parse(a,b);if(c)return c.options=b,c.append(m)}},Eden.Selectors.unique=function(a){for(var b={},c=0;c<a.length;c++)b[a[c].id]=a[c];var d=[];for(var e in b)d.push(b[e]);return d},Eden.Selectors.sort=function(a){return a.sort(function(a,b){return b.stamp-a.stamp})},Eden.Selectors.queryWithin=function(a,b,c){var d=Eden.Selectors.parse(b),e=Eden.Selectors.unique(d.filter(a));return c?Eden.Selectors.processResults(e,c):e},Eden.Selectors.query=function(a,b,c,d){var e,f;if(c&&(e=c.context,f=c.minimum),"boolean"==typeof f&&console.trace("Bool"),"string"!=typeof a||""==a){var g=[];return d&&d(g),g}var h,i=Eden.Selectors.parse(a.trim(),c?c.options:void 0);if(void 0===i)return d&&d([]),[];if(i.options&&i.options.remote?h=[]:(!e||"script"!=e.type||i.options&&i.options.indexed||(h=i.filter(e.statements)),h&&0!=h.length||(h=i.filter()),void 0===h&&(h=[]),i.options&&i.options.all||(h=Eden.Selectors.unique(h)),i.options&&i.options.nosort||(h=Eden.Selectors.sort(h)),h=Eden.Selectors.processResults(h,b,f)),0!=i.local||!d||f&&!(h.length<f))return d&&d(h),h;var j=a.search(/[\s\.\:\#\@\>]/);-1==j&&(j=a.length);var k=a.substring(0,j).trim();if(k.startsWith("plugins")){for(var l=a.split(">"),m="",n=0;n<l.length;n++)l[n]=l[n].trim(),m+=l[n],n<l.length-1&&(m+="/");$.ajax({url:m+".js-e",dataType:"text",success:function(c){var e=[new Eden.AST(c,void 0,{name:l[l.length-1],remote:!0}).script];Eden.Selectors.cache[a]=e[0],h=e,e=Eden.Selectors.processResults(h,b),d(e)},error:function(){d([])}})}else i.options&&i.options.external?Eden.DB.searchSelector(a,void 0===b?["outersource","path"]:b,function(a){if(void 0===b&&a.length>0){for(var c=0;c<a.length;c++){var e;e=Eden.AST.parseStatement(a[c][0],{remote:!0});var f=Eden.AST.originFromDoxy(e.doxyComment);f.remote=!0,e.base.origin=f,e.id=f.id;var g=Eden.Selectors.queryWithin([e],a[c][1])[0];g&&(h.push(g),i.options&&i.options.index&&e.addIndex())}d(h)}else void 0===a||0==a.length?Eden.Project.local&&Eden.Project.local[k]?$.get(Eden.Project.local[k].file,function(a){var c=[new Eden.AST(a,void 0,{name:k,remote:!0}).script];Eden.Selectors.cache[k]=c[0],h=c,h=Eden.Selectors.unique(i.filter(h)),c=Eden.Selectors.processResults(h,b),d(c)},"text"):d(h):(h.push.apply(h,a),d(h))}):Eden.Project.local&&Eden.Project.local[k]?$.get(Eden.Project.local[k].file,function(a){var c=[new Eden.AST(a,void 0,{name:k,remote:!0}).script];Eden.Selectors.cache[k]=c[0],h=c,h=Eden.Selectors.unique(i.filter(h)),c=Eden.Selectors.processResults(h,b),d(c)},"text"):d([])},Eden.Selectors.execute=function(a,b){Eden.Selectors.query(a,void 0,{minimum:1},function(a){function c(d){for(var e=a[d];e.parent;)e=e.parent;e.base.executeStatement(a[d],-1,Symbol.localJSAgent,function(){d++,d<a.length?c(d):b&&b()})}a&&a.length>0?c(0):b&&b()})},Eden.Selectors.goto=function(a){Eden.Selectors.query(a,void 0,{minimum:1,noindex:!0},function(b){if(0==b.length)return!1;for(var c=[b[0]],d=b[0];d.parent;)c.push(d.parent),d=d.parent;for(var e=!1,f=0;f<c.length;f++)if(Eden.Fragment.emit("goto",[c[f],b[0]])){e=!0;break}if(!e){console.log("No Goto Match, create view",a,b[0]);for(var g in edenUI.activeDialogs)if("ScriptInput"==edenUI.activeDialogs[g]){var h=eden.root.lookup("view_"+g+"_tabs").value(),i="script"==b[0].type?a:Eden.Selectors.getID(b[0].parent);h.push(i),eden.root.lookup("view_"+g+"_tabs").assign(h,eden.root.scope,Symbol.localJSAgent),e=Eden.Fragment.emit("goto",[c[f],b[0]]);break}if(!e){edenUI.createView("gotoscript","ScriptInput");var i="script"==b[0].type?a:Eden.Selectors.getID(b[0].parent),h=[i];eden.root.lookup("view_gotoscript_tabs").assign(h,eden.root.scope,Symbol.localJSAgent),eden.root.lookup("view_gotoscript_current").assign(0,eden.root.scope,Symbol.localJSAgent),e=!0}}return e})},Eden.Selectors.assign=function(a,b,c){var d=Eden.Selectors.query(a),e="string"==typeof b?b.split(","):b,f=Array.isArray(c)?c:[c];if(f.length<e.length)return void console.error("Not enough values");for(var g=0;g<d.length;g++)for(var h=0;h<e.length;h++)switch(e[h]){case"source":if(d[g].parent){var i=d[g].parent;if("string"==typeof f[h]){var j=Eden.AST.parseStatement(f[h]);d[g].parent.replaceChild(d[g],j)}else void 0===f[h]&&d[g].parent.removeChild(d[g]);for(;i;)Eden.Fragment.emit("patch",[void 0,i]),i=i.parent}else console.error("Cannot replace outer source of root script");break;case"innersource":if("script"==d[g].type){var j=Eden.AST.parseScript(f[h]);d[g].patchInner(j);for(var i=d[g];i;)Eden.Fragment.emit("patch",[void 0,i]),i=i.parent}else console.error("Cannot replace innersource of non-script node");break;case"title":case"comment":case"rawcomment":var k=new Eden.AST.DoxyComment(f[h],0,0),l=new Eden.AST.DummyStatement;l.setSource(0,0,"#! "+f[h].trim().replace(/\n/g,"\n# ")+"\n"),d[g].doxyComment?d[g].parent.replaceChild(d[g].previousSibling,l):d[g].parent.insertBefore(d[g],l),Eden.Index.remove(d[g]),d[g].setDoxyComment(k),Eden.Index.update(d[g]);break;case"tags":case"executed":break;case"enabled":"when"==d[g].type&&(d[g].enabled&&!f[h]?(eden.project.removeAgent(d[g]),d[g].enabled=!1):!d[g].enabled&&f[h]&&(eden.project.registerAgent(d[g]),d[g].enabled=!0));break;case"name":"script"==d[g].type?(Eden.Index.remove(d[g]),d[g].prefix="action "+f[h]+" {",d[g].name=f[h],Eden.Index.update(d[g])):"assignment"!=d[g].type&&"definition"!=d[g].type||(Eden.Index.remove(d[g]),d[g].lvalue.name=f[h],d[g].source=d[g].source.replace(/\w*/,f[h]),Eden.Index.update(d[g]));break;default:console.error("Cannot modify property '"+e[h]+"'")}},Eden.Selectors.append=function(a,b,c){var d=Eden.Selectors.query(a),e="string"==typeof b?b.split(","):b,f=Array.isArray(c)?c:[c];if(f.length<e.length)return void console.error("Not enough values");for(var g=0;g<d.length;g++)for(var h=0;h<e.length;h++)switch(e[h]){case"source":if(d[g].parent){var i=d[g].parent;if("string"==typeof f[h]){var j=Eden.AST.parseStatement(f[h]);d[g].parent.insertBefore(d[g],j)}else f[h];for(;i;)Eden.Fragment.emit("patch",[void 0,i]),i=i.parent}else console.error("Cannot replace outer source of root script");break;case"innersource":if("script"==d[g].type){for(var j=Eden.AST.parseScript(f[h]),k=0;k<j.statements.length;k++)d[g].appendChild(j.statements[k]);for(var i=d[g];i;)Eden.Fragment.emit("patch",[void 0,i]),i=i.parent}else console.error("Cannot replace innersource of non-script node");break;case"title":case"comment":case"rawcomment":var l=new Eden.AST.DoxyComment(f[h],0,0);d[g].doxyComment=l;var m=new Eden.AST.DummyStatement;m.setSource(f[h],0,0),d[g].parent.insertBefore(d[g],m);break;case"tags":case"name":"script"==d[g].type&&(Eden.Index.remove(d[g]),d[g].prefix="action "+f[h]+" {",d[g].name=f[h],Eden.Index.update(d[g]));break;default:console.error("Cannot modify property '"+e[h]+"'")}},Eden.Selectors.PropertyNode=function(a,b){if(this.type="property",this.name=a,this.param=b,this.compare=void 0,this.value=b,this.range=!1,this.isreg=!!b&&-1!=b.indexOf("*"),this.meta="string"==typeof a?"."==a.charAt(0)?Eden.Selectors.PropertyNode.attributes[a.substring(1)]:Eden.Selectors.PropertyNode.pseudo[a.substring(1)]:void 0,this.local=!!this.meta&&this.meta.local,b){switch(b.charAt(0)){case"<":this.compare="="==b.charAt(1)?"<=":"<";break;case">":this.compare="="==b.charAt(1)?">=":">";break;case"=":this.compare="=";break;case"!":this.compare="!="}if(this.compare)switch(this.compare){case"!":case"=":case">":case"<":this.value=b.substring(1);break;case">=":case"<=":this.value=b.substring(2)}if(this.isreg?this.value=Eden.Selectors.makeRegex(this.value):null!==b.match(/^[0-9]+\-[0-9]+$/)?this.range=!0:null!==b.match(/^[0-9]+$/)&&(this.value=parseInt(b)),".type"==this.name){switch(this.param){case"is":this.param="definition";break;case"assign":case"=":this.param="assignment";break;case"call":this.param="functioncall";break;case"proc":this.param="action";break;case"action":this.param="script";break;case"+=":case"-=":case"*=":case"/=":case"++":case"--":this.param="modify"}this.value=this.param}}},Eden.Selectors.PropertyNode.attributes={name:{local:!1,indexed:!0,rank:1},type:{local:!1,indexed:!1,rank:3},datatype:{local:!1,indexed:!1,rank:30},id:{local:!1,indexed:!0,rank:2},lines:{local:!1,indexed:!1,rank:3},depends:{local:!1,indexed:!1,rank:4},time:{local:!0,indexed:!1,rank:3},date:{local:!1,indexed:!1,rank:3},title:{local:!1,indexed:!1,rank:10},author:{local:!1,indexed:!1,rank:10},v:{local:!1,indexed:!1,rank:20},version:{local:!1,indexed:!1,rank:20},source:{local:!0,indexed:!1,rank:50},comment:{local:!0,indexed:!1,rank:50}},Eden.Selectors.PropertyNode.pseudo={line:{local:!1,indexed:!1,rank:50},determines:{local:!0,indexed:!0,rank:10},first:{local:!1,indexed:!0,rank:5},last:{local:!1,indexed:!0,rank:5},unexecuted:{local:!0,indexed:!1,rank:3},executed:{local:!0,indexed:!1,rank:3},root:{local:!1,indexed:!0,rank:3},project:{local:!0,indexed:!0,rank:3},nth:{local:!1,indexed:!0,rank:5},value:{local:!0,indexed:!1,rank:50},matches:{local:!1,indexed:!1,rank:100},age:{local:!1,indexed:!1,rank:6},remote:{local:!0,indexed:!0,rank:20},not:{local:!1,indexed:!1,rank:100},active:{local:!0,indexed:!1,rank:10},me:{local:!1,indexed:!1,rank:20},listed:{local:!1,indexed:!1,rank:20}},Eden.Selectors.PropertyNode.prototype.append=function(a){if(!a)return this;switch(a.type){case"property":case"tag":case"name":var b=new Eden.Selectors.IntersectionNode(this,a);return b.options=this.options,b;case"union":case"intersection":case"navigate":return a.prepend(this),a}return this},Eden.Selectors.PropertyNode.prototype.prepend=function(a){if(!a)return this;switch(a.type){case"property":case"tag":case"name":var b=new Eden.Selectors.IntersectionNode(a,this);return b.options=this.options,b;case"union":case"intersection":case"navigate":return a.append(this),a}return this},Eden.Selectors.PropertyNode.prototype.filter=function(a){a||(a=this.construct());var b=this,c=this.value,d=this.name;if("number"==typeof this.name)return a&&a.length>=this.name?[a[this.name-1]]:[];switch(d){case".name":if(!c)return a.filter(function(a){return void 0!==a.lvalue||void 0!==a.name});var e=edenUI.regExpFromStr(c);return a.filter(function(a){return a.lvalue&&e.test(a.lvalue.name)||a.name&&e.test(a.name)});case".id":return a.filter(function(a){return 0==a.id&&a.buildID(),a.id==c});case".type":if(!c)break;return a.filter(function(a){return a.type==c});case".datatype":return a.filter(function(a){return a.expression&&Eden.Selectors.testType(a.expression)==c||a.expression&&"scope"==a.expression.type&&a.expression.range&&"list"==c});case".lines":case":line":return a;case".op":case".operator":case":pattern":case":determines":return a;case".depends":return a.filter(function(a){return("definition"==a.type||"when"==a.type)&&a.dependencies[c]});case":active":return a.filter(function(a){if("definition"==a.type||"assignment"==a.type){var b=eden.root.symbols[a.lvalue.name];return b&&(b.origin===a||b.origin&&b.origin.id==a.id)}return"when"==a.type&&a.enabled});case":first":return a.length>0?[a[0]]:[];case":last":return a.length>0?[a[a.length-1]]:[];case":unexecuted":return a.filter(function(a){return 0==a.executed});case":executed":return a.filter(function(a){return 1==a.executed});case":root":return a.filter(function(a){return void 0===a.parent});case":project":return[eden.project.ast.script];case":nth":return a.filter(function(a){return a.parent&&Eden.Selectors.getChildren([a.parent],!1)[b.value-1]===a});case":value":return a;case":":case":matches":var f=Eden.Selectors.parse(this.param);return f?f.filter(a):[];case".title":return this.isreg?a.filter(function(a){if(!a.doxyComment)return!1;var c=a.doxyComment.getProperty("title");return c&&b.value.test(c)}):a.filter(function(a){if(!a.doxyComment)return!1;var c=a.doxyComment.getProperty("title");return c&&c==b.value});case".author":case".version":return a;case".source":return this.isreg?a.filter(function(a){return b.value.test(a.getSource())}):a.filter(function(a){return a.getSource()==b.value});case".comment":return this.isreg?a.filter(function(a){return a.doxyComment&&b.value.test(a.doxyComment.stripped())}):a.filter(function(a){return a.doxyComment&&a.doxyComment.stripped()==b.value});case":age":var g=generateTimeStamp(this.value),h=Date.now(),i=h-g;return console.log("AGE",g,h,i),
void 0===this.compare||"<"==this.compare?a.filter(function(a){return a.stamp>i}):a.filter(function(a){return a.stamp<i});case".time":case".date":return a;case":remote":return a.filter(function(a){for(var b=a;b.parent;)b=b.parent;return!(!b.base||!b.base.origin)&&1==b.base.origin.remote});case":not":if(this.param){var j=Eden.Selectors.parse(this.param).filter(a);return a.filter(function(a){for(var b=0;b<j.length;b++)if(a===j[b])return!1;return!0})}default:return[]}return[]},Eden.Selectors.PropertyNode.prototype.construct=function(){var a;switch(this.name){case".type":a=Eden.Index.getByType(this.value);break;case".id":a=Eden.Index.getByID(this.value);break;case".name":a=void 0===this.param?Eden.Index.getAllWithName():this.isreg?Eden.Index.getByNameRegex(this.value):Eden.Index.getByName(this.value);break;case":root":a=[eden.project.ast.script].concat(Object.keys(Eden.Selectors.cache).map(function(a){return Eden.Selectors.cache[a]}));break;case":remote":a=Object.keys(Eden.Selectors.cache).map(function(a){return Eden.Selectors.cache[a]});break;case":project":a=[eden.project.ast.script];break;default:a=Eden.Index.getAll()}return this.options&&this.options.history?a:a.filter(function(a){return a.executed>=0})},Eden.Selectors.NameNode=function(a){this.type="name",this.name=a,this.options=void 0,this.isreg="/"==a.charAt(0)||-1!=a.indexOf("*"),this.local=!1},Eden.Selectors.NameNode.prototype.filter=function(a){if(!a)return this.construct();var b=this.name;if(this.isreg){var c=Eden.Selectors.makeRegex(this.name);return a.filter(function(a){return a.lvalue&&c.test(a.lvalue.name)||a.name&&c.test(a.name)})}return a.filter(function(a){return a.lvalue&&a.lvalue.name==b||a.name&&a.name==b})},Eden.Selectors.NameNode.prototype.construct=function(){if(this.isreg){var a=Eden.Selectors.makeRegex(this.name);stats=Eden.Index.getByNameRegex(a)}else{stats=Eden.Index.getByName(this.name);for(var b=this.name.toLowerCase().split(" "),c=Eden.Index.getByTag("#"+b[0]),d=1;d<b.length;d++)c=c.filter(function(a){return(!eden.project||a!==eden.project.ast.script)&&a.doxyComment&&a.doxyComment.hasTag("#"+b[d])});stats.push.apply(stats,c)}return this.options&&this.options.history?stats:stats.filter(function(a){return a.executed>=0})},Eden.Selectors.NameNode.prototype.append=Eden.Selectors.PropertyNode.prototype.append,Eden.Selectors.NameNode.prototype.prepend=Eden.Selectors.PropertyNode.prototype.prepend,Eden.Selectors.TagNode=function(a){this.type="tag",this.tag=a,this.options=void 0,this.isreg=-1!=a.indexOf("*"),this.local=!1},Eden.Selectors.TagNode.prototype.filter=function(a){if(!a)return this.construct();var b=this;return a.filter(function(a){return a.doxyComment&&a.doxyComment.hasTag(b.tag)})},Eden.Selectors.TagNode.prototype.construct=function(){if(this.isreg){var a=Eden.Selectors.makeRegex(this.tag);stats=Eden.Index.getByTagRegex(a)}else stats=Eden.Index.getByTag(this.tag);return this.options&&this.options.history?stats:stats.filter(function(a){return a.executed>=0})},Eden.Selectors.TagNode.prototype.append=Eden.Selectors.PropertyNode.prototype.append,Eden.Selectors.TagNode.prototype.prepend=Eden.Selectors.PropertyNode.prototype.prepend,Eden.Selectors.IntersectionNode=function(a,b){this.type="intersection",this.children=[a,b],this.local=!1},Eden.Selectors.IntersectionNode.prototype.append=function(a){if(!a)return this;switch(a.local&&(this.local=!0),a.type){case"navigate":return a.prepend(this),a}return this.children.push(a),this},Eden.Selectors.IntersectionNode.prototype.prepend=function(a){return a?(a.local&&(this.local=!0),this.children.splice(0,0,a),this):this},Eden.Selectors.IntersectionNode.prototype.filter=function(a,b){for(var c=0;c<this.children.length;c++)a=this.children[c].filter(a,b);return a||[]},Eden.Selectors.IntersectionNode.prototype.construct=function(){},Eden.Selectors.UnionNode=function(){this.type="union",this.children=[void 0],this.local=!1},Eden.Selectors.UnionNode.prototype.filter=function(a,b){for(var c={},d=0;d<this.children.length;d++)for(var e=this.children[d].filter(a,b),f=0;f<e.length;f++)c[e[f].id]=e[f];return Object.keys(c).map(function(a){return c[a]})},Eden.Selectors.UnionNode.prototype.construct=function(){},Eden.Selectors.UnionNode.prototype.prepend=function(a){return a?(a.local&&(this.local=!0),void 0===this.children[0]?(this.children[0]=a,this):(this.children[0]=this.children[0].prepend(a),this)):this};Eden.Selectors.UnionNode.prototype.append=function(a){return a?(a.local&&(this.local=!0),this.children.push(a),this):this},Eden.Selectors.NavigateNode=function(a,b){this.type="navigate",this.left=void 0,this.right=void 0,this.direction=a,this.deep=b,this.local=!1},Eden.Selectors.NavigateNode.prototype.append=function(a){return a?(a.local&&(this.local=!0),"union"==a.type?(a.prepend(this),a):(this.right?this.right.append(a):this.right=a,this)):this},Eden.Selectors.NavigateNode.prototype.prepend=function(a){return a?(a.local&&(this.local=!0),this.left?this.left=this.left.prepend(a):this.left=a,this):this},Eden.Selectors.NavigateNode.prototype.filter=function(a,b){if(">"==this.direction){if(!a&&void 0===this.left)return this.right?this.right.filter(a,b).filter(function(a){return void 0!==a.parent}):Eden.Index.getAll().filter(function(a){return void 0!==a.parent});var c;return c=void 0===this.left?Eden.Selectors.getChildren(a,this.deep):Eden.Selectors.getChildren(this.left.filter(a,b),this.deep),this.right?this.right.filter(c,b):c}if("<"==this.direction){if(!a&&void 0===this.left)return this.right?this.right.filter(a,b).filter(function(a){return"script"==a.type||"when"==a.type||"if"==a.type||"for"==a.type}):Eden.Index.getAll().filter(function(a){return"script"==a.type||"when"==a.type||"if"==a.type||"for"==a.type});var c;if(c=void 0===this.left?a.filter(function(a){return"script"==a.type||"when"==a.type||"if"==a.type||"for"==a.type}):this.left.filter(a,b),this.deep){for(var d=[],e=0;e<c.length;e++)for(var f=c[e];f.parent;)"script"==f.parent.type&&f.parent.parent&&"script"!=f.parent.parent.type?"codeblock"==f.parent.parent.type?(f=f.parent.parent.parent,d.push(f)):(f=f.parent.parent,d.push(f)):"codeblock"==f.parent.type?(f=f.parent.parent,d.push(f)):(f=f.parent,d.push(f));return this.right?Eden.Selectors.unique(this.right.filter(d,b)):Eden.Selectors.unique(d)}for(var d=[],e=0;e<c.length;e++)c[e].parent&&("script"==c[e].parent.type&&c[e].parent.parent&&"script"!=c[e].parent.parent.type?"codeblock"==c[e].parent.parent.type?d.push(c[e].parent.parent.parent):d.push(c[e].parent.parent):"codeblock"==c[e].parent.type?d.push(c[e].parent.parent):d.push(c[e].parent));return this.right?Eden.Selectors.unique(this.right.filter(d,b)):Eden.Selectors.unique(d)}},Eden.Selectors.NavigateNode.prototype.construct=function(){return console.log("Construct direct children"),[]},Eden.SyntaxWarning=function(a,b,c,d){this.type="syntax",this.context=a,this.node=b,this.warnno=c,this.extra=d,this.token=a.token,this.prevtoken=a.previous,this.line=a.stream.prevline,this.position=a.stream.position,this.prevposition=a.stream.prevposition},Eden.SyntaxWarning.UNKNOWN=0,Eden.SyntaxWarning.DEPRECATED=1,Eden.SyntaxWarning.NESTEDWHEN=2,Eden.SyntaxWarning.DEFINWHEN=3,Eden.SyntaxWarning.EXPRESSIONLIT=4,Eden.SyntaxWarning.prototype.messageText=function(){var a;switch(this.warnno){case Eden.SyntaxWarning.DEPRECATED:a="Deprecation: ";break;case Eden.SyntaxWarning.NESTEDWHEN:a='"when"\'s should not be nested';break;case Eden.SyntaxWarning.DEFINWHEN:a='"when"\'s should not contain definitions';break;case Eden.SyntaxWarning.EXPRESSIONLIT:a="Keep literals in separate observables";break;case Eden.SyntaxWarning.USEOFWHILE:a="Try and use 'for', 'when' or 'with' to achieve looping";break;default:a="Warning: "}return a+=this.extra},Eden.RuntimeWarning=function(a,b,c){this.type="runtime",this.node=a,this.warnno=b,this.extra=c,this.line=-1},Eden.RuntimeWarning.UNKNOWN=0,Eden.RuntimeWarning.EMPTYDO=1,Eden.RuntimeWarning.UNDEFINED=2,Eden.RuntimeWarning.prototype.messageText=function(){var a;switch(this.warnno){case Eden.RuntimeWarning.EMPTYDO:a="Empty result for: ";break;case Eden.RuntimeWarning.UNDEFINED:a="Expression is undefined: ";break;default:a="Warning: "}return void 0!==this.extra&&(a+=this.extra),a},Eden.Index={},Eden.Index.id_index={},Eden.Index.name_index={},Eden.Index.tag_index={},Eden.Index.type_index={},Eden.Index.idExists=function(a){return Eden.Index.id_index.hasOwnProperty(a)},Eden.Index.getByID=function(a){var b=Eden.Index.id_index[a];return b||[]},Eden.Index.getAll=function(){var a=[];return Object.values?a.concat.apply(a,Object.values(Eden.Index.id_index)):a.concat.apply(a,Object.keys(Eden.Index.id_index).map(function(a){return Eden.Index.id_index[a]}))},Eden.Index.getAllWithName=function(){var a=[];for(var b in Eden.Index.name_index)a.push.apply(a,Eden.Index.name_index[b].map(function(a){return Eden.Index.id_index[a]}));return a},Eden.Index.getByName=function(a){var b=[];return Eden.Index.name_index[a]?b.concat.apply(b,Eden.Index.name_index[a].map(function(a){return Eden.Index.id_index[a]})):b},Eden.Index.getByNameRegex=function(a){var b=[];for(var c in Eden.Index.name_index)a.test(c)&&(b=b.concat.apply(b,Eden.Index.name_index[c].map(function(a){return Eden.Index.id_index[a]})));return b},Eden.Index.getByType=function(a){var b=[];return Eden.Index.type_index[a]?b.concat.apply(b,Object.keys(Eden.Index.type_index[a]).map(function(a){return Eden.Index.id_index[a]})):b},Eden.Index.getByTag=function(a){var b=[];return Eden.Index.tag_index[a]?b.concat.apply(b,Eden.Index.tag_index[a].map(function(a){return Eden.Index.id_index[a]})):b},Eden.Index.getByTagRegex=function(a){var b=[];for(var c in Eden.Index.tag_index)a.test(c)&&(b=b.concat.apply(b,Eden.Index.tag_index[c].map(function(a){return Eden.Index.id_index[a]})));return b},Eden.Index.remove=function(a){var b=Eden.Index.id_index[a.id];if(b){for(var c=0;c<b.length;c++)b[c]===a&&b.splice(c,1);if(0==b.length){if(delete Eden.Index.id_index[a.id],delete Eden.Index.type_index[a.type][a.id],a.name&&"do"!=a.type||a.lvalue){var d=a.name?a.name:a.lvalue.name;if(void 0===Eden.Index.name_index[d])return;var e=Eden.Index.name_index[d].indexOf(a.id);e>=0&&Eden.Index.name_index[d].splice(e,1)}if(a.tags)for(var f=a.tags,c=0;c<f.length;c++)if(void 0!==Eden.Index.tag_index[f[c]]){var e=Eden.Index.tag_index[f[c]].indexOf(a.id);e>=0&&Eden.Index.tag_index[f[c]].splice(e,1)}}}},Eden.Index.update=function(a){if(void 0===Eden.Index.id_index[a.id]&&(Eden.Index.id_index[a.id]=[]),Eden.Index.id_index[a.id].push(a),1==Eden.Index.id_index[a.id].length){if(void 0===Eden.Index.type_index[a.type]&&(Eden.Index.type_index[a.type]={}),Eden.Index.type_index[a.type][a.id]=!0,a.name&&"do"!=a.type||a.lvalue){var b=a.name?a.name:a.lvalue.name;void 0===Eden.Index.name_index[b]&&(Eden.Index.name_index[b]=[]),-1==Eden.Index.name_index[b].indexOf(a.id)&&Eden.Index.name_index[b].push(a.id)}if(a.tags)for(var c=a.tags,d=0;d<c.length;d++)void 0===Eden.Index.tag_index[c[d]]&&(Eden.Index.tag_index[c[d]]=[]),-1==Eden.Index.tag_index[c[d]].indexOf(a.id)&&Eden.Index.tag_index[c[d]].push(a.id)}},Eden.AST=function(a,b,c,d){this.stream=void 0!==a?new EdenStream(a):void 0,this.data=new EdenSyntaxData,this.token="INVALID",this.previous="INVALID",this.src="input",this.parent=void 0,this.scripts={},this.definitions={},this.origin=c,this.lastposition=0,this.lastline=0,this.errors=[],this.warnings=[],this.whens=[],this.options=d,this.lastresult=void 0,this.depth=0,c||console.error("NO ORIGIN",a),this.lastDoxyComment=[],this.mainDoxyComment=void 0,this.parentDoxy=void 0,this.lastStatement=void 0,this.lastStatementEndline=-1,this.stream&&(this.stream.data=this.data),this.stamp=Date.now(),d&&d.noparse||(this.next(),this.script=this.pSCRIPT(),this.script.base=this,this.script.name=c.name,c.id&&(this.script.id=c.id),this.script.setSource(0,a.length,a),this.script.setDoxyComment(this.doxyFromOrigin()),this.options&&this.options.noindex?0==this.script.id&&this.script.buildID():this.script.addIndex(),0==this.errors.length?this.errors=this.script.errors:this.errors.push.apply(this.errors,this.script.errors))},Eden.AST.MODE_DYNAMIC=1,Eden.AST.MODE_COMPILED=2,Eden.AST.MODE_READABLE=3,Eden.AST.fnEdenASTerror=function(a){this.errors.unshift(a)},Eden.AST.fnEdenASTleft=function(a){this.l=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors),a&&a.warning&&(this.warning=a.warning)},Eden.AST.debug=!1,Eden.AST.debugstep=!1,Eden.AST.debugstep_cb=void 0,Eden.AST.debugspeed=500,Eden.AST.debugbreakpoint=void 0,Eden.AST.debugbreakpoint_cb=void 0,Eden.AST.debug_begin_cb=void 0,Eden.AST.debug_end_cb=void 0,Eden.AST.fromNode=function(a,b){var c=new Eden.AST(a.getInnerSource(),void 0,b,{noindex:!0,noparse:!0});return c.script=a,c.whens=Eden.Selectors.queryWithin([a],">>.type(when)"),c.errors=a.errors,c},Eden.AST.prototype.doxyFromOrigin=function(){var a=this.origin.name;if(this.origin.title&&(a+="\n * @title "+this.origin.title),this.origin.author&&(a+="\n * @author "+this.origin.author),this.origin.id&&(a+="\n * @id "+this.origin.id),this.origin.saveID&&(a+="\n * @version "+this.origin.vid),this.origin.tags&&this.origin.tags.length>0){a+="\n *";for(var b=0;b<this.origin.tags.length;b++)a+=" #"+this.origin.tags[b]}return new Eden.AST.DoxyComment(a)},Eden.AST.originFromDoxy=function(a){var b={};if(void 0===a)return b;var c=a.getControls();return c["@title"]&&(b.title=c["@title"][0]),c["@author"]&&(b.author=c["@author"][0]),c["@id"]&&(b.id=c["@id"][0]),c["@version"]&&(b.vid=c["@version"][0]),b},Eden.AST.prototype.destroy=function(){for(var a=Eden.Selectors.queryWithin([this.script],">>"),b=0;b<a.length;b++)Eden.Index.remove(a[b]);this.script=void 0,this.stream=void 0,this.lines=void 0,this.scripts=void 0;for(var b=0;b<this.whens.length;b++)this.whens[b].enabled&&eden.project.removeAgent(this.whens[b])},Eden.AST.prototype.getActionByName=function(a){var b;if(-1==a.indexOf("/")&&void 0===(b=this.scripts[a]))for(var c=0;c<this.imports.length;c++)if(this.imports[c]&&this.imports[c].ast&&(b=this.imports[c].ast.getActionByName(a)))return b;return b},Eden.AST.prototype.generate=function(){return this.script.generate()},Eden.AST.prototype.execute=function(a,b){this.executeStatement(this.script,0,a,b)},Eden.AST.prototype.clearExecutedState=function(){for(var a=0;a<this.lines.length;a++)this.lines[a]&&this.lines[a].executed>0&&(this.lines[a].executed=0)},Eden.AST.prototype.executeLine=function(a,b,c){var d,e=a;void 0!==(d=-1==a?this.script:this.lines[e])&&(d=this.getBase(d),this.executeStatement(d,e,b,c))},Eden.AST.parseStatement=function(a,b){var c=new Eden.AST(a,void 0,b||{},{noparse:!0,noindex:!0});c.next();var d=c.pSTATEMENT();d.base=c,d.setSource(0,a.length,a),d.stamp=c.stamp;var e=a.match("\n");return d.numlines=null===e?0:e.length,d},Eden.AST.parseScript=function(a,b){var c=new Eden.AST(a,void 0,b||{},{noparse:!0,noindex:!0});c.next();var d=c.pSCRIPT();d.base=c,d.setSource(0,a.length,a),d.stamp=c.stamp;var e=a.match("\n");return d.numlines=null===e?0:e.length,d},Eden.AST.parseExpression=function(a){var b=new Eden.AST(a,void 0,{},{noparse:!0,noindex:!0});return b.next(),b.pEXPRESSION()},Eden.AST.registerStatement=function(a){a.prototype.getOrigin=Eden.AST.BaseStatement.getOrigin,a.prototype.hasErrors=Eden.AST.BaseStatement.hasErrors,a.prototype.setSource=Eden.AST.BaseStatement.setSource,a.prototype.getSource=Eden.AST.BaseStatement.getSource,a.prototype.getOuterSource=Eden.AST.BaseStatement.getOuterSource,a.prototype.getNumberOfLines=Eden.AST.BaseStatement.getNumberOfLines,a.prototype.getStartLine=Eden.AST.BaseStatement.getStartLine,a.prototype.getEndLine=Eden.AST.BaseStatement.getEndLine,a.prototype.getRange=Eden.AST.BaseStatement.getRange,a.prototype.error=Eden.AST.fnEdenASTerror,a.prototype.addIndex=Eden.AST.BaseStatement.addIndex,a.prototype.removeIndex=Eden.AST.BaseStatement.removeIndex,a.prototype.destroy=Eden.AST.BaseStatement.destroy,a.prototype.buildID=Eden.AST.BaseStatement.buildID,a.prototype.setDoxyComment=Eden.AST.BaseStatement.setDoxyComment,a.prototype.needsRebuild=Eden.AST.BaseStatement.needsRebuild},Eden.AST.registerScript=function(a){Eden.AST.registerStatement(a),a.prototype.getStatementByLine=Eden.AST.BaseScript.getStatementByLine,a.prototype.getRelativeLine=Eden.AST.BaseScript.getRelativeLine,a.prototype.getNumberOfLines=Eden.AST.BaseScript.getNumberOfLines,a.prototype.append=Eden.AST.BaseScript.append,a.prototype.appendChild=Eden.AST.BaseScript.appendChild,a.prototype.removeChild=Eden.AST.BaseScript.removeChild,a.prototype.insertBefore=Eden.AST.BaseScript.insertBefore,a.prototype.insertAfter=Eden.AST.BaseScript.insertAfter,a.prototype.replaceChild=Eden.AST.BaseScript.replaceChild,a.prototype.addIndex=Eden.AST.BaseScript.addIndex,a.prototype.removeIndex=Eden.AST.BaseScript.removeIndex,a.prototype.destroy=Eden.AST.BaseScript.destroy,a.prototype.buildID=Eden.AST.BaseScript.buildID},Eden.AST.registerContext=function(a){Eden.AST.registerScript(a)},Eden.AST.prototype.getBase=function(a,b){void 0===b&&console.error("Undefined context in getBase");for(var c=a;c&&c.parent&&c.parent!==b;)c=c.parent;return c},Eden.AST.prototype.getBlockLines=function(a,b){for(var c=a,d=this.getBase(this.lines[c],b);c>0&&this.lines[c-1]&&this.getBase(this.lines[c-1],b)==d;)c--;for(var e=c;c<this.lines.length-1&&this.lines[c+1]&&(this.lines[c+1]===d||this.lines[c+1].parent!==b);)c++;return[e,c]},Eden.AST.prototype.getSource=function(a){return this.script.getSource()},Eden.AST.prototype.getRoot=function(){return this.script},Eden.AST.prototype.getErrors=function(){return this.script.errors},Eden.AST.prototype.hasErrors=function(){return this.script.errors.length>0},Eden.AST.prototype.prettyPrint=function(){var a="";if(this.script.errors.length>0)for(var b=0;b<this.script.errors.length;b++)a=a+this.script.errors[b].prettyPrint()+"\n\n";else a=JSON.stringify(this.script,function(a,b){if("errors"!=a)return"parent"==a?!!b||void 0:b},"    ");return a},Eden.AST.prototype.next=function(){this.previous=this.token,this.lastposition=this.stream.position,this.lastline=this.stream.line,this.token=this.stream.readToken();for(var a=this.stream.prevline;;)if("/*"==this.token){var b=1,c=!1,d=this.stream.position-2,e=this.stream.line;for(42==this.stream.peek()&&(c=!0);this.stream.valid()&&("*/"!=this.token||b>0);)this.token=this.stream.readToken(),"/*"==this.token?b++:"*/"==this.token&&b--;if("*/"!=this.token){var f=new Eden.SyntaxError(this,Eden.SyntaxError.BLOCKCOMMENT);f.line=e,this.errors.push(f)}if(c){var g=new Eden.AST.DoxyComment(this.stream.code.substring(d+3,this.stream.position-2).trim(),e,this.stream.line);this.lastDoxyComment.push(g),g.parent=this.parentDoxy,g.content.endsWith("@{")?this.parentDoxy=g:g.content.startsWith("@}")&&this.parentDoxy&&(this.parentDoxy=this.parentDoxy.parent)}this.token=this.stream.readToken()}else{if("${{"!=this.token)break;var d=this.stream.position,e=this.stream.line;for(this.data.line=e;this.stream.valid()&&"}}$"!=this.token;)this.token=this.stream.readToken();this.data.value=this.stream.code.substring(d,this.stream.position-3),this.token="JAVASCRIPT",this.stream.prevposition=d-3}this.stream.prevline=a},Eden.AST.prototype.peekNext=function(a){var b,c={value:""};for(this.stream.data=c,this.stream.pushPosition();a>0;)b=this.stream.readToken(),a--;return this.stream.popPosition(),this.stream.data=this.data,b},Eden.AST.BaseStatement=function(){this.start=0,this.end=0,this.parent=void 0,this.errors=[],this.warning=void 0,this.executed=0,this.numlines=-1,this.doxyComment=void 0,this.lock=0,this.source=void 0,this.id=0,this.stamp=0,this.nextSibling=void 0,this.previousSibling=void 0,this.tags=void 0},Eden.AST.BaseStatement.needsRebuild=function(){return!1},Eden.AST.BaseStatement.setDoxyComment=function(a){this.doxyComment=a,a&&(void 0===this.tags?this.tags=a.getHashTags():this.tags=this.tags.concat(a.getHashTags()),a.hasTag("#library")&&("function"==this.type?edenFunctions[this.name]=!0:"definition"==this.type&&(edenFunctions[this.lvalue.name]=!0)))},Eden.AST.BaseStatement.buildID=function(){var a,b=0,c=this.source;this.doxyComment&&(c=this.doxyComment.content+c);for(var d=c.length,e=0;e<d;e++)a=c.charCodeAt(e),b=(b<<5)-b+a,b&=b;this.name&&"do"!=this.type?this.id=this.name+"@"+b:this.lvalue?this.id=this.lvalue.name+"@"+b:this.id=this.type+"@"+b},Eden.AST.BaseStatement.addIndex=function(){if("dummy"==this.type&&console.trace("ADDING DUMMY INDEX"),this.buildID(),this.statements)for(var a=0;a<this.statements.length;a++)"dummy"!=this.statements[a].type&&this.statements[a].addIndex();Eden.Index.update(this)},Eden.AST.BaseStatement.removeIndex=function(){if(this.statements)for(var a=0;a<this.statements.length;a++)"dummy"!=this.statements[a].type&&this.statements[a].removeIndex();Eden.Index.remove(this)},Eden.AST.BaseStatement.destroy=function(){if(this.executed<1&&Eden.Index.remove(this),this.parent=void 0,this.nextSibling=void 0,this.previousSibling=void 0,this.statements)for(var a=0;a<this.statements.length;a++)"dummy"!=this.statements[a].type&&this.statements[a].destroy();this.executed=-1},Eden.AST.BaseStatement.hasErrors=function(){return this.errors.length>0},Eden.AST.BaseStatement.getNumberOfLines=function(){return this.numlines},Eden.AST.BaseStatement.getStartLine=function(a){return this.parent?this.parent.getRelativeLine(this,a):-1},Eden.AST.BaseStatement.getEndLine=function(a){return this.getStartLine(a)+this.getNumberOfLines()},Eden.AST.BaseStatement.getRange=function(a){var b=this.getStartLine(a);return[b,b+this.getNumberOfLines()]},Eden.AST.BaseStatement.setSource=function(a,b,c){this.start=a,this.end=b,this.source=c},Eden.AST.BaseStatement.getSource=function(){return this.source},Eden.AST.BaseStatement.getOuterSource=function(){var a=this.getSource();void 0===this.parent&&(a="action "+this.name+"{"+a+"}"),this.doxyComment&&(a="/** "+this.doxyComment.content+" */\n"+a);for(var b=this.parent;b;)"script"==b.type?(a=b.name?"action "+b.name+" {\n"+a+"\n}":"{\n"+a+"\n}",b.doxyComment&&(a="/** "+b.doxyComment.content+" */\n"+a),b=b.parent):b=void 0;return a},Eden.AST.BaseStatement.getOrigin=function(){for(var a=this;a.parent;)a=a.parent;return a.base?a.base.origin:void 0},Eden.AST.BaseScript=function(){Eden.AST.BaseStatement.apply(this),this.statements=[],this.parameters=void 0,this.locals=void 0,this.indexed=!1},Eden.AST.BaseScript.appendChild=function(a){this.statements.push(a),this.statements.length>1&&(a.previousSibling=this.statements[this.statements.length-2],this.statements[this.statements.length-2].nextSibling=a),a.parent=this,this.indexed&&0!=this.id&&console.log("INVALIDATE ID",this),"dummy"!=a.type&&this.indexed&&a.addIndex(),a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.BaseScript.append=Eden.AST.BaseScript.appendChild,Eden.AST.BaseScript.insertAfter=function(a,b){var c;for(c=0;c<this.statements.length&&this.statements[c]!==a;c++);if(c+1<this.statements.length)b.previousSibling=this.statements[c],b.nextSibling=this.statements[c+1],this.statements[c].nextSibling=b,this.statements[c+1].previousSibling=b,this.statements.splice(c+1,0,b);else{if(!(c<this.statements.length))return;b.previousSibling=this.statements[c],b.nextSibling=void 0,this.statements[c].nextSibling=b,this.statements.push(b)}b.parent=this,"dummy"!=b.type&&this.indexed&&b.addIndex(),b.errors.length>0&&this.errors.push.apply(this.errors,b.errors),this.indexed&&0!=this.id&&console.log("INVALIDATE ID",this)},Eden.AST.BaseScript.insertBefore=function(a,b){var c;for(c=0;c<this.statements.length&&this.statements[c]!==a;c++);if(!(c<this.statements.length))return void eden.emit("error",[new Eden.RuntimeError(void 0,Eden.RuntimeError.NOCHILD,this,"Statement is not a child when using insertBefore")]);this.statements.splice(c,0,b),b.parent=this,"dummy"!=b.type&&this.indexed&&b.addIndex(),b.errors.length>0&&this.errors.push.apply(this.errors,b.errors),this.indexed&&0!=this.id&&console.log("INVALIDATE ID",this)},Eden.AST.BaseScript.removeChild=function(a){var b;for(b=0;b<this.statements.length&&this.statements[b]!==a;b++);if(!(b<this.statements.length))return void eden.emit("error",[new Eden.RuntimeError(void 0,Eden.RuntimeError.NOCHILD,this,"Statement is not a child when using removeChild")]);this.statements.splice(b,1),a.nextSibling&&(a.nextSibling.previousSibling=a.previousSibling),a.previousSibling&&(a.previousSibling.nextSibling=a.nextSibling),a.destroy(),this.indexed&&0!=this.id&&console.log("INVALIDATE ID",this)},Eden.AST.BaseScript.replaceChild=function(a,b){var c;if("number"==typeof a)c=a;else{var d;for(d=0;d<this.statements.length&&this.statements[d]!==a;d++);if(d>=this.statements.length)return void eden.emit("error",[new Eden.RuntimeError(void 0,Eden.RuntimeError.NOCHILD,this,"Statement is not a child when using replaceChild")]);c=d}b.nextSibling=this.statements[c].nextSibling,b.nextSibling&&(b.nextSibling.previousSibling=b),b.previousSibling=this.statements[c].previousSibling,b.previousSibling&&(b.previousSibling.nextSibling=b),this.statements[c].destroy(),this.statements[c]=b,b.parent=this,"dummy"!=b.type&&this.indexed&&b.addIndex(),this.indexed&&0!=this.id&&console.log("INVALIDATE ID",this)},Eden.AST.BaseScript.destroy=function(){this.executed<1&&Eden.Index.remove(this);for(var a=0;a<this.statements.length;a++)this.statements[a].destroy();this.executed=-1,this.statements=void 0,this.base=void 0,this.parent=void 0,this.nextSibling=void 0,this.previousSibling=void 0},Eden.AST.BaseScript.addIndex=function(){if(!this.indexed){0==this.id&&this.buildID();for(var a=0;a<this.statements.length;a++)"dummy"!=this.statements[a].type&&this.statements[a].addIndex();this.indexed=!0,Eden.Index.update(this)}},Eden.AST.BaseScript.removeIndex=function(){if(this.indexed){for(var a=0;a<this.statements.length;a++)"dummy"!=this.statements[a].type&&this.statements[a].removeIndex();this.indexed=!1,Eden.Index.remove(this)}},Eden.AST.BaseScript.buildID=function(){for(var a,b=0,c=this.getSource(),d=c.length,e=0;e<d;e++)a=c.charCodeAt(e),b=(b<<5)-b+a,b&=b;this.id=this.type+"@"+b},Eden.AST.BaseScript.getStatementByLine=function(a,b){var c=0;if(b&&this.parent&&(c=this.parent.getRelativeLine(this,b)),!(c>a)&&void 0!==this.statements)for(var d=0;d<this.statements.length;d++){var e=this.statements[d].getNumberOfLines();if(a>=c&&a<=c+e&&"dummy"!=this.statements[d].type)return this.statements[d];c+=e}},Eden.AST.BaseScript.getRelativeLine=function(a,b){var c=0;b&&b!==this&&this.parent&&(c=this.parent.getRelativeLine(this,b));for(var d=0;d<this.statements.length;d++){if(this.statements[d]===a)return c;c+=this.statements[d].getNumberOfLines()}return-1},Eden.AST.BaseScript.getNumberOfLines=function(){void 0===this.statements&&console.error("No Statements",this);for(var a=this.numlines,b=0;b<this.statements.length;b++)a+=this.statements[b].getNumberOfLines();return a},Eden.AST.BaseContext=function(){Eden.AST.BaseScript.apply(this),this.scopes=[],this.backtickCount=0,this.locals=void 0,this.params=void 0,this.dependencies={}},Eden.AST.Append=function(){this.type="append",Eden.AST.BaseStatement.apply(this),this.destination=void 0,this.index=void 0},Eden.AST.Append.prototype.setDest=function(a){this.destination=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Append.prototype.setIndex=function(a){this.index=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Append.prototype.generate=function(a,b){var c=this.index.generate(a,b,{bound:!1,usevar:"scriptexpr"==a.type}),d=this.destination.generate(a,b);return this.destination.islocal?d+".push("+c+");\n":b+".mutate("+d+", function(s) { scope.lookup(s.name).value.push("+c+"); }, this);"},Eden.AST.Append.prototype.execute=function(a,b,c,d){this.executed=1;var e=this.index.execute(a,b,c);e instanceof BoundValue&&(e=e.value);var f=eden.root.lookup(this.destination.name),g=f.value(c);g.push(e),f.assign(g,c,this)},Eden.AST.registerStatement(Eden.AST.Append),Eden.AST.Assignment=function(a){this.type="assignment",Eden.AST.BaseContext.apply(this),this.errors=a?a.errors:[],a&&a.warning&&(this.warning=a.warning),this.expression=a,this.lvalue=void 0,this.compiled=void 0,this.dirty=!1,this.value=void 0,this.compiled=void 0,this.name=""},Eden.AST.Assignment.prototype.left=function(a){this.lvalue=a,this.name=this.lvalue.name,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Assignment.prototype.generate=function(a,b,c){var d=this.lvalue.generate(a,b);return this.lvalue.islocal?(d+=" = ",d+=this.expression.generate(a,b,c),d+=";\n"):this.lvalue.hasListIndices()?(d=b+".listAssign("+d+",",d+=this.expression.generate(a,b,c),d+=", Symbol.localJSAgent, false, ",d+=this.lvalue.generateCompList(a,b),d+=");\n"):(d=b+".assign("+d+",",d+=this.expression.generate(a,b,c),d+=", Symbol.localJSAgent);\n")},Eden.AST.Assignment.prototype.compile=function(ctx){if(!this.compiled||this.dirty){console.log("Recompile assignment for "+this.lvalue.name),this.dirty=!1,ctx?ctx.scopes=this.scopes:ctx=this;var oldrb=ctx.dorebuild;ctx.dorebuild=!0;var rhs="(function(context,scope,cache,ctx) { \n",express=this.expression.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC);ctx.dorebuild=oldrb,ctx&&ctx.dirty&&(console.log("Dirty Assignment for "+this.lvalue.name),ctx.dirty=!1,this.dirty=!0),rhs+="var result = "+express+";",rhs+="return edenCopy(result);",rhs+="})",this.rhs=rhs,this.compiled=eval(rhs)}},Eden.AST.Assignment.prototype.execute=function(a,b,c,d){if(void 0!==this.expression){this.executed=1,this.compile(a),void 0===c&&(c=eden.root.scope),"shape_sphere_mesh"==this.lvalue.name&&console.log("SPHERE SCOPE",c);try{var e,f=this.lvalue.getSymbol(a,b,c);if(this.lvalue.hasListIndices()){e=this.compiled.call(f,eden.root,c,f.cache,a);var g=this.lvalue.executeCompList(a,c);f.listAssign(e,c,this,!1,g)}else e=this.compiled.call(f,eden.root,c,f.cache,a),void 0===e&&console.log("BAD ASSIGN",this.lvalue.name,this.rhs),f.assign(e,this.lvalue.islocal?void 0:c,this);void 0===e&&(this.warning=new Eden.RuntimeWarning(this,Eden.RuntimeWarning.UNDEFINED,this.source.split("=")[1].trim()))}catch(a){var h,i=d;a instanceof Eden.RuntimeError?(h=a,h.context=b,h.statement=this):h=/[0-9][0-9]*/.test(a.message)?new Eden.RuntimeError(b,parseInt(a.message),this,a.message):new Eden.RuntimeError(b,0,this,a),h.line=this.line,this.errors.push(h),i?eden.emit("error",[i,h]):console.log(h.prettyPrint()),console.log("ASSIGN SOURCE",this.rhs)}}},Eden.AST.registerStatement(Eden.AST.Assignment),Eden.AST.After=function(){this.type="after",Eden.AST.BaseStatement.apply(this),this.expression=void 0,this.statement=void 0,console.error("DEPRECATED USE OF AFTER")},Eden.AST.After.prototype.setExpression=function(a){this.expression=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.After.prototype.setStatement=function(a){this.statement=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.After.prototype.generate=function(a,b){return void 0===b&&(b="eden.root.scope"),"setTimeout((function() {"+this.statement.generate(a,b,{bound:!1})+"}), "+this.expression.generate(a,b,{bound:!1})+");\n"},Eden.AST.After.prototype.execute=function(ctx,base,scope){var statement="(function() { var scope = eden.root.scope;\n"+this.statement.generate(ctx,"root.scope")+"})";setTimeout(eval(statement),this.expression.execute(ctx,base,scope))},Eden.AST.registerStatement(Eden.AST.After),Eden.AST.BinaryOp=function(a){this.type="binaryop",this.op=a,this.errors=[],this.l=void 0,this.r=void 0,this.warning=void 0,"&"==this.op||"and"==this.op?this.op="&&":"|"!=this.op&&"or"!=this.op||(this.op="||")},Eden.AST.BinaryOp.prototype.left=Eden.AST.fnEdenASTleft,Eden.AST.BinaryOp.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.BinaryOp.prototype.getDependencies=function(a){this.l.getDependencies(a),this.r.getDependencies(a)},Eden.AST.BinaryOp.prototype.setRight=function(a){this.r=a,this.errors.push.apply(this.errors,a.errors),a&&a.warning&&(this.warning=a.warning)},Eden.AST.BinaryOp.prototype.getSize=function(){var a=1
;return"binaryop"==this.l.type&&(a+=this.l.getSize()),"binaryop"==this.r.type&&(a+=this.r.getSize()),a},Eden.AST.BinaryOp.prototype.generate=function(a,b,c){var d,e=this.l.generate(a,b,c),f=this.r.generate(a,b,c);switch(this.op){case"//":d="concat";break;case"==":d="equal";break;case"%":d="mod";break;case"^":d="pow";break;default:d="RAW"}return"RAW"!=d?"rt."+d+"(("+e+"),("+f+"))":"("+e+") "+this.op+" ("+f+")"},Eden.AST.BinaryOp.prototype.execute=function(ctx,base,scope){var rhs="(function(context,scope) { return ";return rhs+=this.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),rhs+=";})",eval(rhs)(eden.root,scope)},Eden.AST.Break=function(){this.type="break",Eden.AST.BaseStatement.apply(this)},Eden.AST.Break.prototype.generate=function(a,b){return"break; "},Eden.AST.Break.prototype.execute=function(a,b,c,d){var e=new Eden.RuntimeError(b,Eden.RuntimeError.NOTSUPPORTED,this,"Break not supported here");e.line=this.line,this.errors.push(e),Eden.Agent.emit("error",[d,e])},Eden.AST.registerStatement(Eden.AST.Break),Eden.AST.Case=function(){this.type="case",Eden.AST.BaseStatement.apply(this),this.datatype="",this.literal=void 0},Eden.AST.Case.prototype.setLiteral=function(a,b){this.datatype=a,this.literal=b},Eden.AST.Case.prototype.generate=function(a,b){return"string"==typeof this.literal?'case "'+this.literal+'": ':"case "+this.literal+": "},Eden.AST.Case.prototype.execute=function(a,b,c,d){var e=new Eden.RuntimeError(b,Eden.RuntimeError.NOTSUPPORTED,this,"Case not supported here");e.line=this.line,this.errors.push(e),Eden.Agent.emit("error",[d,e])},Eden.AST.registerStatement(Eden.AST.Case),Eden.AST.CodeBlock=function(){this.type="codeblock",Eden.AST.BaseContext.apply(this),this.params=void 0,this.locals=void 0,this.script=void 0,this.name="",this.prefix="o",this.names={}},Eden.AST.CodeBlock.prototype.setLocals=function(a){this.locals=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.CodeBlock.prototype.setParams=function(a){this.params=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.CodeBlock.prototype.setScript=function(a){this.script=a,a&&(a.parent=this,this.errors.push.apply(this.errors,a.errors))},Eden.AST.CodeBlock.prototype.generateInner=function(a){var b="(function(";if(this.params&&this.params.list)for(var c=0;c<this.params.list.length;c++)b+=this.params.list[c],c<this.params.list.length-1&&(b+=", "),this.names[this.params.list[c]]=this.params.list[c];if(b+=") {\n",this.locals&&this.locals.list)for(var c=0;c<this.locals.list.length;c++)b+="var "+this.locals.list[c]+";\n",this.names[this.locals.list[c]]=this.locals.list[c];this.scopes=[];var d=this.script.generate(this,"scope",Eden.AST.MODE_COMPILED);this.scopes.length>0&&(b+="var _scopes = [];\n");for(var e in this.dependencies)if(this.names[e]);else switch(b+="var o"+e+" = ",e){case"sqrt":b+="Math.sqrt;\n";break;default:b+='eden.root.lookup("'+e+'").value();\n'}return b+=d+"})"},Eden.AST.CodeBlock.prototype.generate=function(a){this.name=a.name;var b="(function(context, scope) {\n";if(b+="return (function(",this.params&&this.params.list)for(var c=0;c<this.params.list.length;c++)b+=this.params.list[c],c<this.params.list.length-1&&(b+=", "),this.names[this.params.list[c]]=this.params.list[c];if(b+=") {\n",this.locals&&this.locals.list)for(var c=0;c<this.locals.list.length;c++)b+="var "+this.locals.list[c]+";\n",this.names[this.locals.list[c]]=this.locals.list[c];this.scopes=[];var d=this.script.generate(this,"scope",Eden.AST.MODE_COMPILED);this.scopes.length>0&&(b+="var _scopes = [];\n");for(var e in this.dependencies)this.names[e]||(b+="var o"+e+" = ",b+='eden.root.lookup("'+e+'").value();\n');return b+=d+"}); })"},Eden.AST.registerContext(Eden.AST.CodeBlock),Eden.AST.Context=function(a){this.symbols={},this.parent=a},Eden.AST.Context.prototype.lookup=function(a){return console.log("LOOKUP CONTEXT",a),this.symbols[a]?this.symbols[a]:(this.symbols[a]=new Eden.AST.Handle(a),this.symbols[a])},Eden.AST.Continue=function(){this.type="continue",Eden.AST.BaseStatement.apply(this)},Eden.AST.Continue.prototype.generate=function(a,b){return"continue; "},Eden.AST.Continue.prototype.execute=function(a,b,c,d){var e=new Eden.RuntimeError(b,Eden.RuntimeError.NOTSUPPORTED,this,"Continue not supported here");e.line=this.line,this.errors.push(e),Eden.Agent.emit("error",[d,e])},Eden.AST.registerStatement(Eden.AST.Continue),Eden.AST.Declarations=function(){this.type="declarations",Eden.AST.BaseStatement.apply(this),this.list=[],this.kind="local"},Eden.AST.Declarations.prototype.execute=function(a,b,c,d){if(a){void 0===a.locals&&(a.locals={});for(var e=0;e<this.list.length;e++)a.locals[this.list[e]]=new Eden.AST.Local(this.list[e])}},Eden.AST.Declarations.prototype.generate=function(a,b,c){if("local"==this.kind){var d="var ";void 0===a.locals&&(a.locals={});for(var e=0;e<this.list.length;e++)a.locals[this.list[e]]=new Eden.AST.Local(this.list[e]),d+=this.list[e],e<this.list.length-1&&(d+=",");return d+=";\n"}if(this.kind="oracle"){var d="";void 0===a.locals&&(a.locals={});for(var e=0;e<this.list.length;e++)a.locals[this.list[e]]=new Eden.AST.Local(this.list[e]),d+="var "+this.list[e]+" = "+b+'.value("'+this.list[e]+'");\n';return d}},Eden.AST.registerStatement(Eden.AST.Declarations),Eden.AST.Default=function(){this.type="default",Eden.AST.BaseStatement.apply(this)},Eden.AST.Default.prototype.generate=function(a,b){return"default: "},Eden.AST.Default.prototype.execute=function(a,b,c,d){var e=new Eden.RuntimeError(b,Eden.RuntimeError.NOTSUPPORTED,this,"Default not supported here");e.line=this.line,this.errors.push(e),Eden.Agent.emit("error",[d,e])},Eden.AST.registerStatement(Eden.AST.Declarations),Eden.AST.Definition=function(){this.type="definition",Eden.AST.BaseContext.apply(this),this.expression=void 0,this.lvalue=void 0,this.name="__",this.dorebuild=!1},Eden.AST.Definition.prototype.getParameterByNumber=function(a){if(this.parent&&this.parent.getParameterByNumber)return this.parent.getParameterByNumber(a)},Eden.AST.Definition.prototype.setExpression=function(a){a&&a.warning&&(this.warning=a.warning),this.expression=a,this.errors=a.errors},Eden.AST.Definition.prototype.left=function(a){this.lvalue=a,this.name=this.lvalue.name,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Definition.prototype.generateDef=function(a,b){var c="function(context, scope, cache) {\n";this.locals=a?a.locals:void 0,this.params=a?a.params:void 0,this.backtickCount=0;var d=this.expression.generate(this,"scope",Eden.AST.MODE_DYNAMIC);if(this.backtickCount>0&&(c+="var btick = 0;\n"),this.scopes.length>0){c+="\tvar _scopes = [];\n";for(var e=0;e<this.scopes.length;e++)c+="\t_scopes.push("+this.scopes[e],c+=");\n",c+="_scopes["+e+"].rebuild();\n"}return c+="\treturn "+d+";\n}"},Eden.AST.Definition.prototype.generate=function(a,b){var c=this.lvalue.generate(a,b);if(this.scopes=[],this.dependencies={},this.lvalue.islocal)return"";if(this.lvalue.hasListIndices()){var d=this.lvalue.generateIndexList(this,b);c+=".addExtension("+this.lvalue.generateIdStr()+", function(context, scope, value) {\n\tvalue",c+=d+" = ",c+=this.expression.generate(this,"scope",Eden.AST.MODE_DYNAMIC);var e=[];for(var f in this.dependencies)e.push(f);return c=c+";\n}, undefined, this, "+JSON.stringify(e),c+=");\n"}c=b+".define("+c+","+this.generateDef(a,b);var e=[];for(var f in this.dependencies)e.push(f);return c=c+", Symbol.localJSAgent, "+JSON.stringify(e)+");\n"},Eden.AST.Definition.prototype.expire=function(){"scope"==this.expression.type&&this.expression.cleanUp()},Eden.AST.Definition.prototype.rebuild=function(sym){this.dependencies={},console.log("Rebuilt "+sym.name),this.dorebuild=!0;try{var rhs="("+this.generateDef(this)+")";sym.definition=eval(rhs)}catch(a){console.error(this,a)}this.dorebuild=!1},Eden.AST.Definition.prototype.execute=function(a,b,c,d){this.executed=1;var e=this.lvalue.getSymbol(a,b,c);this.scopes=[],this.dependencies={},this.backtickCount=0;try{if(this.lvalue.hasListIndices());else{var f=[],g={};this.expression.getDependencies(g);for(var h in g)f.push(h);this.dorebuild=!0,e.define(noop,this,f)}}catch(a){var i;console.log(void 0),i=a.message==Eden.RuntimeError.EXTENDSTATIC?new Eden.RuntimeError(b,Eden.RuntimeError.EXTENDSTATIC,this,"Can only define list items if the list is defined"):new Eden.RuntimeError(b,Eden.RuntimeError.UNKNOWN,this,a),this.errors.push(i),i.line=this.line,eden.emit("error",[d,this.errors[this.errors.length-1]])}},Eden.AST.registerStatement(Eden.AST.Definition),Eden.AST.Definition.prototype.needsRebuild=function(){return!!this.dorebuild||(this.expression&&"scope"==this.expression.type?this.expression.needsRebuild():void 0)},Eden.AST.Delete=function(){this.type="delete",Eden.AST.BaseStatement.apply(this),this.destination=void 0,this.index=void 0},Eden.AST.Delete.prototype.setDest=function(a){this.destination=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Delete.prototype.setIndex=function(a){this.index=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Delete.prototype.generate=function(a,b){var c=this.index.generate(a,b,{bound:!1});return this.destination.generate(a)+".mutate(scope, function(s) { scope.lookup(s.name).value.splice(rt.index("+c+"), 1); }, this);"},Eden.AST.Delete.prototype.execute=function(a,b,c){this.executed=1;var d=this.index.execute(a,b,c);d instanceof BoundValue&&(d=d.value),eden.root.lookup(this.destination.name).mutate(c,function(a){a.value().splice(d-1,1)},this)},Eden.AST.registerStatement(Eden.AST.Delete),Eden.AST.Do=function(){this.type="do",Eden.AST.BaseStatement.apply(this),this.name=void 0,this.script=void 0,this.parameters=[],this.params=[],this.scope=void 0,this.compScope=void 0,this.nscope=void 0,this.selector=void 0},Eden.AST.Do.prototype.addParameter=function(a){this.parameters.push(a),a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Do.prototype.setScript=function(a){this.script=a,this.script&&this.script.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Do.prototype.setName=function(a){a&&a.errors&&this.errors.push.apply(this.errors,a.errors),this.name=a},Eden.AST.Do.prototype.setScope=function(a){this.scope=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Do.prototype.getScope=function(ctx){if(this.scope&&void 0===this.compScope)try{this.compScope=eval("(function (context, scope) { var s = "+this.scope.generateConstructor(ctx,"scope")+"; s.rebuild(); return s; })")}catch(a){}return this.compScope},Eden.AST.Do.prototype.generate=function(a){return""},Eden.AST.Do.prototype.getParameters=function(a,b,c){for(var d=[],e=0;e<this.parameters.length;e++)d.push(this.parameters[e].execute(a,b,c));return d},Eden.AST.Do.prototype.execute=function(a,b,c,d){this.executed=1;var e;if(e=this.script?this.script:b.getActionByName(this.name))return e.execute(a,b,c,d);this.executed=3;var f=new Eden.RuntimeError(b,Eden.RuntimeError.ACTIONNAME,this,"Action '"+this.name+"' does not exist");this.parent&&(this.parent.executed=3),f.line=this.line,this.errors.push(f),Eden.Agent.emit("error",[d,f])},Eden.AST.registerStatement(Eden.AST.Do),Eden.AST.DoxyComment=function(a,b,c){this.type="doxycomment",this.content=a,this.startline=b,this.endline=c,this.tags=void 0,this.controls=void 0,this.parent=void 0},Eden.AST.DoxyComment.prototype.getHashTags=function(){return this.tags?Object.keys(this.tags):(this.stripped(),this.tags?Object.keys(this.tags):[])},Eden.AST.DoxyComment.prototype.hasTag=function(a){return void 0===this.tags&&this.getHashTags(),!!this.tags[a]},Eden.AST.DoxyComment.prototype.getControls=function(){return this.controls?this.controls:(this.stripped(),this.controls)},Eden.AST.DoxyComment.prototype.getProperty=function(a){var b=this.getControls();return b?b["@"+a]:void 0},Eden.AST.DoxyComment.prototype.stripped=function(){if(void 0===this.content)return"";for(var a={},b={},c=this.content.split("\n"),d="",e=0;e<c.length;e++)if("#"==c[e].charAt(0)?(c[e]=c[e].slice(1)," "==c[e].charAt(0)&&(c[e]=c[e].slice(1))):"*"==c[e].trim().charAt(0)&&(c[e]=c[e].trim().slice(1)," "==c[e].charAt(0)&&(c[e]=c[e].slice(1))),""!=c[e]){var f=c[e].trim();if("@"!=f.charAt(0)){for(var g=c[e].split(/[ \t]+/),h=0;h<g.length;h++)""!=g[h]&&"@"!=g[h].charAt(0)?(d+=g[h]+" ","#"==g[h].charAt(0)&&(b[g[h]]=!0)):d+=" ";d+="\n"}else{var i=f.indexOf(" ");if(-1==i)a[f]=!0;else{var j=f.substring(0,i),k=f.substring(i+1,f.length);void 0===a[j]&&(a[j]=[]),a[j].push(k)}c[e]=""}}else d+="\n";return this.controls=a,this.tags=b,d.trim()},Eden.AST.DoxyComment.prototype.brief=function(){var a=this.stripped();if(a)return a.split(".")[0]},Eden.AST.DoxyComment.prototype.pretty=function(){var a=this.stripped(),b=this.controls["@param"],c=EdenUI.Markdown.html(a);if(b&&b.length>0){c+='<div class="doxy-parameters">Parameters:';for(var d=0;d<b.length;d++){var a=b[d].split(/[ \t]+/);c+='<div class="doxy-parameter"><div class="doxy-parameter-name">'+a[0]+'</div><div class="doxy-parameter-details">'+a.slice(1).join(" ")+"</div></div>"}c+="</div>"}return c},Eden.AST.DoxyComment.prototype.getParamString=function(){var a=this.getControls()["@param"];if(a&&a.length>0){for(var b="(",c=0;c<a.length;c++)b+=a[c].split(/[ \t]+/)[0],c<a.length-1&&(b+=", ");return b+=")"}return"()"},Eden.AST.DummyStatement=function(){this.type="dummy",Eden.AST.BaseStatement.apply(this)},Eden.AST.DummyStatement.prototype.generate=function(){return""},Eden.AST.DummyStatement.prototype.execute=function(){},Eden.AST.registerStatement(Eden.AST.DummyStatement),Eden.AST.For=function(){this.type="for",Eden.AST.BaseStatement.apply(this),this.sstart=void 0,this.condition=void 0,this.inc=void 0,this.statement=void 0,this.compiled=void 0,this.started=!1,this.list=void 0,this.index=0,this.dirty=!1};Eden.AST.For.prototype.setStart=function(a){this.sstart=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.For.prototype.setCondition=function(a){this.condition=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.For.prototype.setIncrement=function(a){this.inc=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.For.prototype.setStatement=function(a){this.statement=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.For.prototype.generate=function(a,b,c){var d="for (";this.sstart?d+=this.sstart.generate(a,b,c)+" ":d+="; ",this.condition?d+=this.condition.generate(a,"scope",Eden.AST.MODE_DYNAMIC)+"; ":d+="; ";var e=this.inc.generate(a,b,c);return";"==e.charAt(e.length-2)&&(e=e.slice(0,-2)),d+=e+")\n",d+=this.statement.generate(a,b,c)},Eden.AST.For.prototype.getCondition=function(ctx){if(this.compiled&&0==this.dirty)return this.compiled;var express=this.condition.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC);ctx.dirty&&(this.dirty=!0,ctx.dirty=!1);var expfunc=eval("(function(context,scope){ return "+express+"; })");return this.compiled=expfunc,expfunc},Eden.AST.For.prototype.execute=function(a,b,c,d){if(this.executed=1,this.sstart&&"range"==this.sstart.type){void 0===this.list&&(this.sstart.second?(this.index=this.sstart.expression.execute(a,b,c,d),this.list=this.sstart.second.execute(a,b,c,d),this.index instanceof BoundValue&&(this.index=this.index.value),this.list instanceof BoundValue&&(this.list=this.list.value)):(this.list=this.sstart.expression.execute(a,b,c,d),this.index=0));var e=this.sstart.lvalue.getSymbol(a,b,c);if(this.sstart.second)return this.index<=this.list?(e.assign(this.index,c,this),this.index++,[this.statement,this]):(this.index=0,void(this.list=void 0));if(Array.isArray(this.list)){if(this.index<this.list.length){if(this.list[this.index]instanceof BoundValue){e.assign(this.list[this.index].value,c,this);var f=c.lookup(e.name);f&&(f.scope=this.list[this.index].scope)}else e.assign(this.list[this.index],c,this);return this.index++,[this.statement,this]}return this.index=0,void(this.list=void 0)}if(this.list instanceof BoundValue){if(this.index<this.list.value.length){if(this.list.scopes){e.assign(this.list.value[this.index],c,this);var f=c.lookup(e.name);f&&(f.scope=this.list.scopes[this.index])}else if(this.list.value[this.index]instanceof BoundValue){e.assign(this.list.value[this.index].value,c,this);var f=c.lookup(e.name);f&&(f.scope=this.list.value[this.index].scope)}else{e.assign(this.list.value[this.index],c,this);var f=c.lookup(e.name);f&&(f.scope=this.list.scope)}return this.index++,[this.statement,this]}return this.index=0,void(this.list=void 0)}}else if(this.sstart&&!this.started)return this.started=!0,[this.sstart,this];if(this.getCondition(a)(eden.root,c))return[this.statement,this.inc,this];this.started=!1},Eden.AST.registerStatement(Eden.AST.For),Eden.AST.Function=function(){this.type="function",Eden.AST.BaseStatement.apply(this),this.body=void 0,this.name=""},Eden.AST.Function.prototype.setBody=function(a){this.body=a,a&&(a.parent=this,this.errors.push.apply(this.errors,a.errors))},Eden.AST.Function.prototype.generate=function(a){var b=this.body.generate(a,"scope");return'context.lookup("'+this.name+'").define('+b+", this, []);\n"},Eden.AST.Function.prototype.execute=function(ctx,base,scope,agent){this.executed=1,this.doxyComment&&eden.updateDictionary(this.name,this.doxyComment);var body=this.body.generateInner(ctx,"scope"),sym=eden.root.lookup(this.name);try{var func=eval(body);sym.assign(func,scope,this),eden.f["func_"+this.name]=func}catch(a){console.log("In function:",this.name),console.error(a)}},Eden.AST.registerStatement(Eden.AST.Function),Eden.AST.FunctionCall=function(){this.type="functioncall",Eden.AST.BaseStatement.apply(this),this.lvalue=void 0,this.params=void 0},Eden.AST.FunctionCall.prototype.setParams=function(a){this.params=a;for(var b=0;b<a.length;b++)this.errors.push.apply(this.errors,a[b].errors)},Eden.AST.FunctionCall.prototype.left=function(a){this.lvalue=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.FunctionCall.prototype.getDependencies=function(a){for(var b=0;b<this.params.length;b++)this.params[b].getDependencies(a)},Eden.AST.FunctionCall.prototype.generate=function(a,b,c){if(void 0===this.lvalue){var d="(";if(this.params)for(var e=0;e<this.params.length;e++){var f=this.params[e].generate(a,b,c);d+="("+f+")",e!=this.params.length-1&&(d+=",")}return d+")"}var g=this.lvalue.generate(a,b),d=b+".value("+g+").call(context.lookup("+g+")";if(this.params)for(var e=0;e<this.params.length;e++){d+=",";var f=this.params[e].generate(a,b,c);d+="("+f+")"}return d+");"},Eden.AST.FunctionCall.prototype.execute=function(ctx,base,scope,agent){this.executed=1;var func="(function(context,scope) { return "+this.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC)+"; })";try{return eval(func).call(ctx,eden.root,scope)}catch(a){var err=new Eden.RuntimeError(base,Eden.RuntimeError.FUNCCALL,this,a);this.errors.push(err),err.line=this.line,eden.emit("error",[agent,err])}},Eden.AST.registerStatement(Eden.AST.FunctionCall),Eden.AST.Handle=function(a){console.log("MAKE HANDLE",a),this.name=a,this.cvalue=void 0,this.definition=void 0},Eden.AST.Handle.prototype.assign=function(a,b){console.log("HANDLE ASSIGN",this.name,a,b),b?b.lookup(this.name).value=a:this.cvalue=a},Eden.AST.Handle.prototype.define=function(a,b,c){console.log("HANDLE DEFINE",a),this.definition=a},Eden.AST.Handle.prototype.value=function(a){return console.log("HANDLE SCOPE",this.name,a,this.cvalue),this.definition?this.definition.call(this,a.context,a):a?a.lookup(this.name).value:this.cvalue},Eden.AST.If=function(){this.type="if",Eden.AST.BaseStatement.apply(this),this.condition="",this.statement=void 0,this.elsestatement=void 0,this.statements=[]},Eden.AST.registerStatement(Eden.AST.If),Eden.AST.If.prototype.setCondition=function(a){this.condition=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.If.prototype.setStatement=function(a){this.statement=a,a&&(this.statements.push(a),a.parent=this,this.errors.push.apply(this.errors,a.errors))},Eden.AST.If.prototype.setElse=function(a){this.elsestatement=a,a&&(this.statements.push(a),a.parent=this,this.errors.push.apply(this.errors,a.errors))},Eden.AST.If.prototype.generate=function(a,b,c){var d="if (";return d+=this.condition.generate(a,b,c),d+=") ",d+=this.statement.generate(a,b,c)+" ",this.elsestatement&&(d+="\nelse "+this.elsestatement.generate(a,b,c)+"\n"),d},Eden.AST.If.prototype.getCondition=function(ctx){var cond="(function(context,scope,ctx) { return ";return cond+=this.condition.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),cond+=";})",eval(cond)},Eden.AST.If.prototype.execute=function(a,b,c,d){return this.executed=1,this.getCondition(a)(eden.root,c,a)?[this.statement]:(this.executed=2,this.elsestatement?[this.elsestatement]:void 0)},Eden.AST.Import=function(){this.type="import",Eden.AST.BaseStatement.apply(this),this.path=void 0,this.selector=void 0,this.statements=void 0},Eden.AST.Import.prototype.setPath=function(a){this.path=a},Eden.AST.registerStatement(Eden.AST.Import),Eden.AST.Index=function(){this.type="index",this.expression=void 0,this.errors=[]},Eden.AST.Index.prototype.getDependencies=function(a){this.expression.getDependencies(a)},Eden.AST.Index.prototype.setExpression=function(a){this.expression=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Index.prototype.generate=function(a,b,c){return"[rt.index("+this.expression.generate(a,b,c)+")]"},Eden.AST.Index.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Insert=function(){this.type="insert",Eden.AST.BaseStatement.apply(this),this.destination=void 0,this.index=void 0,this.value=void 0},Eden.AST.Insert.prototype.setDest=function(a){this.destination=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Insert.prototype.setIndex=function(a){this.index=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Insert.prototype.setValue=function(a){this.value=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Insert.prototype.generate=function(a,b){var c=this.index.generate(a,b,{bound:!1}),d=this.value.generate(a,b,{bound:!1}),e=this.destination.generate(a);return this.destination.islocal?e+".splice(rt.index("+c+"), 0, ("+d+"));":e+".mutate(scope, function(s) { scope.lookup(s.name).value.splice(rt.index("+c+"), 0, ("+d+")); }, this);"},Eden.AST.Insert.prototype.execute=function(a,b,c){this.executed=1;var d=this.index.execute(a,b,c),e=this.value.execute(a,b,c);d instanceof BoundValue&&(d=d.value),e instanceof BoundValue&&(e=e.value),eden.root.lookup(this.destination.name).mutate(c,function(a){a.value().splice(d-1,0,e)},this)},Eden.AST.registerStatement(Eden.AST.Insert),Eden.AST.Length=function(){this.type="length",this.errors=[],this.l=void 0},Eden.AST.Length.prototype.left=Eden.AST.fnEdenASTleft,Eden.AST.Length.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Length.prototype.getDependencies=function(a){this.l.getDependencies(a)},Eden.AST.Length.prototype.generate=function(a,b,c){return"rt.length("+this.l.generate(a,b,c)+")"},Eden.AST.Length.prototype.execute=function(a,b,c,d){return rt.length(this.l.execute(a,b,c,d))},Eden.AST.Literal=function(a,b){this.type="literal",Eden.AST.BaseStatement.apply(this),this.datatype=a,this.value=b},Eden.AST.Literal.prototype.getDependencies=function(a){if("LIST"==this.datatype)for(var b=0;b<this.value.length;b++)this.value[b].getDependencies(a)},Eden.AST.Literal.prototype.generate=function(a,b,c){var d;switch(this.datatype){case"NUMBER":d=this.value;break;case"LIST":d="[";for(var e=0;e<this.value.length;e++)d+=this.value[e].generate(a,b,c),e!=this.value.length-1&&(d+=",");d+="]";break;case"CHARACTER":case"STRING":d='"'+this.value.replace(/\n/g,"\\n")+'"';break;case"BOOLEAN":case"JAVASCRIPT":d=this.value}return d},Eden.AST.Literal.prototype.execute=function(ctx,base,scope){switch(this.datatype){case"NUMBER":case"CHARACTER":case"BOOLEAN":return eval(this.value);case"STRING":return eval('"'+this.value+'"');case"LIST":var rhs="(function(context,scope) { return ";return rhs+=this.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),rhs+=";})",eval(rhs)(eden.root,scope);case"JAVASCRIPT":return eval(this.value)}},Eden.AST.registerStatement(Eden.AST.Literal),Eden.AST.LList=function(){this.type="lvaluelist",this.errors=[],this.llist=[]},Eden.AST.LList.prototype.append=function(a){this.llist.push(a),this.errors.push.apply(this.errors,a.errors)},Eden.AST.LList.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Local=function(a){console.log("MAKE LOCAL",a),this.name=a,this.cvalue=void 0,this.definition=void 0},Eden.AST.Local.prototype.assign=function(a,b){this.cvalue=a},Eden.AST.Local.prototype.define=function(a,b,c){this.definition=a},Eden.AST.Local.prototype.value=function(a){return this.definition?this.definition.call(this,a.context,a):this.cvalue},Eden.AST.LValue=function(){this.type="lvalue",this.errors=[],this.name=void 0,this.express=void 0,this.primary=void 0,this.lvaluep=void 0,this.islocal=!1},Eden.AST.LValue.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.LValue.prototype.setExtras=function(a){if(this.lvaluep=a,a)for(var b=0;b<a.length;b++)this.errors.push.apply(this.errors,a[b].errors)},Eden.AST.LValue.prototype.setObservable=function(a){this.name=a},Eden.AST.LValue.prototype.setPrimary=function(a){this.primary=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.LValue.prototype.setExpression=function(a){this.express=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.LValue.prototype.getSymbol=function(a,b,c){if(a&&a.locals&&"declarations"!=a.locals.type&&a.locals.hasOwnProperty(this.name))return this.islocal=!0,a.locals[this.name];if(this.name)return eden.root.lookup(this.name);if(this.primary){var d=this.primary.execute(a,b,c);return d instanceof BoundValue&&(d=d.value),d}if(this.express){var e=this.express.execute(a,b,c);return e instanceof BoundValue&&(e=e.value),eden.root.lookup(e)}},Eden.AST.LValue.prototype.hasListIndices=function(){return this.lvaluep&&this.lvaluep.length>0&&"index"==this.lvaluep[0].kind},Eden.AST.LValue.prototype.generateCompList=function(a,b){for(var c="[",d=0;d<this.lvaluep.length;d++)c+="rt.index("+this.lvaluep[d].indexexp.generate(a,b,{bound:!1})+")",d<this.lvaluep.length-1&&(c+=",");return c+="]"},Eden.AST.LValue.prototype.generateIndexList=function(a,b){for(var c="[",d=0;d<this.lvaluep.length;d++)c+="rt.index("+this.lvaluep[d].indexexp.generate(a,b,{bound:!1})+")",d<this.lvaluep.length-1&&(c+="][");return c+="]"},Eden.AST.LValue.prototype.generateIdStr=function(){return'"'+this.generateCompList()+'"'},Eden.AST.LValue.prototype.executeCompList=function(ctx,scope){for(var res=[],i=0;i<this.lvaluep.length;i++)if("index"==this.lvaluep[i].kind){var iexp=this.lvaluep[i].indexexp.generate(ctx,"scope",{bound:!1});res.push(rt.index(eval("(function(context,scope) { return "+iexp+"; })")(eden.root,scope)))}return res},Eden.AST.LValue.prototype.generate=function(a,b){if(this.name){if(a&&a.locals){if("declarations"==a.locals.type&&-1!=a.locals.list.indexOf(this.name)){this.islocal=!0;for(var c=this.name,d=0;d<this.lvaluep.length;d++)c+=this.lvaluep[d].generate(a,b,{bound:!1,usevar:"scriptexpr"==a.type});return c}if(a.locals.hasOwnProperty(this.name)){this.islocal=!0;for(var c=this.name,d=0;d<this.lvaluep.length;d++)c+=this.lvaluep[d].generate(a,b,{bound:!1,usevar:"scriptexpr"==a.type});return c}}if(a&&a.params&&-1!=a.params.list.indexOf(this.name)){this.islocal=!0;for(var c=this.name,d=0;d<this.lvaluep.length;d++)c+=this.lvaluep[d].generate(a,b,{bound:!1,usevar:"scriptexpr"==a.type});return c}return'"'+this.name+'"'}return this.primary?this.primary.generate(a,b,{bound:!1,usevar:"scriptexpr"==a.type}):this.express?this.express.generate(a,b,{bound:!1,usevar:"scriptexpr"==a.type}):void 0},Eden.AST.LValueComponent=function(a){this.type="lvaluecomponent",this.errors=[],this.kind=a,this.indexexp=void 0,this.observable=void 0},Eden.AST.LValueComponent.prototype.index=function(a){this.indexexp=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.LValueComponent.prototype.property=function(a){this.observable=a},Eden.AST.LValueComponent.prototype.generate=function(a,b){if("index"==this.kind)return"[rt.index("+this.indexexp.generate(a,b,{bound:!1})+")]"},Eden.AST.LValueComponent.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Modify=function(a,b){this.type="modify",Eden.AST.BaseContext.apply(this),this.errors=b?b.errors:[],this.kind=a,this.expression=b,this.lvalue=void 0},Eden.AST.Modify.prototype.left=function(a){this.lvalue=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Modify.prototype.generate=function(a,b,c){var d=this.lvalue.generate(a,b,c),e=d;0==this.lvalue.islocal?e=b+".assign("+d+","+b+".value("+d+")":e+=" = "+d;var f;return this.expression&&(f=this.expression.generate(a,b,Eden.AST.MODE_DYNAMIC)),"+="==this.kind?e+=" + "+f:"-="==this.kind?e+=" - "+f:"/="==this.kind?e+=" / "+f:"*="==this.kind?e+=" * "+f:"++"==this.kind?e+="+1":"--"==this.kind&&(e+="-1"),0==this.lvalue.islocal?e+=", Symbol.localJSAgent);\n":e+=";\n",e},Eden.AST.Modify.prototype.execute=function(ctx,base,scope,agent){var _scopes=[];this.executed=1;var sym=this.lvalue.getSymbol(ctx,base);if("++"==this.kind){var newval=sym.value(scope)+1;sym.assign(newval,scope,this)}else if("--"==this.kind){var newval=sym.value(scope)-1;sym.assign(newval,scope,this)}else{var rhs="(function(context,scope) { return ";rhs+=this.expression.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),rhs+=";})";for(var context=eden.root,i=0;i<this.scopes.length;i++)_scopes.push(eval(this.scopes[i]));this.scopes=[];var newval;switch(this.kind){case"+=":newval=rt.add(sym.value(scope),eval(rhs)(context,scope));break;case"-=":newval=rt.subtract(sym.value(scope),eval(rhs)(context,scope));break;case"/=":newval=rt.divide(sym.value(scope),eval(rhs)(context,scope));break;case"*=":newval=rt.multiply(sym.value(scope),eval(rhs)(context,scope))}sym.assign(newval,scope,this)}},Eden.AST.registerStatement(Eden.AST.Modify),Eden.AST.Parameter=function(a){this.type="parameter",this.index=a,this.errors=[],console.error("DEPRECATED PARAMETER")},Eden.AST.Parameter.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Parameter.prototype.generate=function(a,b,c){var d;if(-1==this.index){if(a&&a.parameters)return""+a.parameters.length;this.returnsbound=!1,d="0"}else if(a&&a.parameters){a.dirty=!0;var d=a.parameters[this.index-1];return this.returnsbound=d instanceof BoundValue,"ctx.parameters["+this.index+"-1]"}},Eden.AST.Primary=function(){this.type="primary",this.errors=[],this.observable="",this.extras=[],this.backtick=void 0},Eden.AST.Primary.prototype.setBackticks=function(a){this.backtick=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.Primary.prototype.setObservable=function(a){this.observable=a},Eden.AST.Primary.prototype.getObservable=function(){return this.observable},Eden.AST.Primary.prototype.prepend=function(a){this.extras.unshift(a),a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Primary.prototype.getDependencies=function(a){this.observable.startsWith("__")||(a[this.observable]=!0);for(var b=0;b<this.extras.length;b++)this.extras[b].getDependencies(a)},Eden.AST.Primary.prototype.generate=function(a,b,c){var d,e=this.observable,f=!1;if(a.names&&a.names[this.observable]&&(e=a.names[this.observable],f=!0),"__BACKTICKS__"==e){a&&void 0!==a.backtickCount&&(a.backtickCount,a.backtickCount++),d=a&&"definition"==a.type?"this.subscribeDynamic(btick++,"+this.backtick.generate(a,b,c)+", "+b+")":this.backtick.generate(a,b,c),e=d,f=!0}else{if("__JAVASCRIPT__"==e){d=this.backtick.generate(a,b,c);for(var g=0;g<this.extras.length;g++)d+=this.extras[g].generate(a,b,c);return d}switch(a&&a.dependencies&&(a.dependencies[this.observable]=!0),c){case Eden.AST.MODE_COMPILED:d=!f&&a.prefix?a.prefix+e:e;break;case Eden.AST.MODE_DYNAMIC:d=f?e:b+'.value("'+e+'")'}}if(this.extras.length>0){f||"functioncall"!=this.extras[0].type||(d="eden.f.func_"+e);for(var g=0;g<this.extras.length;g++)d+=this.extras[g].generate(a,b,c)}return d},
Eden.AST.Primary.prototype.execute=function(ctx,base,scope){var rhs="(function(context,scope) { return ";return rhs+=this.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),rhs+=";})",eval(rhs)(eden.root,scope)},Eden.AST.Primary.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Action=function(){this.type="action",Eden.AST.BaseStatement.apply(this),this.kindofaction="touch",this.triggers=[],this.body=void 0,this.name=""},Eden.AST.Action.prototype.kind=function(a){this.kindofaction=a},Eden.AST.Action.prototype.setBody=function(a){this.body=a,a&&(a.parent=this,this.errors.push.apply(this.errors,a.errors))},Eden.AST.Action.prototype.generate=function(a){var b=this.body.generate(a),c='context.lookup("'+this.name+'").define('+b+", this)";return this.triggers.length>0&&(c+=".observe("+JSON.stringify(this.triggers)+");\n"),c},Eden.AST.Action.prototype.execute=function(ctx,base,scope,agent){this.executed=1,this.doxyComment&&eden.updateDictionary(this.name,this.doxyComment);var body=this.body.generate(ctx),sym=eden.root.lookup(this.name);this.triggers.length>0?sym.define(eval(body),this,[]).observe(this.triggers):sym.define(eval(body),this,[])},Eden.AST.registerStatement(Eden.AST.Action),Eden.AST.Range=function(a){this.type="range",this.parent=void 0,this.errors=a?a.errors:[],this.expression=a,this.lvalue=void 0,this.start=0,this.end=0},Eden.AST.Range.prototype.setSource=function(a,b){this.start=a,this.end=b},Eden.AST.Range.prototype.setSecond=function(a){this.second=a,a&&a.errors&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Range.prototype.left=function(a){this.lvalue=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Range.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Require=function(){this.type="require",Eden.AST.BaseStatement.apply(this),this.expression=void 0},Eden.AST.Require.prototype.setExpression=function(a){this.expression=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Require.prototype.generate=function(a){return"edenUI.loadPlugin("+this.expression.generate(a,"scope",{bound:!1})+");"},Eden.AST.Require.prototype.execute=function(a,b,c){this.executed=1,edenUI.loadPlugin(this.expression.execute(a,b,c))},Eden.AST.registerStatement(Eden.AST.Require),Eden.AST.Return=function(){this.type="return",Eden.AST.BaseStatement.apply(this),this.result=void 0},Eden.AST.Return.prototype.setResult=function(a){this.result=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.Return.prototype.generate=function(a,b,c){if(this.result){return"return "+this.result.generate(a,b,c)+";\n"}return"return;\n"},Eden.AST.Return.prototype.execute=function(a,b,c,d){var e=new Eden.RuntimeError(b,Eden.RuntimeError.NOTSUPPORTED,this,"Return not supported here");e.line=this.line,this.errors.push(e),Eden.Agent.emit("error",[d,e])},Eden.AST.registerStatement(Eden.AST.Return),Eden.AST.Scope=function(){this.type="scope",this.errors=[],this.range=!1,this.overrides={},this.expression=void 0,this.mergeoptimised=!1,this.exprnum=0,this.exprs={},this.compiled=void 0,this.params={},this.transpiles=[]},Eden.AST.Scope.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Scope.prototype.needsRebuild=function(){return!0},Eden.AST.Scope.prototype.getDependencies=function(a){this.expression.getDependencies(a);for(var b in this.overrides){var c=this.overrides[b];c.start&&c.start.getDependencies(a),c.end&&c.end.getDependencies(a)}},Eden.AST.Scope.prototype.prepend=function(a){this.primary.prepend(a)},Eden.AST.Scope.prototype.setExpression=function(a){this.expression=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Scope.prototype.addOverride=function(a,b,c,d,e){this.errors.push.apply(this.errors,a.errors),e&&(this.range=!0),d?(this.range=!0,this.overrides[a.observable]={start:b,end:d,increment:c,components:a.components,isin:e},this.errors.push.apply(this.errors,b.errors),this.errors.push.apply(this.errors,c.errors),this.errors.push.apply(this.errors,d.errors)):c?(this.range=!0,this.overrides[a.observable]={start:b,end:c,components:a.components,isin:e},this.errors.push.apply(this.errors,b.errors),this.errors.push.apply(this.errors,c.errors)):b&&(this.overrides[a.observable]={start:b,end:void 0,components:a.components,isin:e},this.errors.push.apply(this.errors,b.errors))},Eden.AST.Scope.prototype.cleanUp=function(){for(var a=0;a<this.transpiles.length;a++)console.log("Removing transpile",this.transpiles[a].name);this.transpiles=[]},Eden.AST.Scope.prototype.findBySignature=function(a,b,c){for(var d=0;d<this.transpiles.length;d++)if(this.transpiles[d].test(b,c)){var e=this.transpiles[d];return console.log("Found existing: ",e.name),e}var f=new Eden.AST.Scope.Transpile(this,a);return this.transpiles.push(f),f.build(a),f},Eden.AST.Scope.prototype.generateCustom=function(a,b,c){a.dorebuild&&this.cleanUp(),a.dirty=!0;var d=this.findBySignature(a,b,c);if(a.dependencies)for(var e in d.uses)a.dependencies[e]=!0;return d},Eden.AST.Scope.prototype.generate=function(a,b,c){a.dorebuild&&this.cleanUp(),a.dirty=!0;var d=this.findBySignature(a,[],[]);if(a.dependencies)for(var e in d.uses)a.dependencies[e]=!0;var f="eden.s."+d.name+"(";if(c===Eden.AST.MODE_COMPILED)for(var g=0;g<d.paramsList.length;g++)f+="o"+d.paramsList[g],g<d.paramsList.length-1&&(f+=", ");else for(var g=0;g<d.paramsList.length;g++)f+='eden.root.lookup("'+d.paramsList[g]+'").value()',g<d.paramsList.length-1&&(f+=", ");return f+=")"},Eden.AST.Scope.prototype.execute=function(ctx,base,scope){var context={scopes:[]},gen=this.generate(context,"scope",Eden.AST.MODE_DYNAMIC),rhs="(function(context,scope) {\n";return rhs+="return ",rhs+=gen,rhs+=";})",eval(rhs)(eden.root,scope)},Eden.AST.ScopedScript=function(a,b){this.type="scopedscript",this.statements=a,this.scope=b},Eden.AST.ScopedScript.prototype.execute=function(a,b,c,d){return this.statements},Eden.AST.ScopePath=function(){this.type="scopepath",this.errors=[],this.primary=void 0,this.path=new Eden.AST.Primary,this.scopestr=void 0},Eden.AST.ScopePath.prototype.prepend=function(a){this.path.prepend(a)},Eden.AST.ScopePath.prototype.setObservable=function(a){this.path.setObservable(a)},Eden.AST.ScopePath.prototype.setBackticks=function(a){this.path.setBackticks(a)},Eden.AST.ScopePath.prototype.getObservable=function(){return this.primary.getObservable()},Eden.AST.ScopePath.prototype.getScopeString=function(){return this.scopestr},Eden.AST.ScopePath.prototype.setPrimary=function(a){this.primary=a,this.primary.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.ScopePath.prototype.generate=function(a,b,c){var d=this.path.generate(a,b,{bound:!0,scopeonly:!0});return this.primary.generate(a,d,c)},Eden.AST.ScopePath.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.ScopePattern=function(){this.type="scopepattern",this.observable="NONAME",this.components=[],this.errors=[]},Eden.AST.ScopePattern.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.ScopePattern.prototype.setObservable=function(a){this.observable=a},Eden.AST.ScopePattern.prototype.addListIndex=function(a){this.components.push(a),a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Script=function(){this.type="script",Eden.AST.BaseScript.apply(this),this.name=void 0,this.active=!1,this.base=void 0,this.prefix="",this.postfix=""},Eden.AST.registerScript(Eden.AST.Script),Eden.AST.Script.prototype.getActionByName=function(a){for(var b=0;b<this.statements.length;b++)if("script"==this.statements[b].type&&this.statements[b].name==a)return this.statements[b]},Eden.AST.Script.prototype.getSource=function(){return this.prefix+this.getInnerSource()+this.postfix},Eden.AST.Script.prototype.getInnerSource=function(){for(var a="",b=0;b<this.statements.length;b++)a+=this.statements[b].getSource();return a},Eden.AST.Script.prototype.patchInner=function(a){for(var b=this;b.parent;)b=b.parent;for(var c={},d=0;d<this.statements.length;d++){var e=this.statements[d];void 0===c[e.id]&&(c[e.id]=[]),c[e.id].push(e)}for(var d=0;d<a.statements.length;d++){var e=a.statements[d];e.buildID(),c[e.id]&&c[e.id].length>0?(a.replaceChild(d,c[e.id][0]),c[e.id].shift(),0==c[e.id].length&&delete c[e.id]):"dummy"!=e.type&&this.indexed&&e.addIndex()}for(var f in c)for(var g=c[f],d=0;d<g.length;d++)"when"==g[d].type&&g[d].enabled&&eden.project.removeAgent(g[d]),this.indexed&&0==g[d].executed?g[d].removeIndex():g[d].destroy();if(void 0===this.parent)for(var d=0;d<a.statements.length;d++)"script"==a.statements[d].type&&"ACTIVE"==a.statements[d].name?(a.statements[d]=eden.root,Eden.Index.remove(a.statements[d])):a.statements[d].parent=this;else for(var d=0;d<a.statements.length;d++)a.statements[d].parent=this;this.statements=a.statements},Eden.AST.Script.prototype.patchOuter=function(a){},Eden.AST.Script.prototype.getLine=function(){return this.line},Eden.AST.Script.prototype.isRemote=function(){for(var a=this;a.parent;)a=a.parent;return a.base.origin.remote},Eden.AST.Script.prototype.setLocals=function(a){this.locals=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Script.prototype.subscribeDynamic=function(a,b){return eden.root.lookup(b)},Eden.AST.Script.prototype.getParameterByNumber=function(a){if(this.parameters)return this.parameters[a-1]},Eden.AST.Script.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Script.prototype.setName=function(a,b){this.name=b,this.shortName=b},Eden.AST.Script.prototype.setSource=function(a,b,c){if(this.start=a,this.end=b,c){0==this.statements.length||(this.prefix=c.substring(0,this.statements[0].start-a),this.postfix=c.substring(this.statements[this.statements.length-1].end-a)),this.numlines=0;for(var d=0;d<this.prefix.length;d++)"\n"==this.prefix.charAt(d)&&this.numlines++;for(var d=0;d<this.postfix.length;d++)"\n"==this.postfix.charAt(d)&&this.numlines++}},Eden.AST.Script.prototype.execute=function(a,b,c,d){var e=[];if(this.executed=1,this.locals&&this.locals.list.length>0){void 0===a.locals&&(a.locals={});for(var f=0;f<this.locals.list.length;f++)a.locals[this.locals.list[f]]=new Eden.AST.Local(this.locals.list[f])}for(var f=0;f<this.statements.length;f++)"script"!=this.statements[f].type&&"section"!=this.statements[f].type&&e.push(this.statements[f]);return e},Eden.AST.Script.prototype.generate=function(a,b,c){for(var d="{\n",e=a.scopes.length,f=0;f<this.statements.length;f++){var g=this.statements[f].generate(a,b,c);if(a.scopes.length>e){for(var h=e;h<a.scopes.length;h++)d+="_scopes.push("+a.scopes[h]+");\n",d+="_scopes[_scopes.length-1].rebuild();\n";e=a.scopes.length}d+=g}return d+="}"},Eden.AST.Virtual=function(a){this.type="script",Eden.AST.BaseScript.apply(this),this.name=a},Eden.AST.Virtual.prototype.getSource=function(){return""},Eden.AST.Virtual.prototype.getInnerSource=function(){return""},Eden.AST.ScriptExpr=function(){this.type="scriptexpr",this.errors=[],this.statements=[],this.locals={},this.dependencies={}},Eden.AST.ScriptExpr.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.ScriptExpr.prototype.append=function(a){this.statements.push(a),a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.ScriptExpr.prototype.generate=function(a,b){for(var c="(function(escope) {\nescope.isolate = true;\nif (cache) cache.scope = escope;\nvar context = new Eden.AST.Context(context);\nescope.context = context;\n",d=0;d<this.statements.length;d++){if("declarations"==this.statements[d].type&&"oracle"==this.statements[d].kind)for(var e=0;e<this.statements[d].list.length;e++)a.dependencies[this.statements[d].list[e]]=!0;c+=this.statements[d].generate(this,"escope",{bound:!1})}return c=c+"}).call(this,new Scope(context,"+b+",[],false,this,false))"},Eden.AST.Subscribers=function(){this.type="subscribers",Eden.AST.BaseStatement.apply(this),this.list=[],this.lvalue=void 0},Eden.AST.Subscribers.prototype.left=function(a){this.lvalue=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Subscribers.prototype.execute=function(a,b,c){},Eden.AST.Subscribers.prototype.setList=function(a){this.list=a},Eden.AST.registerStatement(Eden.AST.Subscribers),Eden.AST.Switch=function(){this.type="switch",Eden.AST.BaseStatement.apply(this),this.expression="",this.statement=void 0,this.compiled=void 0},Eden.AST.Switch.prototype.setExpression=function(a){this.expression=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Switch.prototype.setStatement=function(a){this.statement=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.Switch.prototype.generate=function(a,b){void 0===b&&(b="eden.root.scope");var c="switch(";return c+=this.expression.generate(a,b,{bound:!1}),c+=") "+this.statement.generate(a,b)},Eden.AST.Switch.prototype.getSelector=function(ctx){if(this.compiled)return this.compiled;var cond="(function(context,scope) { return ";return cond+=this.expression.generate(ctx,"scope",{bound:!1}),cond+=";})",this.compiled=eval(cond),this.compiled},Eden.AST.Switch.prototype.execute=function(a,b,c,d){var e=new Eden.RuntimeError(b,Eden.RuntimeError.NOTSUPPORTED,this,"Switch not supported here");e.line=this.line,this.errors.push(e),Eden.Agent.emit("error",[d,e])},Eden.AST.registerStatement(Eden.AST.Switch),Eden.AST.TernaryOp=function(a){this.type="ternaryop",this.op=a,this.errors=[],this.first=void 0,this.second=void 0,this.condition=void 0,this.warning=void 0},Eden.AST.TernaryOp.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.TernaryOp.prototype.getDependencies=function(a){this.condition.getDependencies(a),this.first.getDependencies(a),this.second.getDependencies(a)},Eden.AST.TernaryOp.prototype.setFirst=function(a){this.first=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors),a&&a.warning&&(this.warning=a.warning)},Eden.AST.TernaryOp.prototype.setSecond=function(a){this.second=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors),a&&a.warning&&(this.warning=a.warning)},Eden.AST.TernaryOp.prototype.setCondition=function(a){this.condition=a,a.errors.length>0&&this.errors.push.apply(this.errors,a.errors),a&&a.warning&&(this.warning=a.warning)},Eden.AST.TernaryOp.prototype.left=function(a){void 0===this.condition?this.condition=a:this.first=a,a&&a.warning&&(this.warning=a.warning)},Eden.AST.TernaryOp.prototype.generate=function(a,b,c){return"(("+this.condition.generate(a,b,c)+")?("+this.first.generate(a,b,c)+"):("+this.second.generate(a,b,c)+"))"},Eden.AST.TernaryOp.prototype.execute=function(ctx,base,scope){var rhs="(function(context,scope) { return ";return rhs+=this.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),rhs+=";})",eval(rhs)(eden.root,scope)},Eden.AST.UnaryOp=function(a,b){this.type="unaryop",this.op=a,this.errors=b.errors,this.r=b},Eden.AST.UnaryOp.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.UnaryOp.prototype.getDependencies=function(a){this.r.getDependencies(a)},Eden.AST.UnaryOp.prototype.generate=function(a,b,c){var d,e=this.r.generate(a,b,c);return"!"==this.op?d="!("+e+")":"&"==this.op?(d="context.lookup("+e+")",console.log(d)):"-"==this.op?d="-("+e+")":"*"==this.op&&(d=e+".value("+b+")"),d},Eden.AST.UnaryOp.prototype.execute=function(ctx,base,scope){var rhs="(function(context,scope) { return ";return rhs+=this.generate(ctx,"scope",Eden.AST.MODE_DYNAMIC),rhs+=";})",eval(rhs)(eden.root,scope)},Eden.AST.Wait=function(){this.type="wait",Eden.AST.BaseStatement.apply(this),this.delay=void 0,this.compiled_delay=void 0},Eden.AST.Wait.prototype.setDelay=function(a){this.delay=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)};Eden.AST.Wait.prototype.compile=function(ctx){if(void 0!==this.delay&&!this.compiled_delay){var source="(function(context,scope) { return ";source+=this.delay.generate(ctx,"scope",{bound:!1}),source+=";})",this.compiled_delay=eval(source)}},Eden.AST.Wait.prototype.generate=function(a,b){return"yield "+this.delay+";"},Eden.AST.registerStatement(Eden.AST.Wait),Eden.AST.When=function(){this.type="when",Eden.AST.BaseContext.apply(this),this.name="*When",this.id=0,this.expression=void 0,this.active=!1,this.compiled=void 0,this.scope=void 0,this.compScope=void 0,this.local=!1,this.dirty=!1,this.statement=void 0,this.enabled=!1,this.statements=[],this.retrigger=!1},Eden.AST.registerContext(Eden.AST.When),Eden.AST.When.prototype.getSource=function(){return this.statement?this.prefix+this.statement.getSource()+this.postfix:this.prefix+this.postfix},Eden.AST.When.prototype.setSource=function(a,b,c){if(this.start=a,this.end=b,c){this.statement?(this.prefix=c.substring(0,this.statement.start-a),this.postfix=c.substring(this.statement.end-a)):(this.prefix=c.substring(0,b),this.postfix=""),this.numlines=0;for(var d=0;d<this.prefix.length;d++)"\n"==this.prefix.charAt(d)&&this.numlines++;for(var d=0;d<this.postfix.length;d++)"\n"==this.postfix.charAt(d)&&this.numlines++}},Eden.AST.When.prototype.getLine=function(){return this.line},Eden.AST.When.prototype.doDebug=function(){return this.doxyComment&&this.doxyComment.getControls()["@debug"]},Eden.AST.When.prototype.setScope=function(a){this.scope=a},Eden.AST.When.prototype.subscribeDynamic=function(a,b,c){return console.log("Subscribe Dyn: ",b,c),eden.project.addTrigger(this,b,c),eden.root.lookup(b)},Eden.AST.When.prototype.setExpression=function(a){this.expression=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.When.prototype.setStatement=function(a){this.statement=a,a&&(this.statements.push(a),this.errors.push.apply(this.errors,a.errors))},Eden.AST.When.prototype.generate=function(){return""},Eden.AST.When.prototype.compile=function(base){var cond="(function(context,scope) { try { return ";if(cond+=this.expression.generate(this,"scope",Eden.AST.MODE_DYNAMIC),cond+="; } catch(e) {} })",this.compiled=eval(cond),this.scope&&void 0===this.compScope)try{this.compScope=eval("(function (context, scope) { var s = "+this.scope.generateConstructor(this,"scope")+"; s.rebuild(); return s; })")}catch(a){}return""},Eden.AST.When.prototype.trigger=function(){var a=eden.root.scope,b=eden.project.ast;if(0==this.active){this.active=!0;var c=this.executeReal(this,b,a||eden.root.scope);if(c&&(void 0===eden.peer||eden.peer.authoriseWhen(this))){var d=this;b.executeStatements(c,-1,this,function(){d.active=!1,d.retrigger&&(d.retrigger=!1,setTimeout(function(){d.trigger()},0))},this)}else this.active=!1}else this.retrigger=!0},Eden.AST.When.prototype.executeReal=function(a,b,c){this.executed=1,this.compiled||this.compile(b),this.doxyComment&&this.doxyComment.getControls()["@local"]&&(this.local=!0),this.locals={};if(void 0!==c&&c!==eden.root.scope||(c=this.compScope?this.compScope.call(this,eden.root,eden.root.scope):eden.root.scope),c.range){c.range=!1;for(var d=[];;){var e=c.clone();if(this.compiled.call(this,eden.root,c)?d.push(new Eden.AST.ScopedScript(this.statement.statements,e)):this.executed=2,0==c.next())break}return c.range=!0,d}if(this.compiled.call(this,eden.root,c))return c!==eden.root.scope&&"script"==this.statement.type?[new Eden.AST.ScopedScript(this.statement.statements,c)]:[this.statement];this.executed=2},Eden.AST.When.prototype.execute=function(a,b,c,d){this.enabled||eden.project.registerAgent(this),this.enabled=!0,d&&!d.loading&&b.executeStatements(this.executeReal(a,b,c,d),-1,this,void 0,this)},Eden.AST.When.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.While=function(){this.type="while",Eden.AST.BaseStatement.apply(this),this.condition=void 0,this.statement=void 0,this.compiled=void 0},Eden.AST.While.prototype.setCondition=function(a){this.condition=a,this.errors.push.apply(this.errors,a.errors)},Eden.AST.While.prototype.setStatement=function(a){this.statement=a,a&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.While.prototype.generate=function(a,b){var c="while ("+this.condition.generate(a,b,{bound:!1});return c+=") ",c+=this.statement.generate(a,b)+"\n"},Eden.AST.While.prototype.getCondition=function(ctx){if(this.compiled)return this.compiled;var express=this.condition.generate(ctx,"scope",{bound:!1}),expfunc=eval("(function(context,scope){ return "+express+"; })");return this.compiled=expfunc,expfunc},Eden.AST.While.prototype.execute=function(a,b,c,d){if(this.executed=1,this.getCondition(a)(eden.root,c))return[this.statement,this]},Eden.AST.registerStatement(Eden.AST.While),Eden.AST.Query=function(){this.type="query",Eden.AST.BaseStatement.apply(this),this.selector=void 0,this.restypes=[],this.modexpr=void 0,this.kind="="},Eden.AST.Query.prototype.setSelector=function(a){this.selector=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Query.prototype.setResultTypes=function(a){this.restypes=a},Eden.AST.Query.prototype.setModify=function(a,b){this.modexpr=a,this.kind=b,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Query.prototype.generate=function(a,b,c){var d="Eden.Selectors.query("+this.selector.generate(a,b,{bound:!1})+', "'+this.restypes.join(",")+'")';return console.log("QUERY",d),c.bound?"new BoundValue("+d+","+b+")":d},Eden.AST.Query.prototype.execute=function(a,b,c,d){if(this.executed=1,void 0===this.modexpr){var e=Eden.Selectors.query(this.selector.execute(a,b,c,d),this.restypes);b.lastresult=e}else{var f=this.selector.execute(a,b,c,d),g=this.modexpr.execute(a,b,c,d);switch(this.kind){case"=":Eden.Selectors.assign(f,this.restypes,g);break;case"+=":Eden.Selectors.append(f,this.restypes,g);break;case"//=":Eden.Selectors.concat(f,this.restypes,g)}}},Eden.AST.registerStatement(Eden.AST.Query),Eden.AST.Alias=function(){this.type="script",Eden.AST.BaseStatement.apply(this),this.name=void 0,this.active=!1,this.selector=void 0},Eden.AST.Alias.prototype.setName=function(a){this.name=a},Eden.AST.Alias.prototype.setSelector=function(a){this.selector=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Alias.prototype.execute=function(a,b,c,d){return Eden.Selectors.query(this.selector.execute(a,b,c,d))},Eden.AST.Alias.prototype.generate=function(a,b,c){},Eden.AST.registerStatement(Eden.AST.Alias),Object.defineProperty(Eden.AST.Alias.prototype,"statements",{get:function(){if(this.selector){var a=this.selector.execute(this,eden.project.ast,eden.root.scope,this);return Eden.Selectors.query(a)}return[]}}),Eden.AST.Alias.addIndex=function(){this.buildID(),Eden.Index.update(this)},Eden.AST.Alias.removeIndex=function(){Eden.Index.remove(this)},Eden.AST.Alias.destroy=function(){this.executed<1&&Eden.Index.remove(this),this.parent=void 0,this.executed=-1},Eden.AST.Indexed=function(){this.type="indexed",this.indexes=[],this.expression=void 0,this.errors=[]},Eden.AST.Indexed.prototype.left=Eden.AST.fnEdenASTleft,Eden.AST.Indexed.prototype.error=Eden.AST.fnEdenASTerror,Eden.AST.Indexed.prototype.setExpression=function(a){this.expression=a,a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Indexed.prototype.addIndex=function(a){this.indexes.push(a),a&&a.errors.length>0&&this.errors.push.apply(this.errors,a.errors)},Eden.AST.Indexed.prototype.generate=function(a,b,c){for(var d="",e=0;e<this.indexes.length;e++)d+=this.indexes[e].generate(a,b,c);var f="("+this.expression.generate(a,b,{bound:!1})+")"+d;return c.bound?"new BoundValue("+f+","+b+")":f},Eden.AST.Section=function(){this.type="section",Eden.AST.BaseStatement.apply(this),this.name=void 0,this.depth=1},Eden.AST.Section.prototype.setName=function(a){this.name=a;var b=a.match(/#[\w]+/g);null!==b&&(void 0===this.tags?this.tags=b:this.tags=this.tags.concat(b))},Eden.AST.Section.prototype.generate=function(a,b){return""},Eden.AST.Section.prototype.execute=function(a,b,c,d){for(var e=[],f=this.nextSibling;f&&("section"!=f.type||f.depth>this.depth);)"dummy"!=f.type&&"script"!=f.type&&"section"!=f.type&&e.push(f),f=f.nextSibling;return e},Eden.AST.registerStatement(Eden.AST.Section),Eden.AST.Section.prototype.getRange=function(a){for(var b=this.getStartLine(a),c=this.nextSibling;c&&c.nextSibling&&("section"!=c.nextSibling.type||c.nextSibling.depth>this.depth);)c=c.nextSibling;return c&&"dummy"==c.type&&(c=c.previousSibling),[b,c?c.getEndLine(a):b+this.getNumberOfLines()]},Eden.AST.prototype.pACTIONBODY=function(){var a=new Eden.AST.CodeBlock,b=this.parent;return this.parent=a,"{"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONOPEN)),this.parent=b,a):(this.next(),a.setLocals(this.pLOCALS()),a.locals.errors.length>0?(this.parent=b,a):(a.setScript(this.pSCRIPT()),"}"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCLOSE)),this.parent=b,a):(this.next(),this.parent=b,a)))},Eden.AST.prototype.pAFTER=function(){var a=new Eden.AST.After;if("("!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.AFTEROPEN)),a;this.next();var b=this.pEXPRESSION();if(a.setExpression(b),a.errors.length>0)return a;if(")"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.AFTEROPEN)),a;this.next();var c=this.pSTATEMENT();return void 0===c&&a.error(new Eden.SyntaxError(this,Eden.SyntaxError.AFTERNOSTATEMENT)),a.setStatement(c),a.warning=new Eden.SyntaxWarning(this,a,Eden.SyntaxWarning.DEPRECATED,"'after' should not be used, use 'wait' instead"),a},Eden.AST.prototype.pPARAMS=function(){var a=new Eden.AST.Declarations;for(a.kind="oracle";"para"==this.token||"oracle"==this.token;){this.next();var b=this.pOLIST();if(a.list.push.apply(a.list,b),0==b.length||"NONAME"==b[b.length-1])return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.PARAMNAME)),a;if(";"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.PARAMSEMICOLON)),a;this.next()}return a},Eden.AST.prototype.pLOCALS=function(){for(var a=new Eden.AST.Declarations;"auto"==this.token||"local"==this.token;){this.next();var b=this.pOLIST();if(a.list.push.apply(a.list,b),0==b.length||"NONAME"==b[b.length-1])return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LOCALNAME)),a;if(";"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LOCALSEMICOLON)),a;this.next()}return a},Eden.AST.prototype.pDO=function(){var a=new Eden.AST.Do,b=this.parent;if(this.parent=a,"{"==this.token){this.next();var c=this.pSCRIPT();return c.parent=a,"}"!=this.token?(a.setScript(c),a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCLOSE)),this.parent=b,a):(this.next(),a.setScript(c),this.parent=b,"with"!=this.token&&"::"!=this.token||(this.next(),a.setScope(this.pSCOPE())),a)}if("OBSERVABLE"!=this.token&&"."!=this.token&&">>"!=this.token&&">"!=this.token&&"<"!=this.token&&"<<"!=this.token&&":"!=this.token&&"*"!=this.token&&"@"!=this.token&&"#"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.DONAME)),this.parent=b,a;var d=this.pCODESELECTOR();if(a.setName(d),a.errors.length>0)return this.parent=b,a;if("with"==this.token||"::"==this.token)this.next(),a.setScope(this.pSCOPE());else if(";"!=this.token)for(var e=this.pELIST(),f=0;f<e.length;f++)if(a.addParameter(e[f]),a.errors.length>0)return this.parent=b,a;return";"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),this.parent=b,a):(this.next(),this.parent=b,a)},Eden.AST.prototype.pEXPRESSION_PPPPP=function(){if("#"==this.token)return this.next(),new Eden.AST.Length},Eden.AST.prototype.pEXPRESSION_PPPPPP=function(){if("?"==this.token){this.next();var a=new Eden.AST.TernaryOp("?");return a.setFirst(this.pEXPRESSION()),(a.warning=new Eden.SyntaxWarning(this,a,Eden.SyntaxWarning.DEPRECATED,"use of ? for 'if'."),a.errors.length>0)?a:":"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.TERNIFCOLON)),a):(this.next(),a.setSecond(this.pEXPRESSION()),a)}if("if"==this.token){this.next();var a=new Eden.AST.TernaryOp("?");return a.setCondition(this.pEXPRESSION()),a.errors.length>0?a:"else"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.TERNIFCOLON)),a):(this.next(),a.setSecond(this.pEXPRESSION()),a)}},Eden.AST.prototype.pEXPRESSION_PLAIN=function(){for(var a=this.pTERM();"&&"==this.token||"||"==this.token||"&"==this.token||"|"==this.token||"and"==this.token||"or"==this.token;){var b=new Eden.AST.BinaryOp(this.token);this.next(),b.left(a),b.setRight(this.pTERM()),a=b}return a},Eden.AST.prototype.pEXPRESSION=function(){var a;if("{"==this.token){if(this.next(),a=this.pSCRIPTEXPR(),"}"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCLOSE)),a;this.next()}else a=this.pEXPRESSION_PLAIN();if("with"==this.token||"::"==this.token){this.next();var b=this.pSCOPE();return b.setExpression(a),b}return a},Eden.AST.prototype.pFACTOR=function(){if("("==this.token){this.next();var a=this.pEXPRESSION();if(a.errors.length>0)return a;if(")"!=this.token?a.error(new Eden.SyntaxError(this,Eden.SyntaxError.EXPCLOSEBRACKET)):this.next(),"["==this.token){var b=this.pINDEXED();return b.setExpression(a),b}return a}if("["==this.token){this.next();var c=[];"]"!=this.token&&(c=this.pELIST());for(var d=new Eden.AST.Literal("LIST",c),e=0;e<c.length;e++)c[e].errors.length>0&&d.errors.push.apply(d.errors,c[e].errors);return d.errors.length>0?d:("]"!=this.token?d.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTLITCLOSE)):this.next(),d)}if("@"==this.token)return this.next(),new Eden.AST.Literal("UNDEFINED","@");if("NUMBER"==this.token){var f=new Eden.AST.Literal("NUMBER",this.data.value);return this.next(),f}if("?"==this.token){this.next();var g=this.pQUERY();if("["==this.token){var b=this.pINDEXED();return b.setExpression(g),b}return g}if("-"==this.token){this.next();return new Eden.AST.UnaryOp("-",this.pFACTOR())}if("<<"==this.token){if(this.next(),"OBSERVABLE"!=this.token){var f=new Eden.AST.Literal("STRING",this.data.value);return f.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.HEREDOCTOKEN)),f}var h=this.data.value;if(10!=this.stream.get()){var f=new Eden.AST.Literal("STRING",this.data.value);return f.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.HEREDOCTOKEN)),f}for(var i="";this.stream.valid();){var j=this.stream.position,k=this.stream.readLine();if(k.startsWith(h)){this.stream.position=j+3;break}i+=k}this.stream.valid()||this.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.NEWLINE)),this.next();var f=new Eden.AST.Literal("STRING",i.slice(0,-1).replace(/\\/g,"\\\\").replace(/"/g,'\\"'));return f}if("STRING"==this.token){var f=new Eden.AST.Literal("STRING",this.data.value);for(this.data.error||this.next();0==this.data.error&&"STRING"==this.token;)f.value+="\n"+this.data.value,this.next();return this.data.error&&("LINEBREAK"==this.data.value?f.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LITSTRLINE)):f.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LITSTRCLOSE))),f}if("BOOLEAN"==this.token){var f=new Eden.AST.Literal("BOOLEAN",this.data.value);return this.next(),f}if("CHARACTER"==this.token){var f=new Eden.AST.Literal("CHARACTER",this.data.value);return this.data.error?(""==this.data.value?f.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LITCHAREMPTY)):f.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LITCHARCLOSE)),f):(this.next(),f)}if("!"==this.token||"not"==this.token){this.next();var l=this.pFACTOR();return new Eden.AST.UnaryOp("!",l)}if("&"==this.token){this.next();var m=this.pLVALUE();return new Eden.AST.UnaryOp("&",m)}if("*"==this.token){this.next();var m=this.pFACTOR();return new Eden.AST.UnaryOp("*",m)}return this.pPRIMARY()},Eden.AST.prototype.pFOR=function(){var a=new Eden.AST.For,b=this.parent;if(this.parent=a,"("!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.FOROPEN)),this.parent=b,a;if(this.next(),";"==this.token)this.next();else{if(a.setStart(this.pSTATEMENT_P(!0)),a.errors.length>0)return this.parent=b,a;if("range"!=a.sstart.type&&";"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.FORSTART)),this.parent=b,a;";"==this.token&&this.next()}if("range"!=a.sstart.type){if(";"==this.token)this.next();else{if(a.setCondition(this.pEXPRESSION()),a.errors.length>0)return this.parent=b,a;if(";"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.FORCOND)),this.parent=b,a;this.next()}if(")"==this.token)this.next();else{if(a.setIncrement(this.pSTATEMENT_P()),
a.errors.length>0)return this.parent=b,a;if(")"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.FORCLOSE)),this.parent=b,a;this.next()}}else{if(")"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.FORCLOSE)),this.parent=b,a;this.next()}return a.setStatement(this.pSTATEMENT()),a.statement&&(a.statement.parent=a),a.parent=b,this.parent=b,a},Eden.AST.prototype.pFUNCTION=function(){var a=new Eden.AST.Function,b=this.parent;return this.parent=a,"OBSERVABLE"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCNAME)),this.parent=b,a):(a.name=this.data.value,this.next(),a.setBody(this.pFUNCBODY()),this.parent=b,a)},Eden.AST.prototype.pFUNCBODY=function(){var a=new Eden.AST.CodeBlock,b=this.parent;return this.parent=a,"{"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCOPEN)),this.parent=b,a):(this.next(),a.setParams(this.pPARAMS()),a.params.errors.length>0?(this.parent=b,a):(a.setLocals(this.pLOCALS()),a.locals.errors.length>0?(this.parent=b,a):(a.setScript(this.pSCRIPT()),"}"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCCLOSE)),this.parent=b,a):(this.next(),this.parent=b,a))))},Eden.AST.prototype.pIF=function(){var a=new Eden.AST.If;a.parent=this.parent;var b=this.parent;return this.parent=a,"("!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.IFCONDOPEN)),this.parent=b,a):(this.next(),a.setCondition(this.pEXPRESSION()),a.errors.length>0?(this.parent=b,a):")"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.IFCONDCLOSE)),this.parent=b,a):(this.next(),a.setStatement(this.pSTATEMENT()),a.errors.length>0?(this.parent=b,a):void 0===a.statement?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.IFNOSTATEMENT)),this.parent=b,a):(a.setElse(this.pIF_P()),this.parent=b,a)))},Eden.AST.prototype.pIF_P=function(){if("else"==this.token)return this.next(),this.pSTATEMENT()},Eden.AST.prototype.pREQUIRE=function(){var a=new Eden.AST.Require,b=this.pEXPRESSION();return a.setExpression(b),a.warning=new Eden.SyntaxWarning(this,a,Eden.SyntaxWarning.DEPRECATED,"require."),";"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a)},Eden.AST.prototype.pIMPORT=function(){var a=new Eden.AST.Import,b=this.pCODESELECTOR();return void 0===b||b.errors.length>0?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.IMPORTPATH)),a):(a.setPath(b),";"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a))},Eden.AST.prototype.pINSERT=function(){var a=new Eden.AST.Insert;return a.setDest(this.pLVALUE()),a.errors.length>0?a:","!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.INSERTCOMMA)),a):(this.next(),a.setIndex(this.pEXPRESSION()),a.errors.length>0?a:","!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.INSERTCOMMA)),a):(this.next(),a.setValue(this.pEXPRESSION()),a.errors.length>0?a:";"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a)))},Eden.AST.prototype.pDELETE=function(){var a=new Eden.AST.Delete;return a.setDest(this.pLVALUE()),a.errors.length>0?a:","!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.DELETECOMMA)),a):(this.next(),a.setIndex(this.pEXPRESSION()),a.errors.length>0?a:";"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a))},Eden.AST.prototype.pAPPEND=function(){var a=new Eden.AST.Append;return a.setDest(this.pLVALUE()),a.errors.length>0?a:","!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.APPENDCOMMA)),a):(this.next(),a.setIndex(this.pEXPRESSION()),a.errors.length>0?a:";"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a))},Eden.AST.prototype.pSHIFT=function(){var a=new Eden.AST.Shift;return a.setDest(this.pLVALUE()),a.errors.length>0?a:";"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a)},Eden.AST.prototype.pELIST=function(){var a=this.pEXPRESSION();if(a.errors.length>0)return[a];var b=this.pELIST_P();return b.unshift(a),b},Eden.AST.prototype.pELIST_P=function(){for(var a=[];","==this.token;){this.next();var b=this.pEXPRESSION();if(a.push(b),b.errors.length>0)return a}return a},Eden.AST.prototype.pOLIST=function(){if("OBSERVABLE"!=this.token)return[];var a=this.data.value;this.next();var b=this.pOLIST_P();return b.unshift(a),b},Eden.AST.prototype.pOLIST_P=function(){for(var a=[];","==this.token;){if(this.next(),"OBSERVABLE"!=this.token)return a.push("NONAME"),a;a.push(this.data.value),this.next()}return a},Eden.AST.prototype.pLVALUE_P=function(){for(var a=[];;){if("["!=this.token)break;this.next();var b=new Eden.AST.LValueComponent("index"),c=this.pEXPRESSION();if(b.index(c),a.push(b),c.errors.length>0&&b.errors.unshift(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXEXP)),"literal"==b.indexexp.type&&"NUMBER"==b.indexexp.datatype&&b.indexexp.value<1&&b.error(new Eden.SyntaxError(this,Eden.SyntaxError.OUTOFBOUNDS)),"]"!=this.token)return b.error(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXCLOSE)),a;this.next()}return a},Eden.AST.prototype.pLVALUE=function(){var a=new Eden.AST.LValue;if("*"==this.token)this.next(),a.setPrimary(this.pPRIMARY());else if("`"==this.token){if(this.next(),a.setExpression(this.pEXPRESSION()),a.errors.length>0)return a;if("`"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.BACKTICK)),a;this.next()}else{if("OBSERVABLE"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.LVALUE)),a;var b=this.data.value;if(this.next(),"{"==this.token){for(var c=new Eden.AST.Literal("STRING",b);"{"==this.token;){this.next();var d=this.pEXPRESSION();if(d.errors.length>0)return a.setExpression(d),a;if("}"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.BACKTICK)),a;this.next();var e=new Eden.AST.BinaryOp("//");if(e.left(c),e.setRight(d),c=e,"OBSERVABLE"==this.token){var e=new Eden.AST.BinaryOp("//");e.left(c),e.setRight(new Eden.AST.Literal("STRING",this.data.value)),c=e,this.next()}}a.setExpression(c)}else a.setObservable(b)}return a.setExtras(this.pLVALUE_P()),a},Eden.AST.prototype.pPRIMARY=function(){if("JAVASCRIPT"==this.token){var a=new Eden.AST.Literal("JAVASCRIPT",this.data.value);if(a.errors.length>0){var b=new Eden.AST.Primary;return b.setBackticks(a),b}this.next();var b=this.pPRIMARY_P();return b.errors.length>0?b:(b.setBackticks(a),b.setObservable("__JAVASCRIPT__"),b)}if("`"==this.token){this.next();var a=this.pEXPRESSION();if(a.errors.length>0){var b=new Eden.AST.Primary;return b.setBackticks(a),b}if("`"!=this.token){var b=new Eden.AST.Primary;return b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.BACKTICK)),b}this.next();var b=this.pPRIMARY_P();return b.errors.length>0?b:(b.setBackticks(a),b.setObservable("__BACKTICKS__"),b)}if("OBSERVABLE"==this.token){var b,c=this.data.value;if(this.next(),"{"==this.token){for(var d=new Eden.AST.Literal("STRING",c);"{"==this.token;){this.next();var a=this.pEXPRESSION();if(a.errors.length>0){var b=new Eden.AST.Primary;return b.setBackticks(a),b}if("}"!=this.token){var b=new Eden.AST.Primary;return b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.BACKTICK)),b}this.next();var e=new Eden.AST.BinaryOp("//");if(e.left(d),e.setRight(a),d=e,"OBSERVABLE"==this.token){var e=new Eden.AST.BinaryOp("//");e.left(d),e.setRight(new Eden.AST.Literal("STRING",this.data.value)),d=e,this.next()}}b=this.pPRIMARY_P(),b.setBackticks(d),b.setObservable("__BACKTICKS__")}else b=this.pPRIMARY_P(),b.setObservable(c);return b}var b=new Eden.AST.Primary;return b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.BADFACTOR)),b},Eden.AST.prototype.pPRIMARY_P=function(){if("["==this.token){this.next();var a=new Eden.AST.Index;if("]"==this.token){var b=new Eden.AST.Primary;return b.prepend(a),b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXEXP)),b}var c=this.pEXPRESSION();if(c.errors.length>0){a.setExpression(c);var b=new Eden.AST.Primary;return b.prepend(a),b}if("literal"==c.type&&"NUMBER"==c.datatype&&c.value<1){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.OUTOFBOUNDS));var b=new Eden.AST.Primary;return b.prepend(a),b}if("]"!=this.token){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXCLOSE));var b=new Eden.AST.Primary;return b.prepend(a),b}this.next();var b=this.pPRIMARY_PPP();return a.setExpression(c),b.prepend(a),b}if("("==this.token){this.next();var d=new Eden.AST.FunctionCall;if(")"==this.token){this.next();var b=this.pPRIMARY_PP();return b.prepend(d),b}var e=this.pELIST();if(d.setParams(e),d.errors.length>0){var b=new Eden.AST.Primary;return b.prepend(d),b}if(")"!=this.token){var b=new Eden.AST.Primary;return b.prepend(d),d.errors.length>0?b:(b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCCALLEND)),b)}this.next();var b=this.pPRIMARY_PP();return b.errors.length>0?b:(b.prepend(d),b)}if("."==this.token){this.next();var f=this.pPRIMARY(),g=new Eden.AST.ScopePath;return g.setPrimary(f),g}return this.pPRIMARY_PPPP()},Eden.AST.prototype.pPRIMARY_PP=function(){if("["==this.token){this.next();var a=new Eden.AST.Index;if("]"==this.token){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXEXP));var b=new Eden.AST.Primary;return b.prepend(a),b}var c=this.pEXPRESSION();if(c.errors.length>0){var b=new Eden.AST.Primary;return a.setExpression(c),b.prepend(a),b}if("literal"==c.type&&"NUMBER"==c.datatype&&c.value<1){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.OUTOFBOUNDS));var b=new Eden.AST.Primary;return b.prepend(a),b}if("]"!=this.token){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXCLOSE));var b=new Eden.AST.Primary;return b.prepend(a),b}this.next();var b=this.pPRIMARY_PP();return a.setExpression(c),b.prepend(a),b}if("("==this.token){this.next();var d=new Eden.AST.FunctionCall;if(")"==this.token){this.next();var b=this.pPRIMARY_PP();return b.prepend(d),b}var e=this.pELIST();if(d.setParams(e),")"!=this.token){var b=new Eden.AST.Primary;return b.prepend(d),d.errors.length>0?b:(b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCCALLEND)),b)}this.next();var b=this.pPRIMARY_PP();return b.prepend(d),b}return this.pPRIMARY_PPPP()},Eden.AST.prototype.pPRIMARY_PPP=function(){if("["==this.token){this.next();var a=new Eden.AST.Index;if("]"==this.token){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXEXP));var b=new Eden.AST.Primary;return b.prepend(a),b}var c=this.pEXPRESSION();if(c.errors.length>0){var b=new Eden.AST.Primary;return a.setExpression(c),b.prepend(a),b}if("literal"==c.type&&"NUMBER"==c.datatype&&c.value<1){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.OUTOFBOUNDS));var b=new Eden.AST.Primary;return b.prepend(a),b}if("]"!=this.token){a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXCLOSE));var b=new Eden.AST.Primary;return b.prepend(a),b}this.next();var b=this.pPRIMARY_PP();return a.setExpression(c),b.prepend(a),b}if("("==this.token){this.next();var d=new Eden.AST.FunctionCall;if(")"==this.token){this.next();var b=this.pPRIMARY_PP();return b.prepend(d),b}var e=this.pELIST();if(d.setParams(e),")"!=this.token){var b=new Eden.AST.Primary;return b.prepend(d),d.errors.length>0?b:(b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCCALLEND)),b)}this.next();var b=this.pPRIMARY_PP();return b.errors.length>0?b:(b.prepend(d),b)}if("."==this.token){this.next();var f=this.pPRIMARY();if(f.errors.length>0)return f;var g=new Eden.AST.ScopePath;return g.setPrimary(f),g}return this.pPRIMARY_PPPP()},Eden.AST.prototype.pPRIMARY_PPPP=function(){return new Eden.AST.Primary},Eden.AST.prototype.pACTION=function(){var a=new Eden.AST.Action,b=this.parent;if(this.parent=a,a.warning=new Eden.SyntaxWarning(this,a,Eden.SyntaxWarning.DEPRECATED,"attempt to use 'when' instead of 'proc'"),"OBSERVABLE"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.PROCNAME)),this.parent=b,a;if(a.name=this.data.value,this.next(),":"==this.token){this.next();var c=this.pOLIST();if(0==c.length)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONNOWATCH)),this.parent=b,a;if("NONAME"==c[c.length-1])return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCOMMAS)),this.parent=b,a;a.triggers=c}return a.setBody(this.pFUNCBODY()),this.parent=b,a},Eden.AST.prototype.pSCOPE=function(){if("("==this.token){this.next();var a=this.pSCOPE_P();return")"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SCOPECLOSE)),a):(this.next(),a)}return this.pSCOPE_P()},Eden.AST.prototype.pSCOPEPATTERN=function(){var a=new Eden.AST.ScopePattern;if("OBSERVABLE"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SCOPENAME)),a;for(a.setObservable(this.data.value),this.next();;)if("["==this.token){this.next();var b=this.pEXPRESSION();if(a.addListIndex(b),b.errors.length>0)return a;if("]"!=this.token)return a.error(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXCLOSE)),a;this.next()}else if("."!=this.token)break;return a},Eden.AST.prototype.pSCOPE_P=function(a){var b,c=!1,d=this.peekNext(1);if(void 0===a&&(a=1),"is"!=d&&"="!=d&&"in"!=d)b=new Eden.AST.ScopePattern,b.setObservable("$"+a),a++;else{if(b=this.pSCOPEPATTERN(),b.errors.length>0){var e=new Eden.AST.Scope;return e.addOverride(b,void 0,void 0,void 0,!1),e}if("is"!=this.token&&"="!=this.token&&"in"!=this.token){var e=new Eden.AST.Scope;return e.error(new Eden.SyntaxError(this,Eden.SyntaxError.SCOPEEQUALS)),e}"in"==this.token&&(c=!0),this.next()}var f=this.pEXPRESSION();if(f.errors.length>0){var e=new Eden.AST.Scope;return e.errors.push.apply(e.errors,f.errors),e}var g=void 0;if(".."==this.token&&(this.next(),g=this.pEXPRESSION(),g.errors.length>0)){var e=new Eden.AST.Scope;return e.addOverride(b,f,g,void 0,!1),e}var h=void 0;if(".."==this.token&&(this.next(),h=this.pEXPRESSION(),h.errors.length>0)){var e=new Eden.AST.Scope;return e.addOverride(b,f,g,h,!1),e}var e=this.pSCOPE_PP(a);return e.addOverride(b,f,g,h,c),e},Eden.AST.prototype.pSCOPE_PP=function(a){return","==this.token?(this.next(),this.pSCOPE_P(a)):new Eden.AST.Scope},Eden.AST.prototype.pNAMEDSCRIPT=function(){var a;if("OBSERVABLE"!=this.token){var b=new Eden.AST.Script;return b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONNAME)),b}if(a=this.data.value,this.next(),"is"==this.token){this.next();var c=new Eden.AST.Alias;return c.setSelector(this.pCODESELECTOR()),(c.setName(a),";"!=this.token)?(c.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),c):(this.next(),c)}if("{"!=this.token){var b=new Eden.AST.Script;return b.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONOPEN)),b}this.next();var b=this.pSCRIPT();return b.errors.length>0?b:(b.setName(this,a),"}"!=this.token?(b.error(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCLOSE)),b):(this.next(),this.scripts[a]=b,b))},Eden.AST.prototype.pSCRIPT=function(){var a=new Eden.AST.Script;a.parent=this.parent;var b=this.parent;this.parent=a;var c=new Eden.AST.DummyStatement;for(c.setSource(this.lastposition,this.stream.prevposition,this.stream.code.substring(this.lastposition,this.stream.prevposition)),c.numlines=c.source.match(/\n/g),null===c.numlines?c.numlines=0:c.numlines=c.numlines.length,a.append(c);"EOF"!=this.token;){var d=this.pSTATEMENT();if(void 0!==d){if(d.errors.length>0){a.appendChild(d);break}var e=d.end;a.appendChild(d);var f=this.stream.code.substring(e,this.stream.prevposition);if(f.length>0){var c=new Eden.AST.DummyStatement;c.setSource(e,this.stream.prevposition,f),c.numlines=c.source.match(/\n/g),null===c.numlines?c.numlines=0:c.numlines=c.numlines.length,a.appendChild(c)}}else{if("}"!=this.token&&";"!=this.token&&a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.STATEMENT)),";"!=this.token)break;this.next()}}return this.parent=b,a},Eden.AST.prototype.pSCRIPTEXPR=function(){var a=new Eden.AST.ScriptExpr;a.parent=this.parent;for(this.parent;"EOF"!=this.token;){var b=this.pSTATEXPR();if(void 0!==b){if(a.append(b),b.errors.length>0)break}else{if("}"!=this.token&&";"!=this.token&&a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.STATEMENT)),";"!=this.token)break;this.next()}}return a},Eden.AST.prototype.pAGENTPATH=function(){if("OBSERVABLE"!=this.token&&void 0===Language.keywords[this.token])return"_ERROR_";var a=this.data.value;for(this.next();"/"==this.token;){if(this.next(),"OBSERVABLE"!=this.token&&void 0===Language.keywords[this.token])return"_ERROR_";a+="/"+this.data.value,this.next()}return a},Eden.AST.prototype.pCODESELECTOR=function(){var a=void 0;if("OBSERVABLE"==this.token||Language.keywords[this.token]&&"with"!=this.token)a=new Eden.AST.Literal("STRING",this.data.value),this.next();else if(":"==this.token||"."==this.token){var b=":"==this.token;if(this.next(),"OBSERVABLE"==this.token){if(!(!b&&Eden.Selectors.PropertyNode.attributes[this.data.value]||b&&Eden.Selectors.PropertyNode.pseudo[this.data.value]))return a=new Eden.AST.Literal("STRING",""),a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SELECTORATTRIB)),a;a=new Eden.AST.Literal("STRING",(b?":":".")+this.data.value),this.next()}else if("NUMBER"==this.token)a=new Eden.AST.Literal("STRING",(b?":":".")+this.data.value),this.next();else if("{"==this.token)a=new Eden.AST.Literal("STRING",b?":":".");else{if("("!=this.token)return a=new Eden.AST.Literal("STRING",""),a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SELECTORATTRIB)),a;var c=this.stream.position;for(this.next();this.stream.valid()&&")"!=this.token;)this.next();var d=this.stream.prevposition,e=":("+this.stream.code.substring(c,d).replace(/[\r\n]*/g,"")+")";a=new Eden.AST.Literal("STRING",e),this.next()}}else if("@"==this.token){if(this.next(),"OBSERVABLE"!=this.token)return a=new Eden.AST.Literal("STRING",""),a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SELECTOROPTION)),a;if(!Eden.Selectors.allowedOptions[this.data.value])return a=new Eden.AST.Literal("STRING",""),a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SELECTOROPTION)),a;a=new Eden.AST.Literal("STRING","@"+this.data.value+" "),this.next()}else if("#"==this.token)if(this.next(),"OBSERVABLE"==this.token)a=new Eden.AST.Literal("STRING","#"+this.data.value),this.next();else{if("{"!=this.token)return a=new Eden.AST.Literal("STRING",""),a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SELECTORTAG)),a;a=new Eden.AST.Literal("STRING","#")}else if("{"==this.token){if(this.next(),a=this.pEXPRESSION(),"}"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SELECTORBTICK)),a;this.next()}else if(">"==this.token)a=new Eden.AST.Literal("STRING"," > "),this.next();else if(">>"==this.token)a=new Eden.AST.Literal("STRING"," >> "),this.next();else if("<"==this.token)a=new Eden.AST.Literal("STRING"," < "),this.next();else if(","==this.token)a=new Eden.AST.Literal("STRING",","),this.next();else if("<<"==this.token)a=new Eden.AST.Literal("STRING"," << "),this.next();else if("("==this.token){var c=this.stream.position;for(this.next();this.stream.valid()&&")"!=this.token;)this.next();var d=this.stream.prevposition,e="("+this.stream.code.substring(c,d).replace(/[\r\n]*/g,"")+")";a=new Eden.AST.Literal("STRING",e),this.next()}else{if(")"==this.token)return;"*"==this.token&&(a=new Eden.AST.Literal("STRING","*"),this.next())}if(a){var f=this.pCODESELECTOR();if(void 0===f)return a;if(f.errors.length>0)return f;if("literal"==a.type&&"literal"==f.type)a.value+=f.value;else{var g=new Eden.AST.BinaryOp("//");g.left(a),g.setRight(f),a=g}}return a},Eden.AST.prototype.pSTATEMENT_PP=function(a){if("is"==this.token){this.next();var b=new Eden.AST.Definition,c=this.parent;this.parent=b;var d=this.pEXPRESSION();return b.setExpression(d),this.parent=c,b}if("in"==this.token){if(this.next(),!a){var e=new Eden.AST.Range;return e.error(new Eden.SyntaxError(this,Eden.SyntaxError.RANGEBANNED)),e}var e=new Eden.AST.Range(this.pEXPRESSION());return".."==this.token&&(this.next(),e.setSecond(this.pEXPRESSION())),e}if("="==this.token)return this.next(),new Eden.AST.Assignment(this.pEXPRESSION());if("+="==this.token)return this.next(),new Eden.AST.Modify("+=",this.pEXPRESSION());if("-="==this.token)return this.next(),new Eden.AST.Modify("-=",this.pEXPRESSION());if("/="==this.token)return this.next(),new Eden.AST.Modify("/=",this.pEXPRESSION());if("*="==this.token)return this.next(),new Eden.AST.Modify("*=",this.pEXPRESSION());if("~>"==this.token){this.next();var f=new Eden.AST.Subscribers;return"["!=this.token?(f.error(new Eden.SyntaxError(this,Eden.SyntaxError.SUBSCRIBEOPEN)),f):(this.next(),f.setList(this.pOLIST()),f.errors.length>0?f:"]"!=this.token?(f.error(new Eden.SyntaxError(this,Eden.SyntaxError.SUBSCRIBECLOSE)),f):(this.next(),f))}if("++"==this.token)return this.next(),new Eden.AST.Modify("++",void 0);if("--"==this.token)return this.next(),new Eden.AST.Modify("--",void 0);if("("==this.token){var g=new Eden.AST.FunctionCall;if(this.next(),")"!=this.token){if(g.setParams(this.pELIST()),g.errors.length>0)return g;if(")"!=this.token)return g.error(new Eden.SyntaxError(this,Eden.SyntaxError.FUNCCLOSE)),g}return this.next(),g}var h=[];h.push(new Eden.SyntaxError(this,Eden.SyntaxError.DEFINITION));var i=new Eden.AST.Assignment(void 0);return i.errors.unshift(h[0]),i},Eden.AST.prototype.pSTATEMENT_P=function(a){var b=this.pLVALUE();if(b.errors.length>0)return b;var c=this.pSTATEMENT_PP(a);return c.left(b),c.errors.length,c},Eden.AST.prototype.pSTATEMENT=function(){var a=this.stream.prevposition,b=this.stream.line-1,c=-1,d=void 0,e=-1,f=this.lastDoxyComment.length>0?this.lastDoxyComment.pop():void 0;switch(0==this.lastDoxyComment.length&&this.parentDoxy&&this.lastDoxyComment.push(this.parentDoxy),this.token){case"proc":this.next(),d=this.pACTION();break;case"func":this.next(),d=this.pFUNCTION();break;case"when":this.next(),d=this.pWHEN();break;case"action":this.next(),d=this.pNAMEDSCRIPT();break;case"for":this.next(),d=this.pFOR();break;case"while":this.next(),d=this.pWHILE();break;case"do":this.next(),d=this.pDO();break;case"wait":this.next(),d=this.pWAIT();break;case"switch":this.next(),d=this.pSWITCH();break;case"case":this.next(),d=this.pCASE();break;case"insert":this.next(),d=this.pINSERT();break;case"delete":this.next(),d=this.pDELETE();break;case"append":this.next(),d=this.pAPPEND();break;case"shift":this.next(),d=this.pSHIFT();break;case"require":this.next(),d=this.pREQUIRE();break;case"after":this.next(),d=this.pAFTER();break;case"import":this.next(),d=this.pIMPORT();break;case"local":case"auto":d=this.pLOCALS();break;case"default":this.next();var g=new Eden.AST.Default;":"!=this.token?g.error(new Eden.SyntaxError(this,Eden.SyntaxError.DEFAULTCOLON)):this.next(),d=g;break;case"if":this.next(),d=this.pIF();break;case"#":var h=this.stream.position+1,i=this.stream.line,j=33==this.stream.peek();do{this.stream.skipLine(),this.stream.valid()||this.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.NEWLINE)),this.stream.skip(),this.stream.line++}while(35==this.stream.peek()&&35!=this.stream.peek2());if(j){var k=new Eden.AST.DoxyComment(this.stream.code.substring(h,this.stream.position-1).trim(),i,this.stream.line);k.parent=this.parentDoxy,k.content.endsWith("@{")?this.parentDoxy=k:k.content.startsWith("@}")&&this.parentDoxy&&(this.parentDoxy=this.parentDoxy.parent),!this.lastStatement||void 0!==this.lastStatement.doxyComment||this.lastStatEndline!=i-1&&this.lastStatEndline!=i?this.lastDoxyComment.push(k):this.lastStatement.setDoxyComment(k)}this.next(),d=new Eden.AST.DummyStatement;break;case"##":d=this.pSECTION(),this.lastDoxyComment.length>0&&this.lastline==this.lastDoxyComment[0].startline-1&&d.setDoxyComment(this.lastDoxyComment.shift());break;case"return":this.next();var l=new Eden.AST.Return;if(";"==this.token){this.next(),d=l;break}if(l.setResult(this.pEXPRESSION()),l.errors.length>0){d=l;break}";"!=this.token?l.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),d=l;break;case"continue":this.next();var m=new Eden.AST.Continue;if(m.errors.length>0){d=m;break}";"!=this.token?m.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),d=m;break;case"break":this.next();var n=new Eden.AST.Break;if(n.errors.length>0){d=n;break}";"!=this.token?n.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),d=n;break;case"{":this.next();var o=this.pSCRIPT();if("}"!=this.token){o.error(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCLOSE)),d=o;break}this.next(),d=o;break;case"JAVASCRIPT":b=this.data.line-1;var p=this.data.value;this.next(),d=new Eden.AST.Literal("JAVASCRIPT",p);break;case"?":this.next(),d=this.pQUERY(),";"!=this.token?d.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next();break;case"`":case"*":case"OBSERVABLE":var q=this.pLVALUE();if(q.errors.length>0){d=new Eden.AST.DummyStatement,d.lvalue=q,d.errors=q.errors;break}var r=this.pSTATEMENT_PP();if(r.left(q),r.errors.length>0){d=r;break}";"!=this.token?r.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),void 0===this.definitions[q.name]&&(this.definitions[q.name]=[]),this.definitions[q.name].push(r),d=r;break;default:return}return e=this.lastposition,c=this.lastline,d.parent=this.parent,void 0===d.doxyComment&&d.setDoxyComment(f),d.stamp=this.stamp,d.numlines=c-b-1,d.setSource(a,e,this.stream.code.substring(a,e)),"dummy"!=d.type&&(this.lastStatement=d,this.lastStatEndline=c),d},Eden.AST.prototype.pSTATEXPR=function(){var a=(this.stream.prevposition,void 0),b=this.lastDoxyComment;switch(this.lastDoxyComment=this.parentDoxy,this.token){case"proc":case"func":case"when":case"wait":case"do":case"require":case"after":case"import":case"action":a=new Eden.AST.DummyStatement,a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.UNKNOWN));break;case"for":this.next(),a=this.pFOR();break;case"while":this.next(),a=this.pWHILE();break;case"switch":this.next(),a=this.pSWITCH();break;case"case":this.next(),a=this.pCASE();break;case"insert":this.next(),a=this.pINSERT();break;case"delete":this.next(),a=this.pDELETE();break;case"append":this.next(),a=this.pAPPEND();break;case"shift":this.next(),a=this.pSHIFT();break;case"para":case"oracle":a=this.pPARAMS();break;case"local":case"auto":a=this.pLOCALS();break;case"default":this.next();var c=new Eden.AST.Default;":"!=this.token?c.error(new Eden.SyntaxError(this,Eden.SyntaxError.DEFAULTCOLON)):this.next(),a=c;break;case"if":this.next(),a=this.pIF();break;case"return":this.next();var d=new Eden.AST.Return;if(";"==this.token){this.next(),a=d;break}if(d.setResult(this.pEXPRESSION()),d.errors.length>0){a=d;break}";"!=this.token?d.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),a=d;break;case"continue":this.next();var e=new Eden.AST.Continue;if(e.errors.length>0){a=e;break}";"!=this.token?e.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),a=e;break;case"break":this.next();var f=new Eden.AST.Break;if(f.errors.length>0){a=f;break}";"!=this.token?f.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):this.next(),a=f;break;case"{":this.next();var g=this.pSCRIPT();if("}"!=this.token){g.error(new Eden.SyntaxError(this,Eden.SyntaxError.ACTIONCLOSE)),endline=this.stream.line,a=g;break}endline=this.stream.line,this.next(),a=g;break;case"JAVASCRIPT":curline=this.data.line-1;var h=this.data.value;this.next(),a=new Eden.AST.Literal("JAVASCRIPT",h);break;case"`":case"*":case"OBSERVABLE":var i=this.pLVALUE();if(i.errors.length>0){a=new Eden.AST.DummyStatement,a.lvalue=i,a.errors=i.errors;break}var j=this.pSTATEMENT_PP();if(j.left(i),j.errors.length>0){a=j,endline=this.stream.line;break}";"!=this.token?j.error(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)):(end=this.stream.position,endline=this.stream.line,this.next()),void 0===this.definitions[i.name]&&(this.definitions[i.name]=[]),this.definitions[i.name].push(j),a=j;break;default:return}return a.parent=this.parent,a.doxyComment=b,a},Eden.AST.prototype.pSWITCH=function(){var a=new Eden.AST.Switch,b=this.parent;return this.parent=a,"("!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SWITCHOPEN)),this.parent=b,a):(this.next(),a.setExpression(this.pEXPRESSION()),a.errors.length>0?(this.parent=b,a):")"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SWITCHCLOSE)),this.parent=b,a):(this.next(),"{"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.SWITCHSCRIPT)),this.parent=b,a):(a.setStatement(this.pSTATEMENT()),this.parent=b,a)))},Eden.AST.prototype.pCASE=function(){var a=new Eden.AST.Case;return"STRING"!=this.token&&"NUMBER"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.CASELITERAL)),a):(a.setLiteral(this.token,this.data.value),this.next(),":"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.CASECOLON)),a):(this.next(),a))},Eden.AST.prototype.pTERM=function(){var a=this.pTERM_A(),b=this.pEXPRESSION_PPPPPP();return b?(b.left(a),b):a},Eden.AST.prototype.pTERM_A=function(){for(var a=this.pTERM_P();"<"==this.token||"<="==this.token||">"==this.token||">="==this.token||"=="==this.token||"!="==this.token;){var b=new Eden.AST.BinaryOp(this.token);this.next(),b.left(a),b.setRight(this.pTERM_P()),a=b}return a},Eden.AST.prototype.pTERM_P=function(){for(var a=this.pTERM_PP();"+"==this.token||"-"==this.token||"//"==this.token;){var b=new Eden.AST.BinaryOp(this.token);this.next(),b.left(a),b.setRight(this.pTERM_PP()),a=b}return a},Eden.AST.prototype.pTERM_PP=function(){for(var a=this.pTERM_PPP();"*"==this.token||"/"==this.token||"%"==this.token||"^"==this.token;){var b=new Eden.AST.BinaryOp(this.token);this.next(),b.left(a),b.setRight(this.pTERM_PPP()),a=b}return a},Eden.AST.prototype.pTERM_PPP=function(){var a=this.pFACTOR(),b=this.pEXPRESSION_PPPPP();return b?(b.left(a),b):a},Eden.AST.prototype.pWAIT=function(){var a=new Eden.AST.Wait;if(";"==this.token)return this.next(),a;var b=this.pEXPRESSION();return a.setDelay(b),";"!=this.token?(a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a):(this.next(),a)},Eden.AST.prototype.pWHEN=function(){var a=new Eden.AST.When,b=this.parent;if(this.parent=a,"("!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.WHENOPEN)),this.parent=b,a;if(this.next(),a.setExpression(this.pEXPRESSION()),a.errors.length>0)return this.parent=b,a;if(")"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.WHENCLOSE)),this.parent=b,a;if(this.next(),a.setStatement(this.pSTATEMENT()),a.errors.length>0)return this.parent=b,a;if(void 0===a.statement)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.WHENNOSTATEMENT)),a.active=!0,this.parent=b,a;if("with"==this.token||"::"==this.token){this.next();var c=this.pSCOPE();if(a.setScope(c),c.errors.length>0)return a;if(";"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.SEMICOLON)),a;this.next()}return a.compile(this),this.whens.push(a),this.parent=b,a},Eden.AST.prototype.pWHILE=function(){var a=new Eden.AST.While,b=this.parent;return this.parent=a,a.warning=new Eden.SyntaxWarning(this,a,Eden.SyntaxWarning.USEOFWHILE),"("!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.WHILEOPEN)),this.parent=b,a):(this.next(),a.setCondition(this.pEXPRESSION()),a.errors.length>0?(this.parent=b,a):")"!=this.token?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.WHILECLOSE)),this.parent=b,a):(this.next(),a.setStatement(this.pSTATEMENT()),void 0===a.statement?(a.error(new Eden.SyntaxError(this,Eden.SyntaxError.WHILENOSTATEMENT)),this.parent=b,a):(this.parent=b,a)))},Eden.AST.prototype.pQUERY=function(){var a=new Eden.AST.Query,b=[];if("("!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.QUERYOPEN)),a;if(this.next(),a.setSelector(this.pCODESELECTOR()),
")"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.QUERYCLOSE)),a;if(this.next(),"["!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.QUERYSELECTOPEN)),a;for(this.next();this.stream.valid()&&"]"!=this.token&&(b.push(this.data.value),this.next(),"]"!=this.token);){if(","!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.QUERYSELECTCOMMA)),a;this.next()}if("]"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.QUERYSELECTCLOSE)),a;if(this.next(),"="==this.token||"+="==this.token||"//="==this.token){var c=this.token;this.next();var d=this.pEXPRESSION();a.setModify(d,c)}return 0==b.length&&b.push("id"),a.setResultTypes(b),a},Eden.AST.prototype.pINDEXED=function(){for(var a=new Eden.AST.Indexed;this.stream.valid()&&"["==this.token;){this.next();var b=new Eden.AST.Index;if("]"==this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXEXP)),a;var c=this.pEXPRESSION();if(c.errors.length>0)return b.setExpression(c),a.addIndex(b),a;if("literal"==c.type&&"NUMBER"==c.datatype&&c.value<1)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.OUTOFBOUNDS)),a;if("]"!=this.token)return a.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.LISTINDEXCLOSE)),a;this.next(),b.setExpression(c),a.addIndex(b)}return a},Eden.AST.prototype.pSECTION=function(){for(var a=1;35==this.stream.peek();)a++,this.stream.skip();var b=this.stream.readLine().trim();return this.stream.valid()?(this.stream.position--,this.stream.line--):this.errors.push(new Eden.SyntaxError(this,Eden.SyntaxError.NEWLINE)),this.next(),stat=new Eden.AST.Section,stat.setName(b),stat.depth=a,stat},Eden.Project=function(a,b,c){this.title=b,this.name=b.replace(/[^a-zA-Z0-9]/g,""),this.author=void 0,this.authorid=-1,this.tags=b.toLowerCase().split(" "),this.src=c,this.ast=new Eden.AST(c,void 0,this),this.id=a,this.vid=void 0,this.parentid=void 0,this.thumb=void 0,this.desc=void 0,this.readPassword=void 0,this.ast&&this.ast.script.errors.length,eden.root.lookup("jseden_project_title").assign(b,eden.root.scope,Symbol.localJSAgent),eden.root.lookup("jseden_project_name").assign(this.name,eden.root.scope,Symbol.localJSAgent)},Eden.Project.listenTo=listenTo,Eden.Project.emit=emit,Eden.Project.unListen=unListen,Eden.Project.listeners={},Eden.Project.init=function(){eden.root.lookup("jseden_project_title").addJSObserver("project",function(a,b){if(a.origin!==eden.project){if(void 0===eden.project)return;eden.project.title=b,void 0===this.id&&(Eden.Index.remove(eden.project.ast.script),eden.project.name=b.replace(/[^a-zA-Z0-9]/g,""),eden.project.ast.script.name=eden.project.name,console.log("REINDEX PROJECT"),Eden.Index.update(eden.project.ast.script)),eden.project.ast.script.doxyComment=eden.project.ast.doxyFromOrigin(),Eden.Fragment.emit("aststatus",[eden.project.ast.script])}}),$.get("resources/projects.db.json",function(a){Eden.Project.local=a},"json")},Eden.Project.newFromExisting=function(a,b){var c=this;Eden.Project.emit("loading",[c]),Eden.Project.local[a]&&$.get(Eden.Project.local[a].file,function(d){eden.root.lookup("jseden_project_mode").assign("restore",eden.root.scope,Symbol.defaultAgent),eden.project=new Eden.Project(void 0,a,d),eden.project.start(function(){Eden.Project.emit("load",[c]),b&&b(eden.project)})},"text")},Eden.Project.search=function(a,b){},Eden.Project.load=function(a,b,c,d){var e=this;3==arguments.length&&(d=c,c=void 0),Eden.Project.emit("loading",[e]),Eden.DB.load(a,b,c,function(b){if(b){var f=b;if(eden.project=new Eden.Project(a,f.minimisedTitle,b.source),console.log("LOAD PROJECT",b),eden.project.vid=b.saveID,eden.project.title=f.title,eden.project.author=f.ownername,eden.project.authorid=f.owner,eden.project.thumb=f.image,eden.project.tags=f.tags.trim().split(" "),eden.project.parentid=f.parentProject,eden.root.lookup("jseden_project_title").assign(f.title,eden.root.scope,Symbol.localJSAgent),eden.root.lookup("jseden_project_name").assign(f.minimisedTitle,eden.root.scope,Symbol.localJSAgent),eden.root.lookup("jseden_project_thumb").assign(f.image,eden.root.scope,Symbol.localJSAgent),eden.root.lookup("jseden_project_author").assign(f.ownername,eden.root.scope,Symbol.localJSAgent),null!==f.projectMetaData){var g=JSON.parse(f.projectMetaData);eden.project.desc=g.description}eden.project.ast.script.doxyComment=eden.project.ast.doxyFromOrigin(),eden.project.start(function(){Eden.Project.emit("load",[e])});var h="?load="+eden.project.id+"&vid="+eden.project.vid+(c?"&r="+c:"");window.history.pushState({id:eden.project.id,vid:eden.project.vid},"",h)}d&&d(eden.project)}),d&&d()},Eden.Project.prototype.start=function(a){var b=this;this.ast.execute(this,function(){if(b.ast.scripts.ACTIVE){for(var c=0;c<b.ast.script.statements.length;c++)if(b.ast.script.statements[c]===b.ast.scripts.ACTIVE){b.ast.script.statements[c].removeIndex(),b.ast.script.statements[c].destroy(),eden.root.start=b.ast.script.statements[c].start,eden.root.end=b.ast.script.statements[c].end,eden.root.prefix=b.ast.script.statements[c].prefix,eden.root.postfix=b.ast.script.statements[c].postfix,eden.root.parent=eden.project.ast.script,Eden.Index.update(eden.root),b.ast.script.statements[c]=eden.root;break}}else b.ast.script.appendChild(eden.root);eden.root.parent=b.ast.script,b.ast.scripts.ACTIVE=eden.root,a&&a()})},Eden.Project.prototype.diff=function(){var a=new diff_match_patch,b=this.generate(),c=a.diff_main(this.ast.stream.code,b);a.diff_cleanupSemantic(c);for(var d=(a.diff_prettyHtml(c),""),e=0,f=0;f<c.length;f++){var g=c[f][1].match(/[\n]+/g);if(0!=c[f][0]){if(1==c[f][0]){var h=EdenUI.Highlight.html(c[f][1]);d+="line:"+(e+1)+' + <span style="background: #ddffdd;">'+h+"</span>",null!==g&&(e+=g.length)}else if(2==c[f][1]){var h=EdenUI.Highlight.html(c[f][1]);d+="line:"+(e+1)+' - <span style="background: #ffdddd;">'+h+"</span>",null!==g&&(e-=g.length)}}else null!==g&&(e+=g.length)}return d},Eden.Project.prototype.save=function(a,b){Eden.DB.save(this,a,b)},Eden.Project.restore=function(){if(window.localStorage){var a=window.localStorage.getItem("last_project"),b=window.localStorage.getItem("last_id");"undefined"==b&&(b=void 0);var c=window.localStorage.getItem("last_vid");"undefined"==c&&(c=void 0);var d=window.localStorage.getItem("last_author");"undefined"==d&&(d=void 0);var e=window.localStorage.getItem("last_authorid"),f=window.localStorage.getItem("last_name"),g=window.localStorage.getItem("last_thumb");"undefined"==g&&(g=void 0);var h=window.localStorage.getItem("last_desc"),i=window.localStorage.getItem("last_title");a&&""!=a&&(eden.root.lookup("jseden_project_mode").assign("restore",eden.root.scope,Symbol.defaultAgent),eden.project=new Eden.Project(b,i,a),eden.project.vid=c,eden.project.author=d,eden.project.name=f,eden.project.authorid=e,eden.project.thumb=g,eden.project.desc=h,eden.project.start())}},Eden.Project.prototype.restore=function(){},Eden.Project.prototype.localSave=function(){window.localStorage&&(window.localStorage.setItem("last_project",this.generate()),window.localStorage.setItem("last_id",this.id),window.localStorage.setItem("last_vid",this.vid),window.localStorage.setItem("last_author",this.author),window.localStorage.setItem("last_authorid",this.authorid),window.localStorage.setItem("last_name",this.name),window.localStorage.setItem("last_title",this.title),window.localStorage.setItem("last_thumb",this.thumb),window.localStorage.setItem("last_desc",this.desc))},Eden.Project.prototype.patch=function(a,b){},Eden.Project.prototype.snapshot=function(){},Eden.Project.prototype.addAction=function(a){var b=Eden.AST.parseStatement("action "+a+" {}");return this.ast.script.appendChild(b),b.addIndex(),b},Eden.Project.prototype.generate=function(){return this.ast.getSource()},Eden.Project.prototype.getDescription=function(){return void 0===this.desc&&(this.desc="# "+this.title+"\nEnter a project description here,\nand some hashtags as below.\n\nTags: #"+this.tags.join(" #")),this.desc},Eden.Project.prototype.setDescription=function(a){this.desc=a;var b=new Eden.AST.DoxyComment(a,0,0);this.tags=b.getHashTags().map(function(a){return a.substring(1)})},Eden.Project.prototype.registerAgent=function(a){for(var b in a.dependencies)eden.root.lookup(b).addObserver(a.id,a)},Eden.Project.prototype.removeAgent=function(a){for(var b in a.dependencies)eden.root.lookup(b).removeObserver(a.id)},Eden.Fragment=function(a){this.name=a,this.selector=a,this.originast=void 0,this.origin=void 0,this.source=void 0,this.ast=void 0,this.lastast=void 0,this.locked=!0,this.remote=!1,this.results=[],this.title=a,this.scratch=!1,this.edited=!1,this.autosavetimer=void 0,this.history=[],this.snapshot="",this.index=-1,this.reset();var b=this;Eden.Fragment.listenTo("aststatus",this,function(a){if(a===b.originast){var c=b.originast.doxyComment;if(c){var d=c.getControls();d["@title"]&&(b.title=d["@title"][0])}Eden.Fragment.emit("status",[b])}}),Eden.Fragment.listenTo("patch",this,function(a,c){a!==b&&c===b.originast&&(b.source=b.originast.getInnerSource(),b.ast=Eden.AST.fromNode(b.originast,b),Eden.Fragment.emit("changed",[b]))}),Eden.Fragment.listenTo("lock",this,function(a,c){c===b.originast&&(b.locked=!0,Eden.Fragment.emit("locked",[b]))}),Eden.Fragment.listenTo("unlock",this,function(a,c){c===b.originast&&(b.locked=!1,Eden.Fragment.emit("unlocked",[b]))}),Eden.Fragment.listenTo("goto",this,function(a,c){if(this.originast===a){console.log("Goto line",c.getStartLine(a));var d=c.getStartLine(a);return Eden.Fragment.emit("gotoline",[b,d]),!0}return!1})},Eden.Fragment.listenTo=listenTo,Eden.Fragment.emit=emit,Eden.Fragment.unListen=unListen,Eden.Fragment.listeners={},Eden.Fragment.prototype.destroy=function(){Eden.Fragment.unListen(this),this.unlock()},Eden.Fragment.prototype.reset=function(a){var b=this;if(this.scratch)return b.lock(),b.snapshot=b.source,Eden.Fragment.emit("changed",[b]),void(a&&a());Eden.Selectors.query(this.selector,void 0,{minimum:1},function(c){if(b.results=c,b.results&&1==b.results.length&&"script"==b.results[0].type)b.originast=b.results[0];else if(b.results&&b.results.length>1){for(var d="",e=0;e<b.results.length;e++)d+=b.results[e].getSource()+"\n";b.source=d,b.originast=void 0}else b.source="",b.originast=void 0;if(b.originast){b.name=b.originast.name?b.originast.name:b.selector,b.ast=Eden.AST.fromNode(b.originast,b),b.source=b.ast.stream.code;for(var f=b.originast;f&&f.parent;)f=f.parent;b.origin=f.base?f.base.origin:{remote:!0},b.remote=b.origin.remote,b.locked=b.originast.lock>0||b.remote;var g=b.originast.doxyComment;if(g){b.doxy=g;var h=g.getControls();h["@title"]&&(b.title=h["@title"][0])}else b.doxy=void 0;Eden.Fragment.emit("changed",[b]),b.locked&&Eden.Fragment.emit("locked",[b])}else console.log("Make scratch fragment"),b.locked=!1,b.remote=!1,b.ast=new Eden.AST(b.source,void 0,b,{noindex:!0}),b.originast=b.ast.script,b.name="*Scratch*",b.title=b.name,b.scratch=!0,Eden.Fragment.emit("changed",[b]);b.lock(),b.snapshot=b.source,a&&a()})},Eden.Fragment.prototype.getSource=function(){return this.source?this.source:""},Eden.Fragment.prototype.makeReal=function(a){if(this.scratch){this.name=a,this.title=a,this.originast=eden.project.addAction(a),this.selector=Eden.Selectors.getID(this.originast),this.scratch=!1,this.remote=!1,this.setSource(this.source);for(var b=this.originast;b&&b.parent;)b=b.parent;this.origin=b.base.origin,this.lock()}},Eden.Fragment.prototype.setSourceInitial=function(a){this.source=a,this.snapshot=a,this.ast=new Eden.AST(a,void 0,this)},Eden.Fragment.AUTOSAVE_INTERVAL=500,Eden.Fragment.prototype.undo=function(){if(!(this.index<0)&&0!=this.history.length){var a=this.history[this.index];this.index--;var b;if(this.index>=0&&this.history[this.index].snapshot)b=this.history[this.index].snapshot;else{var c=new diff_match_patch,d=c.patch_fromText(a.undo);b=c.patch_apply(d,this.snapshot)[0]}this.snapshot=b,this.setSource(b)}},Eden.Fragment.prototype.canUndo=function(){return this.history.length>0&&this.index>=0},Eden.Fragment.prototype.canRedo=function(){return this.index<this.history.length-1},Eden.Fragment.prototype.redo=function(){if(!(this.index>=this.history.length-1)){this.index++;var a,b=this.history[this.index];if(b.snapshot)a=b.snapshot;else{var c=new diff_match_patch,d=c.patch_fromText(b.redo);a=c.patch_apply(d,this.snapshot)[0]}this.snapshot=a,this.setSource(a)}},Eden.Fragment.prototype.addHistory=function(a,b){this.history.push({time:Date.now()/1e3|0,redo:a,undo:b}),this.index=this.history.length-1},Eden.Fragment.prototype.autoSave=function(){if(!(void 0===this.ast||this.ast.script.errors.length>0)){if(this.originast){var a=this.originast.parent;for(this.originast.patchScript(this.ast);a;)Eden.Fragment.emit("patch",[this,a]),a=a.parent}Eden.Fragment.emit("changed",[this])}},Eden.Fragment.prototype.diff=function(){if(this.origin&&this.origin.ast&&this.originast.end>0){var a=this.origin.ast.stream.code.substring(this.originast.start,this.originast.end),b=this.originast.prefix.length,c=this.originast.postfix.length;return a=a.substring(b,a.length-c),DiffUtil.diff(a,this.source)}},Eden.Fragment.prototype.setSource=function(a){if(!this.locked){var b=this;if(this.source=a,this.edited=!0,this.ast=new Eden.AST(a,void 0,this,{noindex:!0}),0==this.ast.errors.length){if(this.originast){var c=this.originast.parent;for(this.originast.patchInner(this.ast.script),Eden.Fragment.emit("patch",[this,this.originast]);c;)Eden.Fragment.emit("patch",[this,c]),c=c.parent}Eden.Fragment.emit("status",[this]),eden.root.lookup("jseden_fragment_changed").assign(b.selector,eden.root.scope,Symbol.localJSAgent)}else Eden.Fragment.emit("errored",[this])}},Eden.Fragment.prototype.lock=function(){if(this.originast)for(var a=this.originast.parent;a;)a.lock++,Eden.Fragment.emit("lock",[this,a]),a=a.parent},Eden.Fragment.prototype.unlock=function(){if(this.originast)for(var a=this.originast.parent;a;)a.lock--,0==a.lock&&Eden.Fragment.emit("unlock",[this,a]),a=a.parent},Eden.Fragment.prototype.getTitle=function(){return this.originast&&this.originast.name?this.originast.name:this.name},Eden.Query={},Eden.Query.sortByCount=sortByCount,Eden.Query.reduceByCount=reduceByCount,Eden.Query.negativeFilter=negativeFilter,Eden.Query.search=function(a,b){var c=a.split(/[ ]+/),d=0,e=c.length,f=!0,g=!0,h=!0,i=!0,j={views:[],symbols:[],whens:[],projects:[],scripts:[],statements:[]};if(c.length>0&&":"==c[0].charAt(c[0].length-1)){if(d=1,!0,"select:"==c[0]){var k=a.substring(c[0].length).trim();return j.all=Eden.Selectors.query(k,"source"),void 0===j.all&&(j.all=[]),b&&b(j),b&&k.length>=3&&(Eden.Query.dbseltimeout&&clearTimeout(Eden.Query.dbseltimeout),Eden.Query.dbseltimeout=setTimeout(function(){Eden.Query.dbseltimeout=void 0,Eden.DB.searchSelector(k,"source",function(a){j.all.push.apply(j.all,a),b(j)})},1e3)),j}switch(c[0]){case"procs:":case"whens:":case"agents:":g=!0,f=!1,!1,h=!1,doremovescripts=!1,!0,!1;break;case"scripts:":g=!1,f=!1,h=!0,i=!0,!1,!1,!1}}for(e-=d;d<c.length;d++)if(""!=c[d])if(c[d].startsWith("depends:")){var l=c[d].split(":");if(""==l[1]){e--;continue}var m=edenUI.regExpFromStr(l[1],void 0,void 0,"regexp");f&&j.symbols.push.apply(j.symbols,Eden.Query.searchDepends(m))}else if("#"==c[d].charAt(0)){var n=edenUI.regExpFromStr("^"+c[d].substring(1),void 0,void 0,"regexp");f&&j.symbols.push.apply(j.symbols,Eden.Query.searchTags(n))}else{var m=edenUI.regExpFromStr(c[d],void 0,void 0,"regexp"),n=edenUI.regExpFromStr("^"+c[d],void 0,void 0,"regexp");f&&j.symbols.push.apply(j.symbols,Eden.Query.searchSymbols(m,n)),g&&j.whens.push.apply(j.whens,Eden.Query.searchWhens(m)),i&&c[d].length>2?function(a){Eden.Query.dbtimeout&&clearTimeout(Eden.Query.dbtimeout),Eden.Query.dbtimeout=setTimeout(function(){Eden.Query.dbtimeout=void 0,Eden.DB.search(a,function(a){j.scripts.push.apply(j.scripts,a),j.scripts=reduceByCount(j.scripts,e),j.scripts=sortByLoaded(j.scripts),Eden.Query.mergeResults(j),b&&b(j)})},500)}(c[d]):h&&j.scripts.push.apply(j.scripts,Eden.Query.searchScripts(m))}else e--;return j.symbols=reduceByCount(j.symbols,e),Eden.Query.mergeResults(j),b&&b(j),j},Eden.Query.mergeResults=function(a){function b(d,e){c=0;for(var f=e;f<a.symbols.length&&!(c>=d);f++)c++,a.all.push("/"+a.symbols[f]);c=0;for(var f=e;f<a.whens.length&&!(c>=d);f++)c++,a.all.push(a.whens[f]);c=0;for(var f=e;f<a.scripts.length&&!(c>=d-1);f++)c++,a.all.push("*script"+a.scripts[f]);c=0;for(var f=e;f<a.statements.length&&!(c>=d);f++)c++,a.all.push(a.statements[f]);(a.symbols.length>e+d||a.whens.length>e+d||a.scripts.length>e+d)&&b(2,e+d)}a.all=[];var c=0;b(3,0)},Eden.Query.searchViews=function(a){},Eden.Query.searchSymbols=function(a,b){var c=[];for(var d in eden.root.symbols){var e=eden.root.symbols[d];if(a.test(d))e.last_modified_by.internal||"_"==d.charAt(0)||c.push(d);else if(b&&eden.dictionary[d]){var f=eden.dictionary[d].getHashTags();if(f)for(var g=0;g<f.length;g++)if(b.test(f[g].substring(1))){e.last_modified_by.internal||"_"==d.charAt(0)||c.push(d);break}}}return c},Eden.Query.searchTags=function(a){var b=[];for(var c in eden.root.symbols){var d=eden.root.symbols[c];if(a&&eden.dictionary[c]){var e=eden.dictionary[c].getHashTags();if(e)for(var f=0;f<e.length;f++)if(a.test(e[f].substring(1))){d.last_modified_by.internal||"_"==c.charAt(0)||b.push(c);break}}}return b},Eden.Query.searchDepends=function(a){var b=[];for(var c in eden.root.symbols)for(var d in eden.root.symbols[c].dependencies)a.test(d)&&b.push(c);return b},Eden.Query.searchWhens=function(a){var b=[];for(var c in Eden.Agent.agents){var d=Eden.Agent.agents[c];if(d.ast)for(var e in d.ast.triggers)if(a.test(e))for(var f=d.ast.triggers[e],g=0;g<f.length;g++)-1==b.indexOf(f[g].statement)&&b.push(f[g].statement)}return b},Eden.Query.searchProjects=function(a){},Eden.Query.searchScripts=function(a){var b=[];for(var c in Eden.DB.meta)a.test(c)&&b.push(c);return b},Eden.Query.treeBottomUp=function(){function a(b){for(var c in b){var d=eden.root.symbols[c];if(d){var e=b[c];for(var f in d.subscribers)e[f]={};a(e)}}}var b={};for(var c in eden.root.symbols){var d=eden.root.symbols[c];void 0!==d.definition&&0!=Object.keys(d.dependencies).length||(b[c]={})}return a(b),b},Eden.Query.treeTopDown=function(a){function b(a){for(var c in a){var d=eden.root.symbols[c];if(d){var e=a[c];for(var f in d.dependencies)e[f]={};b(e)}}}if(void 0===a){a={};for(var c in eden.root.symbols){var d=eden.root.symbols[c];d&&(0==Object.keys(d.subscribers).length&&(a[c]={}))}}else if(Array.isArray(a)){for(var e={},f=0;f<a.length;f++)e[a[f]]={};a=e}return b(a),a},Eden.Query.objectHierarchy=function(){function a(a){if(void 0!==a.statid){var b=Eden.Statement.statements[a.statid];if(b.statement&&b.statement.doxyComment&&b.statement.doxyComment.hasTag("#library"))return!1}return!0}function b(c){for(var d in c){var e=eden.root.symbols[d];if(e&&a(e)){var f=c[d];for(var g in e.dependencies)f[g]={};b(f)}}}var c={};for(var d in eden.root.symbols){var e=eden.root.symbols[d];e&&a(e)&&(0==Object.keys(e.subscribers).length&&0!=Object.keys(e.dependencies).length&&(c[d]={}))}return b(c),c},Eden.Query.dependencyTree=function(a){function b(a,c){for(var d in c)void 0===a[d]?a[d]=c[d]:b(a[d],c[d])}function c(a){var e=a.name;if(0==Object.keys(a.subscribers).length)return void 0===d[e]&&(d[e]={}),d[e];var f={};for(var g in a.subscribers){var h=c(a.subscribers[g]);void 0!==h[e]&&b(f,h[e]),h[e]=f}return f}var d={};for(var e in a)var f=eden.root.lookup(e),g=c(f);return d},Eden.Generator={},Eden.Generator.symbolScript=function(a){var b="## Functions\n",c="\n## Definitions\n",d="\n## Restored Definition\n",e="\n## Agent Definitions\n",f="\n## Assignments\n",g="\n## Agent Assignments\n",h="\n## Input Device Assignments\n",i="\n## Restored Assignments\n";for(var j in eden.root.symbols){var k=eden.root.symbols[j],l=k.last_modified_by;if(void 0===l&&console.log(k),"string"!=typeof l.name&&console.log(l),"*Default"!=l.name&&(l.canUndo&&l.canUndo()||a&&a[l.name]||l.meta&&l.last_exec_version!=l.meta.saveID||"*"==l.name.charAt(0)||"/"==l.name.charAt(0)))if(k.eden_definition)k.eden_definition.startsWith("func")?b+=k.eden_definition+"\n":"*Restore"==l.name?d+=k.eden_definition+"\n":"*When"==l.name?e+=k.eden_definition+"\n":c+=k.eden_definition+"\n";else if(void 0!==k.cache.value){var m=j+" = "+Eden.edenCodeForValue(k.cache.value)+";\n";l instanceof Symbol&&l.eden_definition&&l.eden_definition.startsWith("proc")||"*JavaScript"==l.name||"*When"==l.name?g+=m:"*Input Device"==l.name?h+=m:"*Restore"==l.name?i+=m:f+=m}}return b+c+d+e+f+i+g+h+"\n## Procedures\n"},Eden.Generator.importsScript=function(){var a="";for(var b in Eden.Agent.agents){var c=Eden.Agent.agents[b],d="";if(-1!=c.meta.saveID||c.meta.file||(d=" create"),c.last_exec_version){var e=-1==c.last_exec_version?"origin":c.last_exec_version;a+="import "+b+"@"+e+d+";\n"}if(c.last_exec_version!=c.meta.saveID){var e=-1==c.meta.saveID?"origin":c.meta.saveID;a+="import "+b+"@"+e+d+" noexec;\n"}}return a},Eden.Generator.getScript=function(){return Eden.Generator.importsScript()+"\n"+Eden.Generator.symbolScript()},Eden.Peer=function(master,id){function processAssign(a){var b=eden.root.lookup(a.symbol.slice(1)),c=Eden.AST.parseExpression(a.value);b.assign(c.execute({},Symbol.netAgent,eden.root.scope),eden.root.scope,Symbol.netAgent),me.broadcastExcept(a.id,a)}function processDefine(obj){var sym=eden.root.lookup(obj.symbol.slice(1));sym.define(eval(obj.code),Symbol.netAgent,obj.dependencies,obj.source),me.broadcastExcept(obj.id,obj)}function processImport(a){me.broadcastExcept(a.id,a)}function processListAssign(a){var b=eden.root.lookup(a.symbol.slice(1)),c=Eden.AST.parseExpression(a.value);b.listAssign(c.execute({},Symbol.netAgent,eden.root.scope),eden.root.scope,Symbol.netAgent,!1,a.components),me.broadcastExcept(a.id,a)}function processRestore(a){me.loading=!0,Eden.DB.load(void 0,void 0,a,function(){me.loading=!1})}function processExecStatus(a){var b=Eden.Agent.agents[a.path];b&&b.meta&&b.meta.saveID==a.saveID?(b.last_exec_version=a.saveID,b.executed=!0):Eden.Agent.importAgent(a.path,a.saveID,["noexec"],function(){var b=Eden.Agent.agents[a.path];b.last_exec_version=a.saveID,b.executed=!0})}function processRegister(a){Eden.Peer.emit("user",[a.id,a.username]),eden.root.lookup("jseden_p2p_"+a.id+"_name").assign(a.username,eden.root.scope,Symbol.localJSAgent)}function processGetSnapshot(a){var b=Eden.Generator.getScript();me.connections[a.id].connection.send(JSON.stringify({cmd:"callback",data:b,cbid:a.cbid}))}function processReqShare(a){var b=me.connections[a.id];if(a.value){b.share=!0;var c=Eden.Generator.getScript();b.connection.send(JSON.stringify({cmd:"restore",script:c})),b.connection.send(JSON.stringify({cmd:"callback",data:!0,cbid:a.cbid})),Eden.Peer.emit("share",[a.id])}else b.share=!1,Eden.Peer.emit("unshare",[a.id])}function processReqObserve(a){var b=me.connections[a.id];a.value?(b.observe=!0,b.connection.send(JSON.stringify({cmd:"callback",data:!0,cbid:a.cbid})),Eden.Peer.emit("observe",[a.id])):(b.observe=!1,Eden.Peer.emit("unobserve",[a.id]))}function processCallback(a){var b=me.callbacks[a.cbid];b&&b(a.data),delete me.callbacks[a.cbid]}function processPatch(a){}function processOwnership(a){}function processDoxy(a){eden.updateDictionary(a.symbol,new Eden.AST.DoxyComment(a.content,0,0),!0)}function processData(a,b){var c=JSON.parse(b);c.id=a.peer;var d=me.connections[c.id];switch(c.cmd){case"assign":d.observe&&processAssign(c);break;case"define":d.observe&&processDefine(c);break;case"import":d.observe&&processImport(c);break;case"listassign":d.observe&&processListAssign(c);break;case"restore":d.observe&&processRestore(c);break;case"execstatus":d.observe&&processExecStatus(c);break;case"register":processRegister(c);break;case"getsnapshot":processGetSnapshot(c);break;case"callback":processCallback(c);break;case"reqshare":processReqShare(c);break;case"reqobserve":processReqObserve(c);break;case"patch":processPatch(c);break;case"ownership":processOwnership(c);break;case"doxy":processDoxy(c)}me.config.logging&&console.log(c)}function init(a){if(a){var b;a.replace(/[ \!\'\-\?\&]/g,"");b=id?new Peer(id,{key:"w2cjkz0cpw6x0f6r",config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}}):new Peer({key:"w2cjkz0cpw6x0f6r",config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}}),(id||master)&&(me.enabled=!0),b.on("open",function(a){if(console.log("My peer id is "+a),master){var c=b.connect(master,{reliable:!0});c.on("open",function(){me.connections[c.peer]={id:c.peer,username:void 0,connection:c,share:!1,observe:!1},c.on("data",function(a){processData(c,a)}),eden.root.lookup("jseden_p2p_newconnections").append(c.peer,eden.root.scope,Symbol.localJSAgent),c.send(JSON.stringify({cmd:"register",username:Eden.DB.username,id:a}))})}}),b.on("connection",function(a){me.connections[a.peer]={id:a.peer,username:void 0,connection:a,share:!1,observe:!1},a.on("data",function(b){processData(a,b)}),console.log("Peer connection from "+a.peer),Eden.Peer.emit("peer",[a.peer]),eden.root.lookup("jseden_p2p_newconnections").append(a.peer,eden.root.scope,Symbol.localJSAgent),a.on("open",function(){if(me.config.share){var b=Eden.Generator.getScript();a.send(JSON.stringify({cmd:"restore",script:b}))}})}),b.on("error",function(a){console.log("Peer error: ",a),Eden.Peer.emit("error",[a]),eden.root.lookup("jseden_p2p_errors").append(a,eden.root.scope,Symbol.localJSAgent)}),b.on("disconnected",function(a){Eden.Peer.emit("disconnect",[a.peer,me.connections[a.peer]?me.connections[a.peer].username:void 0]),delete me.connections[a.peer],eden.root.lookup("jseden_p2p_newdisconnections").append(a.peer,eden.root.scope,Symbol.localJSAgent)})}Eden.Agent.listenTo("patch",this,function(a,b,c){if(a&&me.capturepatch){var d={cmd:"patch",name:a.name,patch:b,lineno:c};me.broadcast(d)}}),Eden.Agent.listenTo("owned",this,function(a,b){"net"!=b&&me.capturepatch&&me.broadcast({cmd:"ownership",name:a.name,owned:a.owned})}),Eden.Agent.listenTo("version",this,function(a,b,c){console.log("VERSION CHANGE",a.name,b),me.imports(a,a.name,b,["noexec"])}),Eden.Agent.listenTo("execute",this,function(a,b,c){me.broadcast(JSON.stringify({cmd:"execstatus",path:a.name,saveID:c}))})}function createDialog(a,b){a.slice(0,-7);$('<div id="'+a+'"></div>').html("").dialog({title:"Peer Connections",width:200,height:300,minHeight:120,minWidth:100})}this.connections={},this.id=id,this.master=master;var me=this;this.roles={},this.enabled=!1,this.loading=!1,this.config={control:!0,share:!1,observe:!1,logging:!1},this.callbacks={},this.callbackid=0,this.capturepatch=!1,void 0===eden.root.lookup("jseden_p2p_newconnections").value()&&eden.root.lookup("jseden_p2p_newconnections").assign([],eden.root.scope,Symbol.defaultAgent),void 0===eden.root.lookup("jseden_p2p_newdisconnections").value()&&eden.root.lookup("jseden_p2p_newdisconnections").assign([],eden.root.scope,Symbol.defaultAgent),void 0===eden.root.lookup("jseden_p2p_errors").value()&&eden.root.lookup("jseden_p2p_errors").assign([],eden.root.scope,Symbol.defaultAgent),Eden.Selectors.execute("lib > p2p"),Eden.DB.listenTo("login",this,init),Eden.DB.isLoggedIn()&&init(Eden.DB.username);var capInSym=eden.root.lookup("jseden_p2p_captureinput");capInSym.addJSObserver("p2p",function(a,b){b?(Symbol.hciAgent.local=!1,Symbol.localJSAgent.local=!1):(Symbol.hciAgent.local=!0,Symbol.localJSAgent.local=!0)});var capEdSym=eden.root.lookup("jseden_p2p_captureedits");capEdSym.addJSObserver("p2p",function(a,b){me.capturepatch=b}),edenUI.views.Peers={dialog:createDialog,title:"Connections",category:edenUI.viewCategories.environment},edenUI.menu.updateViewsMenu()},Eden.Peer.listeners={},Eden.Peer.emit=emit,Eden.Peer.listenTo=listenTo,Eden.Peer.prototype.broadcast=function(a){if(!this.loading){a=JSON.stringify(a);for(var b in this.connections){var c=this.connections[b];c.share&&c.connection.send(a)}}},Eden.Peer.prototype.broadcastExcept=function(a,b){if(!this.loading){b=JSON.stringify(b);for(var c in this.connections)if(c!=a){var d=this.connections[c];d.share&&d.connection.send(b)}}},Eden.Peer.prototype.authoriseWhen=function(a){if(this.enabled){if(a.doxyComment){var b=a.doxyComment.getControls()["@role"];if(b){for(var c=0;c<b.length;c++){if("@role"==b[c]&&void 0!==this.id)return!0;if(this.roles[b[c]])return!0}return!1}}return!0}return!0},Eden.Peer.prototype.doxy=function(a,b){},Eden.Peer.prototype.assign=function(a,b,c){!a||a.loading||a.local||this.broadcast({cmd:"assign",symbol:b,value:Eden.edenCodeForValue(c)})},Eden.Peer.prototype.define=function(a,b,c,d,e){!a||a.loading||a.local||this.broadcast({cmd:"define",symbol:b,source:c,code:d,dependencies:e})},Eden.Peer.prototype.imports=function(a,b,c,d){!a||a.loading||a.local||this.broadcast({cmd:"import",path:b,tag:c,options:d})},Eden.Peer.prototype.listAssign=function(a,b,c,d){!a||a.loading||a.local||this.broadcast({cmd:"listassign",symbol:b,value:Eden.edenCodeForValue(c),components:d})},Eden.Peer.prototype.addCallback=function(a){var b=this.callbackid++;return this.callbacks[b]=a,b},Eden.Peer.prototype.getSnapshot=function(a,b){this.connections[a]&&this.connections[a].connection.send(JSON.stringify({cmd:"getsnapshot",cbid:this.addCallback(b)}))},Eden.Peer.prototype.requestShare=function(a,b){var c=this.connections[a];c&&(c.observe=!0,c.connection.send(JSON.stringify({cmd:"reqshare",value:!0,cbid:this.addCallback(b)})))},Eden.Peer.prototype.requestUnShare=function(a,b){var c=this.connections[a];c&&(c.observe=!1,c.connection.send(JSON.stringify({cmd:"reqshare",value:!1,cbid:this.addCallback(b)})))},Eden.Peer.prototype.requestObserve=function(a,b){var c=this.connections[a];if(c){c.share=!0,c.connection.send(JSON.stringify({cmd:"reqobserve",value:!0,cbid:this.addCallback(b)}));var d=Eden.Generator.getScript();c.connection.send(JSON.stringify({cmd:"restore",script:d}))}},Eden.Peer.prototype.requestUnObserve=function(a,b){var c=this.connections[a];c&&(c.share=!1,c.connection.send(JSON.stringify({cmd:"reqobserve",value:!1,cbid:this.addCallback(b)})))},Eden.Peer.prototype.requestCollaborate=function(a,b){var c=this,d=this.connections[a];d&&d.connection.send(JSON.stringify({cmd:"reqshare",value:!0,cbid:this.addCallback(function(){d.observe=!0,c.requestObserve(a,b)})}))},Eden.Peer.prototype.requestUnCollaborate=function(a,b){};Eden.AST.DummyContext={subscribeDynamic:function(a,b){return eden.root.lookup(b)},scopes:[]},Eden.AST.prototype.executeGenerator=function*(a,b,c,d,e){var f=[];this.executed=1;var g=0;if(void 0!==a)for(;g<a.length||f.length>0;)if(g>=a.length&&f.length>0)a=f[f.length-1].statements,g=f[f.length-1].index,d=f[f.length-1].scope,f.pop(),!0;else{if(Eden.AST.debug&&"script"!=a[g].type&&(Eden.AST.debugstep||e&&e.doDebug&&e.doDebug())){var h={type:"debug",base:c,script:this,index:g,statement:a[g],context:b,agent:e};yield h}if("wait"==a[g].type)a[g].executed=1,a[g].compile(b),a[g].compiled_delay?yield a[g].compiled_delay(eden.root,d):yield 0;else if("import"==a[g].type)void 0===a[g].statements&&(a[g].selector=a[g].path?a[g].path.execute(b,c,d,e):void 0,yield a[g]);else if("do"==a[g].type)a[g].executed=1,a[g].selector=a[g].name?a[g].name.execute(b,c,d,e):void 0,a[g].params=a[g].getParameters(void 0,c,d),a[g].nscope=a[g].scope?a[g].getScope(b)(eden.root,d):d,yield a[g];else if("when"==a[g].type){var i=a[g];if(0==i.active){i.active=!0;var j=i.execute(void 0,c,eden.root.scope,e);j?c.executeStatements(j,-1,i):i.active=!1}}else{var j=a[g].execute(b,c,d,e);if(j&&Array.isArray(j)&&j.length>0){var k=d;"scopedscript"==a[g].type&&(k=a[g].scope),g++,g<a.length&&f.push({statements:a,index:g,scope:d}),a=j,d=k,g=0;continue}}a[g].errors.length>0&&this.script.errors.push.apply(this.script.errors,a[g].errors),g++}},Eden.AST.prototype.executeStatement=function(a,b,c,d){Eden.AST.debug&&(Eden.AST.debugstep||c&&c.doDebug&&c.doDebug())&&Eden.AST.debug_begin_cb&&Eden.AST.debug_begin_cb({base:this,agent:c}),Eden.AST.DummyContext.locals=void 0;try{var e=this.executeGenerator([a],Eden.AST.DummyContext,this,eden.root.scope,c)
;runEdenAction.call(this,c,e,function(){Eden.AST.debug&&(Eden.AST.debugstep||c&&c.doDebug&&c.doDebug())&&Eden.AST.debug_end_cb&&Eden.AST.debug_end_cb({base:this,agent:c}),d&&d()})}catch(a){Eden.AST.debug&&(Eden.AST.debugstep||c&&c.doDebug&&c.doDebug())&&Eden.AST.debug_end_cb&&Eden.AST.debug_end_cb({base:this,agent:c}),d&&d();var f;f=/[0-9][0-9]*/.test(a.message)?new Eden.RuntimeError(this,parseInt(a.message),void 0,a.message):new Eden.RuntimeError(this,0,void 0,a),f.line=this.line,c?eden.emit("error",[c,f]):console.log(f.prettyPrint())}},Eden.AST.prototype.executeStatements=function(a,b,c,d,e,f){void 0===f&&(f=eden.root.scope),Eden.AST.debug&&(Eden.AST.debugstep||c&&c.doDebug&&c.doDebug())&&Eden.AST.debug_begin_cb&&Eden.AST.debug_begin_cb({base:this,agent:c});try{var g=this.executeGenerator(a,e,this,f,c);runEdenAction.call(this,c,g,function(){Eden.AST.debug&&(Eden.AST.debugstep||c&&c.doDebug&&c.doDebug())&&Eden.AST.debug_end_cb&&Eden.AST.debug_end_cb({base:this,agent:c}),d&&d()})}catch(a){Eden.AST.debug&&(Eden.AST.debugstep||c&&c.doDebug&&c.doDebug())&&Eden.AST.debug_end_cb&&Eden.AST.debug_end_cb({base:this,agent:c}),d&&d();var h;h=/[0-9][0-9]*/.test(a.message)?new Eden.RuntimeError(this,parseInt(a.message),void 0,a.message):new Eden.RuntimeError(this,0,void 0,a),h.line=this.line,c?eden.emit("error",[c,h]):console.log(h.prettyPrint())}};