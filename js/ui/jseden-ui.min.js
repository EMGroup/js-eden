!function(e){function t(e,t,i,n){function s(){o.insertBefore(t,a)}var o=t.parentNode,a=t.nextSibling;o?(o.removeChild(t),"boolean"!=typeof i&&(n=i,i=!1),n&&i?n.call(e,t,s):n&&(n.call(e,t),s())):n.call(e,t)}EdenUI.Highlight=function(e,t){this.ast=void 0,this.outelement=e,this.line=1,this.currentline=-1,this.mode_at_line={},this.heredocend=void 0,this.scrolltop=-1,this.token=void 0,this.prevtoken=void 0,this.modestack=[],this.linestack=void 0,this.outerline=void 0,this.lineelement=void 0,this.startmode=t&&t.start?t.start:"START",this.styles=t&&t.styles?t.styles:EdenUI.Highlight.defaultStyles,this.clearmodes=t&&t.clearmodes?t.clearmodes:EdenUI.Highlight.lineclearmode,this.mode=this.startmode,this.incomment=!1,this.brline=t&&t.brline,this.styleExtensions={},this.metrics={}},EdenUI.Highlight.defaultStyles={comment:"eden-comment","hidden-comment":"eden-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",parameter:"eden-parameter",keyword:"eden-keyword",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"eden-comment-h1","comment-h2":"eden-comment-h2","comment-h3":"eden-comment-h3","comment-h4":"eden-comment-h4","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"eden-line-script",doxytag:"eden-doxytag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote",script:"eden-script",notexist:"eden-notexist"},EdenUI.Highlight.prototype.pushLine=function(){this.linestack.push(this.lineelement)},EdenUI.Highlight.prototype.pushMode=function(){this.modestack.push(this.mode)},EdenUI.Highlight.prototype.popLine=function(){this.linestack.length>0&&(this.lineelement=this.linestack.pop())},EdenUI.Highlight.prototype.popMode=function(){this.modestack.length>0&&(this.mode=this.modestack.pop())},EdenUI.Highlight.prototype.setScrollTop=function(e){this.scrolltop=e},EdenUI.Highlight.isType=function(e){return!1},EdenUI.Highlight.lineclearmode={COMMENT:!0,SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE3:!0,SECTION_TITLE4:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,SECTION_TITLE_H3:!0,SECTION_TITLE_H4:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,COMMENT_BOLD_END:!0,COMMENT_QUERY:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0,COMMENT_HTML:!0,COMMENT_HTML_START:!0,COMMENT_HTML_CONTENT:!0,COMMENT_ATTRS:!0},EdenUI.Highlight.prototype.applyClasses=function(e,t){for(var i=t||this.classes,n="",s=0;s<i.length;s++)if(n+=this.styles[i[s]]+" ",this.styleExtensions[i[s]]){var o=this.styleExtensions[i[s]];for(var a in o)this.applyAttribute(e,a,o[a])}e.className=n.trim()},EdenUI.Highlight.prototype.generateClasses=function(){for(var e="",t=0;t<this.classes.length;t++)e+=this.styles[this.classes[t]]+" ";return e.trim()},EdenUI.Highlight.prototype.highlightLine=function(e,t){var i=-1,n=-1,s=!1,o=e.stream;this.stream=o;var a="INVALID",r="INVALID";this.outerline="eden-line",this.linestack=[],this.mode_at_line[this.line-1]?this.mode=this.mode_at_line[this.line-1]:this.mode=this.startmode,this.clearmodes[this.mode]&&(this.incomment=!1,this.mode=this.startmode),e.script&&e.script.errors.length>0&&(i=e.script.errors[0].prevposition,n=e.script.errors[0].position,e.script.errors[0].messageText());var d="",l=document.createElement("div");for(l.className=this.styles["script-line"];;){if(o.position==t){if(""!=d){h=document.createTextNode(d);l.appendChild(h),d=""}(p=document.createElement("span")).className="fake-caret",l.appendChild(p);for(v=l;v&&"DIV"!=v.nodeName;)v=v.parentNode;v&&v.className.startsWith(this.styles["comment-line"])&&(v.className+=" current")}var c=o.peek();if(10==c||13==c){if(""!=d){if(l.lastChild&&l.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=l.lastChild.className)if(l.lastChild.lastChild&&"#text"==l.lastChild.lastChild.nodeName)l.lastChild.lastChild.textContent+=d;else{h=document.createTextNode(d);l.lastChild.appendChild(h)}else{h=document.createTextNode(d);l.appendChild(h)}d=""}break}if(9!=c&&13!=c&&32!=c&&160!=c){if(""!=d){if(l.lastChild&&l.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=l.lastChild.className)if(l.lastChild.lastChild&&"#text"==l.lastChild.lastChild.nodeName)l.lastChild.lastChild.textContent+=d;else{h=document.createTextNode(d);l.lastChild.appendChild(h)}else{h=document.createTextNode(d);l.appendChild(h)}d=""}if(r=a,"string"!=typeof(a=o.readToken(this.incomment))&&console.error("Token error: line = "+this.line+" position = "+o.position),"EOF"==a){if(""!=d){if(l.lastChild&&l.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=l.lastChild.className)if(l.lastChild.lastChild&&"#text"==l.lastChild.lastChild.nodeName)l.lastChild.lastChild.textContent+=d;else{h=document.createTextNode(d);l.lastChild.appendChild(h)}else{var h=document.createTextNode(d);l.appendChild(h)}d=""}break}if("INVALID"!=a)if(this.token=a,this.prevtoken=r,this.type=o.tokenType(a),this.classes=[],this.tokentext=o.tokenText(),this.lineelement=l,-1!=i&&(i<=o.prevposition&&!s&&(s=!0),n<=o.prevposition&&s&&(s=!1),s&&!0),s&&"EOF"!=e.script.errors[0].token&&this.classes.push("error"),void 0===this[this.mode]&&console.error("No Mode",this.mode),this[this.mode].call(this),l=this.lineelement,o.prevposition<t&&o.position>t){var p=t-o.prevposition,u=this.tokentext.slice(0,p),m=this.tokentext.slice(p),g=document.createElement("span");this.applyClasses(g),(f=document.createElement("span")).appendChild(document.createTextNode(u)),g.appendChild(f),(p=document.createElement("span")).className="fake-caret",g.appendChild(p),(f=document.createElement("span")).appendChild(document.createTextNode(m)),g.appendChild(f),l.appendChild(g);for(var v=l;v&&"DIV"!=v.nodeName;)v=v.parentNode;v&&v.className.startsWith(this.styles["comment-line"])&&(v.className+=" current")}else if(l.lastChild&&l.lastChild.className==this.generateClasses())(f=l.lastChild).lastChild&&"#text"==f.lastChild.nodeName?f.lastChild.textContent+=this.tokentext:f.appendChild(document.createTextNode(this.tokentext));else{var f=document.createElement("span");this.applyClasses(f),f.appendChild(document.createTextNode(this.tokentext)),l.appendChild(f)}else console.log("INVALID: "+o.peek()),o.skip()}else o.skip(),32==c||160==c?d+=" ":13!=c&&(d+=String.fromCharCode(c))}return this.linestack.length>0&&(l=this.linestack[0]),this.mode_at_line[this.line]=this.mode,l},EdenUI.Highlight.prototype.updateAST=function(e){this.ast=e,this.errstart=-1,this.errend=-1,this.errmsg="",this.inerror=!1,this.stream=e.stream,this.stream.reset(),this.title="",e.script&&e.script.errors.length>0&&(this.errstart=e.script.errors[0].prevposition,this.errend=e.script.errors[0].position,this.errmsg=e.script.errors[0].messageText())},EdenUI.Highlight.prototype.highlightAll=function(e,i){var n=void 0,s=!1,o=0,a=this.stream;this.metrics={},this.styleExtensions={},t(this,this.outelement,!1,function(){for(;this.outelement.lastChild;)this.outelement.removeChild(this.outelement.lastChild);for(this.mode_at_line={};a.valid();){var t=a.peek();if(10!=t&&13!=t)if(this.disablehl||this.scrolltop>=0&&(this.line<this.scrolltop-105||this.line>this.scrolltop+105)){var r,d=a.code.indexOf("\n",a.position);-1==d?(r=a.code.substring(a.position),a.position=a.code.length):(r=a.code.substring(a.position,d),a.position=d),n=document.createTextNode(r),this.disablehl||"#"!=r.trim().charAt(0)||(this.outerline="eden-line eden-wrapline")}else n=this.highlightLine(this.ast,e);else{s=o<=this.errstart&&a.position>=this.errend,(c=document.createElement("div")).className=this.outerline,i&&i.spacing&&i.spacing[this.line]&&(c.height=i.spacing[this.line]+"px"),c.setAttribute("data-line",this.line-1),this.line++,void 0===n&&this.brline&&(n=document.createElement("br")),void 0!==n?c.appendChild(n):this.mode_at_line[this.line-1]=this.mode;var l=document.createTextNode("\n");c.appendChild(l),this.outelement.appendChild(c),o=a.position+1,n=void 0,a.skip(),13==t&&a.skip(),this.outerline="eden-line"}}if(s=o<=this.errstart&&a.position>=this.errend,void 0===n&&this.brline&&(n=document.createElement("br")),void 0!==n)(c=document.createElement("div")).className="eden-line",c.style.height=(i&&i.spacing&&i.spacing[this.line]?i.spacing[this.line]:20)+"px",c.setAttribute("data-line",this.line-1),c.appendChild(n),this.outelement.appendChild(c);else{var c=document.createElement("div");if(e>=a.position){c.className="eden-line",c.style.height=(i&&i.spacing&&i.spacing[this.line]?i.spacing[this.line]:20)+"px",c.setAttribute("data-line",this.line-1);var h=document.createElement("span");h.className="fake-caret",c.appendChild(h)}else c.className="eden-line";this.outelement.appendChild(c)}})},EdenUI.Highlight.prototype.highlightOpt=function(e,t,i){for(var n=void 0,s=0,o=this.stream;o.valid()&&this.line<e-1;)10!=(g=o.peek())&&13!=g||this.line++,o.skip(),13==g&&o.skip();for(var a=2;a>=0;a--)if(this.line=e-a+1,this.metrics[this.line]&&delete this.metrics[this.line],void 0!==(f=this.outelement.childNodes[e-a])){for(;f.lastChild;)f.removeChild(f.lastChild);if(s=o.position,this.disablehl){var r,d=o.code.indexOf("\n",o.position);if(-1==d?(r=o.code.substring(o.position),o.position=o.code.length):(r=o.code.substring(o.position,d),o.position=d),s<t&&o.position>t){var l=t-s,c=r.slice(0,l),h=r.slice(l),p=document.createElement("span"),u=document.createTextNode(c);p.appendChild(u),(l=document.createElement("span")).className="fake-caret",p.appendChild(l);var m=document.createTextNode(h);p.appendChild(m),n=p}else n=document.createTextNode(r)}else n=this.highlightLine(this.ast,t);s<=this.errstart&&o.position>=this.errend,f.appendChild(n),f.className=this.outerline;var g=o.peek(),v=document.createTextNode("\n");f.appendChild(v),o.skip(),13==g&&o.skip()}if(!this.disablehl)for(;void 0!==this.mode_at_line[this.line+1]&&this.mode_at_line[this.line]!=this.mode_at_line[this.line+1];){this.line++,this.metrics[this.line]&&delete this.metrics[this.line];var f=this.outelement.childNodes[this.line-1];if(void 0!==f){for(;f.lastChild;)f.removeChild(f.lastChild);s=o.position,n=this.highlightLine(this.ast,t),s<=this.errstart&&o.position>=this.errend,f.appendChild(n),f.className=this.outerline;var g=o.peek(),v=document.createTextNode("\n");f.appendChild(v),o.skip(),13==g&&o.skip()}}},EdenUI.Highlight.prototype.highlight=function(e,t,i,n){if(this.ast=e,this.updateAST(e),this.line=1,void 0!==this.outelement){if(0!=e.stream.code.length)return this.disablehl=!(!n||!n.disabled),-1==t?this.highlightAll(i,n):this.highlightOpt(t,i,n);this.outelement&&(this.outelement.innerHTML="<div class='eden-line'><span class='fake-caret'></span></div>")}},EdenUI.Highlight.html=function(e,t,i){var n=document.createElement("div"),s=new EdenUI.Highlight(n);if(s.ast={stream:new EdenStream(e)},s.highlight(s.ast,-1,-1,void 0),t)return n.childNodes[0].innerHTML;for(var o="",a=0;a<n.childNodes.length;a++)o+=n.childNodes[a].innerHTML;return i?'<div style="display: flex; align-items: center;"><div class="eden-hl-play" data-src="'+e+'">&#xf04b;</div><div>'+o+"</div></div>":o}}("undefined"!=typeof window?window:global);var edenFunctions={apply:!0,array:!0,canvasURL:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,doDefault:!0,edenCode:!0,escapeRE:!0,foldl:!0,foldr:!0,hasProperty:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,positionInList:!0,positionOfRE:!0,substringPosition:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,distanceMoved:!0,angleTurned:!0,List:!0,listcat:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,Menu:!0,MenuItem:!0,min:!0,mod:!0,nameof:!0,partApply:!0,Point:!0,pow:!0,properties:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,RE:!0,replaceFirst:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundMultiple:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sort:!0,str:!0,sqrt:!0,strcat:!0,sublist:!0,substitute:!0,substr:!0,sum:!0,tail:!0,trim:!0,type:!0,uppercase:!0,include_css:!0,html:!0,time:!0,execute:!0,Text:!0,textWidth:!0,textHeight:!0,Arc:!0,Curve:!0,FillPattern:!0,Ellipse:!0,Line:!0,LinearGradient:!0,LineSequence:!0,PixelList:!0,GreyPixelList:!0,Rectangle:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,CombinedRotation:!0,Scale:!0,Translate:!0,RoundedRectangle:!0,Polygon:!0,RegularPolygon:!0,Sector:!0,Shadow:!0,Circle:!0,Button:!0,Checkbox:!0,Div:!0,Image:!0,imageWithZones:!0,HTMLImage:!0,RadioButtons:!0,Slider:!0,Textbox:!0,DropDownList:!0,Combobox:!0,BulletSlide:!0,Video:!0,Audio:!0,Slide:!0,TitledSlide:!0,TitleSlide:!0,cos:!0,sin:!0,tan:!0,abs:!0,acos:!0,asin:!0,atan:!0,ceil:!0,roundUp:!0,exp:!0,floor:!0,roundDown:!0,log:!0,random:!0,forget:!0,forgetAll:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observableOnTopAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnBottomAt:!0,shapesAt:!0,zonesAt:!0,observablesAt:!0,observableForShape:!0,alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showObservables:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0},edenSpecials={autocalc:!0,mouseX:!0,mouseY:!0,mousePosition:!0,screenHeight:!0,screenWidth:!0,PI:!0},edenValues={true:!0,false:!0,green:!0},jskeywords={var:!0,if:!0,while:!0,typeof:!0,this:!0,function:!0,return:!0,else:!0,break:!0,continue:!0,switch:!0,for:!0,prototype:!0};EdenUI.Highlight.prototype.START=function(){switch(this.token){case"##":"INVALID"==this.prevtoken?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE",this.applyClasses(this.lineelement,["comment-line"]),32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes.push("comment"),this.mode="COMMENT");break;case"#":if("INVALID"==this.prevtoken||";"==this.prevtoken){var e=33==this.stream.peek();e&&(this.tokentext+="!",this.stream.position++),this.classes.push("hidden-comment"),this.mode="COMMENT",this.incomment=!0,"INVALID"==this.prevtoken&&(this.lineelement.style.marginLeft="0");i=document.createElement("div");this.applyClasses(i,e?["comment-line","doxycomment"]:["comment-line"]),this.pushLine(),this.lineelement.appendChild(i),this.lineelement=i,32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)}else this.classes.push("operator");break;case"local":case"para":case"handle":case"role":case"oracle":case"auto":this.classes.push("storage");break;case"NUMBER":this.classes.push("number");break;case"STRING":this.classes.push("string");break;case"BOOLEAN":this.classes.push("constant");break;case"CHARACTER":this.classes.push("string");break;case"import":case"do":this.classes.push("keyword"),this.pushMode(),this.mode="SELECTOR";break;case"${{":this.classes.push("javascript"),this.mode="JAVASCRIPT";break;case"?":this.classes.push("selector"),this.pushMode(),this.mode="SELECTOR";break;case"<<":this.stream.readToken();var t=this.stream.tokenText();this.tokentext+=t,this.heredocend=t,this.classes.push("storage"),this.mode="HEREDOC";break;case"OBSERVABLE":edenFunctions[this.stream.data.value]?this.classes.push("function"):EdenUI.Highlight.isType(this.stream.data.value)?this.classes.push("type"):edenValues[this.stream.data.value]?this.classes.push("constant"):edenSpecials[this.stream.data.value]?this.classes.push("special"):"$"==this.stream.data.value.charAt(0)?this.classes.push("parameter"):(this.classes.push("observable"),Eden.Index.name_index.hasOwnProperty(this.stream.data.value)||eden.root.symbols.hasOwnProperty(this.stream.data.value)||this.classes.push("notexist"));break;case"`":this.pushMode(),this.mode="BACKTICK",this.pushLine();var i=document.createElement("span");this.applyClasses(i,["backticks"]),this.lineelement.appendChild(i),this.lineelement=i;break;default:"keyword"==this.type?this.classes.push("keyword"):"-"==this.token&&this.stream.isNumeric(this.stream.peek())?(this.token=this.stream.readToken(),this.tokentext="-"+this.stream.tokenText(),this.classes.push("number")):"/*"==this.token?42==this.stream.peek()?(this.mode="DOXY_COMMENT",this.classes.push("block-comment")):(this.mode="BLOCK_COMMENT",this.classes.push("block-comment")):this.classes.push("operator")}},EdenUI.Highlight.prototype.BACKTICK=function(){"`"==this.token?this.mode="ENDBACKTICK":"}"==this.token?(this.popMode(),this.classes.push("operator")):this.START()},EdenUI.Highlight.prototype.ENDBACKTICK=function(){this.popLine(),this.popMode(),this.START()},EdenUI.Highlight.prototype.SELECTOR=function(){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["pathblock"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="SELECTOR2",this.SELECTOR2()},EdenUI.Highlight.prototype.SELECTOR2=function(){"{"==this.token?(this.classes.push("operator"),this.pushMode(),this.mode=this.startmode):"["==this.token?(this.classes.push("selector"),this.mode="SELECTOR_TYPES"):";"==this.token||"="==this.token||"+="==this.token||"//="==this.token?(this.popLine(),this.classes.push("operator"),this.popMode()):"::"==this.token||"with"==this.token?(this.popLine(),this.classes.push("keyword"),this.popMode()):"OBSERVABLE"!=this.token||"."!=this.prevtoken&&":"!=this.prevtoken||!Eden.Selectors.PropertyNode.attributes[this.tokentext]&&!Eden.Selectors.PropertyNode.pseudo[this.tokentext]?this.classes.push("selector"):this.classes.push("selector2")},EdenUI.Highlight.prototype.SELECTOR_TYPES=function(){"OBSERVABLE"==this.token&&Eden.Selectors.resultTypes[this.tokentext]?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.mode="SELECTOR2"):this.classes.push("selector")},EdenUI.Highlight.prototype.JAVASCRIPT=function(){this.classes.push("javascript"),"}}$"==this.token&&(this.mode=this.startmode)},EdenUI.Highlight.prototype.HEREDOC=function(){"INVALID"==this.prevtoken&&this.tokentext==this.heredocend?(this.classes.push("storage"),this.mode=this.startmode):this.classes.push("string")},EdenUI.Highlight.prototype.SECTION_TITLE=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.applyClasses(this.lineelement,["comment-line","comment-h2"]),this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):"##"==this.token?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.applyClasses(this.lineelement,["comment-line","comment-h1"]),this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE2=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes.push("comment-h2"),this.mode="SECTION_TITLE_H2")},EdenUI.Highlight.prototype.SECTION_TITLE3=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.applyClasses(this.lineelement,["comment-line","comment-h4"]),this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.applyClasses(this.lineelement,["comment-line","comment-h3"]),this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE4=function(){this.classes.push("comment-h4"),this.mode="SECTION_TITLE_H4"},EdenUI.Highlight.prototype.SECTION_TITLE_H1=function(){this.classes.push("comment-h1")},EdenUI.Highlight.prototype.SECTION_TITLE_H2=function(){this.classes.push("comment-h2")},EdenUI.Highlight.prototype.SECTION_TITLE_H3=function(){this.classes.push("comment-h3")},EdenUI.Highlight.prototype.SECTION_TITLE_H4=function(){this.classes.push("comment-h4")},EdenUI.Highlight.prototype.BLOCK_COMMENT=function(){switch(this.token){case"*/":this.mode=this.startmode,this.classes.push("block-comment");break;default:this.classes.push("block-comment")}},EdenUI.Highlight.prototype.COMMENT=function(){switch(this.token){case"@":case"#":this.mode="COMMENT_TAG",this.pushLine();e=document.createElement("span");this.applyClasses(e,["doxytag"]),this.lineelement.appendChild(e),this.lineelement=e;break;case"-":case"*":if("##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek())"-"!=this.token?(this.pushMode(),this.mode="COMMENT_EMPH",this.classes.push("hidden-comment")):this.classes.push("comment");else{this.pushLine();e=document.createElement("span");this.applyClasses(e,["comment-ul"]),this.lineelement.appendChild(e),this.lineelement=e,this.classes.push("hidden-comment")}break;case"--":if(45==this.stream.peek()){for(this.outerline="eden-line eden-section-line";45==this.stream.peek();)this.tokentext+="-",this.stream.position++;this.classes.push("hidden-comment")}else this.classes.push("comment");break;case"[":if(32!=this.stream.peek()){this.pushMode(),this.mode="COMMENT_LINK",this.pushLine();var e=document.createElement("span");this.lineelement.appendChild(e),this.lineelement=e,this.classes.push("hidden-comment")}else this.classes.push("comment");break;case"!":91==this.stream.peek()?(this.mode="COMMENT_IMAGE",this.tokentext+="[",this.stream.position++,this.classes.push("hidden-comment")):this.classes.push("comment");break;case"$":91==this.stream.peek()?(this.pushMode(),this.mode="COMMENT_BUTTON",this.tokentext+="[",this.stream.position++,this.classes.push("hidden-comment")):this.classes.push("comment");break;case">":"##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek()?this.classes.push("comment"):(this.outerline+=" "+this.styles["comment-blockquote"],this.classes.push("hidden-comment"));break;case"`":this.pushMode(),this.mode="COMMENT_CODE",this.classes.push("hidden-comment");break;case":":32!=this.stream.peek()?(this.pushMode(),this.mode="COMMENT_ICON",this.classes.push("hidden-comment")):this.classes.push("comment");break;case"<":32!=this.stream.peek()?(this.mode="COMMENT_HTML",this.classes.push("hidden-comment")):this.classes.push("comment");break;case'"':this.pushMode(),this.mode="COMMENT_ESCAPE",this.classes.push("hidden-comment");break;case"?":this.pushMode(),this.mode="COMMENT_QUERY",this.cacheddata=void 0,void 0==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].query=!0,void 0===this.metrics[this.line].qelements&&(this.metrics[this.line].qelements=[]),this.classes.push("hidden-comment");break;case"{":this.pushMode(),this.mode="COMMENT_ATTRS",this.classes.push("hidden-comment");break;default:this.classes.push("comment")}};var css_color_names={aliceblue:!0,antiquewhite:!0,aqua:!0,aquamarine:!0,azure:!0,beige:!0,bisque:!0,black:!0,blanchedalmond:!0,blue:!0,blueviolet:!0,brown:!0,burlywood:!0,cadetblue:!0,chartreuse:!0,chocolate:!0,coral:!0,cornflowerblue:!0,cornsilk:!0,crimson:!0,cyan:!0,darkblue:!0,darkcyan:!0,darkgoldenrod:!0,darkgray:!0,darkgrey:!0,darkgreen:!0,darkkhaki:!0,darkmagenta:!0,darkolivegreen:!0,darkorange:!0,darkorchid:!0,darkred:!0,darksalmon:!0,darkseagreen:!0,darkslateblue:!0,darkslategray:!0,darkslategrey:!0,darkturquoise:!0,darkviolet:!0,deeppink:!0,deepskyblue:!0,dimgray:!0,dimgrey:!0,dodgerblue:!0,firebrick:!0,floralwhite:!0,forestgreen:!0,fuchsia:!0,gainsboro:!0,ghostwhite:!0,gold:!0,goldenrod:!0,gray:!0,grey:!0,green:!0,greenyellow:!0,honeydew:!0,hotpink:!0,indianred:!0,indigo:!0,ivory:!0,khaki:!0,lavender:!0,lavenderblush:!0,lawngreen:!0,lemonchiffon:!0,lightblue:!0,lightcoral:!0,lightcyan:!0,lightgoldenrodyellow:!0,lightgray:!0,lightgrey:!0,lightgreen:!0,lightpink:!0,lightsalmon:!0,lightseagreen:!0,lightskyblue:!0,lightslategray:!0,lightslategrey:!0,lightsteelblue:!0,lightyellow:!0,lime:!0,limegreen:!0,linen:!0,magenta:!0,maroon:!0,mediumaquamarine:!0,mediumblue:!0,mediumorchid:!0,mediumpurple:!0,mediumseagreen:!0,mediumslateblue:!0,mediumspringgreen:!0,mediumturquoise:!0,mediumvioletred:!0,midnightblue:!0,mintcream:!0,mistyrose:!0,moccasin:!0,navajowhite:!0,navy:!0,oldlace:!0,olive:!0,olivedrab:!0,orange:!0,orangered:!0,orchid:!0,palegoldenrod:!0,palegreen:!0,paleturquoise:!0,palevioletred:!0,papayawhip:!0,peachpuff:!0,peru:!0,pink:!0,plum:!0,powderblue:!0,purple:!0,red:!0,rosybrown:!0,royalblue:!0,saddlebrown:!0,salmon:!0,sandybrown:!0,seagreen:!0,seashell:!0,sienna:!0,silver:!0,skyblue:!0,slateblue:!0,slategray:!0,slategrey:!0,snow:!0,springgreen:!0,steelblue:!0,tan:!0,teal:!0,thistle:!0,tomato:!0,turquoise:!0,violet:!0,wheat:!0,white:!0,whitesmoke:!0,yellow:!0,yellowgreen:!0};EdenUI.Highlight.prototype.applyAttribute=function(e,t,i){if(e.style)switch(t){case"color":case"font-size":case"font-family":case"font-weight":case"font-style":case"text-decoration":case"margin-left":case"margin-right":e.style[t]=i;break;case"editable":"true"!=i&&"false"!=i||(e.contentEditable=i);break;case"script":e.setAttribute("data-jseden",i),e.contentEditable=!1,e.style.cursor="pointer",changeClass(e,"executable",!0);break;case"width":case"height":e.setAttribute(t,i);break;case"background":e.style.background=i;break;case"title":e.title=i;break;case"cursor":e.style.cursor=i;break;case"class":this.applyClasses(e,i.split(" "));break;default:e.style[t]=i}},EdenUI.Highlight.prototype.parseAttrs=function(e,t){t||(t=this.lineelement.lastChild),(t=t?t.previousSibling:this.lineelement)||(t=this.lineelement);var i;if("."==(e=e.trim()).charAt(0)){var n=e.substring(1).match(/[a-z0-9\-]+/);if(null===n)return;i=n[0],e=e.substring(i.length+1).trim(),void 0===this.styleExtensions[i]&&(this.styleExtensions[i]={})}for(;e&&e.length>0;){var s,o=e.indexOf("=");-1==o?(s=e,e=""):(s=e.substring(0,o),e=e.substring(o+1));var a="";if("?"==e.charAt(0));else if('"'==e.charAt(0)||"'"==e.charAt(0)){o=-1;for(var r=e.charAt(0),d=1;d<e.length;d++){if(e.charAt(d)==r){o=d;break}"\\"==e.charAt(d)&&d++}if(-1==o)break;a=e.substring(1,o),e=e.substring(o+1)}else if(e.length>0){o=-1;for(d=0;d<e.length;d++)if(" "==e.charAt(d)){o=d;break}-1==o?(a=e,e=""):(a=e.substring(0,o),e=e.substring(o+1))}switch(e=e.trim(),s){case"colour":s="color";break;case"size":s="font-size";break;case"font":case"family":s="font-family";break;case"decoration":s="text-decoration";break;case"left":s="margin-left";break;case"right":s="margin-right";break;case"underline":s="text-decoration",a="underline";break;case"highlight":s="background",a="yellow";break;case"bold":s="font-weight",a="bold";break;case"italic":s="font-style",a="italic"}css_color_names[s]||"#"==s.charAt(0)?(a=s,s="color"):""==s&&(s="class"),i?this.styleExtensions[i][s]=a:this.applyAttribute(t,s,a)}return t},EdenUI.Highlight.prototype.COMMENT_ATTRS=function(){for(var e=this.stream.peekLine(),t=0,i=-1,n=0;n<e.length;n++)if("{"==e.charAt(n))t++;else if("}"==e.charAt(n)&&--t<0){i=n;break}if(-1==i)this.classes.push("hidden-comment"),this.popMode();else{var s=e.substring(0,i),o=this.tokentext+s;if(this.tokentext+=s+"}",this.stream.position+=i+1,this.classes.push("hidden-comment"),"?"==o.charAt(0)){void 0==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].squery=!0;var a=this.parseQuery(o);a&&(a=a.join(" "),this.parseAttrs(a))}else this.parseAttrs(o);this.popMode()}},EdenUI.Highlight.prototype.parseQuery=function(e){for(var t=e.substring(2),i=0,n=-1,s=0;s<t.length;s++)if("("==t.charAt(s))i++;else if(")"==t.charAt(s)&&--i<0){n=s;break}if(-1!=n){var o=t.substring(0,n);return Eden.Selectors.query(o,"value")}},EdenUI.Highlight.prototype.COMMENT_QUERY=function(){if("["==this.token){for(var e=this.stream.peekLine(),t=-1,i=0;i<e.length;i++)if("]"==e.charAt(i)){t=i;break}if(-1==t)return void this.classes.push("hidden-comment");this.classes.push("hidden-comment"),this.cacheddata=e.substring(0,t),console.log("Q RES TYPE",this.cacheddata),this.stream.position+=t+1,this.tokentext+=this.cacheddata+"]"}else if("("==this.token){for(var e=this.stream.peekLine(),n=0,t=-1,i=0;i<e.length;i++)if("("==e.charAt(i))n++;else if(")"==e.charAt(i)&&--n<0){t=i;break}if(-1==t)this.popMode(),this.classes.push("hidden-comment");else{var s=e.substring(0,t);this.tokentext+=s+")",this.stream.position+=s.length+1,this.popMode(),this.classes.push("hidden-comment");var o=document.createElement("span");this.applyClasses(o,["comment-query"]),this.lineelement.appendChild(o);var a=Eden.Selectors.query(s,this.cacheddata?this.cacheddata:"value");a=1==a.length?a[0]:a.length>1?a.join(", "):"",o.setAttribute("data-result",a),this.cacheddata&&o.setAttribute("data-attribs",this.cacheddata),o.setAttribute("data-query",s),this.metrics[this.line].qelements.push(o)}}else this.popMode(),this.classes.push("hidden-comment")},EdenUI.Highlight.prototype.COMMENT_LINK=function(){if("]"!=this.token)this.COMMENT();else if(this.classes.push("hidden-comment"),40==this.stream.peek()){var e=this.lineelement,t=e.parentNode,i=document.createElement("a");i.setAttribute("target","_blank"),i.contentEditable=!1,t&&(t.removeChild(e),i.appendChild(e),t.appendChild(i),this.lineelement=i),this.mode="COMMENT_LINK_END"}else this.popMode(),this.popLine()},EdenUI.Highlight.prototype.COMMENT_LINK_END=function(){console.log("LINKEND",this.token);var e=this.stream.peekLine();if("("==this.token){var t=e.indexOf(")");if(-1==t)this.classes.push("hidden-comment"),this.popMode(),this.popLine();else{var i=e.substring(0,t);this.tokentext+=i+")",this.stream.position+=t+1,this.classes.push("hidden-comment"),this.popMode(),i.startsWith("http://")?this.lineelement.setAttribute("href",i):this.lineelement.setAttribute("href","javascript: Eden.Selectors.goto('"+i+"');"),this.popLine()}}},EdenUI.Highlight.prototype.COMMENT_IMAGE=function(){var e=this.stream.peekLine(),t=e.indexOf("]");if(-1==t)this.classes.push("comment"),this.mode="COMMENT";else{var i=e.substring(0,t);console.log("IMG",this.tokentext),this.classes.push("comment"),this.mode="COMMENT_IMAGE_END",this.pushLine();var n=document.createElement("img");n.title=i,n.style.verticalAlign="top",this.lineelement.appendChild(n),this.lineelement=n}},EdenUI.Highlight.prototype.COMMENT_BUTTON=function(){this.pushLine();var e=document.createElement("button");this.lineelement.appendChild(e),this.lineelement=e,e.contentEditable=!1,this.mode="COMMENT_BUTTON_CONTENT"},EdenUI.Highlight.prototype.COMMENT_BUTTON_CONTENT=function(){"]"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_IMAGE_END=function(){var e=this.stream.peekLine(),t=e.indexOf(")");if(-1==t)this.classes.push("hidden-comment"),this.mode="COMMENT",this.popLine();else{var i=e.substring(0,t);this.tokentext+=i+")",this.stream.position+=t+1,this.classes.push("hidden-comment"),this.mode="COMMENT",this.lineelement.setAttribute("src",i.substring(1)),this.popLine()}},EdenUI.Highlight.prototype.COMMENT_ESCAPE=function(){this.popMode(),this.classes.push("comment")},EdenUI.Highlight.prototype.validHTMLTags={button:!0,span:!0,a:!0,img:!0,input:!0,table:!0,textarea:!0},EdenUI.Highlight.prototype.COMMENT_HTML=function(){var e=this.tokentext;if(!EdenUI.Highlight.prototype.validHTMLTags[e])return this.mode="COMMENT",void this.COMMENT();for(var t=this.stream.peekLine(),i=-1,n=!1,s=0,o=0;o<t.length;o++)if(t.charCodeAt(o)==s)n=!n,s=0;else if(0!=s||34!=t.charCodeAt(o)&&39!=t.charCodeAt(o)){if(n&&"\\"==t.charAt(o))o++;else if(!n&&">"==t.charAt(o)){i=o;break}}else n=!n,s=t.charCodeAt(o);if(i>=0){var a="<"+e+t.substring(0,i+1);this.tokentext=a.substring(1),this.cacheddata={opentag:a,tagname:e},this.classes.push("hidden-comment"),this.mode="COMMENT_HTML_START",this.stream.position+=i+1}else this.classes.push("hidden-comment"),this.tokentext+=t.substring(0,t.length-1),this.stream.position+=t.length-1,this.mode="COMMENT"},EdenUI.Highlight.prototype.COMMENT_HTML_CONTENT=function(){if("<"!=this.token)this.COMMENT();else if(this.cacheddata){var e=this.stream.peekLine(),t="/"+this.cacheddata.tagname+">",i=e.indexOf(t);-1==i?this.classes.push("hidden-comment"):(this.cacheddata&&this.popLine(),this.tokentext+=t,this.stream.position+=i+t.length,this.classes.push("hidden-comment")),this.mode="COMMENT"}else this.mode="COMMENT"},EdenUI.Highlight.prototype.COMMENT_HTML_START=function(){if("<"!=this.token){var e=this.cacheddata.opentag+n;this.mode="COMMENT_HTML_CONTENT",this.pushLine();var t=$(e).get(0);"button"!=this.cacheddata.tagname&&"a"!=this.cacheddata.tagname||(t.contentEditable=!1),this.lineelement.appendChild(t),this.lineelement=t,this.COMMENT()}else{var i=this.stream.peekLine(),n="/"+this.cacheddata.tagname+">",s=i.indexOf(n);-1==s?this.classes.push("hidden-comment"):(this.cacheddata&&this.popLine(),this.tokentext+=n,this.stream.position+=s+n.length,this.classes.push("hidden-comment")),this.mode="COMMENT"}},EdenUI.Highlight.prototype.COMMENT_CODE=function(){"`"==this.token?(this.classes.push("hidden-comment"),this.popMode()):(this.classes.push("script"),this.START())},EdenUI.Highlight.prototype.COMMENT_ICON=function(){if("OBSERVABLE"==this.token){if("-"==this.stream.code.charAt(this.stream.position)){var e=this.stream.peekLine(),t=e.indexOf(":");if(-1==t)return this.classes.push("comment"),void this.popMode();var i=e.substring(0,t);this.tokentext+=i,this.stream.position+=i.length}var n=document.createElement("span");n.className="eden-comment-icon fa fa-"+this.tokentext,this.lineelement.appendChild(n),this.classes.push("hidden-comment")}else":"==this.token&&(this.classes.push("hidden-comment"),this.popMode())},EdenUI.Highlight.prototype.COMMENT_EMPH=function(){if("*"==this.token)this.mode="COMMENT_BOLD",this.classes.push("hidden-comment");else{var e=document.createElement("span");this.applyClasses(e,["comment-emph"]),this.lineelement.appendChild(e),this.pushLine(),this.lineelement=e,this.mode="COMMENT_ITALIC",this.COMMENT()}},EdenUI.Highlight.prototype.COMMENT_ITALIC=function(){"*"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_BOLD=function(){if("*"==this.token)this.classes.push("hidden-comment"),this.popLine(),this.mode="COMMENT_BOLD_END";else{var e=document.createElement("span");this.applyClasses(e,["comment-bold"]),this.lineelement.appendChild(e),this.pushLine(),this.lineelement=e,this.mode="COMMENT_BOLD_END",this.COMMENT()}},EdenUI.Highlight.prototype.COMMENT_BOLD_END=function(){"*"==this.token?("*"==this.stream.code.charAt(this.stream.position)&&(this.classes.push("hidden-comment"),this.stream.position++,this.tokentext+="*"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_TAG=function(){this.mode="END_COMMENT_TAG"},EdenUI.Highlight.prototype.END_COMMENT_TAG=function(){this.popLine(),this.mode="COMMENT",this.COMMENT()},EdenUI.Highlight.prototype.DOXY_COMMENT=function(){this.BLOCK_COMMENT()},EdenUI.ContextMenu=function(e){this.element=$('<div class="eden-contextmenu"></div>'),this.origin=e,this.target=void 0,this.items=[],$(document.body).append(this.element);var t=this;this.element.on("mousedown",".eden-contextmenu-item",function(e){var i=parseInt(e.currentTarget.getAttribute("data-index"));t.items[i].action&&t.items[i].action(t.target)}),this.origin.oncontextmenu=function(e){t.target=e.target,"SPAN"==t.target.nodeName&&(t.target=t.target.parentNode);var i=document.body.scrollLeft+e.clientX;i+150>=screen.width&&(i-=i+150-screen.width),t.element.css("top",document.body.scrollTop+e.clientY+10+"px"),t.element.css("left",i+"px");for(var n=0;n<t.items.length;n++){var s;s="function"==typeof t.items[n].status?t.items[n].status(t.target):t.items[n].status,changeClass(t.items[n].element,"disabled",!s)}t.element.slideDown(100),e.preventDefault()},document.addEventListener("mousedown",function(){t.element.hide()},!0)},EdenUI.ContextMenu.prototype.addItem=function(e,t,i,n){var s=$('<div class="eden-contextmenu-item"><span class="eden-contextmenu-icon">'+e+"</span><span>"+t+"</span></div>");s.get(0).setAttribute("data-index",""+this.items.length),this.element.append(s),this.items.push({status:i,action:n,element:s.get(0)})},EdenUI.ContextMenu.prototype.addSeparator=function(){var e=$('<div class="eden-contextmenu-sep"></div>');this.element.append(e)},EdenUI.ButtonBar=function(e){this.container=e,this.bar=$('<div class="control-bar noselect"><div class="buttonsDiv"></div></div>'),this.buttons={},this.container.appendChild(this.bar.get(0))},EdenUI.ButtonBar.prototype.addButton=function(e,t,i,n){var s=$('<button class="control-button control-enabled '+e+'" title="'+i+'">'+t+"</button>");this.bar.find(".buttonsDiv").append(s),s.get(0).onclick=n,this.buttons[e]=s},EdenUI.ButtonBar.prototype.enableButton=function(e){this.buttons[e]&&this.buttons[e].addClass("control-enabled")},EdenUI.ButtonBar.prototype.disableButton=function(e){this.buttons[e]&&this.buttons[e].removeClass("control-enabled")},EdenUI.Tabs=function(e){this.tabs=e,this.scrollix=0,this.maxtabs=3},EdenUI.Tabs.prototype.build=function(e,t){for(;this.tabs.firstChild;)this.tabs.removeChild(this.tabs.firstChild);var i=document.createElement("div");i.className="agent-tableft noselect",this.tabs.appendChild(i);var n=document.createElement("div");if(n.className="agent-tab-container",this.tabs.appendChild(n),e&&e instanceof Array){var s=-1;t&&(s=e.indexOf(t)),s>this.scrollix+(this.maxtabs-1)&&(this.scrollix=s-(this.maxtabs-1)),s<this.scrollix&&(this.scrollix=s);for(var o=0;o<e.length;o++){var a=e[o];Eden.Agent.agents[e[o]]&&(a=Eden.Agent.agents[e[o]].title),this.scrollix<=o&&this.add(n,e[o],a,t&&e[o]==t,o)}}var r=document.createElement("div");r.className="agent-newtab noselect",r.style.left=160*e.length+20+"px",n.appendChild(r);var d=document.createElement("div");d.className="agent-tabright noselect",this.tabs.appendChild(d)},EdenUI.Tabs.prototype.add=function(e,t,i,n,s){var o=document.createElement("div");o.style.left=160*s+"px";var a="agent-tab noselect";a+=n?" agent-tab-current":" agent-tab-notcurrent";var r=t.split("/").pop();r.length>18&&(r="..."+r.slice(-15));var d;d=Eden.Agent.agents[t]?Eden.Agent.agents[t].hasErrors()?"tab-icon errored":Eden.Agent.agents[t].executed?"tab-icon executed":"tab-icon":"tab-icon noagent",o.className=a,o.innerHTML="<span class='"+d+"'>&#xf007;</span>"+r,o.draggable=!0,o.setAttribute("data-name",t),e.appendChild(o)},EdenUI.MenuBar=function(){function e(){$(".menubar-menu").hide(),b=!1,$("#menubar-mainitem-views").children().css("display","")}function t(e){$("#menubar-mainitem-"+e).show(),E=e,b=!0,"sharebox"==e&&m.sharebox.show()}function i(){var e=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(edenUI.activeDialogs).length&&e.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function n(t){e();var i=edenUI.eden.root,n=i.lookup("mouseFollow").value(),s=i.lookup("views_number_created"),o=s.value()+1;s.assign(o,i.scope,EdenSymbol.hciAgent,!0);var a=this.view,r=a.toLowerCase()+o;n?edenUI.eden.execute('createView("'+r+'", "'+a+'");'):edenUI.createView(r,a),m.updateViewsMenu()}function s(t){var n=this.parentNode.viewname;edenUI.viewInstances[n].confirmClose&&e(),edenUI.destroyView(n),i()}function o(e){var t=e.currentTarget.children[0],i=this.parentNode.viewname;edenUI.viewInstances[i].pinned?(edenUI.unpinView(i),t.src=u):(edenUI.pinView(i),t.src=p)}function a(e){for(var t=$("<div class='menubar-item'></div>"),i=0;i<e.length;++i)t.append(e[i]);return t}function r(e,t){return $('<div class="'+e+' menubar-item-clickable">'+t+"</div>")}function d(e){return $("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+e+"</div></div>")}function l(t){return{mouseover:function(e){edenUI.highlightView(t,!0)},mouseout:function(e){edenUI.stopHighlightingView(t,!0,!1)},click:function(i){edenUI.stopHighlightingView(t,!0,!0),e()}}}function c(e){return e&&"false"!=e?'checked="checked"':""}function h(e,t,i,n){var s=edenUI.getOptionValue(e);null===s&&(s=i);var o=r("menubar-item-input",'<input id="menu-'+e+'" type="checkbox"'+c(s)+" />"),d=o.get(0).children[0],l=a([o,r("menubar-item-label",t)]);l.click(function(t){t.target!=d&&(d.checked=!d.checked),edenUI.setOptionValue(e,d.checked)}),edenUI.listenTo("optionChange",void 0,function(t,i){if(t==e){var s="true"===i;d.checked=s,n&&n(e,s)}}),l.appendTo(y)}var p="images/pin.png",u="images/pin-greyed.png",m=this;this.itemViews={};var g=mobilecheck(),v=$('<div id="menubar-obscurer" class="login-subdialog modal" style="display: block;"></div>');v.html(`<div class="modal-content" style="width: 550px; height: 400px;"><div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf090;</span>${Language.ui.menu_bar.signin}</div><iframe frameborder="0" name="logintarget" width="540px" height="300px" class="menubar-login-iframe"></iframe><button class="jseden button-cancel">${Language.ui.menu_bar.cancel}</button></div>`),v.hide(),Eden.AST&&eden.execute2("views_number_created = 0;",EdenSymbol.defaultAgent),this.element=g?$('<div id="menubar-main" class="no-print">\t\t\t<div class="menubar-buttons">\t\t\t\t<div class="menubar-button enabled main share" data-obs="sharebox" title="Save or share" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div>\t\t\t\t<div class="menubar-button enabled main notifications" data-obs="notifications" title="Notifications">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div>\t\t\t\t<div class="menubar-button enabled main more" data-obs="more" title="More Options">&#xf0c9;</div></div>\t\t\t<div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="Search..." spellcheck="false"></input>\t\t\t\t<div id="menubar-searchresults"></div>\t\t\t</div></div>'):$(`<div id="menubar-main" class="no-print">\n\t\t\t<a id="eden-logo" title="${Language.ui.tooltips.home_logo}" href="${window.location.pathname}" target="_blank" style="display: block"></a>\n\t\t\t<div class="jseden-title" title="${Language.ui.tooltips.rename}"></div>\n\t\t\t<div id="menubar-login"><span class="icon">&#xf05e;</span>${Language.ui.menu_bar.notconnected}</div>\n\t\t\t<div class="menubar-buttons">\n\t\t\t\t<div class="menubar-button enabled main share" data-obs="sharebox" title="${Language.ui.tooltips.save}" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main create" data-obs="views" title="${Language.ui.tooltips.create}" style="display: none;">&#xf067;<div id="menubar-mainitem-views" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main existing" data-obs="existing" title="${Language.ui.tooltips.existing}" style="display: none;">&#xf2d2;<div id="menubar-mainitem-existing" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main settings" data-obs="options" title="${Language.ui.tooltips.options}" style="display: none;">&#xf013;<div id="menubar-mainitem-options" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main help" data-obs="help" title="${Language.ui.tooltips.help}">&#xf128;<div id="menubar-mainitem-help" class="menubar-menu">\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="?load=54">Getting Started...</a></div>\t\t\t\t\t\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="resources/doc/cheat.pdf">Cheat Sheet (PDF)</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://www.youtube.com/channel/UCQUAv0AU1FF2EN0qwOOZCag">Tutorial Videos (YouTube)</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://github.com/EMGroup/js-eden/wiki/Eden-Functions">Library Reference</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://github.com/EMGroup/js-eden/wiki/FAQ">FAQ</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="http://construit.org">About Construit</a></div>\n\t\t\t\t</div></div>\n\t\t\t\t<div class="menubar-button enabled main notifications" data-obs="notifications" title="${Language.ui.tooltips.notifications}">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main maker" data-obs="maker" title="${Language.ui.tooltips.maker}" style="display: none;">&#xf0ad;</div></div>\n\t\t\t<div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="${Language.ui.menu_bar.search}" spellcheck="false"></input>\n\t\t\t\t<div id="menubar-searchresults"></div>\n\t\t\t</div></div>`),$(document.body).append(this.element);var f=this.element.find("#menubar-login");g||new EdenUI.ContextMenu(f.get(0)).addItem("&#xf08b;","Log out",function(){return Eden.DB.isLoggedIn()},function(){Eden.DB.logOut(function(){$("#menubar-login").html('<span class="icon">&#xf090;</span>Sign-in')})}),edenUI.listenTo("loadPlugin",this,function(e,t){g||this.updateViewsMenu()}),edenUI.listenTo("createView",this,function(e,t){g||this.updateViewsMenu()}),edenUI.listenTo("destroyView",this,function(e){g||($(this.itemViews[e]).remove(),delete this.itemViews[e],i())}),Eden.DB.listenTo("connected",this,function(e){g||$("#menubar-login").html(`<span class="icon">&#xf090;</span>${Language.ui.menu_bar.signin}`)}),Eden.DB.listenTo("disconnected",this,function(){g||$("#menubar-login").html(`<span class="icon">&#xf05e;</span>${Language.ui.menu_bar.notconnected}`)}),Eden.DB.listenTo("login",this,function(e){g||e&&(Eden.DB.log("login"),setTimeout(function(){$("#menubar-obscurer").remove()},1e3),$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/#" target="_blank"><span class="icon">&#xf2be;</span>'+e+"</a>"))});m=this;g||$("#menubar-login").click(function(){m.showLogin()}),this.showLogin=function(){Eden.DB.isConnected()&&!Eden.DB.isLoggedIn()?(v.show(),$(document.body).append(v),v.find("iframe").attr("src",Eden.DB.remoteURL+"/login"),v.on("click",".button-cancel",function(){v.remove()})):Eden.DB.isConnected()&&Eden.DB.isLoggedIn()},Eden.AST&&(this.sharebox=new EdenUI.Sharebox(this.element.find("#menubar-mainitem-sharebox")),this.element.on("click",".menubar-button.share",function(e){e.currentTarget===e.target&&m.sharebox.update()}),this.searchbox=new EdenUI.SearchBox(this.element.find("#menubar-searchresults")),this.element.on("keyup",".search",function(e){m.searchbox.updateSearch(e.currentTarget.value)}),this.element.on("focus",".search",function(e){m.searchbox.updateSearch(e.currentTarget.value)}));var b=!1,E=void 0;$(document.body).on("mousedown",function(){e(),m.searchbox&&m.searchbox.element.hide()}),this.element.on("mousedown",".menubar-search-outer",function(e){e.stopPropagation()}),this.element.on("mousedown",".menubar-button.main",function(i){var n=i.currentTarget.getAttribute("data-obs");b&&i.target===this?n==E?e():(e(),t(n)):t(n),m.searchbox&&m.searchbox.element.hide(),i.stopPropagation()}),this.element.on("mouseenter",".menubar-button.main",function(e){}),this.updateViewsMenu=function(){var e=$("#menubar-mainitem-views"),t=$("#menubar-mainitem-existing");e.html("");var c=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),h=c[0],g=$('<div class="menubar-item-fullwidth"></div>');g.append(c);var v=$("<div class='menubar-item-search'></div>");v.append(g),h.search=function(){var t,i=h.value,n=new RegExp("(^|\\s)"+i,"i"),s=!1;e.children().each(function(e,o){if(!o.classList.contains("menubar-item-search")){var a=o.children[0],r=a.innerHTML;a.classList.contains("menubar-item-separator")?(i.length>1&&(s=n.test(r)),t=o,o.style.display=s?"":"none"):s?o.style.display="":n.test(r)?(o.style.display="",t.style.display=""):o.style.display="none"}})},c.on("input",h.search);var f,b,E,y,x,k,C=[];for(b in edenUI.views){var T=edenUI.views[b],w=T.title,I=T.category.getLabel(),N=T.category.getMenuPriority(),S=T.menuPriority;(E=a([y=r("menubar-item-fullwidth menubar-view",w)]))[0].view=b,E.click(n),C.push({title:w,viewEntry:E,categoryLabel:I,categoryPriority:N,itemPriority:S})}C=C.sort(function(e,t){if(e.categoryPriority!=t.categoryPriority)return e.categoryPriority-t.categoryPriority;if(void 0!==e.itemPriority){if(void 0===t.itemPriority)return-1;if(e.itemPriority!=t.itemPriority)return e.itemPriority-t.itemPriority}else if(void 0!==t.itemPriority)return 1;return e.title>t.title?1:e.title<t.title?-1:0});for(var M,_=0;_<C.length;++_){var L=C[_],O=L.categoryLabel;M!=O&&(d(O).appendTo(e),M=O),L.viewEntry.appendTo(e)}e.append(v),t.html(""),m.itemViews={},i();for(f in edenUI.activeDialogs){var U=l(f);(y=r("menubar-item-label",(w=edenUI.eden.root.lookup("view_"+f+"_title").value())+' <span class="menubar-view-name">['+f+"]</span>")).click(U.click);(x=r("menubar-item-pin",'<img src="'+(edenUI.viewInstances[f].pinned?p:u)+'" width="18" height="18" class="menubar-item-pin-icon"/>')).click(o),(k=r("menubar-item-close",'<div class="menubar-item-close-icon">X</div>')).click(s),(E=a([y,x,k])).bind("mouseover",U.mouseover),E.bind("mouseout",U.mouseout),E[0].viewname=f,E.appendTo(t),m.itemViews[f]=E[0]}},this.updateViewsMenu();var y=$("#menubar-mainitem-options");h("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(e,t){t?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),h("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),h("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),h("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(e,t){var i;i=t?"collapse":"maximize",$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",i)})}),h("developer",Language.ui.menu_bar.opt_debug,!1,function(t,i){var n;n=i?"/index-dev.html":"/index.html";var s=document.location.pathname;(n=s.slice(0,s.lastIndexOf("/"))+n)!=document.location.pathname?(e(),edenUI.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(e){if(0==e)window.onbeforeunload=void 0,document.location.pathname=n;else if(1==e)root.lookup("debug").mutate(root.scope,function(e){e.cache.value.jsExceptions=i},EdenSymbol.hciAgent);else{var t=document.getElementById("menu-developer");t.checked=!t.checked,edenUI.setOptionValue("developer",t.checked)}})):root.lookup("debug").mutate(root.scope,function(e){e.cache.value.jsExceptions=i},EdenSymbol.hciAgent)}),this.element.on("keyup",".jseden-title",function(e){try{window.localStorage&&window.localStorage.setItem("title",e.currentTarget.textContent)}catch(e){}}),eden.root.lookup("jseden_project_title").addJSObserver("menubar",function(e,t){if(!g){if(e.origin&&e.origin!==EdenSymbol.hciAgent){var i=$(".jseden-title").get(0);i.contentEditable=!0,i.textContent=t,document.title=t}try{window.localStorage&&window.localStorage.setItem("title",t)}catch(e){}}}),eden.root.lookup("jseden_maker").addJSObserver("menubar",function(e,t){t?m.element.find(".maker").addClass("active"):m.element.find(".maker").removeClass("active")}),eden.root.lookup("jseden_menu_showsearch").addJSObserver("menubar",function(e,t){t?(m.element.find(".menusearch").show(),g&&m.element.find("#eden-logo").hide()):(m.element.find(".menusearch").hide(),g&&m.element.find("#eden-logo").show())}),eden.root.lookup("jseden_explorer_enabled").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.maker").show():m.element.find(".menubar-button.maker").hide()}),eden.root.lookup("jseden_menu_showshare").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.share").show():m.element.find(".menubar-button.share").hide()}),eden.root.lookup("jseden_menu_showcreate").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.create").show():m.element.find(".menubar-button.create").hide()}),eden.root.lookup("jseden_menu_showexisting").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.existing").show():m.element.find(".menubar-button.existing").hide()}),eden.root.lookup("jseden_menu_showsettings").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.settings").show():m.element.find(".menubar-button.settings").hide()}),eden.root.lookup("jseden_menu_showhelp").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.help").show():m.element.find(".menubar-button.help").hide()}),eden.root.lookup("jseden_menu_shownotifications").addJSObserver("menubar",function(e,t){t?m.element.find(".menubar-button.notifications").show():m.element.find(".menubar-button.notifications").hide()}),eden.root.lookup("jseden_project_subtitle").addJSObserver("menubar",function(e,t){}),this.notifications=new EdenUI.Notifications(this.element.find("#menubar-mainitem-notifications"),this.element.find(".menubar-notification-jewel")),this.element.on("click",".notifications",function(e){m.notifications.clearCount()}),this.element.on("click",".maker",function(e){var t=eden.root.lookup("jseden_maker");if(!t.eden_definition){var i=t.value();void 0===i&&(i=!1),t.assign(!i,eden.root.scope,EdenSymbol.localJSAgent)}}),this.element.on("keyup",".jseden-title",function(e){var t=eden.root.lookup("jseden_project_title");t.definition||t.assign(e.currentTarget.textContent,eden.root.scope,EdenSymbol.hciAgent)})},EdenUI.MenuBar.prototype.hide=function(){this.element.hide()},EdenUI.MenuBar.prototype.show=function(){this.element.show()},EdenUI.MenuBar.reset=function(){$(".jseden-title").html("CONSTRUIT")},EdenUI.MenuBar.saveTitle=function(e){eden.root.lookup("jseden_project_title").assign(e,eden.root.scope,EdenSymbol.jsAgent)},EdenUI.Dialogs={},EdenUI.Dialogs.MergeError=function(e,t,i){var n=new diff_match_patch,s=n.diff_main(e,t);n.diff_cleanupSemantic(s);var o=n.diff_prettyHtml(s);$('<div title="Import Merge Conflict">'+o+"</div>").dialog({resizable:!0,height:"auto",width:600,modal:!0,buttons:{"Use Mine":function(){i&&i("old"),$(this).dialog("close")},"Use New":function(){i&&i("new"),$(this).dialog("close")},Merge:function(){i&&i("merge"),$(this).dialog("close")}}})},EdenUI.Notifications=function(e,t){function i(e,t){if(t){var i=("runtime"==t.type?"Runtime error":"Syntax error")+" in "+e.name+":"+(-1!=t.line?t.line:"")+" -> "+t.messageText(),s="<a href=\"javascript:edenUI.gotoCode('"+e.name+"',"+t.line+');">'+e.name+":"+(-1!=t.line?t.line+1:"")+"</a> "+t.messageText();if(!e.owned||"syntax"!=t.type){console.error(i);var o=$('<pre class="error-item">'+s+"</pre>\n\n");o.on("click",function(){var e="";if(!t.statement||"definition"!=t.statement.type&&"assignment"!=t.statement.type||(e+="    <b>Symbol:</b> "+t.statement.lvalue.name+"\n"),t.lastsymbol&&(e+="    <b>Related Symbol:</b> "+t.lastsymbol+"\n"),String(t.extra).search("SyntaxError")>=0)e+="    <b>JavaScript:</b> "+t.javascriptSource()+"\n",o.html(s+"\n"+e);else if(e+="    <b>Source:</b> <div class='error-source'</div>\n",o.html(s+"\n"+e),t.statement){var i=new Eden.AST(t.edenSource(),void 0,Symbol.jsAgent);new EdenUI.Highlight(o.find(".error-source").get(0)).highlight(i,-1,-1)}}),n.notification("error",o)}}}var n=this;this.notificationCount=0,this.notificationCountElement=t,this.notificationCountElement.hide(),this.notificationPanel=e,this.notificationPanel.html('<button class="control-button close-button control-enabled">&#xf00d;</button><button class="control-button clear-button control-enabled">&#xf05e;</button><div id="errors-dialog"></div>'),this.notificationPanel.on("click",".close-button",function(){n.notificationPanel.hide()}).on("click",".clear-button",function(){n.notificationPanel.find("#errors-dialog").html("")}),this.notificationPanel.hide(),this.notificationContent=this.notificationPanel.find("#errors-dialog"),Eden.Peer.listenTo("user",void 0,function(e,t){n.notification("net",$('<div class="notification-content">User \'<a href="javascript:eden.peer.showConnection(\''+e+"');\">"+t+"</a>' connected to you.<br/><a href=\"javascript: eden.peer.requestShare('"+e+"');\">Watch</a> <a href=\"javascript: eden.peer.requestObserve('"+e+"');\">Broadcast</a> <a href=\"javascript: eden.peer.requestCollaborate('"+e+"');\">Collaborate</a></div>"))}),Eden.Peer.listenTo("share",void 0,function(e,t){n.notification("net",$('<div class="notification-content">Your model is being shared...</div>'))}),Eden.Peer.listenTo("disconnect",void 0,function(e,t){t?n.notification("net",$('<div class="notification-content">User \''+t+"' disconnected.</div>")):n.notification("net",$('<div class="notification-content">P2P User disconnected.</div>'))}),Eden.Peer.listenTo("error",void 0,function(e){n.notification("error",$('<div class="notification-content">P2P: '+e+"</div>"))}),Eden.Fragment&&(Eden.Fragment.listenTo("error",void 0,i),eden.listenTo("error",void 0,i),Eden.Fragment.listenTo("warning",void 0,function(e,t){if(t){t.type,e.name,-1!=t.line&&t.line,t.messageText();var i="<a href=\"javascript:edenUI.gotoCode('"+e.name+"',"+t.line+');">'+e.name+":"+(-1!=t.line?t.line+1:"")+"</a> "+t.messageText();if(!e.owned||"syntax"!=t.type){var s=$('<pre class="error-item">'+i+"</pre>\n\n");s.on("click",function(){var e="";if(!t.statement||"definition"!=t.statement.type&&"assignment"!=t.statement.type||(e+="    <b>Symbol:</b> "+t.statement.lvalue.name+"\n"),t.lastsymbol&&(e+="    <b>Related Symbol:</b> "+t.lastsymbol+"\n"),String(t.extra).search("SyntaxError")>=0)e+="    <b>JavaScript:</b> "+t.javascriptSource()+"\n",s.html(i+"\n"+e);else if(e+="    <b>Source:</b> <div class='error-source'</div>\n",s.html(i+"\n"+e),t.statement){var n=new Eden.AST(t.edenSource(),void 0,Symbol.jsAgent);new EdenUI.Highlight(s.find(".error-source").get(0)).highlight(n,-1,-1)}}),n.notification("warning",s)}}})),Eden.DB.listenTo("disconnected",this,function(){n.notification("info",$('<div class="notification-content">Disconnected from project server</div>'))}),Eden.DB.listenTo("error",this,function(e){n.notification("error",$('<div class="notification-content">'+e+"</div>"))})},EdenUI.Notifications.prototype.notification=function(e,t){this.notificationCount++,this.notificationCountElement.html(this.notificationCount),this.notificationCountElement.show();var i;if("error"==e)(i=$('<div class="notification-item error"></div>')).append($('<div class="notification-icon"><span style="color: red;">&#xf06a;</span></div>'));else{var n,s="#777";switch(e){case"net":n="&#xf0c1;";break;case"comment":n="&#xf075;";break;case"log":n="&#xf120;";break;case"warning":n="&#xf071;",s="#f57900";break;case"info":default:n="&#xf129;",s="#29454B"}(i=$('<div class="notification-item"></div>')).append($('<div class="notification-icon"><span style="color: '+s+'">'+n+"</span></div>"))}"string"==typeof t?i.append($('<div class="notification-content">'+t+"</div>")):i.append(t),this.notificationContent.prepend(i),this.notificationContent.prop("scrollTop",0)},EdenUI.Notifications.prototype.clearCount=function(){this.notificationCountElement.hide(),this.notificationCount=0},EdenUI.Sharebox=function(e){var t=this;this.title=void 0,this.visible=!1,this.sharebox=e,this.sharebox.html('<div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf1e0;</span>Save and Share</div><div class="menubar-sharebox-content"><div id="projectoptions"></div><div id="projectuploadbox"></div></div>');var i=this.sharebox.find("#projectoptions");this.markdown=new EdenUI.Markdown(""),i.get(0).appendChild(this.markdown.contents),this.sharebox.on("change","#thumbfile",function(e){var i=t.sharebox.find("#projectthumb"),n=$("#thumbfile");i.html("<img></img>");var s=n.get(0).files[0],o=new FileReader;o.onload=function(e){var n=document.createElement("canvas");n.setAttribute("width","200"),n.setAttribute("height","112");var s=n.getContext("2d"),o=new Image;o.onload=function(){var e,a,r,d,l=o.width,c=o.height,h=l/c;h<200/112?(r=(200-(a=l*((e=112)/c)))/2,d=0):h>200/112?(r=0,d=(112-(e=c*((a=200)/l)))/2):(e=112,a=200,r=0,d=0),s.drawImage(o,r,d,a,e);var p=n.toDataURL("image/png");t.thumbdata=p,i.get(0).childNodes[0].src=p},o.src=e.target.result},o.readAsDataURL(s)}),this.sharebox.on("click",".local",function(e){Eden.DB.localSave(eden.project),t.sharebox.hide()}),this.sharebox.on("click",".upload",function(e){var i=t.title.textContent,n=t.markdown.intextarea.value,s=$("#listpublic").get(0).checked;"New Project"!=i?(t.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.log("save",{pid:eden.project.id}),eden.project.thumb=t.thumbdata,eden.project.setDescription(n),eden.project.save(s,function(e){if(e){var i="?load="+eden.project.id+"&vid="+eden.project.vid+"&r="+eden.project.readPassword;window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",i),t.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>');var n=document.createRange();n.selectNodeContents(t.sharebox.find(".projecturl").get(0));var s=window.getSelection();s.removeAllRanges(),s.addRange(n)}else t.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")})):t.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.')}),this.sharebox.on("click",".fork",function(e){var i=t.title.textContent,n=t.markdown.intextarea.value,s=$("#listpublic").get(0).checked;"New Project"!=i?(t.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.log("fork",{pid:eden.project.id}),eden.project.thumb=t.thumbdata,eden.project.id&&(eden.project.parentid=eden.project.id),eden.project.id=void 0,eden.project.vid=void 0,eden.project.setDescription(n),eden.project.save(s,function(e){if(e){var i="?load="+eden.project.id+"&vid="+eden.project.vid;window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",i),t.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>');var n=document.createRange();n.selectNodeContents(t.sharebox.find(".projecturl").get(0));var s=window.getSelection();s.removeAllRanges(),s.addRange(n)}else t.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")})):t.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.')})},EdenUI.Sharebox.prototype.show=function(){this.visible||this.update(),this.visible=!0},EdenUI.Sharebox.prototype.hide=function(){this.visible=!1},EdenUI.Sharebox.prototype.update=function(){var e=this;void 0===e.title&&(e.title=$(document).find(".jseden-title").get(0));var t=e.title?e.title.textContent:eden.root.lookup("jseden_project_title").value();Eden.DB.isLoggedIn()?(eden.project.authorid!=Eden.DB.userid&&-1!=eden.project.authorid?e.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox">List publically</input></div>Thumbnail: <input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'):e.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox">List publically</input></div><input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button upload">Save</button><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'),e.sharebox.find("#projectoptions").show()):(e.sharebox.find("#projectuploadbox").html('<div class="sharebox-save-buttons"><button class="sharebox-button local" title="Save in your browser for offline use">Local</button><span class="downloadurl"></span></div>'),e.sharebox.find("#projectoptions").hide());var i=this.sharebox.find("#projectthumb");this.thumbdata=void 0,this.thumbimg=$("<img></img>"),this.thumbimg.get(0).style.border="1px solid #aaa",this.thumbimg.get(0).style.marginRight="10px",i.append(this.thumbimg),eden.project.thumb?(e.thumbdata=eden.project.thumb,e.thumbimg.get(0).src=eden.project.thumb):e.thumbdata=void 0,void 0===eden.project.id&&(eden.project.tags=(eden.project.title.toLowerCase()+" "+(Eden.DB.isLoggedIn()?Eden.DB.username.toLowerCase():"")).split(" ")),e.markdown.setValue(eden.project.getDescription()),e.projectsource=eden.project.generate();var n="data:application/octet-stream,"+encodeURIComponent(e.projectsource);e.sharebox.find(".downloadurl").html('<a class="sharebox-button download" href="'+n+'" download="'+t+'.js-e">File</a>')},EdenUI.SearchBox=function(e){var t=this;this.element=e,e.on("click",".menubar-search-result",function(e){var i=e.currentTarget.getAttribute("data-id");i&&""!=i?t.updateSymbolDetails(e.currentTarget,i):script&&script}),e.on("click",".edit-result",function(e){}),e.on("click",".script-goto",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");t.element.hide(),Eden.Selectors.goto("@external "+i)}),e.on("click",".script-import",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");Eden.Selectors.query(i,void 0,{minimum:1,options:{external:!0,index:!0}},function(n){i&&""!=i&&(e.currentTarget.parentNode.parentNode.parentNode.setAttribute("data-imported","true"),t.updateSymbolDetails(e.currentTarget.parentNode.parentNode.parentNode,i))})})},EdenUI.SearchBox.prototype.updateSymbolDetails=function(e,t){console.log("Update details",t);e.getAttribute("data-imported");var i=e.getAttribute("data-remote");Eden.Selectors.query("@history "+t,"id,path,source,type,value,active,tags,rawcomment,historic",{minimum:1,options:{external:!0}},function(t){if(0!=t.length){(t=t[0])[0];var n=t[1],s=t[2],o=t[3],a=t[4],r=t[5],d=(t[6],t[7]),l=t[8];d&&(d=new Eden.AST.DoxyComment(d));var c=$(e).find(".doxy-search-details");null!==c&&0!=c.length||(c=$('<div class="doxy-search-details"></div>'),e.appendChild(c.get(0))),c=c.get(0),"assignment"!=o&&"definition"!=o||(symstr=s,""==e.firstChild.className?e.firstChild.innerHTML=EdenUI.Highlight.html(symstr):e.childNodes[1].innerHTML=EdenUI.Highlight.html(symstr));var h="";if(l?h="":"true"==i?(h+="<p>",h+='<button class="script-button script-goto">View</button></p>'):h='<p><button class="script-button script-goto">View</button>',d){var p=d.pretty();p&&p.length>0&&(h+=p)}r?(h+="<p>",h+="<span style='color: #666;'><b>Path:</b> "+n+"</span><br>",h+="<b>Current Value:</b> "+Eden.edenCodeForValue(a),h+="</p>"):(h+="<p>",h+="<span style='color: #666;'><b>Path:</b> "+n+"</span>",h+="</p>"),c.innerHTML=h}else console.log("No result")})},EdenUI.SearchBox.prototype.makeStatementResult=function(e){var t,i="",n="",s="";-1==e.executed&&(n=" historic");var o=e.getOrigin();"script"==e.type?(o&&o.remote?(s+=' data-remote="true"',e.indexed&&(s+=' data-imported="true"'),i='<span class="search-scriptres">&#xf08e;</span>'):i='<span class="search-scriptres">&#xf15c;</span>',t=e.doxyComment&&e.doxyComment.getProperty("title")?e.doxyComment.getProperty("title")[0]:e.name?"action "+e.name:e.getInnerSource()):"when"==e.type?(e.enabled&&(i='<span class="search-scriptres">&#xf00c;</span>'),t=e.prefix.trim()):(e.lvalue&&eden.root.symbols[e.lvalue.name]&&eden.root.symbols[e.lvalue.name].origin&&eden.root.symbols[e.lvalue.name].origin.id==e.id&&(i='<span class="search-scriptres">&#xf00c;</span>'),e.getSource()||console.error("NO SOURCE",e),t=e.getSource().split("\n")[0]),t.length>55&&(t=t.substr(0,55)+"..."),t=EdenUI.Highlight.html(t);var a="";if(e.doxyComment){var r=e.doxyComment.brief();r&&r.length>0&&(a='<div class="doxy-search-details"><p>'+r+"</p></div>")}return $('<div class="menubar-search-result'+n+'" data-id="'+Eden.Selectors.getID(e)+'"'+s+">"+i+t+a+"</div>")},EdenUI.SearchBox.prototype.makeScriptResult=function(e){},EdenUI.SearchBox.prototype.updateSearch=function(e){if(e&&""!=e){this.element.show();var t=this;Eden.Selectors.query(e,void 0,{minimum:1,options:{external:!0}},function(e){function i(){var n=$('<div class="menubar-search-more">&#xf078;</div>');s.append(n),n.on("click",function(){s.html("");for(var n=0;o<e.length&&!(n>a);o++){n++;var r;r=e[o]instanceof Symbol?t.makeSymbolResult(e[o]):t.makeStatementResult(e[o]),s.append(r)}o<e.length&&i()})}t.element.html("");var n=$('<div class="menubar-search-outer"></div>'),s=$('<div class="menubar-search-results"></div>');n.append(s),t.element.append(n);var o=0,a=8,r=0;for(o=0;o<e.length;o++)if(void 0!==e[o].parent||0!=e[o].executed){if(r>=a)break;r++;var d;d=t.makeStatementResult(e[o]),s.append(d)}o<e.length&&i()})}else this.element.hide()},EdenUI.ScriptBox=function(e,t){function i(e){v.dirty=!0,v.rebuild()}function n(e){if(v.ast&&v.ast.script&&!v.ast.hasErrors()&&13==e.keyCode&&"EOF"==v.ast.token&&v.intextarea.selectionStart>=v.ast.script.end)return v.history.push(v.ast.stream.code),v.historyindex=v.history.length,window.localStorage&&window.localStorage.setItem("console_history",JSON.stringify(v.history)),$(v.outdiv).find(".fake-caret").remove(),v.$codearea.append($('<div class="scriptbox-historic">'+v.outdiv.innerHTML+"</div>")),v.ast.execute(EdenUI.ScriptBox.consoleAgent,function(){void 0!==v.ast.lastresult&&(console.log("Result",v.ast.lastresult),v.$codearea.append($('<div class="scriptbox-value">'+EdenUI.Highlight.html(Eden.edenCodeForValue(v.ast.lastresult))+"</div>")))}),v.inputhider.scrollTop=v.inputhider.scrollHeight,v.setSource(""),void e.preventDefault();if(e.altKey)187==e.keyCode||61==e.keyCode?e.preventDefault():189==e.keyCode||173==e.keyCode?e.preventDefault():48==e.keyCode&&e.preventDefault();else if(e.ctrlKey||17==e.keyCode||16==e.keyCode){if(e.ctrlKey)if(e.shiftKey){if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||36==e.keyCode||35==e.keyCode)return v.setCaretToFakeCaret(),void v.outdiv.focus()}else 38===e.keyCode?onPrevious():40===e.keyCode?onNext():86===e.keyCode||65===e.keyCode&&(e.preventDefault(),v.outdiv.focus())}else if(9==e.keyCode){e.preventDefault();var t=v.intextarea.selectionStart,i=v.intextarea.selectionEnd;v.intextarea.value=v.intextarea.value.substring(0,t)+"\t"+v.intextarea.value.substring(i),v.intextarea.selectionStart=v.intextarea.selectionEnd=t+1,v.rebuild()}else if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||36==e.keyCode||35==e.keyCode){if(e.shiftKey)return v.setCaretToFakeCaret(),void v.outdiv.focus();38==e.keyCode?v.historyindex>0&&(v.historyindex--,v.setSource(v.history[v.historyindex]),e.preventDefault()):40==e.keyCode&&(v.historyindex<v.history.length-1?(v.historyindex++,v.setSource(v.history[v.historyindex]),e.preventDefault()):(v.historyindex=v.history.length,v.setSource(""))),v.updateLineCachedHighlight()}else(13==e.keyCode||8==e.keyCode&&10==v.intextarea.value.charCodeAt(v.intextarea.selectionStart-1))&&(v.refreshentire=!0)}function s(e){v.refreshentire=!0}function o(e){e.altKey||(e.ctrlKey||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode&&36!=e.keyCode&&35!=e.keyCode?(e.ctrlKey||8!=e.keyCode||""!=v.intextarea.value)&&v.rebuild():(v.updateLineCachedHighlight(),36==e.keyCode||e.keyCode))}function a(e){if(!e.altKey)if("pointer"==v.outdiv.style.cursor&&(v.outdiv.style.cursor="initial"),16==e.keyCode||17==e.keyCode||e.ctrlKey&&67==e.keyCode);else if(!e.shiftKey||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode&&35!=e.keyCode&&36!=e.keyCode){var t=getCaretCharacterOffsetWithin(v.outdiv,v.shadow),i=getStartCaretCharacterOffsetWithin(v.outdiv,v.shadow);v.intextarea.focus(),v.intextarea.selectionEnd=t,v.intextarea.selectionStart=i,i!=t&&(v.refreshentire=!0)}}function r(e){v.intextarea.focus(),setTimeout(function(){v.updateEntireHighlight()},0)}function d(e){}function l(e){$(v.outdiv).find(".fake-caret").remove(),v.hideInfoBox()}function c(e){}function h(e){if(v.hideInfoBox(),document.activeElement===v.outdiv){var t=getCaretCharacterOffsetWithin(v.outdiv,v.shadow);if(getStartCaretCharacterOffsetWithin(v.outdiv,v.shadow)!=t)v.refreshentire=!0;else{var i=v.currentlineno;v.intextarea.focus(),v.intextarea.selectionEnd=t,v.intextarea.selectionStart=t,v.ast&&(v.highlighter.highlight(v.ast,i,t),v.updateLineCachedHighlight())}}}function p(e){var t=parseInt(e.currentTarget.getAttribute("data-statement")),i=Eden.Statement.statements[t];if(i.statement&&0==i.statement.errors.length)i.statement.execute(eden.root,i.ast,i.ast,eden.root.scope),"when"==i.statement.type&&(Eden.Statement.active[i.id]=!Eden.Statement.active[i.id],changeClass(e.currentTarget,"active",Eden.Statement.active[i.id]));else if(i.ast&&i.ast.script){var n=i.ast.script.errors[0];v.showInfoBox(e.target.offsetLeft+20,e.target.offsetTop-v.codearea.scrollTop+25,"error",n.messageText())}v.updateLineCachedHighlight()}function u(e){e.currentTarget.className.indexOf("stuck")>=0?changeClass(e.currentTarget,"stuck",!1):changeClass(e.currentTarget,"stuck",!0)}function m(e){if(-1==v.dragline&&(void 0===v.outdiv||e.currentTarget!==v.outdiv.parentNode)){var t=parseInt(e.currentTarget.getAttribute("data-statement"));v.moveTo(t)}}function g(e){var t=e.currentTarget.parentNode.parentNode,i=parseInt(t.getAttribute("data-statement"));t.removeChild(v.valuedivs[i][0]),delete v.valuedivs[i]}this.changeCB=void 0,this.outer=e,this.savecb=void 0,this.contents=$(this.outer),this.contents.html('<div class="scriptbox-inputhider"><textarea autofocus tabindex="1" class="hidden-textarea" style="height: 5px;"></textarea><div class="scriptbox-codearea"></div></div><div class="scriptbox-outputbox"><div class="scriptbox-statement"><div class="scriptbox-output" contenteditable="true" spellcheck="false"></div></div></div><div class="info-bar"></div></div>'),this.currentstatement=void 0,this.statements={},this.$codearea=this.contents.find(".scriptbox-codearea"),this.codearea=this.$codearea.get(0),this.intextarea=this.contents.find(".hidden-textarea").get(0),this.inputhider=this.contents.find(".scriptbox-inputhider").get(0),this.outdiv=this.contents.find(".scriptbox-output").get(0),this.$codearea.sortable({revert:100,handle:".grippy",distance:10,axis:"y",scroll:!1}),this.infobox=this.contents.find(".info-bar").get(0),this.outputbox=this.contents.find(".scriptbox-outputbox").get(0),this.suggestions=this.contents.find(".eden_suggestions"),this.suggestions.hide(),$(this.infobox).hide(),this.highlighter=new EdenUI.Highlight(this.outdiv),this.enable(),this.ast=void 0,this.refreshentire=!0,this.dirty=!0,this.rebuildtimer=void 0,this.rebuildtimeout=10,this.currentlineno=1,this.currentcharno=0,this.dragint=!1,this.dragline=-1,this.dragvalue=0,this.draglast=0,this.history=void 0,window.localStorage?this.history=JSON.parse(window.localStorage.getItem("console_history"))||[]:this.history=[],this.historyindex=this.history.length;var v=this;this.contents.on("input",".hidden-textarea",i).on("keydown",".hidden-textarea",n).on("keyup",".hidden-textarea",o).on("paste",".hidden-textarea",s).on("keydown",".scriptbox-output",a).on("keyup",".scriptbox-output",d).on("paste",".scriptbox-output",r).on("blur",".hidden-textarea",l).on("focus",".hidden-textarea",c).on("mouseup",".scriptbox-output",h).on("click",".scriptbox-gutter",p).on("click",".scriptbox-sticky",u).on("click",".scriptbox-valueclose",g).on("mousedown",".scriptbox-statement",m),this.setSource(""),setInterval(function(){for(var e in v.valuedivs){var t=Eden.Statement.statements[e];if(t){var i=EdenUI.htmlForStatement(t,30,30);t.isActive();v.valuedivs[e].innerHTML='<div class="eden-line">'+i+"</div>"}}},200)},EdenUI.ScriptBox.consoleAgent={local:!1,name:"*Console"},EdenUI.ScriptBox.prototype.focus=function(){if(this.outdiv.focus(),document.activeElement===this.outdiv){var e=this.intextarea.value.length,t=this.currentlineno;this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=e,this.ast&&(this.highlighter.highlight(this.ast,t,e),this.updateLineCachedHighlight())}},EdenUI.ScriptBox.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0),t=document.createRange(),i=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),i.removeAllRanges(),i.addRange(t),$(this.outdiv).remove(".fake-caret")},EdenUI.ScriptBox.prototype.setChangeCB=function(e){this.savecb=e},EdenUI.ScriptBox.prototype.hideInfoBox=function(){$(this.infobox).hide("fast")},EdenUI.ScriptBox.prototype.showInfoBox=function(e,t,i,n){console.log("SHOW INFO BOX "+n),"warning"==i?this.infobox.innerHTML="<div class='info-warnitem'><span>"+n+"</span></div>":"error"==i&&(this.infobox.innerHTML="<div class='info-erroritem'><span>"+n+"</span></div>");var s=$(this.infobox);s.css("top",t+"px"),s.css("left",e+"px"),$(this.infobox).show()},EdenUI.ScriptBox.prototype.disable=function(){if(this.outdiv){changeClass(this.outdiv,"goto",!1),this.valuedivs[this.currentstatement]=this.outdiv;var e=EdenUI.htmlForStatement(Eden.Statement.statements[this.currentstatement],30,30);this.valuedivs[this.currentstatement].innerHTML='<div class="eden-line">'+e+"</div>",changeClass(this.outdiv.parentNode,"readonly",!0),this.ast}},EdenUI.ScriptBox.prototype.enable=function(){this.outdiv&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv.parentNode,"readonly",!1),this.ast&&this.highlighter.highlight(this.ast,-1,-1))},EdenUI.ScriptBox.prototype.setSource=function(e){this.intextarea.value=e,this.ast=new Eden.AST(e,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0}),this.highlightContent(this.ast,-1,0),this.intextarea.focus(),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):""==e?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0),this.outdiv.contentEditable=!0},EdenUI.ScriptBox.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.ast=new Eden.AST(this.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0}),this.highlighter.ast=this.ast,this.runScript(e),this.highlightContent(this.ast,e,t),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0)},EdenUI.ScriptBox.prototype.updateLineCachedHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(this.ast,e,t)},EdenUI.ScriptBox.prototype.updateEntireHighlight=function(e){this.ast=new Eden.AST(this.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0}),this.highlighter.ast=this.ast;var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),e&&this.runScript(0),this.highlightContent(this.ast,-1,t),this.ast.script&&0==this.ast.script.errors.length||console.log("indicated error")},EdenUI.ScriptBox.prototype.highlightContent=function(e,t,i){if(this.highlighter.highlight(e,t,i),e.mainDoxyComment&&(-1==t||t>=1&&t<=e.mainDoxyComment.endline)){var n=e.mainDoxyComment.content.match(/@[a-z]+.*\n/gi);if(n)for(var s=0;s<n.length;s++){var o=n[s].search(/\s/);if(o>=0)n[s].substring(0,o),n[s].substr(o).trim()}}document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret");var a=this;$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(e,t){var i;if((i=a.dragint?Math.round(a.dragvalue+(t.position.left-a.dragstart)/2):(i=a.dragvalue+.005*(t.position.left-a.dragstart)).toFixed(4))!=a.draglast){a.draglast=i,e.target.innerHTML=""+i;var n=e.target.parentNode.textContent;"\n"==n.charAt(n.length-1)&&(n=n.slice(0,-1)),a.replaceLine(a.dragline,n),a.ast=new Eden.AST(a.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0}),a.highlighter.ast=a.ast,a.highlightContent(a.ast,a.dragline,-1),Eden.Statement.statements[a.currentstatement].setSource(a.intextarea.value,a.ast)}},start:function(e,t){a.edited=!0,a.dragline=a.findElementLineNumber(e.target),a.dragstart=t.position.left;var i=e.target.textContent;-1==i.indexOf(".")?(a.dragvalue=parseInt(i),a.dragint=!0):(a.dragvalue=parseFloat(i),a.dragint=!1),a.draglast=a.dragvalue,$(e.target).addClass("eden-select"),$(a.outdiv).css("cursor","ew-resize")},stop:function(e,t){$(e.target).removeClass("eden-select"),$(a.outdiv).css("cursor","text"),a.dragline=-1},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptBox.prototype.clear=function(){this.$codearea.html(""),this.setSource("")},EdenUI.ScriptBox.prototype.getLineNumber=function(e){var t=e.value.substr(0,e.selectionStart).split("\n");return this.currentlineno=t.length,this.currentcharno=t[t.length-1].length,this.currentlineno},EdenUI.ScriptBox.prototype.doRebuild=function(){this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight()},EdenUI.ScriptBox.prototype.runScript=function(e){},EdenUI.ScriptBox.prototype.rebuild=function(){clearTimeout(this.rebuildtimer);var e=this;this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptBox.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;for(var i=0;i<this.outdiv.childNodes.length;i++)if(this.outdiv.childNodes[i]===t)return i;return-1},EdenUI.ScriptBox.prototype.replaceLine=function(e,t){var i=this.intextarea.value.split("\n");i[e]=t,this.intextarea.value=i.join("\n")},EdenUI.Explorer=function(){function e(e,t){window.localStorage.setItem(e.name,t)}var t=this;this.element=$(`<div class="explore-main">\n<div class="explore-tabs">\n\t<div class="explore-tab-container">\n\t\t<div class="explore-tab explore-tab-current" data-name="state">${Language.ui.explorer.state}</div>\n\t\t<div class="explore-tab explore-tab-notcurrent" data-name="scripts">Agents</div>\n\t\t<div class="explore-tab explore-tab-notcurrent" data-name="settings">Settings</div>\n`+`\t</div>\n</div>\n<div class="explore-state">\n</div>\n<div class="explore-script" style="display: none">\n</div>\n<div class="explore-settings" style="display: none">\n\t<div style="font-size: 8pt">Note: Many of these do not work yet.</div>\n\t<h1>Environment</h1>\n\t<div id="explorerenvsettings" class="explorer-settings-list"></div>\n\t<h1>Project</h1>\n\t<div id="explorerprojectsettings" class="explorer-settings-list"></div>\n\t<h1>Menu Bar</h1>\n\t<div id="explorermenusettings" class="explorer-settings-list"></div>\n\t<h1>Search</h1>\n\t<div id="explorersearchsettings" class="explorer-settings-list"></div>\n\t<h1>Parser</h1>\n\t<div id="explorerparsersettings" class="explorer-settings-list"></div>\n\t<h1>Script Views</h1>\n\t<div id="explorerscriptviewsettings" class="explorer-settings-list"></div>\n</div>\n<div class="explore-console">\n\t<div class="explore-console-buttons">\n\t\t<div style="margin-top: 4px; float: left;">${Language.ui.explorer.input}</div>\n\t\t<button class="control-button clear-button control-enabled" title="${Language.ui.tooltips.clear}" style="float: right;">&#xf05e;</button>\n\t</div>\n\t<div class="explore-console-code"></div>\n</div>\n</div>`),$("#jseden-main").append(this.element),this.consoleele=this.element.find(".explore-console-code"),this.expscripts=this.element.find(".explore-script"),this.expstate=this.element.find(".explore-state"),this.expsettings=this.element.find(".explore-settings");i=this.expsettings.find("#explorerenvsettings").get(0);this.addSetting(i,"jseden_autosave","Enable autosave to local storage","","boolean"),this.addSetting(i,"jseden_leaveprompt","Enable a leave page prompt","","boolean");i=this.expsettings.find("#explorerprojectsettings").get(0);this.addSetting(i,"jseden_project_nocomments","Disable comments","","boolean"),this.addSetting(i,"jseden_project_noforking","Disable forking","","boolean");var i=this.expsettings.find("#explorermenusettings").get(0);this.addSetting(i,"jseden_menu_visible","Menu visible","","boolean"),this.addSetting(i,"jseden_menu_showhelp","Show Help","","boolean"),this.addSetting(i,"jseden_menu_showsearch","Show Search","","boolean"),this.addSetting(i,"jseden_menu_showcreate","Show Create Views","","boolean"),this.addSetting(i,"jseden_menu_showexisting","Show Existing","","boolean"),this.addSetting(i,"jseden_menu_showshare","Show Share","","boolean"),this.addSetting(i,"jseden_explorer_enabled","Allow Spanner Panel","","boolean"),i=this.expsettings.find("#explorersearchsettings").get(0),this.addSetting(i,"jseden_search_history","Include Historic","","boolean"),this.addSetting(i,"jseden_search_external","Always include external","","boolean"),this.addSetting(i,"jseden_search_all","Don't make unique","","boolean"),this.addSetting(i,"jseden_search_nosort","Don't sort by time","","boolean"),i=this.expsettings.find("#explorerparsersettings").get(0),this.addSetting(i,"jseden_parser_strict","Strict mode","","boolean"),this.addSetting(i,"jseden_parser_noliterals","No literals in expressions","","boolean"),this.addSetting(i,"jseden_parser_noexprover","No override expressions","","boolean"),this.addSetting(i,"jseden_parser_warndeprecate","Show deprecation warnings","","boolean"),this.addSetting(i,"jseden_parser_errordeprecate","Make deprecated an error","","boolean"),i=this.expsettings.find("#explorerscriptviewsettings").get(0),this.addSetting(i,"jseden_script_query","Default browse query","","text"),this.addSetting(i,"jseden_script_buttons","Show buttons","","boolean"),this.addSetting(i,"jseden_script_highlighting","Disable highlighting","","boolean"),this.addSetting(i,"jseden_script_styling","Disable comment styling","","boolean"),this.addSetting(i,"jseden_script_hidecomments","Hide all comments","","boolean"),this.addSetting(i,"jseden_script_readonly","All readonly","","boolean"),this.element.resizable({handles:"w",stop:function(e,t){eden.root.lookup("jseden_explorer_width").assign(t.element[0].clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent)}}),eden.root.lookup("jseden_explorer_width").assign(this.element.get(0).clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent),this.console=new EdenUI.ScriptBox(this.consoleele.get(0),{nobuttons:!0}),this.state=new EdenUI.ExplorerState(this.expstate),this.element.on("click",".clear-button",function(e){t.console.clear()}),this.element.on("click",".explore-tab",function(e){var i=e.currentTarget.getAttribute("data-name"),n=t.element.find(".explore-tab-current");n.removeClass("explore-tab-current"),n.addClass("explore-tab-notcurrent"),changeClass(e.currentTarget,"explore-tab-current",!0),changeClass(e.currentTarget,"explore-tab-notcurrent",!1),"state"==i?(t.expstate.css("display","flex"),t.expscripts.css("display","none"),t.expsettings.css("display","none")):"scripts"==i?(t.expstate.css("display","none"),t.expscripts.css("display","flex"),t.expsettings.css("display","none")):"palette"==i||"settings"==i&&(t.expstate.css("display","none"),t.expsettings.css("display","block"),t.expscripts.css("display","none"))});var n=eden.root.lookup("jseden_explorer_enabled");n.value()?t.state.show():(this.enabled=!1,this.element.hide(),t.state.hide()),n.addJSObserver("explorer",function(e,i){t.enabled=i,i?eden.root.lookup("jseden_explorer_visible").value()&&(t.element.show(),t.state.show()):(t.element.hide(),t.state.hide(),t.capture=!1)});var s=eden.root.lookup("jseden_explorer_visible");s.value()?t.state.show():(this.element.hide(),t.state.hide()),s.addJSObserver("explorer",function(e,i){i&&t.enabled?(t.element.show(),t.state.show(),eden.root.lookup("jseden_explorer_width").assign(t.element.get(0).clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent)):(t.element.hide(),t.state.capture=!1,t.state.clear(),t.state.hide(),eden.root.lookup("jseden_explorer_width").assign(0,eden.root.scope,EdenSymbol.localJSAgent))});for(var o=["jseden_autosave","jseden_leaveprompt","jseden_explorer_enabled"],a=0;a<o.length;a++){var r=eden.root.lookup(o[a]);r.assign("true"==window.localStorage[o[a]],eden.root.scope,EdenSymbol.localJSAgent),r.addJSObserver("settings",e)}var d=eden.root.lookup("jseden_explorer_zoom"),l=d.value();d.addJSObserver("explorer",function(e,i){if("number"==typeof i&&i>0){var n=10*i;t.state.results.css("font-size",n+"pt")}}),void 0===l&&d.assign(1,eden.root.scope,EdenSymbol.defaultAgent)},EdenUI.Explorer.prototype.addSetting=function(e,t,i,n,s){function o(e,t){e.orign instanceof InternalAgent||("boolean"==s?d.checked=t:d.value=t)}var a=document.createElement("div");a.className="explorer-setting",a.title=n;var r=document.createElement("span");r.textContent=i,r.className="explorer-setting-label",a.appendChild(r);var d=document.createElement("input"),l=eden.root.lookup(t),c=l.value();switch(s){case"boolean":d.setAttribute("type","checkbox");break;case"string":d.setAttribute("type","text")}d.onchange=function(e){"boolean"==s?l.assign(d.checked,eden.root.scope,EdenSymbol.localJSAgent):l.assign(d.value,eden.root.scope,EdenSymbol.localJSAgent)},o(l,c),l.addJSObserver("settings",o),a.appendChild(d),e.appendChild(a)},EdenUI.Explorer.MAXHIGHLIGHTLENGTH=1e3,EdenUI.Explorer.prototype.showConsole=function(){},EdenUI.Explorer.prototype.hideConsole=function(){},EdenUI.ExplorerState=function(e){var t=this;this.outer=e,this.controls=$(`<div class="explore-controls">\n\t\t<button class="explorer-control capture"><span class="explorer-control-icon">&#xf111;</span>${Language.ui.explorer.capture}</button>\n\t\t<button class="explorer-control clear"><span class="explorer-control-icon">&#xf05e;</span>${Language.ui.explorer.clear}</button>\n\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="${Language.ui.explorer.filter}"></input></span>\n\t</div>`),this.results=$('<div class="explore-symbols"></div>'),this.outer.append(this.controls),this.outer.append(this.results),this.searchbox=this.controls.find(".explorerfilter"),this.watchobs={},this.capture=!1,this.delay=100,this.delay2=20,this.timeout=void 0,this.timeout2=void 0,this.mode="tree",this.index={},this.todo={},this.filter=void 0,this.listener=function(e,i){var n=e.name;!t.capture||i==EdenSymbol.EXPIRED&&void 0!==t.watchobs[n]||void 0!==t.filter&&!t.filter[n]?(t.todo[n]=!0,void 0===t.timeout2&&(t.timeout2=setTimeout(function(){t.timeout2=void 0;var e=t.todo;t.todo={};for(var i in t.index)if(e[i]){var n=eden.root.symbols[i];if(void 0===n){for(s=0;s<t.index[i].length;s++)t.removeEntry(i,t.index[i][s]);delete t.index[i]}else for(var s=0;s<t.index[i].length;s++)t.updateEntry(n,t.index[i][s])}},t.delay2))):(void 0===t.watchobs[n]?t.watchobs[e.name]=1:t.watchobs[n].lastupdate=1,t.triggerUpdate())},this.controls.on("click",".clear",function(e){var t=eden.root.lookup("jseden_explorer_clear");t.eden_definition||t.assign(!0,eden.root.scope,EdenSymbol.localJSAgent)}),this.controls.on("click",".capture",function(e){var t=eden.root.lookup("jseden_explorer_capture");t.eden_definition||t.assign(!t.value(),eden.root.scope,EdenSymbol.localJSAgent)}),this.results.on("click",".explore-observable",function(e){var t=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");Eden.Selectors.goto(t+":active"),e.stopPropagation()}),this.results.on("click",".explore-expand-value",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");t.updateEntry(eden.root.lookup(i),e.currentTarget.parentNode,!0)}),this.results.on("click",".eden-path",function(e){var t=e.currentTarget.textContent;edenUI.gotoCode(t,-1)}),this.results.on("click",".symvalue",function(e){}),this.results.on("click",".explore-entry-icon",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode,n=i.getAttribute("data-obs");if("true"==i.getAttribute("data-expanded")){e.currentTarget.innerHTML="&#xf067;",i.setAttribute("data-expanded","false");for(r=i.firstChild;r;){var s=r.nextSibling;"DIV"==r.nodeName&&"explore-entry-inner"!=r.className&&0==r.className.includes("active")&&i.removeChild(r),r=s}}else{e.currentTarget.innerHTML="&#xf068;",i.setAttribute("data-expanded","true");for(var o=eden.root.symbols[n],a={},r=i.firstChild;r;)"DIV"==r.nodeName&&(a[r.getAttribute("data-obs")]=!0),r=r.nextSibling;for(var d in o.dependencies)if(!a[d]){var l=o.dependencies[d],c=!l,h=l&&l.definition,n=d,p=$('<div class="explore-entry'+(c?" missing":"")+(h?" defined":"")+'" data-obs="'+n+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(h?"&#xf067;":" ")+'</span><span class="explore-observable">'+n+'</span> </span><div class="symvalue"></div></div></div>'),u=p.find(".symvalue").get(0);t.updateEntry(l,u),void 0===t.index[n]&&(t.index[n]=[]),t.index[n].push(u),i.appendChild(p.get(0))}}});var i=eden.root.lookup("jseden_explorer_search");i.value()&&this.searchbox.val(searchval),i.addJSObserver("explorer",function(e,i){void 0!==i&&"*JavaScript"!=e.origin.name&&t.searchbox.val(i)}),this.searchbox.on("keyup",function(e){void 0===i.definition&&i.assign(e.target.value,eden.root.scope,EdenSymbol.localJSAgent)});var n=eden.root.lookup("jseden_explorer_watch"),s=n.value();Array.isArray(s)&&(this.clear(),this.watch(s)),n.addJSObserver("explorer",function(e,i){Array.isArray(i)&&(t.capture?t.filter=void 0:t.clear(),t.watch(i))});var o=eden.root.lookup("jseden_explorer_capture");o.addJSObserver("explorer",function(e,i){i?(t.record(),t.controls.find(".capture").addClass("active")):(t.capture=!1,t.controls.find(".capture").removeClass("active"))}),o.value()&&t.record(),eden.root.lookup("jseden_explorer_clear").addJSObserver("explorer",function(e,i){i&&t.clear()})},EdenUI.ExplorerState.prototype.show=function(){eden.root.addGlobal(this.listener)},EdenUI.ExplorerState.prototype.hide=function(){eden.root.removeGlobal(this.listener)},EdenUI.ExplorerState.prototype.triggerUpdate=function(){if(void 0===this.timeout){var e=this;this.timeout=setTimeout(function(){e.index={},e.timeout=void 0,"list"==e.mode?e.updateList():"tree"==e.mode?e.updateTree():"graph"==e.mode&&e.updateGraph()},this.delay)}},EdenUI.ExplorerState.prototype.updateList=function(){},EdenUI.ExplorerState.prototype.makeAgentEntry=function(e){var t=e.name;if(t.startsWith("*Console"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf108;</span> <b>console</b></div>');if(t.startsWith("*When"))return n=(n=(i=t.split(":"))[1].split("/"))[n.length-1],i=n+":"+i[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">when</span> <span class="eden-path">'+i+"</span></div>");if(t.startsWith("*Action")){var i=t.split(":"),n=i[1].split("/");return n=n[n.length-1],i=n+":"+i[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">action</span> <span class="eden-path">'+i+"</span></div>")}if("/"==t.charAt(0)){if(e.eden_definition&&e.eden_definition.startsWith("proc"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">proc</span> <span class="eden-path">'+t+"</span></div>")}else if("*"!=t.charAt(0))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf15c;</span><span class="eden-path">'+t+"</span></div>")},EdenUI.ExplorerState.prototype.removeEntry=function(e,t){t.innerHTML='<span style="font-weight: bold; color: red">DELETED</span>',delete this.watchobs[e],this.triggerUpdate()},EdenUI.ExplorerState.prototype.updateEntry=function(e,t,i){if(e){var n,s,o=e.value();if("function"==typeof o)s='<span class="eden-keyword">func</span>';else{if(i)n=(a=Eden.edenCodeForValue(o,void 0,2)).length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(a,!0):a;else if(Array.isArray(o)&&o.length>2)n='[.. <span class="explore-expand-value">&#xf0fe;</span> ..]';else{var a=Eden.edenCodeForValue(o,void 0,2);n=a.length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(a,!0):a}s=(e.eden_definition?'<span class="eden-keyword">is</span>':"<b>=</b>")+" "+n}t.innerHTML=s}},EdenUI.ExplorerState.prototype.makeEntry=function(e,t,i){var n=eden.root.symbols[e],s=!1,o=!1;n&&n.definition&&(o=!0),n||(s=!0);var a=$('<div class="explore-entry'+(i?" active":"")+(s?" missing":"")+(o?" defined":"")+'" data-obs="'+e+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(o?"&#xf067;":" ")+'</span><span class="explore-observable">'+e+'</span> </span><div class="symvalue"></div></div></div>'),r=a.find(".symvalue").get(0);o&&n.origin&&(a.get(0).title=n.origin.getSource()),this.updateEntry(n,r),void 0===this.index[e]&&(this.index[e]=[]),this.index[e].push(r);var d=0;if(t)for(var l in t)d++,a.append(this.makeEntry(l,t[l],i));return a},EdenUI.ExplorerState.prototype.updateTree=function(){var e=this.capture?Eden.Query.dependencyTree(this.watchobs):this.watchobs;this.results.html("");for(var t in e)this.results.append(this.makeEntry(t,this.capture?e[t]:void 0,this.capture))},EdenUI.ExplorerState.prototype.watch=function(e){this.capture,void 0===this.filter&&e.length>0&&(this.filter={});for(var t=0;t<e.length;t++)void 0!==e[t]&&(this.filter[e[t]]=!0,this.capture||(this.watchobs[e[t]]={elements:[],lastupdate:1}));this.triggerUpdate()},EdenUI.ExplorerState.prototype.record=function(){this.watchobs={},this.triggerUpdate(),this.capture=!0},EdenUI.ExplorerState.prototype.clear=function(){this.watchobs={},this.filter=void 0,this.triggerUpdate()},EdenUI.ExplorerState.prototype.displayAsTree=function(){},EdenUI.ExplorerState.prototype.displayAsList=function(){},EdenUI.ExplorerState.prototype.displayAsGraph=function(){},EdenUI.ExplorerState.prototype.search=function(e){},EdenUI.ExplorerScripts=function(e){this.outer=e,this.controls=$('<div class="explore-controls">\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="Filter..."></input></span>\t</div>'),this.scripts=$('<div class="explore-scripts"></div>'),this.outer.append(this.controls),this.outer.append(this.scripts)},EdenUI.ExplorerScripts.prototype.buildScriptTree=function(e){for(var t={},i=0;i<e.length;i++)for(var n=e[i].split(/[\.\:]+/),s=t,o=0;o<n.length;o++)void 0===s[n[o]]&&(s[n[o]]={}),s=s[n[o]];return t},EdenUI.ExplorerScripts.prototype.makeEntry=function(e,t){for(var i in t){var n=$('<div class="explore-sentry"><div class="explore-script-inner"><span class="explore-entry-icon">&#xf067;</span>'+i+"</div></div>");this.makeEntry(n,t[i]),e.append(n)}},EdenUI.ExplorerScripts.prototype.update=function(){this.scripts.html("");var e=Eden.Selectors.query(">> script:has-name","id"),t=this.buildScriptTree(e),i=[],n=[];for(var s in Eden.Selectors.cache)n.push(s),i.push(Eden.Selectors.cache[s]);(e=Eden.Selectors.queryWithin(i,">> script:has-name","id")).push.apply(e,n);var o={External:this.buildScriptTree(e)};this.makeEntry(this.scripts,t),this.makeEntry(this.scripts,o)},EdenUI.Markdown=function(e){this.contents=document.createElement("div"),this.contents.className="markdown-inputhider",this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.intextarea.value=e,this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="markdown-inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contentEditable=!0,this.outdiv.className="markdown-outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.highlighter=new EdenUI.Highlight(this.outdiv,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0},brline:!0});new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.updateLineCachedHighlight()},EdenUI.Highlight.prototype.MARKDOWN=function(){"#"==this.token&&(this.stream.position-2<=0||"\n"==this.stream.code.charAt(this.stream.position-2))?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE",this.lineelement.className=this.styles["comment-line"]):"##"==this.token&&(this.stream.position-3<=0||"\n"==this.stream.code.charAt(this.stream.position-3))?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE2",this.lineelement.className=this.styles["comment-line"]):this.COMMENT()},EdenUI.Markdown.styles={comment:"","hidden-comment":"markdown-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",string:"eden-string",keyword:"eden-keyword",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"markdown-comment-h1","comment-h2":"markdown-comment-h2","comment-h3":"eden-comment-h3","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"markdown-comment-line",doxytag:"markdown-tag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote",script:"eden-script"},EdenUI.Markdown.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.Markdown.prototype.hideInfoBox=function(){},EdenUI.Markdown.prototype.disableGotoMode=function(){},EdenUI.Markdown.prototype.rebuild=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.updateLineCachedHighlight=function(){var e=new Eden.AST(this.intextarea.value,void 0,{},{noparse:!0,noindex:!0}),t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,this.getLineNumber(this.intextarea)),this.highlighter.highlight(e,-1,t)},EdenUI.Markdown.prototype.setValue=function(e){this.intextarea.value=e,this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.moveCaret=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.checkScroll=function(){},EdenUI.Markdown.prototype.enableGotoMode=function(){},EdenUI.Markdown.prototype.focusText=function(){var e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=t},EdenUI.Markdown.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.Markdown.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0);if(e){var t=document.createRange(),i=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),i.removeAllRanges(),i.addRange(t),$(this.outdiv).remove(".fake-caret")}},EdenUI.Markdown.html=function(e,t,i){var n=document.createElement("div"),s=new EdenUI.Highlight(n,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0},brline:!0});if(EdenUI.Markdown.styles["hidden-comment"]="eden-comment-hidden",EdenUI.Markdown.styles["script-line"]="markdown-comment-line2",s.ast={stream:new EdenStream(e)},s.highlight(s.ast,-1,-1,void 0),EdenUI.Markdown.styles["hidden-comment"]="markdown-comment-hidden",EdenUI.Markdown.styles["script-line"]="markdown-comment-line",t)return n.childNodes[0].innerHTML;for(var o="",a=0;a<n.childNodes.length;a++)o+=n.childNodes[a].innerHTML;return i?'<div style="display: flex; align-items: center;"><div class="eden-hl-play" data-src="'+e+'">&#xf04b;</div><div>'+o+"</div></div>":o},EdenUI.ProjectDetails=function(e,t){var i=this;this.projectid=e,this.meta=void 0,this.newtab=t;var n=mobilecheck();this.obscurer=$('<div class="modal" style="display: block;"></div>'),this.obscurer.on("click",function(e){e.target===e.currentTarget&&i.remove()}),this.dialog=n?$('<div class="modal-content"></div>'):$('<div class="modal-content" style="width: 600px"></div>'),this.obscurer.append(this.dialog),document.body.appendChild(this.obscurer.get(0)),Eden.DB.getMeta(e,function(t){if(console.log("DETAILS META",t),null!==t[0].image){var n=$('<img class="projectdetails-thumb" src="'+t[0].image+'"></img>');i.dialog.append(n)}console.log(t[0].projectMetaData);var s=null!==t[0].projectMetaData?JSON.parse(t[0].projectMetaData):{},o=document.createElement("div");o.className="markdown";var a=new showdown.Converter,r=s&&s.description?s.description.replace(/\@author[^\n]*/g,"").replace(/\s(#[a-zA-Z0-9]+)/g,' <span class="markdown-hashtag">$1</span>'):"",d=t[0].ownername;if(s&&s.description){var l=new Eden.AST.DoxyComment(s.description,0,0).getProperty("author");if(l&&l.length>0){if(d=l[0]+(l.length>1?" et al.":""),l.length>1){r+="\n\n__Authors:__";for(f=0;f<l.length;f++)r+=" "+l[f],f<l.length-1&&(r+=",")}l[0]!=t[0].ownername&&(r+="\n\n__Published by:__ "+t[0].ownername)}else d=t[0].ownername}var c=a.makeHtml(r);o.innerHTML=c,i.dialog.get(0).appendChild(o);var h=t[0].date.split(/[- :]/),p=null!==t[0].overallRating?t[0].overallRating/t[0].numRatings:0,u=$('<div class="projectdetails">\t\t\t<span class="projectdetails-rateavg">'+p.toFixed(1)+'</span><span><span class="projectdetails-label">by:</span><span class="projectdetails-value">'+d+'</span></span>\t\t\t<span>, <span class="projectdetails-value">'+get_time_diff(new Date(h[0],h[1]-1,h[2],h[3],h[4],h[5]).getTime()/1e3)+"</span></span>\t\t</div>"),m=$('<div class="projectdetails-rating"><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span></div>');i.dialog.append(m),i.dialog.append(u),m.on("click",".projectdetails-star",function(t){if(0!=Eden.DB.isLoggedIn()){for(var i=t.currentTarget.parentNode,n=0,s=0;s<5;s++)i.childNodes[s].className="projectdetails-star"+(n>0?"":" selected"),i.childNodes[s].innerHTML="&#xf005;",i.childNodes[s]===t.currentTarget&&(n=s+1);Eden.DB.rate(e,n)}});var g=m[0];if(p)for(var v=Math.floor(p),f=0;f<5;f++)g.childNodes[f].className="projectdetails-star"+(f>=v?"":" average"),g.childNodes[f].innerHTML="&#xf005;";var b=t[0].myrating;if(b)for(f=0;f<5;f++)g.childNodes[f].className="projectdetails-star"+(f>=b?"":" selected"),g.childNodes[f].innerHTML="&#xf005;";var E;(E=t[0].owner==Eden.DB.userid?$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="deleteproject script-button"><span class="explorer-control-icon">&#xf00d;</span>Delete</button><br></div>'):$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="followproject script-button" style="float: right"><span class="explorer-control-icon">&#xf09e;</span>Follow</button><br></div>')).on("click",".openproject",function(){i.remove(),i.newtab?window.open(window.location.origin+window.location.pathname+"?load="+e):($(".loadmodal").show(),Eden.DB.log("open",{pid:e}),Eden.Project.load(e))}),E.on("click",".deleteproject",function(){confirm("Are you sure you want to delete this project?")&&(i.remove(),Eden.DB.log("delete",{pid:e}),Eden.DB.remove(e))}),E.on("click",".restoreproject",function(){i.remove(),eden.root.lookup("jseden_project_mode").assign("restore",eden.root.scope,Symbol.defaultAgent),Eden.Project.load(e)}),E.on("click",".followproject",function(t){Eden.DB.follow(e,function(e){e&&t.currentTarget.parentNode.removeChild(t.currentTarget)})}),E.append($('<iframe src="https://www.facebook.com/plugins/like.php?href='+encodeURIComponent(window.location.href+"?load="+e)+'&width=350&layout=standard&action=like&size=small&show_faces=false&share=true&height=80&appId=1447073055317881" width="300" height="20" style="border:none;overflow:hidden;margin-left:5px;margin-top:5px;" scrolling="no" frameborder="0" allowTransparency="true"></iframe>')),i.dialog.append(E),Eden.DB.search(":parent("+e+")",1,1,void 0,function(t){if(t.length>0){var n=document.createElement("div");n.className="projectdetails-forks";for(var s=0;s<t.length;s++){var a=document.createElement("div");a.className="projectdetails-fork";var r=t[s].date.split(/[- :]/);a.innerHTML='Forked as "'+t[s].title+'" by '+t[s].ownername+" "+get_time_diff(new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]).getTime()/1e3),n.appendChild(a)}i.dialog.get(0).insertBefore(n,o.nextSibling)}Eden.DB.searchComments({id:e},"",1,3,void 0,function(e){var t=new showdown.Converter;if(e.length>0){var n=document.createElement("div");n.style.borderTop="1px solid #aaa",n.style.height="10px",i.dialog.get(0).appendChild(n)}for(var s=0;s<e.length;s++){var o=document.createElement("div"),a=document.createElement("div"),r=e[s].date.split(/[- :]/);a.className="feedback-header",a.innerHTML='<span class="feedback-author">'+e[s].name+'</span><span class="feedback-date" data-date="'+e[s].date+'">'+get_time_diff(new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]).getTime()/1e3)+"</span>",o.appendChild(a);var d=document.createElement("div");d.style.padding="0",d.style.marginBottom="3px",d.className="markdown",o.appendChild(d),o.className="feedback-result",d.innerHTML=t.makeHtml(e[s].comment),i.dialog.get(0).appendChild(o)}})})})},EdenUI.ProjectDetails.prototype.remove=function(){document.body.removeChild(this.obscurer.get(0))},EdenUI.ProjectDetails.searchProjects=function(e,t,i,n,s,o){var a=i||7,r=1;e.on("click",".more",function(i){e.find(".more").remove(),r++,Eden.DB.search(t,r,a,o,function(i){EdenUI.ProjectDetails._searchProjects(t,e,!t.startsWith(":me"),i,a,r,s)}),i.stopPropagation()}),t||(t=""),Eden.DB.search(t,1,a,o,function(i){EdenUI.ProjectDetails._searchProjects(t,e,!t.startsWith(":me"),i,a,r,s),n&&n(i)})},EdenUI.ProjectDetails._searchProjects=function(e,t,i,n,s,o,a){var r=s||7;if(void 0!==n){for(var d=mobilecheck()?120:200,l=0;l<n.length;l++){var c,h=n[l],p=h.date.split(/[- :]/),u=h.title,m=h.image,g=!1,v=null!==h.projectMetaData?JSON.parse(h.projectMetaData):void 0;if(i)if(v&&v.description){var f=new Eden.AST.DoxyComment(v.description,0,0).getProperty("author");c=f&&f.length>0?f[0]:h.ownername}else c=h.ownername;else c=get_time_diff(new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5]).getTime()/1e3),null===h.publicVersion&&(g=!0);var b;b=null!==m?$('<div class="cadence-plisting-entry project noselect'+(g?" locked":"")+'" data-pid="'+h.projectID+'"><div class="cadence-plisting-img"><img width="'+d+'" src="'+m+'"></img></div><div class="cadence-plisting-title">'+u+'</div><div class="cadence-plisting-subtitle">'+c+"</div></div>"):$('<div class="cadence-plisting-entry project noselect'+(g?" locked":"")+'" data-pid="'+h.projectID+'"><div class="cadence-plisting-icon">&#xf0c3;</div><div class="cadence-plisting-title">'+u+'</div><div class="cadence-plisting-subtitle">'+c+"</div></div>"),t.append(b),b.click(function(e){var t=e.currentTarget.getAttribute("data-pid");Eden.DB.log("view",{pid:t}),new EdenUI.ProjectDetails(t,a)});var E=null!==h.overallRating?h.overallRating/h.numRatings:0,y=$('<div class="projectdetails-ratingsmall"><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span></div>');b.append(y);var x=y.get(0);if(E)for(var k=Math.floor(E),C=0;C<5;C++)x.childNodes[C].className="projectdetails-star"+(C>=k?"":" average")}n.length==r&&t.append($('<div class="cadence-plisting-entry more noselect"><div class="cadence-plisting-icon more">&#xf103;</div></div>'))}},EdenUI.ProjectDetails.localProjects=function(e,t,i){if(void 0!==t)for(var n=0;n<t.length;n++){var s,o=t[n],a=o.title,r=o.image;if(o.description){var d=new Eden.AST.DoxyComment(o.description,0,0).getProperty("author");s=d&&d.length>0?d[0]:o.author}else s=o.author;var l;l=null!==r?$('<div class="cadence-plisting-entry project noselect" data-path="'+o.name+'"><div class="cadence-plisting-img"><img src="'+r+'"></img></div><div class="cadence-plisting-title">'+a+'</div><div class="cadence-plisting-subtitle">'+s+"</div></div>"):$('<div class="cadence-plisting-entry project noselect" data-path="'+o.name+'"><div class="cadence-plisting-icon">&#xf0c3;</div><div class="cadence-plisting-title">'+a+'</div><div class="cadence-plisting-subtitle">'+s+"</div></div>"),e.append(l),l.click(function(e){var t=e.currentTarget.getAttribute("data-path");console.log("Load project: "+t),Eden.Project.newFromExisting(t,function(){})});var c=o.rating;if(c){var h=$('<div class="projectdetails-ratingsmall">\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t</div>');l.append(h);var p=h.get(0);if(c)for(var u=Math.floor(c),m=0;m<5;m++)p.childNodes[m].className="projectdetails-star"+(m>=u?"":" average")}}},EdenUI.Feedback=function(){function e(e,t){if(t)o.odialog.style.display="initial",o.clear(),o.updateComments(""),clearInterval(o.interval),o.interval=setInterval(function(){o.updateComments("")},5e3);else{o.odialog.style.display="none",clearInterval(o.interval);var i;o.interval=setInterval(function(){Eden.DB.searchComments(eden.project,"",1,10,i,function(e){if(e){if(void 0===i&&e.length>0)return void(i=e[0].commentID);for(var t=0;t<e.length;t++)edenUI.menu.notifications.notification("comment","New comment by "+e[t].name);e.length>0&&(i=e[0].commentID,o.cache=e.concat(o.cache))}})},1e4)}}var t=document.createElement("div");t.className="feedback-icon noselect",t.innerHTML="&#xf0e6;",t.title=Language.ui.tooltips.comments,document.getElementById("jseden-views").appendChild(t),this.odialog=document.createElement("div"),this.odialog.className="feedback-dialog",this.odialog.style.display="none",mobilecheck()&&(this.odialog.style.width="90%"),document.getElementById("jseden-views").appendChild(this.odialog),this.dialog=document.createElement("div"),this.dialog.className="feedback-scroller",this.odialog.appendChild(this.dialog);var i=document.createElement("div");i.className="feedback-title",i.innerHTML=`<span class="feedback-icon2">&#xf0e6;</span><span class="feedback-title-text">${Language.ui.comments.comments}</span><span class="feedback-close">&#xf00d;</span>`,this.dialog.appendChild(i);var n=eden.root.lookup("jseden_feedback_visible"),s=eden.root.lookup("jseden_feedback_width"),o=this;t.addEventListener("click",function(e){void 0===n.definition&&n.assign(!0,eden.root.scope,Symbol.hciAgent)}),i.childNodes[2].addEventListener("click",function(e){void 0===n.definition&&n.assign(!1,eden.root.scope,Symbol.hciAgent)}),s.assign(420,eden.root.scope,Symbol.defaultAgent),n.addJSObserver("feedback",e),e(n,n.value());var a=new EdenUI.Markdown(""),r=document.createElement("div");r.className="feedback-input",r.appendChild(a.contents);var d=document.createElement("div");d.className="feedback-buttons";var l=document.createElement("div");l.textContent=Language.ui.comments.signin,l.style.display="none",l.className="feedback-signinmsg",this.dialog.appendChild(l),Eden.DB.isLoggedIn()||(r.style.display="none",d.style.display="none",l.style.display="block"),this.dialog.appendChild(r),this.dialog.appendChild(d),this.results=document.createElement("div"),this.dialog.appendChild(this.results),this.results.addEventListener("click",function(e){"feedback-delete"==e.srcElement.className?(console.log("delete",e.srcElement.getAttribute("data-id")),Eden.DB.removeComment(e.srcElement.getAttribute("data-id")),o.results.removeChild(e.srcElement.parentNode.parentNode)):"eden-hl-play"==e.srcElement.className&&(console.log("PLAY COMMENT",e.srcElement.getAttribute("data-src")),eden.execute2(e.srcElement.getAttribute("data-src")))});var c=document.createElement("button");c.className="script-button",c.textContent="Comment",d.appendChild(c),c.addEventListener("click",function(){Eden.DB.log("postcomment",{pid:eden.project?eden.project.id:-1,content:a.intextarea.value}),Eden.DB.postComment(eden.project,a.intextarea.value),a.setValue(""),o.updateComments("")}),this.cache=[],setInterval(function(){o.updateTimes()},2e4),Eden.DB.listenTo("login",this,function(e){e&&(r.style.display="block",d.style.display="block",l.style.display="none")})},EdenUI.Feedback.prototype.clear=function(){for(this.cache=[];this.results.lastChild;)this.results.removeChild(this.results.lastChild)},EdenUI.Feedback.prototype.updateTimes=function(){for(var e=0;e<this.results.childNodes.length;e++){var t=this.results.childNodes[e].childNodes[0].childNodes[1],i=t.getAttribute("data-date").split(/[- :]/);t.textContent=get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)}},EdenUI.Feedback.prototype.updateComments=function(e){var t=this,i=new showdown.Converter,n=this.cache.length>0?this.cache[0].commentID:void 0,s=this.results.firstChild;Eden.DB.searchComments(eden.project,e,1,100,n,function(e){if(e){for(var o=0;o<e.length;o++){var a=document.createElement("div"),r=document.createElement("div"),d=e[o].date.split(/[- :]/);r.className="feedback-header",r.innerHTML='<span class="feedback-author">'+e[o].name+'</span><span class="feedback-date" data-date="'+e[o].date+'">'+get_time_diff(new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5]).getTime()/1e3)+(e[o].author==Eden.DB.userid?'</span><span class="feedback-delete" data-id="'+e[o].commentID+'">&#xf00d;</span>':""),a.appendChild(r);var l=document.createElement("div");l.style.padding="0",l.style.marginBottom="3px",l.className="markdown",a.appendChild(l),a.className="feedback-result"+(n?" newitem":""),l.innerHTML=i.makeHtml(e[o].comment),s?t.results.insertBefore(a,s):t.results.appendChild(a),$(l).find("code").each(function(e,t){"PRE"==t.parentNode.nodeName&&(t.innerHTML=EdenUI.Highlight.html(t.textContent,!1,!0))})}t.cache=e.concat(t.cache)}})};