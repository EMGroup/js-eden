!function(a){function b(a,b,c,d){function e(){f.insertBefore(b,g)}var f=b.parentNode,g=b.nextSibling;f&&(f.removeChild(b),"boolean"!=typeof c&&(d=c,c=!1),d&&c?d.call(a,b,e):d&&(d.call(a,b),e()))}var c={apply:!0,array:!0,canvasURL:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,doDefault:!0,edenCode:!0,escapeRE:!0,foldl:!0,foldr:!0,hasProperty:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,positionInList:!0,positionOfRE:!0,substringPosition:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,distanceMoved:!0,angleTurned:!0,List:!0,listcat:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,Menu:!0,MenuItem:!0,min:!0,mod:!0,nameof:!0,partApply:!0,Point:!0,pow:!0,properties:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,RE:!0,replaceFirst:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundMultiple:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sort:!0,str:!0,sqrt:!0,strcat:!0,sublist:!0,substitute:!0,substr:!0,sum:!0,tail:!0,trim:!0,type:!0,uppercase:!0,include_css:!0,html:!0,time:!0,execute:!0,Text:!0,textWidth:!0,textHeight:!0,Arc:!0,Curve:!0,FillPattern:!0,Ellipse:!0,Line:!0,LinearGradient:!0,LineSequence:!0,PixelList:!0,GreyPixelList:!0,Rectangle:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,CombinedRotation:!0,Scale:!0,Translate:!0,RoundedRectangle:!0,Polygon:!0,RegularPolygon:!0,Sector:!0,Shadow:!0,Circle:!0,Button:!0,Checkbox:!0,Div:!0,Image:!0,imageWithZones:!0,HTMLImage:!0,RadioButtons:!0,Slider:!0,Textbox:!0,DropDownList:!0,Combobox:!0,BulletSlide:!0,Video:!0,Audio:!0,Slide:!0,TitledSlide:!0,TitleSlide:!0,cos:!0,sin:!0,tan:!0,abs:!0,acos:!0,asin:!0,atan:!0,ceil:!0,roundUp:!0,exp:!0,floor:!0,roundDown:!0,log:!0,random:!0,forget:!0,forgetAll:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observableOnTopAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnBottomAt:!0,shapesAt:!0,zonesAt:!0,observablesAt:!0,observableForShape:!0,alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showObservables:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0},d={autocalc:!0,mouseX:!0,mouseY:!0,mousePosition:!0,screenHeight:!0,screenWidth:!0,PI:!0},e={true:!0,false:!0,green:!0},f={var:!0,if:!0,while:!0,typeof:!0,this:!0,function:!0,return:!0,else:!0,break:!0,continue:!0,switch:!0,for:!0,prototype:!0};EdenUI.Highlight=function(a){this.ast=void 0,this.outelement=a,this.line=1,this.currentline=-1,this.mode=0,this.mode_at_line={}},EdenUI.Highlight.isType=function(a){return!1},EdenUI.Highlight.prototype.highlightLine=function(a,b){var g=-1,h=-1,i="",j=!1,k=a.stream,l=!1,m="INVALID",n="INVALID",o=[];this.mode_at_line[this.line-1]?this.mode=this.mode_at_line[this.line-1]:this.mode=0,a.script.errors.length>0&&(g=a.script.errors[0].prevposition,h=a.script.errors[0].position,i=a.script.errors[0].messageText());for(var p="",q=document.createElement("span");;){if(6==this.mode&&(this.mode=0,q=o.pop()),k.position==b){if(""!=p){var r=document.createTextNode(p);q.appendChild(r),p=""}var s=document.createElement("span");s.className="fake-caret",q.appendChild(s)}var t=k.peek();if(10==t){if(""!=p){var r=document.createTextNode(p);q.appendChild(r),p=""}break}if(9!=t&&13!=t&&32!=t&&160!=t){if(""!=p){8==this.mode&&(q=o.pop(),this.mode=1);var r=document.createTextNode(p);q.appendChild(r),p=""}if(n=m,m=k.readToken(),"string"!=typeof m&&console.error("Token error: line = "+this.line+" position = "+k.position),"EOF"==m){if(""!=p){var r=document.createTextNode(p);q.appendChild(r),p=""}break}if("INVALID"!=m){var u=k.tokenType(m),v="",w=k.tokenText();if(g!=-1&&(g<=k.prevposition&&!j&&(j=!0),h<=k.prevposition&&j&&(j=!1),j&&(l=!0)),j&&"EOF"!=a.script.errors[0].token&&(v+="eden-error "),0==this.mode||5==this.mode)if("##"==m){v+="eden-comment";for(var x="";k.valid()&&10!=k.peek();)x+=String.fromCharCode(k.get());w="##"+x}else if("local"==m||"auto"==m||"para"==m)v+="eden-storage";else if("keyword"==u)v+="eden-keyword","import"==k.data.value&&(this.mode=7);else if("NUMBER"==m)v+="eden-number";else if("STRING"==m)v+="eden-string";else if("CHARACTER"==m)v+="eden-string";else if("BOOLEAN"==m)v+="eden-constant";else if("OBSERVABLE"==m)v+=c[k.data.value]?"eden-function":EdenUI.Highlight.isType(k.data.value)?"eden-type":e[k.data.value]?"eden-constant":d[k.data.value]?"eden-special":"eden-observable";else if("`"==m)if(5==this.mode)this.mode=6;else{this.mode=5,o.push(q);var y=document.createElement("span");y.className="eden-backticks",q.appendChild(y),q=y}else"${{"==m?(v+="eden-javascript",this.mode=4):"-"==m&&k.isNumeric(k.peek())?(m=k.readToken(),w="-"+k.tokenText(),v+="eden-number"):"/*"==m?(this.mode=2,v+="eden-comment"):v+="eden-operator";else if(1==this.mode||7==this.mode||8==this.mode){if(7==this.mode){o.push(q);var y=document.createElement("span");y.className="eden-pathblock",q.appendChild(y),q=y,this.mode=8}";"==m?(8==this.mode&&(q=o.pop()),this.mode=0,v+="eden-operator"):v+=Language.importoptions[k.data.value]?"eden-importopt":"eden-path"}else 2==this.mode?"*/"==m?(this.mode=0,v+="eden-comment"):"@"==m?(this.mode=3,v+="eden-doxytag"):v+="eden-comment":3==this.mode?(this.mode=2,v+=Language.doxytags[k.data.value]?"eden-doxytag":"eden-doxytagerror"):4==this.mode&&(v+=("OBSERVABLE"==m||"keyword"==u)&&f.hasOwnProperty(k.data.value)?"eden-javascript-bold":"eden-javascript","}}$"==m&&(this.mode=0));if(k.prevposition<b&&k.position>b){var s=b-k.prevposition,z=w.slice(0,s),A=w.slice(s),B=document.createElement("span");B.className=v,"eden-observable"==v&&B.setAttribute("data-observable",w);var C=document.createElement("span");C.appendChild(document.createTextNode(z)),B.appendChild(C);var s=document.createElement("span");s.className="fake-caret",B.appendChild(s),C=document.createElement("span"),C.appendChild(document.createTextNode(A)),B.appendChild(C),q.appendChild(B)}else{var C=document.createElement("span");C.className=v,"eden-observable"==v&&C.setAttribute("data-observable",w),C.appendChild(document.createTextNode(w)),q.appendChild(C)}}else console.log("INVALID: "+k.peek()),k.skip()}else k.skip(),32==t||160==t?p+=" ":13!=t&&(p+=String.fromCharCode(t))}return o.length>0&&(q=o[0],this.mode=0),this.mode_at_line[this.line]=this.mode,q},EdenUI.Highlight.prototype.highlight=function(a,c,d){this.ast=a,this.line=1;var e=-1,f=-1,g="",h=a.stream;if(void 0!==this.outelement){if(0==a.stream.code.length)return void(this.outelement&&(this.outelement.innerHTML="<div class='eden-line'><span class='fake-caret'></span></div>"));a.script.errors.length>0&&(e=a.script.errors[0].prevposition,f=a.script.errors[0].position,g=a.script.errors[0].messageText()),h.reset();var i=void 0,j=!1,k=0;if(c==-1)b(this,this.outelement,!1,function(){for(this.outelement.innerHTML="",this.mode_at_line={};h.valid();){var b=h.peek();if(10!=b)i=this.highlightLine(a,d);else{j=k<=e&&h.position>=f;var c=document.createElement("div");c.className="eden-line",c.setAttribute("data-line",this.line-1),this.line++,void 0!==i?c.appendChild(i):this.mode_at_line[this.line-1]=this.mode;var g=document.createTextNode("\n");c.appendChild(g),this.outelement.appendChild(c),k=h.position+1,i=void 0,h.skip()}}if(j=k<=e&&h.position>=f,void 0!==i){var c=document.createElement("div");c.className="eden-line",c.setAttribute("data-line",this.line-1),c.appendChild(i),this.outelement.appendChild(c)}else{var c=document.createElement("div");if(d>=h.position){c.className="eden-line",c.setAttribute("data-line",this.line-1);var l=document.createElement("span");l.className="fake-caret",c.appendChild(l)}else c.className="eden-line";this.outelement.appendChild(c)}});else{for(;h.valid()&&this.line<c-1;){var l=h.peek();10==l&&this.line++,h.skip()}for(var m=2;m>=0;m--){this.line=c-m+1;var n=this.outelement.childNodes[c-m];if(void 0!==n){for(;n.firstChild;)n.removeChild(n.firstChild);k=h.position,i=this.highlightLine(a,d),j=k<=e&&h.position>=f,n.appendChild(i);var o=document.createTextNode("\n");n.appendChild(o),h.skip()}}}}}}("undefined"!=typeof window?window:global),EdenUI.ContextMenu=function(a){this.element=$('<div class="eden-contextmenu"></div>'),this.origin=a,this.target=void 0,this.items=[],$(document.body).append(this.element);var b=this;this.element.on("mousedown",".eden-contextmenu-item",function(a){var c=parseInt(a.currentTarget.getAttribute("data-index"));b.items[c].action&&b.items[c].action(b.target)}),this.origin.oncontextmenu=function(a){b.target=a.target;var c=document.body.scrollLeft+a.clientX;c+150>=screen.width&&(c-=c+150-screen.width),b.element.css("top",""+(document.body.scrollTop+a.clientY+10)+"px"),b.element.css("left",""+c+"px");for(var d=0;d<b.items.length;d++){var e;e="function"==typeof b.items[d].status?b.items[d].status(a.target):b.items[d].status,changeClass(b.items[d].element,"disabled",!e)}b.element.slideDown(100),a.preventDefault()},document.addEventListener("mousedown",function(){b.element.hide()},!0)},EdenUI.ContextMenu.prototype.addItem=function(a,b,c,d){var e=$('<div class="eden-contextmenu-item"><span class="eden-contextmenu-icon">'+a+"</span><span>"+b+"</span></div>");e.get(0).setAttribute("data-index",""+this.items.length),this.element.append(e),this.items.push({status:c,action:d,element:e.get(0)})},EdenUI.ContextMenu.prototype.addSeparator=function(){var a=$('<div class="eden-contextmenu-sep"></div>');this.element.append(a)},EdenUI.MenuBar=function(){function a(){var a=p.sharebox.find(".projecttags"),b=a.get(0).textContent;if(tags=b.toLowerCase().replace(/[\!\'\-\?\&]/g,"").split(" "),tags&&tags.length>0){for(var c="",d=0;d<tags.length;d++)c+='<span class="project-tag">'+tags[d]+"</span>",d<tags.length-1&&(c+=" ");a.html(c)}}function b(){$(".menubar-menu").hide(),x=!1;var a=$("#menubar-mainitem-views");a.children().css("display","")}function c(a){var b=$("#menubar-mainitem-"+a);b.show(),x=!0}function d(){var a=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(edenUI.activeDialogs).length&&a.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function e(a){b();var c=edenUI.eden.root,d=c.lookup("mouseFollow").value(),e=c.lookup("_views_number_created"),f=e.value()+1;e.assign(f,c.scope,Symbol.hciAgent,!0);var g=this.view,h=g.slice(0,1).toLowerCase()+g.slice(1)+f;d?edenUI.eden.execute('createView("'+h+'", "'+g+'");'):edenUI.createView(h,g),p.updateViewsMenu()}function f(a){var c=this.parentNode.viewname;edenUI.viewInstances[c].confirmClose&&b(),edenUI.closeView(c),d()}function g(a){var b=a.currentTarget.children[0],c=this.parentNode.viewname;edenUI.viewInstances[c].pinned?(edenUI.unpinView(c),b.src=o):(edenUI.pinView(c),b.src=n)}function h(a){for(var b=$("<div class='menubar-item'></div>"),c=0;c<a.length;++c)b.append(a[c]);return b}function i(a,b){return $('<div class="'+a+' menubar-item-clickable">'+b+"</div>")}function j(a){return $("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+a+"</div></div>")}function k(a){return{mouseover:function(b){edenUI.highlightView(a,!0)},mouseout:function(b){edenUI.stopHighlightingView(a,!0,!1)},click:function(c){edenUI.stopHighlightingView(a,!0,!0),b()}}}function l(a){return a&&"false"!=a?'checked="checked"':""}function m(a,b,c,d){var e=edenUI.getOptionValue(a);null===e&&(e=c);var f=i("menubar-item-input",'<input id="menu-'+a+'" type="checkbox"'+l(e)+" />"),g=f.get(0).children[0],j=i("menubar-item-label",b),k=h([f,j]);k.click(function(b){b.target!=g&&(g.checked=!g.checked),edenUI.setOptionValue(a,g.checked)}),edenUI.listenTo("optionChange",void 0,function(b,c){if(b==a){var e="true"===c;g.checked=e,d&&d(a,e)}}),k.appendTo(y)}var n="images/pin.png",o="images/pin-greyed.png",p=this;this.itemViews={},eden.execute2("_views_number_created = 0;","*Default"),this.element=$('<div id="menubar-main"><div id="eden-logo"></div><div contenteditable class="jseden-title">Construit!</div>'+(mobilecheck()?'<div class="menubar-mobilebuttons"><button class="scriptview-button enabled mobilemore">&#xf078;</button></div>':'<div class="menubar-buttons"><div class="menubar-button enabled share" data-obs="menu_new_scriptview" title="Save or share">&#xf1e0;</div><div class="menubar-button enabled main" data-obs="views" title="Create Views">&#xf067;<div id="menubar-mainitem-views" class="menubar-menu"></div></div><div class="menubar-button enabled main" data-obs="existing" title="Existing">&#xf24d;<div id="menubar-mainitem-existing" class="menubar-menu"></div></div><div class="menubar-button enabled main" data-obs="options" title="Options">&#xf013;<div id="menubar-mainitem-options" class="menubar-menu"></div></div><div class="menubar-button enabled main" data-obs="help" title="Help">&#xf128;<div id="menubar-mainitem-help" class="menubar-menu"></div></div><div class="menubar-button enabled main notifications" data-obs="notifications">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div></div>')+"</div>"),$(document.body).append(this.element);var q=$('<div id="menubar-login"><span class="icon">&#xf05e;</span>Not Connected</div>');q.appendTo(this.element);var r=new EdenUI.ContextMenu(q.get(0));r.addItem("&#xf08b;","Log out",function(){return Eden.DB.isLoggedIn()},function(){Eden.DB.logOut(function(){$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/login" target="logintarget"><span class="icon">&#xf090;</span>Login</a>')})}),edenUI.listenTo("loadPlugin",this,function(a,b){this.updateViewsMenu()}),edenUI.listenTo("createView",this,function(a,b){this.updateViewsMenu()}),edenUI.listenTo("destroyView",this,function(a){$(this.itemViews[a]).remove(),delete this.itemViews[a],d()}),Eden.DB.listenTo("connected",this,function(a){$("#menubar-login").html('<a href="'+a+'/login" target="logintarget"><span class="icon">&#xf090;</span>Login</a>')}),Eden.DB.listenTo("disconnected",this,function(){$("#menubar-login").html('<span class="icon">&#xf05e;</span>Not Connected'),p.notification("info",$('<div class="notification-content">Disconnected</div>'))}),Eden.DB.listenTo("login",this,function(a){a&&(setTimeout(function(){$("#menubar-obscurer").remove()},1e3),$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/#" target="_blank"><span class="icon">&#xf007;</span>'+a+"</a>"))}),Eden.Peer.listenTo("user",void 0,function(a,b){p.notification("net",$('<div class="notification-content">User \'<a href="javascript:eden.peer.showConnection(\''+a+"');\">"+b+"</a>' connected to you.<br/><a href=\"javascript: eden.peer.requestShare('"+a+"');\">Watch</a> <a href=\"javascript: eden.peer.requestObserve('"+a+"');\">Broadcast</a> <a href=\"javascript: eden.peer.requestCollaborate('"+a+"');\">Collaborate</a></div>"))}),Eden.Peer.listenTo("share",void 0,function(a,b){p.notification("net",$('<div class="notification-content">Your model is being shared...</div>'))}),Eden.Peer.listenTo("disconnect",void 0,function(a,b){b?p.notification("net",$('<div class="notification-content">User \''+b+"' disconnected.</div>")):p.notification("net",$('<div class="notification-content">P2P User disconnected.</div>'))}),Eden.Peer.listenTo("error",void 0,function(a){p.notification("error",$('<div class="notification-content">P2P: '+a+"</div>"))}),Eden.Agent.listenTo("error",void 0,function(a,b){if(b){var c=("runtime"==b.type?"Runtime error":"Syntax error")+" in "+a.name+":"+(b.line!=-1?b.line:"")+" -> "+b.messageText(),d="<a href=\"javascript:edenUI.gotoCode('"+a.name+"',"+b.line+');">'+a.name+":"+(b.line!=-1?b.line+1:"")+"</a> "+b.messageText();if(console.error(c),!a.owned||"syntax"!=b.type){var e=$('<pre class="error-item">'+d+"</pre>\n\n");e.on("click",function(){var a="";if(!b.statement||"definition"!=b.statement.type&&"assignment"!=b.statement.type||(a+="    <b>Symbol:</b> "+b.statement.lvalue.name+"\n"),b.lastsymbol&&(a+="    <b>Related Symbol:</b> "+b.lastsymbol+"\n"),String(b.extra).search("SyntaxError")>=0)a+="    <b>JavaScript:</b> "+b.javascriptSource()+"\n",e.html(d+"\n"+a);else if(a+="    <b>Source:</b> <div class='error-source'</div>\n",e.html(d+"\n"+a),b.statement){var c=new Eden.AST(b.edenSource()),f=new EdenUI.Highlight(e.find(".error-source").get(0));f.highlight(c,-1,-1)}}),p.notification("error",e)}}}),$("#menubar-login").click(function(){if(Eden.DB.isConnected()&&!Eden.DB.isLoggedIn()){var a=$('<div id="menubar-obscurer" class="login-subdialog modal" style="display: block;"></div>');a.html('<div class="modal-content" style="width: 290px;"><div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf090;</span>Login</div><iframe frameborder="0" name="logintarget" width="250" height="200" class="menubar-login-iframe"></iframe><br/><button class="jseden button-cancel">Cancel</button></div>'),$(document.body).append(a),a.on("click",".button-cancel",function(){a.remove()})}else Eden.DB.isConnected()&&Eden.DB.isLoggedIn()}),this.sharebox=$('<div class="modal"><div class="modal-content" style="width: 400px;"><div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf1e0;</span>Save and Share</div><div class="menubar-sharebox-content"><div id="projectoptions"></div><div id="projectuploadbox"></div><br/><br/>Download to file: <span class="downloadurl"></span><br/><br><button class="jseden done" style="margin-top: 20px;">Finished</button></div></div></div>'),this.element.append(this.sharebox),this.sharebox.hide();var s=this.sharebox.find("#projectoptions");s.html('<h3>Tags</h3><div>Add tags to your project:<div class="projecttags" contenteditable></div></div><h3>Thumbnail</h3><div><input class="thumbnailtype" type="radio" name="thumbnail" value="auto" checked>Default</input><input class="thumbnailtype" type="radio" name="thumbnail" value="canvas">Canvas</input><input class="thumbnailtype" type="radio" name="thumbnail" value="manual">File</input><div id="projectthumb"></div></div><h3>Description</h3><div><textarea></textarea></div>'),s.accordion({collapsible:!0,heightStyle:"content",classes:{"ui-accordian-header":"ui-corner-top sharebox-header","ui-accordian-header-collapsed":"ui-corner-all sharebox-header-collapsed"}});var t,u=s.find("#projectthumb"),v=$("<img></img>");u.append(v);var p=this;if(mobilecheck()){var w=new EdenUI.ContextMenu(this.element.find(".mobilemore").get(0));w.addItem("&#xf1e0;","Share",!0,function(a){p.script.stickAll()}),w.addItem("&#xf121;","New Script View",!0,function(a){p.script.unstickAll()}),w.addItem("&#xf022;","New Observable Lists",!0,function(a){p.script.clearUnstuck()}),w.addItem("&#xf03e;","New Graphic View",!0,function(a){p.script.activateAll()}),this.element.on("click",".mobilemore",function(a){p.element.find(".mobilemore").get(0).oncontextmenu(a)})}this.sharebox.on("click",".done",function(){p.sharebox.hide()}),this.sharebox.on("change",".thumbnailtype",function(a){var b=a.currentTarget.value;if("manual"==b){u.html("");var c=$('<input type="file"></input>');u.append(c),c.change(function(){u.html("");var a=c.get(0),b=a.files[0],d=new FileReader;d.onload=function(a){var b=document.createElement("canvas");b.setAttribute("width","200"),b.setAttribute("height","112");var c=b.getContext("2d"),d=new Image;d.src=a.target.result;var e,f,g,h,i=d.width,j=d.height,k=200,l=112,m=i/j,n=k/l;m<n?(e=l,f=i*(e/j),g=(k-f)/2,h=0):m>n?(f=k,e=j*(f/i),g=0,h=(l-e)/2):(e=l,f=k,g=0,h=0),c.drawImage(d,g,h,f,e);var o=b.toDataURL("image/png");t=o;var p=$("<img></img>");u.append(p),p.get(0).src=o},d.readAsDataURL(b)})}else if("canvas"==b)u.html(""),t=void 0;else if("auto"==b){u.html("");var d=$("<img></img>");u.append(d),edenUI.plugins.Canvas2D.thumbnail(function(a){t=a,d.get(0).src=a})}}),this.sharebox.on("keydown",".projecttags",function(a){if(32==a.keyCode){var b=p.sharebox.find(".projecttags").get(0),c=document.createTextNode(" ");b.appendChild(c);var d=document.createElement("span");d.className="project-tag",d.innerHTML="&#8203;",b.appendChild(d);var e=document.createRange(),f=window.getSelection();e.selectNodeContents(d),e.collapse(!1),f.removeAllRanges(),f.addRange(e),a.preventDefault()}}),this.sharebox.on("blur",".projecttags",a),this.sharebox.on("click",".upload",function(a){var b=p.element.find(".jseden-title").get(0).textContent,c=p.sharebox.find(".projecttags"),d=c.get(0).textContent;d=d.toLowerCase().replace(/[\!\'\-\?\&]/g,"").split(" "),p.sharebox.find("#projectuploadbox").html('<br/><br/>Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.saveSource(b,p.projectsource,function(a){if(a.path){var b="?load="+a.path+"&tag="+a.saveID;p.sharebox.find(".projecturl").html(window.location.href+b);var c=document.createRange();c.selectNodeContents(p.sharebox.find(".projecturl").get(0));var d=window.getSelection();d.removeAllRanges(),d.addRange(c)}else p.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")},{thumb:t,tags:d})}),this.sharebox.on("click",".publish",function(a){var b=p.element.find(".jseden-title").get(0).textContent,c=p.sharebox.find(".projecttags"),d=c.get(0).textContent;d=d.toLowerCase().replace(/[\!\'\-\?\&]/g,"").split(" "),p.sharebox.find("#projectuploadbox").html('<br/><br/>Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.saveSource(b,p.projectsource,function(a){if(a.path){var b="?load="+a.path+"&tag="+a.saveID;p.sharebox.find(".projecturl").html(window.location.href+b);var c=document.createRange();c.selectNodeContents(p.sharebox.find(".projecturl").get(0));var d=window.getSelection();d.removeAllRanges(),d.addRange(c)}else p.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")},{publish:!0,thumb:t,tags:d})}),this.element.on("click",".menubar-button.share",function(a){var b=p.element.find(".jseden-title").get(0).textContent;Eden.DB.isLoggedIn()?p.sharebox.find("#projectuploadbox").html('<button class="sharebox-button upload">Upload</button><button class="sharebox-button publish" style="margin-top: 20px;">Publish</button>'):p.sharebox.find("#projectuploadbox").html(""),p.sharebox.show(),edenUI.plugins.Canvas2D.thumbnail(function(a){v.get(0).src=a,t=a});var c;if((void 0===c||0==c.length)&&(c=b.toLowerCase().replace(/[\!\'\-\?\&]/g,"").split(" "),Eden.DB.isLoggedIn())){var d=Eden.DB.username.toLowerCase().replace(/[\!\'\-\?\&]/g,"").split(" ");c.push.apply(c,d)}if(c&&c.length>0){for(var e="",f=0;f<c.length;f++)e+='<span class="project-tag">'+c[f]+"</span>",f<c.length-1&&(e+=" ");p.sharebox.find(".projecttags").html(e)}p.projectsource=Eden.DB.generateSource(b);var g="data:application/octet-stream,"+encodeURIComponent(p.projectsource);p.sharebox.find(".downloadurl").html('<a href="'+g+'" download="'+b+'.js-e">'+b+".js-e</a>")});var x=!1;$(document.body).on("mousedown",function(){b()}),this.element.on("mousedown",".menubar-button.main",function(a){var d=a.currentTarget.getAttribute("data-obs");x?a.target===this&&b():(b(),c(d)),a.stopPropagation()}),this.element.on("mouseenter",".menubar-button.main",function(a){var d=a.currentTarget.getAttribute("data-obs");x&&(b(),c(d))}),this.updateViewsMenu=function(){var a=$("#menubar-mainitem-views"),b=$("#menubar-mainitem-existing");a.html("");var c=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),l=c[0],m=$('<div class="menubar-item-fullwidth"></div>');m.append(c);var q=$("<div class='menubar-item-search'></div>");q.append(m),l.search=function(){var b,c=l.value,d=new RegExp("(^|\\s)"+c,"i"),e=!1;a.children().each(function(a,f){if(!f.classList.contains("menubar-item-search")){var g=f.children[0],h=g.innerHTML,i=g.classList.contains("menubar-item-separator");i?(c.length>1&&(e=d.test(h)),b=f,e?f.style.display="":f.style.display="none"):e?f.style.display="":d.test(h)?(f.style.display="",b.style.display=""):f.style.display="none"}})},c.on("input",l.search);var r,s,t,u,v,w,x=[];for(s in edenUI.views){var y=edenUI.views[s],z=y.title,A=y.category.getLabel(),B=y.category.getMenuPriority(),C=y.menuPriority;u=i("menubar-item-fullwidth menubar-view",z),t=h([u]),t[0].view=s,t.click(e),x.push({title:z,viewEntry:t,categoryLabel:A,categoryPriority:B,itemPriority:C})}x=x.sort(function(a,b){if(a.categoryPriority!=b.categoryPriority)return a.categoryPriority-b.categoryPriority;if(void 0!==a.itemPriority){if(void 0===b.itemPriority)return-1;if(a.itemPriority!=b.itemPriority)return a.itemPriority-b.itemPriority}else if(void 0!==b.itemPriority)return 1;return a.title>b.title?1:a.title<b.title?-1:0});for(var D,E=0;E<x.length;++E){var F=x[E],G=F.categoryLabel;if(D!=G){var H=j(G);H.appendTo(a),D=G}F.viewEntry.appendTo(a)}a.append(q),b.html(""),p.itemViews={},d();for(r in edenUI.activeDialogs){var I=k(r),z=edenUI.eden.root.lookup("_view_"+r+"_title").value();u=i("menubar-item-label",z+' <span class="menubar-view-name">['+r+"]</span>"),u.click(I.click);var J;J=edenUI.viewInstances[r].pinned?n:o,v=i("menubar-item-pin",'<img src="'+J+'" width="18" height="18" class="menubar-item-pin-icon"/>'),v.click(g),w=i("menubar-item-close",'<div class="menubar-item-close-icon">X</div>'),w.click(f),t=h([u,v,w]),t.bind("mouseover",I.mouseover),t.bind("mouseout",I.mouseout),t[0].viewname=r,t.appendTo(b),p.itemViews[r]=t[0]}},this.updateViewsMenu();var y=$("#menubar-mainitem-options");m("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(a,b){b?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),m("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),m("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),m("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(a,b){var c;c=b?"collapse":"maximize",$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",c)})}),m("developer",Language.ui.menu_bar.opt_debug,!1,function(a,c){var d;d=c?"/index-dev.html":"/index.html";var e=document.location.pathname;d=e.slice(0,e.lastIndexOf("/"))+d,d!=document.location.pathname?(b(),edenUI.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(a){if(0==a)window.onbeforeunload=void 0,document.location.pathname=d;else if(1==a)root.lookup("debug").mutate(root.scope,function(a){a.cache.value.jsExceptions=c},Symbol.hciAgent);else{var b=document.getElementById("menu-developer");b.checked=!b.checked,edenUI.setOptionValue("developer",b.checked)}})):root.lookup("debug").mutate(root.scope,function(a){a.cache.value.jsExceptions=c},Symbol.hciAgent)}),this.element.on("keyup",".jseden-title",function(a){try{window.localStorage&&window.localStorage.setItem("title",a.currentTarget.textContent)}catch(a){}}),eden.root.lookup("_jseden_project_title").addJSObserver("menubar",function(a,b){$(".jseden-title").get(0).textContent=b;try{window.localStorage&&window.localStorage.setItem("title",b)}catch(c){}}),this.notificationCount=0,this.notificationCountElement=this.element.find(".menubar-notification-jewel"),this.notificationCountElement.hide(),this.notificationPanel=this.element.find("#menubar-mainitem-notifications"),this.notificationPanel.html('<button class="control-button close-button control-enabled">&#xf00d;</button><button class="control-button clear-button control-enabled">&#xf05e;</button><div id="errors-dialog"></div>'),this.notificationPanel.on("click",".close-button",function(){p.notificationPanel.hide()}).on("click",".clear-button",function(){p.notificationPanel.find("#errors-dialog").html("")}),this.notificationPanel.hide(),this.notificationContent=this.notificationPanel.find("#errors-dialog"),this.element.on("click",".notifications",function(a){p.notificationCountElement.hide(),p.notificationCount=0})},EdenUI.MenuBar.prototype.notification=function(a,b){this.notificationCount++,this.notificationCountElement.html(this.notificationCount),this.notificationCountElement.show();var c;"error"==a?(c=$('<div class="notification-item error"></div>'),c.append($('<div class="notification-error"><span style="vertical-align: middle;">&#xf06a;</span></div>'))):(c=$('<div class="notification-item"></div>'),c.append($('<div class="notification-icon"><span style="vertical-align: middle;">&#xf0c1;</span></div>'))),c.append(b),this.notificationContent.prepend(c),this.notificationContent.prop("scrollTop",0)},EdenUI.MenuBar.reset=function(){$(".jseden-title").html("Construit!")},EdenUI.MenuBar.saveTitle=function(a){eden.root.lookup("_jseden_project_title").assign(a,eden.root.scope,Symbol.jsAgent)},EdenUI.Dialogs={},EdenUI.Dialogs.MergeError=function(a,b,c){var d=new diff_match_patch,e=d.diff_main(a,b);d.diff_cleanupSemantic(e);var f=d.diff_prettyHtml(e),g=$('<div title="Import Merge Conflict">'+f+"</div>");g.dialog({resizable:!0,height:"auto",width:600,modal:!0,buttons:{"Use Mine":function(){c&&c("old"),$(this).dialog("close")},"Use New":function(){c&&c("new"),$(this).dialog("close")},Merge:function(){c&&c("merge"),$(this).dialog("close")}}})};