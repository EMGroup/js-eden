!function(e){EdenUI.Highlight=function(e,t){this.ast=void 0,this.outelement=e,this.line=1,this.currentline=-1,this.mode_at_line={},this.heredocend=void 0,this.scrolltop=-1,this.token=void 0,this.prevtoken=void 0,this.prevprevtoken=void 0,this.modestack=[],this.linestack=void 0,this.outerline=void 0,this.lineelement=void 0,this.startmode=t&&t.start?t.start:"START",this.styles=t&&t.styles?t.styles:EdenUI.Highlight.defaultStyles,this.clearmodes=t&&t.clearmodes?t.clearmodes:EdenUI.Highlight.lineclearmode,this.mode=this.startmode,this.incomment=!1,this.brline=t&&t.brline,this.custom={},this.current_custom=null,this.cs3=eden.root.lookup("jseden_parser_cs3").value(),this.styleExtensions={},this.metrics={}},EdenUI.Highlight.defaultStyles={comment:"eden-comment","hidden-comment":"eden-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",parameter:"eden-parameter",keyword:"eden-keyword",builtin:"eden-builtin",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",selector4:"eden-selector4",error:"eden-selectorerror",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",subexpr:"eden-subexpression",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"eden-comment-h1","comment-h2":"eden-comment-h2","comment-h3":"eden-comment-h3","comment-h4":"eden-comment-h4","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"eden-line-script",doxytag:"eden-doxytag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote",script:"eden-script",notexist:"eden-notexist",htmltag:"html-tagname",htmlattribute:"html-attributename"},EdenUI.Highlight.prototype.pushLine=function(){this.linestack.push(this.lineelement)},EdenUI.Highlight.prototype.pushMode=function(){this.modestack.push(this.mode)},EdenUI.Highlight.prototype.popLine=function(){this.linestack.length>0&&(this.lineelement=this.linestack.pop())},EdenUI.Highlight.prototype.popMode=function(){this.modestack.length>0&&(this.mode=this.modestack.pop())},EdenUI.Highlight.prototype.setScrollTop=function(e){this.scrolltop=e},EdenUI.Highlight.isType=function(e){return!1},EdenUI.Highlight.lineclearmode={COMMENT:!0,SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE3:!0,SECTION_TITLE4:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,SECTION_TITLE_H3:!0,SECTION_TITLE_H4:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,COMMENT_BOLD_END:!0,COMMENT_QUERY:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0,COMMENT_HTML:!0,COMMENT_HTML_START:!0,COMMENT_HTML_CONTENT:!0,COMMENT_ATTRS:!0},EdenUI.Highlight.prototype.applyClasses=function(e,t){for(var i=t||this.classes,n="",s=0;s<i.length;s++)if(n+=this.styles[i[s]]+" ",this.styleExtensions[i[s]]){var o=this.styleExtensions[i[s]];for(var a in o)this.applyAttribute(e,a,o[a])}e.className=n.trim()},EdenUI.Highlight.prototype.generateClasses=function(){for(var e="",t=0;t<this.classes.length;t++)e+=this.styles[this.classes[t]]+" ";return e.trim()},EdenUI.Highlight.prototype.highlightLine=function(e,t){var i=-1,n=-1,s=!1,o=e.stream;this.stream=o;var a="INVALID",r="INVALID",d="INVALID";this.outerline="eden-line",this.linestack=[],this.mode_at_line[this.line-1]?this.mode=this.mode_at_line[this.line-1]:this.mode=this.startmode,this.clearmodes[this.mode]&&(this.incomment=!1,this.mode=this.startmode),e.script&&e.script.errors.length>0&&(i=e.script.errors[0].prevposition,n=e.script.errors[0].position,e.script.errors[0].messageText());var l="",c=document.createElement("div");for(c.className=this.styles["script-line"];;){if(o.position==t){if(""!=l){var h=document.createTextNode(l);c.appendChild(h),l=""}(m=document.createElement("span")).className="fake-caret",c.appendChild(m);for(var p=c;p&&"DIV"!=p.nodeName;)p=p.parentNode;p&&p.className.startsWith(this.styles["comment-line"])&&(p.className+=" current")}var u=o.peek();if(10==u||13==u){if(""!=l){if(c.lastChild&&c.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=c.lastChild.className)if(c.lastChild.lastChild&&"#text"==c.lastChild.lastChild.nodeName)c.lastChild.lastChild.textContent+=l;else{h=document.createTextNode(l);c.lastChild.appendChild(h)}else{h=document.createTextNode(l);c.appendChild(h)}l=""}break}if(9!=u&&13!=u&&32!=u&&160!=u){if(""!=l){if(c.lastChild&&c.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=c.lastChild.className)if(c.lastChild.lastChild&&"#text"==c.lastChild.lastChild.nodeName)c.lastChild.lastChild.textContent+=l;else{h=document.createTextNode(l);c.lastChild.appendChild(h)}else{h=document.createTextNode(l);c.appendChild(h)}l=""}if(d=r,r=a,"string"!=typeof(a=o.readToken(this.incomment))&&console.error("Token error: line = "+this.line+" position = "+o.position),"EOF"==a){if(""!=l){if(c.lastChild&&c.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=c.lastChild.className)if(c.lastChild.lastChild&&"#text"==c.lastChild.lastChild.nodeName)c.lastChild.lastChild.textContent+=l;else{h=document.createTextNode(l);c.lastChild.appendChild(h)}else{h=document.createTextNode(l);c.appendChild(h)}l=""}break}if("INVALID"!=a)if(this.token=a,this.prevtoken=r,this.prevprevtoken=d,this.type=o.tokenType(a),this.classes=[],this.tokentext=o.tokenText(),this.lineelement=c,-1!=i&&(i<=o.prevposition&&!s&&(s=!0),n<=o.prevposition&&s&&(s=!1),s&&!0),s&&"EOF"!=e.script.errors[0].token&&this.classes.push("error"),void 0===this[this.mode]&&console.error("No Mode",this.mode),this[this.mode].call(this),c=this.lineelement,o.prevposition<t&&o.position>t){var m=t-o.prevposition,g=this.tokentext.slice(0,m),v=this.tokentext.slice(m),f=document.createElement("span");this.applyClasses(f),(b=document.createElement("span")).appendChild(document.createTextNode(g)),f.appendChild(b),(m=document.createElement("span")).className="fake-caret",f.appendChild(m),(b=document.createElement("span")).appendChild(document.createTextNode(v)),f.appendChild(b),c.appendChild(f);for(p=c;p&&"DIV"!=p.nodeName;)p=p.parentNode;p&&p.className.startsWith(this.styles["comment-line"])&&(p.className+=" current")}else if(c.lastChild&&c.lastChild.className==this.generateClasses()){(b=c.lastChild).lastChild&&"#text"==b.lastChild.nodeName?b.lastChild.textContent+=this.tokentext:b.appendChild(document.createTextNode(this.tokentext))}else{var b=document.createElement("span");this.applyClasses(b),b.appendChild(document.createTextNode(this.tokentext)),c.appendChild(b)}else console.log("INVALID: "+o.peek()),o.skip()}else o.skip(),32==u||160==u?l+=" ":13!=u&&(l+=String.fromCharCode(u))}return this.linestack.length>0&&(c=this.linestack[0]),this.mode_at_line[this.line]=this.mode,c},EdenUI.Highlight.prototype.updateAST=function(e){this.ast=e,this.errstart=-1,this.errend=-1,this.errmsg="",this.inerror=!1,this.stream=e.stream,this.stream.reset(),this.title="",e.script&&e.script.errors.length>0&&(this.errstart=e.script.errors[0].prevposition,this.errend=e.script.errors[0].position,this.errmsg=e.script.errors[0].messageText())},EdenUI.Highlight.prototype.highlightAll=function(e,t){var i=void 0,n=0,s=this.stream;this.cs3=eden.root.lookup("jseden_parser_cs3").value(),this.metrics={},this.styleExtensions={},function(e,t,i,n){var s=t.parentNode,o=t.nextSibling;function a(){s.insertBefore(t,o)}s?(s.removeChild(t),"boolean"!=typeof i&&(n=i,i=!1),n&&i?n.call(e,t,a):n&&(n.call(e,t),a())):n.call(e,t)}(this,this.outelement,!1,function(){for(;this.outelement.lastChild;)this.outelement.removeChild(this.outelement.lastChild);for(this.mode_at_line={};s.valid();){var o=s.peek();if(10!=o&&13!=o)if(this.disablehl||this.scrolltop>=0&&(this.line<this.scrolltop-105||this.line>this.scrolltop+105)){var a,r=s.code.indexOf("\n",s.position);-1==r?(a=s.code.substring(s.position),s.position=s.code.length):(a=s.code.substring(s.position,r),s.position=r),i=document.createTextNode(a),this.disablehl||"#"!=a.trim().charAt(0)||(this.outerline="eden-line eden-wrapline")}else i=this.highlightLine(this.ast,e);else{n<=this.errstart&&s.position>=this.errend,(l=document.createElement("div")).className=this.outerline,t&&t.spacing&&t.spacing[this.line]&&(l.height=t.spacing[this.line]+"px"),l.setAttribute("data-line",this.line-1),this.line++,void 0===i&&this.brline&&(i=document.createElement("br")),void 0!==i?l.appendChild(i):this.mode_at_line[this.line-1]=this.mode;var d=document.createTextNode("\n");l.appendChild(d),this.outelement.appendChild(l),n=s.position+1,i=void 0,s.skip(),13==o&&s.skip(),this.outerline="eden-line"}}if(n<=this.errstart&&s.position>=this.errend,void 0===i&&this.brline&&(i=document.createElement("br")),void 0!==i){(l=document.createElement("div")).className="eden-line",l.style.height=(t&&t.spacing&&t.spacing[this.line]?t.spacing[this.line]:20)+"px",l.setAttribute("data-line",this.line-1),l.appendChild(i),this.outelement.appendChild(l)}else{var l=document.createElement("div");if(e>=s.position){l.className="eden-line",l.style.height=(t&&t.spacing&&t.spacing[this.line]?t.spacing[this.line]:20)+"px",l.setAttribute("data-line",this.line-1);var c=document.createElement("span");c.className="fake-caret",l.appendChild(c)}else l.className="eden-line";this.outelement.appendChild(l)}})},EdenUI.Highlight.prototype.highlightOpt=function(e,t,i){for(var n=void 0,s=0,o=this.stream;o.valid()&&this.line<e-1;){10!=(g=o.peek())&&13!=g||this.line++,o.skip(),13==g&&o.skip()}for(var a=2;a>=0;a--){if(this.line=e-a+1,this.metrics[this.line]&&delete this.metrics[this.line],void 0!==(f=this.outelement.childNodes[e-a])){for(;f.lastChild;)f.removeChild(f.lastChild);if(s=o.position,this.disablehl){var r,d=o.code.indexOf("\n",o.position);if(-1==d?(r=o.code.substring(o.position),o.position=o.code.length):(r=o.code.substring(o.position,d),o.position=d),s<t&&o.position>t){var l=t-s,c=r.slice(0,l),h=r.slice(l),p=document.createElement("span"),u=document.createTextNode(c);p.appendChild(u),(l=document.createElement("span")).className="fake-caret",p.appendChild(l);var m=document.createTextNode(h);p.appendChild(m),n=p}else n=document.createTextNode(r)}else n=this.highlightLine(this.ast,t);s<=this.errstart&&o.position>=this.errend,f.appendChild(n),f.className=this.outerline;var g=o.peek(),v=document.createTextNode("\n");f.appendChild(v),o.skip(),13==g&&o.skip()}}if(!this.disablehl)for(;void 0!==this.mode_at_line[this.line+1]&&this.mode_at_line[this.line]!=this.mode_at_line[this.line+1];){var f;if(this.line++,this.metrics[this.line]&&delete this.metrics[this.line],void 0!==(f=this.outelement.childNodes[this.line-1])){for(;f.lastChild;)f.removeChild(f.lastChild);s=o.position,n=this.highlightLine(this.ast,t),s<=this.errstart&&o.position>=this.errend,f.appendChild(n),f.className=this.outerline;g=o.peek(),v=document.createTextNode("\n");f.appendChild(v),o.skip(),13==g&&o.skip()}}},EdenUI.Highlight.prototype.highlight=function(e,t,i,n){if(this.ast=e,this.updateAST(e),this.line=1,void 0!==this.outelement){if(0!=e.stream.code.length)return this.disablehl=!(!n||!n.disabled),-1==t?this.highlightAll(i,n):this.highlightOpt(t,i,n);this.outelement&&(this.outelement.innerHTML="<div class='eden-line'><span class='fake-caret'></span></div>")}},EdenUI.Highlight.html=function(e,t,i){var n=document.createElement("div"),s=new EdenUI.Highlight(n);if(s.ast={stream:new EdenStream(e)},s.highlight(s.ast,-1,-1,void 0),t)return n.childNodes[0].innerHTML;for(var o="",a=0;a<n.childNodes.length;a++)o+=n.childNodes[a].innerHTML;return i?'<div style="display: flex; align-items: center;"><div class="eden-hl-play" data-src="'+e+'">&#xf04b;</div><div>'+o+"</div></div>":o}}("undefined"!=typeof window?window:global);var edenFunctions={apply:!0,array:!0,canvasURL:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,doDefault:!0,edenCode:!0,escapeRE:!0,foldl:!0,foldr:!0,hasProperty:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,positionInList:!0,positionOfRE:!0,substringPosition:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,distanceMoved:!0,angleTurned:!0,List:!0,listcat:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,Menu:!0,MenuItem:!0,min:!0,mod:!0,nameof:!0,partApply:!0,Point:!0,pow:!0,properties:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,RE:!0,replaceFirst:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundMultiple:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sort:!0,str:!0,sqrt:!0,strcat:!0,sublist:!0,substitute:!0,substr:!0,sum:!0,tail:!0,trim:!0,type:!0,uppercase:!0,include_css:!0,html:!0,time:!0,execute:!0,Text:!0,textWidth:!0,textHeight:!0,Arc:!0,Curve:!0,FillPattern:!0,Ellipse:!0,Line:!0,LinearGradient:!0,LineSequence:!0,PixelList:!0,GreyPixelList:!0,Rectangle:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,CombinedRotation:!0,Scale:!0,Translate:!0,RoundedRectangle:!0,Polygon:!0,RegularPolygon:!0,Sector:!0,Shadow:!0,Circle:!0,Button:!0,Checkbox:!0,Div:!0,Image:!0,imageWithZones:!0,HTMLImage:!0,RadioButtons:!0,Slider:!0,Textbox:!0,DropDownList:!0,Combobox:!0,BulletSlide:!0,Video:!0,Audio:!0,Slide:!0,TitledSlide:!0,TitleSlide:!0,cos:!0,sin:!0,tan:!0,abs:!0,acos:!0,asin:!0,atan:!0,ceil:!0,roundUp:!0,exp:!0,floor:!0,roundDown:!0,log:!0,random:!0,forget:!0,forgetAll:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observableOnTopAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnBottomAt:!0,shapesAt:!0,zonesAt:!0,observablesAt:!0,observableForShape:!0,alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showObservables:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0},edenSpecials={autocalc:!0,mouseX:!0,mouseY:!0,mousePosition:!0,screenHeight:!0,screenWidth:!0,PI:!0},edenValues={true:!0,false:!0,green:!0},edenBuiltin={exec:!0,execute:!0,parse:!0,eval:!0,compile:!0},edenAttributes={atomic:!0,nonatomic:!0,fixed:!0,nodepend:!0,depend:!0,eager:!0,volatile:!0,static:!0,const:!0,number:!0,string:!0,list:!0,boolean:!0,undefined:!0,object:!0},jskeywords={var:!0,if:!0,while:!0,typeof:!0,this:!0,function:!0,return:!0,else:!0,break:!0,continue:!0,switch:!0,for:!0,prototype:!0};EdenUI.Highlight.prototype.START=function(){switch(9==this.outerline.length&&(this.outerline="eden-line script"),this.token){case"##":this.stream.isBOL()?(this.outerline="eden-line comment",this.classes.push("hidden-comment"),this.mode="SECTION_TITLE",this.applyClasses(this.lineelement,["comment-line"]),32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes.push("comment"),this.mode="COMMENT");break;case"#":if(this.stream.isFollowingWhiteSpace()){var e=33==this.stream.peek();e&&(this.tokentext+="!",this.stream.position++),this.classes.push("hidden-comment"),this.mode="COMMENT",this.incomment=!0,this.stream.isBOL()&&(this.outerline="eden-line comment"),"INVALID"==this.prevtoken&&(this.lineelement.style.marginLeft="0");var t=document.createElement("div");this.applyClasses(t,e?["comment-line","doxycomment"]:["comment-line"]),this.pushLine(),this.lineelement.appendChild(t),this.lineelement=t,32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)}else this.classes.push("operator");break;case"local":case"para":case"handle":case"role":case"oracle":case"auto":this.classes.push("storage");break;case"NUMBER":this.classes.push("number");break;case"STRING":this.classes.push("string");break;case"BOOLEAN":this.classes.push("constant");break;case"'":this.classes.push("string"),this.pushMode(),this.mode="TEMPLATESTRING";break;case":":this.classes.push("operator"),"is"!=this.prevtoken&&"OBSERVABLE"!=this.prevtoken||(this.pushMode(),this.mode="ATTRIBUTES");break;case"import":case"do":this.classes.push("keyword"),this.pushMode(),this.mode="SELECTOR",this.pushMode(),this.mode="ATTRIBUTES";break;case"${{":this.classes.push("javascript"),this.mode="JAVASCRIPT";break;case"?":this.classes.push("selector"),this.pushMode(),this.mode="SELECTOR";break;case"<":this.cs3&&"OBSERVABLE"!=this.prevtoken&&")"!=this.prevtoken&&"]"!=this.prevtoken&&"}"!=this.prevtoken?(this.classes.push("htmltag"),this.pushMode(),this.mode="HTML"):this.classes.push("operator");break;case"</":this.cs3&&(this.pushMode(),this.mode="HTML_CLOSE",this.classes.push("htmltag"));break;case"<<":this.stream.readToken();var i=this.stream.tokenText();this.tokentext+=i,this.heredocend=i,this.classes.push("storage"),this.mode="HEREDOC";break;case"%":if(this.stream.isBOL()){var n=this.stream.peek();if(10!=n&&32!=n){this.stream.readToken(),i=this.stream.tokenText();if(!this.custom.hasOwnProperty(i)){this.custom[i]={keywords:null,operators:null,specials:null,typenames:null}}if(this.current_custom=this.custom[i],!this.current_custom.keywords){var s=eden.root.lookup("script_"+i+"_keywords").value();if(Array.isArray(s)){this.current_custom.keywords={};for(var o=0;o<s.length;++o)this.current_custom.keywords[s[o]]=!0}}if(!this.current_custom.operators){s=eden.root.lookup("script_"+i+"_operators").value();if(Array.isArray(s)){this.current_custom.operators={};for(o=0;o<s.length;++o)this.current_custom.operators[s[o]]=!0}}if(!this.current_custom.specials){s=eden.root.lookup("script_"+i+"_specials").value();if(Array.isArray(s)){this.current_custom.specials={};for(o=0;o<s.length;++o)this.current_custom.specials[s[o]]=!0}}if(!this.current_custom.typenames){s=eden.root.lookup("script_"+i+"_types").value();if(Array.isArray(s)){this.current_custom.typenames={};for(o=0;o<s.length;++o)this.current_custom.typenames[s[o]]=!0}}this.tokentext+=i,this.heredocend="eden",this.classes.push("storage"),this.mode="CUSTOMBLOCK"}}break;case"OBSERVABLE":edenFunctions[this.stream.data.value]?this.classes.push("function"):EdenUI.Highlight.isType(this.stream.data.value)?this.classes.push("type"):edenValues[this.stream.data.value]?this.classes.push("constant"):edenSpecials[this.stream.data.value]?this.classes.push("special"):"$"==this.stream.data.value.charAt(0)?this.classes.push("parameter"):(this.classes.push("observable"),Eden.Index.name_index.hasOwnProperty(this.stream.data.value)||eden.root.symbols[this.stream.data.value]||this.classes.push("notexist"));break;case"`":this.pushMode(),this.mode="STARTBACKTICK",this.classes.push("builtin");break;case"${":this.pushMode(),this.mode="STARTSUBEXPRESSION",this.classes.push("builtin");break;case"{":"OBSERVABLE"==this.prevtoken&&"action"!=this.prevprevtoken&&"func"!=this.prevprevtoken&&"proc"!=this.prevprevtoken&&"]"!=this.prevprevtoken?(this.pushMode(),this.mode="STARTBACKTICK",this.classes.push("builtin")):this.classes.push("operator");break;default:"keyword"==this.type?edenBuiltin[this.token]?this.classes.push("builtin"):this.classes.push("keyword"):"-"==this.token&&this.stream.isNumeric(this.stream.peek())?(this.token=this.stream.readToken(),this.tokentext="-"+this.stream.tokenText(),this.classes.push("number")):"/*"==this.token?42==this.stream.peek()?(this.pushMode(),this.mode="DOXY_COMMENT",this.classes.push("block-comment")):(this.pushMode(),this.mode="BLOCK_COMMENT",this.classes.push("block-comment")):this.classes.push("operator")}},EdenUI.Highlight.prototype.START_MINIMAL=function(){switch(9==this.outerline.length&&(this.outerline="eden-line script"),this.token){case"NUMBER":this.classes.push("number");break;case"STRING":this.classes.push("string");break;case"BOOLEAN":this.classes.push("constant");break;case"CHARACTER":this.classes.push("string");break;case"OBSERVABLE":default:if("-"==this.token&&this.stream.isNumeric(this.stream.peek()))this.token=this.stream.readToken(),this.tokentext="-"+this.stream.tokenText(),this.classes.push("number");else if("/*"==this.token)this.pushMode(),this.mode="BLOCK_COMMENT",this.classes.push("block-comment");else{var e="keyword"==this.type||"operator"==this.type||"separator"==this.type?this.token:this.stream.data.value;this.current_custom.keywords&&this.current_custom.keywords[e]?this.classes.push("keyword"):this.current_custom.operators&&this.current_custom.operators[e]?this.classes.push("operator"):this.current_custom.specials&&this.current_custom.specials[e]?this.classes.push("special"):this.current_custom.typenames&&this.current_custom.typenames[e]?(console.log("highlight",e),this.classes.push("storage")):this.classes.push("observable")}}},EdenUI.Highlight.prototype.TEMPLATESTRING=function(){9==this.outerline.length&&(this.outerline="eden-line script"),"'"==this.token&&"\\"!=this.prevtoken?(this.classes.push("string"),this.popMode()):"{"==this.token&&"\\"!=this.prevtoken?(this.pushMode(),this.classes.push("builtin"),this.mode="TEMPLATESUBEXPR"):this.classes.push("string")},EdenUI.Highlight.prototype.TEMPLATESUBEXPR=function(){"}"==this.token&&"\\"!=this.prevtoken?(this.classes.push("builtin"),this.popMode()):this.START()},EdenUI.Highlight.prototype.STARTBACKTICK=function(){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["backticks"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="BACKTICK",this.START()},EdenUI.Highlight.prototype.BACKTICK=function(){"`"==this.token?(this.classes.push("builtin"),this.popMode(),this.popLine()):"}"==this.token?(this.classes.push("builtin"),this.popMode(),this.popLine()):this.START()},EdenUI.Highlight.prototype.STARTSUBEXPRESSION=function(){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["subexpr"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="SUBEXPRESSION",this.START()},EdenUI.Highlight.prototype.SUBEXPRESSION=function(){"}"==this.token?(this.classes.push("builtin"),this.popMode(),this.popLine()):this.START()},EdenUI.Highlight.prototype.ATTRIBUTES=function(){if("["==this.token){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["pathblock"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="ATTRIBS",this.ATTRIBS()}else this.popMode(),this[this.mode]()},EdenUI.Highlight.prototype.ATTRIBS=function(){"OBSERVABLE"==this.token&&edenAttributes[this.tokentext]?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.popMode(),this.popLine()):"["==this.token?this.classes.push("selector"):this.classes.push("error")},EdenUI.Highlight.prototype.SELECTOR=function(){if("["==this.token){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["pathblock"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="DO_ATTRIBS",this.DO_ATTRIBS()}else{this.pushLine();e=document.createElement("span");this.applyClasses(e,["pathblock"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="SELECTOR2",this.SELECTOR2()}},EdenUI.Highlight.prototype.DO_ATTRIBS=function(){"OBSERVABLE"==this.token&&edenAttributes[this.tokentext]?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.mode="SELECTOR"):this.classes.push("selector")},EdenUI.Highlight.prototype.SUB_EXPRESSION=function(){"}"==this.token?this.popMode():this[this.startmode]()},EdenUI.Highlight.prototype.SELECTOR2=function(){"{"==this.token?(this.classes.push("operator"),this.pushMode(),this.mode="SUB_EXPRESSION"):"["==this.token?(this.classes.push("selector"),this.mode="SELECTOR_TYPES"):";"==this.token||"="==this.token||"+="==this.token||"//="==this.token?(this.popLine(),this.classes.push("operator"),this.popMode()):"::"==this.token||"with"==this.token?(this.popLine(),this.classes.push("keyword"),this.popMode()):"OBSERVABLE"==this.token&&"@"==this.prevtoken&&(Eden.Selectors.PropertyNode.attributes[this.tokentext]||Eden.Selectors.allowedOptions[this.tokentext])?this.classes.push("selector4"):"OBSERVABLE"!=this.token||"."!=this.prevtoken&&":"!=this.prevtoken||!Eden.Selectors.PropertyNode.attributes[this.tokentext]&&!Eden.Selectors.PropertyNode.pseudo[this.tokentext]?this.classes.push("selector"):this.classes.push("selector2")},EdenUI.Highlight.prototype.SELECTOR_TYPES=function(){"OBSERVABLE"==this.token&&Eden.Selectors.resultTypes[this.tokentext]?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.popMode()):this.classes.push("selector")},EdenUI.Highlight.prototype.JAVASCRIPT=function(){this.classes.push("javascript"),"}}$"==this.token&&(this.mode=this.startmode)},EdenUI.Highlight.prototype.HEREDOC=function(){9==this.outerline.length&&(this.outerline="eden-line script"),"INVALID"==this.prevtoken&&this.tokentext==this.heredocend?(this.classes.push("storage"),this.mode=this.startmode):this.classes.push("string")},EdenUI.Highlight.prototype.CUSTOMBLOCK=function(){if(9==this.outerline.length&&(this.outerline="eden-line script"),"%"==this.token){var e=this.stream.peek();if(10!=e&&32!=e){this.stream.readToken();var t=this.stream.tokenText();if(this.tokentext+=t,this.tokentext=="%"+this.heredocend)return this.classes.push("storage"),void(this.mode=this.startmode)}}this.START_MINIMAL(),this.classes.push("javascript")},EdenUI.Highlight.prototype.SECTION_TITLE=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.applyClasses(this.lineelement,["comment-line","comment-h2"]),this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):"##"==this.token?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.applyClasses(this.lineelement,["comment-line","comment-h1"]),this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE2=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes.push("comment-h2"),this.mode="SECTION_TITLE_H2")},EdenUI.Highlight.prototype.SECTION_TITLE3=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.applyClasses(this.lineelement,["comment-line","comment-h4"]),this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.applyClasses(this.lineelement,["comment-line","comment-h3"]),this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE4=function(){this.classes.push("comment-h4"),this.mode="SECTION_TITLE_H4"},EdenUI.Highlight.prototype.SECTION_TITLE_H1=function(){this.classes.push("comment-h1")},EdenUI.Highlight.prototype.SECTION_TITLE_H2=function(){this.classes.push("comment-h2")},EdenUI.Highlight.prototype.SECTION_TITLE_H3=function(){this.classes.push("comment-h3")},EdenUI.Highlight.prototype.SECTION_TITLE_H4=function(){this.classes.push("comment-h4")},EdenUI.Highlight.prototype.BLOCK_COMMENT=function(){switch(this.token){case"*/":this.popMode(),"BLOCK_COMMENT"==this.mode&&(this.mode=this.startmode),this.classes.push("block-comment");break;default:this.classes.push("block-comment")}},EdenUI.Highlight.prototype.COMMENT=function(){switch(this.token){case"@":case"#":this.mode="COMMENT_TAG",this.pushLine();var e=document.createElement("span");this.applyClasses(e,["doxytag"]),this.lineelement.appendChild(e),this.lineelement=e;break;case"-":case"*":if("##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek())"-"!=this.token?(this.pushMode(),this.mode="COMMENT_EMPH",this.classes.push("hidden-comment")):this.classes.push("comment");else{this.pushLine();e=document.createElement("span");this.applyClasses(e,["comment-ul"]),this.lineelement.appendChild(e),this.lineelement=e,this.classes.push("hidden-comment")}break;case"--":if(45==this.stream.peek()){for(this.outerline="eden-line eden-section-line";45==this.stream.peek();)this.tokentext+="-",this.stream.position++;this.classes.push("hidden-comment")}else this.classes.push("comment");break;case"[":if(32!=this.stream.peek()){this.pushMode(),this.mode="COMMENT_LINK",this.pushLine();e=document.createElement("span");this.lineelement.appendChild(e),this.lineelement=e,this.classes.push("hidden-comment")}else this.classes.push("comment");break;case"!":91==this.stream.peek()?(this.mode="COMMENT_IMAGE",this.tokentext+="[",this.stream.position++,this.classes.push("hidden-comment")):this.classes.push("comment");break;case"$":91==this.stream.peek()?(this.pushMode(),this.mode="COMMENT_BUTTON",this.tokentext+="[",this.stream.position++,this.classes.push("hidden-comment")):this.classes.push("comment");break;case">":"##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek()?this.classes.push("comment"):(this.outerline+=" "+this.styles["comment-blockquote"],this.classes.push("hidden-comment"));break;case"`":this.pushMode(),this.mode="COMMENT_CODE",this.classes.push("hidden-comment");break;case":":32!=this.stream.peek()?(this.pushMode(),this.mode="COMMENT_ICON",this.classes.push("hidden-comment")):this.classes.push("comment");break;case"<":32!=this.stream.peek()?(this.mode="COMMENT_HTML",this.classes.push("hidden-comment")):this.classes.push("comment");break;case"\\":this.pushMode(),this.mode="COMMENT_ESCAPE",this.classes.push("hidden-comment");break;case"?":this.pushMode(),this.mode="COMMENT_QUERY",this.cacheddata=void 0,void 0==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].query=!0,void 0===this.metrics[this.line].qelements&&(this.metrics[this.line].qelements=[]),this.classes.push("hidden-comment");break;case"{":this.pushMode(),this.mode="COMMENT_ATTRS",this.classes.push("hidden-comment");break;default:this.classes.push("comment")}};var css_color_names={aliceblue:!0,antiquewhite:!0,aqua:!0,aquamarine:!0,azure:!0,beige:!0,bisque:!0,black:!0,blanchedalmond:!0,blue:!0,blueviolet:!0,brown:!0,burlywood:!0,cadetblue:!0,chartreuse:!0,chocolate:!0,coral:!0,cornflowerblue:!0,cornsilk:!0,crimson:!0,cyan:!0,darkblue:!0,darkcyan:!0,darkgoldenrod:!0,darkgray:!0,darkgrey:!0,darkgreen:!0,darkkhaki:!0,darkmagenta:!0,darkolivegreen:!0,darkorange:!0,darkorchid:!0,darkred:!0,darksalmon:!0,darkseagreen:!0,darkslateblue:!0,darkslategray:!0,darkslategrey:!0,darkturquoise:!0,darkviolet:!0,deeppink:!0,deepskyblue:!0,dimgray:!0,dimgrey:!0,dodgerblue:!0,firebrick:!0,floralwhite:!0,forestgreen:!0,fuchsia:!0,gainsboro:!0,ghostwhite:!0,gold:!0,goldenrod:!0,gray:!0,grey:!0,green:!0,greenyellow:!0,honeydew:!0,hotpink:!0,indianred:!0,indigo:!0,ivory:!0,khaki:!0,lavender:!0,lavenderblush:!0,lawngreen:!0,lemonchiffon:!0,lightblue:!0,lightcoral:!0,lightcyan:!0,lightgoldenrodyellow:!0,lightgray:!0,lightgrey:!0,lightgreen:!0,lightpink:!0,lightsalmon:!0,lightseagreen:!0,lightskyblue:!0,lightslategray:!0,lightslategrey:!0,lightsteelblue:!0,lightyellow:!0,lime:!0,limegreen:!0,linen:!0,magenta:!0,maroon:!0,mediumaquamarine:!0,mediumblue:!0,mediumorchid:!0,mediumpurple:!0,mediumseagreen:!0,mediumslateblue:!0,mediumspringgreen:!0,mediumturquoise:!0,mediumvioletred:!0,midnightblue:!0,mintcream:!0,mistyrose:!0,moccasin:!0,navajowhite:!0,navy:!0,oldlace:!0,olive:!0,olivedrab:!0,orange:!0,orangered:!0,orchid:!0,palegoldenrod:!0,palegreen:!0,paleturquoise:!0,palevioletred:!0,papayawhip:!0,peachpuff:!0,peru:!0,pink:!0,plum:!0,powderblue:!0,purple:!0,red:!0,rosybrown:!0,royalblue:!0,saddlebrown:!0,salmon:!0,sandybrown:!0,seagreen:!0,seashell:!0,sienna:!0,silver:!0,skyblue:!0,slateblue:!0,slategray:!0,slategrey:!0,snow:!0,springgreen:!0,steelblue:!0,tan:!0,teal:!0,thistle:!0,tomato:!0,turquoise:!0,violet:!0,wheat:!0,white:!0,whitesmoke:!0,yellow:!0,yellowgreen:!0};EdenUI.Highlight.prototype.applyAttribute=function(e,t,i){if(e.style)switch(t){case"color":case"font-size":case"font-family":case"font-weight":case"font-style":case"text-decoration":case"margin-left":case"margin-right":e.style[t]=i;break;case"editable":"true"!=i&&"false"!=i||(e.contentEditable=i);break;case"script":e.setAttribute("data-jseden",i),e.contentEditable=!1,e.style.cursor="pointer",changeClass(e,"executable",!0);break;case"width":case"height":e.setAttribute(t,i);break;case"background":e.style.background=i;break;case"title":e.title=i;break;case"cursor":e.style.cursor=i;break;case"class":this.applyClasses(e,i.split(" "));break;default:e.style[t]=i}},EdenUI.Highlight.prototype.parseAttrs=function(e,t){var i;if(t||(t=this.lineelement.lastChild),(t=t?t.previousSibling:this.lineelement)||(t=this.lineelement),"."==(e=e.trim()).charAt(0)){var n=e.substring(1).match(/[a-z0-9\-]+/);if(null===n)return;i=n[0],e=e.substring(i.length+1).trim(),void 0===this.styleExtensions[i]&&(this.styleExtensions[i]={})}for(;e&&e.length>0;){var s,o=e.indexOf("=");-1==o?(s=e,e=""):(s=e.substring(0,o),e=e.substring(o+1));var a="";if("?"==e.charAt(0));else if('"'==e.charAt(0)||"'"==e.charAt(0)){o=-1;for(var r=e.charAt(0),d=1;d<e.length;d++){if(e.charAt(d)==r){o=d;break}"\\"==e.charAt(d)&&d++}if(-1==o)break;a=e.substring(1,o),e=e.substring(o+1)}else if(e.length>0){o=-1;for(d=0;d<e.length;d++)if(" "==e.charAt(d)){o=d;break}-1==o?(a=e,e=""):(a=e.substring(0,o),e=e.substring(o+1))}switch(e=e.trim(),s){case"colour":s="color";break;case"size":s="font-size";break;case"font":case"family":s="font-family";break;case"decoration":s="text-decoration";break;case"left":s="margin-left";break;case"right":s="margin-right";break;case"underline":s="text-decoration",a="underline";break;case"highlight":s="background",a="yellow";break;case"bold":s="font-weight",a="bold";break;case"italic":s="font-style",a="italic"}css_color_names[s]||"#"==s.charAt(0)?(a=s,s="color"):""==s&&(s="class"),i?this.styleExtensions[i][s]=a:this.applyAttribute(t,s,a)}return t},EdenUI.Highlight.prototype.COMMENT_ATTRS=function(){for(var e=this.stream.peekLine(),t=0,i=-1,n=0;n<e.length;n++)if("{"==e.charAt(n))t++;else if("}"==e.charAt(n)&&--t<0){i=n;break}if(-1==i)this.classes.push("hidden-comment"),this.popMode();else{var s=e.substring(0,i),o=this.tokentext+s;if(this.tokentext+=s+"}",this.stream.position+=i+1,this.classes.push("hidden-comment"),"?"==o.charAt(0)){void 0==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].squery=!0;let e=this.lineelement.lastChild;e||(e=this.lineelement);let t=()=>{this.parseQuery(o,t=>{t&&(t=t.join(" "),this.parseAttrs(t,e))})};t(),this.metrics[this.line].styleUpdate=t}else this.parseAttrs(o);this.popMode()}},EdenUI.Highlight.prototype.parseQuery=function(e,t){for(var i=e.substring(2),n=0,s=-1,o=0;o<i.length;o++)if("("==i.charAt(o))n++;else if(")"==i.charAt(o)&&--n<0){s=o;break}if(-1!=s){var a=i.substring(0,s);Eden.Selectors.query(a,"value",{minimum:0},t)}},EdenUI.Highlight.prototype.COMMENT_QUERY=function(){if("["==this.token){for(var e=this.stream.peekLine(),t=-1,i=0;i<e.length;i++)if("]"==e.charAt(i)){t=i;break}if(-1==t)return void this.classes.push("hidden-comment");this.classes.push("hidden-comment"),this.cacheddata=e.substring(0,t),console.log("Q RES TYPE",this.cacheddata),this.stream.position+=t+1,this.tokentext+=this.cacheddata+"]"}else if("("==this.token){e=this.stream.peekLine();var n=0;for(t=-1,i=0;i<e.length;i++)if("("==e.charAt(i))n++;else if(")"==e.charAt(i)&&--n<0){t=i;break}if(-1==t)this.popMode(),this.classes.push("hidden-comment");else{var s=e.substring(0,t);this.tokentext+=s+")",this.stream.position+=s.length+1,this.popMode(),this.classes.push("hidden-comment");var o=document.createElement("span");this.applyClasses(o,["comment-query"]),this.lineelement.appendChild(o),Eden.Selectors.query(s,this.cacheddata?this.cacheddata:"value",{minimum:1},e=>{e=1==e.length?e[0]:e.length>1?e.join(", "):"",o.setAttribute("data-result",e)}),this.cacheddata&&o.setAttribute("data-attribs",this.cacheddata),o.setAttribute("data-query",s),this.metrics[this.line].qelements.push(o)}}else this.popMode(),this.classes.push("hidden-comment")},EdenUI.Highlight.prototype.COMMENT_LINK=function(){if("]"!=this.token)this.COMMENT();else if(this.classes.push("hidden-comment"),40==this.stream.peek()){var e=this.lineelement,t=e.parentNode,i=document.createElement("a");i.setAttribute("target","_blank"),i.contentEditable=!1,t&&(t.removeChild(e),i.appendChild(e),t.appendChild(i),this.lineelement=i),this.mode="COMMENT_LINK_END"}else this.popMode(),this.popLine()},EdenUI.Highlight.prototype.COMMENT_LINK_END=function(){console.log("LINKEND",this.token);var e=this.stream.peekLine();if("("==this.token){var t=e.indexOf(")");if(-1==t)this.classes.push("hidden-comment"),this.popMode(),this.popLine();else{var i=e.substring(0,t);this.tokentext+=i+")",this.stream.position+=t+1,this.classes.push("hidden-comment"),this.popMode(),i.startsWith("http://")||i.startsWith("https://")?this.lineelement.setAttribute("href",i):this.lineelement.setAttribute("href","javascript: Eden.Selectors.goto('"+i+"');"),this.popLine()}}},EdenUI.Highlight.prototype.COMMENT_IMAGE=function(){var e=this.stream.peekLine(),t=e.indexOf("]");if(-1==t)this.classes.push("comment"),this.mode="COMMENT";else{var i=e.substring(0,t);this.classes.push("comment"),this.mode="COMMENT_IMAGE_END",this.pushLine();var n=document.createElement("img");n.title=i,n.style.verticalAlign="top",this.lineelement.appendChild(n),this.lineelement=n}},EdenUI.Highlight.prototype.COMMENT_BUTTON=function(){this.pushLine();var e=document.createElement("button");this.lineelement.appendChild(e),this.lineelement=e,e.contentEditable=!1,this.mode="COMMENT_BUTTON_CONTENT"},EdenUI.Highlight.prototype.COMMENT_BUTTON_CONTENT=function(){"]"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_IMAGE_END=function(){var e=this.stream.peekLine(),t=e.indexOf(")");if(-1==t)this.classes.push("hidden-comment"),this.mode="COMMENT",this.popLine();else{var i=e.substring(0,t);this.tokentext+=i+")",this.stream.position+=t+1,this.classes.push("hidden-comment"),this.mode="COMMENT",this.lineelement.setAttribute("src",i.substring(1)),this.popLine()}},EdenUI.Highlight.prototype.COMMENT_ESCAPE=function(){this.popMode(),this.classes.push("comment")},EdenUI.Highlight.prototype.validHTMLTags={button:!0,span:!0,a:!0,img:!0,input:!0,table:!0,textarea:!0},EdenUI.Highlight.prototype.COMMENT_HTML=function(){var e=this.tokentext;if(!EdenUI.Highlight.prototype.validHTMLTags[e])return this.mode="COMMENT",void this.COMMENT();for(var t=this.stream.peekLine(),i=-1,n=!1,s=0,o=0;o<t.length;o++)if(t.charCodeAt(o)==s)n=!n,s=0;else if(0!=s||34!=t.charCodeAt(o)&&39!=t.charCodeAt(o)){if(n&&"\\"==t.charAt(o))o++;else if(!n&&">"==t.charAt(o)){i=o;break}}else n=!n,s=t.charCodeAt(o);if(i>=0){var a="<"+e+t.substring(0,i+1);this.tokentext=a.substring(1),this.cacheddata={opentag:a,tagname:e},this.classes.push("hidden-comment"),this.mode="COMMENT_HTML_START",this.stream.position+=i+1}else this.classes.push("hidden-comment"),this.tokentext+=t.substring(0,t.length-1),this.stream.position+=t.length-1,this.mode="COMMENT"},EdenUI.Highlight.prototype.COMMENT_HTML_CONTENT=function(){if("</"!=this.token)this.COMMENT();else if(this.cacheddata){var e=this.stream.peekLine(),t=this.cacheddata.tagname+">",i=e.indexOf(t);-1==i?this.classes.push("hidden-comment"):(this.cacheddata&&this.popLine(),this.tokentext+=t,this.stream.position+=i+t.length,this.classes.push("hidden-comment")),this.mode="COMMENT"}else this.mode="COMMENT"},EdenUI.Highlight.prototype.COMMENT_HTML_START=function(){if("<"!=this.token){var e=this.cacheddata.opentag+n;this.mode="COMMENT_HTML_CONTENT",this.pushLine();var t=$(e).get(0);"button"!=this.cacheddata.tagname&&"a"!=this.cacheddata.tagname||(t.contentEditable=!1),this.lineelement.appendChild(t),this.lineelement=t,this.COMMENT()}else{var i=this.stream.peekLine(),n="/"+this.cacheddata.tagname+">",s=i.indexOf(n);-1==s?this.classes.push("hidden-comment"):(this.cacheddata&&this.popLine(),this.tokentext+=n,this.stream.position+=s+n.length,this.classes.push("hidden-comment")),this.mode="COMMENT"}},EdenUI.Highlight.prototype.COMMENT_CODE=function(){"`"==this.token?(this.classes.push("hidden-comment"),this.popMode()):(this.classes.push("script"),this.START())},EdenUI.Highlight.prototype.COMMENT_ICON=function(){if("OBSERVABLE"==this.token){if("-"==this.stream.code.charAt(this.stream.position)){var e=this.stream.peekLine(),t=e.indexOf(":");if(-1==t)return this.classes.push("comment"),void this.popMode();var i=e.substring(0,t);this.tokentext+=i,this.stream.position+=i.length}var n=document.createElement("span");n.className="eden-comment-icon fa fa-"+this.tokentext,this.lineelement.appendChild(n),this.classes.push("hidden-comment")}else":"==this.token&&(this.classes.push("hidden-comment"),this.popMode())},EdenUI.Highlight.prototype.COMMENT_EMPH=function(){if("*"==this.token)this.mode="COMMENT_BOLD",this.classes.push("hidden-comment");else{var e=document.createElement("span");this.applyClasses(e,["comment-emph"]),this.lineelement.appendChild(e),this.pushLine(),this.lineelement=e,this.mode="COMMENT_ITALIC",this.COMMENT()}},EdenUI.Highlight.prototype.COMMENT_ITALIC=function(){"*"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_BOLD=function(){if("*"==this.token)this.classes.push("hidden-comment"),this.popLine(),this.mode="COMMENT_BOLD_END";else{var e=document.createElement("span");this.applyClasses(e,["comment-bold"]),this.lineelement.appendChild(e),this.pushLine(),this.lineelement=e,this.mode="COMMENT_BOLD_END",this.COMMENT()}},EdenUI.Highlight.prototype.COMMENT_BOLD_END=function(){"*"==this.token?("*"==this.stream.code.charAt(this.stream.position)&&(this.classes.push("hidden-comment"),this.stream.position++,this.tokentext+="*"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_TAG=function(){this.mode="END_COMMENT_TAG"},EdenUI.Highlight.prototype.END_COMMENT_TAG=function(){this.popLine(),this.mode="COMMENT",this.COMMENT()},EdenUI.Highlight.prototype.DOXY_COMMENT=function(){this.BLOCK_COMMENT()},EdenUI.Highlight.prototype.HTML=function(){"OBSERVABLE"==this.token&&(this.classes.push("htmltag"),this.mode="HTML_ATTRIBUTES")},EdenUI.Highlight.prototype.HTML_CLOSE=function(){"OBSERVABLE"==this.token?(this.classes.push("htmltag"),this.mode="HTML_CLOSE"):">"==this.token&&(this.classes.push("htmltag"),this.popMode())},EdenUI.Highlight.prototype.HTML_ATTRIBUTES=function(){">"==this.token?(this.classes.push("htmltag"),this.mode="START"):(this.classes.push("htmlattribute"),this.mode="HTML_ATTRIBVALUE")},EdenUI.Highlight.prototype.HTML_ATTRIBVALUE=function(){"="==this.token?this.classes.push("operator"):"{"==this.token?(this.pushMode(),this.mode="START"):">"==this.token?(this.classes.push("htmltag"),this.mode="START"):"STRING"==this.token?(this.classes.push("string"),this.mode="HTML_ATTRIBUTES"):this.classes.push("htmlattribute")},EdenUI.ContextMenu=function(e){this.element=$('<div class="eden-contextmenu"></div>'),this.origin=e,this.target=void 0,this.items=[],$(document.body).append(this.element);var t=this;this.element.on("mousedown",".eden-contextmenu-item",function(e){var i=parseInt(e.currentTarget.getAttribute("data-index"));t.items[i].action&&t.items[i].action(t.target)}),this.origin.oncontextmenu=function(e){t.target=e.target,"SPAN"==t.target.nodeName&&(t.target=t.target.parentNode);var i=document.body.scrollLeft+e.clientX;i+150>=screen.width&&(i-=i+150-screen.width),t.element.css("top",document.body.scrollTop+e.clientY+10+"px"),t.element.css("left",i+"px");for(var n=0;n<t.items.length;n++){var s;s="function"==typeof t.items[n].status?t.items[n].status(t.target):t.items[n].status,changeClass(t.items[n].element,"disabled",!s)}t.element.slideDown(100),e.preventDefault()},document.addEventListener("mousedown",function(){t.element.hide()},!0)},EdenUI.ContextMenu.prototype.addItem=function(e,t,i,n){var s=$('<div class="eden-contextmenu-item"><span class="eden-contextmenu-icon">'+e+"</span><span>"+t+"</span></div>");s.get(0).setAttribute("data-index",""+this.items.length),this.element.append(s),this.items.push({status:i,action:n,element:s.get(0)})},EdenUI.ContextMenu.prototype.addSeparator=function(){var e=$('<div class="eden-contextmenu-sep"></div>');this.element.append(e)},EdenUI.ButtonBar=function(e){this.container=e,this.bar=$('<div class="control-bar noselect"><div class="buttonsDiv"></div></div>'),this.buttons={},this.container.appendChild(this.bar.get(0))},EdenUI.ButtonBar.prototype.addButton=function(e,t,i,n){var s=$('<button class="control-button control-enabled '+e+'" title="'+i+'">'+t+"</button>");this.bar.find(".buttonsDiv").append(s),s.get(0).onclick=n,this.buttons[e]=s},EdenUI.ButtonBar.prototype.enableButton=function(e){this.buttons[e]&&this.buttons[e].addClass("control-enabled")},EdenUI.ButtonBar.prototype.disableButton=function(e){this.buttons[e]&&this.buttons[e].removeClass("control-enabled")},EdenUI.Tabs=function(e){this.tabs=e,this.scrollix=0,this.maxtabs=3},EdenUI.Tabs.prototype.build=function(e,t){for(;this.tabs.firstChild;)this.tabs.removeChild(this.tabs.firstChild);var i=document.createElement("div");i.className="agent-tableft noselect",this.tabs.appendChild(i);var n=document.createElement("div");if(n.className="agent-tab-container",this.tabs.appendChild(n),e&&e instanceof Array){var s=-1;t&&(s=e.indexOf(t)),s>this.scrollix+(this.maxtabs-1)&&(this.scrollix=s-(this.maxtabs-1)),s<this.scrollix&&(this.scrollix=s);for(var o=0;o<e.length;o++){var a=e[o];Eden.Agent.agents[e[o]]&&(a=Eden.Agent.agents[e[o]].title),this.scrollix<=o&&this.add(n,e[o],a,t&&e[o]==t,o)}}var r=document.createElement("div");r.className="agent-newtab noselect",r.style.left=160*e.length+20+"px",n.appendChild(r);var d=document.createElement("div");d.className="agent-tabright noselect",this.tabs.appendChild(d)},EdenUI.Tabs.prototype.add=function(e,t,i,n,s){var o=document.createElement("div");o.style.left=160*s+"px";var a="agent-tab noselect";a+=n?" agent-tab-current":" agent-tab-notcurrent";var r,d=t.split("/").pop();d.length>18&&(d="..."+d.slice(-15)),r=Eden.Agent.agents[t]?Eden.Agent.agents[t].hasErrors()?"tab-icon errored":Eden.Agent.agents[t].executed?"tab-icon executed":"tab-icon":"tab-icon noagent",o.className=a,o.innerHTML="<span class='"+r+"'>&#xf007;</span>"+d,o.draggable=!0,o.setAttribute("data-name",t),e.appendChild(o)},EdenUI.MenuBar=function(){var e="images/pin.png",t="images/pin-greyed.png",i=this;this.itemViews={};var n=mobilecheck(),s=$('<div id="menubar-obscurer" class="login-subdialog modal" style="display: block;"></div>');s.html(`<div class="modal-content" style="width: 350px; height: 400px;"><div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf090;</span>${Language.ui.menu_bar.signin}</div><iframe frameborder="0" name="logintarget" width="340px" height="300px" class="menubar-login-iframe"></iframe><button class="jseden button-cancel">${Language.ui.menu_bar.cancel}</button></div>`),s.hide(),Eden.AST&&eden.execute2("views_number_created = 0;",EdenSymbol.defaultAgent),this.element=n?$('<div id="menubar-main" class="no-print">\t\t\t<div class="menubar-buttons">\t\t\t\t<div class="menubar-button enabled main share" data-obs="sharebox" title="Save or share" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div>\t\t\t\t<div class="menubar-button enabled main notifications" data-obs="notifications" title="Notifications">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div>\t\t\t\t<div class="menubar-button enabled main more" data-obs="more" title="More Options">&#xf0c9;</div></div>\t\t\t<div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="Search..." spellcheck="false"></input>\t\t\t\t<div id="menubar-searchresults"></div>\t\t\t</div></div>'):$(`<div id="menubar-main" class="no-print">\n\t\t\t<a id="eden-logo" title="${Language.ui.tooltips.home_logo}" href="${window.location.pathname}" target="_blank" style="display: block"></a>\n\t\t\t<div class="jseden-title" title="${Language.ui.tooltips.rename}"></div>\n\t\t\t<div id="menubar-login"><span class="icon">&#xf05e;</span>${Language.ui.menu_bar.notconnected}</div>\n\t\t\t<div class="menubar-buttons">\n\t\t\t\t<div class="menubar-button enabled main share" data-obs="sharebox" title="${Language.ui.tooltips.save}" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main create" data-obs="views" title="${Language.ui.tooltips.create}" style="display: none;">&#xf067;<div id="menubar-mainitem-views" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main existing" data-obs="existing" title="${Language.ui.tooltips.existing}" style="display: none;">&#xf2d2;<div id="menubar-mainitem-existing" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main settings" data-obs="options" title="${Language.ui.tooltips.options}" style="display: none;">&#xf013;<div id="menubar-mainitem-options" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main help" data-obs="help" title="${Language.ui.tooltips.help}">&#xf128;<div id="menubar-mainitem-help" class="menubar-menu">\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="?load=54">Getting Started...</a></div>\t\t\t\t\t\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="resources/doc/cheat.pdf">Cheat Sheet (PDF)</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://www.youtube.com/channel/UCQUAv0AU1FF2EN0qwOOZCag">Tutorial Videos (YouTube)</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://github.com/EMGroup/js-eden/wiki/Eden-Functions">Library Reference</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://github.com/EMGroup/js-eden/wiki/FAQ">FAQ</a></div>\n\t\t\t\t\t<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="http://construit.org">About Construit</a></div>\n\t\t\t\t</div></div>\n\t\t\t\t<div class="menubar-button enabled main notifications" data-obs="notifications" title="${Language.ui.tooltips.notifications}">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div>\n\t\t\t\t<div class="menubar-button enabled main maker" data-obs="maker" title="${Language.ui.tooltips.maker}" style="display: none;">&#xf0ad;</div></div>\n\t\t\t<div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="${Language.ui.menu_bar.search}" spellcheck="false"></input>\n\t\t\t\t<div id="menubar-searchresults"></div>\n\t\t\t</div></div>`),$(document.body).append(this.element);var o=this.element.find("#menubar-login");n||new EdenUI.ContextMenu(o.get(0)).addItem("&#xf08b;","Log out",function(){return Eden.DB.isLoggedIn()},function(){Eden.DB.logOut(function(){$("#menubar-login").html('<span class="icon">&#xf090;</span>Sign-in')})});edenUI.listenTo("loadPlugin",this,function(e,t){n||this.updateViewsMenu()}),edenUI.listenTo("createView",this,function(e,t){n||this.updateViewsMenu()}),edenUI.listenTo("destroyView",this,function(e){n||($(this.itemViews[e]).remove(),delete this.itemViews[e],c())}),Eden.DB.listenTo("connected",this,function(e){n||$("#menubar-login").html(`<span class="icon">&#xf090;</span>${Language.ui.menu_bar.signin}`)}),Eden.DB.listenTo("disconnected",this,function(){n||$("#menubar-login").html(`<span class="icon">&#xf05e;</span>${Language.ui.menu_bar.notconnected}`)}),Eden.DB.listenTo("login",this,function(e){n||e&&(Eden.DB.log("login"),setTimeout(function(){$("#menubar-obscurer").remove()},1e3),$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/#" target="_blank"><span class="icon">&#xf2be;</span>'+e+"</a>"))});i=this;n||$("#menubar-login").click(function(){i.showLogin()}),this.showLogin=function(){Eden.DB.isConnected()&&!Eden.DB.isLoggedIn()?(s.show(),$(document.body).append(s),s.find("iframe").attr("src",Eden.DB.remoteURL+"/login"),s.on("click",".button-cancel",function(){s.remove()})):Eden.DB.isConnected()&&Eden.DB.isLoggedIn()},Eden.AST&&(this.sharebox=new EdenUI.Sharebox(this.element.find("#menubar-mainitem-sharebox")),this.element.on("click",".menubar-button.share",function(e){e.currentTarget===e.target&&i.sharebox.update()}),this.searchbox=new EdenUI.SearchBox(this.element.find("#menubar-searchresults")),this.element.on("keyup",".search",function(e){i.searchbox.updateSearch(e.currentTarget.value)}),this.element.on("focus",".search",function(e){i.searchbox.updateSearch(e.currentTarget.value)}));var a=!1,r=void 0;function d(){$(".menubar-menu").hide(),a=!1,$("#menubar-mainitem-views").children().css("display","")}function l(e){$("#menubar-mainitem-"+e).show(),r=e,a=!0,"sharebox"==e&&i.sharebox.show()}function c(){var e=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(edenUI.activeDialogs).length&&e.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function h(e){d();var t=edenUI.eden.root,n=t.lookup("mouseFollow").value(),s=t.lookup("views_number_created"),o=s.value()+1;s.assign(o,t.scope,EdenSymbol.hciAgent,!0);var a=this.view,r=a.toLowerCase()+o;n?edenUI.eden.execute('createView("'+r+'", "'+a+'");'):edenUI.createView(r,a),i.updateViewsMenu()}function p(e){var t=this.parentNode.viewname;edenUI.viewInstances[t].confirmClose&&d(),edenUI.destroyView(t),c()}function u(i){var n=i.currentTarget.children[0],s=this.parentNode.viewname;edenUI.viewInstances[s].pinned?(edenUI.unpinView(s),n.src=t):(edenUI.pinView(s),n.src=e)}function m(e){for(var t=$("<div class='menubar-item'></div>"),i=0;i<e.length;++i)t.append(e[i]);return t}function g(e,t){return $('<div class="'+e+' menubar-item-clickable">'+t+"</div>")}function v(e){return{mouseover:function(t){edenUI.highlightView(e,!0)},mouseout:function(t){edenUI.stopHighlightingView(e,!0,!1)},click:function(t){edenUI.stopHighlightingView(e,!0,!0),d()}}}$(document.body).on("mousedown",function(){d(),i.searchbox&&i.searchbox.element.hide()}),this.element.on("mousedown",".menubar-search-outer",function(e){e.stopPropagation()}),this.element.on("mousedown",".menubar-button.main",function(e){var t=e.currentTarget.getAttribute("data-obs");a&&e.target===this?t==r?d():(d(),l(t)):l(t),i.searchbox&&i.searchbox.element.hide(),e.stopPropagation()}),this.element.on("mouseenter",".menubar-button.main",function(e){}),this.updateViewsMenu=function(){var n=$("#menubar-mainitem-views"),s=$("#menubar-mainitem-existing");n.html("");var o=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),a=o[0],r=$('<div class="menubar-item-fullwidth"></div>');r.append(o);var d=$("<div class='menubar-item-search'></div>");d.append(r),a.search=function(){var e,t=a.value,i=new RegExp("(^|\\s)"+t,"i"),s=!1;n.children().each(function(n,o){if(!o.classList.contains("menubar-item-search")){var a=o.children[0],r=a.innerHTML;a.classList.contains("menubar-item-separator")?(t.length>1&&(s=i.test(r)),e=o,o.style.display=s?"":"none"):s?o.style.display="":i.test(r)?(o.style.display="",e.style.display=""):o.style.display="none"}})},o.on("input",a.search);var l,f,b,E,y,x,k,C=[];for(f in edenUI.views){var T=edenUI.views[f],S=T.title,w=T.category.getLabel(),I=T.category.getMenuPriority(),N=T.menuPriority;(b=m([E=g("menubar-item-fullwidth menubar-view",S)]))[0].view=f,b.click(h),C.push({title:S,viewEntry:b,categoryLabel:w,categoryPriority:I,itemPriority:N})}C=C.sort(function(e,t){if(e.categoryPriority!=t.categoryPriority)return e.categoryPriority-t.categoryPriority;if(void 0!==e.itemPriority){if(void 0===t.itemPriority)return-1;if(e.itemPriority!=t.itemPriority)return e.itemPriority-t.itemPriority}else if(void 0!==t.itemPriority)return 1;return e.title>t.title?1:e.title<t.title?-1:0});for(var _=0;_<C.length;++_){var M=C[_],L=M.categoryLabel;if(k!=L)$("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+L+"</div></div>").appendTo(n),k=L;M.viewEntry.appendTo(n)}for(l in n.append(d),s.html(""),i.itemViews={},c(),edenUI.activeDialogs){var A=v(l);(E=g("menubar-item-label",(S=edenUI.eden.root.lookup("view_"+l+"_title").value())+' <span class="menubar-view-name">['+l+"]</span>")).click(A.click),(y=g("menubar-item-pin",'<img src="'+(edenUI.viewInstances[l].pinned?e:t)+'" width="18" height="18" class="menubar-item-pin-icon"/>')).click(u),(x=g("menubar-item-close",'<div class="menubar-item-close-icon">X</div>')).click(p),(b=m([E,y,x])).bind("mouseover",A.mouseover),b.bind("mouseout",A.mouseout),b[0].viewname=l,b.appendTo(s),i.itemViews[l]=b[0]}},this.updateViewsMenu();var f=$("#menubar-mainitem-options");function b(e,t,i,n){var s=edenUI.getOptionValue(e);null===s&&(s=i);var o,a=g("menubar-item-input",'<input id="menu-'+e+'" type="checkbox"'+((o=s)&&"false"!=o?'checked="checked"':"")+" />"),r=a.get(0).children[0],d=m([a,g("menubar-item-label",t)]);d.click(function(t){t.target!=r&&(r.checked=!r.checked),edenUI.setOptionValue(e,r.checked)}),edenUI.listenTo("optionChange",void 0,function(t,i){if(t==e){var s="true"===i;r.checked=s,n&&n(e,s)}}),d.appendTo(f)}b("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(e,t){t?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),b("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),b("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),b("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(e,t){var i;i=t?"collapse":"maximize",$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",i)})}),b("developer",Language.ui.menu_bar.opt_debug,!1,function(e,t){var i;i=t?"/index-dev.html":"/index.html";var n=document.location.pathname;(i=n.slice(0,n.lastIndexOf("/"))+i)!=document.location.pathname?(d(),edenUI.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(e){if(0==e)window.onbeforeunload=void 0,document.location.pathname=i;else if(1==e)root.lookup("debug").mutate(root.scope,function(e){e.cache.value.jsExceptions=t},EdenSymbol.hciAgent);else{var n=document.getElementById("menu-developer");n.checked=!n.checked,edenUI.setOptionValue("developer",n.checked)}})):root.lookup("debug").mutate(root.scope,function(e){e.cache.value.jsExceptions=t},EdenSymbol.hciAgent)}),this.element.on("keyup",".jseden-title",function(e){try{window.localStorage&&window.localStorage.setItem("title",e.currentTarget.textContent)}catch(e){}}),eden.root.lookup("jseden_project_title").addJSObserver("menubar",function(e,t){if(!n){if(e.origin&&e.origin!==EdenSymbol.hciAgent){var i=$(".jseden-title").get(0);i.contentEditable=!0,i.textContent=t,document.title=t}try{window.localStorage&&window.localStorage.setItem("title",t)}catch(e){}}}),eden.root.lookup("jseden_maker").addJSObserver("menubar",function(e,t){t?i.element.find(".maker").addClass("active"):i.element.find(".maker").removeClass("active")}),eden.root.lookup("jseden_menu_showsearch").addJSObserver("menubar",function(e,t){t?(i.element.find(".menusearch").show(),n&&i.element.find("#eden-logo").hide()):(i.element.find(".menusearch").hide(),n&&i.element.find("#eden-logo").show())}),eden.root.lookup("jseden_explorer_enabled").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.maker").show():i.element.find(".menubar-button.maker").hide()}),eden.root.lookup("jseden_menu_visible").addJSObserver("menubar",function(e,t){t?(i.element.show(),$("#jseden-main").removeClass("nomenu")):(i.element.hide(),$("#jseden-main").addClass("nomenu"))}),eden.root.lookup("jseden_menu_showshare").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.share").show():i.element.find(".menubar-button.share").hide()}),eden.root.lookup("jseden_menu_showcreate").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.create").show():i.element.find(".menubar-button.create").hide()}),eden.root.lookup("jseden_menu_showexisting").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.existing").show():i.element.find(".menubar-button.existing").hide()}),eden.root.lookup("jseden_menu_showsettings").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.settings").show():i.element.find(".menubar-button.settings").hide()}),eden.root.lookup("jseden_menu_showhelp").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.help").show():i.element.find(".menubar-button.help").hide()}),eden.root.lookup("jseden_menu_shownotifications").addJSObserver("menubar",function(e,t){t?i.element.find(".menubar-button.notifications").show():i.element.find(".menubar-button.notifications").hide()}),eden.root.lookup("jseden_project_subtitle").addJSObserver("menubar",function(e,t){}),this.notifications=new EdenUI.Notifications(this.element.find("#menubar-mainitem-notifications"),this.element.find(".menubar-notification-jewel")),this.element.on("click",".notifications",function(e){i.notifications.clearCount()}),this.element.on("click",".maker",function(e){var t=eden.root.lookup("jseden_maker");if(!t.eden_definition){var i=t.value();void 0===i&&(i=!1),t.assign(!i,eden.root.scope,EdenSymbol.localJSAgent)}}),this.element.on("keyup",".jseden-title",function(e){var t=eden.root.lookup("jseden_project_title");t.definition||t.assign(e.currentTarget.textContent,eden.root.scope,EdenSymbol.hciAgent)})},EdenUI.MenuBar.prototype.hide=function(){this.element.hide()},EdenUI.MenuBar.prototype.show=function(){this.element.show()},EdenUI.MenuBar.reset=function(){$(".jseden-title").html("CONSTRUIT")},EdenUI.MenuBar.saveTitle=function(e){eden.root.lookup("jseden_project_title").assign(e,eden.root.scope,EdenSymbol.jsAgent)},EdenUI.Dialogs={},EdenUI.Dialogs.MergeError=function(e,t,i){var n=new diff_match_patch,s=n.diff_main(e,t);n.diff_cleanupSemantic(s);var o=n.diff_prettyHtml(s);$('<div title="Import Merge Conflict">'+o+"</div>").dialog({resizable:!0,height:"auto",width:600,modal:!0,buttons:{"Use Mine":function(){i&&i("old"),$(this).dialog("close")},"Use New":function(){i&&i("new"),$(this).dialog("close")},Merge:function(){i&&i("merge"),$(this).dialog("close")}}})},EdenUI.Notifications=function(e,t){var i=this;function n(e,t){if(t){var n=("runtime"==t.type?"Runtime error":"Syntax error")+" in "+e.name+":"+(t.line&&-1!=t.line?t.line:"")+" -> "+t.messageText(),s="<a href=\"javascript:Eden.Selectors.goto('.id("+e.id+")');\">"+e.name+":"+(t.line&&-1!=t.line?t.line+1:"")+"</a> "+t.messageText();if(!e.owned||"syntax"!=t.type){console.error(n);var o=$('<pre class="error-item">'+s+"</pre>\n\n");o.on("click",function(){var i="";if(!t.statement||"definition"!=t.statement.type&&"assignment"!=t.statement.type||(i+="    <b>Symbol:</b> "+t.statement.lvalue.name+"\n"),t.lastsymbol&&(i+="    <b>Related Symbol:</b> "+t.lastsymbol+"\n"),String(t.extra).search("SyntaxError")>=0)i+="    <b>JavaScript:</b> "+t.javascriptSource()+"\n",o.html(s+"\n"+i);else if(i+="    <b>Source:</b> <div class='error-source'</div>\n",o.html(s+"\n"+i),t.statement){var n=new Eden.AST(t.edenSource(),void 0,e);new EdenUI.Highlight(o.find(".error-source").get(0)).highlight(n,-1,-1)}}),i.notification("error",o)}}}this.notificationCount=0,this.notificationCountElement=t,this.notificationCountElement.hide(),this.notificationPanel=e,this.notificationPanel.html('<button class="control-button close-button control-enabled">&#xf00d;</button><button class="control-button clear-button control-enabled">&#xf05e;</button><div id="errors-dialog"></div>'),this.notificationPanel.on("click",".close-button",function(){i.notificationPanel.hide()}).on("click",".clear-button",function(){i.notificationPanel.find("#errors-dialog").html("")}),this.notificationPanel.hide(),this.notificationContent=this.notificationPanel.find("#errors-dialog"),Eden.Peer.listenTo("user",void 0,function(e,t){i.notification("net",$('<div class="notification-content">User \'<a href="javascript:eden.peer.showConnection(\''+e+"');\">"+t+"</a>' connected to you.<br/><a href=\"javascript: eden.peer.requestShare('"+e+"');\">Watch</a> <a href=\"javascript: eden.peer.requestObserve('"+e+"');\">Broadcast</a> <a href=\"javascript: eden.peer.requestCollaborate('"+e+"');\">Collaborate</a></div>"))}),Eden.Peer.listenTo("share",void 0,function(e,t){i.notification("net",$('<div class="notification-content">Your model is being shared...</div>'))}),Eden.Peer.listenTo("disconnect",void 0,function(e,t){t?i.notification("net",$('<div class="notification-content">User \''+t+"' disconnected.</div>")):i.notification("net",$('<div class="notification-content">P2P User disconnected.</div>'))}),Eden.Peer.listenTo("error",void 0,function(e){i.notification("error",$('<div class="notification-content">P2P: '+e+"</div>"))}),eden.listenTo("error",void 0,n),Eden.Fragment&&(Eden.Fragment.listenTo("error",void 0,n),Eden.Fragment.listenTo("warning",void 0,function(e,t){if(t){t.type,e.name,-1!=t.line&&t.line,t.messageText();var n="<a href=\"javascript:edenUI.gotoCode('"+e.name+"',"+t.line+');">'+e.name+":"+(-1!=t.line?t.line+1:"")+"</a> "+t.messageText();if(!e.owned||"syntax"!=t.type){var s=$('<pre class="error-item">'+n+"</pre>\n\n");s.on("click",function(){var e="";if(!t.statement||"definition"!=t.statement.type&&"assignment"!=t.statement.type||(e+="    <b>Symbol:</b> "+t.statement.lvalue.name+"\n"),t.lastsymbol&&(e+="    <b>Related Symbol:</b> "+t.lastsymbol+"\n"),String(t.extra).search("SyntaxError")>=0)e+="    <b>JavaScript:</b> "+t.javascriptSource()+"\n",s.html(n+"\n"+e);else if(e+="    <b>Source:</b> <div class='error-source'</div>\n",s.html(n+"\n"+e),t.statement){var i=new Eden.AST(t.edenSource(),void 0,Symbol.jsAgent);new EdenUI.Highlight(s.find(".error-source").get(0)).highlight(i,-1,-1)}}),i.notification("warning",s)}}})),Eden.DB.listenTo("disconnected",this,function(){i.notification("info",$('<div class="notification-content">Disconnected from project server</div>'))}),Eden.DB.listenTo("error",this,function(e){i.notification("error",$('<div class="notification-content">'+e+"</div>"))})},EdenUI.Notifications.prototype.notification=function(e,t){var i;if(this.notificationCount++,this.notificationCountElement.html(this.notificationCount),this.notificationCountElement.show(),"error"==e)(i=$('<div class="notification-item error"></div>')).append($('<div class="notification-icon"><span style="color: red;">&#xf06a;</span></div>'));else{var n,s="#777";switch(e){case"net":n="&#xf0c1;";break;case"comment":n="&#xf075;";break;case"log":n="&#xf120;";break;case"warning":n="&#xf071;",s="#f57900";break;case"info":default:n="&#xf129;",s="#29454B"}(i=$('<div class="notification-item"></div>')).append($('<div class="notification-icon"><span style="color: '+s+'">'+n+"</span></div>"))}"string"==typeof t?i.append($('<div class="notification-content">'+t+"</div>")):i.append(t),this.notificationContent.prepend(i),this.notificationContent.prop("scrollTop",0)},EdenUI.Notifications.prototype.clearCount=function(){this.notificationCountElement.hide(),this.notificationCount=0},EdenUI.Sharebox=function(e){var t=this;this.title=void 0,this.visible=!1,this.sharebox=e,this.sharebox.html('<div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf1e0;</span>Save and Share</div><div class="menubar-sharebox-content"><div id="projectoptions"></div><div id="projectuploadbox"></div></div>');var i=this.sharebox.find("#projectoptions");this.markdown=new EdenUI.Markdown(""),i.get(0).appendChild(this.markdown.contents),this.sharebox.on("change","#thumbfile",function(e){var i=t.sharebox.find("#projectthumb"),n=$("#thumbfile");i.html("<img></img>");var s=n.get(0).files[0],o=new FileReader;o.onload=function(e){var n=document.createElement("canvas");n.setAttribute("width","200"),n.setAttribute("height","112");var s=n.getContext("2d"),o=new Image;o.onload=function(){var e,a,r,d,l=o.width,c=o.height,h=l/c;h<200/112?(r=(200-(a=l*((e=112)/c)))/2,d=0):h>200/112?(r=0,d=(112-(e=c*((a=200)/l)))/2):(e=112,a=200,r=0,d=0),s.drawImage(o,r,d,a,e);var p=n.toDataURL("image/png");t.thumbdata=p,i.get(0).childNodes[0].src=p},o.src=e.target.result},o.readAsDataURL(s)}),this.sharebox.on("click",".local",function(e){Eden.DB.localSave(eden.project),t.sharebox.hide()}),this.sharebox.on("click",".upload",function(e){var i=t.title.textContent,n=t.markdown.intextarea.value,s=$("#listpublic").get(0).checked;"New Project"!=i?(t.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.log("save",{pid:eden.project.id}),eden.project.thumb=t.thumbdata,eden.project.setDescription(n),eden.project.save(s,function(e){if(e){var i=URLUtil.updateQueryString({load:eden.project.id,vid:eden.project.vid,r:eden.project.readPassword});window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",i),t.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>');var n=document.createRange();n.selectNodeContents(t.sharebox.find(".projecturl").get(0));var s=window.getSelection();s.removeAllRanges(),s.addRange(n)}else t.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")})):t.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.')}),this.sharebox.on("click",".fork",function(e){var i=t.title.textContent,n=t.markdown.intextarea.value,s=$("#listpublic").get(0).checked;"New Project"!=i?(t.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.log("fork",{pid:eden.project.id}),eden.project.thumb=t.thumbdata,eden.project.id&&(eden.project.parentid=eden.project.id),eden.project.id=void 0,eden.project.vid=void 0,eden.project.setDescription(n),eden.project.save(s,function(e){if(e){var i=URLUtil.updateQueryString({load:eden.project.id,vid:eden.project.vid,r:eden.project.readPassword});window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",i),t.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>');var n=document.createRange();n.selectNodeContents(t.sharebox.find(".projecturl").get(0));var s=window.getSelection();s.removeAllRanges(),s.addRange(n)}else t.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")})):t.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.')})},EdenUI.Sharebox.prototype.show=function(){this.visible||this.update(),this.visible=!0},EdenUI.Sharebox.prototype.hide=function(){this.visible=!1},EdenUI.Sharebox.prototype.update=function(){var e=this;void 0===e.title&&(e.title=$(document).find(".jseden-title").get(0));var t=e.title?e.title.textContent:eden.root.lookup("jseden_project_title").value();Eden.DB.isLoggedIn()?(eden.project.authorid!=Eden.DB.userid&&-1!=eden.project.authorid?e.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox">List publically</input></div>Thumbnail: <input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'):e.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox">List publically</input></div><input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button upload">Save</button><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'),e.sharebox.find("#projectoptions").show()):(e.sharebox.find("#projectuploadbox").html('<div class="sharebox-save-buttons"><button class="sharebox-button local" title="Save in your browser for offline use">Local</button><span class="downloadurl"></span></div>'),e.sharebox.find("#projectoptions").hide());var i=this.sharebox.find("#projectthumb");this.thumbdata=void 0,this.thumbimg=$("<img></img>"),this.thumbimg.get(0).style.border="1px solid #aaa",this.thumbimg.get(0).style.marginRight="10px",i.append(this.thumbimg),eden.project.thumb?(e.thumbdata=eden.project.thumb,e.thumbimg.get(0).src=eden.project.thumb):e.thumbdata=void 0,void 0===eden.project.id&&(eden.project.tags=(eden.project.title.toLowerCase()+" "+(Eden.DB.isLoggedIn()?Eden.DB.username.toLowerCase():"")).split(" ")),e.markdown.setValue(eden.project.getDescription()),e.projectsource=eden.project.generate();var n="data:application/octet-stream,"+encodeURIComponent(e.projectsource);e.sharebox.find(".downloadurl").html('<a class="sharebox-button download" href="'+n+'" download="'+t+'.js-e">File</a>')},EdenUI.SearchBox=function(e){var t=this;this.element=e,e.on("click",".menubar-search-result",function(e){var i=e.currentTarget.getAttribute("data-id");i&&""!=i?t.updateSymbolDetails(e.currentTarget,i):script&&script}),e.on("click",".edit-result",function(e){}),e.on("click",".script-goto",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");t.element.hide(),Eden.Selectors.goto("@external "+i)}),e.on("click",".script-import",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");Eden.Selectors.query(i,void 0,{minimum:1,options:{external:!0,index:!0}},function(n){i&&""!=i&&(e.currentTarget.parentNode.parentNode.parentNode.setAttribute("data-imported","true"),t.updateSymbolDetails(e.currentTarget.parentNode.parentNode.parentNode,i))})})},EdenUI.SearchBox.prototype.updateSymbolDetails=function(e,t){console.log("Update details",t);e.getAttribute("data-imported");var i=e.getAttribute("data-remote");Eden.Selectors.query("@history "+t,"id,path,source,type,value,active,tags,rawcomment,historic",{minimum:1,options:{external:!0}},function(t){if(0!=t.length){(t=t[0])[0];var n=t[1],s=t[2],o=t[3],a=t[4],r=t[5],d=(t[6],t[7]),l=t[8];d&&(d=new Eden.AST.DoxyComment(d));var c=$(e).find(".doxy-search-details");null!==c&&0!=c.length||(c=$('<div class="doxy-search-details"></div>'),e.appendChild(c.get(0))),c=c.get(0),"assignment"!=o&&"definition"!=o||(symstr=s,""==e.firstChild.className?e.firstChild.innerHTML=EdenUI.Highlight.html(symstr):e.childNodes[1].innerHTML=EdenUI.Highlight.html(symstr));var h="";if(l?h="":"true"==i?(h+="<p>",h+='<button class="script-button script-goto">View</button></p>'):h='<p><button class="script-button script-goto">View</button>',d){var p=d.pretty();p&&p.length>0&&(h+=p)}r?(h+="<p>",h+="<span style='color: #666;'><b>Path:</b> "+n+"</span><br>",h+="<b>Current Value:</b> "+EdenUI.Highlight.html(Eden.edenCodeForValue(a),!0,!1),h+="</p>"):(h+="<p>",h+="<span style='color: #666;'><b>Path:</b> "+n+"</span>",h+="</p>"),c.innerHTML=h}else console.log("No result")})},EdenUI.SearchBox.prototype.makeStatementResult=function(e){var t,i="",n="",s="";-1==e.executed&&(n=" historic");var o=e.getOrigin();"script"==e.type?(o&&o.remote?(s+=' data-remote="true"',e.indexed&&(s+=' data-imported="true"'),i='<span class="search-scriptres">&#xf08e;</span>'):i='<span class="search-scriptres">&#xf15c;</span>',t=e.doxyComment&&e.doxyComment.getProperty("title")?e.doxyComment.getProperty("title")[0]:e.name?"action "+e.name:e.getInnerSource()):"when"==e.type?(e.enabled&&(i='<span class="search-scriptres">&#xf00c;</span>'),t=e.prefix.trim()):(e.lvalue&&eden.root.symbols[e.lvalue.name]&&eden.root.symbols[e.lvalue.name].origin&&eden.root.symbols[e.lvalue.name].origin.id==e.id&&(i='<span class="search-scriptres">&#xf00c;</span>'),e.getSource()||console.error("NO SOURCE",e),t=e.getSource().split("\n")[0]),t.length>55&&(t=t.substr(0,55)+"..."),t=EdenUI.Highlight.html(t);var a="";if(e.doxyComment){var r=e.doxyComment.brief();r&&r.length>0&&(a='<div class="doxy-search-details"><p>'+r+"</p></div>")}return $('<div class="menubar-search-result'+n+'" data-id="'+Eden.Selectors.getID(e)+'"'+s+">"+i+t+a+"</div>")},EdenUI.SearchBox.prototype.makeScriptResult=function(e){},EdenUI.SearchBox.prototype.updateSearch=function(e){if(e&&""!=e){this.element.show();var t=this;Eden.Selectors.query(e,void 0,{minimum:1,options:{external:!0}},function(e){t.element.html("");var i=$('<div class="menubar-search-outer"></div>'),n=$('<div class="menubar-search-results"></div>');i.append(n),t.element.append(i);var s=0,o=8,a=0,r=eden.root.lookup("jseden_search_projects").value();for(s=0;s<e.length;s++)if(r||void 0!==e[s].parent||0!=e[s].executed){if(a>=o)break;var d;a++,d=t.makeStatementResult(e[s]),n.append(d)}s<e.length&&function i(){var a=$('<div class="menubar-search-more">&#xf078;</div>');n.append(a),a.on("click",function(){n.html("");for(var a=0;s<e.length&&!(a>o);s++){var r;a++,r=e[s]instanceof Symbol?t.makeSymbolResult(e[s]):t.makeStatementResult(e[s]),n.append(r)}s<e.length&&i()})}()})}else this.element.hide()},EdenUI.ScriptBox=function(e,t){this.changeCB=void 0,this.outer=e,this.savecb=void 0,this.contents=$(this.outer),this.contents.html('<div class="scriptbox-inputhider"><textarea autofocus tabindex="1" class="hidden-textarea" style="height: 5px;"></textarea><div class="scriptbox-codearea"></div></div><div class="scriptbox-outputbox"><div class="scriptbox-statement"><div class="scriptbox-output" contenteditable="true" spellcheck="false"></div></div></div><div class="info-bar"></div></div>'),this.currentstatement=void 0,this.statements={},this.$codearea=this.contents.find(".scriptbox-codearea"),this.codearea=this.$codearea.get(0),this.intextarea=this.contents.find(".hidden-textarea").get(0),this.inputhider=this.contents.find(".scriptbox-inputhider").get(0),this.outdiv=this.contents.find(".scriptbox-output").get(0),this.$codearea.sortable({revert:100,handle:".grippy",distance:10,axis:"y",scroll:!1}),this.infobox=this.contents.find(".info-bar").get(0),this.outputbox=this.contents.find(".scriptbox-outputbox").get(0),this.suggestions=this.contents.find(".eden_suggestions"),this.suggestions.hide(),$(this.infobox).hide(),this.highlighter=new EdenUI.Highlight(this.outdiv),this.enable(),this.ast=void 0,this.refreshentire=!0,this.dirty=!0,this.rebuildtimer=void 0,this.rebuildtimeout=10,this.currentlineno=1,this.currentcharno=0,this.dragint=!1,this.dragline=-1,this.dragvalue=0,this.draglast=0,this.history=void 0,window.localStorage?this.history=JSON.parse(window.localStorage.getItem("console_history"))||[]:this.history=[],this.historyindex=this.history.length;var i=this;this.contents.on("input",".hidden-textarea",function(e){i.dirty=!0,i.rebuild()}).on("keydown",".hidden-textarea",function(e){if(i.ast&&i.ast.script&&!i.ast.hasErrors()&&13==e.keyCode&&"EOF"==i.ast.token&&i.intextarea.selectionStart>=i.ast.script.end)return i.history.push(i.ast.stream.code),i.historyindex=i.history.length,window.localStorage&&window.localStorage.setItem("console_history",JSON.stringify(i.history)),$(i.outdiv).find(".fake-caret").remove(),i.$codearea.append($('<div class="scriptbox-historic">'+i.outdiv.innerHTML+"</div>")),i.ast.execute(EdenUI.ScriptBox.consoleAgent,function(e){let t=e||i.ast.lastresult;void 0!==t&&(t instanceof Promise?t.then(e=>{console.log("Result",e),i.$codearea.append($('<div class="scriptbox-value">'+EdenUI.Highlight.html(Eden.edenCodeForValue(e))+"</div>"))}):(console.log("Result",t),i.$codearea.append($('<div class="scriptbox-value">'+EdenUI.Highlight.html(Eden.edenCodeForValue(t))+"</div>"))))}),i.inputhider.scrollTop=i.inputhider.scrollHeight,i.setSource(""),void e.preventDefault();if(e.altKey)187==e.keyCode||61==e.keyCode?e.preventDefault():189==e.keyCode||173==e.keyCode?e.preventDefault():48==e.keyCode&&e.preventDefault();else if(e.ctrlKey||17==e.keyCode||16==e.keyCode){if(e.ctrlKey)if(e.shiftKey){if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||36==e.keyCode||35==e.keyCode)return i.setCaretToFakeCaret(),void i.outdiv.focus()}else 38===e.keyCode?onPrevious():40===e.keyCode?onNext():86===e.keyCode||65===e.keyCode&&(e.preventDefault(),i.outdiv.focus())}else if(9==e.keyCode){e.preventDefault();var t=i.intextarea.selectionStart,n=i.intextarea.selectionEnd;i.intextarea.value=i.intextarea.value.substring(0,t)+"\t"+i.intextarea.value.substring(n),i.intextarea.selectionStart=i.intextarea.selectionEnd=t+1,i.rebuild()}else if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||36==e.keyCode||35==e.keyCode){if(e.shiftKey)return i.setCaretToFakeCaret(),void i.outdiv.focus();38==e.keyCode?i.historyindex>0&&(i.historyindex--,i.setSource(i.history[i.historyindex]),e.preventDefault()):40==e.keyCode&&(i.historyindex<i.history.length-1?(i.historyindex++,i.setSource(i.history[i.historyindex]),e.preventDefault()):(i.historyindex=i.history.length,i.setSource(""))),i.updateLineCachedHighlight()}else(13==e.keyCode||8==e.keyCode&&10==i.intextarea.value.charCodeAt(i.intextarea.selectionStart-1))&&(i.refreshentire=!0)}).on("keyup",".hidden-textarea",function(e){e.altKey||(e.ctrlKey||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode&&36!=e.keyCode&&35!=e.keyCode?(e.ctrlKey||8!=e.keyCode||""!=i.intextarea.value)&&i.rebuild():(i.updateLineCachedHighlight(),36==e.keyCode||e.keyCode))}).on("paste",".hidden-textarea",function(e){i.refreshentire=!0}).on("keydown",".scriptbox-output",function(e){if(!e.altKey)if("pointer"==i.outdiv.style.cursor&&(i.outdiv.style.cursor="initial"),16==e.keyCode||17==e.keyCode||e.ctrlKey&&67==e.keyCode);else if(!e.shiftKey||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode&&35!=e.keyCode&&36!=e.keyCode){var t=getCaretCharacterOffsetWithin(i.outdiv,i.shadow),n=getStartCaretCharacterOffsetWithin(i.outdiv,i.shadow);i.intextarea.focus(),i.intextarea.selectionEnd=t,i.intextarea.selectionStart=n,n!=t&&(i.refreshentire=!0)}}).on("keyup",".scriptbox-output",function(e){}).on("paste",".scriptbox-output",function(e){i.intextarea.focus(),setTimeout(function(){i.updateEntireHighlight()},0)}).on("blur",".hidden-textarea",function(e){$(i.outdiv).find(".fake-caret").remove(),i.hideInfoBox()}).on("focus",".hidden-textarea",function(e){}).on("mouseup",".scriptbox-output",function(e){if(i.hideInfoBox(),document.activeElement===i.outdiv){var t=getCaretCharacterOffsetWithin(i.outdiv,i.shadow);if(getStartCaretCharacterOffsetWithin(i.outdiv,i.shadow)!=t)i.refreshentire=!0;else{var n=i.currentlineno;i.intextarea.focus(),i.intextarea.selectionEnd=t,i.intextarea.selectionStart=t,i.ast&&(i.highlighter.highlight(i.ast,n,t),i.updateLineCachedHighlight())}}}).on("click",".scriptbox-gutter",function(e){var t=parseInt(e.currentTarget.getAttribute("data-statement")),n=Eden.Statement.statements[t];if(n.statement&&0==n.statement.errors.length)n.statement.execute(eden.root,n.ast,n.ast,eden.root.scope),"when"==n.statement.type&&(Eden.Statement.active[n.id]=!Eden.Statement.active[n.id],changeClass(e.currentTarget,"active",Eden.Statement.active[n.id]));else if(n.ast&&n.ast.script){var s=n.ast.script.errors[0];i.showInfoBox(e.target.offsetLeft+20,e.target.offsetTop-i.codearea.scrollTop+25,"error",s.messageText())}i.updateLineCachedHighlight()}).on("click",".scriptbox-sticky",function(e){e.currentTarget.className.indexOf("stuck")>=0?changeClass(e.currentTarget,"stuck",!1):changeClass(e.currentTarget,"stuck",!0)}).on("click",".scriptbox-valueclose",function(e){var t=e.currentTarget.parentNode.parentNode,n=parseInt(t.getAttribute("data-statement"));t.removeChild(i.valuedivs[n][0]),delete i.valuedivs[n]}).on("mousedown",".scriptbox-statement",function(e){if(-1==i.dragline&&(void 0===i.outdiv||e.currentTarget!==i.outdiv.parentNode)){var t=parseInt(e.currentTarget.getAttribute("data-statement"));i.moveTo(t)}}),this.setSource(""),setInterval(function(){for(var e in i.valuedivs){var t=Eden.Statement.statements[e];if(t){var n=EdenUI.htmlForStatement(t,30,30);t.isActive();i.valuedivs[e].innerHTML='<div class="eden-line">'+n+"</div>"}}},200)},EdenUI.ScriptBox.consoleAgent={local:!1,name:"*Console"},EdenUI.ScriptBox.prototype.focus=function(){if(this.outdiv.focus(),document.activeElement===this.outdiv){var e=this.intextarea.value.length,t=this.currentlineno;this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=e,this.ast&&(this.highlighter.highlight(this.ast,t,e),this.updateLineCachedHighlight())}},EdenUI.ScriptBox.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0),t=document.createRange(),i=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),i.removeAllRanges(),i.addRange(t),$(this.outdiv).remove(".fake-caret")},EdenUI.ScriptBox.prototype.setChangeCB=function(e){this.savecb=e},EdenUI.ScriptBox.prototype.hideInfoBox=function(){$(this.infobox).hide("fast")},EdenUI.ScriptBox.prototype.showInfoBox=function(e,t,i,n){console.log("SHOW INFO BOX "+n),"warning"==i?this.infobox.innerHTML="<div class='info-warnitem'><span>"+n+"</span></div>":"error"==i&&(this.infobox.innerHTML="<div class='info-erroritem'><span>"+n+"</span></div>");var s=$(this.infobox);s.css("top",t+"px"),s.css("left",e+"px"),$(this.infobox).show()},EdenUI.ScriptBox.prototype.disable=function(){if(this.outdiv){changeClass(this.outdiv,"goto",!1),this.valuedivs[this.currentstatement]=this.outdiv;var e=EdenUI.htmlForStatement(Eden.Statement.statements[this.currentstatement],30,30);this.valuedivs[this.currentstatement].innerHTML='<div class="eden-line">'+e+"</div>",changeClass(this.outdiv.parentNode,"readonly",!0),this.ast}},EdenUI.ScriptBox.prototype.enable=function(){this.outdiv&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv.parentNode,"readonly",!1),this.ast&&this.highlighter.highlight(this.ast,-1,-1))},EdenUI.ScriptBox.prototype.setSource=function(e){this.intextarea.value=e,this.ast=new Eden.AST(e,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),this.highlightContent(this.ast,-1,0),this.intextarea.focus(),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):""==e?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0),this.outdiv.contentEditable=!0},EdenUI.ScriptBox.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.ast=new Eden.AST(this.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),this.highlighter.ast=this.ast,this.runScript(e),this.highlightContent(this.ast,e,t),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0)},EdenUI.ScriptBox.prototype.updateLineCachedHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(this.ast,e,t)},EdenUI.ScriptBox.prototype.updateEntireHighlight=function(e){this.ast=new Eden.AST(this.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),this.highlighter.ast=this.ast;var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),e&&this.runScript(0),this.highlightContent(this.ast,-1,t),this.ast.script&&0==this.ast.script.errors.length||console.log("indicated error")},EdenUI.ScriptBox.prototype.highlightContent=function(e,t,i){if(this.highlighter.highlight(e,t,i),e.mainDoxyComment&&(-1==t||t>=1&&t<=e.mainDoxyComment.endline)){var n=e.mainDoxyComment.content.match(/@[a-z]+.*\n/gi);if(n)for(var s=0;s<n.length;s++){var o=n[s].search(/\s/);if(o>=0)n[s].substring(0,o),n[s].substr(o).trim()}}document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret");var a=this;$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(e,t){var i;if((i=a.dragint?Math.round(a.dragvalue+(t.position.left-a.dragstart)/2):(i=a.dragvalue+.005*(t.position.left-a.dragstart)).toFixed(4))!=a.draglast){a.draglast=i,e.target.innerHTML=""+i;var n=e.target.parentNode.textContent;"\n"==n.charAt(n.length-1)&&(n=n.slice(0,-1)),a.replaceLine(a.dragline,n),a.ast=new Eden.AST(a.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),a.highlighter.ast=a.ast,a.highlightContent(a.ast,a.dragline,-1),Eden.Statement.statements[a.currentstatement].setSource(a.intextarea.value,a.ast)}},start:function(e,t){a.edited=!0,a.dragline=a.findElementLineNumber(e.target),a.dragstart=t.position.left;var i=e.target.textContent;-1==i.indexOf(".")?(a.dragvalue=parseInt(i),a.dragint=!0):(a.dragvalue=parseFloat(i),a.dragint=!1),a.draglast=a.dragvalue,$(e.target).addClass("eden-select"),$(a.outdiv).css("cursor","ew-resize")},stop:function(e,t){$(e.target).removeClass("eden-select"),$(a.outdiv).css("cursor","text"),a.dragline=-1},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptBox.prototype.clear=function(){this.$codearea.html(""),this.setSource("")},EdenUI.ScriptBox.prototype.getLineNumber=function(e){var t=e.value.substr(0,e.selectionStart).split("\n");return this.currentlineno=t.length,this.currentcharno=t[t.length-1].length,this.currentlineno},EdenUI.ScriptBox.prototype.doRebuild=function(){this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight()},EdenUI.ScriptBox.prototype.runScript=function(e){},EdenUI.ScriptBox.prototype.rebuild=function(){clearTimeout(this.rebuildtimer);var e=this;this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptBox.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;for(var i=0;i<this.outdiv.childNodes.length;i++)if(this.outdiv.childNodes[i]===t)return i;return-1},EdenUI.ScriptBox.prototype.replaceLine=function(e,t){var i=this.intextarea.value.split("\n");i[e]=t,this.intextarea.value=i.join("\n")},EdenUI.Explorer=function(){var e=this;this.element=$(`<div class="explore-main">\n<div class="explore-tabs">\n\t<div class="explore-tab-container">\n\t\t<div class="explore-tab explore-tab-current" data-name="state">${Language.ui.explorer.state}</div>\n\t\t<div class="explore-tab explore-tab-notcurrent" data-name="scripts">Agents</div>\n\t\t<div class="explore-tab explore-tab-notcurrent" data-name="debug">Debug</div>\n\t\t<div class="explore-tab explore-tab-notcurrent" data-name="settings">Settings</div>\n`+`\t</div>\n</div>\n<div class="explore-state">\n</div>\n<div class="explore-script" style="display: none">\n</div>\n<div class="explore-debug" style="display: none">\n</div>\n<div class="explore-settings" style="display: none">\n\t<div style="font-size: 8pt">Note: Many of these do not work yet.</div>\n\t<h1>Environment</h1>\n\t<div id="explorerenvsettings" class="explorer-settings-list"></div>\n\t<h1>Project</h1>\n\t<div id="explorerprojectsettings" class="explorer-settings-list"></div>\n\t<h1>Menu Bar</h1>\n\t<div id="explorermenusettings" class="explorer-settings-list"></div>\n\t<h1>Peer-2-Peer</h1>\n\t<div id="explorerp2psettings" class="explorer-settings-list"></div>\n\t<h1>Search</h1>\n\t<div id="explorersearchsettings" class="explorer-settings-list"></div>\n\t<h1>Parser</h1>\n\t<div id="explorerparsersettings" class="explorer-settings-list"></div>\n\t<h1>Script Views</h1>\n\t<div id="explorerscriptviewsettings" class="explorer-settings-list"></div>\n</div>\n<div class="explore-console">\n\t<div class="explore-console-buttons">\n\t\t<div style="margin-top: 4px; float: left;">${Language.ui.explorer.input}</div>\n\t\t<button class="control-button clear-button control-enabled" title="${Language.ui.tooltips.clear}" style="float: right;">&#xf05e;</button>\n\t</div>\n\t<div class="explore-console-code"></div>\n</div>\n</div>`),$("#jseden-main").append(this.element),this.consoleele=this.element.find(".explore-console-code"),this.expscripts=this.element.find(".explore-script"),this.expstate=this.element.find(".explore-state"),this.expdebug=this.element.find(".explore-debug"),this.expsettings=this.element.find(".explore-settings");var t=this.expsettings.find("#explorerenvsettings").get(0);this.addSetting(t,"jseden_autosave","Enable autosave to local storage","","boolean"),this.addSetting(t,"jseden_leaveprompt","Enable a leave page prompt","","boolean");t=this.expsettings.find("#explorerprojectsettings").get(0);this.addSetting(t,"jseden_feedback_disabled","Disable comments","","boolean"),this.addSetting(t,"jseden_project_noforking","Disable forking","","boolean"),this.addSetting(t,"jseden_project_liveupdate","Live update of imported scripts","","boolean");t=this.expsettings.find("#explorermenusettings").get(0);this.addSetting(t,"jseden_menu_visible","Menu visible","","boolean"),this.addSetting(t,"jseden_menu_showhelp","Show Help","","boolean"),this.addSetting(t,"jseden_menu_showsearch","Show Search","","boolean"),this.addSetting(t,"jseden_menu_showcreate","Show Create Views","","boolean"),this.addSetting(t,"jseden_menu_showexisting","Show Existing","","boolean"),this.addSetting(t,"jseden_menu_showshare","Show Share","","boolean"),this.addSetting(t,"jseden_explorer_enabled","Allow Spanner Panel","","boolean");t=this.expsettings.find("#explorerp2psettings").get(0);this.addSetting(t,"jseden_p2p_captureedits","Send script edits","","boolean"),this.addSetting(t,"jseden_p2p_captureinput","Send UI Events (Mouse...)","","boolean"),this.addSetting(t,"jseden_p2p_doactive","Copy all state on connect","","boolean"),this.addSetting(t,"jseden_p2p_clone","Send project on connect","","boolean"),this.addSetting(t,"jseden_p2p_record","Record collaboration","","boolean"),t=this.expsettings.find("#explorersearchsettings").get(0),this.addSetting(t,"jseden_search_history","Include Historic","","boolean"),this.addSetting(t,"jseden_search_external","Always include external","","boolean"),this.addSetting(t,"jseden_search_all","Don't make unique","","boolean"),this.addSetting(t,"jseden_search_nosort","Don't sort by time","","boolean"),this.addSetting(t,"jseden_search_projects","Include projects in results","","boolean"),t=this.expsettings.find("#explorerparsersettings").get(0),this.addSetting(t,"jseden_parser_strict","Strict mode","","boolean"),this.addSetting(t,"jseden_parser_noliterals","No literals in expressions","","boolean"),this.addSetting(t,"jseden_parser_noexprover","No override expressions","","boolean"),this.addSetting(t,"jseden_parser_warndeprecate","Show deprecation warnings","","boolean"),this.addSetting(t,"jseden_parser_errordeprecate","Make deprecated an error","","boolean"),this.addSetting(t,"jseden_parser_cs3","ConstruitScript3 Support","","boolean"),t=this.expsettings.find("#explorerscriptviewsettings").get(0),this.addSetting(t,"jseden_script_query","Default browse query","","text"),this.addSetting(t,"jseden_script_buttons","Show buttons","","boolean"),this.addSetting(t,"jseden_script_diffs","Enable diff feature","","boolean"),this.addSetting(t,"jseden_script_highlighting","Disable highlighting","","boolean"),this.addSetting(t,"jseden_script_styling","Disable comment styling","","boolean"),this.addSetting(t,"jseden_script_hidecomments","Hide all comments","","boolean"),this.addSetting(t,"jseden_script_readonly","All readonly","","boolean"),this.addSetting(t,"jseden_script_livepatch","Auto share edits with others","","boolean"),this.element.resizable({handles:"w",stop:function(e,t){eden.root.lookup("jseden_explorer_width").assign(t.element[0].clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent)}}),eden.root.lookup("jseden_explorer_width").assign(this.element.get(0).clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent),this.console=new EdenUI.ScriptBox(this.consoleele.get(0),{nobuttons:!0}),this.state=new EdenUI.ExplorerState(this.expstate),this.debug=new EdenUI.ExplorerDebug(this.expdebug),this.element.on("click",".clear-button",function(t){e.console.clear()}),this.element.on("click",".explore-tab",function(t){var i=t.currentTarget.getAttribute("data-name"),n=e.element.find(".explore-tab-current");n.removeClass("explore-tab-current"),n.addClass("explore-tab-notcurrent"),changeClass(t.currentTarget,"explore-tab-current",!0),changeClass(t.currentTarget,"explore-tab-notcurrent",!1),"state"==i?(e.expstate.css("display","flex"),e.expscripts.css("display","none"),e.expsettings.css("display","none"),e.expdebug.css("display","none")):"scripts"==i?(e.expstate.css("display","none"),e.expscripts.css("display","flex"),e.expsettings.css("display","none"),e.expdebug.css("display","none")):"debug"==i?(e.expstate.css("display","none"),e.expscripts.css("display","none"),e.expdebug.css("display","flex"),e.expsettings.css("display","none")):"palette"==i||"settings"==i&&(e.expstate.css("display","none"),e.expsettings.css("display","block"),e.expscripts.css("display","none"),e.expdebug.css("display","none"))});var i=eden.root.lookup("jseden_explorer_enabled");i.value()?e.state.show():(this.enabled=!1,this.element.hide(),e.state.hide()),i.addJSObserver("explorer",function(t,i){e.enabled=i,i?eden.root.lookup("jseden_explorer_visible").value()&&(e.element.show(),e.state.show()):(e.element.hide(),e.state.hide(),e.capture=!1)});var n=eden.root.lookup("jseden_explorer_visible");function s(e,t){window.localStorage.setItem(e.name,t)}n.value()?e.state.show():(this.element.hide(),e.state.hide()),n.addJSObserver("explorer",function(t,i){i&&e.enabled?(e.element.show(),e.state.show(),eden.root.lookup("jseden_explorer_width").assign(e.element.get(0).clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent)):(e.element.hide(),e.state.capture=!1,e.state.clear(),e.state.hide(),eden.root.lookup("jseden_explorer_width").assign(0,eden.root.scope,EdenSymbol.localJSAgent))});for(var o=["jseden_autosave","jseden_leaveprompt","jseden_explorer_enabled"],a=0;a<o.length;a++){var r=eden.root.lookup(o[a]);r.assign("true"==window.localStorage[o[a]],eden.root.scope,EdenSymbol.localJSAgent),r.addJSObserver("settings",s)}var d=eden.root.lookup("jseden_explorer_zoom"),l=d.value();d.addJSObserver("explorer",function(t,i){if("number"==typeof i&&i>0){var n=10*i;e.state.results.css("font-size",n+"pt")}}),void 0===l&&d.assign(1,eden.root.scope,EdenSymbol.defaultAgent)},EdenUI.Explorer.prototype.addSetting=function(e,t,i,n,s){var o=document.createElement("div");o.className="explorer-setting",o.title=n;var a=document.createElement("span");a.textContent=i,a.className="explorer-setting-label",o.appendChild(a);var r=document.createElement("input"),d=eden.root.lookup(t),l=d.value();switch(s){case"boolean":r.setAttribute("type","checkbox");break;case"string":r.setAttribute("type","text")}function c(e,t){e.orign instanceof InternalAgent||("boolean"==s?r.checked=t:r.value=t)}r.onchange=function(e){"boolean"==s?d.assign(r.checked,eden.root.scope,EdenSymbol.jsAgent):d.assign(r.value,eden.root.scope,EdenSymbol.jsAgent)},c(d,l),d.addJSObserver("settings",c),o.appendChild(r),e.appendChild(o)},EdenUI.Explorer.MAXHIGHLIGHTLENGTH=1e3,EdenUI.Explorer.prototype.showConsole=function(){},EdenUI.Explorer.prototype.hideConsole=function(){},EdenUI.ExplorerState=function(e){var t=this;this.outer=e,this.controls=$(`<div class="explore-controls">\n\t\t<button class="explorer-control capture"><span class="explorer-control-icon">&#xf111;</span>${Language.ui.explorer.capture}</button>\n\t\t<button class="explorer-control clear"><span class="explorer-control-icon">&#xf05e;</span>${Language.ui.explorer.clear}</button>\n\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="${Language.ui.explorer.filter}"></input></span>\n\t</div>`),this.results=$('<div class="explore-symbols"></div>'),this.outer.append(this.controls),this.outer.append(this.results),this.searchbox=this.controls.find(".explorerfilter"),this.watchobs={},this.capture=!1,this.delay=100,this.delay2=20,this.timeout=void 0,this.timeout2=void 0,this.mode="tree",this.index={},this.todo={},this.filter=void 0,this.listener=function(e,i){var n=e.name;!t.capture||i==EdenSymbol.EXPIRED&&void 0!==t.watchobs[n]||void 0!==t.filter&&!t.filter[n]?(t.todo[n]=!0,void 0===t.timeout2&&(t.timeout2=setTimeout(function(){t.timeout2=void 0;var e=t.todo;for(var i in t.todo={},t.index)if(e[i]){var n=eden.root.symbols[i];if(void 0===n){for(var s=0;s<t.index[i].length;s++)t.removeEntry(i,t.index[i][s]);delete t.index[i]}else for(s=0;s<t.index[i].length;s++)t.updateEntry(n,t.index[i][s])}},t.delay2))):(void 0===t.watchobs[n]?t.watchobs[e.name]=1:t.watchobs[n].lastupdate=1,t.triggerUpdate())},this.controls.on("click",".clear",function(e){var t=eden.root.lookup("jseden_explorer_clear");t.eden_definition||t.assign(!0,eden.root.scope,EdenSymbol.localJSAgent)}),this.controls.on("click",".capture",function(e){var t=eden.root.lookup("jseden_explorer_capture");t.eden_definition||t.assign(!t.value(),eden.root.scope,EdenSymbol.localJSAgent)}),this.results.on("click",".explore-observable",function(e){var t=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");Eden.Selectors.goto(t+":active"),e.stopPropagation()}),this.results.on("click",".explore-expand-value",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");t.updateEntry(eden.root.lookup(i),e.currentTarget.parentNode,!0)}),this.results.on("click",".eden-path",function(e){var t=e.currentTarget.textContent;edenUI.gotoCode(t,-1)}),this.results.on("click",".symvalue",function(e){}),this.results.on("click",".explore-entry-icon",function(e){var i=e.currentTarget.parentNode.parentNode.parentNode,n=i.getAttribute("data-obs");if("true"==i.getAttribute("data-expanded")){e.currentTarget.innerHTML="&#xf067;",i.setAttribute("data-expanded","false");for(var s=i.firstChild;s;){var o=s.nextSibling;"DIV"==s.nodeName&&"explore-entry-inner"!=s.className&&0==s.className.includes("active")&&i.removeChild(s),s=o}}else{e.currentTarget.innerHTML="&#xf068;",i.setAttribute("data-expanded","true");var a=eden.root.symbols[n],r={};for(s=i.firstChild;s;)"DIV"==s.nodeName&&(r[s.getAttribute("data-obs")]=!0),s=s.nextSibling;for(var d in a.dependencies)if(!r[d]){var l=a.dependencies[d],c=!l,h=l&&l.definition,p=(n=d,$('<div class="explore-entry'+(c?" missing":"")+(h?" defined":"")+'" data-obs="'+n+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(h?"&#xf067;":" ")+'</span><span class="explore-observable">'+n+'</span> </span><div class="symvalue"></div></div></div>')),u=p.find(".symvalue").get(0);t.updateEntry(l,u),void 0===t.index[n]&&(t.index[n]=[]),t.index[n].push(u),i.appendChild(p.get(0))}}});var i=eden.root.lookup("jseden_explorer_search");i.value()&&this.searchbox.val(searchval),i.addJSObserver("explorer",function(e,i){void 0!==i&&"*JavaScript"!=e.origin.name&&t.searchbox.val(i)}),this.searchbox.on("keyup",function(e){void 0===i.definition&&i.assign(e.target.value,eden.root.scope,EdenSymbol.localJSAgent)});var n=eden.root.lookup("jseden_explorer_watch"),s=n.value();Array.isArray(s)&&(this.clear(),this.watch(s)),n.addJSObserver("explorer",function(e,i){Array.isArray(i)&&(t.capture?t.filter=void 0:t.clear(),t.watch(i))});var o=eden.root.lookup("jseden_explorer_capture");o.addJSObserver("explorer",function(e,i){i?(t.record(),t.controls.find(".capture").addClass("active")):(t.capture=!1,t.controls.find(".capture").removeClass("active"))}),o.value()&&t.record(),eden.root.lookup("jseden_explorer_clear").addJSObserver("explorer",function(e,i){i&&t.clear()})},EdenUI.ExplorerState.prototype.show=function(){eden.root.addGlobal(this.listener)},EdenUI.ExplorerState.prototype.hide=function(){eden.root.removeGlobal(this.listener)},EdenUI.ExplorerState.prototype.triggerUpdate=function(){if(void 0===this.timeout){var e=this;this.timeout=setTimeout(function(){e.index={},e.timeout=void 0,"list"==e.mode?e.updateList():"tree"==e.mode?e.updateTree():"graph"==e.mode&&e.updateGraph()},this.delay)}},EdenUI.ExplorerState.prototype.updateList=function(){},EdenUI.ExplorerState.prototype.makeAgentEntry=function(e){var t,i,n=e.name;if(n.startsWith("*Console"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf108;</span> <b>console</b></div>');if(n.startsWith("*When"))return t=(i=(i=(t=n.split(":"))[1].split("/"))[i.length-1])+":"+t[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">when</span> <span class="eden-path">'+t+"</span></div>");if(n.startsWith("*Action"))return t=(i=(i=(t=n.split(":"))[1].split("/"))[i.length-1])+":"+t[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">action</span> <span class="eden-path">'+t+"</span></div>");if("/"==n.charAt(0)){if(e.eden_definition&&e.eden_definition.startsWith("proc"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">proc</span> <span class="eden-path">'+n+"</span></div>")}else if("*"!=n.charAt(0))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf15c;</span><span class="eden-path">'+n+"</span></div>")},EdenUI.ExplorerState.prototype.removeEntry=function(e,t){t.innerHTML='<span style="font-weight: bold; color: red">DELETED</span>',delete this.watchobs[e],this.triggerUpdate()},EdenUI.ExplorerState.prototype.updateEntry=function(e,t,i){if(e){var n,s,o=e.value();if("function"==typeof o)s='<span class="eden-keyword">func</span>';else{var a;if(i)n=(a=Eden.edenCodeForValue(o,void 0,2)).length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(a,!0):a;else if(Array.isArray(o)&&o.length>2)n='[.. <span class="explore-expand-value">&#xf0fe;</span> ..]';else n=(a=Eden.edenCodeForValue(o,void 0,2)).length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(a,!0):a;s=(e.eden_definition?'<span class="eden-keyword">is</span>':"<b>=</b>")+" "+n}t.innerHTML=s}},EdenUI.ExplorerState.prototype.makeEntry=function(e,t,i){var n=eden.root.symbols[e],s=!1,o=!1;n&&n.definition&&(o=!0),n||(s=!0);var a=$('<div class="explore-entry'+(i?" active":"")+(s?" missing":"")+(o?" defined":"")+'" data-obs="'+e+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(o?"&#xf067;":" ")+'</span><span class="explore-observable">'+e+'</span> </span><div class="symvalue"></div></div></div>'),r=a.find(".symvalue").get(0);o&&n.origin&&(a.get(0).title=n.origin.getSource()),this.updateEntry(n,r),void 0===this.index[e]&&(this.index[e]=[]),this.index[e].push(r);if(t)for(var d in t)0,a.append(this.makeEntry(d,t[d],i));return a},EdenUI.ExplorerState.prototype.updateTree=function(){var e=this.capture?Eden.Query.dependencyTree(this.watchobs):this.watchobs;for(var t in this.results.html(""),e)this.results.append(this.makeEntry(t,this.capture?e[t]:void 0,this.capture))},EdenUI.ExplorerState.prototype.watch=function(e){this.capture,void 0===this.filter&&e.length>0&&(this.filter={});for(var t=0;t<e.length;t++)void 0!==e[t]&&(this.filter[e[t]]=!0,this.capture||(this.watchobs[e[t]]={elements:[],lastupdate:1}));this.triggerUpdate()},EdenUI.ExplorerState.prototype.record=function(){this.watchobs={},this.triggerUpdate(),this.capture=!0},EdenUI.ExplorerState.prototype.clear=function(){this.watchobs={},this.filter=void 0,this.triggerUpdate()},EdenUI.ExplorerState.prototype.displayAsTree=function(){},EdenUI.ExplorerState.prototype.displayAsList=function(){},EdenUI.ExplorerState.prototype.displayAsGraph=function(){},EdenUI.ExplorerState.prototype.search=function(e){},EdenUI.ExplorerScripts=function(e){this.outer=e,this.controls=$('<div class="explore-controls">\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="Filter..."></input></span>\t</div>'),this.scripts=$('<div class="explore-scripts"></div>'),this.outer.append(this.controls),this.outer.append(this.scripts)},EdenUI.ExplorerScripts.prototype.buildScriptTree=function(e){for(var t={},i=0;i<e.length;i++)for(var n=e[i].split(/[\.\:]+/),s=t,o=0;o<n.length;o++)void 0===s[n[o]]&&(s[n[o]]={}),s=s[n[o]];return t},EdenUI.ExplorerScripts.prototype.makeEntry=function(e,t){for(var i in t){var n=$('<div class="explore-sentry"><div class="explore-script-inner"><span class="explore-entry-icon">&#xf067;</span>'+i+"</div></div>");this.makeEntry(n,t[i]),e.append(n)}},EdenUI.ExplorerScripts.prototype.update=function(){this.scripts.html("");var e=Eden.Selectors.query(">> script:has-name","id"),t=this.buildScriptTree(e),i=[],n=[];for(var s in Eden.Selectors.cache)n.push(s),i.push(Eden.Selectors.cache[s]);(e=Eden.Selectors.queryWithin(i,">> script:has-name","id")).push.apply(e,n);var o={External:this.buildScriptTree(e)};this.makeEntry(this.scripts,t),this.makeEntry(this.scripts,o)},EdenUI.ExplorerDebug=function(e){var t=!1,i=void 0,n=500,s=$('<div class="debugger"></div>'),o=$('<div class="debugger-controls"><button title="Toggle capture all agents" style="margin-left: 20px; margin-right: 20px;" class="debugger-button debug">&#xf188;</button><button class="debugger-button play" title="Auto Play">&#xf04b;</button><button class="debugger-button stepforward">&#xf051;</button><button class="debugger-button autostep">&#xf050;</button><input type="range" class="debugger-speed" value="500" max="1000" min="50"></input></div>');s.append(o);var a=$('<div class="debugger-agents"></div>');s.append(a);var r={};Eden.AST.debugstep_cb=function(e){var i=e.agent;if(console.log("DEBUG",e),e.statement&&"dummy"==e.statement.type)return e.next();if(r[i.id]){var s=r[i.id].html;if(r[i.id].data=e,!1,s){if(r[i.id].lastline&&(r[i.id].lastline.className="eden-line"),e.statement!==i){var o=e.statement.getStartLine(i),a=s.get(0).childNodes[1].childNodes[o];r[i.id].lastline=a,a?a.className="eden-line debugger-line":console.error("Missing line: "+o)}}else console.error("Missing output")}t&&setTimeout(e.next,n)};Eden.AST.debug_begin_cb=function(e){var t,n=e.agent;console.log("BEGIN DEBUG",n.id),r.hasOwnProperty(n.id)?t=r[n.id].html:(t=$('<div class="debugger-agent" data-agent="'+n.id+'"><div class="debugger-agent-controls"></div><div class="debugger-code"></div></div>'),a.append(t),r[n.id]={html:t,data:e}),void 0===i&&(i=r[n.id],t.get(0).className="debugger-agent active");var s=function(e){var t="";return e.getSource&&(t+=e.getSource()),t}(n),o=new Eden.AST(s,void 0,n);new EdenUI.Highlight(t.get(0).childNodes[1]).highlight(o,-1,-1)};Eden.AST.debug_end_cb=function(e){var t=e.agent;console.log("END DEBUG",t.id),void 0!==t.id&&void 0!==r[t.id]&&i===r[t.id]&&(!1,i=void 0)},Eden.AST.debug=!0,Eden.AST.debugstep=!1,e[0].appendChild(s[0]),o.on("click",".play",function(e){(t=!t)?(e.currentTarget.innerHTML="&#xf04c;",e.currentTarget.className="debugger-button play active"):(e.currentTarget.innerHTML="&#xf04b;",e.currentTarget.className="debugger-button play")}).on("click",".stepforward",function(e){i&&i.data.next&&(i.data.next(),i&&(i.data.next=void 0))}).on("click",".debug",function(e){Eden.AST.debugstep=!Eden.AST.debugstep,Eden.AST.debugstep?e.currentTarget.className="debugger-button debug active":e.currentTarget.className="debugger-button debug"}).on("change",".debugger-speed",function(e){n=e.currentTarget.value,console.log("Change speed: "+n)}),a.on("click",".debugger-agent",function(e){i&&(i.html.get(0).className="debugger-agent"),(i=r[e.currentTarget.getAttribute("data-agent")]).html.get(0).className="debugger-agent active"})},EdenUI.Markdown=function(e){this.contents=document.createElement("div"),this.contents.className="markdown-inputhider",this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.intextarea.value=e,this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="markdown-inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contentEditable=!0,this.outdiv.className="markdown-outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.highlighter=new EdenUI.Highlight(this.outdiv,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0},brline:!0});new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.updateLineCachedHighlight()},EdenUI.Highlight.prototype.MARKDOWN=function(){"#"==this.token&&(this.stream.position-2<=0||"\n"==this.stream.code.charAt(this.stream.position-2))?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE",this.lineelement.className=this.styles["comment-line"]):"##"==this.token&&(this.stream.position-3<=0||"\n"==this.stream.code.charAt(this.stream.position-3))?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE2",this.lineelement.className=this.styles["comment-line"]):this.COMMENT()},EdenUI.Markdown.styles={comment:"","hidden-comment":"markdown-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",string:"eden-string",keyword:"eden-keyword",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"markdown-comment-h1","comment-h2":"markdown-comment-h2","comment-h3":"eden-comment-h3","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"markdown-comment-line",doxytag:"markdown-tag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote",script:"eden-script"},EdenUI.Markdown.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.Markdown.prototype.hideInfoBox=function(){},EdenUI.Markdown.prototype.disableGotoMode=function(){},EdenUI.Markdown.prototype.rebuild=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.updateLineCachedHighlight=function(){var e=new Eden.AST(this.intextarea.value,void 0,{},{noparse:!0,noindex:!0}),t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,this.getLineNumber(this.intextarea)),this.highlighter.highlight(e,-1,t)},EdenUI.Markdown.prototype.setValue=function(e){this.intextarea.value=e,this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.moveCaret=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.checkScroll=function(){},EdenUI.Markdown.prototype.enableGotoMode=function(){},EdenUI.Markdown.prototype.focusText=function(){var e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=t},EdenUI.Markdown.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.Markdown.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0);if(e){var t=document.createRange(),i=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),i.removeAllRanges(),i.addRange(t),$(this.outdiv).remove(".fake-caret")}},EdenUI.Markdown.html=function(e,t,i){var n=document.createElement("div"),s=new EdenUI.Highlight(n,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0},brline:!0});if(EdenUI.Markdown.styles["hidden-comment"]="eden-comment-hidden",EdenUI.Markdown.styles["script-line"]="markdown-comment-line2",s.ast={stream:new EdenStream(e)},s.highlight(s.ast,-1,-1,void 0),EdenUI.Markdown.styles["hidden-comment"]="markdown-comment-hidden",EdenUI.Markdown.styles["script-line"]="markdown-comment-line",t)return n.childNodes[0].innerHTML;for(var o="",a=0;a<n.childNodes.length;a++)o+=n.childNodes[a].innerHTML;return i?'<div style="display: flex; align-items: center;"><div class="eden-hl-play" data-src="'+e+'">&#xf04b;</div><div>'+o+"</div></div>":o},EdenUI.ProjectDetails=function(e,t){var i=this;this.projectid=e,this.meta=void 0,this.newtab=t;var n=mobilecheck();this.obscurer=$('<div class="modal" style="display: block;"></div>'),this.obscurer.on("click",function(e){e.target===e.currentTarget&&i.remove()}),this.dialog=n?$('<div class="modal-content"></div>'):$('<div class="modal-content" style="width: 600px"></div>'),this.obscurer.append(this.dialog),document.body.appendChild(this.obscurer.get(0)),Eden.DB.getMeta(e,function(t){if(console.log("DETAILS META",t),null!==t[0].image){var n=$('<img class="projectdetails-thumb" src="'+t[0].image+'"></img>');i.dialog.append(n)}console.log(t[0].projectMetaData);var s=null!==t[0].projectMetaData?JSON.parse(t[0].projectMetaData):{},o=document.createElement("div");o.className="markdown";var a=new showdown.Converter,r=s&&s.description?s.description.replace(/\@author[^\n]*/g,"").replace(/\s(#[a-zA-Z0-9]+)/g,' <span class="markdown-hashtag">$1</span>'):"",d=t[0].ownername;if(s&&s.description){var l=new Eden.AST.DoxyComment(s.description,0,0).getProperty("author");if(l&&l.length>0){if(d=l[0]+(l.length>1?" et al.":""),l.length>1){r+="\n\n__Authors:__";for(var c=0;c<l.length;c++)r+=" "+l[c],c<l.length-1&&(r+=",")}l[0]!=t[0].ownername&&(r+="\n\n__Published by:__ "+t[0].ownername)}else d=t[0].ownername}var h=a.makeHtml(r);o.innerHTML=h,i.dialog.get(0).appendChild(o);var p=t[0].date.split(/[- :]/),u=null!==t[0].overallRating?t[0].overallRating/t[0].numRatings:0,m=$('<div class="projectdetails">\t\t\t<span class="projectdetails-rateavg">'+u.toFixed(1)+'</span><span><span class="projectdetails-label">by:</span><span class="projectdetails-value">'+d+'</span></span>\t\t\t<span>, <span class="projectdetails-value">'+get_time_diff(new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5]).getTime()/1e3)+"</span></span>\t\t</div>"),g=$('<div class="projectdetails-rating"><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span></div>');i.dialog.append(g),i.dialog.append(m),g.on("click",".projectdetails-star",function(t){if(0!=Eden.DB.isLoggedIn()){for(var i=t.currentTarget.parentNode,n=0,s=0;s<5;s++)i.childNodes[s].className="projectdetails-star"+(n>0?"":" selected"),i.childNodes[s].innerHTML="&#xf005;",i.childNodes[s]===t.currentTarget&&(n=s+1);Eden.DB.rate(e,n)}});var v=g[0];if(u){var f=Math.floor(u);for(c=0;c<5;c++)v.childNodes[c].className="projectdetails-star"+(c>=f?"":" average"),v.childNodes[c].innerHTML="&#xf005;"}var b,E=t[0].myrating;if(E)for(c=0;c<5;c++)v.childNodes[c].className="projectdetails-star"+(c>=E?"":" selected"),v.childNodes[c].innerHTML="&#xf005;";(b=t[0].owner==Eden.DB.userid?$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="deleteproject script-button"><span class="explorer-control-icon">&#xf00d;</span>Delete</button><br></div>'):$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="followproject script-button" style="float: right"><span class="explorer-control-icon">&#xf09e;</span>Follow</button><br></div>')).on("click",".openproject",function(){i.remove(),i.newtab?window.open(window.location.origin+window.location.pathname+"?load="+e):($(".loadmodal").show(),Eden.DB.log("open",{pid:e}),Eden.Project.load(e))}),b.on("click",".deleteproject",function(){confirm("Are you sure you want to delete this project?")&&(i.remove(),Eden.DB.log("delete",{pid:e}),Eden.DB.remove(e))}),b.on("click",".restoreproject",function(){i.remove(),eden.root.lookup("jseden_project_mode").assign("restore",eden.root.scope,Symbol.defaultAgent),Eden.Project.load(e)}),b.on("click",".followproject",function(t){Eden.DB.follow(e,function(e){e&&t.currentTarget.parentNode.removeChild(t.currentTarget)})}),b.append($('<iframe src="https://www.facebook.com/plugins/like.php?href='+encodeURIComponent(window.location.href+"?load="+e)+'&width=350&layout=standard&action=like&size=small&show_faces=false&share=true&height=80&appId=1447073055317881" width="300" height="20" style="border:none;overflow:hidden;margin-left:5px;margin-top:5px;" scrolling="no" frameborder="0" allowTransparency="true"></iframe>')),i.dialog.append(b),Eden.DB.search(":parent("+e+")",1,1,void 0,function(t){if(t.length>0){var n=document.createElement("div");n.className="projectdetails-forks";for(var s=0;s<t.length;s++){var a=document.createElement("div");a.className="projectdetails-fork";var r=t[s].date.split(/[- :]/);a.innerHTML='Forked as "'+t[s].title+'" by '+t[s].ownername+" "+get_time_diff(new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]).getTime()/1e3),n.appendChild(a)}i.dialog.get(0).insertBefore(n,o.nextSibling)}Eden.DB.searchComments({id:e},"",1,3,void 0,function(e){var t=new showdown.Converter;if(e.length>0){var n=document.createElement("div");n.style.borderTop="1px solid #aaa",n.style.height="10px",i.dialog.get(0).appendChild(n)}for(var s=0;s<e.length;s++){var o=document.createElement("div"),a=document.createElement("div"),r=e[s].date.split(/[- :]/);a.className="feedback-header",a.innerHTML='<span class="feedback-author">'+e[s].name+'</span><span class="feedback-date" data-date="'+e[s].date+'">'+get_time_diff(new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]).getTime()/1e3)+"</span>",o.appendChild(a);var d=document.createElement("div");d.style.padding="0",d.style.marginBottom="3px",d.className="markdown",o.appendChild(d),o.className="feedback-result",d.innerHTML=t.makeHtml(e[s].comment),i.dialog.get(0).appendChild(o)}})})})},EdenUI.ProjectDetails.prototype.remove=function(){document.body.removeChild(this.obscurer.get(0))},EdenUI.ProjectDetails.searchProjects=function(e,t,i,n,s,o){var a=i||7,r=1;e.on("click",".more",function(i){e.find(".more").remove(),r++,Eden.DB.search(t,r,a,o,function(i){EdenUI.ProjectDetails._searchProjects(t,e,!t.startsWith(":me"),i,a,r,s)}),i.stopPropagation()}),t||(t=""),Eden.DB.search(t,1,a,o,function(i){EdenUI.ProjectDetails._searchProjects(t,e,!t.startsWith(":me"),i,a,r,s),n&&n(i)})},EdenUI.ProjectDetails._searchProjects=function(e,t,i,n,s,o,a){var r=s||7;if(void 0!==n){for(var d=mobilecheck()?120:200,l=0;l<n.length;l++){var c,h,p=n[l],u=p.date.split(/[- :]/),m=p.title,g=p.image,v=!1,f=null!==p.projectMetaData?JSON.parse(p.projectMetaData):void 0;if(i)if(f&&f.description){var b=new Eden.AST.DoxyComment(f.description,0,0).getProperty("author");c=b&&b.length>0?b[0]:p.ownername}else c=p.ownername;else c=get_time_diff(new Date(u[0],u[1]-1,u[2],u[3],u[4],u[5]).getTime()/1e3),null===p.publicVersion&&(v=!0);h=null!==g?$('<div class="cadence-plisting-entry project noselect'+(v?" locked":"")+'" data-pid="'+p.projectID+'"><div class="cadence-plisting-img"><img width="'+d+'" src="'+g+'"></img></div><div class="cadence-plisting-title">'+m+'</div><div class="cadence-plisting-subtitle">'+c+"</div></div>"):$('<div class="cadence-plisting-entry project noselect'+(v?" locked":"")+'" data-pid="'+p.projectID+'"><div class="cadence-plisting-icon">&#xf0c3;</div><div class="cadence-plisting-title">'+m+'</div><div class="cadence-plisting-subtitle">'+c+"</div></div>"),t.append(h),h.click(function(e){var t=e.currentTarget.getAttribute("data-pid");Eden.DB.log("view",{pid:t}),new EdenUI.ProjectDetails(t,a)});var E=null!==p.overallRating?p.overallRating/p.numRatings:0,y=$('<div class="projectdetails-ratingsmall"><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span></div>');h.append(y);var x=y.get(0);if(E)for(var k=Math.floor(E),C=0;C<5;C++)x.childNodes[C].className="projectdetails-star"+(C>=k?"":" average")}n.length==r&&t.append($('<div class="cadence-plisting-entry more noselect"><div class="cadence-plisting-icon more">&#xf103;</div></div>'))}},EdenUI.ProjectDetails.localProjects=function(e,t,i){if(void 0!==t)for(var n=0;n<t.length;n++){var s,o,a=t[n],r=a.title,d=a.image;if(a.description){var l=new Eden.AST.DoxyComment(a.description,0,0).getProperty("author");s=l&&l.length>0?l[0]:a.author}else s=a.author;o=null!==d?$('<div class="cadence-plisting-entry project noselect" data-path="'+a.name+'"><div class="cadence-plisting-img"><img src="'+d+'"></img></div><div class="cadence-plisting-title">'+r+'</div><div class="cadence-plisting-subtitle">'+s+"</div></div>"):$('<div class="cadence-plisting-entry project noselect" data-path="'+a.name+'"><div class="cadence-plisting-icon">&#xf0c3;</div><div class="cadence-plisting-title">'+r+'</div><div class="cadence-plisting-subtitle">'+s+"</div></div>"),e.append(o),o.click(function(e){var t=e.currentTarget.getAttribute("data-path");console.log("Load project: "+t),Eden.Project.newFromExisting(t,function(){})});var c=a.rating;if(c){var h=$('<div class="projectdetails-ratingsmall">\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t</div>');o.append(h);var p=h.get(0);if(c)for(var u=Math.floor(c),m=0;m<5;m++)p.childNodes[m].className="projectdetails-star"+(m>=u?"":" average")}}},EdenUI.Feedback=function(){var e=document.createElement("div");e.className="feedback-icon noselect",e.innerHTML="&#xf0e6;",e.title=Language.ui.tooltips.comments,document.getElementById("jseden-views").appendChild(e),this.odialog=document.createElement("div"),this.odialog.className="feedback-dialog",this.odialog.style.display="none",mobilecheck()&&(this.odialog.style.width="90%"),document.getElementById("jseden-views").appendChild(this.odialog),this.dialog=document.createElement("div"),this.dialog.className="feedback-scroller",this.odialog.appendChild(this.dialog);var t=document.createElement("div");t.className="feedback-title",t.innerHTML=`<span class="feedback-icon2">&#xf0e6;</span><span class="feedback-title-text">${Language.ui.comments.comments}</span><span class="feedback-close">&#xf00d;</span>`,this.dialog.appendChild(t);var i=eden.root.lookup("jseden_feedback_visible"),n=eden.root.lookup("jseden_feedback_width");eden.root.lookup("jseden_feedback_disabled").addJSObserver("feedback",function(t,i){e.style.display=i?"none":"inherit"});var s=this;function o(e,t){var i;t?(s.odialog.style.display="initial",s.clear(),s.updateComments(""),clearInterval(s.interval),s.interval=setInterval(function(){s.updateComments("")},5e3)):(s.odialog.style.display="none",clearInterval(s.interval),s.interval=setInterval(function(){Eden.DB.searchComments(eden.project,"",1,10,i,function(e){if(e){if(void 0===i&&e.length>0)return void(i=e[0].commentID);for(var t=0;t<e.length;t++)edenUI.menu.notifications.notification("comment","New comment by "+e[t].name);e.length>0&&(i=e[0].commentID,s.cache=e.concat(s.cache))}})},1e4))}e.addEventListener("click",function(e){void 0===i.definition&&i.assign(!0,eden.root.scope,Symbol.hciAgent)}),t.childNodes[2].addEventListener("click",function(e){void 0===i.definition&&i.assign(!1,eden.root.scope,Symbol.hciAgent)}),n.assign(420,eden.root.scope,Symbol.defaultAgent),i.addJSObserver("feedback",o),o(0,i.value());var a=new EdenUI.Markdown(""),r=document.createElement("div");r.className="feedback-input",r.appendChild(a.contents);var d=document.createElement("div");d.className="feedback-buttons";var l=document.createElement("div");l.textContent=Language.ui.comments.signin,l.style.display="none",l.className="feedback-signinmsg",this.dialog.appendChild(l),Eden.DB.isLoggedIn()||(r.style.display="none",d.style.display="none",l.style.display="block"),this.dialog.appendChild(r),this.dialog.appendChild(d),this.results=document.createElement("div"),this.dialog.appendChild(this.results),this.results.addEventListener("click",function(e){"feedback-delete"==e.srcElement.className?(console.log("delete",e.srcElement.getAttribute("data-id")),Eden.DB.removeComment(e.srcElement.getAttribute("data-id")),s.results.removeChild(e.srcElement.parentNode.parentNode)):"eden-hl-play"==e.srcElement.className&&(console.log("PLAY COMMENT",e.srcElement.getAttribute("data-src")),eden.execute2(e.srcElement.getAttribute("data-src")))});var c=document.createElement("button");c.className="script-button",c.textContent="Comment",d.appendChild(c),c.addEventListener("click",function(){Eden.DB.log("postcomment",{pid:eden.project?eden.project.id:-1,content:a.intextarea.value}),Eden.DB.postComment(eden.project,a.intextarea.value),a.setValue(""),s.updateComments("")}),this.cache=[],setInterval(function(){s.updateTimes()},2e4),Eden.DB.listenTo("login",this,function(e){e&&(r.style.display="block",d.style.display="block",l.style.display="none")})},EdenUI.Feedback.prototype.clear=function(){for(this.cache=[];this.results.lastChild;)this.results.removeChild(this.results.lastChild)},EdenUI.Feedback.prototype.updateTimes=function(){for(var e=0;e<this.results.childNodes.length;e++){var t=this.results.childNodes[e].childNodes[0].childNodes[1],i=t.getAttribute("data-date").split(/[- :]/);t.textContent=get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)}},EdenUI.Feedback.prototype.updateComments=function(e){var t=this,i=new showdown.Converter,n=this.cache.length>0?this.cache[0].commentID:void 0,s=this.results.firstChild;Eden.DB.searchComments(eden.project,e,1,100,n,function(e){if(e){for(var o=0;o<e.length;o++){var a=document.createElement("div"),r=document.createElement("div"),d=e[o].date.split(/[- :]/);r.className="feedback-header",r.innerHTML='<span class="feedback-author">'+e[o].name+'</span><span class="feedback-date" data-date="'+e[o].date+'">'+get_time_diff(new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5]).getTime()/1e3)+(e[o].author==Eden.DB.userid?'</span><span class="feedback-delete" data-id="'+e[o].commentID+'">&#xf00d;</span>':""),a.appendChild(r);var l=document.createElement("div");l.style.padding="0",l.style.marginBottom="3px",l.className="markdown",a.appendChild(l),a.className="feedback-result"+(n?" newitem":""),l.innerHTML=i.makeHtml(e[o].comment),s?t.results.insertBefore(a,s):t.results.appendChild(a),$(l).find("code").each(function(e,t){"PRE"==t.parentNode.nodeName&&(t.innerHTML=EdenUI.Highlight.html(t.textContent,!1,!0))})}t.cache=e.concat(t.cache)}})};