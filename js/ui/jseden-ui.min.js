!function(a){function b(a,b,c,d){function e(){f.insertBefore(b,g)}var f=b.parentNode,g=b.nextSibling;return f?(f.removeChild(b),"boolean"!=typeof c&&(d=c,c=!1),void(d&&c?d.call(a,b,e):d&&(d.call(a,b),e()))):void d.call(a,b)}EdenUI.Highlight=function(a,b){this.ast=void 0,this.outelement=a,this.line=1,this.currentline=-1,this.mode_at_line={},this.heredocend=void 0,this.scrolltop=-1,this.token=void 0,this.prevtoken=void 0,this.modestack=[],this.linestack=void 0,this.outerline=void 0,this.lineelement=void 0,this.startmode=b&&b.start?b.start:"START",this.styles=b&&b.styles?b.styles:EdenUI.Highlight.defaultStyles,this.clearmodes=b&&b.clearmodes?b.clearmodes:EdenUI.Highlight.lineclearmode,this.mode=this.startmode,this.metrics={}},EdenUI.Highlight.defaultStyles={comment:"eden-comment","hidden-comment":"eden-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",string:"eden-string",keyword:"eden-keyword",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"eden-comment-h1","comment-h2":"eden-comment-h2","comment-h3":"eden-comment-h3","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"eden-line-script",doxytag:"eden-doxytag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote"},EdenUI.Highlight.prototype.pushLine=function(){this.linestack.push(this.lineelement)},EdenUI.Highlight.prototype.pushMode=function(){this.modestack.push(this.mode)},EdenUI.Highlight.prototype.popLine=function(){this.linestack.length>0&&(this.lineelement=this.linestack.pop())},EdenUI.Highlight.prototype.popMode=function(){this.modestack.length>0&&(this.mode=this.modestack.pop())},EdenUI.Highlight.prototype.setScrollTop=function(a){this.scrolltop=a},EdenUI.Highlight.isType=function(a){return!1},EdenUI.Highlight.lineclearmode={COMMENT:!0,SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE3:!0,SECTION_TITLE4:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,SECTION_TITLE_H3:!0,SECTION_TITLE_H4:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,COMMENT_BOLD_END:!0,COMMENT_QUERY:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0,COMMENT_HTML:!0,COMMENT_HTML_START:!0,COMMENT_HTML_CONTENT:!0},EdenUI.Highlight.prototype.highlightLine=function(a,b){var c=-1,d=-1,e="",f=!1,g=a.stream;this.stream=g;var h=!1,i="INVALID",j="INVALID";this.outerline="eden-line",this.linestack=[],this.mode_at_line[this.line-1]?this.mode=this.mode_at_line[this.line-1]:this.mode=this.startmode,EdenUI.Highlight.lineclearmode[this.mode]&&(this.mode=this.startmode),a.script&&a.script.errors.length>0&&(c=a.script.errors[0].prevposition,d=a.script.errors[0].position,e=a.script.errors[0].messageText());var k="",l=document.createElement("div");for(l.className=this.styles["script-line"];;){if(g.position==b){if(""!=k){var m=document.createTextNode(k);l.appendChild(m),k=""}var n=document.createElement("span");n.className="fake-caret",l.appendChild(n);for(var o=l;o&&"DIV"==o.nodeName;){if(o.className.startsWith(this.styles["comment-line"])){o.className+=" current";break}o=o.parentNode}}var p=g.peek();if(10==p||13==p){if(""!=k){if(l.lastChild&&l.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=l.lastChild.className)if(l.lastChild.lastChild&&"#text"==l.lastChild.lastChild.nodeName)l.lastChild.lastChild.textContent+=k;else{var m=document.createTextNode(k);l.lastChild.appendChild(m)}else{var m=document.createTextNode(k);l.appendChild(m)}k=""}break}if(9!=p&&13!=p&&32!=p&&160!=p){if(""!=k){if(l.lastChild&&l.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=l.lastChild.className)if(l.lastChild.lastChild&&"#text"==l.lastChild.lastChild.nodeName)l.lastChild.lastChild.textContent+=k;else{var m=document.createTextNode(k);l.lastChild.appendChild(m)}else{var m=document.createTextNode(k);l.appendChild(m)}k=""}if(j=i,i=g.readToken(),"string"!=typeof i&&console.error("Token error: line = "+this.line+" position = "+g.position),"EOF"==i){if(""!=k){if(l.lastChild&&l.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=l.lastChild.className)if(l.lastChild.lastChild&&"#text"==l.lastChild.lastChild.nodeName)l.lastChild.lastChild.textContent+=k;else{var m=document.createTextNode(k);l.lastChild.appendChild(m)}else{var m=document.createTextNode(k);l.appendChild(m)}k=""}break}if("INVALID"!=i)if(this.token=i,this.prevtoken=j,this.type=g.tokenType(i),this.classes="",this.tokentext=g.tokenText(),this.lineelement=l,c!=-1&&(c<=g.prevposition&&!f&&(f=!0),d<=g.prevposition&&f&&(f=!1),f&&(h=!0)),f&&"EOF"!=a.script.errors[0].token&&(this.classes+="eden-error "),void 0===this[this.mode]&&console.error("No Mode",this.mode),this[this.mode].call(this),l=this.lineelement,g.prevposition<b&&g.position>b){var n=b-g.prevposition,q=this.tokentext.slice(0,n),r=this.tokentext.slice(n),s=document.createElement("span");s.className=this.classes,"eden-observable"==this.classes&&s.setAttribute("data-observable",this.tokentext);var t=document.createElement("span");t.appendChild(document.createTextNode(q)),s.appendChild(t);var n=document.createElement("span");n.className="fake-caret",s.appendChild(n),t=document.createElement("span"),t.appendChild(document.createTextNode(r)),s.appendChild(t),l.appendChild(s);for(var o=l;o&&"DIV"==o.nodeName;){if(o.className.startsWith(this.styles["comment-line"])){o.className+=" current";break}o=o.parentNode}}else if(l.lastChild&&l.lastChild.className==this.classes){var t=l.lastChild;t.lastChild&&"#text"==t.lastChild.nodeName?t.lastChild.textContent+=this.tokentext:t.appendChild(document.createTextNode(this.tokentext))}else{var t=document.createElement("span");t.className=this.classes,"eden-observable"==this.classes&&t.setAttribute("data-observable",this.tokentext),t.appendChild(document.createTextNode(this.tokentext)),l.appendChild(t)}else console.log("INVALID: "+g.peek()),g.skip()}else g.skip(),32==p||160==p?k+=" ":13!=p&&(k+=String.fromCharCode(p))}return this.linestack.length>0&&(l=this.linestack[0]),this.mode_at_line[this.line]=this.mode,l},EdenUI.Highlight.prototype.highlightExactLine=function(a,b,c){this.ast=a,this.line=1;var d=-1,e=-1,f="",g=a.stream;if(void 0!==this.outelement){a.script&&a.script.errors.length>0&&(d=a.script.errors[0].prevposition,e=a.script.errors[0].position,f=a.script.errors[0].messageText()),g.reset();for(var h=void 0,i=!1,j=0;g.valid()&&this.line<b;){var k=g.peek();10!=k&&13!=k||this.line++,g.skip(),13==k&&g.skip()}this.line=b,this.metrics[this.line]&&delete this.metrics[this.line];var l=this.outelement.childNodes[b-1];if(void 0!==l){for(;l.lastChild;)l.removeChild(l.lastChild);j=g.position,h=this.highlightLine(a,c),i=j<=d&&g.position>=e,l.appendChild(h),l.className=this.outerline;var k=g.peek(),m=document.createTextNode("\n");l.appendChild(m),g.skip(),13==k&&g.skip()}}},EdenUI.Highlight.prototype.highlight=function(a,c,d,e){this.ast=a,this.line=1;var f=-1,g=-1,h="",i=a.stream;if(void 0!==this.outelement){if(0==a.stream.code.length)return void(this.outelement&&(this.outelement.innerHTML="<div class='eden-line'><span class='fake-caret'></span></div>"));a.script&&a.script.errors.length>0&&(f=a.script.errors[0].prevposition,g=a.script.errors[0].position,h=a.script.errors[0].messageText()),i.reset();var j=void 0,k=!1,l=0;if(c==-1)this.metrics={},b(this,this.outelement,!1,function(){for(;this.outelement.lastChild;)this.outelement.removeChild(this.outelement.lastChild);for(this.mode_at_line={};i.valid();){var b=i.peek();if(10!=b&&13!=b)if(this.scrolltop>=0&&(this.line<this.scrolltop-105||this.line>this.scrolltop+105)){var c,h=i.code.indexOf("\n",i.position);h==-1?(c=i.code.substring(i.position),i.position=i.code.length):(c=i.code.substring(i.position,h),i.position=h),j=document.createTextNode(c)}else j=this.highlightLine(a,d);else{k=l<=f&&i.position>=g;var m=document.createElement("div");m.className=this.outerline,e&&e.spacing&&e.spacing[this.line]&&(m.height=""+e.spacing[this.line]+"px"),m.setAttribute("data-line",this.line-1),this.line++,void 0!==j?m.appendChild(j):this.mode_at_line[this.line-1]=this.mode;var n=document.createTextNode("\n");m.appendChild(n),this.outelement.appendChild(m),l=i.position+1,j=void 0,i.skip(),13==b&&i.skip(),this.outerline="eden-line"}}if(k=l<=f&&i.position>=g,void 0!==j){var m=document.createElement("div");m.className="eden-line",m.style.height=""+(e&&e.spacing&&e.spacing[this.line]?e.spacing[this.line]:20)+"px",m.setAttribute("data-line",this.line-1),m.appendChild(j),this.outelement.appendChild(m)}else{var m=document.createElement("div");if(d>=i.position){m.className="eden-line",m.style.height=""+(e&&e.spacing&&e.spacing[this.line]?e.spacing[this.line]:20)+"px",m.setAttribute("data-line",this.line-1);var o=document.createElement("span");o.className="fake-caret",m.appendChild(o)}else m.className="eden-line";this.outelement.appendChild(m)}});else{for(;i.valid()&&this.line<c-1;){var m=i.peek();10!=m&&13!=m||this.line++,i.skip(),13==m&&i.skip()}for(var n=2;n>=0;n--){this.line=c-n+1,this.metrics[this.line]&&delete this.metrics[this.line];var o=this.outelement.childNodes[c-n];if(void 0!==o){for(;o.lastChild;)o.removeChild(o.lastChild);l=i.position,j=this.highlightLine(a,d),k=l<=f&&i.position>=g,o.appendChild(j),o.className=this.outerline;var m=i.peek(),p=document.createTextNode("\n");o.appendChild(p),i.skip(),13==m&&i.skip()}}for(;void 0!==this.mode_at_line[this.line+1]&&this.mode_at_line[this.line]!=this.mode_at_line[this.line+1];){this.line++,this.metrics[this.line]&&delete this.metrics[this.line];var o=this.outelement.childNodes[this.line-1];if(void 0!==o){for(;o.lastChild;)o.removeChild(o.lastChild);l=i.position,j=this.highlightLine(a,d),k=l<=f&&i.position>=g,o.appendChild(j),o.className=this.outerline;var m=i.peek(),p=document.createTextNode("\n");o.appendChild(p),i.skip(),13==m&&i.skip()}}}}},EdenUI.Highlight.html=function(a,b){var c=document.createElement("div"),d=new EdenUI.Highlight(c);if(d.ast={stream:new EdenStream(a)},d.highlight(d.ast,-1,-1,void 0),b)return c.childNodes[0].innerHTML;for(var e="",f=0;f<c.childNodes.length;f++)e+=c.childNodes[f].innerHTML;return e}}("undefined"!=typeof window?window:global);var edenFunctions={apply:!0,array:!0,canvasURL:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,doDefault:!0,edenCode:!0,escapeRE:!0,foldl:!0,foldr:!0,hasProperty:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,positionInList:!0,positionOfRE:!0,substringPosition:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,distanceMoved:!0,angleTurned:!0,List:!0,listcat:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,Menu:!0,MenuItem:!0,min:!0,mod:!0,nameof:!0,partApply:!0,Point:!0,pow:!0,properties:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,RE:!0,replaceFirst:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundMultiple:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sort:!0,str:!0,sqrt:!0,strcat:!0,sublist:!0,substitute:!0,substr:!0,sum:!0,tail:!0,trim:!0,type:!0,uppercase:!0,include_css:!0,html:!0,time:!0,execute:!0,Text:!0,textWidth:!0,textHeight:!0,Arc:!0,Curve:!0,FillPattern:!0,Ellipse:!0,Line:!0,LinearGradient:!0,LineSequence:!0,PixelList:!0,GreyPixelList:!0,Rectangle:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,CombinedRotation:!0,Scale:!0,Translate:!0,RoundedRectangle:!0,Polygon:!0,RegularPolygon:!0,Sector:!0,Shadow:!0,Circle:!0,Button:!0,Checkbox:!0,Div:!0,Image:!0,imageWithZones:!0,HTMLImage:!0,RadioButtons:!0,Slider:!0,Textbox:!0,DropDownList:!0,Combobox:!0,BulletSlide:!0,Video:!0,Audio:!0,Slide:!0,TitledSlide:!0,TitleSlide:!0,cos:!0,sin:!0,tan:!0,abs:!0,acos:!0,asin:!0,atan:!0,ceil:!0,roundUp:!0,exp:!0,floor:!0,roundDown:!0,log:!0,random:!0,forget:!0,forgetAll:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observableOnTopAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnBottomAt:!0,shapesAt:!0,zonesAt:!0,observablesAt:!0,observableForShape:!0,alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showObservables:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0},edenSpecials={autocalc:!0,mouseX:!0,mouseY:!0,mousePosition:!0,screenHeight:!0,screenWidth:!0,PI:!0},edenValues={true:!0,false:!0,green:!0},jskeywords={var:!0,if:!0,while:!0,typeof:!0,this:!0,function:!0,return:!0,else:!0,break:!0,continue:!0,switch:!0,for:!0,prototype:!0};EdenUI.Highlight.prototype.START=function(){switch(this.token){case"##":"INVALID"==this.prevtoken?(this.classes+=this.styles["hidden-comment"],this.mode="SECTION_TITLE",this.lineelement.className=this.styles["comment-line"],32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes+=this.styles.comment,this.mode="COMMENT");break;case"#":if("INVALID"==this.prevtoken||";"==this.prevtoken){var a=33==this.stream.peek();a&&(this.tokentext+="!",this.stream.position++),this.classes+=this.styles["hidden-comment"],this.mode="COMMENT","INVALID"==this.prevtoken&&(this.lineelement.style.marginLeft="0");var b=document.createElement("div");b.className=a?this.styles["comment-line"]+" "+this.styles.doxycomment:this.styles["comment-line"],this.pushLine(),this.lineelement.appendChild(b),this.lineelement=b,32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)}else this.classes+=this.styles.operator;break;case"local":case"para":case"handle":case"oracle":case"auto":this.classes+=this.styles.storage;break;case"NUMBER":this.classes+=this.styles.number;break;case"STRING":this.classes+=this.styles.string;break;case"BOOLEAN":this.classes+=this.styles.constant;break;case"CHARACTER":this.classes+=this.styles.string;break;case"import":case"do":this.classes+=this.styles.keyword,this.mode="SELECTOR";break;case"${{":this.classes+=this.styles.javascript,this.mode="JAVASCRIPT";break;case"?":this.classes+=this.styles.selector,this.mode="SELECTOR";break;case"<<":var c=(this.stream.readToken(),this.stream.tokenText());this.tokentext+=c,this.heredocend=c,this.classes+=this.styles.storage,this.mode="HEREDOC";break;case"OBSERVABLE":edenFunctions[this.stream.data.value]?this.classes+=this.styles.function:EdenUI.Highlight.isType(this.stream.data.value)?this.classes+=this.styles.type:edenValues[this.stream.data.value]?this.classes+=this.styles.constant:edenSpecials[this.stream.data.value]?this.classes+=this.styles.special:this.classes+=this.styles.observable;break;case"`":this.pushMode(),this.mode="BACKTICK",this.pushLine();var b=document.createElement("span");b.className=this.styles.backticks,this.lineelement.appendChild(b),this.lineelement=b;break;default:"keyword"==this.type?this.classes+=this.styles.keyword:"-"==this.token&&this.stream.isNumeric(this.stream.peek())?(this.token=this.stream.readToken(),this.tokentext="-"+this.stream.tokenText(),this.classes+=this.styles.number):"/*"==this.token?42==this.stream.peek()?(this.mode="DOXY_COMMENT",this.classes+=this.styles["block-comment"]):(this.mode="BLOCK_COMMENT",this.classes+=this.styles["block-comment"]):this.classes+=this.styles.operator}},EdenUI.Highlight.prototype.BACKTICK=function(){"`"==this.token?this.mode="ENDBACKTICK":"}"==this.token?(this.popMode(),this.classes+=this.styles.operator):this.START()},EdenUI.Highlight.prototype.ENDBACKTICK=function(){this.popLine(),this.popMode(),this.START()},EdenUI.Highlight.prototype.SELECTOR=function(){this.pushLine();var a=document.createElement("span");a.className=this.styles.pathblock,this.lineelement.appendChild(a),this.lineelement=a,this.mode="SELECTOR2",this.SELECTOR2()},EdenUI.Highlight.prototype.SELECTOR2=function(){"{"==this.token?(this.classes+=this.styles.operator,this.pushMode(),this.mode=this.startmode):"["==this.token?(this.classes+=this.styles.selector,this.mode="SELECTOR_TYPES"):";"==this.token||"="==this.token?(this.popLine(),this.classes+=this.styles.operator,this.mode=this.startmode):"::"==this.token||"with"==this.token?(this.popLine(),this.classes+=this.styles.keyword,this.mode=this.startmode):"OBSERVABLE"!=this.token||"."!=this.prevtoken&&":"!=this.prevtoken||!Eden.Selectors.PropertyNode.attributes[this.tokentext]&&!Eden.Selectors.PropertyNode.pseudo[this.tokentext]?this.classes+=this.styles.selector:this.classes+=this.styles.selector2},EdenUI.Highlight.prototype.SELECTOR_TYPES=function(){"OBSERVABLE"==this.token&&Eden.Selectors.resultTypes[this.tokentext]?this.classes+="eden-selector3":"]"==this.token?(this.classes+="eden-selector",this.mode="SELECTOR2"):this.classes+="eden-selector"},EdenUI.Highlight.prototype.JAVASCRIPT=function(){this.classes+=this.styles.javascript,"}}$"==this.token&&(this.mode=this.startmode)},EdenUI.Highlight.prototype.HEREDOC=function(){"INVALID"==this.prevtoken&&this.tokentext==this.heredocend?(this.classes+=this.styles.storage,this.mode=this.startmode):this.classes+=this.styles.string},EdenUI.Highlight.prototype.SECTION_TITLE=function(){"#"==this.token?(this.classes+=this.styles["hidden-comment"],this.lineelement.className+=" "+this.styles["comment-h2"],this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):"##"==this.token?(this.classes+=this.styles["hidden-comment"],this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.lineelement.className+=" "+this.styles["comment-h1"],this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE2=function(){"#"==this.token?(this.classes+=this.styles["hidden-comment"],this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes+=this.styles["comment-h2"],this.mode="SECTION_TITLE_H2")},EdenUI.Highlight.prototype.SECTION_TITLE3=function(){"#"==this.token?(this.classes+=this.styles["hidden-comment"],this.mode="SECTION_TITLE4",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes+=this.styles["comment-h3"],this.mode="SECTION_TITLE_H3")},EdenUI.Highlight.prototype.SECTION_TITLE4=function(){this.classes+=this.styles["comment-h4"],this.mode="SECTION_TITLE_H4"},EdenUI.Highlight.prototype.SECTION_TITLE_H1=function(){this.classes+=this.styles["comment-h1"]},EdenUI.Highlight.prototype.SECTION_TITLE_H2=function(){this.classes+=this.styles["comment-h2"]},EdenUI.Highlight.prototype.SECTION_TITLE_H3=function(){this.classes+=this.styles["comment-h3"]},EdenUI.Highlight.prototype.SECTION_TITLE_H4=function(){this.classes+=this.styles["comment-h4"]},EdenUI.Highlight.prototype.BLOCK_COMMENT=function(){switch(this.token){case"*/":this.mode=this.startmode,this.classes+=this.styles["block-comment"];break;default:this.classes+=this.styles["block-comment"]}},EdenUI.Highlight.prototype.COMMENT=function(){switch(this.token){case"@":case"#":this.mode="COMMENT_TAG",this.pushLine();var a=document.createElement("span");a.className=this.styles.doxytag,this.lineelement.appendChild(a),this.lineelement=a;break;case"-":case"*":if("##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek())"-"!=this.token?(this.pushMode(),this.mode="COMMENT_EMPH",this.classes+=this.styles["hidden-comment"]):this.classes+=this.styles.comment;else{this.pushLine();var a=document.createElement("span");a.className=this.styles["comment-ul"],this.lineelement.appendChild(a),this.lineelement=a,this.classes+=this.styles["hidden-comment"]}break;case"--":if(45==this.stream.peek()){for(this.outerline="eden-line eden-section-line";45==this.stream.peek();)this.tokentext+="-",this.stream.position++;this.classes+=this.styles["hidden-comment"]}else this.classes+=this.styles.comment;break;case"[":32!=this.stream.peek()?(this.mode="COMMENT_LINK",this.classes+=this.styles["hidden-comment"]):this.classes+=this.styles.comment;break;case"!":91==this.stream.peek()?(this.mode="COMMENT_IMAGE",this.tokentext+="[",this.stream.position++,this.classes+=this.styles["hidden-comment"]):this.classes+=this.styles.comment;break;case">":"##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek()?this.classes+=this.styles.comment:(this.outerline+=" "+this.styles["comment-blockquote"],this.classes+=this.styles["hidden-comment"]);break;case"`":this.pushMode(),this.mode="COMMENT_CODE",this.classes+=this.styles["hidden-comment"];break;case":":32!=this.stream.peek()?(this.mode="COMMENT_ICON",this.classes+=this.styles["hidden-comment"]):this.classes+=this.styles.comment;break;case"<":32!=this.stream.peek()?(this.mode="COMMENT_HTML",this.classes+=this.styles["hidden-comment"]):this.classes+=this.styles.comment;break;case'"':this.pushMode(),this.mode="COMMENT_ESCAPE",this.classes+=this.styles["hidden-comment"];break;case"?":this.pushMode(),this.mode="COMMENT_QUERY",void 0==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].query=!0,void 0===this.metrics[this.line].qelements&&(this.metrics[this.line].qelements=[]),this.classes+=this.styles["hidden-comment"];break;default:this.classes+=this.styles.comment}},EdenUI.Highlight.prototype.COMMENT_QUERY=function(){if("("==this.token){for(var a=this.stream.peekLine(),b=0,c=-1,d=0;d<a.length;d++)if("("==a.charAt(d))b++;else if(")"==a.charAt(d)&&(b--,b<0)){c=d;break}if(c==-1)this.popMode(),this.classes+=this.styles["hidden-comment"];else{var e=a.substring(0,c);this.tokentext+=e+")",this.stream.position+=e.length+1,this.popMode(),this.classes+=this.styles["hidden-comment"];var f=document.createElement("span");f.className+=this.styles["comment-query"],this.lineelement.appendChild(f);var g=Eden.Selectors.query(e,"value");g=1==g.length?g[0]:g.length>1?g.join(", "):"",f.setAttribute("data-result",g),f.setAttribute("data-query",e),this.metrics[this.line].qelements.push(f)}}else this.popMode(),this.classes+=this.styles["hidden-comment"]},EdenUI.Highlight.prototype.COMMENT_LINK=function(){var a=this.stream.peekLine(),b=a.indexOf("]");if(b==-1)this.classes+=this.styles.comment,this.mode="COMMENT";else{var c=a.substring(0,b);this.tokentext+=c,this.stream.position+=b,this.classes+=this.styles.comment,this.mode="COMMENT_LINK_END";var d=a.substring(b+2);d.startsWith("http://"),this.pushLine();var e=document.createElement("a");e.setAttribute("target","_blank"),e.contentEditable=!1,this.lineelement.appendChild(e),this.lineelement=e}},EdenUI.Highlight.prototype.COMMENT_LINK_END=function(){var a=this.stream.peekLine(),b=a.indexOf(")");if(b==-1)this.classes+=this.styles["hidden-comment"],this.mode="COMMENT",this.popLine();else{var c=a.substring(0,b);this.tokentext+=c+")",this.stream.position+=b+1,this.classes+=this.styles["hidden-comment"],this.mode="COMMENT",this.lineelement.setAttribute("href",c.substring(1)),this.popLine()}},EdenUI.Highlight.prototype.COMMENT_IMAGE=function(){var a=this.stream.peekLine(),b=a.indexOf("]");if(b==-1)this.classes+=this.styles.comment,this.mode="COMMENT";else{var c=a.substring(0,b);console.log("IMG",this.tokentext),this.classes+=this.styles.comment,this.mode="COMMENT_IMAGE_END",this.pushLine();var d=document.createElement("img");d.title=c,d.style.verticalAlign="top",this.lineelement.appendChild(d),this.lineelement=d}},EdenUI.Highlight.prototype.COMMENT_IMAGE_END=function(){var a=this.stream.peekLine(),b=a.indexOf(")");if(b==-1)this.classes+=this.styles["hidden-comment"],this.mode="COMMENT",this.popLine();else{var c=a.substring(0,b);this.tokentext+=c+")",this.stream.position+=b+1,this.classes+=this.styles["hidden-comment"],this.mode="COMMENT",this.lineelement.setAttribute("src",c.substring(1)),this.popLine()}},EdenUI.Highlight.prototype.COMMENT_ESCAPE=function(){this.popMode(),this.classes+=this.styles.comment},EdenUI.Highlight.prototype.COMMENT_HTML=function(){var a=this.tokentext,b=this.stream.peekLine(),c=b.indexOf(">");if(c>=0){var d="<"+a+b.substring(0,c+1);this.tokentext=d.substring(1),this.cacheddata={opentag:d,tagname:a},this.classes+=this.styles["hidden-comment"],this.mode="COMMENT_HTML_START",this.stream.position+=c+1}else this.classes+=this.styles["hidden-comment"],this.mode="COMMENT"},EdenUI.Highlight.prototype.COMMENT_HTML_CONTENT=function(){if("<"!=this.token)this.COMMENT();else{var a=this.stream.peekLine(),b="/"+this.cacheddata.tagname+">",c=a.indexOf(b);c==-1?this.classes+=this.styles["hidden-comment"]:(this.cacheddata&&this.popLine(),this.tokentext+=b,this.stream.position+=c+b.length,this.classes+=this.styles["hidden-comment"]),this.mode="COMMENT"}},EdenUI.Highlight.prototype.COMMENT_HTML_START=function(){if("<"!=this.token){var a=this.cacheddata.opentag+d;this.mode="COMMENT_HTML_CONTENT",this.pushLine();var b=$(a).get(0);b.contentEditable=!1,this.lineelement.appendChild(b),this.lineelement=b,this.COMMENT()}else{var c=this.stream.peekLine(),d="/"+this.cacheddata.tagname+">",e=c.indexOf(d);e==-1?this.classes+=this.styles["hidden-comment"]:(this.cacheddata&&this.popLine(),this.tokentext+=d,this.stream.position+=e+d.length,this.classes+=this.styles["hidden-comment"]),this.mode="COMMENT"}},EdenUI.Highlight.prototype.COMMENT_CODE=function(){"`"==this.token?(this.classes+=this.styles["hidden-comment"],this.popMode()):(this.classes+="eden-script ",this.START())},EdenUI.Highlight.prototype.COMMENT_ICON=function(){if("OBSERVABLE"==this.token){if("-"==this.stream.code.charAt(this.stream.position)){var a=this.stream.peekLine(),b=a.indexOf(":");if(b==-1)return this.classes+=this.styles.comment,void(this.mode="COMMENT");var c=a.substring(0,b);this.tokentext+=c,this.stream.position+=c.length}var d=document.createElement("span");d.className="eden-comment-icon fa fa-"+this.tokentext,this.lineelement.appendChild(d),this.classes+=this.styles["hidden-comment"]}else":"==this.token&&(this.classes+=this.styles["hidden-comment"],this.mode="COMMENT")},EdenUI.Highlight.prototype.COMMENT_EMPH=function(){if("*"==this.token)this.mode="COMMENT_BOLD",this.classes+=this.styles["hidden-comment"];else{var a=document.createElement("span");a.className=this.styles["comment-emph"],this.lineelement.appendChild(a),this.pushLine(),this.lineelement=a,this.mode="COMMENT_ITALIC",this.COMMENT()}},EdenUI.Highlight.prototype.COMMENT_ITALIC=function(){"*"==this.token?(this.classes+=this.styles["hidden-comment"],this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_BOLD=function(){if("*"==this.token)this.classes+=this.styles["hidden-comment"],this.popLine(),this.mode="COMMENT_BOLD_END";else{var a=document.createElement("span");a.className=this.styles["comment-bold"],this.lineelement.appendChild(a),this.pushLine(),this.lineelement=a,this.mode="COMMENT_BOLD_END",this.COMMENT()}},EdenUI.Highlight.prototype.COMMENT_BOLD_END=function(){"*"==this.token?("*"==this.stream.code.charAt(this.stream.position)&&(this.classes+=this.styles["hidden-comment"],this.stream.position++,this.tokentext+="*"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_TAG=function(){this.mode="END_COMMENT_TAG"},EdenUI.Highlight.prototype.END_COMMENT_TAG=function(){this.popLine(),this.mode="COMMENT",this.COMMENT()},EdenUI.Highlight.prototype.DOXY_COMMENT=function(){this.BLOCK_COMMENT()},EdenUI.ContextMenu=function(a){this.element=$('<div class="eden-contextmenu"></div>'),this.origin=a,this.target=void 0,this.items=[],$(document.body).append(this.element);var b=this;this.element.on("mousedown",".eden-contextmenu-item",function(a){var c=parseInt(a.currentTarget.getAttribute("data-index"));b.items[c].action&&b.items[c].action(b.target)}),this.origin.oncontextmenu=function(a){b.target=a.target,"SPAN"==b.target.nodeName&&(b.target=b.target.parentNode);var c=document.body.scrollLeft+a.clientX;c+150>=screen.width&&(c-=c+150-screen.width),b.element.css("top",""+(document.body.scrollTop+a.clientY+10)+"px"),b.element.css("left",""+c+"px");for(var d=0;d<b.items.length;d++){var e;e="function"==typeof b.items[d].status?b.items[d].status(b.target):b.items[d].status,changeClass(b.items[d].element,"disabled",!e)}b.element.slideDown(100),a.preventDefault()},document.addEventListener("mousedown",function(){b.element.hide()},!0)},EdenUI.ContextMenu.prototype.addItem=function(a,b,c,d){var e=$('<div class="eden-contextmenu-item"><span class="eden-contextmenu-icon">'+a+"</span><span>"+b+"</span></div>");e.get(0).setAttribute("data-index",""+this.items.length),this.element.append(e),this.items.push({status:c,action:d,element:e.get(0)})},EdenUI.ContextMenu.prototype.addSeparator=function(){var a=$('<div class="eden-contextmenu-sep"></div>');this.element.append(a)},EdenUI.ButtonBar=function(a){this.container=a,this.bar=$('<div class="control-bar noselect"><div class="buttonsDiv"></div></div>'),this.buttons={},this.container.appendChild(this.bar.get(0))},EdenUI.ButtonBar.prototype.addButton=function(a,b,c,d){var e=$('<button class="control-button control-enabled '+a+'" title="'+c+'">'+b+"</button>");this.bar.find(".buttonsDiv").append(e),e.get(0).onclick=d,this.buttons[a]=e},EdenUI.ButtonBar.prototype.enableButton=function(a){this.buttons[a]&&this.buttons[a].addClass("control-enabled")},EdenUI.ButtonBar.prototype.disableButton=function(a){this.buttons[a]&&this.buttons[a].removeClass("control-enabled")},EdenUI.Tabs=function(a){this.tabs=a,this.scrollix=0,this.maxtabs=3},EdenUI.Tabs.prototype.build=function(a,b){for(;this.tabs.firstChild;)this.tabs.removeChild(this.tabs.firstChild);var c=document.createElement("div");c.className="agent-tableft noselect",this.tabs.appendChild(c);var d=document.createElement("div");if(d.className="agent-tab-container",this.tabs.appendChild(d),a&&a instanceof Array){var e=-1;b&&(e=a.indexOf(b)),e>this.scrollix+(this.maxtabs-1)&&(this.scrollix=e-(this.maxtabs-1)),e<this.scrollix&&(this.scrollix=e);for(var f=0;f<a.length;f++){var g=a[f];Eden.Agent.agents[a[f]]&&(g=Eden.Agent.agents[a[f]].title),this.scrollix<=f&&this.add(d,a[f],g,b&&a[f]==b,f)}}var h=document.createElement("div");h.className="agent-newtab noselect",h.style.left=""+(160*a.length+20)+"px",d.appendChild(h);var i=document.createElement("div");i.className="agent-tabright noselect",this.tabs.appendChild(i)},EdenUI.Tabs.prototype.add=function(a,b,c,d,e){var f=document.createElement("div");f.style.left=""+160*e+"px";var g="agent-tab noselect";g+=d?" agent-tab-current":" agent-tab-notcurrent";var h=b.split("/").pop();h.length>18&&(h="..."+h.slice(-15));var i;i=Eden.Agent.agents[b]?Eden.Agent.agents[b].hasErrors()?"tab-icon errored":Eden.Agent.agents[b].executed?"tab-icon executed":"tab-icon":"tab-icon noagent",f.className=g,f.innerHTML="<span class='"+i+"'>&#xf007;</span>"+h,f.draggable=!0,f.setAttribute("data-name",b),a.appendChild(f)},EdenUI.MenuBar=function(){function a(){$(".menubar-menu").hide(),t=!1;var a=$("#menubar-mainitem-views");a.children().css("display","")}function b(a){var b=$("#menubar-mainitem-"+a);b.show(),u=a,t=!0,"sharebox"==a&&o.sharebox.show()}function c(){var a=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(edenUI.activeDialogs).length&&a.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function d(b){a();var c=edenUI.eden.root,d=c.lookup("mouseFollow").value(),e=c.lookup("views_number_created"),f=e.value()+1;e.assign(f,c.scope,Symbol.hciAgent,!0);var g=this.view,h=g.toLowerCase()+f;d?edenUI.eden.execute('createView("'+h+'", "'+g+'");'):edenUI.createView(h,g),
o.updateViewsMenu()}function e(b){var d=this.parentNode.viewname;edenUI.viewInstances[d].confirmClose&&a(),edenUI.closeView(d),c()}function f(a){var b=a.currentTarget.children[0],c=this.parentNode.viewname;edenUI.viewInstances[c].pinned?(edenUI.unpinView(c),b.src=n):(edenUI.pinView(c),b.src=m)}function g(a){for(var b=$("<div class='menubar-item'></div>"),c=0;c<a.length;++c)b.append(a[c]);return b}function h(a,b){return $('<div class="'+a+' menubar-item-clickable">'+b+"</div>")}function i(a){return $("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+a+"</div></div>")}function j(b){return{mouseover:function(a){edenUI.highlightView(b,!0)},mouseout:function(a){edenUI.stopHighlightingView(b,!0,!1)},click:function(c){edenUI.stopHighlightingView(b,!0,!0),a()}}}function k(a){return a&&"false"!=a?'checked="checked"':""}function l(a,b,c,d){var e=edenUI.getOptionValue(a);null===e&&(e=c);var f=h("menubar-item-input",'<input id="menu-'+a+'" type="checkbox"'+k(e)+" />"),i=f.get(0).children[0],j=h("menubar-item-label",b),l=g([f,j]);l.click(function(b){b.target!=i&&(i.checked=!i.checked),edenUI.setOptionValue(a,i.checked)}),edenUI.listenTo("optionChange",void 0,function(b,c){if(b==a){var e="true"===c;i.checked=e,d&&d(a,e)}}),l.appendTo(v)}var m="images/pin.png",n="images/pin-greyed.png",o=this;this.itemViews={};var p=$('<div id="menubar-obscurer" class="login-subdialog modal" style="display: block;"></div>');p.html('<div class="modal-content" style="width: 290px;"><div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf090;</span>Login</div><iframe frameborder="0" name="logintarget" width="250" height="200" class="menubar-login-iframe"></iframe><br/><button class="jseden button-cancel">Cancel</button></div>'),p.hide(),eden.execute2("views_number_created = 0;",Symbol.defaultAgent),this.element=$('<div id="menubar-main" class="no-print"><a id="eden-logo" href="'+window.location.pathname+'" target="_blank" style="display: block"></a><div contenteditable class="jseden-title" title="Rename project">Construit!</div>'+(mobilecheck()?'<div class="menubar-mobilebuttons"><button class="scriptview-button enabled mobilemore">&#xf078;</button></div>':'<div class="jseden-subtitle">by Some Author</div><div id="menubar-login"><span class="icon">&#xf05e;</span>Not Connected</div><div class="menubar-buttons"><div class="menubar-button enabled main share" data-obs="sharebox" title="Save or share" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div><div class="menubar-button enabled main create" data-obs="views" title="Create Views" style="display: none;">&#xf067;<div id="menubar-mainitem-views" class="menubar-menu"></div></div><div class="menubar-button enabled main existing" data-obs="existing" title="Existing" style="display: none;">&#xf2d2;<div id="menubar-mainitem-existing" class="menubar-menu"></div></div><div class="menubar-button enabled main settings" data-obs="options" title="Options" style="display: none;">&#xf013;<div id="menubar-mainitem-options" class="menubar-menu"></div></div><div class="menubar-button enabled main help" data-obs="help" title="Help" style="display: none;">&#xf128;<div id="menubar-mainitem-help" class="menubar-menu"></div></div><div class="menubar-button enabled main notifications" data-obs="notifications" title="Notifications">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div><div class="menubar-button enabled main maker" data-obs="maker" title="Maker Mode">&#xf0ad;</div></div><div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="Search..." spellcheck="false"></input><div id="menubar-searchresults"></div></div>')+"</div>"),$(document.body).append(this.element);var q=this.element.find("#menubar-login"),r=new EdenUI.ContextMenu(q.get(0));r.addItem("&#xf08b;","Log out",function(){return Eden.DB.isLoggedIn()},function(){Eden.DB.logOut(function(){$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/login" target="logintarget"><span class="icon">&#xf090;</span>Login</a>')})}),edenUI.listenTo("loadPlugin",this,function(a,b){this.updateViewsMenu()}),edenUI.listenTo("createView",this,function(a,b){this.updateViewsMenu()}),edenUI.listenTo("destroyView",this,function(a){$(this.itemViews[a]).remove(),delete this.itemViews[a],c()}),Eden.DB.listenTo("connected",this,function(a){$("#menubar-login").html('<a href="'+a+'/login" target="logintarget"><span class="icon">&#xf090;</span>Login</a>')}),Eden.DB.listenTo("disconnected",this,function(){$("#menubar-login").html('<span class="icon">&#xf05e;</span>Not Connected')}),Eden.DB.listenTo("login",this,function(a){a&&(setTimeout(function(){$("#menubar-obscurer").remove()},1e3),$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/#" target="_blank"><span class="icon">&#xf2be;</span>'+a+"</a>"))}),$("#menubar-login").click(function(){Eden.DB.isConnected()&&!Eden.DB.isLoggedIn()?(p.show(),$(document.body).append(p),p.on("click",".button-cancel",function(){p.remove()})):Eden.DB.isConnected()&&Eden.DB.isLoggedIn()});var o=this;if(mobilecheck()){var s=new EdenUI.ContextMenu(this.element.find(".mobilemore").get(0));s.addItem("&#xf1e0;","Share",!0,function(a){o.script.stickAll()}),s.addItem("&#xf121;","New Script View",!0,function(a){o.script.unstickAll()}),s.addItem("&#xf022;","New Observable Lists",!0,function(a){o.script.clearUnstuck()}),s.addItem("&#xf03e;","New Graphic View",!0,function(a){o.script.activateAll()}),this.element.on("click",".mobilemore",function(a){o.element.find(".mobilemore").get(0).oncontextmenu(a)})}this.sharebox=new EdenUI.Sharebox(this.element.find("#menubar-mainitem-sharebox")),this.element.on("click",".menubar-button.share",function(a){a.currentTarget===a.target&&o.sharebox.update()}),this.searchbox=new EdenUI.SearchBox(this.element.find("#menubar-searchresults")),this.element.on("keyup",".search",function(a){o.searchbox.updateSearch(a.currentTarget.value)}),this.element.on("focus",".search",function(a){o.searchbox.updateSearch(a.currentTarget.value)});var t=!1,u=void 0;$(document.body).on("mousedown",function(){a(),o.searchbox.element.hide()}),this.element.on("mousedown",".menubar-search-outer",function(a){a.stopPropagation()}),this.element.on("mousedown",".menubar-button.main",function(c){var d=c.currentTarget.getAttribute("data-obs");t&&c.target===this?d==u?a():(a(),b(d)):b(d),o.searchbox.element.hide(),c.stopPropagation()}),this.element.on("mouseenter",".menubar-button.main",function(a){}),this.updateViewsMenu=function(){var a=$("#menubar-mainitem-views"),b=$("#menubar-mainitem-existing");a.html("");var k=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),l=k[0],p=$('<div class="menubar-item-fullwidth"></div>');p.append(k);var q=$("<div class='menubar-item-search'></div>");q.append(p),l.search=function(){var b,c=l.value,d=new RegExp("(^|\\s)"+c,"i"),e=!1;a.children().each(function(a,f){if(!f.classList.contains("menubar-item-search")){var g=f.children[0],h=g.innerHTML,i=g.classList.contains("menubar-item-separator");i?(c.length>1&&(e=d.test(h)),b=f,e?f.style.display="":f.style.display="none"):e?f.style.display="":d.test(h)?(f.style.display="",b.style.display=""):f.style.display="none"}})},k.on("input",l.search);var r,s,t,u,v,w,x=[];for(s in edenUI.views){var y=edenUI.views[s],z=y.title,A=y.category.getLabel(),B=y.category.getMenuPriority(),C=y.menuPriority;u=h("menubar-item-fullwidth menubar-view",z),t=g([u]),t[0].view=s,t.click(d),x.push({title:z,viewEntry:t,categoryLabel:A,categoryPriority:B,itemPriority:C})}x=x.sort(function(a,b){if(a.categoryPriority!=b.categoryPriority)return a.categoryPriority-b.categoryPriority;if(void 0!==a.itemPriority){if(void 0===b.itemPriority)return-1;if(a.itemPriority!=b.itemPriority)return a.itemPriority-b.itemPriority}else if(void 0!==b.itemPriority)return 1;return a.title>b.title?1:a.title<b.title?-1:0});for(var D,E=0;E<x.length;++E){var F=x[E],G=F.categoryLabel;if(D!=G){var H=i(G);H.appendTo(a),D=G}F.viewEntry.appendTo(a)}a.append(q),b.html(""),o.itemViews={},c();for(r in edenUI.activeDialogs){var I=j(r),z=edenUI.eden.root.lookup("view_"+r+"_title").value();u=h("menubar-item-label",z+' <span class="menubar-view-name">['+r+"]</span>"),u.click(I.click);var J;J=edenUI.viewInstances[r].pinned?m:n,v=h("menubar-item-pin",'<img src="'+J+'" width="18" height="18" class="menubar-item-pin-icon"/>'),v.click(f),w=h("menubar-item-close",'<div class="menubar-item-close-icon">X</div>'),w.click(e),t=g([u,v,w]),t.bind("mouseover",I.mouseover),t.bind("mouseout",I.mouseout),t[0].viewname=r,t.appendTo(b),o.itemViews[r]=t[0]}},this.updateViewsMenu();var v=$("#menubar-mainitem-options");l("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(a,b){b?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),l("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),l("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),l("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(a,b){var c;c=b?"collapse":"maximize",$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",c)})}),l("developer",Language.ui.menu_bar.opt_debug,!1,function(b,c){var d;d=c?"/index-dev.html":"/index.html";var e=document.location.pathname;d=e.slice(0,e.lastIndexOf("/"))+d,d!=document.location.pathname?(a(),edenUI.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(a){if(0==a)window.onbeforeunload=void 0,document.location.pathname=d;else if(1==a)root.lookup("debug").mutate(root.scope,function(a){a.cache.value.jsExceptions=c},Symbol.hciAgent);else{var b=document.getElementById("menu-developer");b.checked=!b.checked,edenUI.setOptionValue("developer",b.checked)}})):root.lookup("debug").mutate(root.scope,function(a){a.cache.value.jsExceptions=c},Symbol.hciAgent)}),this.element.on("keyup",".jseden-title",function(a){try{window.localStorage&&window.localStorage.setItem("title",a.currentTarget.textContent)}catch(a){}}),eden.root.lookup("jseden_project_title").addJSObserver("menubar",function(a,b){a.origin&&a.origin!==Symbol.hciAgent&&($(".jseden-title").get(0).textContent=b);try{window.localStorage&&window.localStorage.setItem("title",b)}catch(c){}}),eden.root.lookup("jseden_maker").addJSObserver("menubar",function(a,b){b?o.element.find(".maker").addClass("active"):o.element.find(".maker").removeClass("active")}),eden.root.lookup("jseden_menu_showsearch").addJSObserver("menubar",function(a,b){b?o.element.find(".menusearch").show():o.element.find(".menusearch").hide()}),eden.root.lookup("jseden_menu_showshare").addJSObserver("menubar",function(a,b){b?o.element.find(".menubar-button.share").show():o.element.find(".menubar-button.share").hide()}),eden.root.lookup("jseden_menu_showcreate").addJSObserver("menubar",function(a,b){b?o.element.find(".menubar-button.create").show():o.element.find(".menubar-button.create").hide()}),eden.root.lookup("jseden_menu_showexisting").addJSObserver("menubar",function(a,b){b?o.element.find(".menubar-button.existing").show():o.element.find(".menubar-button.existing").hide()}),eden.root.lookup("jseden_menu_showsettings").addJSObserver("menubar",function(a,b){b?o.element.find(".menubar-button.settings").show():o.element.find(".menubar-button.settings").hide()}),eden.root.lookup("jseden_menu_showhelp").addJSObserver("menubar",function(a,b){b?o.element.find(".menubar-button.help").show():o.element.find(".menubar-button.help").hide()}),eden.root.lookup("jseden_project_subtitle").addJSObserver("menubar",function(a,b){$(".jseden-subtitle").get(0).textContent=b}),this.notifications=new EdenUI.Notifications(this.element.find("#menubar-mainitem-notifications"),this.element.find(".menubar-notification-jewel")),this.element.on("click",".notifications",function(a){o.notifications.clearCount()}),this.element.on("click",".maker",function(a){var b=eden.root.lookup("jseden_maker");if(!b.eden_definition){var c=b.value();void 0===c&&(c=!1),b.assign(!c,eden.root.scope,Symbol.localJSAgent)}}),this.element.on("keyup",".jseden-title",function(a){var b=eden.root.lookup("jseden_project_title");b.definition||b.assign(a.currentTarget.textContent,eden.root.scope,Symbol.hciAgent)})},EdenUI.MenuBar.prototype.hide=function(){this.element.hide()},EdenUI.MenuBar.prototype.show=function(){this.element.show()},EdenUI.MenuBar.reset=function(){$(".jseden-title").html("Construit!")},EdenUI.MenuBar.saveTitle=function(a){eden.root.lookup("jseden_project_title").assign(a,eden.root.scope,Symbol.jsAgent)},EdenUI.Dialogs={},EdenUI.Dialogs.MergeError=function(a,b,c){var d=new diff_match_patch,e=d.diff_main(a,b);d.diff_cleanupSemantic(e);var f=d.diff_prettyHtml(e),g=$('<div title="Import Merge Conflict">'+f+"</div>");g.dialog({resizable:!0,height:"auto",width:600,modal:!0,buttons:{"Use Mine":function(){c&&c("old"),$(this).dialog("close")},"Use New":function(){c&&c("new"),$(this).dialog("close")},Merge:function(){c&&c("merge"),$(this).dialog("close")}}})},EdenUI.Notifications=function(a,b){function c(a,b){if(b){var c=("runtime"==b.type?"Runtime error":"Syntax error")+" in "+a.name+":"+(b.line!=-1?b.line:"")+" -> "+b.messageText(),e="<a href=\"javascript:edenUI.gotoCode('"+a.name+"',"+b.line+');">'+a.name+":"+(b.line!=-1?b.line+1:"")+"</a> "+b.messageText();if(!a.owned||"syntax"!=b.type){console.error(c);var f=$('<pre class="error-item">'+e+"</pre>\n\n");f.on("click",function(){var a="";if(!b.statement||"definition"!=b.statement.type&&"assignment"!=b.statement.type||(a+="    <b>Symbol:</b> "+b.statement.lvalue.name+"\n"),b.lastsymbol&&(a+="    <b>Related Symbol:</b> "+b.lastsymbol+"\n"),String(b.extra).search("SyntaxError")>=0)a+="    <b>JavaScript:</b> "+b.javascriptSource()+"\n",f.html(e+"\n"+a);else if(a+="    <b>Source:</b> <div class='error-source'</div>\n",f.html(e+"\n"+a),b.statement){var c=new Eden.AST(b.edenSource(),(void 0),Symbol.jsAgent),d=new EdenUI.Highlight(f.find(".error-source").get(0));d.highlight(c,-1,-1)}}),d.notification("error",f)}}}var d=this;this.notificationCount=0,this.notificationCountElement=b,this.notificationCountElement.hide(),this.notificationPanel=a,this.notificationPanel.html('<button class="control-button close-button control-enabled">&#xf00d;</button><button class="control-button clear-button control-enabled">&#xf05e;</button><div id="errors-dialog"></div>'),this.notificationPanel.on("click",".close-button",function(){d.notificationPanel.hide()}).on("click",".clear-button",function(){d.notificationPanel.find("#errors-dialog").html("")}),this.notificationPanel.hide(),this.notificationContent=this.notificationPanel.find("#errors-dialog"),Eden.Peer.listenTo("user",void 0,function(a,b){d.notification("net",$('<div class="notification-content">User \'<a href="javascript:eden.peer.showConnection(\''+a+"');\">"+b+"</a>' connected to you.<br/><a href=\"javascript: eden.peer.requestShare('"+a+"');\">Watch</a> <a href=\"javascript: eden.peer.requestObserve('"+a+"');\">Broadcast</a> <a href=\"javascript: eden.peer.requestCollaborate('"+a+"');\">Collaborate</a></div>"))}),Eden.Peer.listenTo("share",void 0,function(a,b){d.notification("net",$('<div class="notification-content">Your model is being shared...</div>'))}),Eden.Peer.listenTo("disconnect",void 0,function(a,b){b?d.notification("net",$('<div class="notification-content">User \''+b+"' disconnected.</div>")):d.notification("net",$('<div class="notification-content">P2P User disconnected.</div>'))}),Eden.Peer.listenTo("error",void 0,function(a){d.notification("error",$('<div class="notification-content">P2P: '+a+"</div>"))}),Eden.Fragment.listenTo("error",void 0,c),eden.listenTo("error",void 0,c),Eden.Fragment.listenTo("warning",void 0,function(a,b){if(b){var c=(("runtime"==b.type?"Runtime warning":"Syntax warning")+" in "+a.name+":"+(b.line!=-1?b.line:"")+" -> "+b.messageText(),"<a href=\"javascript:edenUI.gotoCode('"+a.name+"',"+b.line+');">'+a.name+":"+(b.line!=-1?b.line+1:"")+"</a> "+b.messageText());if(!a.owned||"syntax"!=b.type){var e=$('<pre class="error-item">'+c+"</pre>\n\n");e.on("click",function(){var a="";if(!b.statement||"definition"!=b.statement.type&&"assignment"!=b.statement.type||(a+="    <b>Symbol:</b> "+b.statement.lvalue.name+"\n"),b.lastsymbol&&(a+="    <b>Related Symbol:</b> "+b.lastsymbol+"\n"),String(b.extra).search("SyntaxError")>=0)a+="    <b>JavaScript:</b> "+b.javascriptSource()+"\n",e.html(c+"\n"+a);else if(a+="    <b>Source:</b> <div class='error-source'</div>\n",e.html(c+"\n"+a),b.statement){var d=new Eden.AST(b.edenSource(),(void 0),Symbol.jsAgent),f=new EdenUI.Highlight(e.find(".error-source").get(0));f.highlight(d,-1,-1)}}),d.notification("warning",e)}}}),Eden.DB.listenTo("disconnected",this,function(){d.notification("info",$('<div class="notification-content">Disconnected from project server</div>'))})},EdenUI.Notifications.prototype.notification=function(a,b){this.notificationCount++,this.notificationCountElement.html(this.notificationCount),this.notificationCountElement.show();var c;if("error"==a)c=$('<div class="notification-item error"></div>'),c.append($('<div class="notification-icon"><span style="color: red;">&#xf06a;</span></div>'));else{var d,e="#777";switch(a){case"net":d="&#xf0c1;";break;case"log":d="&#xf120;";break;case"warning":d="&#xf071;",e="#f57900";break;case"info":default:d="&#xf129;",e="#29454B"}c=$('<div class="notification-item"></div>'),c.append($('<div class="notification-icon"><span style="color: '+e+'">'+d+"</span></div>"))}"string"==typeof b?c.append($('<div class="notification-content">'+b+"</div>")):c.append(b),this.notificationContent.prepend(c),this.notificationContent.prop("scrollTop",0)},EdenUI.Notifications.prototype.clearCount=function(){this.notificationCountElement.hide(),this.notificationCount=0},EdenUI.Sharebox=function(a){var b=this;this.title=void 0,this.visible=!1,this.sharebox=a,this.sharebox.html('<div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf1e0;</span>Save and Share</div><div class="menubar-sharebox-content"><div id="projectoptions"></div><div id="projectuploadbox"></div></div>');var c=this.sharebox.find("#projectoptions");this.markdown=new EdenUI.Markdown(""),c.get(0).appendChild(this.markdown.contents),this.sharebox.on("change","#thumbfile",function(a){var c=b.sharebox.find("#projectthumb"),d=$("#thumbfile");c.html("");var e=d.get(0),f=e.files[0];console.log("THUMB FILE",f);var g=new FileReader;g.onload=function(a){var d=document.createElement("canvas");d.setAttribute("width","200"),d.setAttribute("height","112");var e=d.getContext("2d"),f=new Image;f.src=a.target.result;var g,h,i,j,k=f.width,l=f.height,m=200,n=112,o=k/l,p=m/n;o<p?(g=n,h=k*(g/l),i=(m-h)/2,j=0):o>p?(h=m,g=l*(h/k),i=0,j=(n-g)/2):(g=n,h=m,i=0,j=0),e.drawImage(f,i,j,h,g);var q=d.toDataURL("image/png");b.thumbdata=q;var r=$("<img></img>");c.append(r),r.get(0).src=q},g.readAsDataURL(f)}),this.sharebox.on("click",".upload",function(a){var c=b.title.textContent,d=b.markdown.intextarea.value,e=$("#listpublic").get(0).checked;return"New Project"==c?void b.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.'):(b.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),eden.project.thumb=b.thumbdata,eden.project.setDescription(d),console.log("SAVE",e,d),void eden.project.save(e,function(a){if(a){var c="?load="+eden.project.id+"&vid="+eden.project.vid;window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",c),b.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>');var d=document.createRange();d.selectNodeContents(b.sharebox.find(".projecturl").get(0));var e=window.getSelection();e.removeAllRanges(),e.addRange(d)}else b.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")}))}),this.sharebox.on("click",".fork",function(a){var c=b.title.textContent,d=b.markdown.intextarea.value,e=$("#listpublic").get(0).checked;return"New Project"==c?void b.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.'):(b.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),eden.project.thumb=b.thumbdata,eden.project.id&&(eden.project.parentid=eden.project.id),eden.project.id=void 0,eden.project.vid=void 0,eden.project.setDescription(d),console.log("FORK",e,d),void eden.project.save(e,function(a){if(a){var c="?load="+eden.project.id+"&vid="+eden.project.vid;window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",c),b.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>');var d=document.createRange();d.selectNodeContents(b.sharebox.find(".projecturl").get(0));var e=window.getSelection();e.removeAllRanges(),e.addRange(d)}else b.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")}))})},EdenUI.Sharebox.prototype.show=function(){this.visible||this.update(),this.visible=!0},EdenUI.Sharebox.prototype.hide=function(){this.visible=!1},EdenUI.Sharebox.prototype.update=function(){var a=this;void 0===a.title&&(a.title=$(document).find(".jseden-title").get(0));var b=a.title.textContent;Eden.DB.isLoggedIn()?(eden.project.authorid!=Eden.DB.userid&&eden.project.authorid!=-1?a.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox" checked>List publically</input></div><input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'):a.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox" checked>List publically</input></div><input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button upload">Save</button><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'),a.sharebox.find("#projectoptions").show()):(a.sharebox.find("#projectuploadbox").html('<div class="sharebox-save-buttons"><span class="downloadurl"></span></div>'),a.sharebox.find("#projectoptions").hide());var c=this.sharebox.find("#projectthumb");this.thumbdata=void 0,this.thumbimg=$("<img></img>"),this.thumbimg.get(0).style.border="1px solid #aaa",this.thumbimg.get(0).style.marginRight="10px",c.append(this.thumbimg),eden.project.thumb?(a.thumbdata=eden.project.thumb,a.thumbimg.get(0).src=eden.project.thumb):a.thumbdata=void 0,void 0===eden.project.id&&(eden.project.tags=(eden.project.title.toLowerCase()+" "+(Eden.DB.isLoggedIn()?Eden.DB.username.toLowerCase():"")).split(" ")),a.markdown.setValue(eden.project.getDescription()),a.projectsource=eden.project.generate();var d="data:application/octet-stream,"+encodeURIComponent(a.projectsource);a.sharebox.find(".downloadurl").html('<a class="sharebox-button download" href="'+d+'" download="'+b+'.js-e">File</a>')},EdenUI.SearchBox=function(a){var b=this;this.element=a,a.on("click",".menubar-search-result",function(a){var c=a.currentTarget.getAttribute("data-id");c&&""!=c?b.updateSymbolDetails(a.currentTarget,c):script&&""!=script}),a.on("click",".edit-result",function(a){}),a.on("click",".script-goto",function(a){var c=a.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");b.element.hide(),Eden.Selectors.goto(c)}),a.on("click",".script-import",function(a){var c=a.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");Eden.Selectors.query(c,void 0,{minimum:1,options:{external:!0,index:!0}},function(d){c&&""!=c&&(a.currentTarget.parentNode.parentNode.parentNode.setAttribute("data-imported","true"),b.updateSymbolDetails(a.currentTarget.parentNode.parentNode.parentNode,c))})})},EdenUI.SearchBox.prototype.updateSymbolDetails=function(a,b){console.log("Update details",b);var c=a.getAttribute("data-imported"),d=a.getAttribute("data-remote");Eden.Selectors.query("@history "+b,"id,path,source,type,value,active,tags,rawcomment,historic",{minimum:1,options:{external:!0}},function(b){if(0==b.length)return void console.log("No result");b=b[0];var e=(b[0],b[1]),f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8];k&&(k=new Eden.AST.DoxyComment(k));var m=$(a).find(".doxy-search-details");null!==m&&0!=m.length||(m=$('<div class="doxy-search-details"></div>'),a.appendChild(m.get(0))),m=m.get(0),"assignment"!=g&&"definition"!=g||(symstr=f,""==a.firstChild.className?a.firstChild.innerHTML=EdenUI.Highlight.html(symstr):a.childNodes[1].innerHTML=EdenUI.Highlight.html(symstr));var n="";if(l?n="":"true"==d?(n+="<p>","true"!=c&&(n+='<button class="script-button script-import">Import</button>'),n+='<button class="script-button script-goto">Goto</button></p>'):n="assignment"==g||"definition"==g?'<p><button class="script-button script-goto">Goto</button><button class="script-button">Watch</button><button class="script-button">More</button></p>':'<p><button class="script-button script-goto">Goto</button><button class="script-button">More</button></p>',i?(n+="<p>",n+="<b>Path:</b> "+e+"<br>",n+="<b>Current Value:</b> "+Eden.edenCodeForValue(h),n+="</p>"):(n+="<p>",n+="<b>Path:</b> "+e,n+="</p>"),k){j&&j.length>0&&(n+="<p><b>Tags:</b> "+j.join(" ")+"</p>");var o=k.pretty();o&&o.length>0&&(n+=o)}m.innerHTML=n})},EdenUI.SearchBox.prototype.makeStatementResult=function(a){var b,c="",d="",e="",f=!0;a.executed==-1&&(d=" historic");var g=a.getOrigin();"script"==a.type?(g&&g.remote?(e+=' data-remote="true"',a.indexed&&(e+=' data-imported="true"'),c='<span class="search-scriptres">&#xf08e;</span>'):c='<span class="search-scriptres">&#xf15c;</span>',void 0===a.parent?(b='<span class="eden-keyword">Project: </span><b>'+(a.base&&a.base.origin&&a.base.origin.title?a.base.origin.title:a.name)+"</b>",f=!1):b=a.name?"action "+a.name:a.getInnerSource()):"when"==a.type?(a.enabled&&(c='<span class="search-scriptres">&#xf00c;</span>'),b=a.prefix.trim()):(a.lvalue&&eden.root.symbols[a.lvalue.name]&&eden.root.symbols[a.lvalue.name].origin&&eden.root.symbols[a.lvalue.name].origin.id==a.id&&(c='<span class="search-scriptres">&#xf00c;</span>'),a.getSource()||console.error("NO SOURCE",a),b=a.getSource().split("\n")[0]),f&&(b.length>55&&(b=b.substr(0,55)+"..."),b=EdenUI.Highlight.html(b));var h="";if(a.doxyComment){var i=a.doxyComment.brief();i&&i.length>0&&(h='<div class="doxy-search-details"><p>'+i+"</p></div>")}var j=$('<div class="menubar-search-result'+d+'" data-id="'+Eden.Selectors.getID(a)+'"'+e+">"+c+b+h+"</div>");return j},EdenUI.SearchBox.prototype.makeScriptResult=function(a){},EdenUI.SearchBox.prototype.updateSearch=function(a){if(a&&""!=a){this.element.show();var b=this;Eden.Selectors.query(a,void 0,{minimum:1,options:{external:!0}},function(a){function c(){var d=$('<div class="menubar-search-more">&#xf078;</div>');e.append(d),d.on("click",function(){e.html("");for(var d=0;f<a.length&&!(d>g);f++){d++;var h;h=a[f]instanceof Symbol?b.makeSymbolResult(a[f]):b.makeStatementResult(a[f]),e.append(h)}f<a.length&&c()})}b.element.html("");var d=$('<div class="menubar-search-outer"></div>'),e=$('<div class="menubar-search-results"></div>');d.append(e),b.element.append(d);var f=0,g=8,h=0;for(console.log(a),f=0;f<a.length&&!(h>=g);f++){h++;var i;i=b.makeStatementResult(a[f]),e.append(i)}f<a.length&&c()})}else this.element.hide()},EdenUI.ScriptBox=function(a,b){function c(a){q.dirty=!0,q.rebuild()}function d(a){if(q.ast&&q.ast.script&&!q.ast.hasErrors()&&13==a.keyCode&&"EOF"==q.ast.token&&q.intextarea.selectionStart>=q.ast.script.end)return q.history.push(q.ast.stream.code),q.historyindex=q.history.length,window.localStorage&&window.localStorage.setItem("console_history",JSON.stringify(q.history)),$(q.outdiv).find(".fake-caret").remove(),q.$codearea.append($('<div class="scriptbox-historic">'+q.outdiv.innerHTML+"</div>")),q.ast.execute(EdenUI.ScriptBox.consoleAgent,function(){void 0!==q.ast.lastresult&&(console.log("Result",q.ast.lastresult),q.$codearea.append($('<div class="scriptbox-value">'+EdenUI.Highlight.html(Eden.edenCodeForValue(q.ast.lastresult))+"</div>")))}),q.inputhider.scrollTop=q.inputhider.scrollHeight,q.setSource(""),void a.preventDefault();if(a.altKey)187==a.keyCode||61==a.keyCode?a.preventDefault():189==a.keyCode||173==a.keyCode?a.preventDefault():48==a.keyCode&&a.preventDefault();else if(a.ctrlKey||17==a.keyCode||16==a.keyCode){if(a.ctrlKey)if(a.shiftKey){if(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||36==a.keyCode||35==a.keyCode)return q.setCaretToFakeCaret(),void q.outdiv.focus()}else 38===a.keyCode?onPrevious():40===a.keyCode?onNext():86===a.keyCode||65===a.keyCode&&(a.preventDefault(),q.outdiv.focus())}else if(9==a.keyCode){a.preventDefault();var b=q.intextarea.selectionStart,c=q.intextarea.selectionEnd;q.intextarea.value=q.intextarea.value.substring(0,b)+"\t"+q.intextarea.value.substring(c),q.intextarea.selectionStart=q.intextarea.selectionEnd=b+1,q.rebuild()}else if(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||36==a.keyCode||35==a.keyCode){if(a.shiftKey)return q.setCaretToFakeCaret(),void q.outdiv.focus();38==a.keyCode?q.historyindex>0&&(q.historyindex--,q.setSource(q.history[q.historyindex]),a.preventDefault()):40==a.keyCode&&(q.historyindex<q.history.length-1?(q.historyindex++,q.setSource(q.history[q.historyindex]),a.preventDefault()):(q.historyindex=q.history.length,q.setSource(""))),q.updateLineCachedHighlight()}else(13==a.keyCode||8==a.keyCode&&10==q.intextarea.value.charCodeAt(q.intextarea.selectionStart-1))&&(q.refreshentire=!0)}function e(a){q.refreshentire=!0}function f(a){a.altKey||(a.ctrlKey||37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&36!=a.keyCode&&35!=a.keyCode?(a.ctrlKey||8!=a.keyCode||""!=q.intextarea.value)&&q.rebuild():(q.updateLineCachedHighlight(),36==a.keyCode||35==a.keyCode))}function g(a){if(!a.altKey)if("pointer"==q.outdiv.style.cursor&&(q.outdiv.style.cursor="initial"),16==a.keyCode||17==a.keyCode||a.ctrlKey&&67==a.keyCode);else if(!a.shiftKey||37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&35!=a.keyCode&&36!=a.keyCode){var b=getCaretCharacterOffsetWithin(q.outdiv,q.shadow),c=getStartCaretCharacterOffsetWithin(q.outdiv,q.shadow);q.intextarea.focus(),q.intextarea.selectionEnd=b,q.intextarea.selectionStart=c,c!=b&&(q.refreshentire=!0)}}function h(a){q.intextarea.focus(),setTimeout(function(){q.updateEntireHighlight()},0)}function i(a){}function j(a){$(q.outdiv).find(".fake-caret").remove(),q.hideInfoBox()}function k(a){}function l(a){if(q.hideInfoBox(),document.activeElement===q.outdiv){var b=getCaretCharacterOffsetWithin(q.outdiv,q.shadow),c=getStartCaretCharacterOffsetWithin(q.outdiv,q.shadow);if(c!=b)q.refreshentire=!0;else{var d=q.currentlineno;q.intextarea.focus(),q.intextarea.selectionEnd=b,q.intextarea.selectionStart=b,q.ast&&(q.highlighter.highlight(q.ast,d,b),q.updateLineCachedHighlight())}}}function m(a){
var b=parseInt(a.currentTarget.getAttribute("data-statement")),c=Eden.Statement.statements[b];if(c.statement&&0==c.statement.errors.length)c.statement.execute(eden.root,c.ast,c.ast,eden.root.scope),"when"==c.statement.type&&(Eden.Statement.active[c.id]=!Eden.Statement.active[c.id],changeClass(a.currentTarget,"active",Eden.Statement.active[c.id]));else if(c.ast&&c.ast.script){var d=c.ast.script.errors[0];q.showInfoBox(a.target.offsetLeft+20,a.target.offsetTop-q.codearea.scrollTop+25,"error",d.messageText())}q.updateLineCachedHighlight()}function n(a){a.currentTarget.className.indexOf("stuck")>=0?changeClass(a.currentTarget,"stuck",!1):changeClass(a.currentTarget,"stuck",!0)}function o(a){if(q.dragline==-1&&(void 0===q.outdiv||a.currentTarget!==q.outdiv.parentNode)){var b=parseInt(a.currentTarget.getAttribute("data-statement"));q.moveTo(b)}}function p(a){var b=a.currentTarget.parentNode.parentNode,c=parseInt(b.getAttribute("data-statement"));b.removeChild(q.valuedivs[c][0]),delete q.valuedivs[c]}this.changeCB=void 0,this.outer=a,this.savecb=void 0,this.contents=$(this.outer),this.contents.html('<div class="scriptbox-inputhider"><textarea autofocus tabindex="1" class="hidden-textarea" style="height: 5px;"></textarea><div class="scriptbox-codearea"></div></div><div class="scriptbox-outputbox"><div class="scriptbox-statement"><div class="scriptbox-output" contenteditable="true" spellcheck="false"></div></div></div><div class="info-bar"></div></div>'),this.currentstatement=void 0,this.statements={},this.$codearea=this.contents.find(".scriptbox-codearea"),this.codearea=this.$codearea.get(0),this.intextarea=this.contents.find(".hidden-textarea").get(0),this.inputhider=this.contents.find(".scriptbox-inputhider").get(0),this.outdiv=this.contents.find(".scriptbox-output").get(0),this.$codearea.sortable({revert:100,handle:".grippy",distance:10,axis:"y",scroll:!1}),this.infobox=this.contents.find(".info-bar").get(0),this.outputbox=this.contents.find(".scriptbox-outputbox").get(0),this.suggestions=this.contents.find(".eden_suggestions"),this.suggestions.hide(),$(this.infobox).hide(),this.highlighter=new EdenUI.Highlight(this.outdiv),this.enable(),this.ast=void 0,this.refreshentire=!0,this.dirty=!0,this.rebuildtimer=void 0,this.rebuildtimeout=10,this.currentlineno=1,this.currentcharno=0,this.dragint=!1,this.dragline=-1,this.dragvalue=0,this.draglast=0,this.history=void 0,window.localStorage?this.history=JSON.parse(window.localStorage.getItem("console_history"))||[]:this.history=[],this.historyindex=this.history.length;var q=this;this.contents.on("input",".hidden-textarea",c).on("keydown",".hidden-textarea",d).on("keyup",".hidden-textarea",f).on("paste",".hidden-textarea",e).on("keydown",".scriptbox-output",g).on("keyup",".scriptbox-output",i).on("paste",".scriptbox-output",h).on("blur",".hidden-textarea",j).on("focus",".hidden-textarea",k).on("mouseup",".scriptbox-output",l).on("click",".scriptbox-gutter",m).on("click",".scriptbox-sticky",n).on("click",".scriptbox-valueclose",p).on("mousedown",".scriptbox-statement",o),this.setSource(""),setInterval(function(){for(var a in q.valuedivs){var b=Eden.Statement.statements[a];if(b){var c=EdenUI.htmlForStatement(b,30,30);b.isActive();q.valuedivs[a].innerHTML='<div class="eden-line">'+c+"</div>"}}},200)},EdenUI.ScriptBox.consoleAgent={local:!1,name:"*Console"},EdenUI.ScriptBox.prototype.focus=function(){if(this.outdiv.focus(),document.activeElement===this.outdiv){var a=this.intextarea.value.length,b=this.currentlineno;this.intextarea.focus(),this.intextarea.selectionEnd=a,this.intextarea.selectionStart=a,this.ast&&(this.highlighter.highlight(this.ast,b,a),this.updateLineCachedHighlight())}},EdenUI.ScriptBox.prototype.setCaretToFakeCaret=function(){var a=$(this.outdiv).find(".fake-caret").get(0),b=document.createRange(),c=window.getSelection();a.nextSibling&&(a=a.nextSibling),b.setStart(a,0),b.collapse(!0),c.removeAllRanges(),c.addRange(b),$(this.outdiv).remove(".fake-caret")},EdenUI.ScriptBox.prototype.setChangeCB=function(a){this.savecb=a},EdenUI.ScriptBox.prototype.hideInfoBox=function(){$(this.infobox).hide("fast")},EdenUI.ScriptBox.prototype.showInfoBox=function(a,b,c,d){console.log("SHOW INFO BOX "+d),"warning"==c?this.infobox.innerHTML="<div class='info-warnitem'><span>"+d+"</span></div>":"error"==c&&(this.infobox.innerHTML="<div class='info-erroritem'><span>"+d+"</span></div>");var e=$(this.infobox);e.css("top",""+b+"px"),e.css("left",""+a+"px"),$(this.infobox).show()},EdenUI.ScriptBox.prototype.disable=function(){if(this.outdiv){changeClass(this.outdiv,"goto",!1),this.valuedivs[this.currentstatement]=this.outdiv;var a=EdenUI.htmlForStatement(Eden.Statement.statements[this.currentstatement],30,30);this.valuedivs[this.currentstatement].innerHTML='<div class="eden-line">'+a+"</div>",changeClass(this.outdiv.parentNode,"readonly",!0),this.ast}},EdenUI.ScriptBox.prototype.enable=function(){this.outdiv&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv.parentNode,"readonly",!1),this.ast&&this.highlighter.highlight(this.ast,-1,-1))},EdenUI.ScriptBox.prototype.setSource=function(a){this.intextarea.value=a,this.ast=new Eden.AST(a,(void 0),EdenUI.ScriptBox.consoleAgent,{noindex:!0}),this.highlightContent(this.ast,-1,0),this.intextarea.focus(),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):""==a?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0),this.outdiv.contentEditable=!0},EdenUI.ScriptBox.prototype.updateLineHighlight=function(){var a=-1,b=-1;document.activeElement===this.intextarea&&(b=this.intextarea.selectionEnd,a=this.getLineNumber(this.intextarea)),this.ast=new Eden.AST(this.intextarea.value,(void 0),EdenUI.ScriptBox.consoleAgent,{noindex:!0}),this.highlighter.ast=this.ast,this.runScript(a),this.highlightContent(this.ast,a,b),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0)},EdenUI.ScriptBox.prototype.updateLineCachedHighlight=function(){var a=-1,b=-1;document.activeElement===this.intextarea&&(b=this.intextarea.selectionEnd,a=this.getLineNumber(this.intextarea)),this.highlightContent(this.ast,a,b)},EdenUI.ScriptBox.prototype.updateEntireHighlight=function(a){this.ast=new Eden.AST(this.intextarea.value,(void 0),EdenUI.ScriptBox.consoleAgent,{noindex:!0}),this.highlighter.ast=this.ast;var b=-1;document.activeElement===this.intextarea&&(b=this.intextarea.selectionEnd),a&&this.runScript(0),this.highlightContent(this.ast,-1,b),this.ast.script&&0==this.ast.script.errors.length||console.log("indicated error")},EdenUI.ScriptBox.prototype.highlightContent=function(a,b,c){if(this.highlighter.highlight(a,b,c),a.mainDoxyComment&&(b==-1||b>=1&&b<=a.mainDoxyComment.endline)){var d=a.mainDoxyComment.content.match(/@[a-z]+.*\n/gi);if(d)for(var e=0;e<d.length;e++){var f=d[e].search(/\s/);if(f>=0){d[e].substring(0,f),d[e].substr(f).trim()}}}document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret");var g=this;$(this.outdiv).find(".eden-number").draggable({helper:function(a){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(a,b){var c;if(g.dragint?c=Math.round(g.dragvalue+(b.position.left-g.dragstart)/2):(c=g.dragvalue+.005*(b.position.left-g.dragstart),c=c.toFixed(4)),c!=g.draglast){g.draglast=c,a.target.innerHTML=""+c;var d=a.target.parentNode.textContent;"\n"==d.charAt(d.length-1)&&(d=d.slice(0,-1)),g.replaceLine(g.dragline,d),g.ast=new Eden.AST(g.intextarea.value,(void 0),EdenUI.ScriptBox.consoleAgent,{noindex:!0}),g.highlighter.ast=g.ast,g.highlightContent(g.ast,g.dragline,-1),Eden.Statement.statements[g.currentstatement].setSource(g.intextarea.value,g.ast)}},start:function(a,b){g.edited=!0,g.dragline=g.findElementLineNumber(a.target),g.dragstart=b.position.left;var c=a.target.textContent;c.indexOf(".")==-1?(g.dragvalue=parseInt(c),g.dragint=!0):(g.dragvalue=parseFloat(c),g.dragint=!1),g.draglast=g.dragvalue,$(a.target).addClass("eden-select"),$(g.outdiv).css("cursor","ew-resize")},stop:function(a,b){$(a.target).removeClass("eden-select"),$(g.outdiv).css("cursor","text"),g.dragline=-1},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptBox.prototype.clear=function(){this.$codearea.html(""),this.setSource("")},EdenUI.ScriptBox.prototype.getLineNumber=function(a){var b=a.value.substr(0,a.selectionStart).split("\n");return this.currentlineno=b.length,this.currentcharno=b[b.length-1].length,this.currentlineno},EdenUI.ScriptBox.prototype.doRebuild=function(){this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight()},EdenUI.ScriptBox.prototype.runScript=function(a){},EdenUI.ScriptBox.prototype.rebuild=function(){clearTimeout(this.rebuildtimer);var a=this;this.rebuildtimer=setTimeout(function(){a.doRebuild()},this.rebuildinterval)},EdenUI.ScriptBox.prototype.findElementLineNumber=function(a){for(var b=a;b.parentNode!==this.outdiv;)b=b.parentNode;for(var c=0;c<this.outdiv.childNodes.length;c++)if(this.outdiv.childNodes[c]===b)return c;return-1},EdenUI.ScriptBox.prototype.replaceLine=function(a,b){var c=this.intextarea.value.split("\n");c[a]=b,this.intextarea.value=c.join("\n")},EdenUI.Explorer=function(){var a=this;this.element=$('<div class="explore-main"><div class="explore-tabs">\t<div class="explore-tab-container">\t\t<div class="explore-tab explore-tab-current" data-name="state">State</div>\t\t<div class="explore-tab explore-tab-notcurrent" data-name="scripts">Scripts</div>\t\t<div class="explore-tab explore-tab-notcurrent" data-name="palette">Palette</div>\t</div></div><div class="explore-state"></div><div class="explore-script" style="display: none"></div><div class="explore-console">\t<div class="explore-console-buttons">\t\t<div style="margin-top: 4px; float: left;">Script Input</div>\t\t<button class="control-button clear-button control-enabled" style="float: right;">&#xf05e;</button>\t</div>\t<div class="explore-console-code"></div></div></div>'),$("#jseden-main").append(this.element),this.consoleele=this.element.find(".explore-console-code"),this.expscripts=this.element.find(".explore-script"),this.expstate=this.element.find(".explore-state"),this.element.resizable({handles:"w",stop:function(a,b){console.log("RESIZESTOP",b),eden.root.lookup("jseden_explorer_width").assign(b.element[0].clientWidth+2,eden.root.scope,Symbol.localJSAgent)}}),eden.root.lookup("jseden_explorer_width").assign(this.element.get(0).clientWidth+2,eden.root.scope,Symbol.localJSAgent),this.console=new EdenUI.ScriptBox(this.consoleele.get(0),{nobuttons:!0}),this.state=new EdenUI.ExplorerState(this.expstate),this.scripts=new EdenUI.ExplorerScripts(this.expscripts),this.element.on("click",".clear-button",function(b){a.console.clear()}),this.element.on("click",".explore-tab",function(b){var c=b.currentTarget.getAttribute("data-name"),d=a.element.find(".explore-tab-current");d.removeClass("explore-tab-current"),d.addClass("explore-tab-notcurrent"),changeClass(b.currentTarget,"explore-tab-current",!0),changeClass(b.currentTarget,"explore-tab-notcurrent",!1),"state"==c?(a.expstate.css("display","flex"),a.expscripts.css("display","none")):"scripts"==c&&(a.expstate.css("display","none"),a.expscripts.css("display","flex"))});var b=eden.root.lookup("jseden_explorer_enabled"),c=b.value();c||(this.enabled=!1,this.element.hide()),b.addJSObserver("explorer",function(b,c){a.enabled=c,c?eden.root.lookup("jseden_explorer_visible").value()&&a.element.show():(a.element.hide(),a.capture=!1,a.clear())});var d=eden.root.lookup("jseden_explorer_visible"),e=d.value();e||this.element.hide(),d.addJSObserver("explorer",function(b,c){console.log("VISIBLE"),c&&a.enabled?(a.element.show(),eden.root.lookup("jseden_explorer_width").assign(a.element.get(0).clientWidth+2,eden.root.scope,Symbol.localJSAgent)):(a.element.hide(),a.state.capture=!1,a.state.clear(),eden.root.lookup("jseden_explorer_width").assign(0,eden.root.scope,Symbol.localJSAgent))});var f=eden.root.lookup("jseden_explorer_zoom"),g=f.value();f.addJSObserver("explorer",function(b,c){if("number"==typeof c&&c>0){var d=10*c;a.state.results.css("font-size",""+d+"pt")}}),void 0===g&&f.assign(1,eden.root.scope,Symbol.defaultAgent)},EdenUI.Explorer.MAXHIGHLIGHTLENGTH=1e3,EdenUI.Explorer.prototype.showConsole=function(){},EdenUI.Explorer.prototype.hideConsole=function(){},EdenUI.ExplorerState=function(a){var b=this;this.outer=a,this.controls=$('<div class="explore-controls">\t\t<button class="explorer-control capture"><span class="explorer-control-icon">&#xf111;</span>Capture</button>\t\t<button class="explorer-control clear"><span class="explorer-control-icon">&#xf05e;</span>Clear</button>\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="Filter..."></input></span>\t</div>'),this.results=$('<div class="explore-symbols"></div>'),this.outer.append(this.controls),this.outer.append(this.results),this.searchbox=this.controls.find(".explorerfilter"),this.watchobs={},this.capture=!1,this.delay=100,this.delay2=20,this.timeout=void 0,this.timeout2=void 0,this.mode="tree",this.index={},this.todo={},this.filter=void 0,eden.root.addGlobal(function(a,c){var d=a.name;!b.capture||c==Symbol.EXPIRED&&void 0!==b.watchobs[d]||void 0!==b.filter&&!b.filter[d]?(b.todo[d]=!0,void 0===b.timeout2&&(b.timeout2=setTimeout(function(){b.timeout2=void 0;var a=b.todo;b.todo={};for(var c in b.index)if(a[c]){var d=eden.root.symbols[c];if(void 0===d){for(var e=0;e<b.index[c].length;e++)b.removeEntry(c,b.index[c][e]);delete b.index[c]}else for(var e=0;e<b.index[c].length;e++)b.updateEntry(d,b.index[c][e])}},b.delay2))):(void 0===b.watchobs[d]?b.watchobs[a.name]=1:b.watchobs[d].lastupdate=1,b.triggerUpdate())}),this.controls.on("click",".clear",function(a){var b=eden.root.lookup("jseden_explorer_clear");b.eden_definition||b.assign(!0,eden.root.scope,Symbol.localJSAgent)}),this.controls.on("click",".capture",function(a){var b=eden.root.lookup("jseden_explorer_capture");b.eden_definition||b.assign(!b.value(),eden.root.scope,Symbol.localJSAgent)}),this.results.on("click",".explore-observable",function(a){var c=a.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");if(a.ctrlKey||a.metaKey)console.log("GOTO",c),edenUI.gotoCode("/"+c),a.stopPropagation();else{var d=eden.root.symbols[c];d&&(d.eden_definition?b.console.setSource(d.eden_definition):b.console.setSource(c+" = "+Eden.edenCodeForValue(d.value())+";"),b.console.focus())}}),this.results.on("click",".explore-expand-value",function(a){var c=a.currentTarget.parentNode.parentNode.parentNode,d=c.getAttribute("data-obs");b.updateEntry(eden.root.lookup(d),a.currentTarget.parentNode,!0)}),this.results.on("click",".eden-path",function(a){var b=a.currentTarget.textContent;edenUI.gotoCode(b,-1)}),this.results.on("click",".explore-entry-icon",function(a){var c=a.currentTarget.parentNode.parentNode.parentNode,d=c.getAttribute("data-obs"),e="true"==c.getAttribute("data-expanded");if(e){a.currentTarget.innerHTML="&#xf067;",c.setAttribute("data-expanded","false");for(var f=c.firstChild;f;){var g=f.nextSibling;"DIV"==f.nodeName&&"explore-entry-inner"!=f.className&&0==f.className.includes("active")&&c.removeChild(f),f=g}}else{a.currentTarget.innerHTML="&#xf068;",c.setAttribute("data-expanded","true");for(var h=eden.root.symbols[d],i={},f=c.firstChild;f;)"DIV"==f.nodeName&&(i[f.getAttribute("data-obs")]=!0),f=f.nextSibling;for(var j in h.dependencies)if(!i[j]){var k=h.dependencies[j],d=j,l=$('<div class="explore-entry" data-obs="'+d+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">&#xf067;</span><span class="explore-observable">'+d+'</span> </span><div class="symvalue"></div></div></div>'),m=l.find(".symvalue").get(0);b.updateEntry(k,m),void 0===b.index[d]&&(b.index[d]=[]),b.index[d].push(m),c.appendChild(l.get(0))}$(c).append(b.makeAgentEntry(h.last_modified_by))}});var c=eden.root.lookup("jseden_explorer_search"),d=c.value();d&&this.searchbox.val(searchval),c.addJSObserver("explorer",function(a,c){void 0!==c&&"*JavaScript"!=a.origin.name&&b.searchbox.val(c)}),this.searchbox.on("keyup",function(a){void 0===c.eden_definition&&c.assign(a.target.value,eden.root.scope,Symbol.localJSAgent)});var e=eden.root.lookup("jseden_explorer_watch"),f=e.value();Array.isArray(f)&&(this.clear(),this.watch(f)),e.addJSObserver("explorer",function(a,c){Array.isArray(c)&&(b.capture?b.filter=void 0:b.clear(),b.watch(c))});var g=eden.root.lookup("jseden_explorer_capture");g.addJSObserver("explorer",function(a,c){c?(b.record(),b.controls.find(".capture").addClass("active")):(b.capture=!1,b.controls.find(".capture").removeClass("active"))}),g.value()&&b.record();var h=eden.root.lookup("jseden_explorer_clear");h.addJSObserver("explorer",function(a,c){c&&b.clear()})},EdenUI.ExplorerState.prototype.triggerUpdate=function(){if(void 0===this.timeout){var a=this;this.timeout=setTimeout(function(){a.index={},a.timeout=void 0,"list"==a.mode?a.updateList():"tree"==a.mode?a.updateTree():"graph"==a.mode&&a.updateGraph()},this.delay)}},EdenUI.ExplorerState.prototype.updateList=function(){},EdenUI.ExplorerState.prototype.makeAgentEntry=function(a){var b=a.name;if(b.startsWith("*Console"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf108;</span> <b>console</b></div>');if(b.startsWith("*When")){var c=b.split(":"),d=c[1].split("/");return d=d[d.length-1],c=d+":"+c[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">when</span> <span class="eden-path">'+c+"</span></div>")}if(b.startsWith("*Action")){var c=b.split(":"),d=c[1].split("/");return d=d[d.length-1],c=d+":"+c[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">action</span> <span class="eden-path">'+c+"</span></div>")}if("/"==b.charAt(0)){if(a.eden_definition&&a.eden_definition.startsWith("proc"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">proc</span> <span class="eden-path">'+b+"</span></div>")}else if("*"!=b.charAt(0))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf15c;</span><span class="eden-path">'+b+"</span></div>")},EdenUI.ExplorerState.prototype.removeEntry=function(a,b){b.innerHTML='<span style="font-weight: bold; color: red">DELETED</span>',delete this.watchobs[a],this.triggerUpdate()},EdenUI.ExplorerState.prototype.updateEntry=function(a,b,c){if(a){var d,e,f=a.value();if(a.eden_definition&&a.eden_definition.startsWith("func"))e='<span class="eden-keyword">func</span>';else{if(c){var g=Eden.edenCodeForValue(f,void 0,2);d=g.length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(g,!0):g}else if(Array.isArray(f))d='[.. <span class="explore-expand-value">&#xf0fe;</span> ..]';else{var g=Eden.edenCodeForValue(f,void 0,2);d=g.length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(g,!0):g}var h=a.eden_definition?'<span class="eden-keyword">is</span>':"<b>=</b>";e=h+" "+d}b.innerHTML=e}},EdenUI.ExplorerState.prototype.makeEntry=function(a,b,c){var d=eden.root.symbols[a],e=$('<div class="explore-entry'+(c?" active":"")+'" data-obs="'+a+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">&#xf067;</span><span class="explore-observable">'+a+'</span> </span><div class="symvalue"></div></div></div>'),f=e.find(".symvalue").get(0);this.updateEntry(d,f),void 0===this.index[a]&&(this.index[a]=[]),this.index[a].push(f);var g=0;if(b)for(var h in b)g++,e.append(this.makeEntry(h,b[h],c));return e},EdenUI.ExplorerState.prototype.updateTree=function(){var a=this.capture?Eden.Query.dependencyTree(this.watchobs):this.watchobs;this.results.html("");for(var b in a)this.results.append(this.makeEntry(b,this.capture?a[b]:void 0,this.capture))},EdenUI.ExplorerState.prototype.watch=function(a){this.capture,void 0===this.filter&&a.length>0&&(this.filter={});for(var b=0;b<a.length;b++)void 0!==a[b]&&(this.filter[a[b]]=!0,this.capture||(this.watchobs[a[b]]={elements:[],lastupdate:1}));this.triggerUpdate()},EdenUI.ExplorerState.prototype.record=function(){this.watchobs={},this.triggerUpdate(),this.capture=!0},EdenUI.ExplorerState.prototype.clear=function(){this.watchobs={},this.filter=void 0,this.triggerUpdate()},EdenUI.ExplorerState.prototype.displayAsTree=function(){},EdenUI.ExplorerState.prototype.displayAsList=function(){},EdenUI.ExplorerState.prototype.displayAsGraph=function(){},EdenUI.ExplorerState.prototype.search=function(a){},EdenUI.ExplorerScripts=function(a){this.outer=a,this.controls=$('<div class="explore-controls">\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="Filter..."></input></span>\t</div>'),this.scripts=$('<div class="explore-scripts"></div>'),this.outer.append(this.controls),this.outer.append(this.scripts)},EdenUI.ExplorerScripts.prototype.buildScriptTree=function(a){for(var b={},c=0;c<a.length;c++)for(var d=a[c].split(/[\.\:]+/),e=b,f=0;f<d.length;f++)void 0===e[d[f]]&&(e[d[f]]={}),e=e[d[f]];return b},EdenUI.ExplorerScripts.prototype.makeEntry=function(a,b){for(var c in b){var d=$('<div class="explore-sentry"><div class="explore-script-inner"><span class="explore-entry-icon">&#xf067;</span>'+c+"</div></div>");this.makeEntry(d,b[c]),a.append(d)}},EdenUI.ExplorerScripts.prototype.update=function(){this.scripts.html("");var a=Eden.Selectors.query(">> script:has-name","id"),b=this.buildScriptTree(a),c=[],d=[];for(var e in Eden.Selectors.cache)d.push(e),c.push(Eden.Selectors.cache[e]);a=Eden.Selectors.queryWithin(c,">> script:has-name","id"),a.push.apply(a,d);var f={External:this.buildScriptTree(a)};this.makeEntry(this.scripts,b),this.makeEntry(this.scripts,f)},EdenUI.Markdown=function(a){this.contents=document.createElement("div"),this.contents.className="inputhider",this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.intextarea.value=a,this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="markdown-inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contentEditable=!0,this.outdiv.className="markdown-outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.highlighter=new EdenUI.Highlight(this.outdiv,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0}});new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.updateLineCachedHighlight()},EdenUI.Highlight.prototype.MARKDOWN=function(){"#"==this.token&&(this.stream.position-2<=0||"\n"==this.stream.code.charAt(this.stream.position-2))?(this.classes+=this.styles["hidden-comment"],this.mode="SECTION_TITLE",this.lineelement.className=this.styles["comment-line"]):this.COMMENT()},EdenUI.Markdown.styles={comment:"","hidden-comment":"markdown-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",string:"eden-string",keyword:"eden-keyword",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"markdown-comment-h1","comment-h2":"markdown-comment-h2","comment-h3":"eden-comment-h3","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"",doxytag:"markdown-tag"},EdenUI.Markdown.prototype.getLineNumber=function(){var a=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=a.length,this.currentcharno=a[a.length-1].length,this.currentlineno},EdenUI.Markdown.prototype.hideInfoBox=function(){},EdenUI.Markdown.prototype.disableGotoMode=function(){},EdenUI.Markdown.prototype.rebuild=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.updateLineCachedHighlight=function(){var a=new Eden.AST(this.intextarea.value,(void 0),{},{noparse:!0,noindex:!0}),b=-1,c=-1;document.activeElement===this.intextarea&&(c=this.intextarea.selectionEnd,b=this.getLineNumber(this.intextarea)),this.highlighter.highlight(a,-1,c)},EdenUI.Markdown.prototype.setValue=function(a){this.intextarea.value=a,this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.moveCaret=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.checkScroll=function(){},EdenUI.Markdown.prototype.enableGotoMode=function(){},EdenUI.Markdown.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.Markdown.prototype.setCaretToFakeCaret=function(){var a=$(this.outdiv).find(".fake-caret").get(0);if(a){var b=document.createRange(),c=window.getSelection();a.nextSibling&&(a=a.nextSibling),b.setStart(a,0),b.collapse(!0),c.removeAllRanges(),c.addRange(b),$(this.outdiv).remove(".fake-caret")}},EdenUI.ProjectDetails=function(a){var b=this;this.projectid=a,this.meta=void 0,this.obscurer=$('<div class="modal" style="display: block;"></div>'),this.obscurer.on("click",function(a){a.target===a.currentTarget&&b.remove()}),this.dialog=$('<div class="modal-content" style="width: 500px"></div>'),this.obscurer.append(this.dialog),document.body.appendChild(this.obscurer.get(0)),Eden.DB.getMeta(a,function(c){console.log("DETAILS META",c);var d=$('<img class="projectdetails-thumb" src="'+c[0].image+'"></img>');b.dialog.append(d),console.log(c[0].projectMetaData);var e=null!==c[0].projectMetaData?JSON.parse(c[0].projectMetaData):{},f=document.createElement("div");f.className="markdown";var g=new showdown.Converter,h=e.description.replace(/\s(#[a-zA-Z0-9]+)/g,' <span style="color:blue;">$1</span>'),i=g.makeHtml(h);f.innerHTML=i,b.dialog.get(0).appendChild(f);var j=c[0].date.split(/[- :]/),k=$('<div class="projectdetails">\t\t\t<span><span class="projectdetails-label">by:</span><span class="projectdetails-value">'+c[0].ownername+'</span></span>\t\t\t<span><span class="projectdetails-label">changed:</span><span class="projectdetails-value">'+get_time_diff(new Date(j[0],j[1]-1,j[2],j[3],j[4],j[5]).getTime()/1e3)+"</span></span>\t\t</div>");b.dialog.append(k);var l;l=c[0].owner==Eden.DB.userid?$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="deleteproject script-button"><span class="explorer-control-icon">&#xf00d;</span>Delete</button><br></div>'):$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><br></div>'),l.on("click",".openproject",function(){b.remove(),Eden.Project.load(a)}),l.on("click",".restoreproject",function(){b.remove(),eden.root.lookup("jseden_project_mode").assign("restore",eden.root.scope,Symbol.defaultAgent),Eden.Project.load(a)}),l.append($('<iframe src="https://www.facebook.com/plugins/like.php?href='+encodeURIComponent(window.location.href+"?load="+a)+'&width=350&layout=standard&action=like&size=small&show_faces=false&share=true&height=80&appId=1447073055317881" width="300" height="20" style="border:none;overflow:hidden;margin-left:5px;margin-top:5px;" scrolling="no" frameborder="0" allowTransparency="true"></iframe>')),b.dialog.append(l),Eden.DB.search(":parent("+a+")",function(a){if(a.length>0){var c=document.createElement("div");c.className="projectdetails-forks";for(var d=0;d<a.length;d++){var e=document.createElement("div");e.className="projectdetails-fork";var g=a[d].date.split(/[- :]/);e.innerHTML='Forked as "'+a[d].title+'" by '+a[d].ownername+" "+get_time_diff(new Date(g[0],g[1]-1,g[2],g[3],g[4],g[5]).getTime()/1e3),c.appendChild(e)}b.dialog.get(0).insertBefore(c,f.nextSibling.nextSibling)}})})},EdenUI.ProjectDetails.prototype.remove=function(){document.body.removeChild(this.obscurer.get(0))};