"undefined"!=typeof window||global,EdenUI.Highlight=function(e,t){this.ast=void 0,this.outelement=e,this.line=1,this.currentline=-1,this.mode_at_line={},this.heredocend=void 0,this.scrolltop=-1,this.token=void 0,this.prevtoken=void 0,this.prevprevtoken=void 0,this.modestack=[],this.linestack=void 0,this.outerline=void 0,this.lineelement=void 0,this.startmode=t&&t.start?t.start:"START",this.styles=t&&t.styles?t.styles:EdenUI.Highlight.defaultStyles,this.clearmodes=t&&t.clearmodes?t.clearmodes:EdenUI.Highlight.lineclearmode,this.mode=this.startmode,this.incomment=!1,this.brline=t&&t.brline,this.hidejs=!(!t||!t.removejs),this.custom={},this.current_custom=null,this.cs3=eden.root.lookup("jseden_parser_cs3").value(),this.styleExtensions={},this.metrics={}},EdenUI.Highlight.defaultStyles={comment:"eden-comment","hidden-comment":"eden-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",parameter:"eden-parameter",keyword:"eden-keyword",builtin:"eden-builtin",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",selector4:"eden-selector4",error:"eden-selectorerror",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",subexpr:"eden-subexpression",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"eden-comment-h1","comment-h2":"eden-comment-h2","comment-h3":"eden-comment-h3","comment-h4":"eden-comment-h4","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"eden-line-script",doxytag:"eden-doxytag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote",script:"eden-script",notexist:"eden-notexist",htmltag:"html-tagname",htmlattribute:"html-attributename"},EdenUI.Highlight.prototype.pushLine=function(){this.linestack.push(this.lineelement)},EdenUI.Highlight.prototype.pushMode=function(){this.modestack.push(this.mode)},EdenUI.Highlight.prototype.popLine=function(){0<this.linestack.length&&(this.lineelement=this.linestack.pop())},EdenUI.Highlight.prototype.popMode=function(){0<this.modestack.length&&(this.mode=this.modestack.pop())},EdenUI.Highlight.prototype.setScrollTop=function(e){this.scrolltop=e},EdenUI.Highlight.isType=function(e){return!1},EdenUI.Highlight.lineclearmode={COMMENT:!0,SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE3:!0,SECTION_TITLE4:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,SECTION_TITLE_H3:!0,SECTION_TITLE_H4:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,COMMENT_BOLD_END:!0,COMMENT_QUERY:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0,COMMENT_HTML:!0,COMMENT_HTML_START:!0,COMMENT_HTML_CONTENT:!0,COMMENT_ATTRS:!0},EdenUI.Highlight.prototype.applyClasses=function(e,t){for(var i=t||this.classes,n="",s=0;s<i.length;s++)if(n+=this.styles[i[s]]+" ",this.styleExtensions[i[s]]){var o,a=this.styleExtensions[i[s]];for(o in a)this.applyAttribute(e,o,a[o])}e.className=n.trim()},EdenUI.Highlight.prototype.generateClasses=function(){for(var e="",t=0;t<this.classes.length;t++)e+=this.styles[this.classes[t]]+" ";return e.trim()},EdenUI.Highlight.prototype.highlightLine=function(e,t){var i=-1,n=-1,s=!1,o=e.stream;this.stream=o;var a,r="INVALID",d="INVALID";this.outerline="eden-line",this.linestack=[],this.mode_at_line[this.line-1]?this.mode=this.mode_at_line[this.line-1]:this.mode=this.startmode,this.clearmodes[this.mode]&&(this.incomment=!1,this.mode=this.startmode),e.script&&0<e.script.errors.length&&(i=e.script.errors[0].prevposition,n=e.script.errors[0].position,e.script.errors[0].messageText());var l="",c=document.createElement("div");for(c.className=this.styles["script-line"];;){if(o.position==t){""!=l&&(p=document.createTextNode(l),c.appendChild(p),l=""),(g=document.createElement("span")).className="fake-caret",c.appendChild(g);for(var h=c;h&&"DIV"!=h.nodeName;)h=h.parentNode;h&&h.className.startsWith(this.styles["comment-line"])&&(h.className+=" current")}var p,u=o.peek();if(10==u||13==u){""!=l&&(c.lastChild&&c.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=c.lastChild.className?c.lastChild.lastChild&&"#text"==c.lastChild.lastChild.nodeName?c.lastChild.lastChild.textContent+=l:(p=document.createTextNode(l),c.lastChild.appendChild(p)):(p=document.createTextNode(l),c.appendChild(p)),l="");break}if(9!=u&&13!=u&&32!=u&&160!=u){if(""!=l&&(c.lastChild&&c.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=c.lastChild.className?c.lastChild.lastChild&&"#text"==c.lastChild.lastChild.nodeName?c.lastChild.lastChild.textContent+=l:(p=document.createTextNode(l),c.lastChild.appendChild(p)):(p=document.createTextNode(l),c.appendChild(p)),l=""),a=d,d=r,r=o.readToken(this.incomment),this.hidejs&&"${{"===r?(o.readJSToken(),r="NATIVE",this.tokentext="[[Native]]"):this.tokentext=o.tokenText(),"string"!=typeof r&&console.error("Token error: line = "+this.line+" position = "+o.position),"EOF"==r){""!=l&&(c.lastChild&&c.lastChild.className!=this.styles["hidden-comment"]&&"fake-caret"!=c.lastChild.className?c.lastChild.lastChild&&"#text"==c.lastChild.lastChild.nodeName?c.lastChild.lastChild.textContent+=l:(p=document.createTextNode(l),c.lastChild.appendChild(p)):(p=document.createTextNode(l),c.appendChild(p)),l="");break}if("INVALID"!=r)if(this.token=r,this.prevtoken=d,this.prevprevtoken=a,this.type=o.tokenType(r),this.classes=[],this.lineelement=c,-1!=i&&(i<=o.prevposition&&!s&&(s=!0),n<=o.prevposition&&s&&(s=!1)),s&&"EOF"!=e.script.errors[0].token&&this.classes.push("error"),void 0===this[this.mode]&&console.error("No Mode",this.mode),this[this.mode].call(this),c=this.lineelement,o.prevposition<t&&o.position>t){var m,g=t-o.prevposition,b=this.tokentext.slice(0,g),v=this.tokentext.slice(g),f=document.createElement("span");this.applyClasses(f),(m=document.createElement("span")).appendChild(document.createTextNode(b)),f.appendChild(m),(g=document.createElement("span")).className="fake-caret",f.appendChild(g),(m=document.createElement("span")).appendChild(document.createTextNode(v)),f.appendChild(m),c.appendChild(f);for(h=c;h&&"DIV"!=h.nodeName;)h=h.parentNode;h&&h.className.startsWith(this.styles["comment-line"])&&(h.className+=" current")}else c.lastChild&&c.lastChild.className==this.generateClasses()?(m=c.lastChild).lastChild&&"#text"==m.lastChild.nodeName?m.lastChild.textContent+=this.tokentext:m.appendChild(document.createTextNode(this.tokentext)):(m=document.createElement("span"),this.applyClasses(m),m.appendChild(document.createTextNode(this.tokentext)),c.appendChild(m));else console.log("INVALID: "+o.peek()),o.skip()}else o.skip(),32==u||160==u?l+=" ":13!=u&&(l+=String.fromCharCode(u))}return 0<this.linestack.length&&(c=this.linestack[0]),this.mode_at_line[this.line]=this.mode,c},EdenUI.Highlight.prototype.updateAST=function(e){this.ast=e,this.errstart=-1,this.errend=-1,this.errmsg="",this.inerror=!1,this.stream=e.stream,this.stream.reset(),this.title="",e.script&&0<e.script.errors.length&&(this.errstart=e.script.errors[0].prevposition,this.errend=e.script.errors[0].position,this.errmsg=e.script.errors[0].messageText())},EdenUI.Highlight.prototype.highlightAll=function(o,a){var e,t,i,n,s,r,d=void 0,l=0,c=this.stream;function h(){s.insertBefore(t,r)}this.cs3=eden.root.lookup("jseden_parser_cs3").value(),this.metrics={},this.styleExtensions={},t=(e=this).outelement,i=!1,n=function(){for(;this.outelement.lastChild;)this.outelement.removeChild(this.outelement.lastChild);for(this.mode_at_line={};c.valid();){var e,t,i=c.peek();10!=i&&13!=i?this.disablehl||0<=this.scrolltop&&(this.line<this.scrolltop-105||this.line>this.scrolltop+105)?(-1==(t=c.code.indexOf("\n",c.position))?(e=c.code.substring(c.position),c.position=c.code.length):(e=c.code.substring(c.position,t),c.position=t),d=document.createTextNode(e),this.disablehl||"#"!=e.trim().charAt(0)||(this.outerline="eden-line eden-wrapline")):d=this.highlightLine(this.ast,o):(l<=this.errstart&&(c.position,this.errend),(n=document.createElement("div")).className=this.outerline,a&&a.spacing&&a.spacing[this.line]&&(n.height=a.spacing[this.line]+"px"),n.setAttribute("data-line",this.line-1),this.line++,void 0!==(d=void 0===d&&this.brline?document.createElement("br"):d)?n.appendChild(d):this.mode_at_line[this.line-1]=this.mode,t=document.createTextNode("\n"),n.appendChild(t),this.outelement.appendChild(n),l=c.position+1,d=void 0,c.skip(),13==i&&c.skip(),this.outerline="eden-line")}var n,s;l<=this.errstart&&(c.position,this.errend),void 0!==(d=void 0===d&&this.brline?document.createElement("br"):d)?((n=document.createElement("div")).className="eden-line",n.style.minHeight=(a&&a.spacing&&a.spacing[this.line]?a.spacing[this.line]:20)+"px",n.setAttribute("data-line",this.line-1),n.appendChild(d)):(n=document.createElement("div"),o>=c.position?(n.className="eden-line",n.style.minHeight=(a&&a.spacing&&a.spacing[this.line]?a.spacing[this.line]:20)+"px",n.setAttribute("data-line",this.line-1),(s=document.createElement("span")).className="fake-caret",n.appendChild(s)):n.className="eden-line"),this.outelement.appendChild(n)},s=t.parentNode,r=t.nextSibling,s?(s.removeChild(t),"boolean"!=typeof i&&(n=i,i=!1),n&&i?n.call(e,t,h):n&&(n.call(e,t),h())):n.call(e,t)},EdenUI.Highlight.prototype.highlightOpt=function(e,t,i){for(var n=void 0,s=0,o=this.stream;o.valid()&&this.line<e-1;)10!=(u=o.peek())&&13!=u||this.line++,o.skip(),13==u&&o.skip();for(var a,r=2;0<=r;r--)if(this.line=e-r+1,this.metrics[this.line]&&delete this.metrics[this.line],void 0!==(a=this.outelement.childNodes[e-r])){for(;a.lastChild;)a.removeChild(a.lastChild);var d,l,c,h,p,s=o.position,n=this.disablehl?(-1==(l=o.code.indexOf("\n",o.position))?(d=o.code.substring(o.position),o.position=o.code.length):(d=o.code.substring(o.position,l),o.position=l),s<t&&o.position>t?(h=t-s,c=d.slice(0,h),p=d.slice(h),l=document.createElement("span"),c=document.createTextNode(c),l.appendChild(c),(h=document.createElement("span")).className="fake-caret",l.appendChild(h),p=document.createTextNode(p),l.appendChild(p),l):document.createTextNode(d)):this.highlightLine(this.ast,t);s<=this.errstart&&(o.position,this.errend);a.appendChild(n),a.className=this.outerline;var u=o.peek(),m=document.createTextNode("\n");a.appendChild(m),o.skip(),13==u&&o.skip()}if(!this.disablehl)for(;void 0!==this.mode_at_line[this.line+1]&&this.mode_at_line[this.line]!=this.mode_at_line[this.line+1];)if(this.line++,this.metrics[this.line]&&delete this.metrics[this.line],void 0!==(a=this.outelement.childNodes[this.line-1])){for(;a.lastChild;)a.removeChild(a.lastChild);s=o.position,n=this.highlightLine(this.ast,t),s<=this.errstart&&(o.position,this.errend),a.appendChild(n),a.className=this.outerline;u=o.peek(),m=document.createTextNode("\n");a.appendChild(m),o.skip(),13==u&&o.skip()}},EdenUI.Highlight.prototype.highlight=function(e,t,i,n){if(this.ast=e,this.updateAST(e),this.line=1,void 0!==this.outelement){if(0!=e.stream.code.length)return this.disablehl=!(!n||!n.disabled),-1==t?this.highlightAll(i,n):this.highlightOpt(t,i,n);this.outelement&&(this.outelement.innerHTML="<div class='eden-line'><span class='fake-caret'></span></div>")}},EdenUI.Highlight.html=function(e,t,i){var n=document.createElement("div"),s=new EdenUI.Highlight(n);if(s.ast={stream:new Eden.EdenStream(e)},s.highlight(s.ast,-1,-1,void 0),t)return n.childNodes[0].innerHTML;for(var o="",a=0;a<n.childNodes.length;a++)o+=n.childNodes[a].innerHTML;return i?'<div style="display: flex; align-items: center;"><div class="eden-hl-play" data-src="'+e+'">&#xf04b;</div><div>'+o+"</div></div>":o},EdenUI.Highlight.htmlElement=function(e,t,i){e&&((i=new EdenUI.Highlight(t,i)).ast={stream:new Eden.EdenStream(e)},i.highlight(i.ast,-1,-1))};var edenSpecials={autocalc:!0,mouseX:!0,mouseY:!0,mousePosition:!0,screenHeight:!0,screenWidth:!0,PI:!0},edenValues={true:!0,false:!0,green:!0},edenBuiltin={exec:!0,execute:!0,parse:!0,eval:!0,compile:!0,append:!0,insert:!0,delete:!0},edenAttributes={atomic:!0,nonatomic:!0,fixed:!0,nodepend:!0,depend:!0,eager:!0,volatile:!0,static:!0,const:!0,changed:!0,all:!0,number:!0,string:!0,list:!0,boolean:!0,undefined:!0,object:!0},jskeywords={var:!0,if:!0,while:!0,typeof:!0,this:!0,function:!0,return:!0,else:!0,break:!0,continue:!0,switch:!0,for:!0,prototype:!0};EdenUI.Highlight.prototype.START=function(){switch(9==this.outerline.length&&(this.outerline="eden-line script"),this.token){case"##":this.stream.isBOL()?(this.outerline="eden-line comment",this.classes.push("hidden-comment"),this.mode="SECTION_TITLE",this.applyClasses(this.lineelement,["comment-line"]),32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes.push("comment"),this.mode="COMMENT");break;case"#":var e;this.stream.isFollowingWhiteSpace()?((e=33==this.stream.peek())&&(this.tokentext+="!",this.stream.position++),this.classes.push("hidden-comment"),this.mode="COMMENT",this.incomment=!0,this.stream.isBOL()&&(this.outerline="eden-line comment"),"INVALID"==this.prevtoken&&(this.lineelement.style.marginLeft="0"),i=document.createElement("div"),this.applyClasses(i,e?["comment-line","doxycomment"]:["comment-line"]),this.pushLine(),this.lineelement.appendChild(i),this.lineelement=i,32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):this.classes.push("operator");break;case"local":case"para":case"handle":case"role":case"oracle":case"auto":this.classes.push("storage");break;case"NUMBER":this.classes.push("number");break;case"STRING":this.classes.push("string");break;case"BOOLEAN":this.classes.push("constant");break;case"NATIVE":this.classes.push("block-comment");break;case"'":this.classes.push("string"),this.pushMode(),this.mode="TEMPLATESTRING";break;case":":this.classes.push("operator"),"is"!=this.prevtoken&&"OBSERVABLE"!=this.prevtoken&&")"!=this.prevtoken||(this.pushMode(),this.mode="ATTRIBUTES");break;case"import":case"do":this.classes.push("keyword"),this.pushMode(),this.mode="SELECTOR",this.pushMode(),this.mode="ATTRIBUTES";break;case"${{":this.classes.push("javascript"),this.mode="JAVASCRIPT";break;case"?":this.classes.push("selector"),this.pushMode(),this.mode="SELECTOR";break;case"<":this.cs3&&"OBSERVABLE"!=this.prevtoken&&")"!=this.prevtoken&&"]"!=this.prevtoken&&"}"!=this.prevtoken?(this.classes.push("htmltag"),this.pushMode(),this.mode="HTML"):this.classes.push("operator");break;case"</":this.cs3&&(this.pushMode(),this.mode="HTML_CLOSE",this.classes.push("htmltag"));break;case"<<":this.stream.readToken();var t=this.stream.tokenText();this.tokentext+=t,this.heredocend=t,this.classes.push("storage"),this.mode="HEREDOC";break;case"%":if(this.stream.isBOL()){var i=this.stream.peek();if(10!=i&&32!=i){this.stream.readToken();t=this.stream.tokenText();if(this.custom.hasOwnProperty(t)||(this.custom[t]={keywords:null,operators:null,specials:null,typenames:null}),this.current_custom=this.custom[t],!this.current_custom.keywords){var n=eden.root.lookup("script_"+t+"_keywords").value();if(Array.isArray(n)){this.current_custom.keywords={};for(var s=0;s<n.length;++s)this.current_custom.keywords[n[s]]=!0}}if(!this.current_custom.operators){n=eden.root.lookup("script_"+t+"_operators").value();if(Array.isArray(n)){this.current_custom.operators={};for(s=0;s<n.length;++s)this.current_custom.operators[n[s]]=!0}}if(!this.current_custom.specials){n=eden.root.lookup("script_"+t+"_specials").value();if(Array.isArray(n)){this.current_custom.specials={};for(s=0;s<n.length;++s)this.current_custom.specials[n[s]]=!0}}if(!this.current_custom.typenames){n=eden.root.lookup("script_"+t+"_types").value();if(Array.isArray(n)){this.current_custom.typenames={};for(s=0;s<n.length;++s)this.current_custom.typenames[n[s]]=!0}}this.tokentext+=t,this.heredocend="eden",this.classes.push("storage"),this.mode="CUSTOMBLOCK"}}break;case"OBSERVABLE":Eden.edenFunctions[this.stream.data.value]?this.classes.push("function"):EdenUI.Highlight.isType(this.stream.data.value)?this.classes.push("type"):edenValues[this.stream.data.value]?this.classes.push("constant"):edenSpecials[this.stream.data.value]?this.classes.push("special"):"$"==this.stream.data.value.charAt(0)?this.classes.push("parameter"):(this.classes.push("observable"),Eden.Index.name_index.hasOwnProperty(this.stream.data.value)||eden.root.symbols[this.stream.data.value]||this.classes.push("notexist"));break;case"`":this.pushMode(),this.mode="STARTBACKTICK",this.classes.push("builtin");break;case"${":this.pushMode(),this.mode="STARTSUBEXPRESSION",this.classes.push("builtin");break;default:"keyword"==this.type?edenBuiltin[this.token]?this.classes.push("builtin"):this.classes.push("keyword"):"-"==this.token&&this.stream.isNumeric(this.stream.peek())?(this.token=this.stream.readToken(),this.tokentext="-"+this.stream.tokenText(),this.classes.push("number")):"/*"==this.token?(42==this.stream.peek()?(this.pushMode(),this.mode="DOXY_COMMENT"):(this.pushMode(),this.mode="BLOCK_COMMENT"),this.classes.push("block-comment")):this.classes.push("operator")}},EdenUI.Highlight.prototype.START_MINIMAL=function(){switch(9==this.outerline.length&&(this.outerline="eden-line script"),this.token){case"NUMBER":this.classes.push("number");break;case"STRING":this.classes.push("string");break;case"BOOLEAN":this.classes.push("constant");break;case"CHARACTER":this.classes.push("string");break;case"OBSERVABLE":default:var e;"-"==this.token&&this.stream.isNumeric(this.stream.peek())?(this.token=this.stream.readToken(),this.tokentext="-"+this.stream.tokenText(),this.classes.push("number")):"/*"==this.token?(this.pushMode(),this.mode="BLOCK_COMMENT",this.classes.push("block-comment")):(e="keyword"==this.type||"operator"==this.type||"separator"==this.type?this.token:this.stream.data.value,this.current_custom.keywords&&this.current_custom.keywords[e]?this.classes.push("keyword"):this.current_custom.operators&&this.current_custom.operators[e]?this.classes.push("operator"):this.current_custom.specials&&this.current_custom.specials[e]?this.classes.push("special"):this.current_custom.typenames&&this.current_custom.typenames[e]?(console.log("highlight",e),this.classes.push("storage")):this.classes.push("observable"))}},EdenUI.Highlight.prototype.TEMPLATESTRING=function(){9==this.outerline.length&&(this.outerline="eden-line script"),"'"==this.token&&"\\"!=this.prevtoken?(this.classes.push("string"),this.popMode()):"{"==this.token&&"\\"!=this.prevtoken?(this.pushMode(),this.classes.push("builtin"),this.mode="TEMPLATESUBEXPR"):this.classes.push("string")},EdenUI.Highlight.prototype.TEMPLATESUBEXPR=function(){"}"==this.token&&"\\"!=this.prevtoken?(this.classes.push("builtin"),this.popMode()):this.START()},EdenUI.Highlight.prototype.STARTBACKTICK=function(){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["backticks"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="BACKTICK",this.cs3&&this.classes.push("string")},EdenUI.Highlight.prototype.BACKTICK=function(){"`"==this.token?(this.classes.push("builtin"),this.popMode(),this.popLine()):"{"===this.token?(this.classes.push("builtin"),this.pushMode(),this.mode="BTICKEXPR"):this.cs3&&this.classes.push("string")},EdenUI.Highlight.prototype.BTICKEXPR=function(){"}"==this.token?(this.classes.push("builtin"),this.popMode()):this.START()},EdenUI.Highlight.prototype.STARTSUBEXPRESSION=function(){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["subexpr"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="SUBEXPRESSION",this.START()},EdenUI.Highlight.prototype.SUBEXPRESSION=function(){"}"==this.token?(this.classes.push("builtin"),this.popMode(),this.popLine()):this.START()},EdenUI.Highlight.prototype.ATTRIBUTES=function(){var e;"["==this.token?(this.pushLine(),e=document.createElement("span"),this.applyClasses(e,["pathblock"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="ATTRIBS",this.ATTRIBS()):"OBSERVABLE"==this.token?(this.popMode(),edenAttributes[this.tokentext]||Eden.Selectors.resultTypes[this.tokentext]?this.classes.push("selector3"):this.classes.push("error")):(this.popMode(),this[this.mode]())},EdenUI.Highlight.prototype.ATTRIBS=function(){"OBSERVABLE"==this.token&&(edenAttributes[this.tokentext]||Eden.Selectors.resultTypes[this.tokentext])?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.popMode(),this.popLine()):"["==this.token?this.classes.push("selector"):this.classes.push("error")},EdenUI.Highlight.prototype.SELECTOR=function(){this.pushLine();var e=document.createElement("span");this.applyClasses(e,["pathblock"]),this.lineelement.appendChild(e),this.lineelement=e,this.mode="SELECTOR2",this.SELECTOR2()},EdenUI.Highlight.prototype.DO_ATTRIBS=function(){"OBSERVABLE"==this.token&&edenAttributes[this.tokentext]?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.mode="SELECTOR"):this.classes.push("selector")},EdenUI.Highlight.prototype.SUB_EXPRESSION=function(){"}"==this.token?this.popMode():this[this.startmode]()},EdenUI.Highlight.prototype.SELECTOR2=function(){"{"==this.token?(this.classes.push("operator"),this.pushMode(),this.mode="SUB_EXPRESSION"):";"==this.token||"="==this.token||"+="==this.token||"//="==this.token?(this.popLine(),this.classes.push("operator"),this.popMode()):"::"==this.token||"with"==this.token?(this.popLine(),this.classes.push("keyword"),this.popMode()):"OBSERVABLE"==this.token&&"@"==this.prevtoken&&(Eden.Selectors.PropertyNode.attributes[this.tokentext]||Eden.Selectors.allowedOptions[this.tokentext])?this.classes.push("selector4"):"OBSERVABLE"!=this.token||"."!=this.prevtoken&&":"!=this.prevtoken||!Eden.Selectors.PropertyNode.attributes[this.tokentext]&&!Eden.Selectors.PropertyNode.pseudo[this.tokentext]?(")"==this.token&&(this.popMode(),this.popLine()),this.classes.push("selector")):(this.classes.push("selector2"),this.pushMode(),this.mode="SELECTOR3")},EdenUI.Highlight.prototype.SELECTOR3=function(){"("==this.token?(this.pushLine(),this.mode="SELECTOR2"):(this.popMode(),this[this.mode]())},EdenUI.Highlight.prototype.SELECTOR_TYPES=function(){"OBSERVABLE"==this.token&&Eden.Selectors.resultTypes[this.tokentext]?this.classes.push("selector3"):"]"==this.token?(this.classes.push("selector"),this.popMode()):this.classes.push("selector")},EdenUI.Highlight.prototype.JAVASCRIPT=function(){this.classes.push("javascript"),"}}$"==this.token&&(this.mode=this.startmode)},EdenUI.Highlight.prototype.HEREDOC=function(){9==this.outerline.length&&(this.outerline="eden-line script"),"INVALID"==this.prevtoken&&this.tokentext==this.heredocend?(this.classes.push("storage"),this.mode=this.startmode):this.classes.push("string")},EdenUI.Highlight.prototype.CUSTOMBLOCK=function(){if(9==this.outerline.length&&(this.outerline="eden-line script"),"%"==this.token){var e=this.stream.peek();if(10!=e&&32!=e){this.stream.readToken();e=this.stream.tokenText();if(this.tokentext+=e,this.tokentext=="%"+this.heredocend)return this.classes.push("storage"),void(this.mode=this.startmode)}}this.START_MINIMAL(),this.classes.push("javascript")},EdenUI.Highlight.prototype.SECTION_TITLE=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.applyClasses(this.lineelement,["comment-line","comment-h2"]),this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):"##"==this.token?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.applyClasses(this.lineelement,["comment-line","comment-h1"]),this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE2=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE3",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.classes.push("comment-h2"),this.mode="SECTION_TITLE_H2")},EdenUI.Highlight.prototype.SECTION_TITLE3=function(){"#"==this.token?(this.classes.push("hidden-comment"),this.applyClasses(this.lineelement,["comment-line","comment-h4"]),this.mode="COMMENT",32==this.stream.peek()&&(this.tokentext+=" ",this.stream.position++)):(this.applyClasses(this.lineelement,["comment-line","comment-h3"]),this.mode="COMMENT",this.COMMENT())},EdenUI.Highlight.prototype.SECTION_TITLE4=function(){this.classes.push("comment-h4"),this.mode="SECTION_TITLE_H4"},EdenUI.Highlight.prototype.SECTION_TITLE_H1=function(){this.classes.push("comment-h1")},EdenUI.Highlight.prototype.SECTION_TITLE_H2=function(){this.classes.push("comment-h2")},EdenUI.Highlight.prototype.SECTION_TITLE_H3=function(){this.classes.push("comment-h3")},EdenUI.Highlight.prototype.SECTION_TITLE_H4=function(){this.classes.push("comment-h4")},EdenUI.Highlight.prototype.BLOCK_COMMENT=function(){"*/"===this.token&&(this.popMode(),"BLOCK_COMMENT"==this.mode&&(this.mode=this.startmode)),this.classes.push("block-comment")},EdenUI.Highlight.prototype.COMMENT=function(){switch(this.token){case"@":case"#":this.mode="COMMENT_TAG",this.pushLine();var e=document.createElement("span");this.applyClasses(e,["doxytag"]),this.lineelement.appendChild(e),this.lineelement=e;break;case"-":case"*":"##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek()?"-"!=this.token?(this.pushMode(),this.mode="COMMENT_EMPH",this.classes.push("hidden-comment")):this.classes.push("comment"):(this.pushLine(),e=document.createElement("span"),this.applyClasses(e,["comment-ul"]),this.lineelement.appendChild(e),this.lineelement=e,this.classes.push("hidden-comment"));break;case"--":if(45==this.stream.peek()){for(this.outerline="eden-line eden-section-line";45==this.stream.peek();)this.tokentext+="-",this.stream.position++;this.classes.push("hidden-comment")}else this.classes.push("comment");break;case"[":32!=this.stream.peek()?(this.pushMode(),this.mode="COMMENT_LINK",this.pushLine(),e=document.createElement("span"),this.lineelement.appendChild(e),this.lineelement=e,this.classes.push("hidden-comment")):this.classes.push("comment");break;case"!":91==this.stream.peek()?(this.mode="COMMENT_IMAGE",this.tokentext+="[",this.stream.position++,this.classes.push("hidden-comment")):this.classes.push("comment");break;case"$":91==this.stream.peek()?(this.pushMode(),this.mode="COMMENT_BUTTON",this.tokentext+="[",this.stream.position++,this.classes.push("hidden-comment")):this.classes.push("comment");break;case">":"##"!=this.prevtoken&&"#"!=this.prevtoken&&"INVALID"!=this.prevtoken||32!=this.stream.peek()&&9!=this.stream.peek()?this.classes.push("comment"):(this.outerline+=" "+this.styles["comment-blockquote"],this.classes.push("hidden-comment"));break;case"`":this.pushMode(),this.mode="COMMENT_CODE",this.classes.push("hidden-comment");break;case":":32!=this.stream.peek()?(this.pushMode(),this.mode="COMMENT_ICON",this.classes.push("hidden-comment")):this.classes.push("comment");break;case"<":32!=this.stream.peek()?(this.mode="COMMENT_HTML",this.classes.push("hidden-comment")):this.classes.push("comment");break;case"\\":this.pushMode(),this.mode="COMMENT_ESCAPE",this.classes.push("hidden-comment");break;case"?":this.pushMode(),this.mode="COMMENT_QUERY",this.cacheddata=void 0,null==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].query=!0,void 0===this.metrics[this.line].qelements&&(this.metrics[this.line].qelements=[]),this.classes.push("hidden-comment");break;case"{":this.pushMode(),this.mode="COMMENT_ATTRS",this.classes.push("hidden-comment");break;default:this.classes.push("comment")}};var css_color_names={aliceblue:!0,antiquewhite:!0,aqua:!0,aquamarine:!0,azure:!0,beige:!0,bisque:!0,black:!0,blanchedalmond:!0,blue:!0,blueviolet:!0,brown:!0,burlywood:!0,cadetblue:!0,chartreuse:!0,chocolate:!0,coral:!0,cornflowerblue:!0,cornsilk:!0,crimson:!0,cyan:!0,darkblue:!0,darkcyan:!0,darkgoldenrod:!0,darkgray:!0,darkgrey:!0,darkgreen:!0,darkkhaki:!0,darkmagenta:!0,darkolivegreen:!0,darkorange:!0,darkorchid:!0,darkred:!0,darksalmon:!0,darkseagreen:!0,darkslateblue:!0,darkslategray:!0,darkslategrey:!0,darkturquoise:!0,darkviolet:!0,deeppink:!0,deepskyblue:!0,dimgray:!0,dimgrey:!0,dodgerblue:!0,firebrick:!0,floralwhite:!0,forestgreen:!0,fuchsia:!0,gainsboro:!0,ghostwhite:!0,gold:!0,goldenrod:!0,gray:!0,grey:!0,green:!0,greenyellow:!0,honeydew:!0,hotpink:!0,indianred:!0,indigo:!0,ivory:!0,khaki:!0,lavender:!0,lavenderblush:!0,lawngreen:!0,lemonchiffon:!0,lightblue:!0,lightcoral:!0,lightcyan:!0,lightgoldenrodyellow:!0,lightgray:!0,lightgrey:!0,lightgreen:!0,lightpink:!0,lightsalmon:!0,lightseagreen:!0,lightskyblue:!0,lightslategray:!0,lightslategrey:!0,lightsteelblue:!0,lightyellow:!0,lime:!0,limegreen:!0,linen:!0,magenta:!0,maroon:!0,mediumaquamarine:!0,mediumblue:!0,mediumorchid:!0,mediumpurple:!0,mediumseagreen:!0,mediumslateblue:!0,mediumspringgreen:!0,mediumturquoise:!0,mediumvioletred:!0,midnightblue:!0,mintcream:!0,mistyrose:!0,moccasin:!0,navajowhite:!0,navy:!0,oldlace:!0,olive:!0,olivedrab:!0,orange:!0,orangered:!0,orchid:!0,palegoldenrod:!0,palegreen:!0,paleturquoise:!0,palevioletred:!0,papayawhip:!0,peachpuff:!0,peru:!0,pink:!0,plum:!0,powderblue:!0,purple:!0,red:!0,rosybrown:!0,royalblue:!0,saddlebrown:!0,salmon:!0,sandybrown:!0,seagreen:!0,seashell:!0,sienna:!0,silver:!0,skyblue:!0,slateblue:!0,slategray:!0,slategrey:!0,snow:!0,springgreen:!0,steelblue:!0,tan:!0,teal:!0,thistle:!0,tomato:!0,turquoise:!0,violet:!0,wheat:!0,white:!0,whitesmoke:!0,yellow:!0,yellowgreen:!0};EdenUI.Highlight.prototype.applyAttribute=function(e,t,i){if(e.style)switch(t){case"color":case"font-size":case"font-family":case"font-weight":case"font-style":case"text-decoration":case"margin-left":case"margin-right":e.style[t]=i;break;case"editable":"true"!=i&&"false"!=i||(e.contentEditable=i);break;case"script":e.setAttribute("data-jseden",i),e.contentEditable=!1,e.style.cursor="pointer",changeClass(e,"executable",!0);break;case"width":case"height":e.setAttribute(t,i);break;case"background":e.style.background=i;break;case"title":e.title=i;break;case"cursor":e.style.cursor=i;break;case"class":this.applyClasses(e,i.split(" "));break;default:e.style[t]=i}},EdenUI.Highlight.prototype.parseAttrs=function(e,t){var i,n;if(t=(t=(t=t||this.lineelement.lastChild)?t.previousSibling:this.lineelement)||this.lineelement,"."==(e=e.trim()).charAt(0)){var s=e.substring(1).match(/[a-z0-9\-]+/);if(null===s)return;i=s[0],e=e.substring(i.length+1).trim(),void 0===this.styleExtensions[i]&&(this.styleExtensions[i]={})}for(;e&&0<e.length;){e=-1==(a=e.indexOf("="))?(n=e,""):(n=e.substring(0,a),e.substring(a+1));var o="";if("?"!=e.charAt(0))if('"'==e.charAt(0)||"'"==e.charAt(0)){for(var a=-1,r=e.charAt(0),d=1;d<e.length;d++){if(e.charAt(d)==r){a=d;break}"\\"==e.charAt(d)&&d++}if(-1==a)break;o=e.substring(1,a),e=e.substring(a+1)}else if(0<e.length){a=-1;for(d=0;d<e.length;d++)if(" "==e.charAt(d)){a=d;break}e=-1==a?(o=e,""):(o=e.substring(0,a),e.substring(a+1))}switch(e=e.trim(),n){case"colour":n="color";break;case"size":n="font-size";break;case"font":case"family":n="font-family";break;case"decoration":n="text-decoration";break;case"left":n="margin-left";break;case"right":n="margin-right";break;case"underline":n="text-decoration",o="underline";break;case"highlight":n="background",o="yellow";break;case"bold":n="font-weight",o="bold";break;case"italic":n="font-style",o="italic"}css_color_names[n]||"#"==n.charAt(0)?(o=n,n="color"):""==n&&(n="class"),i?this.styleExtensions[i][n]=o:this.applyAttribute(t,n,o)}return t},EdenUI.Highlight.prototype.COMMENT_ATTRS=function(){for(var e=this.stream.peekLine(),t=0,i=-1,n=0;n<e.length;n++)if("{"==e.charAt(n))t++;else if("}"==e.charAt(n)&&--t<0){i=n;break}if(-1==i)this.classes.push("hidden-comment"),this.popMode();else{var s=e.substring(0,i),o=this.tokentext+s;if(this.tokentext+=s+"}",this.stream.position+=i+1,this.classes.push("hidden-comment"),"?"==o.charAt(0)){null==this.metrics[this.line]&&(this.metrics[this.line]={}),this.metrics[this.line].squery=!0;let t=this.lineelement.lastChild;t=t||this.lineelement;s=()=>{this.parseQuery(o,e=>{e&&(e=e.join(" "),this.parseAttrs(e,t))})};s(),this.metrics[this.line].styleUpdate=s}else this.parseAttrs(o);this.popMode()}},EdenUI.Highlight.prototype.parseQuery=function(e,t){for(var i=e.substring(2),n=0,s=-1,o=0;o<i.length;o++)if("("==i.charAt(o))n++;else if(")"==i.charAt(o)&&--n<0){s=o;break}-1==s||(e=i.substring(0,s),Eden.Selectors.query(e,"value",{minimum:0},t))},EdenUI.Highlight.prototype.COMMENT_QUERY=function(){if("["==this.token){for(var e=this.stream.peekLine(),t=-1,i=0;i<e.length;i++)if("]"==e.charAt(i)){t=i;break}-1==t?this.classes.push("hidden-comment"):(this.classes.push("hidden-comment"),this.cacheddata=e.substring(0,t),console.log("Q RES TYPE",this.cacheddata),this.stream.position+=t+1,this.tokentext+=this.cacheddata+"]")}else if("("==this.token){for(var n,s,e=this.stream.peekLine(),o=0,t=-1,i=0;i<e.length;i++)if("("==e.charAt(i))o++;else if(")"==e.charAt(i)&&--o<0){t=i;break}-1==t?(this.popMode(),this.classes.push("hidden-comment")):(n=e.substring(0,t),this.tokentext+=n+")",this.stream.position+=n.length+1,this.popMode(),this.classes.push("hidden-comment"),s=document.createElement("span"),this.applyClasses(s,["comment-query"]),this.lineelement.appendChild(s),Eden.Selectors.query(n,this.cacheddata||"value",{minimum:1},e=>{e=1==e.length?e[0]:1<e.length?e.join(", "):"",s.setAttribute("data-result",e)}),this.cacheddata&&s.setAttribute("data-attribs",this.cacheddata),s.setAttribute("data-query",n),this.metrics[this.line].qelements.push(s))}else this.popMode(),this.classes.push("hidden-comment")},EdenUI.Highlight.prototype.COMMENT_LINK=function(){var e,t,i;"]"!=this.token?this.COMMENT():(this.classes.push("hidden-comment"),40==this.stream.peek()?(t=(e=this.lineelement).parentNode,(i=document.createElement("a")).setAttribute("target","_blank"),i.contentEditable=!1,t&&(t.removeChild(e),i.appendChild(e),t.appendChild(i),this.lineelement=i),this.mode="COMMENT_LINK_END"):(this.popMode(),this.popLine()))},EdenUI.Highlight.prototype.COMMENT_LINK_END=function(){console.log("LINKEND",this.token);var e,t=this.stream.peekLine();"("==this.token&&(-1==(e=t.indexOf(")"))?(this.classes.push("hidden-comment"),this.popMode()):(t=t.substring(0,e),this.tokentext+=t+")",this.stream.position+=e+1,this.classes.push("hidden-comment"),this.popMode(),t.startsWith("http://")||t.startsWith("https://")?this.lineelement.setAttribute("href",t):this.lineelement.setAttribute("href","javascript: Eden.Selectors.goto('"+t+"');")),this.popLine())},EdenUI.Highlight.prototype.COMMENT_IMAGE=function(){var e=this.stream.peekLine(),t=e.indexOf("]");-1==t?(this.classes.push("comment"),this.mode="COMMENT"):(e=e.substring(0,t),this.classes.push("comment"),this.mode="COMMENT_IMAGE_END",this.pushLine(),(t=document.createElement("img")).title=e,t.style.verticalAlign="top",this.lineelement.appendChild(t),this.lineelement=t)},EdenUI.Highlight.prototype.COMMENT_BUTTON=function(){this.pushLine();var e=document.createElement("button");this.lineelement.appendChild(e),(this.lineelement=e).contentEditable=!1,this.mode="COMMENT_BUTTON_CONTENT"},EdenUI.Highlight.prototype.COMMENT_BUTTON_CONTENT=function(){"]"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_IMAGE_END=function(){var e=this.stream.peekLine(),t=e.indexOf(")");-1==t?(this.classes.push("hidden-comment"),this.mode="COMMENT"):(e=e.substring(0,t),this.tokentext+=e+")",this.stream.position+=t+1,this.classes.push("hidden-comment"),this.mode="COMMENT",this.lineelement.setAttribute("src",e.substring(1))),this.popLine()},EdenUI.Highlight.prototype.COMMENT_ESCAPE=function(){this.popMode(),this.classes.push("comment")},EdenUI.Highlight.prototype.validHTMLTags={button:!0,span:!0,a:!0,img:!0,input:!0,table:!0,textarea:!0},EdenUI.Highlight.prototype.COMMENT_HTML=function(){var e=this.tokentext;if(!EdenUI.Highlight.prototype.validHTMLTags[e])return this.mode="COMMENT",void this.COMMENT();for(var t,i=this.stream.peekLine(),n=-1,s=!1,o=0,a=0;a<i.length;a++)if(i.charCodeAt(a)==o)s=!s,o=0;else if(0!=o||34!=i.charCodeAt(a)&&39!=i.charCodeAt(a)){if(s&&"\\"==i.charAt(a))a++;else if(!s&&">"==i.charAt(a)){n=a;break}}else s=!s,o=i.charCodeAt(a);0<=n?(t="<"+e+i.substring(0,n+1),this.tokentext=t.substring(1),this.cacheddata={opentag:t,tagname:e},this.classes.push("hidden-comment"),this.mode="COMMENT_HTML_START",this.stream.position+=n+1):(this.classes.push("hidden-comment"),this.tokentext+=i.substring(0,i.length-1),this.stream.position+=i.length-1,this.mode="COMMENT")},EdenUI.Highlight.prototype.COMMENT_HTML_CONTENT=function(){var e,t;"</"!=this.token?this.COMMENT():(this.cacheddata&&(t=this.stream.peekLine(),e=this.cacheddata.tagname+">",-1==(t=t.indexOf(e))||(this.cacheddata&&this.popLine(),this.tokentext+=e,this.stream.position+=t+e.length),this.classes.push("hidden-comment")),this.mode="COMMENT")},EdenUI.Highlight.prototype.COMMENT_HTML_START=function(){var e,t;"<"!=this.token?(t=this.cacheddata.opentag+e,this.mode="COMMENT_HTML_CONTENT",this.pushLine(),t=$(t).get(0),"button"!=this.cacheddata.tagname&&"a"!=this.cacheddata.tagname||(t.contentEditable=!1),this.lineelement.appendChild(t),this.lineelement=t,this.COMMENT()):(t=this.stream.peekLine(),e="/"+this.cacheddata.tagname+">",-1==(t=t.indexOf(e))||(this.cacheddata&&this.popLine(),this.tokentext+=e,this.stream.position+=t+e.length),this.classes.push("hidden-comment"),this.mode="COMMENT")},EdenUI.Highlight.prototype.COMMENT_CODE=function(){"`"==this.token?(this.classes.push("hidden-comment"),this.popMode()):(this.classes.push("script"),this.START())},EdenUI.Highlight.prototype.COMMENT_ICON=function(){if("OBSERVABLE"==this.token){if("-"==this.stream.code.charAt(this.stream.position)){var e=this.stream.peekLine(),t=e.indexOf(":");if(-1==t)return this.classes.push("comment"),void this.popMode();t=e.substring(0,t);this.tokentext+=t,this.stream.position+=t.length}t=document.createElement("span");t.className="eden-comment-icon fa fa-"+this.tokentext,this.lineelement.appendChild(t),this.classes.push("hidden-comment")}else":"==this.token&&(this.classes.push("hidden-comment"),this.popMode())},EdenUI.Highlight.prototype.COMMENT_EMPH=function(){var e;"*"==this.token?(this.mode="COMMENT_BOLD",this.classes.push("hidden-comment")):(e=document.createElement("span"),this.applyClasses(e,["comment-emph"]),this.lineelement.appendChild(e),this.pushLine(),this.lineelement=e,this.mode="COMMENT_ITALIC",this.COMMENT())},EdenUI.Highlight.prototype.COMMENT_ITALIC=function(){"*"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_BOLD=function(){var e;"*"==this.token?(this.classes.push("hidden-comment"),this.popLine(),this.mode="COMMENT_BOLD_END"):(e=document.createElement("span"),this.applyClasses(e,["comment-bold"]),this.lineelement.appendChild(e),this.pushLine(),this.lineelement=e,this.mode="COMMENT_BOLD_END",this.COMMENT())},EdenUI.Highlight.prototype.COMMENT_BOLD_END=function(){"*"==this.token?("*"==this.stream.code.charAt(this.stream.position)&&(this.classes.push("hidden-comment"),this.stream.position++,this.tokentext+="*"),this.popLine(),this.popMode()):this.COMMENT()},EdenUI.Highlight.prototype.COMMENT_TAG=function(){this.mode="END_COMMENT_TAG"},EdenUI.Highlight.prototype.END_COMMENT_TAG=function(){this.popLine(),this.mode="COMMENT",this.COMMENT()},EdenUI.Highlight.prototype.DOXY_COMMENT=function(){this.BLOCK_COMMENT()},EdenUI.Highlight.prototype.HTML=function(){"OBSERVABLE"==this.token&&(this.classes.push("htmltag"),this.mode="HTML_ATTRIBUTES")},EdenUI.Highlight.prototype.HTML_CLOSE=function(){"OBSERVABLE"==this.token?(this.classes.push("htmltag"),this.mode="HTML_CLOSE"):">"==this.token&&(this.classes.push("htmltag"),this.popMode())},EdenUI.Highlight.prototype.HTML_ATTRIBUTES=function(){">"==this.token?(this.classes.push("htmltag"),this.mode="START"):(this.classes.push("htmlattribute"),this.mode="HTML_ATTRIBVALUE")},EdenUI.Highlight.prototype.HTML_ATTRIBVALUE=function(){"="==this.token?this.classes.push("operator"):"{"==this.token?(this.pushMode(),this.mode="START"):">"==this.token?(this.classes.push("htmltag"),this.mode="START"):"STRING"==this.token?(this.classes.push("string"),this.mode="HTML_ATTRIBUTES"):this.classes.push("htmlattribute")},EdenUI.ContextMenu=function(e){this.element=$('<div class="eden-contextmenu"></div>'),this.origin=e,this.target=void 0,this.items=[],$(document.body).append(this.element);var s=this;this.element.on("mousedown",".eden-contextmenu-item",function(e){e=parseInt(e.currentTarget.getAttribute("data-index"));s.items[e].action&&s.items[e].action(s.target)}),this.origin.oncontextmenu=function(e){s.target=e.target,"SPAN"==s.target.nodeName&&(s.target=s.target.parentNode);var t=document.body.scrollLeft+e.clientX;t+150>=screen.width&&(t-=t+150-screen.width),s.element.css("top",document.body.scrollTop+e.clientY+10+"px"),s.element.css("left",t+"px");for(var i=0;i<s.items.length;i++){var n="function"==typeof s.items[i].status?s.items[i].status(s.target):s.items[i].status;changeClass(s.items[i].element,"disabled",!n)}s.element.slideDown(100),e.preventDefault()},document.addEventListener("mousedown",function(){s.element.hide()},!0)},EdenUI.ContextMenu.prototype.addItem=function(e,t,i,n){t=$('<div class="eden-contextmenu-item"><span class="eden-contextmenu-icon">'+e+"</span><span>"+t+"</span></div>");t.get(0).setAttribute("data-index",""+this.items.length),this.element.append(t),this.items.push({status:i,action:n,element:t.get(0)})},EdenUI.ContextMenu.prototype.addSeparator=function(){var e=$('<div class="eden-contextmenu-sep"></div>');this.element.append(e)},EdenUI.ButtonBar=function(e){this.container=e,this.bar=$('<div class="control-bar noselect"><div class="buttonsDiv"></div></div>'),this.buttons={},this.container.appendChild(this.bar.get(0))},EdenUI.ButtonBar.prototype.addButton=function(e,t,i,n){t=$('<button class="control-button control-enabled '+e+'" title="'+i+'">'+t+"</button>");this.bar.find(".buttonsDiv").append(t),t.get(0).onclick=n,this.buttons[e]=t},EdenUI.ButtonBar.prototype.enableButton=function(e){this.buttons[e]&&this.buttons[e].addClass("control-enabled")},EdenUI.ButtonBar.prototype.disableButton=function(e){this.buttons[e]&&this.buttons[e].removeClass("control-enabled")},EdenUI.Tabs=function(e){this.tabs=e,this.scrollix=0,this.maxtabs=3},EdenUI.Tabs.prototype.build=function(e,t){for(;this.tabs.firstChild;)this.tabs.removeChild(this.tabs.firstChild);var i=document.createElement("div");i.className="agent-tableft noselect",this.tabs.appendChild(i);var n=document.createElement("div");if(n.className="agent-tab-container",this.tabs.appendChild(n),e&&e instanceof Array){var s=-1;(s=t?e.indexOf(t):s)>this.scrollix+(this.maxtabs-1)&&(this.scrollix=s-(this.maxtabs-1)),s<this.scrollix&&(this.scrollix=s);for(var o=0;o<e.length;o++){var a=e[o];Eden.Agent.agents[e[o]]&&(a=Eden.Agent.agents[e[o]].title),this.scrollix<=o&&this.add(n,e[o],a,t&&e[o]==t,o)}}s=document.createElement("div");s.className="agent-newtab noselect",s.style.left=160*e.length+20+"px",n.appendChild(s);s=document.createElement("div");s.className="agent-tabright noselect",this.tabs.appendChild(s)},EdenUI.Tabs.prototype.add=function(e,t,i,n,s){var o=document.createElement("div");o.style.left=160*s+"px";var a="agent-tab noselect";a+=n?" agent-tab-current":" agent-tab-notcurrent";s=t.split("/").pop();18<s.length&&(s="..."+s.slice(-15)),n=Eden.Agent.agents[t]?Eden.Agent.agents[t].hasErrors()?"tab-icon errored":Eden.Agent.agents[t].executed?"tab-icon executed":"tab-icon":"tab-icon noagent",o.className=a,o.innerHTML="<span class='"+n+"'>&#xf007;</span>"+s,o.draggable=!0,o.setAttribute("data-name",t),e.appendChild(o)},EdenUI.MenuBar=function(){var o=this;this.itemViews={};var i=mobilecheck(),e=$('<div id="menubar-obscurer" class="login-subdialog modal" style="display: block;"></div>');e.html(`<div class="modal-content" style="width: 350px; height: 400px;"><div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf090;</span>${Language.ui.menu_bar.signin}</div><iframe frameborder="0" name="logintarget" width="340px" height="300px" class="menubar-login-iframe"></iframe><button class="jseden button-cancel">${Language.ui.menu_bar.cancel}</button></div>`),e.hide(),Eden.AST&&eden.execute2("views_number_created = 0;",EdenSymbol.defaultAgent),this.element=i?$('<div id="menubar-main" class="no-print">\t\t\t<div class="menubar-buttons">\t\t\t\t<div class="menubar-button enabled main share" data-obs="sharebox" title="Save or share" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div>\t\t\t\t<div class="menubar-button enabled main notifications" data-obs="notifications" title="Notifications">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div>\t\t\t\t<div class="menubar-button enabled main more" data-obs="more" title="More Options">&#xf0c9;</div></div>\t\t\t<div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="Search..." spellcheck="false"></input>\t\t\t\t<div id="menubar-searchresults"></div>\t\t\t</div></div>'):$(`<div id="menubar-main" class="no-print">
			<a id="eden-logo" title="${Language.ui.tooltips.home_logo}" href="${window.location.pathname}" target="_blank" style="display: block"></a>
			<div class="jseden-title" title="${Language.ui.tooltips.rename}"></div>
			<div id="menubar-login"><span class="icon">&#xf05e;</span>${Language.ui.menu_bar.notconnected}</div>
			<div class="menubar-buttons">
				<div class="menubar-button enabled main share" data-obs="sharebox" title="${Language.ui.tooltips.save}" style="display: none;">&#xf1e0;<div id="menubar-mainitem-sharebox" class="menubar-menu"></div></div>
				<div class="menubar-button enabled main create" data-obs="views" title="${Language.ui.tooltips.create}" style="display: none;">&#xf067;<div id="menubar-mainitem-views" class="menubar-menu"></div></div>
				<div class="menubar-button enabled main existing" data-obs="existing" title="${Language.ui.tooltips.existing}" style="display: none;">&#xf2d2;<div id="menubar-mainitem-existing" class="menubar-menu"></div></div>
				<div class="menubar-button enabled main settings" data-obs="options" title="${Language.ui.tooltips.options}" style="display: none;">&#xf013;<div id="menubar-mainitem-options" class="menubar-menu"></div></div>
				<div class="menubar-button enabled main help" data-obs="help" title="${Language.ui.tooltips.help}">&#xf128;<div id="menubar-mainitem-help" class="menubar-menu">
					<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="?load=54">Getting Started...</a></div>					
					<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="resources/doc/cheat.pdf">Cheat Sheet (PDF)</a></div>
					<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://www.youtube.com/channel/UCQUAv0AU1FF2EN0qwOOZCag">Tutorial Videos (YouTube)</a></div>
					<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://github.com/EMGroup/js-eden/wiki/Eden-Functions">Library Reference</a></div>
					<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="https://github.com/EMGroup/js-eden/wiki/FAQ">FAQ</a></div>
					<div class="menubar-item-fullwidth menubar-item-clickable"><a target="_blank" style="color: inherit; text-decoration: none;" href="http://construit.org">About Construit</a></div>
				</div></div>
				<div class="menubar-button enabled main notifications" data-obs="notifications" title="${Language.ui.tooltips.notifications}">&#xf0f3;<span class="menubar-notification-jewel"></span><div id="menubar-mainitem-notifications" class="menubar-menu"></div></div>
				<div class="menubar-button enabled main maker" data-obs="maker" title="${Language.ui.tooltips.maker}" style="display: none;">&#xf0ad;</div></div>
			<div class="searchouter menusearch" style="display: none;"><input type="text" class="search menusearch" placeholder="${Language.ui.menu_bar.search}" spellcheck="false"></input>
				<div id="menubar-searchresults"></div>
			</div></div>`),$(document.body).append(this.element);var t=this.element.find("#menubar-login");i||new EdenUI.ContextMenu(t.get(0)).addItem("&#xf08b;","Log out",function(){return Eden.DB.isLoggedIn()},function(){Eden.DB.logOut(function(){$("#menubar-login").html('<span class="icon">&#xf090;</span>Sign-in')})}),this.timeout=null,edenUI.listenTo("loadPlugin",this,function(e,t){i||this.timeout||(this.timeout=setTimeout(()=>{this.updateStaticViewsMenu(),this.timeout=null},200))}),edenUI.listenTo("createView",this,function(e,t){i||this.timeout||(this.timeout=setTimeout(()=>{this.updateViewsMenu(),this.timeout=null},200))}),edenUI.listenTo("destroyView",this,function(e){i||($(this.itemViews[e]).remove(),delete this.itemViews[e],d())}),Eden.DB.listenTo("connected",this,function(e){i||$("#menubar-login").html(`<span class="icon">&#xf090;</span>${Language.ui.menu_bar.signin}`)}),Eden.DB.listenTo("disconnected",this,function(){i||$("#menubar-login").html(`<span class="icon">&#xf05e;</span>${Language.ui.menu_bar.notconnected}`)}),Eden.DB.listenTo("login",this,function(e){i||e&&(Eden.DB.log("login"),setTimeout(function(){$("#menubar-obscurer").remove()},1e3),$("#menubar-login").html('<a href="'+Eden.DB.remoteURL+'/#" target="_blank"><span class="icon">&#xf2be;</span>'+e+"</a>"))});o=this;i||$("#menubar-login").click(function(){o.showLogin()}),this.showLogin=function(){Eden.DB.isConnected()&&!Eden.DB.isLoggedIn()?(e.show(),$(document.body).append(e),e.find("iframe").attr("src",Eden.DB.remoteURL+"/login"),e.on("click",".button-cancel",function(){e.remove()})):Eden.DB.isConnected()&&Eden.DB.isLoggedIn()},Eden.AST&&(this.sharebox=new EdenUI.Sharebox(this.element.find("#menubar-mainitem-sharebox")),this.element.on("click",".menubar-button.share",function(e){e.currentTarget===e.target&&o.sharebox.update()}),this.searchbox=new EdenUI.SearchBox(this.element.find("#menubar-searchresults")),this.element.on("keyup",".search",function(e){o.searchbox.updateSearch(e.currentTarget.value)}),this.element.on("focus",".search",function(e){o.searchbox.updateSearch(e.currentTarget.value)}));var n=!1,s=void 0;function a(){$(".menubar-menu").hide(),n=!1,$("#menubar-mainitem-views").children().css("display","")}function r(e){$("#menubar-mainitem-"+e).show(),n=!0,"sharebox"==(s=e)&&o.sharebox.show()}function d(){var e=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(edenUI.activeDialogs).length&&e.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function b(e){a();var t=edenUI.eden.root,i=t.lookup("mouseFollow").value(),n=t.lookup("views_number_created"),s=n.value()+1;n.assign(s,t.scope,EdenSymbol.hciAgent,!0);t=this.view,s=t.toLowerCase()+s;i?edenUI.eden.execute('createView("'+s+'", "'+t+'");'):edenUI.createView(s,t),o.updateViewsMenu()}function l(e){var t=this.parentNode.title;edenUI.viewInstances[t].confirmClose&&a(),edenUI.destroyView(t),d()}function v(e){var t=document.createElement("DIV");t.className="menubar-item";for(var i=0;i<e.length;++i)t.appendChild(e[i][0]);return $(t)}function f(e,t,i){let n=document.createElement("DIV");n.className=e+" menubar-item-clickable";let s=document.createElement("SPAN");return s.innerText=t,s.className=i,n.appendChild(s),$(n)}$(document.body).on("mousedown",function(){a(),o.searchbox&&o.searchbox.element.hide()}),this.element.on("mousedown",".menubar-search-outer",function(e){e.stopPropagation()}),this.element.on("mousedown",".menubar-button.main",function(e){var t=e.currentTarget.getAttribute("data-obs");n&&e.target===this?t==s?a():(a(),r(t)):r(t),o.searchbox&&o.searchbox.element.hide(),e.stopPropagation()}),this.element.on("mouseenter",".menubar-button.main",function(e){}),this.ready=!1,Eden.Project.listenTo("load",this,e=>{this.ready=!0,this.updateViewsMenu(),this.updateStaticViewsMenu()}),this.updateViewsMenu=function(){if(this.ready){var e=$("#menubar-mainitem-existing");for(viewName in e.html(""),o.itemViews={},d(),edenUI.activeDialogs){var t=function(t){return{mouseover:function(e){edenUI.highlightView(t,!0)},mouseout:function(e){edenUI.stopHighlightingView(t,!0,!1)},click:function(e){edenUI.stopHighlightingView(t,!0,!0),a()}}}(viewName),i=edenUI.eden.root.lookup("view_"+viewName+"_title").value();label=f("menubar-item-label",i,"menubar-view-name"),label.click(t.click),close=f("menubar-item-close","X","menubar-item-close-icon"),close.click(l),viewEntry=v([label,close]),viewEntry.bind("mouseover",t.mouseover),viewEntry.bind("mouseout",t.mouseout),viewEntry[0].title=viewName,viewEntry.appendTo(e),o.itemViews[viewName]=viewEntry[0]}}},this.updateStaticViewsMenu=function(){var e=$("#menubar-mainitem-views");e.html("");var t=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),i=t[0],n=$('<div class="menubar-item-fullwidth"></div>');n.append(t);var s=$("<div class='menubar-item-search'></div>");s.append(n),i.search=function(){var s,o=i.value,a=new RegExp("(^|\\s)"+o,"i"),r=!1;e.children().each(function(e,t){var i,n;t.classList.contains("menubar-item-search")||(n=(i=t.children[0]).innerHTML,i.classList.contains("menubar-item-separator")?(1<o.length&&(r=a.test(n)),(s=t).style.display=r?"":"none"):r?t.style.display="":a.test(n)?(t.style.display="",s.style.display=""):t.style.display="none")})},t.on("input",i.search);var o,a,r=[];for(o in edenUI.views){var d=edenUI.views[o],l=d.title,c=d.category.getLabel(),h=d.category.getMenuPriority(),p=d.menuPriority;(d=v([f("menubar-item-fullwidth menubar-view",l)]))[0].view=o,d.click(b),r.push({title:l,viewEntry:d,categoryLabel:c,categoryPriority:h,itemPriority:p})}for(var r=r.sort(function(e,t){if(e.categoryPriority!=t.categoryPriority)return e.categoryPriority-t.categoryPriority;if(void 0!==e.itemPriority){if(void 0===t.itemPriority)return-1;if(e.itemPriority!=t.itemPriority)return e.itemPriority-t.itemPriority}else if(void 0!==t.itemPriority)return 1;return e.title>t.title?1:e.title<t.title?-1:0}),u=0;u<r.length;++u){var m=r[u],g=m.categoryLabel;a!=g&&($("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+g+"</div></div>").appendTo(e),a=g),m.viewEntry.appendTo(e)}e.append(s)},this.updateStaticViewsMenu(),this.updateViewsMenu();var c=$("#menubar-mainitem-options");function h(i,e,t,n){var s=edenUI.getOptionValue(i),s=f("menubar-item-input",'<input id="menu-'+i+'" type="checkbox"'+((s=s=null===s?t:s)&&"false"!=s?'checked="checked"':"")+" />"),o=s.get(0).children[0],e=v([s,f("menubar-item-label",e)]);e.click(function(e){e.target!=o&&(o.checked=!o.checked),edenUI.setOptionValue(i,o.checked)}),edenUI.listenTo("optionChange",void 0,function(e,t){e==i&&(t="true"===t,o.checked=t,n&&n(i,t))}),e.appendTo(c)}h("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(e,t){t?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),h("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),h("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),h("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(e,t){var i=t?"collapse":"maximize";$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",i)})}),h("developer",Language.ui.menu_bar.opt_debug,!1,function(e,t){var i=t?"/index-dev.html":"/index.html",n=document.location.pathname;(i=n.slice(0,n.lastIndexOf("/"))+i)!=document.location.pathname?(a(),edenUI.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(e){0==e?(window.onbeforeunload=void 0,document.location.pathname=i):1==e?root.lookup("debug").mutate(root.scope,function(e){e.cache.value.jsExceptions=t},EdenSymbol.hciAgent):((e=document.getElementById("menu-developer")).checked=!e.checked,edenUI.setOptionValue("developer",e.checked))})):root.lookup("debug").mutate(root.scope,function(e){e.cache.value.jsExceptions=t},EdenSymbol.hciAgent)}),this.element.on("keyup",".jseden-title",function(e){try{window.localStorage&&window.localStorage.setItem("title",e.currentTarget.textContent)}catch(e){}}),eden.root.lookup("jseden_project_title").addJSObserver("menubar",function(e,t){if(!i){e.origin&&e.origin!==EdenSymbol.hciAgent&&((e=$(".jseden-title").get(0)).contentEditable=!0,e.textContent=t,document.title=t);try{window.localStorage&&window.localStorage.setItem("title",t)}catch(e){}}}),eden.root.lookup("jseden_maker").addJSObserver("menubar",function(e,t){t?o.element.find(".maker").addClass("active"):o.element.find(".maker").removeClass("active")}),eden.root.lookup("jseden_menu_showsearch").addJSObserver("menubar",function(e,t){t?(o.element.find(".menusearch").show(),i&&o.element.find("#eden-logo").hide()):(o.element.find(".menusearch").hide(),i&&o.element.find("#eden-logo").show())}),eden.root.lookup("jseden_explorer_enabled").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.maker").show():o.element.find(".menubar-button.maker").hide()}),eden.root.lookup("jseden_menu_visible").addJSObserver("menubar",function(e,t){t?(o.element.show(),$("#jseden-main").removeClass("nomenu")):(o.element.hide(),$("#jseden-main").addClass("nomenu"))}),eden.root.lookup("jseden_menu_showshare").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.share").show():o.element.find(".menubar-button.share").hide()}),eden.root.lookup("jseden_menu_showcreate").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.create").show():o.element.find(".menubar-button.create").hide()}),eden.root.lookup("jseden_menu_showexisting").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.existing").show():o.element.find(".menubar-button.existing").hide()}),eden.root.lookup("jseden_menu_showsettings").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.settings").show():o.element.find(".menubar-button.settings").hide()}),eden.root.lookup("jseden_menu_showhelp").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.help").show():o.element.find(".menubar-button.help").hide()}),eden.root.lookup("jseden_menu_shownotifications").addJSObserver("menubar",function(e,t){t?o.element.find(".menubar-button.notifications").show():o.element.find(".menubar-button.notifications").hide()}),eden.root.lookup("jseden_project_subtitle").addJSObserver("menubar",function(e,t){}),this.notifications=new EdenUI.Notifications(this.element.find("#menubar-mainitem-notifications"),this.element.find(".menubar-notification-jewel")),this.element.on("click",".notifications",function(e){o.notifications.clearCount()}),this.element.on("click",".maker",function(e){var t,i=eden.root.lookup("jseden_maker");i.eden_definition||(void 0===(t=i.value())&&(t=!1),i.assign(!t,eden.root.scope,EdenSymbol.localJSAgent))}),this.element.on("keyup",".jseden-title",function(e){var t=eden.root.lookup("jseden_project_title");t.definition||t.assign(e.currentTarget.textContent,eden.root.scope,EdenSymbol.hciAgent)})},EdenUI.MenuBar.prototype.hide=function(){this.element.hide()},EdenUI.MenuBar.prototype.show=function(){this.element.show()},EdenUI.MenuBar.reset=function(){$(".jseden-title").html("CONSTRUIT")},EdenUI.MenuBar.saveTitle=function(e){eden.root.lookup("jseden_project_title").assign(e,eden.root.scope,EdenSymbol.jsAgent)},EdenUI.Dialogs={},EdenUI.Dialogs.MergeError=function(e,t,i){var n=new diff_match_patch,t=n.diff_main(e,t);n.diff_cleanupSemantic(t);t=n.diff_prettyHtml(t);$('<div title="Import Merge Conflict">'+t+"</div>").dialog({resizable:!0,height:"auto",width:600,modal:!0,buttons:{"Use Mine":function(){i&&i("old"),$(this).dialog("close")},"Use New":function(){i&&i("new"),$(this).dialog("close")},Merge:function(){i&&i("merge"),$(this).dialog("close")}}})},EdenUI.Notifications=function(e,t){var o=this;function i(t,i){var e,n,s;i&&(e=("runtime"==i.type?"Runtime error":"Syntax error")+" in "+t.name+":"+(i.line&&-1!=i.line?i.line:"")+" -> "+i.messageText(),n="<a href=\"javascript:Eden.Selectors.goto('.id("+t.id+")');\">"+t.name+":"+(i.line&&-1!=i.line?i.line+1:"")+"</a> "+i.messageText(),t.owned&&"syntax"==i.type||(console.error(e),(s=$('<pre class="error-item">'+n+"</pre>\n\n")).on("click",function(){var e="";!i.statement||"definition"!=i.statement.type&&"assignment"!=i.statement.type||(e+="    <b>Symbol:</b> "+i.statement.lvalue.name+"\n"),i.lastsymbol&&(e+="    <b>Related Symbol:</b> "+i.lastsymbol+"\n"),0<=String(i.extra).search("SyntaxError")?(e+="    <b>JavaScript:</b> "+i.javascriptSource()+"\n",s.html(n+"\n"+e)):(e+="    <b>Source:</b> <div class='error-source'</div>\n",s.html(n+"\n"+e),i.statement&&(e=new Eden.AST(i.edenSource(),void 0,t),new EdenUI.Highlight(s.find(".error-source").get(0)).highlight(e,-1,-1)))}),o.notification("error",s)))}this.notificationCount=0,this.notificationCountElement=t,this.notificationCountElement.hide(),this.notificationPanel=e,this.notificationPanel.html('<button class="control-button close-button control-enabled">&#xf00d;</button><button class="control-button clear-button control-enabled">&#xf05e;</button><div id="errors-dialog"></div>'),this.notificationPanel.on("click",".close-button",function(){o.notificationPanel.hide()}).on("click",".clear-button",function(){o.notificationPanel.find("#errors-dialog").html("")}),this.notificationPanel.hide(),this.notificationContent=this.notificationPanel.find("#errors-dialog"),Eden.Peer.listenTo("user",void 0,function(e,t){o.notification("net",$('<div class="notification-content">User \'<a href="javascript:eden.peer.showConnection(\''+e+"');\">"+t+"</a>' connected to you.<br/><a href=\"javascript: eden.peer.requestShare('"+e+"');\">Watch</a> <a href=\"javascript: eden.peer.requestObserve('"+e+"');\">Broadcast</a> <a href=\"javascript: eden.peer.requestCollaborate('"+e+"');\">Collaborate</a></div>"))}),Eden.Peer.listenTo("share",void 0,function(e,t){o.notification("net",$('<div class="notification-content">Your model is being shared...</div>'))}),Eden.Peer.listenTo("disconnect",void 0,function(e,t){t?o.notification("net",$('<div class="notification-content">User \''+t+"' disconnected.</div>")):o.notification("net",$('<div class="notification-content">P2P User disconnected.</div>'))}),Eden.Peer.listenTo("error",void 0,function(e){o.notification("error",$('<div class="notification-content">P2P: '+e+"</div>"))}),eden.listenTo("error",void 0,i),Eden.Fragment&&(Eden.Fragment.listenTo("error",void 0,i),Eden.Fragment.listenTo("warning",void 0,function(e,t){var i,n;t&&(t.type,e.name,-1!=t.line&&t.line,t.messageText(),i="<a href=\"javascript:edenUI.gotoCode('"+e.name+"',"+t.line+');">'+e.name+":"+(-1!=t.line?t.line+1:"")+"</a> "+t.messageText(),e.owned&&"syntax"==t.type||((n=$('<pre class="error-item">'+i+"</pre>\n\n")).on("click",function(){var e="";!t.statement||"definition"!=t.statement.type&&"assignment"!=t.statement.type||(e+="    <b>Symbol:</b> "+t.statement.lvalue.name+"\n"),t.lastsymbol&&(e+="    <b>Related Symbol:</b> "+t.lastsymbol+"\n"),0<=String(t.extra).search("SyntaxError")?(e+="    <b>JavaScript:</b> "+t.javascriptSource()+"\n",n.html(i+"\n"+e)):(e+="    <b>Source:</b> <div class='error-source'</div>\n",n.html(i+"\n"+e),t.statement&&(e=new Eden.AST(t.edenSource(),void 0,Symbol.jsAgent),new EdenUI.Highlight(n.find(".error-source").get(0)).highlight(e,-1,-1)))}),o.notification("warning",n)))})),Eden.DB.listenTo("disconnected",this,function(){o.notification("info",$('<div class="notification-content">Disconnected from project server</div>'))}),Eden.DB.listenTo("error",this,function(e){o.notification("error",$('<div class="notification-content">'+e+"</div>"))})},EdenUI.Notifications.prototype.notification=function(e,t){var i;if(this.notificationCount++,this.notificationCountElement.html(this.notificationCount),this.notificationCountElement.show(),"error"==e)(i=$('<div class="notification-item error"></div>')).append($('<div class="notification-icon"><span style="color: red;">&#xf06a;</span></div>'));else{var n,s="#777";switch(e){case"net":n="&#xf0c1;";break;case"comment":n="&#xf075;";break;case"log":n="&#xf120;";break;case"warning":n="&#xf071;",s="#f57900";break;case"info":default:n="&#xf129;",s="#29454B"}(i=$('<div class="notification-item"></div>')).append($('<div class="notification-icon"><span style="color: '+s+'">'+n+"</span></div>"))}"string"==typeof t?i.append($('<div class="notification-content">'+t+"</div>")):i.append(t),this.notificationContent.prepend(i),this.notificationContent.prop("scrollTop",0)},EdenUI.Notifications.prototype.clearCount=function(){this.notificationCountElement.hide(),this.notificationCount=0},EdenUI.Sharebox=function(e){var c=this;this.title=void 0,this.visible=!1,this.sharebox=e,this.sharebox.html('<div class="menubar-sharebox-title"><span class="menubar-shareicon">&#xf1e0;</span>Save and Share</div><div class="menubar-sharebox-content"><div id="projectoptions"></div><div id="projectuploadbox"></div></div>');e=this.sharebox.find("#projectoptions");this.markdown=new EdenUI.Markdown(""),e.get(0).appendChild(this.markdown.contents),this.sharebox.on("change","#thumbfile",function(e){var l=c.sharebox.find("#projectthumb"),t=$("#thumbfile");l.html("<img></img>");var i=t.get(0).files[0],t=new FileReader;t.onload=function(e){var a=document.createElement("canvas");a.setAttribute("width","200"),a.setAttribute("height","112");var r=a.getContext("2d"),d=new Image;d.onload=function(){var e,t,i=d.width,n=d.height,s=i/n,i=s<200/112?(t=(200-(e=i*((o=112)/n)))/2,0):200/112<s?(t=0,(112-(o=n*((e=200)/i)))/2):(o=112,e=200,t=0);r.drawImage(d,t,i,e,o);var o=a.toDataURL("image/png");c.thumbdata=o,l.get(0).childNodes[0].src=o},d.src=e.target.result},t.readAsDataURL(i)}),this.sharebox.on("click",".local",function(e){Eden.DB.localSave(eden.project),c.sharebox.hide()}),this.sharebox.on("click",".upload",function(e){var t=c.title.textContent,i=c.markdown.intextarea.value,n=$("#listpublic").get(0).checked;"New Project"!=t?(c.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.log("save",{pid:eden.project.id}),eden.project.thumb=c.thumbdata,eden.project.setDescription(i),eden.project.save(n,function(e){var t;e?(t=URLUtil.updateQueryString({load:eden.project.id,vid:eden.project.vid,r:eden.project.readPassword}),window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",t),c.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>'),(e=document.createRange()).selectNodeContents(c.sharebox.find(".projecturl").get(0)),(t=window.getSelection()).removeAllRanges(),t.addRange(e)):c.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")})):c.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.')}),this.sharebox.on("click",".fork",function(e){var t=c.title.textContent,i=c.markdown.intextarea.value,n=$("#listpublic").get(0).checked;"New Project"!=t?(c.sharebox.find("#projectuploadbox").html('Saved to your projects and shared at:<div class="projecturl">Saving...</div>'),Eden.DB.log("fork",{pid:eden.project.id}),eden.project.thumb=c.thumbdata,eden.project.id&&(eden.project.parentid=eden.project.id),eden.project.id=void 0,eden.project.vid=void 0,eden.project.setDescription(i),eden.project.save(n,function(e){var t;e?(t=URLUtil.updateQueryString({load:eden.project.id,vid:eden.project.vid,r:eden.project.readPassword}),window.history.replaceState({id:eden.project.id,vid:eden.project.vid},"",t),c.sharebox.find(".projecturl").html('<div class="sharebox-url">'+window.location.href+'</div><iframe src="https://www.facebook.com/plugins/share_button.php?href='+encodeURIComponent(window.location.href)+'&layout=button&size=small&mobile_iframe=true&appId=1447073055317881&width=59&height=20" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>'),(e=document.createRange()).selectNodeContents(c.sharebox.find(".projecturl").get(0)),(t=window.getSelection()).removeAllRanges(),t.addRange(e)):c.sharebox.find(".projecturl").html("<b>Save failed</b>, not logged in.")})):c.sharebox.find("#projectuploadbox").html('Please give your project a name by editing the "New Project" title in the top left.')})},EdenUI.Sharebox.prototype.show=function(){this.visible||this.update(),this.visible=!0},EdenUI.Sharebox.prototype.hide=function(){this.visible=!1},EdenUI.Sharebox.prototype.update=function(){var e=this;void 0===e.title&&(e.title=$(document).find(".jseden-title").get(0));var t=e.title?e.title.textContent:eden.root.lookup("jseden_project_title").value();Eden.DB.isLoggedIn()?(eden.project.authorid!=Eden.DB.userid&&-1!=eden.project.authorid?e.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox">List publically</input></div>Thumbnail: <input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'):e.sharebox.find("#projectuploadbox").html('<div id="projectthumb"></div><div style="margin-top: 40px; float: left"><input id="listpublic" type="checkbox">List publically</input></div><input id="thumbfile" type="file"></input><div class="sharebox-save-buttons"><button class="sharebox-button upload">Save</button><button class="sharebox-button fork">Fork</button><span class="downloadurl"></span></div>'),e.sharebox.find("#projectoptions").show()):(e.sharebox.find("#projectuploadbox").html('<div class="sharebox-save-buttons"><button class="sharebox-button local" title="Save in your browser for offline use">Local</button><span class="downloadurl"></span></div>'),e.sharebox.find("#projectoptions").hide());var i=this.sharebox.find("#projectthumb");this.thumbdata=void 0,this.thumbimg=$("<img></img>"),this.thumbimg.get(0).style.border="1px solid #aaa",this.thumbimg.get(0).style.marginRight="10px",i.append(this.thumbimg),eden.project.thumb?(e.thumbdata=eden.project.thumb,e.thumbimg.get(0).src=eden.project.thumb):e.thumbdata=void 0,void 0===eden.project.id&&(eden.project.tags=(eden.project.title.toLowerCase()+" "+(Eden.DB.isLoggedIn()?Eden.DB.username.toLowerCase():"")).split(" ")),e.markdown.setValue(eden.project.getDescription()),e.projectsource=eden.project.generate();i="data:application/octet-stream,"+encodeURIComponent(e.projectsource);e.sharebox.find(".downloadurl").html('<a class="sharebox-button download" href="'+i+'" download="'+t+'.js-e">File</a>')},EdenUI.SearchBox=function(e){var n=this;(this.element=e).on("click",".menubar-search-result",function(e){var t=e.currentTarget.getAttribute("data-id");t&&""!=t?n.updateSymbolDetails(e.currentTarget,t):script&&script}),e.on("click",".edit-result",function(e){}),e.on("click",".script-goto",function(e){e=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");n.element.hide(),Eden.Selectors.goto("@external "+e)}),e.on("click",".script-import",function(t){var i=t.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id");Eden.Selectors.query(i,void 0,{minimum:1,options:{external:!0,index:!0}},function(e){i&&""!=i&&(t.currentTarget.parentNode.parentNode.parentNode.setAttribute("data-imported","true"),n.updateSymbolDetails(t.currentTarget.parentNode.parentNode.parentNode,i))})})},EdenUI.SearchBox.prototype.updateSymbolDetails=function(d,e){console.log("Update details",e);d.getAttribute("data-imported");var l=d.getAttribute("data-remote");Eden.Selectors.query("@history "+e,"id,path,source,type,value,active,tags,rawcomment,historic",{minimum:1,options:{external:!0}},function(e){var t,i,n,s,o,a,r;0!=e.length?((e=e[0])[0],t=e[1],a=e[2],i=e[3],n=e[4],s=e[5],e[6],r=e[7],o=e[8],r=r&&new Eden.AST.DoxyComment(r),null!==(e=$(d).find(".doxy-search-details"))&&0!=e.length||(e=$('<div class="doxy-search-details"></div>'),d.appendChild(e.get(0))),e=e.get(0),"assignment"!=i&&"definition"!=i||(symstr=a,200<symstr.length&&(symstr=symstr.substring(0,200)+"..."),""==d.firstChild.className?EdenUI.Highlight.htmlElement(symstr,d.firstChild,{removejs:!0}):EdenUI.Highlight.htmlElement(symstr,d.childNodes[1],{removejs:!0})),a="",o?a="":"true"==l?(a+="<p>",a+='<button class="script-button script-goto">View</button></p>'):a='<p><button class="script-button script-goto">View</button>',!r||(r=r.pretty())&&0<r.length&&(a+=r),s?(a+="<p>",a+="<span style='color: #666;'><b>Path:</b> "+t+"</span><br>",a+="<b>Current Value:</b> "+EdenUI.Highlight.html(Eden.edenCodeForValue(n),!0,!1)):(a+="<p>",a+="<span style='color: #666;'><b>Path:</b> "+t+"</span>"),a+="</p>",e.innerHTML=a):console.log("No result")})},EdenUI.SearchBox.prototype.makeStatementResult=function(e){var t="",i="",n="";-1==e.executed&&(i=" historic");var s,o=e.getOrigin();55<(s="script"==e.type?(t=o&&o.remote?(n+=' data-remote="true"',e.indexed&&(n+=' data-imported="true"'),'<span class="search-scriptres">&#xf08e;</span>'):'<span class="search-scriptres">&#xf15c;</span>',e.doxyComment&&e.doxyComment.getProperty("title")?e.doxyComment.getProperty("title")[0]:e.name?"action "+e.name:e.getInnerSource()):"when"==e.type?(e.enabled&&(t='<span class="search-scriptres">&#xf00c;</span>'),e.prefix.trim()):(e.lvalue&&eden.root.symbols[e.lvalue.name]&&eden.root.symbols[e.lvalue.name].origin&&eden.root.symbols[e.lvalue.name].origin.id==e.id&&(t='<span class="search-scriptres">&#xf00c;</span>'),e.getSource()||console.error("NO SOURCE",e),e.getSource().split("\n")[0])).length&&(s=s.substr(0,55)+"..."),s="<div class='eden-wrapline'>"+EdenUI.Highlight.html(s)+"</div>";var a="";return!e.doxyComment||(o=e.doxyComment.brief())&&0<o.length&&(a='<div class="doxy-search-details"><p>'+o+"</p></div>"),$('<div class="menubar-search-result'+i+'" data-id="'+Eden.Selectors.getID(e)+'"'+n+">"+t+s+a+"</div>")},EdenUI.SearchBox.prototype.makeScriptResult=function(e){},EdenUI.SearchBox.prototype.updateSearch=function(e){var d;e&&""!=e?(this.element.show(),d=this,Eden.Selectors.query(e,void 0,{minimum:1,options:{external:!0}},function(n){d.element.html("");var e=$('<div class="menubar-search-outer"></div>'),s=$('<div class="menubar-search-results"></div>');e.append(s),d.element.append(e);for(var t,o=0,a=8,i=0,r=eden.root.lookup("jseden_search_projects").value(),o=0;o<n.length;o++)if(r||void 0!==n[o].parent||0!=n[o].executed){if(a<=i)break;i++,t=d.makeStatementResult(n[o]),s.append(t)}o<n.length&&!function i(){var e=$('<div class="menubar-search-more">&#xf078;</div>');s.append(e),e.on("click",function(){s.html("");for(var e,t=0;o<n.length&&!(a<t);o++)t++,e=n[o]instanceof Symbol?d.makeSymbolResult(n[o]):d.makeStatementResult(n[o]),s.append(e);o<n.length&&i()})}()})):this.element.hide()},EdenUI.ScriptBox=function(e,t){this.changeCB=void 0,this.outer=e,this.savecb=void 0,this.contents=$(this.outer),this.contents.html('<div class="scriptbox-inputhider"><textarea autofocus tabindex="1" class="hidden-textarea" style="height: 5px;"></textarea><div class="scriptbox-codearea"></div></div><div class="scriptbox-outputbox"><div class="scriptbox-statement"><div class="scriptbox-output" contenteditable="true" spellcheck="false"></div></div></div><div class="info-bar"></div></div>'),this.currentstatement=void 0,this.statements={},this.$codearea=this.contents.find(".scriptbox-codearea"),this.codearea=this.$codearea.get(0),this.intextarea=this.contents.find(".hidden-textarea").get(0),this.inputhider=this.contents.find(".scriptbox-inputhider").get(0),this.outdiv=this.contents.find(".scriptbox-output").get(0),this.$codearea.sortable({revert:100,handle:".grippy",distance:10,axis:"y",scroll:!1}),this.infobox=this.contents.find(".info-bar").get(0),this.outputbox=this.contents.find(".scriptbox-outputbox").get(0),this.suggestions=this.contents.find(".eden_suggestions"),this.suggestions.hide(),$(this.infobox).hide(),this.highlighter=new EdenUI.Highlight(this.outdiv),this.enable(),this.ast=void 0,this.refreshentire=!0,this.dirty=!0,this.rebuildtimer=void 0,this.rebuildtimeout=10,this.currentlineno=1,this.currentcharno=0,this.dragint=!1,this.dragline=-1,this.dragvalue=0,this.draglast=0,this.history=void 0,window.localStorage?this.history=JSON.parse(window.localStorage.getItem("console_history"))||[]:this.history=[],this.historyindex=this.history.length;var n=this;this.contents.on("input",".hidden-textarea",function(e){n.dirty=!0,n.rebuild()}).on("keydown",".hidden-textarea",function(e){if(n.ast&&n.ast.script&&!n.ast.hasErrors()&&13==e.keyCode&&"EOF"==n.ast.token&&n.intextarea.selectionStart>=n.ast.script.end)return n.history.push(n.ast.stream.code),n.historyindex=n.history.length,window.localStorage&&window.localStorage.setItem("console_history",JSON.stringify(n.history)),$(n.outdiv).find(".fake-caret").remove(),n.$codearea.append($('<div class="scriptbox-historic">'+n.outdiv.innerHTML+"</div>")),n.ast.execute(EdenUI.ScriptBox.consoleAgent,eden.root.scope,function(e){let t=e||n.ast.lastresult;void 0!==t&&(t instanceof Promise?t.then(e=>{console.log("Result",e),n.$codearea.append($('<div class="scriptbox-value">'+EdenUI.Highlight.html(Eden.edenCodeForValue(e))+"</div>"))}):(console.log("Result",t),n.$codearea.append($('<div class="scriptbox-value">'+EdenUI.Highlight.html(Eden.edenCodeForValue(t))+"</div>"))))}),n.inputhider.scrollTop=n.inputhider.scrollHeight,n.setSource(""),void e.preventDefault();if(e.altKey)187!=e.keyCode&&61!=e.keyCode&&189!=e.keyCode&&173!=e.keyCode&&48!=e.keyCode||e.preventDefault();else if(e.ctrlKey||17==e.keyCode||16==e.keyCode)e.ctrlKey&&(e.shiftKey?37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode&&36!=e.keyCode&&35!=e.keyCode||(n.setCaretToFakeCaret(),n.outdiv.focus()):38===e.keyCode?onPrevious():40===e.keyCode?onNext():86===e.keyCode||65===e.keyCode&&(e.preventDefault(),n.outdiv.focus()));else if(9==e.keyCode){e.preventDefault();var t=n.intextarea.selectionStart,i=n.intextarea.selectionEnd;n.intextarea.value=n.intextarea.value.substring(0,t)+"\t"+n.intextarea.value.substring(i),n.intextarea.selectionStart=n.intextarea.selectionEnd=t+1,n.rebuild()}else if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||36==e.keyCode||35==e.keyCode){if(e.shiftKey)return n.setCaretToFakeCaret(),void n.outdiv.focus();38==e.keyCode?0<n.historyindex&&(n.historyindex--,n.setSource(n.history[n.historyindex]),e.preventDefault()):40==e.keyCode&&(n.historyindex<n.history.length-1?(n.historyindex++,n.setSource(n.history[n.historyindex]),e.preventDefault()):(n.historyindex=n.history.length,n.setSource(""))),n.updateLineCachedHighlight()}else(13==e.keyCode||8==e.keyCode&&10==n.intextarea.value.charCodeAt(n.intextarea.selectionStart-1))&&(n.refreshentire=!0)}).on("keyup",".hidden-textarea",function(e){e.altKey||(e.ctrlKey||37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode&&36!=e.keyCode&&35!=e.keyCode?!e.ctrlKey&&8==e.keyCode&&""==n.intextarea.value||n.rebuild():(n.updateLineCachedHighlight(),36==e.keyCode||e.keyCode))}).on("paste",".hidden-textarea",function(e){n.refreshentire=!0}).on("keydown",".scriptbox-output",function(e){var t;e.altKey||("pointer"==n.outdiv.style.cursor&&(n.outdiv.style.cursor="initial"),16==e.keyCode||17==e.keyCode||e.ctrlKey&&67==e.keyCode||e.shiftKey&&(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||35==e.keyCode||36==e.keyCode)||(t=getCaretCharacterOffsetWithin(n.outdiv,n.shadow),e=getStartCaretCharacterOffsetWithin(n.outdiv,n.shadow),n.intextarea.focus(),n.intextarea.selectionEnd=t,(n.intextarea.selectionStart=e)!=t&&(n.refreshentire=!0)))}).on("keyup",".scriptbox-output",function(e){}).on("paste",".scriptbox-output",function(e){n.intextarea.focus(),setTimeout(function(){n.updateEntireHighlight()},0)}).on("blur",".hidden-textarea",function(e){$(n.outdiv).find(".fake-caret").remove(),n.hideInfoBox()}).on("focus",".hidden-textarea",function(e){}).on("mouseup",".scriptbox-output",function(e){var t,i;n.hideInfoBox(),document.activeElement===n.outdiv&&(t=getCaretCharacterOffsetWithin(n.outdiv,n.shadow),getStartCaretCharacterOffsetWithin(n.outdiv,n.shadow)!=t?n.refreshentire=!0:(i=n.currentlineno,n.intextarea.focus(),n.intextarea.selectionEnd=t,n.intextarea.selectionStart=t,n.ast&&(n.highlighter.highlight(n.ast,i,t),n.updateLineCachedHighlight())))}).on("click",".scriptbox-gutter",function(e){var t=parseInt(e.currentTarget.getAttribute("data-statement"));(t=Eden.Statement.statements[t]).statement&&0==t.statement.errors.length?(t.statement.execute(eden.root,t.ast,t.ast,eden.root.scope),"when"==t.statement.type&&(Eden.Statement.active[t.id]=!Eden.Statement.active[t.id],changeClass(e.currentTarget,"active",Eden.Statement.active[t.id]))):t.ast&&t.ast.script&&(t=t.ast.script.errors[0],n.showInfoBox(e.target.offsetLeft+20,e.target.offsetTop-n.codearea.scrollTop+25,"error",t.messageText())),n.updateLineCachedHighlight()}).on("click",".scriptbox-sticky",function(e){0<=e.currentTarget.className.indexOf("stuck")?changeClass(e.currentTarget,"stuck",!1):changeClass(e.currentTarget,"stuck",!0)}).on("click",".scriptbox-valueclose",function(e){var t=e.currentTarget.parentNode.parentNode,e=parseInt(t.getAttribute("data-statement"));t.removeChild(n.valuedivs[e][0]),delete n.valuedivs[e]}).on("mousedown",".scriptbox-statement",function(e){-1!=n.dragline||void 0!==n.outdiv&&e.currentTarget===n.outdiv.parentNode||(e=parseInt(e.currentTarget.getAttribute("data-statement")),n.moveTo(e))}),this.setSource(""),setInterval(function(){for(var e in n.valuedivs){var t,i=Eden.Statement.statements[e];i&&(t=EdenUI.htmlForStatement(i,30,30),i.isActive(),n.valuedivs[e].innerHTML='<div class="eden-line">'+t+"</div>")}},200)},EdenUI.ScriptBox.consoleAgent={local:!1,name:"*Console"},EdenUI.ScriptBox.prototype.focus=function(){var e,t;this.outdiv.focus(),document.activeElement===this.outdiv&&(e=this.intextarea.value.length,t=this.currentlineno,this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=e,this.ast&&(this.highlighter.highlight(this.ast,t,e),this.updateLineCachedHighlight()))},EdenUI.ScriptBox.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0),t=document.createRange(),i=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),i.removeAllRanges(),i.addRange(t),$(this.outdiv).remove(".fake-caret")},EdenUI.ScriptBox.prototype.setChangeCB=function(e){this.savecb=e},EdenUI.ScriptBox.prototype.hideInfoBox=function(){$(this.infobox).hide("fast")},EdenUI.ScriptBox.prototype.showInfoBox=function(e,t,i,n){console.log("SHOW INFO BOX "+n),"warning"==i?this.infobox.innerHTML="<div class='info-warnitem'><span>"+n+"</span></div>":"error"==i&&(this.infobox.innerHTML="<div class='info-erroritem'><span>"+n+"</span></div>");n=$(this.infobox);n.css("top",t+"px"),n.css("left",e+"px"),$(this.infobox).show()},EdenUI.ScriptBox.prototype.disable=function(){var e;this.outdiv&&(changeClass(this.outdiv,"goto",!1),this.valuedivs[this.currentstatement]=this.outdiv,e=EdenUI.htmlForStatement(Eden.Statement.statements[this.currentstatement],30,30),this.valuedivs[this.currentstatement].innerHTML='<div class="eden-line">'+e+"</div>",changeClass(this.outdiv.parentNode,"readonly",!0),this.ast)},EdenUI.ScriptBox.prototype.enable=function(){this.outdiv&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv.parentNode,"readonly",!1),this.ast&&this.highlighter.highlight(this.ast,-1,-1))},EdenUI.ScriptBox.prototype.setSource=function(e){this.intextarea.value=e,this.ast=new Eden.AST(e,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),this.highlightContent(this.ast,-1,0),this.intextarea.focus(),this.ast.script&&0==this.ast.script.errors.length||""==e?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0),this.outdiv.contentEditable=!0},EdenUI.ScriptBox.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.ast=new Eden.AST(this.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),this.highlighter.ast=this.ast,this.runScript(e),this.highlightContent(this.ast,e,t),this.ast.script&&0==this.ast.script.errors.length?changeClass(this.outdiv.parentNode,"error",!1):changeClass(this.outdiv.parentNode,"error",!0)},EdenUI.ScriptBox.prototype.updateLineCachedHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(this.ast,e,t)},EdenUI.ScriptBox.prototype.updateEntireHighlight=function(e){this.ast=new Eden.AST(this.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),this.highlighter.ast=this.ast;var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),e&&this.runScript(0),this.highlightContent(this.ast,-1,t),this.ast.script&&0==this.ast.script.errors.length||console.log("indicated error")},EdenUI.ScriptBox.prototype.highlightContent=function(e,t,i){if(this.highlighter.highlight(e,t,i),e.mainDoxyComment&&(-1==t||1<=t&&t<=e.mainDoxyComment.endline)){var n=e.mainDoxyComment.content.match(/@[a-z]+.*\n/gi);if(n)for(var s=0;s<n.length;s++){var o=n[s].search(/\s/);0<=o&&(n[s].substring(0,o),n[s].substr(o).trim())}}document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret");var a=this;$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(e,t){var i=a.dragint?Math.round(a.dragvalue+(t.position.left-a.dragstart)/2):(i=a.dragvalue+.005*(t.position.left-a.dragstart)).toFixed(4);i!=a.draglast&&(a.draglast=i,e.target.innerHTML=""+i,"\n"==(e=e.target.parentNode.textContent).charAt(e.length-1)&&(e=e.slice(0,-1)),a.replaceLine(a.dragline,e),a.ast=new Eden.AST(a.intextarea.value,void 0,EdenUI.ScriptBox.consoleAgent,{noindex:!0,strict:!0}),a.highlighter.ast=a.ast,a.highlightContent(a.ast,a.dragline,-1),Eden.Statement.statements[a.currentstatement].setSource(a.intextarea.value,a.ast))},start:function(e,t){a.edited=!0,a.dragline=a.findElementLineNumber(e.target),a.dragstart=t.position.left;t=e.target.textContent;-1==t.indexOf(".")?(a.dragvalue=parseInt(t),a.dragint=!0):(a.dragvalue=parseFloat(t),a.dragint=!1),a.draglast=a.dragvalue,$(e.target).addClass("eden-select"),$(a.outdiv).css("cursor","ew-resize")},stop:function(e,t){$(e.target).removeClass("eden-select"),$(a.outdiv).css("cursor","text"),a.dragline=-1},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptBox.prototype.clear=function(){this.$codearea.html(""),this.setSource("")},EdenUI.ScriptBox.prototype.getLineNumber=function(e){e=e.value.substr(0,e.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.ScriptBox.prototype.doRebuild=function(){this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight()},EdenUI.ScriptBox.prototype.runScript=function(e){},EdenUI.ScriptBox.prototype.rebuild=function(){clearTimeout(this.rebuildtimer);var e=this;this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptBox.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;for(var i=0;i<this.outdiv.childNodes.length;i++)if(this.outdiv.childNodes[i]===t)return i;return-1},EdenUI.ScriptBox.prototype.replaceLine=function(e,t){var i=this.intextarea.value.split("\n");i[e]=t,this.intextarea.value=i.join("\n")},EdenUI.Explorer=function(){var n=this;this.element=$(`<div class="explore-main">
<div class=\"explore-tabs\">
	<div class=\"explore-tab-container\">
		<div class=\"explore-tab explore-tab-current\" data-name="state">${Language.ui.explorer.state}</div>
		<div class="explore-tab explore-tab-notcurrent" data-name="scripts">Agents</div>
		<div class="explore-tab explore-tab-notcurrent" data-name="debug">Debug</div>
		<div class="explore-tab explore-tab-notcurrent" data-name="settings">Settings</div>
`+`	</div>
</div>
<div class="explore-state">
</div>
<div class="explore-script" style="display: none">
</div>
<div class="explore-debug" style="display: none">
</div>
<div class="explore-settings" style="display: none">
	<div style="font-size: 8pt">Note: Many of these do not work yet.</div>
	<h1>Environment</h1>
	<div id="explorerenvsettings" class="explorer-settings-list"></div>
	<h1>Project</h1>
	<div id="explorerprojectsettings" class="explorer-settings-list"></div>
	<h1>Menu Bar</h1>
	<div id="explorermenusettings" class="explorer-settings-list"></div>
	<h1>Peer-2-Peer</h1>
	<div id="explorerp2psettings" class="explorer-settings-list"></div>
	<h1>Search</h1>
	<div id="explorersearchsettings" class="explorer-settings-list"></div>
	<h1>Parser</h1>
	<div id="explorerparsersettings" class="explorer-settings-list"></div>
	<h1>Script Views</h1>
	<div id="explorerscriptviewsettings" class="explorer-settings-list"></div>
</div>
<div class="explore-console">
	<div class="explore-console-buttons">
		<div style="margin-top: 4px; float: left;">${Language.ui.explorer.input}</div>
		<button class="control-button clear-button control-enabled" title="${Language.ui.tooltips.clear}" style="float: right;">&#xf05e;</button>
	</div>
	<div class="explore-console-code"></div>
</div>
</div>`),$("#jseden-main").append(this.element),this.consoleele=this.element.find(".explore-console-code"),this.expscripts=this.element.find(".explore-script"),this.expstate=this.element.find(".explore-state"),this.expdebug=this.element.find(".explore-debug"),this.expsettings=this.element.find(".explore-settings");var e=this.expsettings.find("#explorerenvsettings").get(0);this.addSetting(e,"jseden_autosave","Enable autosave to local storage","","boolean"),this.addSetting(e,"jseden_leaveprompt","Enable a leave page prompt","","boolean");e=this.expsettings.find("#explorerprojectsettings").get(0);this.addSetting(e,"jseden_feedback_disabled","Disable comments","","boolean"),this.addSetting(e,"jseden_project_noforking","Disable forking","","boolean"),this.addSetting(e,"jseden_project_liveupdate","Live update of imported scripts","","boolean");e=this.expsettings.find("#explorermenusettings").get(0);this.addSetting(e,"jseden_menu_visible","Menu visible","","boolean"),this.addSetting(e,"jseden_menu_showhelp","Show Help","","boolean"),this.addSetting(e,"jseden_menu_showsearch","Show Search","","boolean"),this.addSetting(e,"jseden_menu_showcreate","Show Create Views","","boolean"),this.addSetting(e,"jseden_menu_showexisting","Show Existing","","boolean"),this.addSetting(e,"jseden_menu_showshare","Show Share","","boolean"),this.addSetting(e,"jseden_explorer_enabled","Allow Spanner Panel","","boolean");e=this.expsettings.find("#explorerp2psettings").get(0);this.addSetting(e,"jseden_p2p_captureedits","Send script edits","","boolean"),this.addSetting(e,"jseden_p2p_captureinput","Send UI Events (Mouse...)","","boolean"),this.addSetting(e,"jseden_p2p_doactive","Copy all state on connect","","boolean"),this.addSetting(e,"jseden_p2p_clone","Send project on connect","","boolean"),this.addSetting(e,"jseden_p2p_record","Record collaboration","","boolean"),e=this.expsettings.find("#explorersearchsettings").get(0),this.addSetting(e,"jseden_search_history","Include Historic","","boolean"),this.addSetting(e,"jseden_search_external","Always include external","","boolean"),this.addSetting(e,"jseden_search_all","Don't make unique","","boolean"),this.addSetting(e,"jseden_search_nosort","Don't sort by time","","boolean"),this.addSetting(e,"jseden_search_projects","Include projects in results","","boolean"),e=this.expsettings.find("#explorerparsersettings").get(0),this.addSetting(e,"jseden_parser_strict","Strict mode","","boolean"),this.addSetting(e,"jseden_parser_noliterals","No literals in expressions","","boolean"),this.addSetting(e,"jseden_parser_noexprover","No override expressions","","boolean"),this.addSetting(e,"jseden_parser_warndeprecate","Show deprecation warnings","","boolean"),this.addSetting(e,"jseden_parser_errordeprecate","Make deprecated an error","","boolean"),this.addSetting(e,"jseden_parser_cs3","ConstruitScript3 Support","","boolean"),e=this.expsettings.find("#explorerscriptviewsettings").get(0),this.addSetting(e,"jseden_script_query","Default browse query","","text"),this.addSetting(e,"jseden_script_buttons","Show buttons","","boolean"),this.addSetting(e,"jseden_script_diffs","Enable diff feature","","boolean"),this.addSetting(e,"jseden_script_highlighting","Disable highlighting","","boolean"),this.addSetting(e,"jseden_script_styling","Disable comment styling","","boolean"),this.addSetting(e,"jseden_script_hidecomments","Hide all comments","","boolean"),this.addSetting(e,"jseden_script_readonly","All readonly","","boolean"),this.addSetting(e,"jseden_script_livepatch","Auto share edits with others","","boolean"),this.element.resizable({handles:"w",stop:function(e,t){eden.root.lookup("jseden_explorer_width").assign(t.element[0].clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent)}}),eden.root.lookup("jseden_explorer_width").assign(this.element.get(0).clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent),this.console=new EdenUI.ScriptBox(this.consoleele.get(0),{nobuttons:!0}),this.state=new EdenUI.ExplorerState(this.expstate),this.debug=new EdenUI.ExplorerDebug(this.expdebug),this.scripts=new EdenUI.ExplorerScripts(this.expscripts),this.element.on("click",".clear-button",function(e){n.console.clear()}),this.element.on("click",".explore-tab",function(e){var t=e.currentTarget.getAttribute("data-name"),i=n.element.find(".explore-tab-current");i.removeClass("explore-tab-current"),i.addClass("explore-tab-notcurrent"),changeClass(e.currentTarget,"explore-tab-current",!0),changeClass(e.currentTarget,"explore-tab-notcurrent",!1),"state"==t?(n.scripts.stop(),n.expstate.css("display","flex"),n.expscripts.css("display","none"),n.expsettings.css("display","none"),n.expdebug.css("display","none")):"scripts"==t?(n.scripts.start(),n.expstate.css("display","none"),n.expscripts.css("display","flex"),n.expsettings.css("display","none"),n.expdebug.css("display","none")):"debug"==t?(n.scripts.stop(),n.expstate.css("display","none"),n.expscripts.css("display","none"),n.expdebug.css("display","flex"),n.expsettings.css("display","none")):"palette"==t||"settings"==t&&(n.scripts.stop(),n.expstate.css("display","none"),n.expsettings.css("display","block"),n.expscripts.css("display","none"),n.expdebug.css("display","none"))});var t=eden.root.lookup("jseden_explorer_enabled");t.value()?n.state.show():(this.enabled=!1,this.element.hide(),n.state.hide()),t.addJSObserver("explorer",function(e,t){(n.enabled=t)?eden.root.lookup("jseden_explorer_visible").value()&&(n.element.show(),n.state.show()):(n.element.hide(),n.state.hide(),n.capture=!1,n.scripts.stop())});e=eden.root.lookup("jseden_explorer_visible");function i(e,t){window.localStorage.setItem(e.name,t)}e.value()?n.state.show():(this.element.hide(),n.state.hide()),e.addJSObserver("explorer",function(e,t){t&&n.enabled?(n.element.show(),n.state.show(),eden.root.lookup("jseden_explorer_width").assign(n.element.get(0).clientWidth+2,eden.root.scope,EdenSymbol.localJSAgent)):(n.element.hide(),n.state.capture=!1,n.state.clear(),n.state.hide(),eden.root.lookup("jseden_explorer_width").assign(0,eden.root.scope,EdenSymbol.localJSAgent))});for(var s=["jseden_autosave","jseden_leaveprompt","jseden_explorer_enabled"],o=0;o<s.length;o++){var a=eden.root.lookup(s[o]);a.assign("true"==window.localStorage[s[o]],eden.root.scope,EdenSymbol.localJSAgent),a.addJSObserver("settings",i)}t=eden.root.lookup("jseden_explorer_zoom"),e=t.value();t.addJSObserver("explorer",function(e,t){"number"==typeof t&&0<t&&(t=10*t,n.state.results.css("font-size",t+"pt"))}),void 0===e&&t.assign(1,eden.root.scope,EdenSymbol.defaultAgent)},EdenUI.Explorer.prototype.addSetting=function(e,t,i,n,s){var o=document.createElement("div");o.className="explorer-setting",o.title=n;n=document.createElement("span");n.textContent=i,n.className="explorer-setting-label",o.appendChild(n);var a=document.createElement("input"),r=eden.root.lookup(t),t=r.value();switch(s){case"boolean":a.setAttribute("type","checkbox");break;case"string":a.setAttribute("type","text")}function d(e,t){e.orign instanceof InternalAgent||("boolean"==s?a.checked=t:a.value=t)}a.onchange=function(e){"boolean"==s?r.assign(a.checked,eden.root.scope,EdenSymbol.jsAgent):r.assign(a.value,eden.root.scope,EdenSymbol.jsAgent)},d(r,t),r.addJSObserver("settings",d),o.appendChild(a),e.appendChild(o)},EdenUI.Explorer.MAXHIGHLIGHTLENGTH=1e3,EdenUI.Explorer.prototype.showConsole=function(){},EdenUI.Explorer.prototype.hideConsole=function(){},EdenUI.ExplorerState=function(e){var u=this;this.outer=e,this.controls=$(`<div class="explore-controls">
		<button class="explorer-control capture"><span class="explorer-control-icon">&#xf111;</span>${Language.ui.explorer.capture}</button>
		<button class="explorer-control clear"><span class="explorer-control-icon">&#xf05e;</span>${Language.ui.explorer.clear}</button>
		<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="${Language.ui.explorer.filter}"></input></span>
	</div>`),this.results=$('<div class="explore-symbols"></div>'),this.outer.append(this.controls),this.outer.append(this.results),this.searchbox=this.controls.find(".explorerfilter"),this.watchobs={},this.capture=!1,this.delay=100,this.delay2=20,this.timeout=void 0,this.timeout2=void 0,this.mode="tree",this.index={},this.todo={},this.filter=void 0,this.listener=function(e,t){var i=e.name;!u.capture||t==EdenSymbol.EXPIRED&&void 0!==u.watchobs[i]||void 0!==u.filter&&!u.filter[i]?(u.todo[i]=!0,void 0===u.timeout2&&(u.timeout2=setTimeout(function(){u.timeout2=void 0;var e,t=u.todo;for(e in u.todo={},u.index)if(t[e]){var i=eden.root.symbols[e];if(void 0===i){for(var n=0;n<u.index[e].length;n++)u.removeEntry(e,u.index[e][n]);delete u.index[e]}else for(n=0;n<u.index[e].length;n++)u.updateEntry(i,u.index[e][n])}},u.delay2))):(void 0===u.watchobs[i]?u.watchobs[e.name]=1:u.watchobs[i].lastupdate=1,u.triggerUpdate())},this.controls.on("click",".clear",function(e){var t=eden.root.lookup("jseden_explorer_clear");t.eden_definition||t.assign(!0,eden.root.scope,EdenSymbol.localJSAgent)}),this.controls.on("click",".capture",function(e){var t=eden.root.lookup("jseden_explorer_capture");t.eden_definition||t.assign(!t.value(),eden.root.scope,EdenSymbol.localJSAgent)}),this.results.on("mouseenter",".explore-entry",function(e){var t=e.currentTarget.getAttribute("data-obs"),t=eden.root.lookup(t);t.definition&&EdenUI.showTooltip(e,EdenUI.Highlight.html(t.getSource(),!1))}),this.results.on("mouseleave",".explore-entry",function(e){EdenUI.closeTooltip()}),this.results.on("click",".explore-observable",function(e){var t=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");Eden.Selectors.goto(t+":active"),e.stopPropagation()}),this.results.on("click",".explore-expand-value",function(e){var t=e.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-obs");u.updateEntry(eden.root.lookup(t),e.currentTarget.parentNode,!0)}),this.results.on("click",".eden-path",function(e){e=e.currentTarget.textContent;edenUI.gotoCode(e,-1)}),this.results.on("click",".symvalue",function(e){}),this.results.on("click",".explore-entry-icon",function(e){var t=e.currentTarget.parentNode.parentNode.parentNode,i=t.getAttribute("data-obs");if("true"==t.getAttribute("data-expanded")){e.currentTarget.innerHTML="&#xf067;",t.setAttribute("data-expanded","false");for(var n=t.firstChild;n;){var s=n.nextSibling;"DIV"==n.nodeName&&"explore-entry-inner"!=n.className&&0==n.className.includes("active")&&t.removeChild(n),n=s}}else{e.currentTarget.innerHTML="&#xf068;",t.setAttribute("data-expanded","true");for(var o,a,r,d,l,c,h=eden.root.symbols[i],p={},n=t.firstChild;n;)"DIV"==n.nodeName&&(p[n.getAttribute("data-obs")]=!0),n=n.nextSibling;for(o in h.dependencies)p[o]||(r=!(a=h.dependencies[o]),d=a&&a.definition,i=o,c=(l=$('<div class="explore-entry dependency'+(r?" missing":"")+(d?" defined":"")+'" data-obs="'+i+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(d?"&#xf067;":" ")+'</span><span class="explore-observable">'+i+'</span> </span><div class="symvalue"></div></div></div>')).find(".symvalue").get(0),u.updateEntry(a,c),void 0===u.index[i]&&(u.index[i]=[]),u.index[i].push(c),t.appendChild(l.get(0)));for(o in h.dynamicDependencies)p[o]||(r=!(a=h.dynamicDependencies[o]),d=a&&a.definition,i=o,c=(l=$('<div class="explore-entry dependency'+(r?" missing":"")+(d?" defined":"")+'" data-obs="'+i+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(d?"&#xf067;":" ")+'</span><span class="explore-observable">'+i+'</span> </span><div class="symvalue"></div></div></div>')).find(".symvalue").get(0),u.updateEntry(a,c),void 0===u.index[i]&&(u.index[i]=[]),u.index[i].push(c),t.appendChild(l.get(0)));for(o in h.subscribers)p[o]||(r=!(a=h.subscribers[o]),d=a&&a.definition,i=o,c=(l=$('<div class="explore-entry subscriber'+(r?" missing":"")+(d?" defined":"")+'" data-obs="'+i+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">'+(d?"&#xf067;":" ")+'</span><span class="explore-observable">'+i+'</span> </span><div class="symvalue"></div></div></div>')).find(".symvalue").get(0),u.updateEntry(a,c),void 0===u.index[i]&&(u.index[i]=[]),u.index[i].push(c),t.appendChild(l.get(0)))}});var t=eden.root.lookup("jseden_explorer_search");t.value()&&this.searchbox.val(searchval),t.addJSObserver("explorer",function(e,t){void 0!==t&&"*JavaScript"!=e.origin.name&&u.searchbox.val(t)}),this.searchbox.on("keyup",function(e){void 0===t.definition&&t.assign(e.target.value,eden.root.scope,EdenSymbol.localJSAgent);e=Eden.Selectors.queryWithinSync(eden.root.statements,e.target.value,"name");u.watch(e)});var i=eden.root.lookup("jseden_explorer_watch"),e=i.value();Array.isArray(e)&&(this.clear(),this.watch(e)),i.addJSObserver("explorer",function(e,t){Array.isArray(t)&&(u.capture?u.filter=void 0:u.clear(),u.watch(t))});i=eden.root.lookup("jseden_explorer_capture");i.addJSObserver("explorer",function(e,t){t?(u.record(),u.controls.find(".capture").addClass("active")):(u.capture=!1,u.controls.find(".capture").removeClass("active"))}),i.value()&&u.record(),eden.root.lookup("jseden_explorer_clear").addJSObserver("explorer",function(e,t){t&&u.clear()})},EdenUI.ExplorerState.prototype.show=function(){eden.root.addGlobal(this.listener)},EdenUI.ExplorerState.prototype.hide=function(){eden.root.removeGlobal(this.listener)},EdenUI.ExplorerState.prototype.triggerUpdate=function(){var e;void 0===this.timeout&&((e=this).timeout=setTimeout(function(){e.index={},e.timeout=void 0,"list"==e.mode?e.updateList():"tree"==e.mode?e.updateTree():"graph"==e.mode&&e.updateGraph()},this.delay))},EdenUI.ExplorerState.prototype.updateList=function(){},EdenUI.ExplorerState.prototype.makeAgentEntry=function(e){var t,i,n=e.name;if(n.startsWith("*Console"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf108;</span> <b>console</b></div>');if(n.startsWith("*When"))return t=(i=(i=(t=n.split(":"))[1].split("/"))[i.length-1])+":"+t[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">when</span> <span class="eden-path">'+t+"</span></div>");if(n.startsWith("*Action"))return t=(i=(i=(t=n.split(":"))[1].split("/"))[i.length-1])+":"+t[2],$('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">action</span> <span class="eden-path">'+t+"</span></div>");if("/"==n.charAt(0)){if(e.eden_definition&&e.eden_definition.startsWith("proc"))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf183;</span><span class="eden-keyword">proc</span> <span class="eden-path">'+n+"</span></div>")}else if("*"!=n.charAt(0))return $('<div class="explore-entry"><span class="explore-entry-icon">&#xf15c;</span><span class="eden-path">'+n+"</span></div>")},EdenUI.ExplorerState.prototype.removeEntry=function(e,t){t.innerHTML='<span style="font-weight: bold; color: red">DELETED</span>',delete this.watchobs[e],this.triggerUpdate()},EdenUI.ExplorerState.prototype.updateEntry=function(e,t,i){var n,s;e&&(s="function"==typeof(n=e.value())?'<span class="eden-keyword">func</span>':(s=!i&&Array.isArray(n)&&2<n.length?'[.. <span class="explore-expand-value">&#xf0fe;</span> ..]':(s=Eden.edenCodeForValue(n,void 0,2)).length<EdenUI.Explorer.MAXHIGHLIGHTLENGTH?EdenUI.Highlight.html(s,!0):s,(e.eden_definition?'<span class="eden-keyword">is</span>':"<b>=</b>")+" "+s),t.innerHTML=s)},EdenUI.ExplorerState.prototype.makeEntry=function(e,t,i){var n=eden.root.symbols[e],s=!1,o=!1,a=n.isSourceOfUndefined();n&&n.definition&&(o=!0),n||(s=!0);let r="explore-entry";i&&(r+=" active"),s&&(r+=" missing"),o&&(r+=" defined"),a&&(r+=" error");var d=$('<div class="'+r+'" data-obs="'+e+'"><div class="explore-entry-inner"><span><span class="explore-entry-icon">&#xf067;</span><span class="explore-observable">'+e+'</span> </span><div class="symvalue"></div></div></div>'),a=d.find(".symvalue").get(0);this.updateEntry(n,a),void 0===this.index[e]&&(this.index[e]=[]),this.index[e].push(a);if(t)for(var l in t)d.append(this.makeEntry(l,t[l],i));return d},EdenUI.ExplorerState.prototype.updateTree=function(){var e,t=this.capture?Eden.Query.dependencyTree(this.watchobs):this.watchobs;for(e in this.results.html(""),t)this.results.append(this.makeEntry(e,void 0,this.capture))},EdenUI.ExplorerState.prototype.watch=function(e){this.capture,void 0===this.filter&&0<e.length&&(this.filter={});for(var t=0;t<e.length;t++)void 0!==e[t]&&(this.filter[e[t]]=!0,this.capture||(this.watchobs[e[t]]={elements:[],lastupdate:1}));this.triggerUpdate()},EdenUI.ExplorerState.prototype.record=function(){this.watchobs={},this.triggerUpdate(),this.capture=!0},EdenUI.ExplorerState.prototype.clear=function(){this.watchobs={},this.filter=void 0,this.triggerUpdate()},EdenUI.ExplorerState.prototype.displayAsTree=function(){},EdenUI.ExplorerState.prototype.displayAsList=function(){},EdenUI.ExplorerState.prototype.displayAsGraph=function(){},EdenUI.ExplorerState.prototype.search=function(e){},EdenUI.ExplorerScripts=function(e){this.outer=e,this.controls=$('<div class="explore-controls">\t\t<span class="explorerfilter"><input type="text" class="explorerfilter" placeholder="Filter..."></input></span>\t</div>'),this.scripts=$('<div class="explore-scripts"></div>'),this.outer.append(this.controls),this.outer.append(this.scripts)},EdenUI.ExplorerScripts.prototype.buildScriptTree=function(e){for(var t={},i=0;i<e.length;i++)for(var n=e[i].split(/[\.\:]+/),s=t,o=0;o<n.length;o++)void 0===s[n[o]]&&(s[n[o]]={}),s=s[n[o]];return t},EdenUI.ExplorerScripts.prototype.makeEntry=function(e,t){for(var i in t){var n=$('<div class="explore-sentry"><div class="explore-script-inner"><span class="explore-entry-icon">&#xf067;</span>'+i+"</div></div>");this.makeEntry(n,t[i]),e.append(n)}},EdenUI.ExplorerScripts.prototype.start=function(){this.interval||(this.interval=setInterval(()=>{this.update()},200))},EdenUI.ExplorerScripts.prototype.stop=function(){clearInterval(this.interval),this.interval=null},EdenUI.ExplorerScripts.prototype.update=function(){this.scripts.html("");let t={};for(var i in eden.project.ast.whens){var n=eden.project.ast.whens[i];if(n.enabled){let e=n.parent;for(;e&&!e.name;)e=e.parent;i=e&&e.name?e.name:"Unknown";t.hasOwnProperty(i)||(t[i]=[]),t[i].push(n)}}var o,a=Date.now();for(o in t){let s=document.createElement("DIV");s.className="explore-sentry";let e=document.createElement("DIV");e.className="explore-script-inner",e.textContent=o,s.appendChild(e);var r=t[o];for(let n=0;n<r.length;++n){let e=r[n],t=document.createElement("DIV");t.className="explore-sentry";var d=(a-e.triggertimestamp)/1e3,d=1-Math.max(0,Math.min(2,d))/2,d=1-(d*=d);t.style.background="rgb("+255*d+",255,"+255*d+")";let i=e.getSource();d=i.indexOf("\n");0<d&&(i=i.substring(0,d)),EdenUI.Highlight.htmlElement(i,t),s.appendChild(t)}this.scripts[0].appendChild(s)}},EdenUI.ExplorerDebug=function(e){var s=!1,o=void 0,a=500,t=$('<div class="debugger"></div>'),i=$('<div class="debugger-controls"><button title="Toggle capture all agents" style="margin-left: 20px; margin-right: 20px;" class="debugger-button debug">&#xf188;</button><button class="debugger-button play" title="Auto Play">&#xf04b;</button><button class="debugger-button stepforward">&#xf051;</button><button class="debugger-button autostep">&#xf050;</button><input type="range" class="debugger-speed" value="500" max="1000" min="50"></input><button class="debugger-button record" title="Log all redefinitions">&#xf111;</button></div>');t.append(i);var r=$('<div class="debugger-agents"></div>');t.append(r);var n={lasttime:0,lastloc:""};eden.listenTo("debug_log",null,e=>{var t=Date.now();t>n.lasttime+2e3&&(i=document.createElement("DIV"),EdenUI.Highlight.htmlElement("\n/* "+new Date(t).toString()+" */\n",i),r[0].appendChild(i),n.lasttime=t);var i=e.getLocationName();"*unknown*"==i&&console.warn("Unknown",e),n.lastloc!==i&&(t=document.createElement("DIV"),EdenUI.Highlight.htmlElement("\n## "+i+" \n",t),r[0].appendChild(t),n.lastloc=i);i=document.createElement("DIV");EdenUI.Highlight.htmlElement(e.getSource(),i),r[0].appendChild(i),r[0].scrollTop=r[0].scrollHeight});var d={};Eden.AST.debugstep_cb=function(e){var t,i,n=e.agent;if(console.log("DEBUG",e),e.statement&&"dummy"==e.statement.type)return e.next();d[n.id]&&(i=d[n.id].html,d[n.id].data=e,i?(d[n.id].lastline&&(d[n.id].lastline.className="eden-line"),e.statement!==n&&(t=e.statement.getStartLine(n),i=i.get(0).childNodes[1].childNodes[t],(d[n.id].lastline=i)?i.className="eden-line debugger-line":console.error("Missing line: "+t))):console.error("Missing output")),s&&setTimeout(e.next,a)};Eden.AST.debug_begin_cb=function(e){var t,i=e.agent;console.log("BEGIN DEBUG",i.id),d.hasOwnProperty(i.id)?t=d[i.id].html:(t=$('<div class="debugger-agent" data-agent="'+i.id+'"><div class="debugger-agent-controls"></div><div class="debugger-code"></div></div>'),r.append(t),d[i.id]={html:t,data:e}),void 0===o&&(o=d[i.id],t.get(0).className="debugger-agent active");var n,n=(n="",(e=i).getSource&&(n+=e.getSource()),n),i=new Eden.AST(n,void 0,i);new EdenUI.Highlight(t.get(0).childNodes[1]).highlight(i,-1,-1)};Eden.AST.debug_end_cb=function(e){e=e.agent;console.log("END DEBUG",e.id),void 0!==e.id&&void 0!==d[e.id]&&o===d[e.id]&&(o=void 0)},Eden.AST.debug=!0,Eden.AST.debugstep=!1,e[0].appendChild(t[0]),i.on("click",".play",function(e){(s=!s)?(e.currentTarget.innerHTML="&#xf04c;",e.currentTarget.className="debugger-button play active"):(e.currentTarget.innerHTML="&#xf04b;",e.currentTarget.className="debugger-button play")}).on("click",".stepforward",function(e){o&&o.data.next&&(o.data.next(),o&&(o.data.next=void 0))}).on("click",".debug",function(e){Eden.AST.debugstep=!Eden.AST.debugstep,Eden.AST.debugstep?e.currentTarget.className="debugger-button debug active":e.currentTarget.className="debugger-button debug"}).on("change",".debugger-speed",function(e){a=e.currentTarget.value,console.log("Change speed: "+a)}).on("click",".record",function(e){Eden.logging=!Eden.logging,Eden.logging?(e.currentTarget.className="debugger-button record active",r[0].innerHTML=""):e.currentTarget.className="debugger-button record"}),r.on("click",".debugger-agent",function(e){o&&(o.html.get(0).className="debugger-agent"),(o=d[e.currentTarget.getAttribute("data-agent")]).html.get(0).className="debugger-agent active"})},EdenUI.Markdown=function(e){this.contents=document.createElement("div"),this.contents.className="markdown-inputhider",this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.intextarea.value=e,this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="markdown-inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contentEditable=!0,this.outdiv.className="markdown-outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.highlighter=new EdenUI.Highlight(this.outdiv,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0},brline:!0});new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.updateLineCachedHighlight()},EdenUI.Highlight.prototype.MARKDOWN=function(){"#"==this.token&&(this.stream.position-2<=0||"\n"==this.stream.code.charAt(this.stream.position-2))?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE",this.lineelement.className=this.styles["comment-line"]):"##"==this.token&&(this.stream.position-3<=0||"\n"==this.stream.code.charAt(this.stream.position-3))?(this.classes.push("hidden-comment"),this.mode="SECTION_TITLE2",this.lineelement.className=this.styles["comment-line"]):this.COMMENT()},EdenUI.Markdown.styles={comment:"","hidden-comment":"markdown-comment-hidden",operator:"eden-operator",observable:"eden-observable",storage:"eden-storage",number:"eden-number",string:"eden-string",constant:"eden-constant",keyword:"eden-keyword",javascript:"eden-javascript",selector:"eden-selector",selector2:"eden-selector2",selector3:"eden-selector3",function:"eden-function",type:"eden-type",special:"eden-special",backticks:"eden-backticks",doxycomment:"eden-doxycomment",pathblock:"eden-pathblock","comment-h1":"markdown-comment-h1","comment-h2":"markdown-comment-h2","comment-h3":"eden-comment-h3","horizontal-line":"eden-section-line","comment-line":"eden-comment-line","comment-emph":"eden-comment-emph","comment-bold":"eden-comment-bold","script-line":"markdown-comment-line",doxytag:"markdown-tag","comment-query":"eden-comment-query","block-comment":"eden-blockcomment","comment-ul":"eden-comment-ul","comment-blockquote":"eden-comment-blockquote",script:"eden-script"},EdenUI.Markdown.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.Markdown.prototype.hideInfoBox=function(){},EdenUI.Markdown.prototype.disableGotoMode=function(){},EdenUI.Markdown.prototype.rebuild=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.updateLineCachedHighlight=function(){var e=new Eden.AST(this.intextarea.value,void 0,{},{noparse:!0,noindex:!0}),t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,this.getLineNumber(this.intextarea)),this.highlighter.highlight(e,-1,t)},EdenUI.Markdown.prototype.setValue=function(e){this.intextarea.value=e,this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.moveCaret=function(){this.updateLineCachedHighlight()},EdenUI.Markdown.prototype.checkScroll=function(){},EdenUI.Markdown.prototype.enableGotoMode=function(){},EdenUI.Markdown.prototype.focusText=function(){var e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=t},EdenUI.Markdown.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.Markdown.prototype.setCaretToFakeCaret=function(){var e,t,i=$(this.outdiv).find(".fake-caret").get(0);i&&(e=document.createRange(),t=window.getSelection(),i.nextSibling&&(i=i.nextSibling),e.setStart(i,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),$(this.outdiv).remove(".fake-caret"))},EdenUI.Markdown.html=function(e,t,i){var n=document.createElement("div"),s=new EdenUI.Highlight(n,{start:"MARKDOWN",styles:EdenUI.Markdown.styles,clearmodes:{SECTION_TITLE:!0,SECTION_TITLE2:!0,SECTION_TITLE_H1:!0,SECTION_TITLE_H2:!0,COMMENT_BOLD:!0,COMMENT_CODE:!0,COMMENT_ICON:!0,COMMENT_EMPH:!0,COMMENT_ITALIC:!0,END_COMMENT_TAG:!0,COMMENT_TAG:!0,COMMENT_LINK:!0,COMMENT_LINK_END:!0},brline:!0});if(EdenUI.Markdown.styles["hidden-comment"]="eden-comment-hidden",EdenUI.Markdown.styles["script-line"]="markdown-comment-line2",s.ast={stream:new Eden.EdenStream(e)},s.highlight(s.ast,-1,-1,void 0),EdenUI.Markdown.styles["hidden-comment"]="markdown-comment-hidden",EdenUI.Markdown.styles["script-line"]="markdown-comment-line",t)return n.childNodes[0].innerHTML;for(var o="",a=0;a<n.childNodes.length;a++)o+=n.childNodes[a].innerHTML;return i?'<div style="display: flex; align-items: center;"><div class="eden-hl-play" data-src="'+e+'">&#xf04b;</div><div>'+o+"</div></div>":o},EdenUI.ProjectDetails=function(h,e){var p=this;this.projectid=h,this.meta=void 0,this.newtab=e;e=mobilecheck();this.obscurer=$('<div class="modal" style="display: block;"></div>'),this.obscurer.on("click",function(e){e.target===e.currentTarget&&p.remove()}),this.dialog=e?$('<div class="modal-content"></div>'):$('<div class="modal-content" style="width: 600px"></div>'),this.obscurer.append(this.dialog),document.body.appendChild(this.obscurer.get(0)),Eden.DB.getMeta(h,function(e){console.log("DETAILS META",e),null!==e[0].image&&(s=$('<img class="projectdetails-thumb" src="'+e[0].image+'"></img>'),p.dialog.append(s)),console.log(e[0].projectMetaData);var t=null!==e[0].projectMetaData?JSON.parse(e[0].projectMetaData):{},o=document.createElement("div");o.className="markdown";var i=new showdown.Converter,n=t&&t.description?t.description.replace(/\@author[^\n]*/g,"").replace(/\s(#[a-zA-Z0-9]+)/g,' <span class="markdown-hashtag">$1</span>'):"",s=e[0].ownername;if(t&&t.description){var a=new Eden.AST.DoxyComment(t.description,0,0).getProperty("author");if(a&&0<a.length){if(s=a[0]+(1<a.length?" et al.":""),1<a.length){n+="\n\n__Authors:__";for(var r=0;r<a.length;r++)n+=" "+a[r],r<a.length-1&&(n+=",")}a[0]!=e[0].ownername&&(n+="\n\n__Published by:__ "+e[0].ownername)}else s=e[0].ownername}t=i.makeHtml(n);o.innerHTML=t,p.dialog.get(0).appendChild(o);i=e[0].date.split(/[- :]/),t=null!==e[0].overallRating?e[0].overallRating/e[0].numRatings:0,s=$('<div class="projectdetails">\t\t\t<span class="projectdetails-rateavg">'+t.toFixed(1)+'</span><span><span class="projectdetails-label">by:</span><span class="projectdetails-value">'+s+'</span></span>\t\t\t<span>, <span class="projectdetails-value">'+get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)+"</span></span>\t\t</div>"),i=$('<div class="projectdetails-rating"><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span></div>');p.dialog.append(i),p.dialog.append(s),i.on("click",".projectdetails-star",function(e){if(0!=Eden.DB.isLoggedIn()){for(var t=e.currentTarget.parentNode,i=0,n=0;n<5;n++)t.childNodes[n].className="projectdetails-star"+(0<i?"":" selected"),t.childNodes[n].innerHTML="&#xf005;",t.childNodes[n]===e.currentTarget&&(i=n+1);Eden.DB.rate(h,i)}});var d=i[0];if(t)for(var l=Math.floor(t),r=0;r<5;r++)d.childNodes[r].className="projectdetails-star"+(l<=r?"":" average"),d.childNodes[r].innerHTML="&#xf005;";var c=e[0].myrating;if(c)for(r=0;r<5;r++)d.childNodes[r].className="projectdetails-star"+(c<=r?"":" selected"),d.childNodes[r].innerHTML="&#xf005;";(e=e[0].owner==Eden.DB.userid?$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="deleteproject script-button"><span class="explorer-control-icon">&#xf00d;</span>Delete</button><br></div>'):$('<div class="projectdetails-buttons"><button class="openproject script-button"><span class="explorer-control-icon">&#xf04b;</span>Open</button><button class="restoreproject script-button"><span class="explorer-control-icon">&#xf040;</span>Maker</button><button class="followproject script-button" style="float: right"><span class="explorer-control-icon">&#xf09e;</span>Follow</button><br></div>')).on("click",".openproject",function(){p.remove(),p.newtab?window.open(window.location.origin+window.location.pathname+"?load="+h):($(".loadmodal").show(),Eden.DB.log("open",{pid:h}),Eden.Project.load(h))}),e.on("click",".deleteproject",function(){confirm("Are you sure you want to delete this project?")&&(p.remove(),Eden.DB.log("delete",{pid:h}),Eden.DB.remove(h))}),e.on("click",".restoreproject",function(){p.remove(),eden.root.lookup("jseden_project_mode").assign("restore",eden.root.scope,Symbol.defaultAgent),Eden.Project.load(h)}),e.on("click",".followproject",function(t){Eden.DB.follow(h,function(e){e&&t.currentTarget.parentNode.removeChild(t.currentTarget)})}),e.append($('<iframe src="https://www.facebook.com/plugins/like.php?href='+encodeURIComponent(window.location.href+"?load="+h)+'&width=350&layout=standard&action=like&size=small&show_faces=false&share=true&height=80&appId=1447073055317881" width="300" height="20" style="border:none;overflow:hidden;margin-left:5px;margin-top:5px;" scrolling="no" frameborder="0" allowTransparency="true"></iframe>')),p.dialog.append(e),Eden.DB.search(":parent("+h+")",1,1,void 0,function(e){if(0<e.length){var t=document.createElement("div");t.className="projectdetails-forks";for(var i=0;i<e.length;i++){var n=document.createElement("div");n.className="projectdetails-fork";var s=e[i].date.split(/[- :]/);n.innerHTML='Forked as "'+e[i].title+'" by '+e[i].ownername+" "+get_time_diff(new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]).getTime()/1e3),t.appendChild(n)}p.dialog.get(0).insertBefore(t,o.nextSibling)}Eden.DB.searchComments({id:h},"",1,3,void 0,function(e){var t,i=new showdown.Converter;0<e.length&&((t=document.createElement("div")).style.borderTop="1px solid #aaa",t.style.height="10px",p.dialog.get(0).appendChild(t));for(var n=0;n<e.length;n++){var s=document.createElement("div"),o=document.createElement("div"),a=e[n].date.split(/[- :]/);o.className="feedback-header",o.innerHTML='<span class="feedback-author">'+e[n].name+'</span><span class="feedback-date" data-date="'+e[n].date+'">'+get_time_diff(new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5]).getTime()/1e3)+"</span>",s.appendChild(o);o=document.createElement("div");o.style.padding="0",o.style.marginBottom="3px",o.className="markdown",s.appendChild(o),s.className="feedback-result",o.innerHTML=i.makeHtml(e[n].comment),p.dialog.get(0).appendChild(s)}})})})},EdenUI.ProjectDetails.prototype.remove=function(){document.body.removeChild(this.obscurer.get(0))},EdenUI.ProjectDetails.searchProjects=function(t,i,e,n,s,o){var a=e||7,r=1;t.on("click",".more",function(e){t.find(".more").remove(),r++,Eden.DB.search(i,r,a,o,function(e){EdenUI.ProjectDetails._searchProjects(i,t,!i.startsWith(":me"),e,a,r,s)}),e.stopPropagation()}),i=i||"",Eden.DB.search(i,1,a,o,function(e){EdenUI.ProjectDetails._searchProjects(i,t,!i.startsWith(":me"),e,a,r,s),n&&n(e)})},EdenUI.ProjectDetails._searchProjects=function(e,t,i,n,s,o,a){s=s||7;if(void 0!==n){for(var r=mobilecheck()?120:200,d=0;d<n.length;d++){var l,c,h=n[d],p=h.date.split(/[- :]/),u=h.title,m=h.image,g=!1,b=null!==h.projectMetaData?JSON.parse(h.projectMetaData):void 0;i?c=b&&b.description&&(l=new Eden.AST.DoxyComment(b.description,0,0).getProperty("author"))&&0<l.length?l[0]:h.ownername:(c=get_time_diff(new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5]).getTime()/1e3),null===h.publicVersion&&(g=!0)),g=null!==m?$('<div class="cadence-plisting-entry project noselect'+(g?" locked":"")+'" data-pid="'+h.projectID+'"><div class="cadence-plisting-img"><img width="'+r+'" src="'+m+'"></img></div><div class="cadence-plisting-title">'+u+'</div><div class="cadence-plisting-subtitle">'+c+"</div></div>"):$('<div class="cadence-plisting-entry project noselect'+(g?" locked":"")+'" data-pid="'+h.projectID+'"><div class="cadence-plisting-icon">&#xf0c3;</div><div class="cadence-plisting-title">'+u+'</div><div class="cadence-plisting-subtitle">'+c+"</div></div>"),t.append(g),g.click(function(e){e=e.currentTarget.getAttribute("data-pid");Eden.DB.log("view",{pid:e}),new EdenUI.ProjectDetails(e,a)});u=null!==h.overallRating?h.overallRating/h.numRatings:0,h=$('<div class="projectdetails-ratingsmall"><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span><span class="projectdetails-star">&#xf005;</span></div>');g.append(h);var v=h.get(0);if(u)for(var f=Math.floor(u),E=0;E<5;E++)v.childNodes[E].className="projectdetails-star"+(f<=E?"":" average")}n.length==s&&t.append($('<div class="cadence-plisting-entry more noselect"><div class="cadence-plisting-icon more">&#xf103;</div></div>'))}},EdenUI.ProjectDetails.localProjects=function(e,t,i){if(void 0!==t)for(var n=0;n<t.length;n++){var s,o=t[n],a=o.title,r=o.image;d=o.description&&(s=new Eden.AST.DoxyComment(o.description,0,0).getProperty("author"))&&0<s.length?s[0]:o.author,a=null!==r?$('<div class="cadence-plisting-entry project noselect" data-path="'+o.name+'"><div class="cadence-plisting-img"><img src="'+r+'"></img></div><div class="cadence-plisting-title">'+a+'</div><div class="cadence-plisting-subtitle">'+d+"</div></div>"):$('<div class="cadence-plisting-entry project noselect" data-path="'+o.name+'"><div class="cadence-plisting-icon">&#xf0c3;</div><div class="cadence-plisting-title">'+a+'</div><div class="cadence-plisting-subtitle">'+d+"</div></div>"),e.append(a),a.click(function(e){e=e.currentTarget.getAttribute("data-path");console.log("Load project: "+e),Eden.Project.newFromExisting(e,eden,function(){})});var d=o.rating;if(d){o=$('<div class="projectdetails-ratingsmall">\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t<span class="projectdetails-star">&#xf005;</span>\t</div>');a.append(o);var l=o.get(0);if(d)for(var c=Math.floor(d),h=0;h<5;h++)l.childNodes[h].className="projectdetails-star"+(c<=h?"":" average")}}},EdenUI.Feedback=function(){var i=document.createElement("div");i.className="feedback-icon noselect",i.innerHTML="&#xf0e6;",i.title=Language.ui.tooltips.comments,document.getElementById("jseden-views").appendChild(i),this.odialog=document.createElement("div"),this.odialog.className="feedback-dialog",this.odialog.style.display="none",mobilecheck()&&(this.odialog.style.width="90%"),document.getElementById("jseden-views").appendChild(this.odialog),this.dialog=document.createElement("div"),this.dialog.className="feedback-scroller",this.odialog.appendChild(this.dialog);var e=document.createElement("div");e.className="feedback-title",e.innerHTML=`<span class="feedback-icon2">&#xf0e6;</span><span class="feedback-title-text">${Language.ui.comments.comments}</span><span class="feedback-close">&#xf00d;</span>`,this.dialog.appendChild(e);var t=eden.root.lookup("jseden_feedback_visible"),n=eden.root.lookup("jseden_feedback_width");eden.root.lookup("jseden_feedback_disabled").addJSObserver("feedback",function(e,t){i.style.display=t?"none":"inherit"});var s=this;function o(e,t){var i;t?(s.odialog.style.display="initial",s.clear(),s.updateComments(""),clearInterval(s.interval),s.interval=setInterval(function(){s.updateComments("")},5e3)):(s.odialog.style.display="none",clearInterval(s.interval),s.interval=setInterval(function(){Eden.DB.searchComments(eden.project,"",1,10,i,function(e){if(e)if(void 0===i&&0<e.length)i=e[0].commentID;else{for(var t=0;t<e.length;t++)edenUI.menu.notifications.notification("comment","New comment by "+e[t].name);0<e.length&&(i=e[0].commentID,s.cache=e.concat(s.cache))}})},1e4))}i.addEventListener("click",function(e){void 0===t.definition&&t.assign(!0,eden.root.scope,Symbol.hciAgent)}),e.childNodes[2].addEventListener("click",function(e){void 0===t.definition&&t.assign(!1,eden.root.scope,Symbol.hciAgent)}),n.assign(420,eden.root.scope,Symbol.defaultAgent),t.addJSObserver("feedback",o),o(0,t.value());var a=new EdenUI.Markdown(""),r=document.createElement("div");r.className="feedback-input",r.appendChild(a.contents);var d=document.createElement("div");d.className="feedback-buttons";var l=document.createElement("div");l.textContent=Language.ui.comments.signin,l.style.display="none",l.className="feedback-signinmsg",this.dialog.appendChild(l),Eden.DB.isLoggedIn()||(r.style.display="none",d.style.display="none",l.style.display="block"),this.dialog.appendChild(r),this.dialog.appendChild(d),this.results=document.createElement("div"),this.dialog.appendChild(this.results),this.results.addEventListener("click",function(e){"feedback-delete"==e.srcElement.className?(console.log("delete",e.srcElement.getAttribute("data-id")),Eden.DB.removeComment(e.srcElement.getAttribute("data-id")),s.results.removeChild(e.srcElement.parentNode.parentNode)):"eden-hl-play"==e.srcElement.className&&(console.log("PLAY COMMENT",e.srcElement.getAttribute("data-src")),eden.execute2(e.srcElement.getAttribute("data-src")))});n=document.createElement("button");n.className="script-button",n.textContent="Comment",d.appendChild(n),n.addEventListener("click",function(){Eden.DB.log("postcomment",{pid:eden.project?eden.project.id:-1,content:a.intextarea.value}),Eden.DB.postComment(eden.project,a.intextarea.value),a.setValue(""),s.updateComments("")}),this.cache=[],setInterval(function(){s.updateTimes()},2e4),Eden.DB.listenTo("login",this,function(e){e&&(r.style.display="block",d.style.display="block",l.style.display="none")})},EdenUI.Feedback.prototype.clear=function(){for(this.cache=[];this.results.lastChild;)this.results.removeChild(this.results.lastChild)},EdenUI.Feedback.prototype.updateTimes=function(){for(var e=0;e<this.results.childNodes.length;e++){var t=this.results.childNodes[e].childNodes[0].childNodes[1],i=t.getAttribute("data-date").split(/[- :]/);t.textContent=get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)}},EdenUI.Feedback.prototype.updateComments=function(e){var o=this,a=new showdown.Converter,r=0<this.cache.length?this.cache[0].commentID:void 0,d=this.results.firstChild;Eden.DB.searchComments(eden.project,e,1,100,r,function(e){if(e){for(var t=0;t<e.length;t++){var i=document.createElement("div"),n=document.createElement("div"),s=e[t].date.split(/[- :]/);n.className="feedback-header",n.innerHTML='<span class="feedback-author">'+e[t].name+'</span><span class="feedback-date" data-date="'+e[t].date+'">'+get_time_diff(new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]).getTime()/1e3)+(e[t].author==Eden.DB.userid?'</span><span class="feedback-delete" data-id="'+e[t].commentID+'">&#xf00d;</span>':""),i.appendChild(n);n=document.createElement("div");n.style.padding="0",n.style.marginBottom="3px",n.className="markdown",i.appendChild(n),i.className="feedback-result"+(r?" newitem":""),n.innerHTML=a.makeHtml(e[t].comment),d?o.results.insertBefore(i,d):o.results.appendChild(i),$(n).find("code").each(function(e,t){"PRE"==t.parentNode.nodeName&&(t.innerHTML=EdenUI.Highlight.html(t.textContent,!1,!0))})}o.cache=e.concat(o.cache)}})};