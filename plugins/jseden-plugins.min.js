function getCaretCharacterOffsetWithin(e){var t,n,i=0,o=e.ownerDocument||e.document,a=o.defaultView||o.parentWindow;return void 0!==a.getSelection?0<(n=a.getSelection()).rangeCount&&((a=(t=a.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(e),a.setEnd(t.endContainer,t.endOffset),i=a.toString().length):(n=o.selection)&&"Control"!=n.type&&(n=n.createRange(),(o=o.body.createTextRange()).moveToElementText(e),o.setEndPoint("EndToEnd",n),i=o.text.length),i}function getStartCaretCharacterOffsetWithin(e){var t,n,i=0,o=e.ownerDocument||e.document,a=o.defaultView||o.parentWindow;return void 0!==a.getSelection?0<(n=a.getSelection()).rangeCount&&((a=(t=a.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(e),a.setEnd(t.startContainer,t.startOffset),i=a.toString().length):(n=o.selection)&&"Control"!=n.type&&(n=n.createRange(),(o=o.body.createTextRange()).moveToElementText(e),o.setEndPoint("EndToEnd",n),i=o.text.length),i}function get_time_diff(e){var t=1e3*e,n=Date.now();if(t-=6e4*(new Date).getTimezoneOffset(),isNaN(t))return"";e=t<n?n-t:t-n;n=Math.floor(e/1e3/60/1440),e=new Date(e);if(5<n)return new Date(t).toDateString();var i,t="";return 0<n?(t+=n,t+=1<n?" days ago":" day ago"):0<e.getUTCHours()?(t+=i=e.getUTCHours(),t+=1<i?" hours ago":" hour ago"):0<(i=e.getUTCMinutes())?(t+=i,t+=1<i?" minutes ago":" minute ago"):(t+=e.getUTCSeconds(),t+=" seconds ago"),t}function changeClassString(e,t,n){var i=e.split(" "),o=i.indexOf(t);if(-1==o){if(n)return i.push(t),i.join(" ")}else if(!n)return i.splice(o,1),i.join(" ");return e}function changeClass(e,t,n){!e||(n=changeClassString(e.className,t,n))!=e.className&&(e.className=n)}function makeCurlyBrace(e,t,n,i,o,a){var s=e-n,r=t-i,l=Math.sqrt(s*s+r*r),d=e-.5*l*(s/=l)+o*(r/=l),c=t-.5*l*r-o*s;return"M "+e+" "+t+" Q "+(e+a*o*r)+" "+(t-a*o*s)+" "+(e-.25*l*s+(1-a)*o*r)+" "+(t-.25*l*r-(1-a)*o*s)+" T "+d+" "+c+" M "+n+" "+i+" Q "+(n+a*o*r)+" "+(i-a*o*s)+" "+(e-.75*l*s+(1-a)*o*r)+" "+(t-.75*l*r-(1-a)*o*s)+" T "+d+" "+c}function EdenScriptGutter(e,t,n){var a=this;this.lineelements=n,this.$gutter=$('<div class="eden-gutter"></div>');n="http://www.w3.org/2000/svg";this.brace=document.createElementNS(n,"svg"),this.brace.style.position="absolute",this.brace.style.display="none",this.brace.setAttribute("width","22"),this.brace.style.left="10px",this.bracepath=document.createElementNS(n,"path"),this.bracepath.setAttribute("style","stroke: #444; fill: none; stroke-width: 3px"),this.brace.appendChild(this.bracepath),this.gutter=this.$gutter.get(0),e.insertBefore(this.gutter,e.firstChild),e.insertBefore(this.brace,e.firstChild),this.ast=void 0,this.lines=[],this.errors=[],this.agents={},this.hovering=!1,this.ctx=void 0,this.edits=void 0;var o,s,r=!1,l=0,d=!1,c=!1;function u(){console.log("GUTTER HOLD"),o=void 0;for(var e=0;e<a.lines.length;e++)a.lines[e].selected&&(changeClass(a.gutter.childNodes[e],"select",!1),changeClass(a.gutter.childNodes[e],"live",!0),a.lines[e].selected=!1,a.lines[e].live=!0)}function i(e,t){var n,i;if(t&&r){if(n=a.ast.getStatementByLine(e)){(i=n.getRange())[0]<i[1]&&a.showBrace(i[0],i[1]);for(var o=i[0];o<=i[1];o++)a.lines[o].selected=!d,changeClass(a.gutter.childNodes[o],"select",!d),changeClass(a.gutter.childNodes[o],"hover",!1)}}else(n=a.ast.getStatementByLine(e))&&(i=n.getRange(),a.lines[e].live||t||changeClass(a.gutter.childNodes[e],"play",!0),a.selectLine(e+1,!0),a.hovering=!0)}function p(e,t){r&&!t&&(a.lines[e].selected=!d,changeClass(a.gutter.childNodes[e],"select",!d),changeClass(a.gutter.childNodes[e],"hover",!1),changeClass(a.gutter.childNodes[e],"play",!1)),r&&(t=!0),a.hovering=!1,clearTimeout(o),o=void 0;e=a.ast.getStatementByLine(e);if(e){var n=e.getRange();a.hideBrace();for(var i=n[0];i<=n[1];i++)changeClass(a.gutter.childNodes[i],"hover",!1),changeClass(a.gutter.childNodes[i],"play",!1)}}this.curline=-1,this.textwidth=getTextWidth("M","14px/20px Roboto Mono,monospace"),a.startHover=i,a.endHover=p,this.$gutter.on("mousedown",".eden-gutter-item",function(e){if(!this.edits&&!a.ast.hasErrors()){var t=parseInt(e.target.getAttribute("data-line"));s=e.shiftKey,l=t,d=!!a.lines[t]&&a.lines[t].selected,r=e.shiftKey,c=a.lines[t]&&a.lines[t].live;e=a.ast.getStatementByLine(t);if(e){var n=e.getRange();if(a.lines[t].live&&!s)if(a.lines[t].selected)for(i=0;i<a.lines.length;i++)a.lines[i].selected&&(a.lines[i].live=!1,changeClass(a.gutter.childNodes[i],"live",!1));else for(var i=n[0];i<=n[1];i++)a.lines[i].live=!1,changeClass(a.gutter.childNodes[i],"live",!1);else for(i=n[0];i<=n[1];i++)a.lines[i].selected=!s||!a.lines[i].selected,changeClass(a.gutter.childNodes[i],"select",a.lines[i].selected),changeClass(a.gutter.childNodes[i],"hover",!1)}o=setTimeout(u,1e3)}}).on("click",".eden-gutter-item",function(e){this.edits||(e=parseInt(e.target.getAttribute("data-line")),a.ast.getStatementByLine(e))}).on("mouseup",".eden-gutter-item",function(e){if(!this.edits){if(!a.ast.hasErrors()&&!s){var t=parseInt(e.target.getAttribute("data-line")),e=a.ast.getStatementByLine(t);if(!(e&&e.hasErrors()||a.lines[t].live||c))if(a.executeSelected(),!d)if(e=a.ast.getStatementByLine(l))for(var n=e.getRange(),i=n[0];i<=n[1];i++)a.lines[i].selected=!1,changeClass(a.gutter.childNodes[i],"select",!1)}clearTimeout(o),o=void 0,r=!1}}).on("mouseenter",".eden-gutter-item",function(e){a.ast.hasErrors()||i(parseInt(e.target.getAttribute("data-line")),e.shiftKey)}).on("mouseleave",".eden-gutter-item",function(e){p(parseInt(e.target.getAttribute("data-line")),e.shiftKey)})}CSSUtil={setStyle:function(e,t){e=e.style;if(void 0===t)e.cssText="";else if("object"==typeof t){var n=/([A-Z])/g;function i(e,t){return"-"+t.toLowerCase()}var o,a=/^\w*[A-Z]\w*$/,s="";for(o in t)"string"==typeof t[o]&&(s=s+(a.test(o)?o.replace(n,i):o)+": "+t[o]+";\n");e.cssText=s}else e.cssText=t},getStyle:function(e){for(var t=document.styleSheets,n=t.length-1;0<=n;n--)for(var i=t[n].cssRules,o=i.length-1;0<=o;o--)if(i[o].type==CSSRule.STYLE_RULE&&i[o].selectorText==e)return i[o].style;var a,s=document.getElementById("javascript-injected-styles");null===s&&(a=document.getElementsByTagName("body")[0],(s=document.createElement("style")).id="javascript-injected-styles",a.appendChild(s));s=s.sheet;return s.insertRule(e+"{ }",s.cssRules.length),s.cssRules[0].style}},EdenUI.plugins.ScriptInput=function(r,e){EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var l=this;$(document.body).delegate(null,"drop",function(e){if(void 0!==e.originalEvent.dataTransfer){var t=e.originalEvent.dataTransfer.getData("selector");if(!t||""==t)return console.log(e.originalEvent.dataTransfer.files),Eden.Project.loadFromFile(e.originalEvent.dataTransfer.files[0]),void e.preventDefault();t.sp;e=t.replace(/[^a-zA-Z0-9]+/g,"");eden.root.lookup("view_"+e+"_tabs").assign([t],eden.root.scope,EdenSymbol.hciAgent),r.createView(e,"ScriptInput"),eden.root.lookup("view_"+e+"_current").assign(0,eden.root.scope,EdenSymbol.hciAgent)}}).delegate(null,"dragover",function(e){e.preventDefault()}),this.createCommon=function(i,e,t,n){console.log("CREATING",i);var o=$('<div class="inputdialogcontent"><div class="agent-tabs handle"></div><div class="scriptsubcontent">\t<div class="inputhider">\t\t<div class="control-bar noselect">\t\t</div>\t</div></div><div class="info-bar"></div></div></div>'),a=o.find(".inputhider").get(0),s=o.find(".info-bar").get(0),r=o.find(".agent-tabs"),l=o.find(".control-bar"),d=r.get(0),c=l.get(0);$(s).hide();var u=new EdenUI.ScriptArea;a.appendChild(u.contents);var p=0,h=void 0;a.addEventListener("scroll",function(e){void 0!==h&&clearTimeout(h),document.activeElement!==u.outdiv&&(h=setTimeout(function(){h=void 0;var e=a.scrollTop;(e=Math.floor((e-50)/20))<0&&(e=0),50<=Math.abs(e-p)&&!u.disablehl&&(console.log("FORCE RE HIGHLIGHT",e),u.highlighter.setScrollTop(e),p=e,u.updateCachedHighlight(),u.gutter.clear())},100))});var g=-1,v=[],m=[],f={},b="view_"+i+"_current",y="view_"+i+"_showtabs",w="view_"+i+"_showbuttons",E="view_"+i+"_tabs",S="view_"+i+"_zoom",r="view_"+i+"_readonly",x=eden.root.lookup(E),I=(eden.root.lookup(S),eden.root.lookup(b)),y=eden.root.lookup(y),k=eden.root.lookup(w),r=eden.root.lookup(r),A=0,C=3,_=1;function T(e,t){t?(d.style.display="flex",a.parentNode.style.top="35px"):(d.style.display="none",a.parentNode.style.top="0")}function D(e,t){t?(c.style.display="flex",u.codearea.style.top="30px"):(c.style.display="none",u.codearea.style.top="0")}function M(e,t){u.setReadonly(t)}function L(){f[g]={selStart:u.intextarea.selectionStart,selEnd:u.intextarea.selectionEnd,scroll:a.scrollTop}}void 0===y.value()&&void 0===y.definition&&y.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),y.addJSObserver("scriptview_"+i,T),T(0,y.value()),void 0===k.value()&&void 0===k.definition&&k.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),k.addJSObserver("scriptview_"+i,D),D(0,k.value()),r.addJSObserver("scriptview_"+i,M),M(0,r.value());var U=!1;function N(e,t){"number"==typeof t&&0<=t&&t<m.length?(g!=t&&(L(),g=t,U=!0,u.setFragment(m[g]),u.fragment.originast&&u.fragment.originast.doxyComment&&u.fragment.originast.doxyComment.getProperty("nobuttons")&&(k.assign(!1,eden.root.scope,EdenSymbol.localJSAgent),console.log("DISABLE BUTTONS"))),B()):(B(),-1==t&&(L(),g=-1,u.setFragment(void 0),function(e){""==e&&(e="*");eden.root.lookup("view_"+i+"_query").value();u.outdiv.innerHTML="",function e(t,n){let i=document.createElement("DIV");let o=document.createElement("DIV");i.className="explore-entry";o.className="browse-entry";let a=document.createElement("SPAN");let s="&#xf0f6;";n===eden.project.ast.script?s="&#xf015;":0<n.lock?s="&#xf023;":"ACTIVE"===n.name&&(s="&#xf0e7;");a.innerHTML=s;a.className="browse-icon";0<n.executed&&(a.className+=" executed");o.appendChild(a);let r=document.createElement("SPAN");r.textContent=n instanceof Eden.AST.Alias?n.name+"  [external]":n.name;o.appendChild(r);o.setAttribute("data-path",Eden.Selectors.getID(n));i.appendChild(o);let l=Object.keys(n.subscripts);l.sort();for(var d of l){var c=n.subscripts[d];c.name&&c.subscripts&&e(i,c)}t.appendChild(i)}(u.outdiv,eden.project.ast.script)}(""))),O()}function P(e,t){if(Array.isArray(t)){var n=v;v=edenCopy(t);for(var i=m,o=i.filter(function(e){return-1==t.indexOf(e.selector)}),a=0;a<o.length;a++)o[a].destroy(),console.log("REMOVE FRAG",o[a].selector);m=[];for(a=0;a<t.length;a++){var s=n.indexOf(t[a]);0<=s?m.push(i[s]):m.push(new Eden.Fragment(t[a],()=>{N(0,I.value())}))}g=-2,N(0,I.value())}}function O(){var e,t;0<=g?(e='<button class="script-button script-run" title="Run the entire script"><span class="explorer-control-icon">&#xf04b;</span>Run</button>',eden.root.lookup("jseden_script_diffs").value()&&(e+='<button class="script-button script-changes" title="Show recent changes"><span class="explorer-control-icon">&#xf044;</span>Edits</button>'),(t=m[g])&&t.scratch&&!t.edited?e+='<span class="scratchsearch"><input type="text" class="scratchsearch" placeholder="Populate..."></input></span>':t&&t.scratch&&(e+='<span class="editname"><input type="text" class="editname" placeholder="Enter a name..."></input></span>'),l.html(e)):l.html("")}function B(){for(;d.firstChild;)d.removeChild(d.firstChild);var e=I.value(),t=document.createElement("div");t.className="agent-tab-more",t.innerHTML="<span class='tab-icon2'>&#xf0c9;</span>",d.appendChild(t),3<m.length&&0!=e&&((o=document.createElement("div")).className="agent-tableft noselect",d.appendChild(o));var n=document.createElement("div");n.className="agent-tab-container",d.appendChild(n),e<(A=A+(C-1)<e?e-(C-1):A)&&(A=e);for(var i=0;i<m.length;i++){m[i].getTitle();A<=i&&function(e,t,n,i){var o=document.createElement("div");o.style.left=160*i+"px";var a="agent-tab noselect";a+=n?" agent-tab-current handle":" agent-tab-notcurrent";var s=m[t].getTitle();18<s.length&&(s="..."+s.slice(-15)),i=m[t]&&m[t].ast?m[t].ast.errors&&0<m[t].ast.errors.length?"tab-icon errored":m[t].originast&&m[t].originast.executed?"tab-icon executed":"tab-icon":"tab-icon noagent",n="&#xf1ae;",m[t].remote?n="&#xf08e;":void 0===m[t].origin?n="&#xf0c3;":m[t].locked&&(n="&#xf023;"),o.className=a,o.innerHTML="<span class='"+i+"'>"+n+"</span>"+s+"<span class='close'>&#xf00d;</span>",o.draggable=!0,o.setAttribute("data-index",t),e.appendChild(o)}(n,i,i==e,i)}var o=document.createElement("div");o.className="agent-newtab noselect",o.style.left=160*m.length+20+"px",n.appendChild(o),3<m.length&&e!=m.length-1&&((a=document.createElement("div")).className="agent-tabright noselect",d.appendChild(a));var a=document.createElement("div");a.className="script-input-windowcontrols",a.innerHTML="<span class='windowcontrol'>&#xf00d;</span>",d.appendChild(a)}function V(e){return"view_"+i+"_"+e}I.addJSObserver("scriptview_"+i,N),x.addJSObserver("scriptview_"+i,P),P(0,x.value()),void 0===x.value()&&void 0===x.definition&&x.assign([],eden.root.scope,EdenSymbol.defaultAgent),void 0===I.value()&&void 0===I.definition&&I.assign(-1,eden.root.scope,EdenSymbol.defaultAgent),Eden.Fragment.listenTo("changed",u,function(t){var e;t===m[g]&&(void 0!==t.ast.then?t.ast.then(function(e){t.ast=e,B(),O(),u.refresh()}):(B(),O(),u.refresh()),U&&(U=!1,f.hasOwnProperty(g)&&(e=f[g],u.intextarea.focus(),u.intextarea.selectionStart=e.selEnd,u.intextarea.selectionEnd=e.selEnd,u.updateLineHighlight(),a.scrollTop=e.scroll)))}),Eden.Fragment.listenTo("locked",u,function(e){e===m[g]&&(console.log("LOCKED",e),N(0,I.value()))}),Eden.Fragment.listenTo("unlocked",u,function(e){e===m[g]&&N(0,I.value())}),Eden.Fragment.listenTo("errored",u,function(e){}),Eden.Fragment.listenTo("status",u,function(e){e===m[g]&&(B(),O())}),Eden.Fragment.listenTo("gotoline",u,function(e,t){for(var n=0;n<m.length;n++)if(e===m[n]){console.log("I have the goto frag"),g!=n&&I.assign(n,eden.root.scope,EdenSymbol.localJSAgent),u.gotoLine(t);var i=50+20*(t-5);i<0&&(i=0),a.scrollTop=i;break}}),void 0===eden.root.lookup("view_"+i+"_query").definition&&eden.execute("view_"+i+"_query is jseden_script_query;");r=[V("tabs"),V("current"),V("showtabs"),V("showbuttons"),V("zoom")];o.get(0).setAttribute("data-observables",r.join(",")),l.on("keyup","input.editname",function(e){m[g].name=e.target.value,B()}).on("change","input.editname",function(e){console.log("FINISH NAME",e.target.value),m[g].makeReal(e.target.value),(e=x.value())[g]=m[g].selector,x.assign(e,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".script-run",function(){0<=g&&m[g]&&(m[g].originast?(console.log("ONRUN",m[g].originast),m[g].ast.executeStatement(m[g].originast,eden.root.scope,m[g])):m[g].ast.execute(m[g],eden.root.scope),B())}).on("click",".script-changes",function(e){u.gutter.edits?(u.gutter.setDiffs(void 0),u.cachedhlopt=void 0,u.updateCachedHighlight()):u.makeDiff()}).on("click",".script-details",function(e){u.details.toggle()}).on("keyup","input.scratchsearch",function(e){e=e.target.value,console.log("SCRATCH SEARCH",e),Eden.Selectors.query(e,"innersource",{minimum:1,options:{index:!1}},function(e){u.intextarea.value=e.join("\n"),m[g].setSourceInitial(u.intextarea.value),u.highlighter.ast=u.fragment.ast,u.updateCachedHighlight()})}),o.on("click","button,.executable,a",function(e){(e=e.currentTarget.getAttribute("data-jseden"))&&""!=e&&(console.log(e),eden.execute2(e,{name:"execute"}))}).on("input","textarea,input",function(e){var t=e.currentTarget.getAttribute("name");t&&""!=t&&eden.root.lookup(t).assign(e.currentTarget.value,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".close",function(e){var t,n=parseInt(e.currentTarget.parentNode.getAttribute("data-index"));0<=n&&n<m.length&&((t=x.value()).splice(n,1),x.assign(t,eden.root.scope,EdenSymbol.localJSAgent),(n=I.value())>=t.length&&I.assign(n-1,eden.root.scope,EdenSymbol.localJSAgent)),e.stopPropagation()}).on("click",".agent-tab-more",function(){I.assign(-1,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".browse-entry",function(e){var t=e.currentTarget.getAttribute("data-path"),n=x.value();-1==(e=n.indexOf(t))?(n.push(t),x.assign(n,eden.root.scope,EdenSymbol.localJSAgent),I.assign(n.length-1,eden.root.scope,EdenSymbol.localJSAgent)):I.assign(e,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".agent-tab",function(e){e=e.currentTarget.getAttribute("data-index"),I.assign(parseInt(e),eden.root.scope,EdenSymbol.hciAgent),u.intextarea.focus()}).on("click",".agent-tableft",function(){var e=g;0<=--e&&I.assign(e,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".agent-tabright",function(){var e=g;++e<m.length&&I.assign(e,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".agent-newtab",function(){var e=x.value();e.push("scratch"+_),_++,x.assign(e,eden.root.scope,EdenSymbol.localJSAgent),I.assign(e.length-1,eden.root.scope,EdenSymbol.localJSAgent)}).on("dragstart",".agent-tab",function(e){var t=parseInt(e.target.getAttribute("data-index")),t=m[t].selector;e.originalEvent.dataTransfer.setData("selector",t),e.originalEvent.offsetX,e.originalEvent.offsetY}).on("dragend",".agent-tab",function(e){var t=parseInt(e.target.getAttribute("data-index")),t=m[t].selector;"none"!=e.originalEvent.dataTransfer.dropEffect&&(console.log("DRAGEND: "+t),console.log(e),0<=(t=(e=x.value()).indexOf(t))&&(e.splice(t,1),--t<0&&(t=0),e.length,x.assign(e,eden.root.scope,EdenSymbol.hciAgent)),e.length)}).on("dragover",function(e){e.preventDefault()}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.getData("selector");if(console.log("DROP"),console.log(e),t&&""!=t){var n=x.value();-1==n.indexOf(t)&&(n.push(t),x.assign(n,eden.root.scope,EdenSymbol.hciAgent))}else if(window.FileReader)for(var i=e.originalEvent.dataTransfer.files,o=0;o<i.length;o++){var a,s,r=i[o];r.name.match(/.*\.jse|.*\.js-e/)&&(a="local/file/"+(a=(a=r.name.slice(0,-4)).replace(/[\.\-\/\s]/g,"")),(s=new FileReader).onload=function(e){new Eden.Agent(void 0,a).setSource(e.target.result,!1,-1),agent.state[obs_agent]=a},s.readAsText(r))}});r={contents:o,update:function(t){var n;void 0===I.value()&&(n="view/script/"+i,Eden.Agent.importAgent(n,"default",["noexec","create"],function(e){agent.state[obs_agent]=n,t instanceof EdenSymbol?(agent.setScope(t.getValueScope(eden.root.scope)),intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(agent.code),updateEntireHighlight()):t instanceof Array?(intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(t),updateEntireHighlight()):"string"==typeof t&&(intextarea.value=t,updateEntireHighlight())}))},destroy:function(){console.log("CLOSE SCRIPT"),clearInterval(u.gutterinterval);for(var e=0;e<m.length;e++)m[e].unlock(),m[e].ast&&m[e].ast.destroy();scriptast=void 0,m=void 0,Eden.Fragment.unListen(u),u=void 0,I.removeJSObserver("scriptview_"+i),x.removeJSObserver("scriptview_"+i)},resize:function(e,t){t&&t.size&&(C=Math.floor((t.size.width-90)/160))},setValue:function(e){intextarea.value=e,updateEntireHighlight()}};return u.updateEntireHighlight(),r},this.createDialog=function(e,t,n){var i=e.slice(0,-7),o=l.createCommon(i,t,n,!1,!1),a=405;function s(e,t){return root.lookup("view_"+e+"_"+t)}return n&&(n=o.contents.find("textarea").val().split("\n").length,a=EdenUI.plugins.ScriptInput.getRequiredHeight(n+1)),o.contents.on("click",".windowcontrol",function(){r.hideView(i,!0)}),$dialog=$('<div id="'+e+'"></div>').html(o.contents).dialog({appendTo:"#jseden-views",title:t,width:600,height:a,minHeight:203,minWidth:300,classes:{"ui-dialog":"input-dialog ui-front no-print"},resizeStop:o.resize,draggable:!1}),$dialog.parent().draggable({handle:".handle",cancel:".agent-tab-notcurrent",stop:function(e,t){var n=eden.root;n.beginAutocalcOff(),s(i,"x").assign(t.position.left,eden.root.scope,EdenSymbol.hciAgent),s(i,"y").assign(t.position.top,eden.root.scope,EdenSymbol.hciAgent),n.endAutocalcOff()},start:function(e,t){if(s(i,"x").eden_definition||s(i,"y").definition)return!1}}),o.confirmClose=!1,o},this.createEmbedded=function(e,t,n){return l.createCommon(e,t,n,!0)},r.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:r.viewCategories.interpretation,menuPriority:0},r.history=this.history,e()},EdenUI.plugins.ScriptInput.getRequiredHeight=function(e,t){return t?55+20*e+20:45+20*e+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog script-subdialog-newagent noselect"><span class="script-subdialog-title">Create Tab:</span><div class="script-subdialog-panel"><button>Scratch</button></div><div class="script-subdialog-panel"><input class="namebox" type="text" spellcheck="false" placeholder="New Tab"></input><button class="button-new">New</button></div><div class="script-subdialog-panel"><input type="text" class="searchbox" spellcheck="false" placeholder="Search"></input><button class="button-search">Load</button><br/></div></div>'),o=i.find(".searchbox").get(0),a=i.find(".namebox").get(0);i.on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),i.on("click",".button-search",function(){e.get(0).removeChild(n.get(0)),t(!0,o.value)}),i.on("click",".button-new",function(){eden.project.addAction(a.value),e.get(0).removeChild(n.get(0)),t(!0,"."+a.value)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.localChanges=function(e,t,n){EdenUI.plugins.ScriptInput.dialogs.hide&&EdenUI.plugins.ScriptInput.dialogs.hide();var i=$('<div class="script-obscurer noselect"></div>'),n=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-text">You have local changes to '+n.name+', use these?</span><br><br><button class="button-icon-green button-ok">Yes</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">No</button></div>');n.on("click",".button-ok",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!1)}),i.append(n),e.append(i),EdenUI.plugins.ScriptInput.dialogs.hide=function(){EdenUI.plugins.ScriptInput.dialogs.hide=void 0,e.get(0).removeChild(i.get(0)),t(!1)}},EdenUI.plugins.ScriptInput.dialogs.uploadFailed=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload Failed! Try again...</span><br><br><button class="button-icon-green button-upload">Retry</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>');i.on("click",".button-upload",function(){e.get(0).removeChild(n.get(0)),t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.uploadAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload agent. Give an optional version name:</span><br/><input class="script-subdialog-text tagname" type="text" spellcheck="false"></input><span class="status missing"></span><br><input class="script-subdialog-check makepublic" type="checkbox">Public</input><br><br><button class="button-icon-green button-upload">Upload</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>'),o=i.find(".tagname"),a=i.find(".makepublic"),s=o.get(0).nextSibling,r=!0;i.on("input blur",".script-subdialog-text",function(){var e=o.get(0).value;console.log(e),""==e?(r=!0,s.className="addnew"):r=/^[a-z][a-z0-9]+$/i.test(e)?(s.className="addnew",!0):!(s.className="invalid")}).on("click",".button-upload",function(){r&&(e.get(0).removeChild(n.get(0)),t(!0,o.get(0).value,a.get(0).checked))}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(e,t,r){var l,n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),d=i.find(".script-history-list"),c=r.index,u=r.meta.saveID;function p(e){if(r.history[e])for(var t=r.history[e].length-1;0<=t;t--){var n=$('<div class="script-history-item"></div>');c==t&&(n.addClass("current"),n.addClass("original"),l=n),n.get(0).setAttribute("data-index",""+t);var i=$('<div class="script-history-bookmark"></div>'),o=$('<div class="script-history-time"></div>'),a=$('<div class="script-history-content"></div>');o.html(get_time_diff(r.history[e][t].time)),o.get(0).title=r.history[e][t].time,r.history[e][t].bookmark&&i.addClass("bookmarked"),r.history[e][t].title?a.html(r.history[e][t].title):a.html("[Autosave]"),n.append(i),n.append(a),n.append(o),d.append(n)}}function o(s){var e,t,n;Eden.DB.getVersions(r.name,function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=$('<div class="script-history-item"></div>');e[t].saveID==u&&(n.addClass("original"),-1==c&&(n.addClass("current"),l=n)),n.get(0).setAttribute("data-version",""+e[t].saveID);var i="script-history-stored";0==e[t].public?i+=" private":e[t].mine?i+=" mine":i+=" public";var o=$('<div class="'+i+'"></div>'),a=e[t].date.split(/[- :]/),i=$('<div class="script-history-time">'+get_time_diff(new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5]).getTime()/1e3)+"</div>"),a=e[t].tag;null==e[t].tag&&(a=e[t].saveID);a=$('<div class="script-history-content">'+a+" ("+e[t].saveID+") by "+e[t].name+"</div>");n.append(o),n.append(a),n.append(i),d.append(n),e[t].saveID==u&&p(s)}}),r.history.origin&&(e=$('<div class="script-history-item"></div>'),"origin"==u&&(e.addClass("original"),-1==c&&(e.addClass("current"),l=e)),e.get(0).setAttribute("data-version","origin"),t=$('<div class="script-history-bookmark"></div>'),n="origin",r.meta&&r.meta.file&&(n=r.meta.file),n=$('<div class="script-history-content">'+n+"</div>"),e.append(t),e.append(n),d.append(e),"origin"==u&&p("origin"))}o(r.meta.saveID),i.on("input",".script-history-content",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));r.history[r.meta.saveID][t].title=e.target.textContent,r.saveHistory(),r.makeSnapshot(t)}).on("click",".script-history-item",function(e){var t=e.currentTarget.getAttribute("data-version");t?("origin"!=t&&(t=parseInt(t)),u=t,function(){for(var e=d.get(0);e.firstChild;)e.removeChild(e.firstChild);l=void 0}(),c=-1,o(u)):(t=parseInt(e.currentTarget.getAttribute("data-index")),c=t,l&&l.removeClass("current"),(l=$(e.currentTarget)).addClass("current"))}).on("click",".script-history-bookmark",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));void 0===r.history[r.meta.saveID][t].bookmark?r.history[r.meta.saveID][t].bookmark=!0:r.history[r.meta.saveID][t].bookmark=!r.history[r.meta.saveID][t].bookmark,r.saveHistory(),r.history[r.meta.saveID][t].bookmark?e.target.className="script-history-bookmark bookmarked":e.target.className="script-history-bookmark"}).on("click",".button-ok",function(){e.get(0).removeChild(n.get(0)),console.log("Rollback to: "+c+"@"+u),t(!0,c,u)}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.browseAgents=function(e,t,h){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-agents noselect"><span class="script-subdialog-title">'+Language.ui.input_window.browse_agents+':</span><br/><div class="script-agents-list"></div><div class="script-agents-buttons"><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),g=i.find(".script-agents-list"),o=0,a={};function s(c,u,p){Eden.DB.getDirectory(p,function(e){if(void 0!==e){var t,n=[];for(t in e)n.push(t);n.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});for(var i=0;i<n.length;i++){var o=""==p?n[i]:p+"/"+n[i],a=n[i],s=$('<div class="script-agents-item"></div>'),r=$('<div class="script-agents-expand" style="width: '+(27+15*u)+'px"></div>'),l=$('<div class="script-agents-content"></div>'),d=$('<div class="script-agents-cbcont"></div>');!function(o,e,a,s,t){Eden.DB.getMeta(e,function(e,t){var n,i;t?(n="",t.date&&(i=t.date.split(/[- :]/),n=get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)),"Script View"!=(i=t.title)&&void 0!==i||(i=""),o.html(a+' <span class="script-agents-title">'+i+'</span><span class="script-agents-date">'+n+"</span>"),t.remote&&-1==t.defaultID&&-1==t.latestID?s.html("&nbsp;"):(t=$('<input type="checkbox"></input>'),s.append(t),0<=h.indexOf(e)&&(t.get(0).checked=!0))):(o.html(a),s.html("&nbsp;"))})}.call(this,l,o,a,d,r),Eden.Agent.agents[o]&&s.addClass("loaded"),s.get(0).setAttribute("data-path",o),s.get(0).setAttribute("data-depth",""+(u+1)),s.append(r),s.append(d),s.append(l),void 0===c||void 0===c.nextSibling?g.append(s):g.get(0).insertBefore(s.get(0),c.nextSibling)}}})}return s(void 0,0,""),i.on("click",".script-agents-item",function(e){}).on("click",".script-agents-expand",function(e){var t=e.currentTarget.parentNode.getAttribute("data-path"),n=parseInt(e.currentTarget.parentNode.getAttribute("data-depth"));e.currentTarget.className.indexOf("expanded")<0?(s(e.currentTarget.parentNode,n,t),changeClass(e.currentTarget,"expanded",!0)):(function(e){for(var t=parseInt(e.getAttribute("data-depth")),n=e.nextSibling;n;){if(!(t<parseInt(n.getAttribute("data-depth"))))break;var i=n.nextSibling;g.get(0).removeChild(n),n=i}}(e.currentTarget.parentNode),changeClass(e.currentTarget,"expanded",!1))}).on("change",".script-agents-cbcont input",function(e){var t=e.currentTarget.parentNode.parentNode.getAttribute("data-path");e.currentTarget.checked?a[t]=!0:a[t]=!1}).on("click",".button-add",function(){o=g.scrollTop(),e.get(0).removeChild(n.get(0)),t(!0,a)}).on("click",".button-cancel",function(){o=g.scrollTop(),e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),{show:function(){e.append(n),g.scrollTop(o)}}},EdenScriptGutter.prototype.clear=function(){for(this.ast=void 0,this.lines=[],this.curline=-1,this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild)},EdenScriptGutter.prototype.setBaseAST=function(e,t){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);this.ast=e,this.errors=t,this.lines=[],this.edits=void 0,this.hideBrace()},EdenScriptGutter.prototype.executeSelected=function(){if(void 0!==this.ast)for(var e,t,n=0;n<this.lines.length;n++)this.lines[n].selected&&(e=this.ast.getStatementByLine(n),t=this.ast.getStatementByLine(n).getRange(),eden.project.ast.executeStatement(e,eden.root.scope,eden.project),n=t[1],eden.root.lookup("jseden_fragment_executed").assign(".id("+e.id+")",eden.root.scope,EdenSymbol.hciAgent))},EdenScriptGutter.prototype.showBrace=function(e,t){this.brace.style.display="block";e=this.lineelements.childNodes[e].offsetTop;this.brace.style.top=e+"px";t=this.lineelements.childNodes[t].offsetTop+this.lineelements.childNodes[t].clientHeight;t-=e,this.brace.setAttribute("height",""+t),this.bracepath.setAttribute("d",makeCurlyBrace(20,4,20,t-4,20,.52))},EdenScriptGutter.prototype.hideBrace=function(){this.brace.style.display="none"},EdenScriptGutter.prototype.selectLine=function(e,t){var n,i,o;this.edits||0<this.ast.errors.length||(0<=this.curline&&(n=this.ast.getStatementByLine(this.curline))&&(i=n.getRange(),o=Math.floor((i[1]-i[0])/2)+i[0],t||(changeClass(this.gutter.childNodes[o],"play",!1),changeClass(this.gutter.childNodes[o],"current",!1))),this.curline=e-1,(n=this.ast.getStatementByLine(e-1))&&(n.getRange||console.error("NO GETRANGE",n),(i=n.getRange())[0]<i[1]?this.showBrace(i[0],i[1]):(this.hideBrace(),n&&(o=Math.floor((i[1]-i[0])/2)+i[0],changeClass(this.gutter.childNodes[o],"play","true"),t||changeClass(this.gutter.childNodes[o],"current","true")))))},EdenScriptGutter.prototype.setDiffs=function(e){this.edits=e;if(console.log(e,this.ast),void 0!==e){this.hideBrace();for(var t=0,n=0,i=this.lines.length+Object.keys(e.remove).length,o=!1,a=0;a<i;a++){if(e.remove[n]&&e.remove[n].nline<=t){var s="eden-gutter-item removed";(d=this.gutter.childNodes[a]).className=s,d.textContent=e.remove[n].rline;for(var r=e.remove[n].chars,l=0;l<r.length;l++)(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(255,0,0,0.3)",u.style.height="20px",u.style.width=r[l].length*this.textwidth+"px",u.style.top="0px",u.style.left=r[l].start*this.textwidth+43+"px",d.appendChild(u);if(!e.remove[n].partial){n++;continue}n++,o=!0}var d=this.gutter.childNodes[a],s="eden-gutter-item";if(o||e.insert[t]){s+=" inserted";var c=!1;if(e.insert[t])for(var u,r=e.insert[t].chars,l=0;l<r.length;l++)(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(0,255,0,0.3)",u.style.height="20px",u.style.width=r[l].length*this.textwidth+"px",c=c||0==r[l].length&&!e.insert[t].partial,u.style.top="0px",u.style.left=r[l].start*this.textwidth+53+"px",d.appendChild(u);e.insert[t]&&e.insert[t].partial&&!o&&n++}else n++;o=!1,d.className=s,d.setAttribute("data-line",""+t),t++,void 0===this.lines[t]&&(this.lines[t]={selected:!1,live:!1})}}},EdenScriptGutter.prototype.updateLine=function(e,t){var n="eden-gutter-item",i=this.ast,o="",a=t,s=void 0,t=i.getStatementByLine(e);t?(0<t.errors.length?(t.errors[0].line==e+1?(n+=" error",o="&#xf06a",s=t.errors[0].messageText()):"runtime"==t.errors[0].type&&(n+=" error",o="&#xf06a",s=t.errors[0].messageText()),a=this.lines[e].errored=!0):(0<i.errors.length&&i.errors[0].line==e+1&&(this.lines[e].errored=!0,n+=" error",o="&#xf06a",s=i.errors[0].messageText()),this.lines[e].errored&&(a=!0,this.lines[e].errored=!1),t.warning&&(n+=" warning",o="&#xf071",a=!0,t.warning&&(s=t.warning.messageText())),1==t.executed?(n+=" executed",a=!0,this.lines[e].executed=!0):2==t.executed?(n+=" guarded",a=!0,this.lines[e].executed=!0):3==t.executed?(n+=" errorblock",a=!0):"section"!=t.type&&(n+=" unexecuted",a=!0)),this.lines&&this.lines[e]&&(this.lines[e].executed&&t.executed<=0&&(a=!0,this.lines[e].executed=!1),this.lines[e].selected&&(n+=" select"),this.lines[e].live&&(n+=" live"))):(this.errors&&0<this.errors.length&&this.errors[0].line==e+1?this.lines[e].errored||(n+=" error",o="&#xf06a",s=this.errors[0].messageText(),a=this.lines[e].errored=!0):this.lines[e].errored&&(a=!0,this.lines[e].errored=!1,s=""),this.lines[e].executed&&(a=!0,this.lines[e].executed=!0)),a&&(0<=this.gutter.childNodes[e].className.indexOf("hover")&&(n+=" hover"),0<=this.gutter.childNodes[e].className.indexOf("play")&&(n+=" play"),0<=this.gutter.childNodes[e].className.indexOf("current")&&(n+=" current"),this.gutter.childNodes[e].innerHTML=o,this.gutter.childNodes[e].className=n,s&&(this.gutter.childNodes[e].title=s))},EdenScriptGutter.prototype.generate=function(e,t){if(this.ast=e,!this.edits){var n=!1,i=e.getNumberOfInnerLines()+1;if((i=i>this.lineelements.childNodes.length?this.lineelements.childNodes.length:i)!=this.gutter.childNodes.length){for(this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(var o=0;o<i;o++){var a=document.createElement("div");a.className="eden-gutter-item",a.setAttribute("data-line",""+o),a.style.height=this.lineelements.childNodes[o].clientHeight+"px",this.gutter.appendChild(a),void 0===this.lines[o]&&(this.lines[o]={selected:!1,live:!1,executed:!1,errored:!1})}n=!0}for(o=0;o<i;o++)this.updateLine(o,n);0<this.ast.errors.length?this.hideBrace():this.hovering||this.selectLine(t)}},EdenUI.ScriptArea=function(){this.contents=document.createElement("div"),this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contenteditable=!0,this.outdiv.className="outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.fragment=void 0,this.readonly=!1,this.readonlycomment=!1,this.alwaysreadonly=!1,this.currentlineno=-1,this.currentcharno=-1,this.gotomode=!1,this.highlighter=new EdenUI.Highlight(this.outdiv),this.gutter=new EdenScriptGutter(this.codearea,this.infobox,this.outdiv),this.details=new EdenUI.ScriptArea.Details(this),this.cachedhlopt=void 0,this.disablehl=!1,this.highlighter.setScrollTop(0);var a=this;this.gutterinterval=setInterval(function(){if(void 0!==a.fragment&&void 0!==a.fragment.ast)for(var e in a.gutter.generate(a.fragment.ast.script,a.currentlineno),a.highlighter.metrics)if(a.currentlineno!=e){var t=a.highlighter.metrics[e];if(t.query)for(var n=0;n<t.qelements.length;n++){var i=t.qelements[n].getAttribute("data-query"),o=t.qelements[n].getAttribute("data-attribs");!function(t){Eden.Selectors.query(i,null!==o&&0<o.length?o:"value",{minimum:0,options:{local:!0}},e=>{e=1==e.length?e[0]:1<e.length?e.join(", "):"",t.setAttribute("data-result",e)})}(t.qelements[n])}t.squery&&t.styleUpdate()}},300);new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.rebuildinterval=400},EdenUI.ScriptArea.prototype.setReadonly=function(e){!0===(this.alwaysreadonly=e)?(this.readonly=!0,this.outdiv.contentEditable=!1):(this.readonly=!!this.fragment&&this.fragment.locked,this.outdiv.contentEditable=!this.readonly,"comment"==e&&(this.readonlycomment=!0,this.updateEntireHighlight()))},EdenUI.ScriptArea.prototype.setFragment=function(e){if(this.fragment&&this.fragment!==e&&(this.fragment.unlock(),this.currentlineno=-1),this.details.hide(),void 0===(this.fragment=e))return this.gutter.clear(),changeClass(this.outdiv,"browser",!0),this.outdiv.contentEditable=!1,void(this.readonly=!0);var t=this;e.reset(function(){changeClass(t.outdiv,"browser",!1),t.intextarea.value=e.getSource(),e.ast&&(t.highlightContent(-1,0),t.intextarea.focus(),t.checkScroll(),t.gutter.setBaseAST(e.ast.script)),e.locked?(t.readonly=!0,t.outdiv.contentEditable=!1):(t.readonly=!0===t.alwaysreadonly,t.outdiv.contentEditable=!t.readonly)})},EdenUI.ScriptArea.prototype.refresh=function(){this.intextarea.value=this.fragment.getSource(),this.fragment.ast&&this.highlightContent(-1,0)},EdenUI.ScriptArea.prototype.updateSource=function(e,t){this.fragment.setSource(e),this.fragment.ast&&(this.gutter.errors=this.fragment.ast.errors),this.highlighter.ast=this.fragment.ast},EdenUI.ScriptArea.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.updateSource(this.intextarea.value,e),this.runScript(e),this.highlightContent(e,t)},EdenUI.ScriptArea.prototype.runScript=function(e){this.gutter.lines[e-1]&&this.gutter.lines[e-1].live&&!this.fragment.ast.hasErrors()&&(e=this.fragment.ast.script.getStatementByLine(e-1),this.fragment.ast.executeStatement(e,eden.root.scope,this.fragment))},EdenUI.ScriptArea.prototype.hideInfoBox=function(){},EdenUI.ScriptArea.prototype.updateLineCachedHighlight=function(){var e,t;this.fragment&&(t=e=-1,document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(e,t))},EdenUI.ScriptArea.prototype.updateEntireHighlight=function(e,t){var n;void 0!==this.fragment&&(this.cachedhlopt=t,this.updateSource(this.intextarea.value,-1),n=-1,document.activeElement===this.intextarea&&(n=this.intextarea.selectionEnd),e&&runScript(0),this.highlightContent(-1,n,t))},EdenUI.ScriptArea.prototype.updateCachedHighlight=function(e){var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),this.highlightContent(-1,t,e||this.cachedhlopt)},EdenUI.ScriptArea.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;return parseInt(t.getAttribute("data-line"))},EdenUI.ScriptArea.prototype.replaceLine=function(e,t){var n=this.intextarea.value.split("\n");n[e]=t,this.intextarea.value=n.join("\n")},EdenUI.ScriptArea.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.ScriptArea.prototype.focusText=function(){var e,t;this.readonly||(e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv),this.intextarea.focus(),this.intextarea.selectionEnd=e,(this.intextarea.selectionStart=t)!=e&&(this.refreshentire=!0))},EdenUI.ScriptArea.prototype.toggleHighlighting=function(){this.disablehl=!this.disablehl,this.updateEntireHighlight(),this.gutter.clear()},EdenUI.ScriptArea.prototype.highlightContent=function(e,t,n){if(this.fragment){var i=this.fragment.ast;if(i){if(void 0===n&&this.disablehl&&(n={}),this.disablehl&&(n.disabled=!0),this.highlighter.highlight(i,e,t,n),document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret"),"comment"==this.alwaysreadonly)for(var o=$(this.outdiv).find(".eden-comment-line"),a=0;a<o.length;a++)o[a].contentEditable=!1;this.delayRebuild()}}},EdenUI.ScriptArea.prototype.moveCaret=function(){this.updateLineCachedHighlight(),this.checkScroll()},EdenUI.ScriptArea.prototype.selectAll=function(){this.outdiv.focus();var e=document.createRange();e.selectNodeContents(this.outdiv);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},EdenUI.ScriptArea.prototype.makeNumbersDrag=function(){var i=this;this.readonly||$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(e,t){var n;i.readonly||(n=i.dragint?Math.round(i.dragvalue+(t.position.left-i.dragstart)/2):(n=i.dragvalue+.005*(t.position.left-i.dragstart)).toFixed(4))!=i.draglast&&(i.draglast=n,e.target.innerHTML=""+n,"\n"==(e=e.target.parentNode.textContent).charAt(e.length-1)&&(e=e.slice(0,-1)),i.replaceLine(i.dragline,e),i.updateSource(i.intextarea.value,i.dragline),i.runScript(i.dragline+1),i.highlightContent(i.dragline,-1))},start:function(e,t){i.readonly||(i.edited=!0,i.dragline=i.findElementLineNumber(e.target),i.dragstart=t.position.left,-1==(t=e.target.textContent).indexOf(".")?(i.dragvalue=parseInt(t),i.dragint=!0):(i.dragvalue=parseFloat(t),i.dragint=!1),i.draglast=i.dragvalue,$(e.target).addClass("eden-select"),$(i.outdiv).css("cursor","ew-resize"))},stop:function(e,t){i.readonly||($(e.target).removeClass("eden-select"),$(i.outdiv).css("cursor","text"),i.dragline=-1)},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptArea.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.ScriptArea.prototype.gotoLine=function(e){var t=this.intextarea.value.split("\n");t.length=e+1;t=t.join("\n").length;this.intextarea.focus(),this.intextarea.selectionEnd=t,this.intextarea.selectionStart=t,this.updateLineCachedHighlight()},EdenUI.ScriptArea.prototype.checkScroll=function(){var e=$(this.outdiv.childNodes[this.currentlineno-1]).find(".fake-caret").get(0);if(void 0!==e){for(var t=this.contents.parentNode,n=e.offsetLeft-t.scrollLeft+25,i=t.clientWidth+t.scrollLeft-e.offsetLeft-25;e.parentNode!=this.outdiv;)e=e.parentNode;var o=e.offsetTop-t.scrollTop+15,a=t.clientHeight+t.scrollTop-e.offsetTop-15;n<80&&(t.scrollLeft=t.scrollLeft-(80-n)),i<80&&(t.scrollLeft=t.scrollLeft+(80-i)),o<40&&(t.scrollTop=t.scrollTop-(40-o)),a<40&&(t.scrollTop=t.scrollTop+(40-a))}},EdenUI.ScriptArea.prototype.setCaretToFakeCaret=function(){var e,t,n=$(this.outdiv).find(".fake-caret").get(0);n&&(e=document.createRange(),t=window.getSelection(),n.nextSibling&&(n=n.nextSibling),e.setStart(n,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),$(this.outdiv).remove(".fake-caret"))},EdenUI.ScriptArea.prototype.makeDiff=function(){var e,t={},n=this.fragment.diff();for(e in n.remove)if(!n.remove[e].consecutive){for(var i=parseInt(e),o=0,a=20;a+=20,o++,n.remove[i+o]&&n.remove[i+o].consecutive;);t[n.remove[e].nline+0]=a}this.gutter.setDiffs(n),this.cachedhlopt={spacing:t},this.updateCachedHighlight()},EdenUI.ScriptArea.prototype.doRebuild=function(){this.makeNumbersDrag()},EdenUI.ScriptArea.prototype.delayRebuild=function(){var e=this;clearTimeout(this.rebuildtimer),this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptArea.prototype.rebuild=function(){this.gutter.edits?(this.updateSource(this.intextarea.value,-1),this.gutter.ast=this.fragment.ast,this.makeDiff()):(this.edited=!0,this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight(),this.checkScroll(),this.dirty=!1)},EdenUI.ScriptArea.prototype.enableGotoMode=function(){this.gotomode||(this.outdiv.contentEditable=!1,changeClass(this.outdiv,"goto",!0),this.gotomode=!0)},EdenUI.ScriptArea.prototype.disableGotoMode=function(){this.gotomode&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv,"goto",!1),this.gotomode=!1)},EdenUI.ScriptArea.prototype.insertTab=function(){var e=this.intextarea.selectionStart,t=this.intextarea.selectionEnd;this.intextarea.value=this.intextarea.value.substring(0,e)+"\t"+this.intextarea.value.substring(t),this.intextarea.selectionStart=this.intextarea.selectionEnd=e+1,this.rebuild()},EdenUI.ScriptArea.Details=function(e){this.scriptarea=e,this.contents=document.createElement("div"),this.contents.className="script-details",this.contents.addEventListener("keyup",function(e){var t=e.target.parentNode.getAttribute("data-name"),e=e.target.value;console.log("CHANGE PROP",t,e)}),this.visible=!1},EdenUI.ScriptArea.Details.prototype.addProperty=function(e,t,n,i){var o=document.createElement("div");o.className="script-details-prop",o.setAttribute("data-name",e);e=document.createElement("div");e.className="script-details-label",e.textContent=t,o.appendChild(e);e=document.createElement("input");e.className="script-details-value",e.value=n||"",e.setAttribute("type","text"),i&&i.readonly&&(e.className+=" script-details-readonly",e.setAttribute("readonly","true")),o.appendChild(e);e=document.createElement("div");return e.className="script-details-status",i&&i.readonly?e.innerHTML="&#xf023;":e.innerHTML="&#xf00c;",o.appendChild(e),this.contents.appendChild(o),o},EdenUI.ScriptArea.Details.prototype.clear=function(){for(;this.contents.lastChild;)this.contents.removeChild(this.contents.lastChild)},EdenUI.ScriptArea.Details.prototype.addButtons=function(){var e=document.createElement("div");e.className="script-details-buttons";var t=document.createElement("button");t.className="script-button",t.innerHTML='<span class="explorer-control-icon">&#xf00d;</span>Close',e.appendChild(t),this.contents.appendChild(e)},EdenUI.ScriptArea.Details.prototype.show=function(){this.clear(),this.addProperty("name","Name",this.scriptarea.fragment.name),this.addProperty("selector","Path",this.scriptarea.fragment.selector,{readonly:!0}),this.scriptarea.fragment.originast&&this.addProperty("id","Full Name",Eden.Selectors.getID(this.scriptarea.fragment.originast),{readonly:!0});var e=this.scriptarea.fragment.doxy;if(e){this.addProperty("desc","Description",e.stripped()),this.addProperty("tags","Tags",e.getHashTags().join(" "));var t,n=e.getControls();for(t in n)this.addProperty(t,t.substring(1),n[t])}this.addButtons(),this.scriptarea.codearea.appendChild(this.contents),changeClass(this.scriptarea.outdiv,"blur",!0),this.visible=!0},EdenUI.ScriptArea.Details.prototype.hide=function(){this.visible&&(this.scriptarea.codearea.removeChild(this.contents),this.visible=!1,changeClass(this.scriptarea.outdiv,"blur",!1))},EdenUI.ScriptArea.Details.prototype.toggle=function(){this.visible?this.hide():this.show()},EdenUI.ScriptArea.Keyboard=function(n){function i(e){var t=e.key;return e.shiftKey&&(t="Shift-"+t),e.altKey&&(t="Alt-"+t),t=e.ctrlKey||e.metaKey?"Ctrl-"+t:t}n.intextarea.addEventListener("input",function(e){n.dirty=!0,n.rebuild()}),n.intextarea.addEventListener("keydown",function(e){switch(i(e)){case"Tab":e.preventDefault(),n.insertTab();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":n.moveCaret();break;case"Ctrl-a":n.selectAll(),e.preventDefault();break;case"Ctrl-h":n.toggleHighlighting(),e.preventDefault();break;case"Ctrl-Shift-ArrowLeft":case"Ctrl-Shift-ArrowRight":case"Ctrl-Shift-ArrowUp":case"Ctrl-Shift-ArrowDown":case"Ctrl-Shift-Home":case"Ctrl-Shift-End":case"Shift-ArrowLeft":case"Shift-ArrowRight":case"Shift-ArrowUp":case"Shift-ArrowDown":case"Shift-Home":case"Shift-End":n.focusOutput();break;case"Backspace":n.refreshentire=10==n.intextarea.value.charCodeAt(n.intextarea.selectionStart-1);break;case"Enter":n.refreshentire=!0;break;case"Ctrl-Control":n.enableGotoMode()}}),n.intextarea.addEventListener("keyup",function(e){var t=i(e);switch(e.ctrlKey||n.disableGotoMode(),t){case"Ctrl-Control":n.disableGotoMode();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":n.updateLineCachedHighlight(),n.gutter&&n.gutter.selectLine(n.currentlineno),n.checkScroll()}}),n.intextarea.addEventListener("paste",function(e){n.refreshentire=!0}),n.outdiv.addEventListener("keydown",function(e){"INPUT"!=e.target.nodeName&&"textarea"!=e.target.nodeName&&(e.shiftKey&&(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||35==e.keyCode||36==e.keyCode)||"Control"==e.key||"Shift"==e.key||"c"==e.key||n.focusText(),"Ctrl-h"===i(e)&&(n.toggleHighlighting(),e.preventDefault(),n.focusOutput()))}),n.outdiv.addEventListener("keyup",function(e){"INPUT"!=e.target.nodeName&&"textarea"!=e.target.nodeName&&(17!=e.keyCode&&91!=e.keyCode&&92!=e.keyCode||n.disableGotoMode())}),n.outdiv.addEventListener("paste",function(e){n.focusText()}),n.intextarea.addEventListener("blur",function(e){$(n.outdiv).find(".fake-caret").remove()}),n.intextarea.addEventListener("focus",function(e){})},EdenUI.ScriptArea.Mouse=function(r){r.outdiv.addEventListener("mouseup",function(e){if("INPUT"!=e.target.nodeName&&"textarea"!=e.target.nodeName){if(r.hideInfoBox(),r.readonlycomment){for(var t=!1,n=!1,i=0;i<e.path.length;++i)"BUTTON"!=e.path[i].nodeName&&"A"!=e.path[i].nodeName||(t=!0),e.path[i].classList&&e.path[i].classList.contains("eden-comment-line")&&(n=!0);if(0<$(e.target).find(".eden-comment-line").length||n)return t||e.preventDefault(),r.intextarea.blur(),void r.outdiv.blur()}var o,a,s;r.readonly||0==e.target.isContentEditable||(r.gotomode?("eden-selector"==(o=""==(o=e.target).className&&"SPAN"==o.parentNode.nodeName?o.parentNode:o).className||"eden-selector2"==o.className?(r.disableGotoMode(),a=o.parentNode.textContent,Eden.Selectors.goto(a)):"eden-observable"==o.className&&(s=o.getAttribute("data-observable"),Eden.Selectors.goto(s+":active")),e.preventDefault()):document.activeElement===r.outdiv&&(s=getCaretCharacterOffsetWithin(r.outdiv),getStartCaretCharacterOffsetWithin(r.outdiv)!=s?r.refreshentire=!0:(r.intextarea.focus(),r.intextarea.selectionEnd=s,r.intextarea.selectionStart=s,r.currentlineno,r.updateLineCachedHighlight())))}}),r.outdiv.addEventListener("mousedown",function(e){r.readonly})},EdenUI.plugins.PluginManager=function(d,e){this.createDialog=function(e,t){function n(e){return d.plugins[e]?"(loaded)":"(not loaded)"}var i=$('<div class="projectlist-results noselect"></div>');pluginNames=Object.keys(EdenUI.plugins).sort(function(e,t){var n=d.plugins[e],i=d.plugins[t];return n&&!i?1:i&&!n||e<t?-1:e==t?0:1});for(var o=0;o<pluginNames.length;o++){var a=pluginNames[o],s=EdenUI.plugins[a],r='<div class="projectlist-result-element'+(a in d.plugins?" pluginmanager-loaded":"")+'"><div class="projectlist-result-name">'+s.title+"</div><div class='projectlist-result-metadata'>"+s.description+"</div>";void 0!==s.originalAuthor&&(r=r+"<div class='projectlist-result-metadata'>Original version by "+s.originalAuthor+"</div>"),r=(r=void 0!==s.author?r+"<div class='projectlist-result-metadata'>"+(void 0===s.originalAuthor?"By ":"Built on by ")+s.author+"</div>":r)+'<div class="pluginlist-loaded projectlist-result-metadata">'+n(a)+"</div></div>",$(r).click(function(t){return function(){var e=$(this);d.loadPlugin(t,function(){d.plugins[t]&&(e.find(".pluginlist-loaded").html(n(t)),e.addClass("pluginmanager-loaded",100)),d.menu.updateViewsMenu()})}}(a)).appendTo(i)}var l=$('<div class="projectlist-listing"></div>');l.append(i),$dialog=$('<div id="'+e+'"></div>').html(l).dialog({title:t,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},d.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:d.viewCategories.environment,name:"plugins"},e()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.Canvas2D=function(I,e){var U=this;this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx,this.defaultLineWidth=2;canvases={},contents={};var t,n,k,N={},A=!1,i=!1;Object.defineProperty(this,"mouseIdleTimeout",{set:function(e){clearInterval(n),n=setInterval(function(){var e;A?A=i=!1:i||(e=root.lookup("mouseFollow").value(),root.lookup("mouseVelocity").assign(new Point(0,0),root.scope,EdenSymbol.hciAgent,e),i=!0,k=void 0)},e/2),t=e},get:function(){return t},enumerable:!0}),this.mouseVelocitySampleTime=100,this.mouseVelocityDampening=.3,this.mouseIdleTimeout=300;this.thumbnail=function(e){var t=canvases.picture;if(void 0===t)for(var n in canvases){t=canvases[n];break}if(void 0!==t){var i,o,a,s,r=t.clientWidth,l=t.clientHeight,d=r/l,r=d<200/112?(a=(200-(o=r*((i=112)/l)))/2,0):200/112<d?(a=0,(112-(i=l*((o=200)/r)))/2):(i=112,o=200,a=0),c=document.createElement("canvas");c.setAttribute("width","200"),c.setAttribute("height","112"),c.getContext("2d").drawImage(t,a,r,o,i);try{s=c.toDataURL("image/png")}catch(e){}e&&e(s)}else e&&e()},this.drawPicture=function(D){var M,L=canvases[D];void 0!==L&&(L.drawingQueued||(L.drawingQueued=!0,L.drawingInProgress||(M=function(){L.drawingInProgress=!0,L.drawingQueued=!1;var e=N[D],t={},n="view_"+D+"_content",i=root.lookup(n),o=i.value(),a=L.getContext("2d"),s=contents[D],r=0;if(void 0!==s){var l,d=root.lookup("view_"+D+"_background_colour").value();for(l in void 0===d&&(d="white"),a.setTransform(1,0,0,1,0,0),U.setFillStyle(a,d),s.style.backgroundColor=d,a.fillRect(0,0,L.width,L.height),e)e[l][0].setAttribute("data-garbage",!0);if(Array.isArray(o)){var c=root.lookup("view_"+D+"_scale").value();"number"!=typeof c&&(c=1);var u,p=root.lookup("view_"+D+"_zoom").value(),h=c*(p="number"!=typeof p?1:p),d=c<0?(a.scale(-h,h),h=-h,u=-c,!0):(1!=h&&a.scale(h,h),u=c,!1),g=root.lookup("view_"+D+"_offset").value();g instanceof Point?d?(v=L.height/h-g.y,a.translate(g.x,-v),g=new Point(g.x,v)):a.translate(g.x,g.y):g=new Point(0,0),U.configureContextDefaults(a,u);for(var v,m,f=[o],b=[0],y=[],w="";0<f.length;){var E=f.pop(),S=b.pop();for(0<S&&E[S-1]instanceof EdenUI.plugins.Canvas2D.Transform&&(a.restore(),y.pop(),w=y.join(" "));S<E.length;){var x=E[S];if(x instanceof Object)if(Array.isArray(x))f.push(E),b.push(S+1),E=x,S=0;else if(x instanceof EdenUI.plugins.Canvas2D.Transform){f.push(E),b.push(S+1),a.save(),x.transform(a);var I=x.getCSS(h),w=w+I+" ";y.push(I),E=x.items,Array.isArray(E)||(E=[E]),S=0}else{var k=x.hash&&x.hash(),I=k&&e[k];if(I)x.elements=I;else{a.save();try{U.configureContext(a,u,p,x.drawingOptions)&&x.draw(a,c,D)}catch(e){void 0!==x&&console.error(x,e)}a.restore()}if(void 0!==x.elements){var A=x.elements[0].parentElement;if(A&&A!=s){for(var C=[],_=0;_<x.elements.length;_++)C.push($(x.elements[_]).clone(!0,!0).get(0));x.elements=C,x.scale(h,p,g)}else I&&!L.rescale||x.scale(h,p,g)}A=x.elements;A&&(A[0].style.transform=(x.transformCSS?x.transformCSS+" ":"")+w,A[0].setAttribute("data-garbage",!1),I||(s.length<=r?s.appendChild(A[0]):s.insertBefore(A[0],s.childNodes[r])),t[k]=A,r++),S++}else S++}}1==root.lookup("view_"+D+"_grid_visible").value()&&(T=root.lookup("view_"+D+"_grid_spacing").value(),v=-g.x,o=L.width/h-g.x,d=d?(m=g.y-L.height/h,g.y):(m=-g.y,L.height/h-g.y),a.save(),a.lineWidth=1/h,a.strokeStyle="thistle",U.drawGridLines(g,h,T,v,m,o,d,a),a.strokeStyle="magenta",U.drawGridLines(g,h,3*T,v,m,o,d,a),a.beginPath(),a.strokeStyle="blue",a.fillStyle="blue",a.arc(0,0,9/h,0,2*Math.PI,!1),a.fill(),a.beginPath(),a.moveTo(3*T,0),a.lineTo(2*T,.4*T),a.lineTo(2*T,-.4*T),a.moveTo(0,3*T),a.lineTo(.4*T,2*T),a.lineTo(-.4*T,2*T),a.fill(),a.beginPath(),a.lineWidth=4/h,a.moveTo(2*T,0),a.lineTo(0,0),a.lineTo(0,3*T),a.stroke(),a.restore())}else{var T=n,i=i.eden_definition;i&&(n=new RegExp("^"+n+"\\s+is\\s+([a-zA-Z0-9_]+)(;)?$"),null!==(n=i.match(n))&&(T=n[1])),a.save(),a.font="18px sans-serif",a.fillStyle="black",a.textAlign="center",s.textBaseline="middle",a.fillText("Give the observable named '"+T+"' a list-typed value",L.width/2,L.height/2),a.fillText("to create a picture here.",L.width/2,L.height/2+30),a.restore()}!function(e,t){for(var n in t)if("false"!=t[n][0].getAttribute("data-garbage"))for(var i=t[n],o=0;o<i.length;o++)null!==i[o].parentElement&&e.removeChild(i[o])}(s,e),N[D]=t,L.drawingInProgress=!1,L.drawingQueued&&setTimeout(M,40)}},setTimeout(M,40))))},this.drawGridLines=function(e,t,n,i,o,a,s,r){r.beginPath();for(var l=0==e.x?n:0;l<=a;l+=n){var d=(Math.round(l*t)-.5)/t;r.moveTo(d,o),r.lineTo(d,s),r.stroke()}for(l=-n;i<=l;l-=n){d=(Math.round(l*t)-.5)/t;r.moveTo(d,o),r.lineTo(d,s),r.stroke()}for(var c=0==e.y?n:0;c<=s;c+=n){var u=(Math.round(c*t)-.5)/t;r.moveTo(i,u),r.lineTo(a,u),r.stroke()}for(c=-n;o<=c;c-=n){u=(Math.round(c*t)-.5)/t;r.moveTo(i,u),r.lineTo(a,u),r.stroke()}},this.configureContextDefaults=function(e,t){e.lineJoin="bevel",e.miterLimit=429496656,e.lineWidth=this.defaultLineWidth/t},this.configureContext=function(e,t,n,i){return"object"!=typeof i||!1!==i.visible&&(Array.isArray(i.dashes)&&(e.setLineDash(i.dashes),"dashOffset"in i&&(e.lineDashOffset=i.dashOffset)),"cap"in i&&(e.lineCap=i.cap),"join"in i&&(e.lineJoin=i.join),"miterLimit"in i&&(e.miterLimit=i.miterLimit),"lineWidth"in i&&(e.lineWidth=i.lineWidth/t),"opacity"in i&&(e.globalAlpha=i.opacity),"object"==typeof i.shadow&&(e.shadowColor=i.shadow.colour,i.shadow.scale?(t=n*t,e.shadowBlur=i.shadow.blur*t,e.shadowOffsetX=i.shadow.xOffset*t,e.shadowOffsetY=i.shadow.yOffset*t):(e.shadowBlur=i.shadow.blur*n,e.shadowOffsetX=i.shadow.xOffset*n,e.shadowOffsetY=i.shadow.yOffset*n)),!0)},this.setFillStyle=function(e,t){var n;t instanceof CanvasImage?(n=e.createPattern(t.image,"repeat"),e.fillStyle=n):t instanceof EdenUI.plugins.Canvas2D.FillStyle?e.fillStyle=t.getColour(e):e.fillStyle=t},this.initZoneFromDrawingOpts=function(e,t){var n;if(e instanceof Object&&!1!==e.zone)return void 0===(n=e.name)&&!0===e.zone?root.currentObservableName():(!Eden.isValidIdentifier(n)||void 0===(e=root.lookup(n+"_click")).value()&&e.assign(!1,root.scope,root.lookup(t)),n)},this.initZoneFromName=function(e,t){var n;return!Eden.isValidIdentifier(e)||void 0===(n=root.lookup(e+"_click")).value()&&n.assign(!1,root.scope,root.lookup(t)),e},this.findDrawableHit=function(e,t,n,i,o){var a=root.lookup("view_"+e+"_content").value(),s=canvases[e];if(s){s=s.getContext("2d"),e=root.lookup("view_"+e+"_scale").value();return this.findDrawableHitInList(a,s,e,t,n,i,o)}},this.findDrawableHitInList=function(e,t,n,i,o,a,s){if(Array.isArray(e))for(var r,l=a?(r=0,1):(r=e.length-1,-1),d=r;a?d<e.length:0<=d;d+=l){var c=e[d];if("object"==typeof c)if(Array.isArray(c)){if(p=this.findDrawableHitInList(c,t,n,i,o,a,s))return p}else if(void 0!==c.isHit){if(s||void 0!==c.name){t.save();var u=c.isHit(t,n,i,o);if(t.restore(),!0===u)return c}}else if(c.inverse){var p,u=c.inverse(i,o);if(void 0!==(p=this.findDrawableHitInList(c.items,t,n,u.x,u.y,a,s)))return p}}},this.findAllDrawablesHit=function(e,t,n,i){var o=root.lookup("view_"+e+"_content").value(),a=canvases[e].getContext("2d"),e=root.lookup("view_"+e+"_scale").value();return this.findAllDrawablesHitInList(o,a,e,t,n,i)};var C={leftButton:!(this.findAllDrawablesHitInList=function(e,t,n,i,o,a){if(!Array.isArray(e))return[];for(var s=[],r=0;r<e.length;r++){var l,d=e[r];"object"==typeof d&&(void 0!==d.isHit?!a&&void 0===d.name||(t.save(),l=d.isHit(t,n,i,o),t.restore(),!0===l&&s.push(d)):d.inverse&&(l=d.inverse(i,o),0<(l=this.findAllDrawablesHitInList(d.items,t,n,l.x,l.y,a)).length&&(s=s.concat(l))))}return s}),middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1};this.createCommon=function(t,e){var n,i,p=t,s=canvases[t];function o(){U.drawPicture(p)}function a(e){return"view_"+t+"_"+e}void 0===s?((n=$('<div id="'+t+'-canvascontent" class="canvashtml-content"></div>')).html('<canvas class="canvashtml-canvas noselect" id="'+t+'-canvas" tabindex="1"></canvas>'),i=n.find(".canvashtml-canvas"),s=i[0],canvases[t]=s,contents[t]=n[0],N[t]={},s.drawingQueued=!1,s.drawingInProgress=!1,s.rescale=!1):i=(n=$("#"+t+"-canvascontent")).find(".canvashtml-canvas");var r=[a("content"),a("background_colour"),a("scale"),a("zoom"),a("offset"),a("canvas_right"),a("canvas_bottom"),"mousePosition","mouseButton","mouseButtons","mouseCapture","mouseCaptured","mouseDown","mouseDownView","mouseFollow","mousePressed","mouseUp","mouseWheel","mouseWheelEnabled","mouseWheelVelocity","mouseView","mouseZone","mouseVelocity"];s.setAttribute("data-observables",r.join(",")),root.lookup("view_"+p+"_content").addJSObserver("repaintView",o);var l=root.lookup("view_"+p+"_background_colour");void 0===l.value()&&l.assign("white",root.scope,EdenSymbol.defaultAgent),l.addJSObserver("refreshView",o);var d=root.lookup("view_"+p+"_scale"),c=root.lookup("view_"+p+"_zoom"),u=root.lookup("view_"+p+"_offset"),h=root.lookup("view_"+p+"_canvas_right"),g=root.lookup("view_"+p+"_canvas_bottom"),v=root.lookup("view_"+p+"_width"),m=root.lookup("view_"+p+"_height"),f=!1;function b(){var e,t,n=d.value(),i=c.value(),o=n*i,a=u.value(),n=a instanceof Point?(e=a.x,a.y):e=0,a=h.value();void 0!==a?(a=Math.ceil((h.value()+e)*o),s.width=a):s.width=1<i?Math.ceil(v.value()*i):Math.floor(v.value()),t=void 0!==g.value()?Math.ceil((g.value()+n)*o):1<i?Math.ceil(m.value()*i):(t=m.value(),void 0!==a&&a>Math.floor(v.value())&&(t-=I.scrollBarSize),Math.floor(t-1)),s.height=t,s.rescale=!0,U.drawPicture(p)}var y=d.value();void 0===y&&(d.assign(1,root.scope,EdenSymbol.defaultAgent),y=1),d.addJSObserver("refreshView",b);r=c.value();void 0===r&&c.assign(1,root.scope,EdenSymbol.defaultAgent);var w=!1;function E(){f?(f=!1,s.rescale=!0,U.drawPicture(p),w||(w=!0,setTimeout(E,1e3))):(b(),w=!1)}c.addJSObserver("refreshView",function(e,t){Math.round(100*t);f=!0,E()});l=u.value(),r=l instanceof Point?(S=l.x,l.y):(u.assign(new Point(0,0),root.scope,EdenSymbol.defaultAgent),S=0);u.addJSObserver("refreshView",b),null==h.value()&&h.assign(void 0,root.scope,EdenSymbol.defaultAgent),h.addJSObserver("repaintView",b),null==g.value()&&g.assign(void 0,root.scope,EdenSymbol.defaultAgent),g.addJSObserver("repaintView",b);var l=void 0===(l=h.value())?600:l*y+S,S=void 0===(S=g.value())?500:S*y+r,r=root.lookup("view_"+p+"_grid_visible");void 0===r.value()&&r.assign(!1,root.scope,EdenSymbol.defaultAgent),r.addJSObserver("refreshView",o);r=root.lookup("view_"+p+"_grid_spacing");function x(e){var t,n=root.lookup("mouseFollow").value();switch(root.beginAutocalcOff(),C.insideCanvas=!0,e.button){case 0:C.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,EdenSymbol.hciAgent,n),t="Left";break;case 1:C.middleButton=!0,t="Middle";break;case 2:C.rightButton=!0,t="Right";break;case 3:C.button4=!0,t="Button4";break;case 4:C.button5=!0,t="Button5";break;default:t="Unknown"}C.buttonCount=C.leftButton+C.middleButton+C.rightButton+C.button4+C.button5;var i,o,a="|";C.leftButton&&(a+="Left|"),C.middleButton&&(a+="Middle|"),C.rightButton&&(a+="Right|"),C.button4&&(a+="Button4|"),C.button5&&(a+="Button5|"),root.lookup("mouseButtons").assign(a,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseButton").assign(t+" down",root.scope,EdenSymbol.hciAgent,n),1==C.buttonCount&&(o=root.lookup("mousePosition").value(),root.lookup("mouseDownView").assign(p,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseDown").assign(o,root.scope,EdenSymbol.hciAgent,n),i=root.lookup("view_"+p+"_scale").value()*root.lookup("view_"+p+"_zoom").value(),a=$(this).offset(),o=(e.pageX-Math.round(a.left))/i,a=(e.pageY-Math.round(a.top))/i,(i=root.lookup("view_"+p+"_offset").value())instanceof Point&&(o-=i.x,a-=i.y),(a=void 0===(o=U.findDrawableHit(p,o,a,!1,!1))?void 0:o.name)!==(o=root.lookup("mouseZone")).value()&&o.assign(a,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseDownZone").assign(a,root.scope,EdenSymbol.hciAgent,n)),root.endAutocalcOff()}return void 0===r.value()&&r.assign(20,root.scope,EdenSymbol.defaultAgent),r.addJSObserver("refreshView",o),i.on("mousedown",x),i.on("mouseup",function(e){var t,n,i=root.lookup("mouseFollow").value();switch(root.beginAutocalcOff(),C.insideCanvas=!0,0<=navigator.platform.toUpperCase().indexOf("MAC")&&e.ctrlKey&&(e.button=2),e.button){case 0:C.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,EdenSymbol.hciAgent,i),t="Left";break;case 1:C.middleButton=!1,t="Middle";break;case 2:C.rightButton=!1,t="Right";break;case 3:C.button4=!1,t="Button4";break;case 4:C.button5=!1,t="Button5";break;default:t="Unknown"}C.buttonCount=C.leftButton+C.middleButton+C.rightButton+C.button4+C.button5,root.lookup("mouseButton").assign(t+" up",root.scope,EdenSymbol.hciAgent,i),0==C.buttonCount?(n=root.lookup("mousePosition").value(),root.lookup("mouseButtons").assign("",root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseUp").assign(n,root.scope,EdenSymbol.hciAgent,i),I.plugins.Canvas2D.endClick()):(n="|",C.leftButton&&(n+="Left|"),C.middleButton&&(n+="Middle|"),C.rightButton&&(n+="Right|"),C.button4&&(n+="Button4|"),C.button5&&(n+="Button5|"),root.lookup("mouseButtons").assign(n,root.scope,EdenSymbol.hciAgent,i)),root.endAutocalcOff()}).on("contextmenu",function(e){0<=navigator.platform.toUpperCase().indexOf("MAC")&&e.ctrlKey&&(e.button=2,x(e)),root.lookup("mouseContextMenuEnabled").value()||(e.preventDefault(),e.stopPropagation())}).on("click",function(e){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(e){var t=root.lookup("mouseFollow").value(),n=root.lookup("mouseDoubleClicks"),i=n.value();n.assign(i+1,root.scope,EdenSymbol.hciAgent,t)}).on("wheel",function(e){var t=e.originalEvent,n=m.value(),i=t.deltaMode==WheelEvent.DOM_DELTA_LINE?U.defaultLineHeight:t.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=t.deltaX?v.value():n:1,o=root.lookup("mouseFollow").value();if(0!=t.deltaY&&e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),root.beginAutocalcOff();var a,s,r,l=-t.deltaY*i;return root.lookup("touchPinchEnabled").value()?(s=(a=root.lookup("touchPinch")).value(),s+=l,a.assign(s,root.scope,EdenSymbol.hciAgent,o)):((r=(r=c.value())*(n+2*l)/n)<.05&&(r=.05),c.assign(r,root.scope,EdenSymbol.hciAgent,o)),void root.endAutocalcOff()}root.lookup("mouseWheelEnabled").value()&&(root.beginAutocalcOff(),0!==t.deltaY&&(!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey)&&(e.preventDefault(),e.stopPropagation(),r=(n=root.lookup("mouseWheel")).value(),r+=l=t.deltaY*i,n.assign(r,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseWheelVelocity").assign(l,root.scope,EdenSymbol.hciAgent,o)),0!==t.deltaX&&(e.preventDefault(),e.stopPropagation(),e=(l=root.lookup("touchPanX")).value(),e+=i=t.deltaX*i,l.assign(e,root.scope,EdenSymbol.hciAgent,o),root.lookup("touchPanXSpeed").assign(i,root.scope,EdenSymbol.hciAgent,o)),root.endAutocalcOff())}).on("mouseout",function(e){C.insideCanvas=!1;var t=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,EdenSymbol.hciAgent,t)}).on("mouseenter",function(e){var t,n,i,o;C.insideCanvas||(C.insideCanvas=!0,0==C.buttonCount?t="":(t="|",C.leftButton&&(t+="Left|"),C.middleButton&&(t+="Middle|"),C.rightButton&&(t+="Right|"),C.button4&&(t+="Button4|"),C.button5&&(t+="Button5|")),t!=(n=(o=root.lookup("mouseButtons")).value())&&(i=root.lookup("mouseFollow").value(),root.beginAutocalcOff(),o.assign(t,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseButton").assign("Enter window",root.scope,EdenSymbol.hciAgent,i),(o=root.lookup("mousePressed")).value()!=C.leftButton&&o.assign(C.leftButton,root.scope,EdenSymbol.hciAgent,i),""==n&&""!=t&&(root.lookup("mouseDown").assign(void 0,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseDownView").assign(void 0,root.scope,EdenSymbol.hciAgent,i)),root.endAutocalcOff()))}).on("mousemove",function(e){A=!0;var t=root.lookup("mouseFollow").value();root.beginAutocalcOff();var n=root.lookup("mouseView"),i=root.lookup("mousePosition"),o=n.value(),a=i.value();a&&(l=a.x,r=a.y);a=root.lookup("view_"+p+"_scale").value()*root.lookup("view_"+p+"_zoom").value();C.capturing?(c=l+(u=e.originalEvent).movementX/a,u=r+u.movementY/a):(s=$(this).offset(),c=(e.pageX-Math.round(s.left))/a,u=(e.pageY-Math.round(s.top))/a,(d=root.lookup("view_"+p+"_offset").value())instanceof Point&&(c-=d.x,u-=d.y)),n.assign(p,root.scope,EdenSymbol.hciAgent,t);var s=new Point(c,u);i.assign(s,root.scope,EdenSymbol.hciAgent,t);var r,l,d=Date.now();o==p&&void 0!==k?(n=d-k)>=U.mouseVelocitySampleTime&&(i=1e3*(c-l)/n,s=1e3*(u-r)/n,(l=(o=root.lookup("mouseVelocity")).value())&&(r=U.mouseVelocityDampening,n=l.x,(0<i&&0<n||i<0&&n<0)&&(i=r*n+(1-r)*i),l=l.y,(0<s&&0<l||s<0&&l<0)&&(s=r*l+(1-r)*s)),i=Math.ceil(i*a)/a,s=Math.ceil(s*a)/a,s=new Point(i,s),o.assign(s,root.scope,EdenSymbol.hciAgent,t),k=d):k=d;var c=U.findDrawableHit(p,c,u,!1,!1),u=void 0===c?void 0:c.name,c=root.lookup("mouseZone");u!==c.value()&&c.assign(u,root.scope,EdenSymbol.hciAgent,t),root.endAutocalcOff()}).on("keyup",function(e){var t,n,i=e.which,o=!1;!e.altKey||e.shiftKey||e.ctrlKey||(n=(t=root.lookup("view_"+p+"_zoom")).value(),61==i||187==i?(n*=1.25,o=!0):173==i||189==i?(n/=1.25,o=!0):48==i&&(n=1,o=!0),t.assign(n,root.scope,EdenSymbol.hciAgent)),o&&(e.preventDefault(),e.stopPropagation())}),{initialWidth:l,initialHeight:S,code_entry:n,offsetSym:u,zoomSym:c,widthSym:h,heightSym:g,scaleSym:d}},this.createEmbedded=function(e,t,n){var l=e;eden.execute2("view_"+l+"_content is "+n+";");var e=U.createCommon(e,t),t=(e.initialWidth,e.initialHeight,e.code_entry),d=e.offsetSym,c=e.zoomSym,u=e.widthSym,p=e.heightSym,h=e.scaleSym;return{code_entry:t,contents:t,destroy:function(){delete canvases[l],delete contents[l]},resize:function(e,t){var n,i,o=d.value(),a=(o instanceof Point?(n=o.x,o.y):n=0,c.value()),s=document.getElementById(l+"-canvas"),r=!1,o=u.value();void 0===o?(e=1<a?Math.ceil(e*a):Math.floor(e),s.width!=e&&(s.width=e,r=!0)):o=Math.ceil(o*h.value()*a+n),void 0===p.value()&&(i=1<a?Math.ceil(t*a):(i=t,void 0!==o&&i<o&&(i-=I.scrollBarSize),Math.floor(i-1)))!=s.height&&(s.height=i,r=!0),r&&U.drawPicture(l)}}},this.createDialog=function(e,t){var l=e.slice(0,-7),n=U.createCommon(l,t),i=n.initialWidth,o=n.initialHeight,a=n.code_entry,d=n.offsetSym,c=n.zoomSym,u=n.widthSym,p=n.heightSym,h=n.scaleSym;return $('<div id="'+e+'"></div>').html(a).dialog({appendTo:"#jseden-views",title:t,width:i+I.scrollBarSize,height:o+I.titleBarHeight,minHeight:120,minWidth:230,classes:{"ui-dialog":"canvas-dialog unpadded-dialog ui-front"}}),o={confirmClose:!0,destroy:function(){var e,t=N[l];for(e in t)for(var n=t[e],i=0;i<n.length;i++){var o=n[i];$(o).detach()}delete canvases[l],delete contents[l]},resize:function(e,t){var n,i,o=d.value(),a=(o instanceof Point?(n=o.x,o.y):n=0,c.value()),s=document.getElementById(l+"-canvas"),r=!1,o=u.value();void 0===o?(e=1<a?Math.ceil(e*a):Math.floor(e),s.width!=e&&(s.width=e,r=!0)):o=Math.ceil(o*h.value()*a+n),void 0===p.value()&&(i=1<a?Math.ceil(t*a):(i=t,void 0!==o&&i<o&&(i-=I.scrollBarSize),Math.floor(i-1)))!=s.height&&(s.height=i,r=!0),r&&U.drawPicture(l)}},U.drawPicture(l),o},root.lookup("mouseDownZone").addJSObserver("recordClick",function(e,t){!Eden.isValidIdentifier(t)||!1===(t=root.lookup(t+"_click")).value()&&t.assign(!0,root.scope,EdenSymbol.hciAgent,!0)}),this.endClick=function(){var e=root.lookup("mouseDownZone").value();!Eden.isValidIdentifier(e)||!0===(e=root.lookup(e+"_click")).value()&&e.assign(!1,root.scope,EdenSymbol.hciAgent,!0)},this.canvasNameFromElement=function(e){for(;e;){var t=e.id;if("-canvascontent"==t.slice(-14))return t.slice(0,-14);e=e.parentElement}return null},document.addEventListener("mouseup",function(e){var t,n=root.lookup("mouseFollow").value();if(root.beginAutocalcOff(),!C.insideCanvas){switch(e.button){case 0:C.leftButton=!1,t="Left";break;case 1:C.middleButton=!1,t="Middle";break;case 2:C.rightButton=!1,t="Right";break;case 3:C.button4=!1,t="Button4";break;case 4:C.button5=!1,t="Button5";break;default:t="Unknown"}C.buttonCount=C.leftButton+C.middleButton+C.rightButton+C.button4+C.button5;var i,o=root.lookup("mouseButtons");0==C.buttonCount&&""!=o.value()&&(e=(i=root.lookup("mousePressed")).value(),root.lookup("mouseButton").assign(t+" up",root.scope,EdenSymbol.hciAgent,n),o.assign("",root.scope,EdenSymbol.hciAgent,n),root.lookup("mousePosition").assign(void 0,root.scope,EdenSymbol.hciAgent,n),e&&i.assign(!1,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseUp").assign(void 0,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseView").assign(void 0,root.scope,EdenSymbol.hciAgent,n),I.plugins.Canvas2D.endClick())}root.endAutocalcOff()}),document.addEventListener("mousedown",function(e){if(!C.insideCanvas){switch(e.button){case 0:C.leftButton=!0;break;case 1:C.middleButton=!0;break;case 2:C.rightButton=!0;break;case 3:C.button4=!0;break;case 4:C.button5=!0}C.buttonCount=C.leftButton+C.middleButton+C.rightButton+C.button4+C.button5}}),document.addEventListener("pointerlockchange",function(e){var t=null!==document.pointerLockElement;C.capturing=t;var n=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(t,root.scope,void 0,n)}),I.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:I.viewCategories.visualization,holdsContent:!0},document.location.pathname.slice(-15),Eden.Selectors.execute("plugins > canvas_merged",eden.root.scope,function(){eden.root.lookup("plugins_canvas_loaded").assign(!0,eden.root.scope),e&&e()})},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.Transform.CSSInfo=function(e,t,n){this.css=e,this.scaleX=t,this.scaleY=n},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Page=function(u,e){var a,t=u.eden.root.lookup("page"),n=u.eden.root.lookup("document"),i=t.value(),s=$("<div class='main-page page'></div>");$("#jseden-views").append(s).addClass("page-body");var r=[],l={},p={},d={},h=0;var c=["top","bottom","left","right","width","height","background","position","color","border","font","fontSize","fontFamily","fontWeight","borderBottom","borderLeft","borderRight","borderTop","overflow","padding","paddingTop","paddingLeft","paddingRight","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","textShadow"];function g(e){switch(typeof e){case"string":return e;case"number":return e+"px";default:return""}}function v(e){var r=[],l=[],t=(e=(e=(e=e.replace(/"jseden:([^"]*)"/g,"\"javascript:eden.execute2('$1;')\"")).replace(/'jseden:([^']*)'/g,"'javascript:eden.execute2(\"$1;\")'")).replace(/<jseden(-([\w\-]+))?(\s+(?:[^"'/>]*(?:"[^"]*")*(?:'[^']*')*)*)?(?:\/|(?:>((?:[^<]*(?:<(?!\/jseden\1>))*)*)<\/jseden\1))>/g,function(e,t,n,i,o,a,s){return void 0===o&&(o=""),r.push(o),l.push(function(e,t){var n={};if(n.tagType=e,void 0===t)return n;for(var i,o,a=/([^\s=]+)(?:\s*=\s*((?:"[^"]*")|(?:'[^']*')|\S*))?/g;null!==(i=a.exec(t));)void 0===i[2]||""==i[2]?n[i[1]]=!0:(o='"'==(o=i[2][0])||"'"==o?i[2].slice(1,-1):i[2],/^\d+$/.test(o)&&(o=parseInt(o)),n[i[1]]=o);return n}(n,i)),"\0\0"})).split("\0\0");if(1==t.length)return e;for(var n,i,o=$("<div></div>"),a=0;a<t.length-1;a++)o.append($("<div class='page-paragraph'>"+t[a]+"</div>")),void 0===l[a].tagType?(n=r[a].split("\n").length,void 0===l[a].lines&&(l[a].lines=n),void 0===l[a].width&&(l[a].width="50%"),void 0===l[a].box&&(l[a].box=!0),n=f(["script",l[a].static,[r[a]],l[a].name,l[a].box,l[a].lines,!1,l[a].float,l[a].width]),o.append(n)):l[a]&&("canvas"==l[a].tagType?(i=b(["canvas",l[a].name,l[a].source,l[a].width,l[a].height,l[a].float,l[a].box]),o.append(i)):"veden"==l[a].tagType&&(i=function(e){if(!e)return;if("veden"!=e[0])return;var t,n=e[1],i=e[2],o=e[3],a=e[4],e=e[5];d[n]?t=d[n]:(t=u.views.Veden.embed(n,n,e),d[n]=t);(n=$("<div id='"+n+"-dialog' class='page-script-live page-script-live-box'></div>")).height(o),a&&"none"!=a&&n.css("float",a);"50%"!=i&&("number"==typeof i?n.width(i):n.css("width",i));return t.contents.appendTo(n),n.resizable(),n}(["veden",l[a].name,l[a].width,l[a].height,l[a].float,r[a]]),o.append(i)));return o.append($("<div class='page-paragraph'>"+t[t.length-1]+"</div>")),o.get(0)}function o(e){if(e&&"element"==e[0]){var t,n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],r=e[6],l=(e[7],e[8],e[9],e[10],e[11],e[12]),e=e[13];switch(n){case"div":case"span":case"button":case"img":case"p":case"ul":case"ol":case"li":case"br":case"pre":case"h1":case"h2":case"h3":case"a":case"input":t=document.createElement(n);break;default:return void console.error("Invalid element type: "+n)}return i&&(t.id=i),o&&(t.className=o),a&&"string"==typeof a&&("string"==typeof(o=v(a))?t.innerHTML=o:t.appendChild(o)),a&&a instanceof Array&&m(t,a),s&&"string"==typeof s&&(t.cssText=s),s&&s instanceof Array&&function(e,t){for(var n=0;n<t.length;n++)void 0!==t[n]&&c[n]&&(e.style[c[n]]=g(t[n]))}(t,s),r&&i&&(t.onclick=function(e){var t=eden.root.lookup(i+"_click");console.log("ELEMENT CLICK"),t.assign(!0,eden.root.scope)}),"img"==n&&l&&(t.src=l),"a"==n&&e&&(t.href=e),t}}function m(e,t){if("string"!=typeof t[0])for(var n,i=0;i<t.length;i++)(n=o(t[i]))&&e.appendChild(n);else(n=o(t))&&e.appendChild(n)}function f(e){if(e&&"script"==e[0]){var t,n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],r=e[6],l=e[7],d=e[8];if(void 0===o&&(o="embedded"+h,h++),n){var e=a?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>"),n=new EdenUI.Highlight(e.get(0)),c=i instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(i):i,c=new Eden.AST(c);n.highlight(c,-1,-1),l&&"none"!=l&&e.css("float",l),"50%"!=d&&("number"==typeof d?e.width(d):e.css("width",d));c=EdenUI.plugins.ScriptInput.getRequiredHeight(s,!0);return e.height(c),e}p[o]?(t=p[o]).update(i):(t=u.views.ScriptInput.embed(o,o,i,r),p[o]=t);o=a?$("<div id='"+o+"-dialog' class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>"),c=EdenUI.plugins.ScriptInput.getRequiredHeight(s,!0);return o.height(c),l&&"none"!=l&&o.css("float",l),"50%"!=d&&("number"==typeof d?o.width(d):o.css("width",d)),t.contents.appendTo(o),o.resizable(),o}}function b(e){var t,n=e[6],i=e[3],o=e[4],n=n?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>");return i&&n.css("width",g(i)),o&&n.css("height",g(o)),void 0===l[e[1]]?(t=u.views.Canvas2D.embedded(e[1],e[1],e[2]),l[e[1]]=t,n.append(t.code_entry),r.push(function(){t.resize(e[3],e[4])})):(l[e[1]].code_entry.appendTo(n),r.push(function(){l[e[1]].resize(e[3],e[4])})),"none"!=e[5]&&n.css("float",e[5]),n}function y(e){if(!e)return"";if(!(e instanceof Array))return"";for(var t=$("<div class='page-content "+a+"'></div>"),n=0;n<e.length;n++)if(void 0!==e[n])switch(e[n][0]){case"header":t.append(function(e){if(!e)return"";if("header"!=e[0])return"";switch(e[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+e[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+e[1]+"</h2>")}}(e[n]));break;case"p":t.append(function(e){if(!e)return"";if("p"!=e[0])return"";var e=e[1]instanceof Array?e[1].join("&nbsp;"):e[1],a=[],t=(e=e.replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden>/g,function(e,t,n,i,o){return console.log("ATTRIBS: "+t),a.push(n),"\0\0"})).split("\0\0");if(1==t.length)return $("<div class='page-paragraph'>"+e+"</div>");for(var n=$("<div></div"),i=0;i<t.length-1;i++){n.append($("<div class='page-paragraph'>"+t[i]+"</div>"));var o=a[i].split("\n").length,o=f(["script",!1,[a[i]],void 0,!0,o,!1,!1,"50%"]);n.append(o)}return n.append($("<div class='page-paragraph'>"+t[t.length-1]+"</div>")),n}(e[n]));break;case"script":t.append(f(e[n]));break;case"canvas":t.append(b(e[n]));break;case"break":t.append($("<div class='clear'></div>"));break;case"list":t.append(function(e){var t=e[1]?$("<ul></ul>"):$("<ol></ol>");if(e[2]&&e[2]instanceof Array)for(var n=0;n<e[2].length;n++){var i=$("<li>"+e[2][n]+"</li>");t.append(i)}return t}(e[n]))}return t}function w(e,t){if(void 0!==t&&t instanceof Array){for(var n in h=0,l)l[n].code_entry.detach();for(var i in p)p[i].contents.detach();"default"==(a=t[2])&&(a="page-theme-default"),s.html(""),s.append(function(e){if(!e)return"";if("title"!=e[0])return"";var t=$("<div class='page-title "+a+"'></div>"),n=$("<div class='page-title-block'></div>");e[6]&&t.css("height",e[6]+"px");var i=e[1]?$("<span class='page-title-text "+a+"'>"+e[1]+"</span>"):$('<img border=0 src="'+e[5]+'"></img>'),o=$("<br/><span class='page-subtitle-text "+a+"'>"+e[2]+"</span>");return n.append(i),n.append(o),t.append(n),e[3],t}(t[1])),s.append(y(t[3]));for(var o=0;o<r.length;o++)r[o]();r=[]}}w(0,i),t.addJSObserver("pageGenerator",w),n.addJSObserver("pageGenerator",function(e,t){if(void 0!==t&&t instanceof Array){for(var n in l)l[n].code_entry.detach();for(var i in p)p[i].contents.detach();s.html(""),m(s.get(0),t);for(var o=0;o<r.length;o++)r[o]();r=[]}}),Eden.Selectors.execute("plugins > page > page",eden.root.scope,function(){eden.root.lookup("plugins_page_loaded").assign(!0,eden.root.scope),e&&e()})},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";var edenfunctions={};function _formatVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}EdenUI.plugins.SymbolViewer=function(h,e){var g=this;this.instances=[];var v=0;this.createDialog=function(e,t,n){var i=e.slice(0,-7),o=root.lookup("createView"),a=$('<div class="symbollist-outer"></div>');a.html('\t\t\t<div class="symbollist-search-box-outer"> \t\t\t\t<input type="text" class="symbollist-search symbollist-control" /> \t\t\t\t<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> \t\t\t\t\t\t\t</div> \t\t\t<div class="symbollist-results"></div>');var s=new EdenUI.plugins.SymbolViewer.SymbolList(h.eden.root,a.find(".symbollist-results")[0],n);$dialog=$('<div id="'+e+'"></div>').append(a).dialog({appendTo:"#jseden-views",title:t,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"symbollist-dialog ui-front"}}),g.instances.push(s),1==++v&&h.eden.root.addGlobal(m),a.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var e,t="edit_"+i;l.value.startsWith("select: ")&&(h.createView(t,"ScriptInput",void 0),e=eden.root.lookup("view_"+t+"_tabs").value(),(e=!Array.isArray(e)?[]:e).push(l.value.substring(8)),eden.root.lookup("view_"+t+"_tabs").assign(e,eden.root.scope,EdenSymbol.hciAgent),eden.root.lookup("view_"+t+"_current").assign(e.length-1,eden.root.scope,EdenSymbol.hciAgent))});var r=a.find(".symbollist-search-box-outer > .symbollist-search"),l=r[0],d=root.lookup("view_"+i+"_search_language");function c(){var e=d.value();return r.val().startsWith("select: ")?h.regExpFromStr("","",!1,e):h.regExpFromStr(r,"",!1,e)}function u(e,t){s.search(l.value,c()),"regexp"==t?r.attr("placeholder","search regular expression"):"simple"==t?r.attr("placeholder","simple search"):r.attr("placeholder","search")}u(0,d.value()),d.addJSObserver("refreshView",u);var p=root.lookup("view_"+i+"_search_string"),t=function(e,t){void 0!==t&&(t!==l.value&&(l.value=t),s.search(t,c()))},a=p.value();return void 0===a?(p.assign("",root.scope,o),s.search("",new RegExp(""))):t(0,a),p.addJSObserver("refreshView",t),r.keyup(function(){p.assign(l.value,root.scope,EdenSymbol.hciAgent)}),{destroy:function(){var e=g.instances.indexOf(s);g.instances.splice(e,1),0==--v&&h.eden.root.removeGlobal(m)}}},this.createObservableDialog=function(e,t){return g.createDialog(e,t,"obs")},this.createFunctionDialog=function(e,t){return g.createDialog(e,t,"func")},this.createAgentDialog=function(e,t){return g.createDialog(e,t,"agent")},this.createSymbolDialog=function(e,t){return g.createDialog(e,t,"all")};var i={},o={},a=!1;this.isCreationPending=function(e){return e in o},this.delay=40;function s(){for(x in g.instances){var e,t=g.instances[x];for(e in o){var n=o[e];(!t.filter||0<=t.filter.indexOf(e))&&t.addSymbol(n,e)}for(e in i)t.updateSymbol(e)}i={},a=!(o={})}var m=function(e,t){var n=e.name;if(1==t)o[n]=e;else{if(n in o)return;i[n]=e}a||(a=!0,setTimeout(s,g.delay))};h.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:h.viewCategories.comprehension,menuPriority:0},h.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:h.viewCategories.comprehension,menuPriority:0},h.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:h.viewCategories.comprehension,menuPriority:0},h.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:h.viewCategories.comprehension,menuPriority:1},eden.root.lookup("plugins_symbolviewer_loaded").assign(!0,eden.root.scope),e()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(e,t,n){this.root=e,this.regExp=new RegExp(""),this.type=n,this.category="all",this.customCategory=!1,this.subtypes="all",this.symresults=t,this.symbols={},this.filter=void 0},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(e,t,n,i){if(void 0!==e)if(e.startsWith("select: ")){var o=Eden.Selectors.query(e.substr(8),"symbol");console.log(o),this.filter=o,this.regExp=t,this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};for(var a=0;a<o.length;a++){var s=o[a],r=this.root.symbols[s];r&&this.addSymbol(r,s)}}else{var l,d;for(l in this.searchStr=e,this.searchStrLowerCase=e.toLowerCase(),this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={},this.root.symbols)edenUI.plugins.SymbolViewer.isCreationPending(l)||(d=this.root.symbols[l],this.addSymbol(d,l))}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(e){void 0!==this.symbols[e]&&this.symbols[e].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(e,t){var n=!1;if(t.toLowerCase()==this.searchStrLowerCase)n=!0,o="exact-match";else if(!this.regExp.test(t))return;var i=!0;if(this.customCategory?Eden.isitCategory(t,this.category,this.type)||(i=!1):Eden.isitSystemSymbol(t)?"user"==this.category&&(i=!1):"system"==this.category&&(i=!1),void 0!==e.definition?"vars"==this.subtypes&&(i=!1):"formulas"==this.subtypes&&(i=!1),!i){if(!n)return;o="dirty-match"}var o,a="obs";a=e.definition?(i=e.getSource(),/^proc\s/.test(i)?"agent":/^func\s/.test(i)?"func":"function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs"):"function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs","all"!=this.type&&this.type!=a||(o=new EdenUI.plugins.SymbolViewer.Symbol(e,t,a,o),n?o.element.prependTo(this.symresults):o.element.appendTo(this.symresults),this.symbols[t]=o)},EdenUI.plugins.SymbolViewer.Symbol=function(e,d,t,n){switch(this.symbol=e,this.name=d,this.type=t,this.details=void 0,this.update=void 0,this.wasdef=!1,this.rawelement=document.createElement("div"),this.rawelement.classList.add("symbollist-result-element"),this.element=$(this.rawelement),n&&this.rawelement.classList.add("symbollist-"+n+"-result"),this.valueElement=null,this.nameElement=null,t){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var c=this,u=!1;function p(){c.element.removeClass("symbollist-inline-editor"),c.update(),c.element.scrollLeft(0)}this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||u||(u=!0,setTimeout(function(){!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&u&&(u=!1,c.name,Eden.Selectors.goto("> :not(ACTIVE) >> "+e.name))},350))}),"obs"==t&&this.element.dblclick(function(){var e,t,n,i,o,a,s,r;function l(e){var t,n=e.which;13==n?(t=i.get(0).value,";"!=(e=s.value).slice(-1)&&(e+=";"),eden.execute2(c.name+" "+t+" "+e),p(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0):27==n&&(p(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}u=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==c&&(e=c.symbol.cache.value,void 0!==c.symbol.definition||"boolean"!=typeof e?((EdenUI.plugins.SymbolViewer.inlineEditorSymbol=c).element.addClass("symbollist-inline-editor"),r=c.element.find(".result_value"),o=c.element.find(".result_separator"),r.html(""),n=void 0!==c.symbol.definition?(t=c.symbol.getSource().replace(new RegExp("^\\s*"+d+"\\s+is\\s+"),""),"is"):(t=Eden.edenCodeForValue(e),"="),i=$("<select></select>"),"="==n?(i.append('<option value="is">is</option>'),i.append('<option value="=" selected="selected">=</option>')):(i.append('<option value="is" selected="selected">is</option>'),i.append('<option value="=">=</option>')),o.html(" "),o.append(i),o=Eden.htmlEscape(t,!0),a=$('<input type="text" value="'+o+'" spellcheck="false" style="width: 100%"/>'),s=a.get(0),a.on("keyup",l),a.on("blur",function(){setTimeout(function(){i.is(document.activeElement)||(p(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===c&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),i.on("keydown",l),i.on("blur",function(){setTimeout(function(){a.is(document.activeElement)||(p(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===c&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),r.append(a),0<(r=c.element.find(".symbollist-result-inner")).length&&(r.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),s.focus(),s.select(),'"'!=(r=t.slice(0,1))&&"'"!=r&&"["!=r&&"{"!=r||(s.selectionStart=1,s.selectionEnd=t.length-1)):!0===e?c.symbol.assign(!1,eden.root.scope,EdenSymbol.hciAgent,!0):c.symbol.assign(!0,eden.root.scope,EdenSymbol.hciAgent,!0))}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var e=this.symbol.getSource(),t=void 0===this.symbol.definition||/^func\s/.test(e)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",t="<span class='result_name'>"+t+"</span>"+(null!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name]?(this.details=edenfunctions.functions[this.name],"<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):"");void 0===this.symbol.definition||/^func\s/.test(this.symbol.eden_definition)||(e=Eden.htmlEscape(e,!1,!0),t="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(e=Eden.htmlEscape("<pre>"+e+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+t+"</span>"),this.element.html(t)},EdenUI.plugins.SymbolViewer.Symbol.prototype._formatVal=function(e){var t=Eden.edenCodeForValue(e),e=typeof e;if(e!=this.oldtype)switch(e){case"boolean":this.valueElement.className="special_text";break;case"undefined":this.valueElement.className="error_text";break;case"string":this.valueElement.className="string_text";break;case"number":this.valueElement.className="numeric_text";break;default:this.valueElement.className=""}this.valueElement.innerText=t},EdenUI.plugins.SymbolViewer.Symbol.prototype._updateObservable=function(e,t){var n,i;this.valueElement||(this.valueElement=document.createElement("span")),this._formatVal(e),this.nameElement||(this.nameElement=document.createElement("span"),void 0!==this.symbol.definition&&(this.wasdef=!0,this.nameElement.className="hasdef_text"),this.nameElement.innerText=this.name,(n=document.createElement("span")).classList.add("result_name"),t&&n.classList.add("async-observable"),n.appendChild(this.nameElement),(i=document.createElement("span")).className="result_separator",i.innerText=" = ",(e=document.createElement("span")).className="result_value",e.appendChild(this.valueElement),(t=document.createElement("span")).className="symbollist-result-inner",t.appendChild(n),t.appendChild(i),t.appendChild(e),t.onmouseenter=e=>{var t;this.symbol.definition&&(t=document.createElement("DIV"),EdenUI.Highlight.htmlElement(this.symbol.getSource(),t,{removejs:!0}),EdenUI.showTooltip(e,t))},t.onmouseleave=e=>{EdenUI.closeTooltip()},this.rawelement.appendChild(t)),this.symbol.definition&&!this.wasdef?(this.wasdef=!0,this.nameElement.className="hasdef_text"):!this.symbol.definition&&this.wasdef&&(this.wasdef=!1,this.nameElement.className="")},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var e=this.symbol.value();e instanceof Promise?e.then(e=>{this._updateObservable(e,!0)}):this._updateObservable(e,!1)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var e=this.symbol.getSource(),t=void 0===this.symbol.definition||/^proc\s/.test(e)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",t="<span class='result_name'>"+t+"</span>"+(null!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name]?(this.details=edenfunctions.procedures[this.name],"<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):"");void 0===this.symbol.definition||/^proc\s/.test(e)||(e=Eden.htmlEscape(e,!1,!0),t="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(e=Eden.htmlEscape("<pre>"+e+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+t+"</span>"),this.element.html(t)};edenfunctions={};EdenUI.plugins.VersionViewer=function(s,e){var r=this;this.instances=[];var l=0;this.createDialog=function(e,t,n){var i=e.slice(0,-7),o=(root.lookup("createView"),$('<div class="versionviewer-outer"></div>'));o.html('<table class="version-viewer-list"></table>'),$dialog=$('<div id="'+e+'"></div>').append(o).dialog({appendTo:"#jseden-views",title:t,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"versionviewer-dialog ui-front"}});var a;root.lookup("view_"+i+"_search_string");return a=URLUtil.getParameterByName("load"),$.get(Eden.DB.remoteURL+"/project/versions",{projectID:a},function(e){var i=o.find(".version-viewer-list").html(""),t=$("<tr><th>Vid</th><th>Date</th><th>ParentDiff</th><th>Private</th></tr>");i.append(t),$(e).each(function(e,t){var n="";t.private&&(n="&#xf023;");n=$('<tr><td><a href="?load='+a+"&vid="+t.saveID+'">'+t.saveID+"</td><td>"+t.date+"</td><td>"+t.parentDiff+"</td><td style=\"font-family:'FontAwesome'; font-size:20pt; color:gold\">"+n+"</td></tr>");i.append(n)})}),{destroy:function(){var e=r.instances.indexOf(symbollist);r.instances.splice(e,1),0==--l&&s.eden.root.removeGlobal(symbolChanged)}}},this.createVersionListDialog=function(e,t){return r.createDialog(e,t,"all")},s.views.VersionList={dialog:this.createVersionListDialog,title:"Version List",category:s.viewCategories.history,menuPriority:1},eden.root.lookup("plugins_VersionViewer_loaded").assign(!0,eden.root.scope),e()},EdenUI.plugins.VersionViewer.title="Version Viewer",EdenUI.plugins.VersionViewer.description="Show version details for a specified project.",EdenUI.plugins.VersionViewer.inlineEditorSymbol=void 0,EdenUI.plugins.ExternalHTMLContent=function(p,e){var h=!1,g=!1;function v(){h=!1}this.createDialog=function(e,t){g||(""==document.location.hash&&window.history.pushState({},"","#noNavigateAway"),window.addEventListener("popstate",function(){""==document.location.hash&&(h?window.history.forward(1):p.modalDialog("Leave Environment?","<p>Leaving this page will discard the current script. Your work will not be saved.</p><p>Are you sure you want to close JS-EDEN?</p>",["Close JS-EDEN","Return to Construal"],1,function(e){0==e?(doingNavigateAway=!0,window.history.back(1)):window.history.forward(1)}))}),g=!0);var n=e.slice(0,-7),i=root.lookup("createView"),o=$('<iframe marginwidth="13" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts" allowfullscreen="true" name="'+e+'"></iframe>'),a=root.lookup("_view_"+n+"_url"),s=o[0];function r(e,t){s.src=void 0===t?"plugins/external-html-content/undefined-url.html?view="+encodeURI(n):"plugins/external-html-content/redirect.html?view="+encodeURI(n)+"&url="+encodeURI(t)}r(0,a.value()),a.addJSObserver("refreshView",r);var t=$('<div id="'+e+'"></div>').html(o).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"external-html-content"}),l=$('<div class="external-html-content-toolbar">');t.append(l);var d=root.lookup("_view_"+n+"_toolbar_visible"),c=root.lookup("_view_"+n+"_toolbar_pinned");function u(e,t){t?(c.value()&&o.addClass("external-html-content-pinned"),l.css("display","block")):(o.removeClass("external-html-content-pinned"),l.css("display","none"))}void 0===d.value()&&d.assign(!0,root.scope,i),void 0===c.value()&&c.assign(!1,root.scope,i),u(0,d.value()),d.addJSObserver("refreshView",u),c.addJSObserver("refreshView",function(e,t){d.value()&&o.toggleClass("external-html-content-pinned",t)});i=$('<input type="image" src="images/pin.png" width="28" height="28" alt="Pin toolbar" title="Click to pin the toolbar in place"/>');i.on("click",function(){c.assign(!c.value(),root.scope,Symbol.hciAgent),s.focus()}),l.append(i);i=$('<input type="image" src="images/back-button.svg" width="28" height="28" alt="Back" title="Click to go back"/>');i.on("click",function(){h||setTimeout(v,1e3),h=!0,window.history.back(1),s.focus()}),l.append(i);i=$('<input type="image" src="images/forward-button.svg" width="28" height="28" alt="Forward" title="Click to go forward"/>');i.on("click",function(){window.history.forward(1),s.focus()}),l.append(i);i=$('<input type="image" src="images/refresh-button.png" height="28" alt="Refresh" title="Click to reload the page specified by _view_'+n+'_url"/>');return i.on("click",function(){r(0,a.value()),s.focus()}),l.append(i),{confirmClose:!0}},p.views.ExternalHTMLContent={dialog:this.createDialog,title:"External HTML Content",category:p.viewCategories.visualization,holdsContent:!0},p.eden.include("plugins/external-html-content/external-html-content.js-e",e)},EdenUI.plugins.ExternalHTMLContent.title="External HTML Content",EdenUI.plugins.ExternalHTMLContent.description="Allows construals to display web pages created outside of JS-EDEN.",EdenUI.plugins.HTMLContent=function(e,t){this.createDialog=function(e,t){var i=e.slice(0,-7);function n(e){return"view_"+i+"_"+e}var o=[n("background_colour"),n("content")],a=$('<div id="'+e+'-content" class="htmlviews-content" data-observables="'+o.join(",")+'"></div>');a.on("mousedown","button",function(e){var t=e.currentTarget.name,e=e.currentTarget.getAttribute("data-value");null!==e&&null!==e.charAt(0).match(/[0-9]?/)&&(e=parseInt(e)),eden.root.lookup(t).assign(null===e||e,eden.root.scope,EdenSymbol.hciAgent)}),a.on("mouseup","button",function(e){var t=e.currentTarget.name;null===e.currentTarget.getAttribute("data-value")&&eden.root.lookup(t).assign(!1,eden.root.scope,EdenSymbol.hciAgent)}),a.on("click",function(e){e=e.srcElement.getAttribute("data-jseden");e&&""!=e&&(console.log(e),eden.execute2(e,{name:"execute"}))});var s=root.lookup("view_"+i+"_content"),o=function(e,t){if(void 0===t)a.html('<div class="htmlviews-undefined">Give view_'+i+"_content a value to display HTML formatted text here.</div>");else if("string"==typeof t)a.html(t);else{var n=a[0];if(n.firstChild===n.lastChild!==t){for(;n.lastChild;)n.removeChild(n.lastChild);n.appendChild(t)}}};o(0,s.value()),s.addJSObserver("repaintView",o);o=root.lookup("view_"+i+"_background_colour");function r(e,t){l.get(0).parentNode.style.background=t}o.addJSObserver("changeColour",r);var l=$('<div id="'+e+'"></div>').html(a).dialog({appendTo:"#jseden-views",title:t,width:600,height:450,minHeight:120,minWidth:230,classes:{"ui-dialog":"htmlviews-dialog ui-front"}}),o=o.value();return o&&r(0,o),{confirmClose:!0}},e.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:e.viewCategories.visualization,holdsContent:!0},Eden.Selectors.execute("plugins > html > html",eden.root.scope,function(){eden.root.lookup("plugins_html_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t()})},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(e,t){var p,h,g,v,m,f,o=this,n={"=":{precedence:1,associativity:"right",text:"=",whitespace:!0},"+=":{precedence:1,associativity:"right",text:"+=",whitespace:!0},"-=":{precedence:1,associativity:"right",text:"-=",whitespace:!0},"||":{precedence:3,associativity:"left",text:"||",whitespace:!0},or:{precedence:3,associativity:"left",text:"or",whitespace:!0},"&&":{precedence:4,associativity:"left",text:"&&",whitespace:!0},and:{precedence:4,associativity:"left",text:"and",whitespace:!0},"==":{precedence:5,associativity:"left",text:"==",whitespace:!0},"!=":{precedence:5,associativity:"left",text:"!=",whitespace:!0},"<":{precedence:6,associativity:"left",text:"<",whitespace:!0},"<=":{precedence:6,associativity:"left",text:"<=",whitespace:!0},">":{precedence:6,associativity:"left",text:">=",whitespace:!0},">=":{precedence:6,associativity:"left",text:">",whitespace:!0},"=~":{precedence:6,associativity:"left",text:"=~",whitespace:!0},"!~":{precedence:6,associativity:"left",text:"!=",whitespace:!0},"//":{precedence:7,associativity:"left",text:"//",whitespace:!0},"+":{precedence:8,associativity:"left",text:"+",whitespace:!0},"-":{precedence:8,associativity:"left",text:"-",whitespace:!0},"*":{precedence:9,associativity:"left",text:"*",whitespace:!0},"/":{precedence:9,associativity:"left",text:"/",whitespace:!0},"%":{precedence:9,associativity:"left",text:"%",whitespace:!0},"^":{precedence:11,associativity:"right",text:".",whitespace:!(this.createDialog=function(e,t){$dialog=$('<div id="'+e+'"></div>').html('<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230})})},".":{precedence:14,associativity:"left",text:".",whitespace:!1}},i={"-":{precedence:10,text:"-"},"!":{precedence:10,text:"!"},"&":{precedence:10,text:"&"},not:{precedence:10,text:"!"},"++.":{precedence:11,text:"++"},"--.":{precedence:11,text:"--"},"*":{precedence:12,text:"*"}},a={"#":{precedence:11,text:"#"},".++":{precedence:11,text:"++"},".--":{precedence:11,text:"--"}},s={};this.convertTreeToEden=(p=i,h=n,g=a,v=s,m=13,f=function(e,t,n){if(!e.hasOwnProperty("children"))return e.name;var i=e.name,o=e.children;if(h.hasOwnProperty(i)&&2==o.length){var a,s,r=(a=h[i]).precedence,l=a.associativity,e=f(o[0],r,a.text),d=f(o[1],r,a.text);"left"==l?(s=o[1].name,o[1].hasOwnProperty("children")&&2==o[1].children.length&&h.hasOwnProperty(s)&&r==h[s].precedence&&(d="("+d+")")):(s=o[0].name,o[0].hasOwnProperty("children")&&2==o[0].children.length&&h.hasOwnProperty(s)&&r==h[s].precedence&&(e="("+e+")")),d=a.whitespace?e+" "+a.text+" "+d:e+a.text+d}else if(p.hasOwnProperty(i))r=(a=p[i]).precedence,d=a.text+f(o[0],r,a.text);else if(g.hasOwnProperty(i))r=(a=g[i]).precedence,d=f(o[0],r,a.text)+a.text;else if(v.hasOwnProperty(i))a=v[i],this.precedence=a.precedence,d=a.code(o,n);else{r=m;for(var c=[],u=0;u<o.length;u++)c.push(f(o[u],0,void 0));d=i+"("+c.join(", ")+")"}return d=r<t?"("+d+")":d},function(e){return f(e,0,void 0)}),s["?"]={precedence:2,code:function(e){return o.convertTreeToEden(e[0])+"? "+o.convertTreeToEden(e[1])+" : "+o.convertTreeToEden(e[2])}},s["`...`"]={precedence:13,code:function(e){return"`"+o.convertTreeToEden(e[0])+"`"}},s["${{...}}$"]={precedence:13,code:function(e){return"${{ "+e[0].name+" }}$"}},s["(...)"]={precedence:13,code:function(e){for(var t=o.convertTreeToEden(e[0]),n=[],i=1;i<e.length;i++)n.push(o.convertTreeToEden(e[i]));return"("+t+")("+n.join(", ")+")"}},s["[...]"]={precedence:13,code:function(e){for(var t=[],n=0;n<e.length;n++)t.push(o.convertTreeToEden(e[n]));return"["+t.join(", ")+"]"}},s["[n]"]={precedence:13,code:function(e){return o.convertTreeToEden(e[0])+"["+o.convertTreeToEden(e[1])+"]"}},s["{...}"]={precedence:13,code:function(e){for(var t=[],n=0;n<e.length-1;n+=2)t.push(e[n].name+": "+o.convertTreeToEden(e[n+1]));return"{"+t.join(", ")+"}"}},s.Point={precedence:13,code:function(e,t){if("."!=t)return"{"+o.convertTreeToEden(e[0])+", "+o.convertTreeToEden(e[1])+"}";for(var n=[],i=0;i<e.length;i++)n.push(o.convertTreeToEden(e[i]));return"Point("+n.join(", ")+")"}},e.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:e.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_content","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","semicircleAngle","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,background_audio:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,semicircleAngle:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createExternalHTMLView:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,loadTextFileIntoObservable:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showAgents:!0,showFunctions:!0,showObservables:!0,showSymbols:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0,bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0},Eden.systemFunctionNames={Arc:!0,Arrowhead:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Object:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,semicircleAngle:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Arrowhead:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,hslColour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgbColour:!0,rotatePoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,semicircleAngle:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.symbolCategories["Sound and Video"]={agent:{bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0,unbind:!0},obs:{background_audio:!0,background_audio_url:!0,background_audio_paused:!0,background_audio_chapter:!0,background_audio_chapters:!0,background_audio_looping:!0,background_audio_speed:!0,background_audio_time:!0,background_audio_volume:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0},func:{Audio:!0,Video:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0}},Eden.isitSystemSymbol=function(e){return Eden.isitSystemObservable(e)||Eden.isitSystemAgent(e)||Eden.isitSystemFunction(e)},Eden.isitSystemObservable=function(e){return!!/^(_view|background_audio)_/.test(e)||e in Eden.systemObservableNames},Eden.isitSystemAgent=function(e){return!!/^_View_/.test(e)||e in Eden.systemAgentNames},Eden.isitSystemFunction=function(e){return e in Eden.systemFunctionNames},Eden.isitCategory=function(e,t,n){t=Eden.symbolCategories[t];return"all"==n?"obs"in t&&e in t.obs||"agent"in t&&e in t.agent||"func"in t&&e in t.func:n in t&&e in t[n]},Eden.getSymbolCategories=function(e){if("all"==e)return Object.keys(Eden.symbolCategories);var t,n=[];for(t in Eden.symbolCategories)e in Eden.symbolCategories[t]&&n.push(t);return n},EdenUI.plugins.SymbolLookUpTable=function(i,e){this.createDialog=function(e,t){code_entry=$('<div id="'+e+'-content" class="symbol-lookup-table-content">'+n(e)+"</div>"),$dialog=$('<div id="'+e+'"></div>').html(code_entry).dialog({appendTo:"#jseden-views",title:t,width:600,height:450,minHeight:120,minWidth:230,classes:{"ui-dialog":"htmlviews-dialog ui-front"}})},i.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:i.viewCategories.comprehension,menuPriority:3},this.search=function(e){var t=$("#"+e+"-regexp"),t=i.regExpFromStr(t);document.getElementById(e+"-table-div").innerHTML=o(t,e)};var n=function(e){return"<div class='upper'>"+("<input id='"+e+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+e+"')\" placeholder='search' onload='setFocus()' />")+"</div><div id='"+e+"-table-div' class='lower'>"+o(new RegExp(""),e)+"</div>"},o=function(e,t){tableBodyHTML="";var n,i,o,a,s=[],r={};for(n in root.symbols)if(c=root.symbols[n],e.test(n)){if(void 0===c.definition)o="-",a="Function"==(i="function"==typeof c.cache.value?"Function":"Observable")?c.getSource():Eden.htmlEscape(Eden.edenCodeForValue(c.cache.value));else if(0==(o=c.getSource()).indexOf("proc")){if(Eden.isitSystemAgent(n)&&!new RegExp("\\b"+n+"\\b").test(e.source))continue;i="Agent",a=""}else if(0==o.indexOf("func")){if(Eden.isitSystemFunction(n)&&!new RegExp("\\b"+n+"\\b").test(e.source))continue;i="Function",a=""}else i="Dependency",a=Eden.htmlEscape(Eden.edenCodeForValue(c.value()));s.push([c,n,i,EdenUI.Highlight.html(o,!1),a]),r[n]=!0}for(var l=0;l<s.length;l++){var d=s[l],c=d[0],u=y(c.observees,r,t),p=y(c.dependencies,r,t),h=u;""!=u&&""!=p&&(h+=", "),h+=p;var g=y(c.observers,r,t),u=y(c.subscribers,r,t),p=g;""!=g&&""!=u&&(p+=", "),p+=u;g=w(Object.keys(c.dynamicDependencies),r,t),u="Unknown";if(c.origin){for(var v=c.origin.parent,m=v,f=!1,b=3;0<b--&&m&&(!m.name||"*When"==m.name);)"*When"==m.name&&(f=!0),m=m.parent;v&&(f?u="when : "+(m?m.name:"")+":"+c.origin.line:"script"==v.type&&(v.name?u=v.name+":"+c.origin.line:m&&(u="script in "+m.name)))}else u="Javascript";v=Object.keys(c.jsObservers).join(", "),v="<tr id='"+t+"-symbol-"+d[1]+'\'><td class="lower"><p>'+d[1]+'</p></td><td class="lower"><p>'+d[2]+'</p></td><td class="lower eden-wrapline"><p>'+d[3]+'</p></td><td class="lower eden-wrapline"><p>'+d[4]+'</p></td><td class="lower"><p>'+h+'</p></td><td class="lower"><p>'+p+'</p></td><td class="lower"><p>'+g+'</p></td><td class="lower"><p>'+u+'</p></td><td class="lower"><p>'+v+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(d[1])?tableBodyHTML+=v:tableBodyHTML=v+tableBodyHTML}return'<table><tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower eden-wrapline"><b>Definition</b></td><td class="lower eden-wrapline"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>'+tableBodyHTML+"</table>"},y=function(e,t,n){var i,o=[];for(i in e)o.push(s(i,t,n));return o.join(", ")},w=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var a=e[o];void 0===a&&(a=""),i.push(s(a,t,n))}return i.join(", ")},s=function(e,t,n){return"*"==e[0]||"include"==e||"Not yet defined"==e?e:e in t?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+n+"-symbol-"+e+"')\">"+e+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+n+"', '"+e+"')\">"+e+"</a>"};this.addSymbolToSearch=function(e,t){var n=document.getElementById(e+"-regexp"),t="false"==i.getOptionValue("optSimpleWildcards")?n.value+"|^"+t+"$":n.value+" "+Language.ui.search.disjunction+" "+t;n.value=t,this.search(e)},this.jump=function(e){var t=location.href;location.href="#"+e,history.replaceState(null,null,t)},e()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";edenfunctions={};function _formatFramerVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}SymbolMeta=function(e){this.symbol=e,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(e){var t,n=0,i=0,o=.1;for(t in this.symbol.dependencies){n++,o+=(1-o)*SymbolMeta.DependencyComplexityRate;var a=t.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&i++}return o-=n*SymbolMeta.DependencyChangeProbability,(o=0!=n?.5*o+i/n*.5:o)<0?0:o},SymbolMeta.prototype.subscriberInterestingness=function(e){var t,n=0,i=0,o=0;for(t in this.symbol.subscribers){n++,o+=(1-o)*SymbolMeta.SubscriberRate;var a=t.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&i++}return o=1-o,o=0!=n?.5*o+i/n*.5:o},SymbolMeta.prototype.nameInterestingness=function(){var e=this.symbol.name.substr(1);return"_"==e[0]?.5:/\d/.test(e)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(e){var t=this.dependencyInterestingness(e)*this.subscriberInterestingness(e)*this.nameInterestingness()*this.significance;this.interestingness=t},EdenUI.plugins.ObservableMining=function(e,t){var d=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];this.createDialog=function(e,t){e.slice(0,-7);var n=$("<div></div>");n.html('<div class="symbolframer-results"></div>'),d.symresults=n.find(".symbolframer-results")[0],$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var c=void 0,u=function(){if(void 0!==d.symresults){var e=$(d.symresults).parent();$(d.symresults).detach();for(var t,n=0;n<d.symbolsui.length;n++)d.symbolsui[n].meta.dodelete?d.symbolsui.splice(n,1):0==d.symbolsui[n].meta.isinteresting&&(t=d.symbolsui[n].element,d.symbolsui[n].element.hide("drop",{direction:"right"},"slow",function(){t.remove()}),d.symbolsui.splice(n,1));for(var i=d.minInteresting(),o=d.maxInteresting(),n=0;n<d.interesting.length;n++){for(var a,s,r=!1,l=0;l<d.symbolsui.length;l++)if(d.symbolsui[l].meta==d.interesting[n]){r=!0;break}r||(a=new EdenUI.plugins.ObservableMining.Symbol,d.symbolsui.push(a),a.element.appendTo(d.symresults),a.symbol=d.interesting[n].symbol,s=a.symbol.name.substr(1),a.name=s,a.meta=d.interesting[n],a.outofdate=!0,a.symbolChanged=c)}for(n=0;n<d.symbolsui.length;n++)d.symbolsui[n].update(i,o);$(d.symresults).appendTo(e)}for(n=0;n<d.interesting.length;n++)d.interesting[n].interestingness*=SymbolMeta.DecayRate;setTimeout(u,d.delay)};u(),c=function(e,t){var n=e.name.substr(1),i=d.meta[n];if(void 0!==d.symresults){if(e.definition&&e.eden_definition){var o=e.eden_definition;if(/^proc\s/.test(o))return;if(/^func\s/.test(o))return;if("function"==typeof e.cache.value)return}else if("function"==typeof e.cache.value)return;!t&&void 0!==i||(d.meta[n]=new SymbolMeta(e),i=d.meta[n]),i.update(d),0==i.isinteresting&&(d.interesting.sort(function(e,t){return t.interestingness-e.interestingness}),i.interestingness>=d.minInteresting()&&(d.interesting.length,d.interesting.length==d.limitInteresting&&(d.interesting[d.interesting.length-1].isinteresting=!1,d.interesting.pop()),d.interesting.push(i),i.isinteresting=!0,i.significance*=SymbolMeta.SigInterestingRate,d.interesting.sort(function(e,t){return t.interestingness-e.interestingness})))}},e.eden.root.addGlobal(c),e.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:e.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),t()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return 0<this.interesting.length?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return 0<this.interesting.length?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var n=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==n.editing&&(n.editing=!1,n.element.find("textarea").remove(),n.element.animate({height:"20px"},"fast"))}).click(function(){var t;n.editing||(t="function"==typeof n.symbol.value()&&void 0!==n.symbol.eden_definition?n.symbol.eden_definition:n.symbol.definition?n.symbol.eden_definition+";":n.name+" = "+Eden.edenCodeForValue(n.symbol.value())+";",n.element.animate({height:"60px"},{duration:200,complete:function(){var e=$('<textarea class="mine_edit_box" style="display: none"></textarea>');e.val(t),e.appendTo(n.element),e.show("fast")}}),n.editing=!0)}).draggable({distance:40,axis:"x",scroll:!1,drag:function(e,t){150<t.position.left?n.dodelete=!0:n.dodelete=!1},revert:function(e,t){return!n.dodelete},stop:function(e,t){n.dodelete&&(n.meta.significance*=SymbolMeta.SigDeleteRate,n.symbolChanged(n.symbol,!1),n.element.hide("drop",{direction:"right"},"slow",function(){n.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(e,t){var n;void 0!==this.symbol&&(0==t&&(t=1),t=(this.meta.interestingness-e)*(1/(t-e)),e=Math.round(8+12*t),t=_formatFramerVal(this.symbol.value()),t="<span>"+(void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+t+"</span>",void 0!==this.symbol.definition&&(n=Eden.htmlEscape(this.symbol.eden_definition,!1,!0),t="<span onmouseenter='EdenUI.showTooltip(event, \""+(n=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+n+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+t+"</span>"),(n=this.element.find(".observable")).html(t),n.css({"font-size":e+"px"}))},EdenUI.plugins.ObservablePalette=function(q,e){var t=0,a={};function s(e){e=e.value();return"function"!=typeof e||!/\breturn\s+([^\/;]|(\/[^\/*]))/.test(e.toString())}function U(e,t){e=e.term;if(void 0===(o=a[e])){var n,i=new RegExp("^"+e),o=[];for(n in root.symbols)i.test(n)&&s(root.symbols[n])&&o.push(n);a[e]=o}t(o)}function K(){var e=t;return t++,e}function N(e,t){e.target.style.minWidth=t.size.width+"px"}root.addGlobal(function(e,t,n){if(n&&s(t)){var i,o=t.name.slice(1);for(i in a)new RegExp("^"+i).test(o)&&a[i].push(o)}}),this.createDialog=function(d,e){var t=d.slice(0,-7),n=root.lookup("createView"),c=$('<div class="observable-palette" id="'+d+'"></div>'),u={},i=$('<input type="text" class="observable-palette-search-box" placeholder="observable name"/>'),o=i[0];i.on("keyup",function(e){13==e.which&&(x(o.value,0,!1),o.value="")}),i.autocomplete({minLength:2,source:U});var a=$('<button type="button">+</button>');a.click(function(){x(o.value,0,!1),o.value=""});var s=$('<button type="button">-</button>');s.on("click",function(e){!function(e){var t=u[e];if(t){var n,i=d+"/"+e+"/",o=i.length,a=root.lookup(e);for(n in a.jsObservers)n.slice(0,o)==i&&a.removeJSObserver(n);for(var s=[],r=0;r<t.length;r++){var l=t[r];l[0].parentNode.parentNode===c[0]?l.slideUp(400,"swing",function(){l.remove()}):s.push(l)}u[e]=s}}(o.value),o.value=""});var r=$("<label></label>"),l=$('<input type="checkbox"/>'),p=l[0];r.append(l),r.append(" Advanced");var h=root.lookup("_view_"+t+"_advanced"),g=h.value();void 0===g?(h.assign(!1,root.scope,n),c.addClass("observable-palette-no-advanced")):g||c.addClass("observable-palette-no-advanced"),h.addJSObserver("repaintView",function(e,t){c.toggleClass("observable-palette-no-advanced",!t),p.checked=t}),l.on("change",function(e){h.assign(e.target.checked,root.scope,n)});var v=$('<div class="observable-palette-toolbox"></div>');v.append(i),v.append(a),v.append(s),v.append(r);var m=[],f=7,b=root.lookup("_view_"+t+"_observables").value();Array.isArray(b)&&(b=0<b.length&&!Array.isArray(b[0])?[b]:b).length>f&&(f=b.length);for(var y=0;y<f;y++){var w=$('<div class="observable-palette-column"></div>');w.sortable({connectWith:".observable-palette-column, .observable-palette-dependencies",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",scroll:!1,tolerance:"pointer",receive:function(e,t){S(e.target,t.item)}}),y<f-1&&w.resizable({handles:"e",resize:N}),m.push(w),c.append(w)}m[0].append(v);var E={register:function(e,t){var n=u[e];void 0===n&&(n=[],u[e]=n);n.push(t)},remove:function(e,t,n){var i=u[e];if(void 0!==i)for(var o=0;o<i.length;o++)i[o]===t&&i.splice(o,1);root.lookup(e).removeJSObserver(d+"/"+e+"/"+n),t.slideUp(400,"swing",function(){t.remove()})},removeDuplicates:S};function S(e,t){for(var n=t.data("observable"),i=t[0],o=u[n],a=0;a<o.length;a++){var s=o[a],r=s[0];if(r!==i&&r.parentNode===e){s.removeFromDialog();break}}}function x(e,t,n){if(Eden.isValidIdentifier(e)){var i,o=u[e];if(void 0===o)o=[],u[e]=o;else for(var a=0;a<o.length;a++){var s=o[a];if(s[0].parentNode===m[t][0]){i=s;break}}void 0===i?(i=function s(r,l,d,c,u,p){c?(c.hasClass("ui-accordion")&&c.accordion("destroy"),c.html("")):(c=$('<div class="observable-palette-obs-box observable-palette-visible" data-observable="'+l+'"></div>'),p&&c.data("editor","read-only"));var i=q.eden.root,o=i.lookup(l),e=o.value(),t=typeof e,n="string"==t,a=!p||n,h=o.eden_definition;p||void 0===o.eden_definition||(V=h.match(/^\S+\s+is\s+(.*?);?$/),rhs=V[1],t="definition");var g=$('<h3><span class="observable-palette-obs-heading">'+l+"</span> </h3>");p&&c.addClass("observable-palette-dependency-value-box");var v=$('<div class="observable-palette-heading-right"></div>');g.append(v),c.append(g);var m=Eden.prettyPrintValue("",e,128,!1,!1),f=$("<a>"+m+"</a>");v.append(f);var b=$("<select></select>");function y(e){var t,e=e.target.value;"hide"!=e?("boolean"==e?t=!1:"number"==e?t=0:"string"==e&&(t=""),o.assign(t,i.scope,EdenSymbol.hciAgent,!0)):u.remove(l,c,d)}p?b.append('<option value="'+t+'">'+t[0].toUpperCase()+t.slice(1)+"</option>"):(b.append('<option value="number">Number</option>'),b.append('<option value="string">Text (String)</option>'),b.append('<option value="boolean">Yes/No (Boolean)</option>'),b.append('<option value="undefined">Undefined</option>')),b.append('<option value="hide">Hide</option>'),b[0].value=t,b.on("change",y),v.on("click",function(e){e.stopPropagation()}),f.on("click",function(e){f.detach(),v.append(b),b.focus()}),b.on("blur",function(e){b.detach(),v.append(f)});var w,E,S,x,I,k,A,C,_,T,D,M,L,U,N,P,h=$("<div></div>");if("definition"==t){var O=$('<div class="observable-palette-definition"></div>');O.append(l+" is "),rhsSpan=$('<span class="observable-palette-definition-rhs" contenteditable="true"></span>'),rhsSpan.append(Eden.htmlEscape(rhs)),O.append(rhsSpan),O.append(";"),O.on("click",function(e){rhsSpan.focus(),O.addClass("focussed")}),rhsSpan.on("blur",function(e){O.removeClass("focussed")}),h.append(O);var B=$('<div class="observable-palette-view-commands"> </div>');h.append(B);var V=$('<a onclick="">Expand</a>');V.click(function(){F.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",0)}),(m=$('<a onclick="">Collapse</a>')).click(function(){F.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",!1)});var H=$('<a onclick="">Hide</a>');H.click(function(){var e=F.find(".observable-palette-obs-box");e.removeClass("observable-palette-visible"),e.slideUp()});var R=$('<a onclick="">Show</a>');R.click(function(){var e=F.find(".observable-palette-obs-box");e.addClass("observable-palette-visible"),e.slideDown()}),B.append(V),B.append(m),B.append(H),B.append(R);var F=$('<div class="observable-palette-dependencies"></div>');F.sortable({connectWith:".observable-palette-column",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",tolerance:"pointer",receive:function(e,t){var n=t.item,i=n.data("observable");o.isDependentOn("/"+i)&&(i!=l||"read-only"==n.data("editor"))||t.sender.sortable("cancel"),2==F.children(".observable-palette-visible").length&&B.slideDown(),u.removeDuplicates(e.target,n)},remove:function(e,t){F.children(".observable-palette-visible").length<2&&B.slideUp()}});var j,W=0;for(J in o.dependencies){var z=o.dependencies[J],J=J.slice(1);void 0===z.eden_definition&&(z=s(r,J,K(),void 0,u,!1),u.register(J,z),F.append(z),W++)}W<2&&B.hide(),H=function(e,t){void 0===(e=e.eden_definition)?s(r,l,d,c,u,!1):f.html(Eden.prettyPrintValue("",t,128,!1,!1))},h.append(F),n&&(j=s(r,l,K(),void 0,u,!0),F.append(j))}else{function G(e){L.fadeOut(250,"linear",function(){e?(L.html("true"),L.css("color","green")):(L.html("false"),L.css("color","red")),L.fadeIn(400,"swing",function(){f.html(e?"true":"false")})})}"number"==t?(R=1==e||-1==e||e!=Math.floor(e)?5e-4:1,n=0==e?(C=0,10):-1<=e&&e<=1?(C=0<e?0:-1,1):e<0?(C=2*e,(C=0!=(k=Number((-e%R).toPrecision(14)))&&k!=R?C+k-R:C)+2*(e-C)):(C=0,2*Math.ceil((e/R).toPrecision(16))*R),j=$('<input type="range" min="'+C+'" max="'+n+'" step="'+R+'" value="'+e+'" class="observable-palette-slider"/>'),w=j[0],j.on("input",function(e){o.assign(parseFloat(w.value),i.scope,EdenSymbol.hciAgent,!0)}),U=$('<table class="observable-palette-number-controls"></table>'),D=$("<tr></tr>"),U.append(D),(k=$('<td colspan="3" class="observable-palette-left-cell observable-palette-right-cell observable-palette-slider-cell"></td>')).append(j),D.append(k),j=$('<tr class="observable-palette-limits"></tr>'),U.append(j),D=$('<td class="observable-palette-advanced observable-palette-left-cell"></td>'),k=$('<input type="number" value="'+C+'" step='+R+'" title="Smallest value"/>'),E=k[0],D.append(k),j.append(D),k.on("input",function(e){var t=e.target.value;""!=t&&(e=parseFloat(t),w.min=t,t=o.value(),0<=e&&t<e&&o.assign(e,i.scope,EdenSymbol.hciAgent,!0))}),I=!1,k.on("focus",function(e){S=e.target.value}),k.on("blur",function(e){var t,n=e.target.value;""==n?(e.target.value=S,w.min=S):(t=parseFloat(n),e=parseFloat(w.max),n=parseFloat(w.step),(e=t+Math.round((e-t)/n)*n)<=t&&(e=0<t?t+Math.ceil((t/n).toPrecision(16))*n:Math.ceil((t/2/n).toPrecision(16))*n)<t+10*n&&(e=t+10*n),w.max=e,_.value=e,o.value()<t&&o.assign(t,i.scope,EdenSymbol.hciAgent,!0))}),C=$('<td class="observable-palette-centre-cell"></td>'),j.append(C),D=$('<div class="observable-palette-number-centre"></div>'),C.append(D),k=$('<label><span class="observable-palette-label">Value&nbsp;</span></label>'),D.append(k),C=$('<input type="number" value="'+e+'" step='+R+'"/>'),A=C[0],k.append(C),C.on("input",function(e){""!=(e=e.target.value)&&(w.value=e,o.assign(parseFloat(e),i.scope,EdenSymbol.hciAgent,!0))}),C.on("focus",function(e){I=!0,x=e.target.value}),C.on("blur",function(e){""==e.target.value?o.assign(parseFloat(x),i.scope,EdenSymbol.hciAgent,!0):((e=o.value())<parseFloat(w.min)&&(E.value=e,w.min=e),w.value=e),I=!1}),C=$('<td  class="observable-palette-advanced observable-palette-right-cell"></td>'),n=$('<input type="number" value="'+n+'" step='+R+'" title="Biggest value"/>'),_=n[0],C.append(n),j.append(C),n.on("input",function(e){w.max=e.target.value}),n=$('<label class="observable-palette-advanced"><span class="observable-palette-label observable-palette-step-label">Step&nbsp;</span></label>'),D.append(n),D=$('<input type="number" value="'+R+'" min="0" title="Slider step size"/>'),(T=D[0]).acceptedValue=R,n.append(D),D.on("input",function(e){var t,n,i=parseFloat(T.value);0<i&&(i==(n=i==(n=Math.floor(i))?(t=String(i).match(/(0*)$/),Math.pow(10,t[1].length)):Math.pow(10,-((i-n).toPrecision(15).replace(/0*$/,"").length-2)))&&i<T.acceptedValue&&(n/=10),T.acceptedValue=i,T.step=n)}),D.on("blur",function(e){var t=parseFloat(T.value);0==t?(T.value=1,T.acceptedValue=1):t<0||isNaN(t)?T.value=T.acceptedValue:(w.step=t,E.step=t,_.step=t,A.step=t)}),H=function(e,t){var n,i,o,a;"number"!=typeof t||void 0!==e.eden_definition?s(r,l,d,c,u,p):(f.html(Eden.prettyPrintValue("",t,128,!1,!1)),I||(n=parseFloat(w.min),i=parseFloat(w.max),e=parseFloat(w.step),t<n?(0==t?o=0:0<t?(o=Math.ceil(t/2/e)*e-e,0!=(a=Number((t%e).toPrecision(14)))&&a!=e&&(o+=a)):(o=2*t,0!=(a=Number((-t%e).toPrecision(14)))&&a!=e&&(o=o+a-e)),w.min=o,o=(E.value=o)+Math.round((i-o)/e)*e,w.max=o,_.value=o):i<t&&(o=n+2*Math.ceil(((t-n)/e).toPrecision(16))*e,w.max=o,_.value=o),w.value=t,A.value=t))},h.append(U)):"boolean"==t?(D=$('<input type="checkbox"/>'),M=D[0],L=$('<span class="bool_text"></span>'),D.on("change",function(e){var t=M.checked;o.assign(t,i.scope,EdenSymbol.hciAgent,!0)}),H=function(e,t){!0!==t&&!1!==t||void 0!==e.eden_definition?s(r,l,d,c,u,p):G(M.checked=t)},G(e),(U=$('<label class="observable-palette-bool"></label>')).append(D),U.append(L),h.append(U)):"string"==t?(P=$('<textarea class="string-input">'+e+"</textarea>"),N=P[0],P.on("input",function(e){var t=N.value;o.assign(t,i.scope,EdenSymbol.hciAgent,!0),N.style.height="",N.style.height=String(N.scrollHeight+4)+"px"}),H=function(e,t){"string"!=typeof t||void 0!==e.eden_definition?s(r,l,d,c,u,p):(N.value=t,N.rows=t.split("\n").length,f.html(Eden.prettyPrintValue("",t,128,!1,!1)))},h.append($('<div class="quote left-quote">&ldquo;</div>')),h.append(P),h.append($('<div class="quote right-quote">&rdquo;</div>'))):H="undefined"==t?(h.append($('<p><span class="result_name">'+l+"</span> is currently undefined.</p>")),p||((e=b.clone())[0].value="undefined",e.on("change",y),(P=$("<label>Choose type: </label>")).append(e),(e=$("<div></div>")).append(P),h.append(e)),function(e,t){void 0===t&&void 0===e.eden_definition||s(r,l,d,c,u,p)}):function(e,t){void 0===t&&void 0===e.eden_definition||s(r,l,d,c,u,p)}}return o.addJSObserver(r+"/"+l+"/"+d,H),a?(p&&h.find("input, textarea").attr("readonly","readonly"),c.append(h),c.accordion({active:"undefined"!=t&&void 0,collapsible:!0,heightStyle:"content"})):g.addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all observable-palette-static-header"),c.removeFromDialog=function(){u.remove(l,c,d)},c}(d,e,K(),void 0,E,!1),o.push(i),r(i)):i.slideUp(400,"swing",function(){i.detach(),r(i)})}function r(e){n?m[t].append(e):(0==t?v.after(e):m[t].prepend(e),e.hide(0,"linear",function(){e.slideDown(400)}))}}if(Array.isArray(b)){for(var I=!1,k=root.lookup("_view_"+t+"_search_language").value(),A=[],C=0;C<b.length;C++){var _=b[C];if(A[C]=[],Array.isArray(_))for(var T=0;T<_.length;T++){var D=_[T];Eden.isValidIdentifier(D)&&!/[\\*+?^$|({[]|(\s+or\s+)/i.test(D)?x(D,C,!0):(M=q.regExpFromStr(D,"",!0,k),A[C].push(M),I=!0)}}if(I)for(name in root.symbols)for(C=0;C<A.length;C++)for(var M,L=A[C],T=0;T<L.length;T++)if((M=L[T]).test(name)){x(name,C,!0);break}}c.dialog({title:e,width:260,height:400+q.scrollBarSize})},q.views.ObservablePalette={dialog:this.createDialog,title:"Observable Palette",category:q.viewCategories.interpretation},e()},EdenUI.plugins.ObservablePalette.title="Observable Palette",EdenUI.plugins.ObservablePalette.description="Provides the ability to change observables using a simple form.",EdenUI.plugins.ScriptGenerator=function(e,t){var c=this;this.createDialog=function(e,t){e.slice(0,-7);var n=$('<div class="script-generator"></div>'),l=($("<div></div>"),$('<div class="script-generator-controls"></div>'),$('<div class="script-generator-controls" style="float: right"></div>'),$('<div class="script-generator-code readonly" spellcheck="false"></div>'));n.append(l);var i=$('<button class="script-generator-refresh">&#xf021;</button>');n.append(i);var d={};l.on("click",".scriptgen-importex",function(e){e=e.currentTarget.getAttribute("data-agent");d[e]?d[e]=!1:d[e]=!0,o()});var o=function(){l.html("");for(var e=c.generateScriptLines(d),t=0;t<e.imports.length;t++)if(""!=e.imports[t]){var n=e.imports[t].split(" ")[1].split("@")[0],i=e.imports[t].split(" "),o='<span class="eden-keyword">'+i[0]+'</span> <span class="eden-path">'+i[1]+"</span>";if(2<i.length)for(var a=2;a<i.length;a++)o+=" "+i[a];n=$('<div class="eden-line"><span class="scriptgen-importex" data-agent="'+n+'">'+(d[n]?"&#xf055;":"&#xf056;")+"</span><span>"+(d[n]?'<span class="eden-comment">## '+e.imports[t]+"</span>":o)+"</span></div>");l.append(n)}l.append($('<div class="eden-line"></div>'));var s=$("<div></div>");l.append(s);var r=e.definitions.join("\n")+"\n## When agents\n\n"+e.agents,r=new Eden.AST(r,void 0,{name:"*JavaScript"});new EdenUI.Highlight(s.get(0)).highlight(r,-1,-1)};i.click(function(){o()}),o(),$('<div id="'+e+'"></div>').html(n).dialog({appendTo:"#jseden-views",title:t,width:790,height:700,minHeight:120,minWidth:230,dialogClass:"scriptgen-dialog"})};this.generateScriptLines=function(e){var t={},n=Eden.Generator.importsScript().split("\n");t.imports=n;n=Eden.Generator.symbolScript(e).split("\n");t.definitions=n;e=Eden.Agent.getActiveAgents(e,!1);return t.agents=e,t},this.baseConstrualSymbols={},this.changeListener=function(e,t){var n=e.last_modified_by;t||"include"==n||(t=e.name.slice(1),void 0!==e.eden_definition&&void 0!==e.definition?c.baseConstrualSymbols[t]={eden_definition:e.eden_definition,last_modified_by:n}:c.baseConstrualSymbols[t]={cached_value:e.cached_value,last_modified_by:n})},e.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(e,t){root.removeGlobal(c.changeListener)}),this.baseConstrualURL="",e.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:e.viewCategories.history},t()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(e){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(e,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=e)})},EdenUI.plugins.StateTimeLine=function(p,e){var n=this;this.createDialog=function(t,e){n.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+t+'-content" class="st-content"></div>').append($('<input id="'+t+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){n.ST.states.push(i("partial"));var e=document.getElementById(t+"-regex").value;""==e&&(e="State "+n.ST.nextBlankState),$("#"+t+"-content-states").append("<div id='stdiv"+p.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+e+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+p.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+p.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(t+"-regex").value="",p.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+t+'-content-states"></div>')),$dialog=$('<div id="'+t+'"></div>').html(code_entry).dialog({title:e,width:300,height:450,minHeight:120,minWidth:230})},n.ST={},n.ST.states=[],n.ST.nextBlankState=0,this.deleteState=function(e){$(document.getElementById("stdiv"+e)).remove()},this.changeState=function(e){for(var t in root.symbols)Eden.isitSystemSymbol(root.symbols[t].name.substring(1,root.symbols[t].name.length))||p.plugins.StateTimeLine.ignoreRE.test(root.symbols[t].name.substring(1,root.symbols[t].name.length))||delete root.symbols[t];p.plugins.ScriptInput.submitEdenCode(p.plugins.StateTimeLine.ST.states[e])};var i=function(e){var t,n=[],i=[],o=[],a=[],s=root.lookup("picture").eden_definition;for(t in null==s?s="picture is [];":s+=";",root.symbols){var r=5,l=root.symbols[t],d=l.eden_definition;if(0==(d=null==d?"@":d).indexOf("proc")){if(r=2,"partial"==e&&Eden.isitSystemAgent(t))continue}else if(0==d.indexOf("func")){if(r=1,"partial"==e&&Eden.isitSystemFunction(t))continue}else if(r=0,"partial"==e&&Eden.isitSystemObservable(t))continue;l=Eden.edenCodeForValue(l.cached_value);p.plugins.StateTimeLine.ignoreRE.test(t)||(1==r?a.push(d):0==r?"@"==l&&"@"==d||("@"==d?i.push(t+" = "+l+";"):n.push(d+";")):2==r?o.push(d):console.log("oh dear error"))}var c=[];c.push("autocalc = 0;");for(var u=0;u<i.length;u++)c.push(i[u]);for(u=0;u<n.length;u++)c.push(n[u]);for(u=0;u<o.length;u++)c.push(o[u]),c.push("");for(u=0;u<a.length;u++)c.push(a[u]),c.push("");return c.push(s),c.push("autocalc = 1;"),c.join("\n")};p.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:p.viewCategories.history},e()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(o,e){this.createDialog=function(e,t){var n={confirmClose:!1};return $dialog=$('<div id="'+e+'"></div>').html('<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){var t,i;function e(e){var t=o.eden.root,e=t.lookup("definitionOf").definition(t)(e);i.send(e)}window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(t="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",i=new WebSocket(t),eden.listenTo("executeBegin",this,function(e,t){"net"!=e&&i.send(t)}),eden.listenTo("beforeAssign",this,function(e,t,n){"net"!=n&&i.send(e.name.slice(1)+"="+Eden.edenCodeForValue(t)+";")}),$("#sl-status").html("<p>Connected to: "+t+"</p>"),i.onerror=function(e){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+t+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),n.confirmClose=!1},i.onmessage=function(e){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(e.data)+"</p>"),eden.execute(e.data,"net","",{name:"/execute"},noop)},i.onopen=function(){n.confirmClose=!0,randomSeedSym=o.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):e("randomSeed"),e("randomGenerator")}):console.log("WebSockets not supported")}),n},o.views.StateListener={dialog:this.createDialog,title:"State Listener",category:o.viewCategories.extension},o.eden.include("plugins/state-listener/state-listener.js-e",e)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(a,e){var s,r=this,n=!1,l=!1;Eden.Agent.importAgent("lib/dynamic","default",void 0,function(){}),r.connect=function(){var i,e=eden.root.lookup("network_address").value(),t=eden.root.lookup("network_port").value(),n=eden.root.lookup("network_key").value();function o(e){var t=a.eden.root,e=t.lookup("definitionOf").definition(t)(e);i.send(JSON.stringify({code:e}))}window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(t="ws://"+e+":"+t+"/",i=new WebSocket(t),Eden.Agent.listenTo("executeline",this,function(e,t){e&&(t=JSON.stringify({action:"executeline",name:e.name,lineno:t}),i.send(t))}),Eden.Agent.listenTo("patch",this,function(e,t,n){e&&(n=JSON.stringify({action:"patch",name:e.name,patch:t,lineno:n}),i.send(n))}),Eden.Agent.listenTo("owned",this,function(e,t){"net"!=t&&i.send(JSON.stringify({action:"ownership",name:e.name,owned:e.owned}))}),eden.listenTo("beforeAssign",this,function(e,t,n){"net"!=n&&(console.log("ASSIGN: "+e.name+" = "+Eden.edenCodeForValue(t)),i.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:t})))}),$("#nr-status").html("<p>Connected to: "+t+"</p>"),i.onopen=function(e){for(var t in i.send(n),randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):o("randomSeed"),o("randomGenerator"),l=!0,Eden.Agent.agents)Eden.Agent.agents[t].owned&&i.send(JSON.stringify({action:"ownership",name:t,owned:!0}));eden.root.lookup("network_connected").assign(!0,eden.root.scope)},i.onerror=function(e){l=!1,eden.root.lookup("network_connected").assign(!1,eden.root.scope),eden.root.lookup("network_error").assign(e,eden.root.scope)},i.onclose=function(){eden.root.lookup("network_connected").assign(!1,eden.root.scope)},r.sendControl=function(e,t){console.log("Send Control: "+e+"= "+t),console.log(t),i.send(JSON.stringify({action:"control",key:e,value:t}))},r.sendAssign=function(e){"net"!=e.last_modified_by&&i.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:e.value()}))},i.onmessage=function(e){s=JSON.parse(e.data);for(var t=0;t<s.length;t++)switch(line=s[t].code,line.action){case"patch":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.applyPatch(line.patch,line.lineno)});break;case"ownership":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.setOwned(line.owned,"net")});break;case"executeline":Eden.Agent.importAgent(line.name,"default",["noexec"],function(e){e.executeLine(line.lineno,!0)});break;case"assign":eden.root.lookup(line.symbol).assign(line.value,eden.root.scope,{name:"net"})}}):console.log("WebSockets not supported")},this.createDialog=function(e,t){return $dialog=$('<div id="'+e+'"></div>').html('<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){l?(l=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")):(eden.root.lookup("network_address").assign($("#nr-ipaddr").val(),eden.root.scope),eden.root.lookup("network_port").assign($("#nr-port").val(),eden.root.scope),eden.root.lookup("network_key").assign($("#nr-key").val(),eden.root.scope),r.connect())}),{confirmClose:!1}},this.playCode=function(e){var t;void 0!==s[e]?(1e3<(t=s[e].time/$("#nr-speedrange").val())?($("#nr-status").html("<p>Next line in "+t+" milliseconds</p>"),n=!0):n&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(s[e].code,"net","",{name:"/execute"},noop),r.playCode(e+1)},t)):$("#nr-status").html("<p>Replay finished</p>")},a.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:a.viewCategories.extension},a.eden.include("plugins/network-remote/network-remote.js-e",e),eden.root.lookup("plugins_network_loaded").assign(!0,eden.root.scope)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(d,e){var c="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");var t=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(t);t=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(t),this.name="window_name",this.createDialog=function(e,t){""==c&&(c=e);var i=[];viewlayoutstr="View Layout";var o,a=5*d.gridSizeY,s=3*d.gridSizeX,n=root.lookup("_views_list").value(),r=this.name;n.forEach(function(e){var t,n;e!=r&&(t=root.lookup("_view_"+e+"_x").value(),n=root.lookup("_view_"+e+"_y").value(),o=[e,t=void 0!==t?t:0,n=void 0!==n?n:0,root.lookup("_view_"+e+"_width").value()+d.scrollBarSize,root.lookup("_view_"+e+"_height").value()+d.titleBarHeight,root.lookup("_view_"+e+"_title").value()],console.log(o),i.push(o))});var l="";i.forEach(function(e,t){l+='<li data-row="'+Math.round(e[2]/a)+'" data-col="'+Math.round(e[1]/s)+'" data-sizex="'+Math.round(e[3]/s)+'" data-sizey="'+Math.round(e[4]/a)+'" data-name="'+e[0]+'" data-num="'+t+'">'+e[5]+" ["+e[0]+"]</li>"});n='<a class="vl-update">Update</a><div class="gridster"><ul>'+l+"</ul></div>";$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[s,a],widget_margins:[0,0],min_cols:Math.round($(window).width()/s),max_cols:Math.round($(window).width()/s),helper:"clone",resize:{enabled:!0},serialize_params:function(e,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y,name:t.name,name:$(t.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var e=gridster.serialize(),n=1,i=1;e.forEach(function(e,t){e.col<n&&(n=e.col),e.row<i&&(i=e.row)}),e.forEach(function(e,t){e="_view_"+e.name+"_y = "+(e.row-i)*a+";_view_"+e.name+"_x = "+(e.col-n)*s+";_view_"+e.name+"_width = "+(e.size_x*s-d.dialogFrameWidth)+";_view_"+e.name+"_height = "+(e.size_y*a-d.dialogFrameHeight)+";";console.log(e),eden.execute(e)})})},d.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:d.viewCategories.environment},e()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(o,e){var h=this;function s(e,t,n){this.edenVar=e,this.guard=t,this.actions=n}function a(e,t,n,i){this.name=e,this.parameters=t,this.definitions=n,this.actionsArr=i}function r(e,t,n){this.name=e,this.definitions=t,this.actionsArr=n,this.queuedActions=new Array}this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(e,t,n,i,o){A(e)}}),s.prototype.toString=function(){return this.guard+" --\x3e "+this.actions},a.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};function l(e,t){for(var n=new Array,i=0;i<t.length;i++){var o,a=new String(t[i]).split("--\x3e");2==a.length&&(o="this_g"+n.length,n.push(new s(o,a[0],a[1])))}return n}function i(){for(var e=document.getElementById("adm-name"),t=e.value.split("(")[0],n=!0,i=0;i<h.templates.length;i++)h.templates[i].name==t&&(n=!1);t&&n?-1!=function(e){var t=new Array,n=e.split("(").length<2?e:(t=e.split("(")[1].split(")")[0].split(","),e.split("(")[0]),i=document.getElementById("adm-definitions"),e=[];0<i.value.length&&(e=i.value.split("\n"));i=(i=document.getElementById("adm-actions")).value.split("\n"),i=l(0,i);return k(n,t,e,i),0}(e.value)&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",h.currIndex=-1):(alert("Please enter a unique name for this template."),e.focus())}function d(e){var t;e<-1?e=h.templates.length-1:e>=h.templates.length&&(e=-1),-1==e?(document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value=""):(t=h.templates[e],document.getElementById("adm-name").value=t.name,document.getElementById("adm-definitions").value=t.definitions.join("\n"),document.getElementById("adm-actions").value=t.actionsArr.join("\n")),h.currIndex=e}this.createTemplateCreator=function(e,t){var n=$("<div></div>");n.html('<div id="'+e+'-input" class="adm-input-code">\t\t\t<div>Name:</div>\t\t\t<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>\t\t\t<div>Definitions:</div>\t\t\t<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>\t\t\t<div>Actions:</div>\t\t\t<div><textarea id="adm-actions" class="adm-actions"></textarea></div>\t\t</div>\t\t<div id="adm-results" class="entitylist-results">\t\t\t<ul id="results"> </ul>\t\t</div>'),$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){i()}},{id:"btn-delete",text:"Delete Template",click:function(){var e;-1<(e=h.currIndex)&&(alert("Deleting template "+h.templates[e].name),h.templates.splice(e),h.currIndex=e-1,d(h.currIndex))}},{text:"Previous",click:function(){d(h.currIndex-1)}},{text:"Next",click:function(){d(h.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};function g(e,t){var n=new Array;for(x in t){var i=t[x];n.push(i.replace(/this/g,e))}return n}function v(e){var t;for(x in h.templates)if(h.templates[x].name==e){t=h.templates[x];break}return t}function c(){for(var e=document.getElementById("template-menu"),t=e.options[e.selectedIndex].value,n=v(t),i=document.getElementById("entity-name"),o=i.value,a=!0,s=0;s<h.entities.length;s++)h.entities[s].name==o&&(a=!1);if(0!=a){var r=$("#instantiate-params").find("input"),l=0,d=new Array;for(x in r){var c,u,p=r[x];"text"==p.type&&(c=S(n.parameters[l]),u=S(p.value),d.push(p),eden.executeEden(o+"_"+c+" is "+u+";"),l++)}e=g(o,n.definitions);-1!=m(o,e)&&(b(o,e,n.actionsArr),alert("Successfully added instantiation of "+t+" as "+o),function(e,t){for(x in e.value="",t)t[x].value=""}(i,d))}else alert("please enter a unique name for this instantiation")}var m=function(e,t){e=S(e);for(var n=0;n<t.length;n++){var i=S(t[n]);eden.executeEden(e+"_"+i),h.definitions.push(e+"_"+i)}};this.createInstantiator=function(e,t){var n=$("<div></div>"),n=$('<div id="template-instantiator">\t\t\t\t\t<div>Templates:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<select id="template-menu">\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t\t<div>Entity name:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<textarea id="entity-name"></textarea>\t\t\t\t\t</div>\t\t\t\t\t<div>Parameters:</div>\t\t\t\t\t<div id="instantiate-params"></div>\t\t\t\t</div>');for(x in $dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){c()}}]}),h.templateList=new EdenUI.plugins.ADM.TemplateList,h.templates){var i=h.templates[x];h.templateList.addTemplate(i.name,i.parameters)}};function u(e){var t,n;for(x in h.entities)if(h.entities[x].name==e){t=h.entities[x],n=x;break}if(null!=t){for(x in h.entities.splice(n,1),h.actionLists)if(h.actionLists[x].entityName==e){n=x,h.actionLists[x].remove();break}null!=h.actionLists&&h.actionLists.splice(n,1),null!=h.entityList&&h.entityList.removeEntity(e)}else alert(e+" doesn't exist to delete.")}function f(e,t,n){var i,o=v(e);if(null==o)return alert("no template with name "+e),-1;for(x in h.entities)if(h.entities[x].name==n)return alert("Please enter a unique entity name"),-1;if((i=""==t?[]:-1==t.indexOf(",")?[t]:t.split(",")).length!=o.parameters.length)return alert("not enough parameters to instantiate "+o),-1;for(x in i){var a=S(o.parameters[x]),s=S(i[x]);eden.executeEden(n+"_"+a+" is "+s+";")}return e=g(n,o.definitions),-1!=(t=m(n,e))&&b(n,e,o.actionsArr),t}var b=function(e,t,n){var i=function(e,t){var n=new Array;for(x in t){var i=t[x],o=i.guard.replace(/this/g,e),a=i.actions.replace(/this/g,e),i=i.edenVar.replace(/this/g,e);n.push(new s(i,o,a))}return n}(e,n),o=new r(e,t,i);for(x in h.entities.push(o),i){var a=i[x],a=a.edenVar+" is "+a.guard+";";eden.executeEden(a)}null!=h.actionLists&&(n=new EdenUI.plugins.ADM.ActionsList(e),h.actionLists.push(n),p(o,n)),null!=h.entityList&&h.entityList.addEntity(e,t,i)};this.actionPush=function(e){h.selectedActions.push(e)},this.actionRemove=function(e){var t=new Array;for(x in h.selectedActions){var n=h.selectedActions[x];n!=e&&t.push(n)}h.selectedActions=t},this.refreshHumanPerspective=function(){for(x in h.entities){var e,t=h.entities[x];for(y in h.actionLists){var n=h.actionLists[y];if(n.entityName==t.name){e=n;break}}e.clear();var i=[];for(x in t.queuedActions){var o,a=t.queuedActions[x].split(";"),s=a[0];0<s.length&&(a.splice(0,1),o=!0,0<a[0].length&&(i.push(a.join(";")),o=!1),e.addAction(s,o))}t.queuedActions=i,p(t,e)}};var p=function(e,t){for(var n=0;n<e.actionsArr.length;n++){var i,o,a=e.actionsArr[n];!0===eden.root.lookup(a.edenVar).value()&&(o=(i=a.actions.split(";"))[0],a=!0,i.splice(0,1),0<i[0].length&&(e.queuedActions.push(i.join(";")),a=!1),t.addAction(o,a))}};this.createHumanPerspective=function(e,t){var n=$("<div></div>"),n=$('<div id="human-perspective" class="actionlist"></div>');for(x in $dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){o.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){!function(){for(x in h.selectedActions){var e=h.selectedActions[x],e=S(e);if(945==e.charCodeAt(0))if("r"==e[2])i=(i=e.split("(")[1]).substring(0,i.length-1),u(i);else if("i"==e[2]){var t=e.split("(")[1],n=e.split("(")[2].split(")")[0],i=e.split("as")[1];if(-1==f(t,n,i))break}else alert("Action on another entity must one of _remove(entity_name), _r, _instantiate(template(param_value) as entity_name) or _i");else eden.executeEden(e+";")}h.selectedActions=new Array,o.plugins.ADM.refreshHumanPerspective()}()}}]}),h.actionLists=new Array,h.entities){e=h.entities[x].name;h.actionLists.push(new EdenUI.plugins.ADM.ActionsList(e))}o.plugins.ADM.refreshHumanPerspective()};this.entityPush=function(e){h.selectedEntities.push(e)},this.entityRemove=function(e){var t=new Array;for(x in h.selectedEntities){var n=h.selectedEntities[x];n!=e&&t.push(n)}h.selectedEntities=t};this.createInstanceList=function(e,t){var n=$("<div></div>");for(x in n.html('<div id="entity-list" class="instance-list"></div>'),$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){!function(){for(x in h.selectedEntities)u(h.selectedEntities[x]);alert("Entities successfully deleted."),h.selectedEntities=new Array}()}}]}),h.entityList=new EdenUI.plugins.ADM.EntityList,h.entities){var i=h.entities[x];h.entityList.addEntity(i.name,i.definitions.join("\n"),i.actionsArr.join("\n"))}};function w(e){return e=e.split(":")[1],S(e.split("(")[0])}function E(e){return 1<(e=e.split(":")[1].split("(")[1]).length?e.split(")")[0].split(","):[]}var S=function(e){for(;32==e.charCodeAt(0)||9==e.charCodeAt(0);)e=e.substring(1,e.length);for(;32==e.charCodeAt(e.length-1)||9==e.charCodeAt(e.length-1);)e=I(e);return e},I=function(e){return e.substring(0,e.length-1)},k=function(e,t,n,i){for(x in h.templates)if(h.templates[x].name==e)return alert("Templates must have unique names."),-1;i=new a(e,t,n,l(0,i));return h.templates.push(i),null!=h.templateList&&h.templateList.addTemplate(e,t),1},A=function(e){var t=e.split("\n"),n=new Array,i=new Array,o=new Array,a=!1,s=!1,r=!1;for(x in t){var l,d=t[x];if(""!=(d=S(d)))if(0==r)if("{"==d[0])r=!0,-1!=d.indexOf("name:")&&(h=w(d),n=E(d));else{var c=d.split("(")[0],u=d.split("(")[1].split(")")[0],p=I(S(d.split("as")[1]));if(-1==(p=f(c,u,p)))break}else if(1==a)-1!=d.indexOf("}")&&(d=I(d),a=!1),0<d.length&&i.push(d);else if(1==s)-1!=d.indexOf("}")&&(d=I(d),s=!1),0<d.length&&o.push(d);else if("}"==d[0]){var r=!1,p=k(h,n,i,o),h="",n=new Array,i=new Array,o=new Array;if(-1==p)return}else-1!=d.indexOf("name:")?(h=w(d),n=E(d)):-1!=d.indexOf("definitions:")||-1!=d.indexOf("defs:")?(a=!0,1<(d=S(d)).split("{").length&&(-1!=(l=S(d.split("{")[1])).indexOf("}")&&(l=I(l),a=!1),0<l.length&&i.push(l))):-1!=d.indexOf("actions:")&&(s=!0,1<(d=S(d)).split("{").length&&(-1!=(l=S(d.split("{")[1])).indexOf("}")&&(l=I(l),s=!1),0<l.length&&o.push(l)))}};this.createAdvancedInput=function(e,t){var n=document.createElement("textarea");n.style.boxSizing="border-box",n.style.width="100%",n.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(n),$dialog=$('<div id="'+e+'"></div>').html($code_entry).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var e=n.value;A(e),n.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},o.addViewCategory("adm","Abstract Definitive Machine"),o.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:o.viewCategories.adm},o.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:o.viewCategories.adm},o.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:o.viewCategories.adm},o.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:o.viewCategories.adm},o.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:o.viewCategories.adm},e()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(e,t){t=new EdenUI.plugins.ADM.Template(e,t);t.element.appendTo(this.templateList),this.templates.push(t)},EdenUI.plugins.ADM.Template=function(e,t){this.template=e,this.element=$("<option value="+e+">"+e+"</option>");var n=this.showParamInput;this.element.click(function(){n(t)}),""==document.getElementById("instantiate-params").innerHTML&&n(t)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(e){var t=document.getElementById("instantiate-params");for(x in t.innerHTML="",e){var n=e[x],i=document.createElement("label");i.innerHTML=n+":",t.appendChild(i);i=document.createElement("input");i.type="text",t.appendChild(i);i=document.createElement("br");t.appendChild(i)}},EdenUI.plugins.ADM.ActionsList=function(e){var t=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+e),this.actionresults.innerHTML="<label><b>Actions for "+e+":</b></label>",t.appendChild(this.actionresults),this.actions=new Array,this.entityName=e},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(e,t){t=new EdenUI.plugins.ADM.Action(e,t);t.element.appendTo(this.actionresults),this.actions.push(t)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){document.getElementById("human-perspective").removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(e,t){this.action=e,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var n=!1;this.element.hover(function(){0==n?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==n?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){n=0==n?(edenUI.plugins.ADM.actionPush(e),$(this).css("backgroundColor","#6666CC"),!0):(edenUI.plugins.ADM.actionRemove(e),$(this).css("backgroundColor","white"),!1)}),this.update(t)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(e){var t='<li class="type-function"><span class="result_name">',t=1==e?t+this.action+"</span></li>":t+this.action+" ... </span></li>";this.element.html(t)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(e,t,n){n=new EdenUI.plugins.ADM.Entity(e,t,n);n.element.appendTo(this.entityList),this.entities.push(n)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(e){var t;for(x in this.entities)if(this.entities[x].entity==e){t=x;break}this.entities.splice(t,1);var n=document.getElementById("element-"+e);this.entityList.removeChild(n)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(t,n,i){this.entity=t,this.element=$('<div class="entitylist-element" id=element-'+t+"></div>");var o='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(o);var n=n,i=i,a=!1;this.element.hover(function(){0==a?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==a?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){var e;a=this.innerHTML==o?((e=document.createElement("div")).innerHTML="<label>Definitions:</label><br>\t\t\t\t\t<textarea disabled>"+n+"</textarea><br>\t\t\t\t\t<label>Actions:</label><br>\t\t\t\t\t<textarea disabled>"+i+"</textarea><br>",this.appendChild(e),edenUI.plugins.ADM.entityPush(t),$(this).css("backgroundColor","#6666CC"),!0):(this.innerHTML=o,edenUI.plugins.ADM.entityRemove(t),$(this).css("backgroundColor","white"),!1)})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var e='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(e)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.DBView=function(e,t){this.createDialog=function(e,t){var l,d,n=$('<div id="'+e+'-content" class="dbview-content"><div class="dbview-controls"><div class="dbview-select"><span class="dbview-label">Query:</span><input class="dbview-select-text" type="text"></input></div></div></div>'),c=$('<table class="dbview-table"></table>');c.appendTo(n);var i=n.find(".dbview-select-text").get(0),u=void 0,o=e.slice(0,-7),a=new Eden.Agent(void 0,"view/db/"+o+"/config"),s="_view_"+o+"_source";function r(){0==Array.isArray(u)&&(u=[["Value"],[[u]]]);for(var e=c.get(0);e.firstChild;)e.removeChild(e.firstChild);if(l=u[0],d=u[1],Array.isArray(l)||(d=u,l=[["List"]]),Array.isArray(d)){for(var t=$("<tr></tr>"),n=0;n<l.length;n++){var i=$("<th></th>");i.html(l[n]),i.appendTo(t)}t.appendTo(c);for(var o=0;o<d.length;o++){for(var a=$("<tr></tr>"),n=0;n<l.length;n++){var s="scope"==l[n]?$('<td class="dbview-disabled"></td>'):$("<td contenteditable></td>");s.appendTo(a);var r=Array.isArray(d[o])?d[o][n]:d[o];s.html("<div class='dbview-cellcontent'>"+Eden.edenCodeForValue(r)+"</div>")}a.appendTo(c)}}}return a.declare(s),c.on("input","td",function(e){var t=e.target.cellIndex,n=e.target.parentNode.rowIndex-1;t<0||n<0||e.target.textContent}).on("mouseenter","td",function(e){e.target.cellIndex,e.target.parentNode.rowIndex}).on("mouseleave","td",function(e){c.find(".dbview-dependant").removeClass("dbview-dependant"),c.find(".dbview-dependency").removeClass("dbview-dependency")}),n.on("input",".dbview-select-text",function(e){a.setSource("_view_"+o+"_source is "+i.value),a.execute(!0,!0)}),u=a.state[s],r(),a.on(s,function(e,t){u=t,r()}),$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dbview-dialog"}),{confirmClose:!0}},e.views.DBView={dialog:this.createDialog,title:"Database Viewer",category:e.viewCategories.visualization},t()},EdenUI.plugins.DBView.title="DBView",EdenUI.plugins.DBView.description="Display a table showing entire database contents.",EdenUI.plugins.SpeechSynthesis=function(v,e){var h=!1;function m(e,t){var n,i,o,a,s,r,l,d,c,u,p;h?h=!1:(n=root.lookup("speak"),c=root.lookup("speakingList"),i=root.lookup("speakingIndex"),o=root.lookup("speaking"),a=root.lookup("speakingID"),s=root.lookup("speakingText"),r=root.lookup("speakingSpeech"),u=root.lookup("speakingCharIndex"),l=c.value(),d=i.value(),c=window.speechSynthesis.paused,window.speechSynthesis.cancel(),c&&window.speechSynthesis.pause(),d=d||1,""!=e&&("finished"==e?"string"==typeof(p=s.value())&&u.assign(p.length+1,root.scope,n):"interrupted"==e&&(h=!0),p=a.value(),eden.isValidIdentifier(p)&&root.lookup(p+"_status").assign(e,root.scope,n)),t&&d++,u.assign(1,root.scope,n),root.lookup("speakingTime").assign(0,root.scope,n),Array.isArray(l)&&d<=l.length?(o.value()||o.assign(!0,root.scope,n),(e=l[d-1])instanceof SpeakingWords&&!e.cancelled?(e.prepareUtterance(),u=e.utterance,p=e.id,a.assign(p,root.scope,n),eden.isValidIdentifier(p)&&root.lookup(p+"_status").assign("speaking",root.scope,n),s.assign(u.text,root.scope,n),r.assign(e,root.scope,n),t&&i.assign(d,root.scope,n),e.hasBeenSpoken=!0,window.speechSynthesis.speak(u)):m("",!0)):(o.assign(!1,root.scope,n),a.assign("",root.scope,n),s.assign("",root.scope,n),r.assign(void 0,root.scope,n),Array.isArray(l)&&i.assign(l.length+1,root.scope,n)))}function f(e,t){var n,i,o,a,s=window.speechSynthesis.getVoices();e&&(a=-1!=(i=(e=e.toLowerCase()).indexOf("-"))?(o=e.slice(0,i),!0):(o=e,!1)),t&&(n=new RegExp("\\b"+t+"\\b","i"));for(var r=void 0,l=!1,d=!1,c=!1,u=!1,p=0;p<s.length;p++){var h=s[p],g=h.lang,v=!1,m=!1,f=!1;if(e&&g&&(e==(g=g.toLowerCase())?m=v=!0:(o==g||-1!=(i=g.indexOf("-"))&&g.slice(0,i)==o)&&(v=!0)),t&&n.test(h.name)&&(f=!0),(!d&&!g&&!l||!d&&(!g||!e)&&h.default||v&&!d||a&&m&&!c||v&&!a&&h.default||m&&h.default||f&&!u&&(!e||!g&&!d||v))&&(!u||f||v&&!d)){if(l=!v,d=v,c=m,u=f,(!t||u)&&(c||d&&!a)&&h.default)return h;r=h}}return r=void 0===r?s[0]:r}root.lookup("speakingList").addJSObserver("sendToTTS",function(e,t){var n=root.lookup("speak");if(Array.isArray(t)){var i=root.lookup("speakingIndex"),o=i.value();if(o>t.length+1)i.assign(t.length+1,root.scope,n);else if(o<=t.length){for(var a=o<1?0:o-1;a<t.length;a++){var s=t[a];s instanceof SpeakingWords&&(s.prepareUtterance(),s=s.id,eden.isValidIdentifier(s)&&root.lookup(s+"_status").assign("waiting",root.scope,n))}root.lookup("speaking").value()?t[o-1]!==root.lookup("speakingSpeech").value()&&m("interrupted",!1):m("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(e,t){if("speak"!=e.last_modified_by){var n=root.lookup("speakingList").value();if(Array.isArray(n)&&t<=n.length){root.lookup("speaking").value()?m("interrupted",!1):m("",!1);for(var i=t;i<n.length;i++)n[i]instanceof SpeakingWords&&n[i].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(e,t){t?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(t,e,n,i,o,a,s){var r,l,d,c,u;this.id=t,this.utterance=new window.SpeechSynthesisUtterance(String(e)),this.hasBeenSpoken=!1,d=void 0===i?(c=v.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===c&&(c="native"),!0):(c=i,!1),this.utterance.volume=o;var p=void 0===a?(null!==(r=v.getOptionValue("speechSynthDefaultRate"))&&(this.utterance.rate=parseFloat(r)),!0):(this.utterance.rate=a,!1),h=void 0===s?(null!==(r=v.getOptionValue("speechSynthDefaultPitch"))&&(this.utterance.pitch=parseFloat(r)),!0):(this.utterance.pitch=s,!1),g=this;Object.defineProperty(this,"text",{get:function(){return g.utterance.text},set:function(e){g.utterance.text=e},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return g.utterance.lang},set:function(e){var t;e?(-1!=(t=e.indexOf("-"))&&(e=e.slice(0,t+1)+e.slice(t+1).toUpperCase()),g.utterance.lang=e):g.utterance.lang="",l=!1;e=f(e,c);g.utterance.voiceURI=e.voiceURI,g.utterance.voice=e},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return c},set:function(e){c=e,d=!1;e=f(this.utterance.lang,c);g.utterance.voiceURI=e.voiceURI,g.utterance.voice=e},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return g.utterance.volume},set:function(e){g.utterance.volume=e},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return g.utterance.rate},set:function(e){g.utterance.rate=e,p=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return g.utterance.pitch},set:function(e){g.utterance.text=e,h=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return u},set:function(e){(u=e)&&g.id&&root.lookup(g.id+"_status").assign("cancelled",root.scope,root.lookup("SpeakingWords"))},enumerable:!0}),this.toString=function(){var e="SpeakingWords("+Eden.edenCodeForValue(t)+', "'+g.utterance.text+'", ';return l?e+="@, ":e=e+'"'+g.utterance.lang+'", ',d?e+="@, ":e=e+Eden.edenCodeForValue(c)+", ",e=e+g.utterance.volume+", ",p?e+="@, ":e=e+this.utterance.rate+", ",h?e+="@)":e=e+this.utterance.pitch+")",e},void 0===n?(this.lang=v.getOptionValue("speechSynthDefaultLanguage"),l=!0):this.lang=n,!eden.isValidIdentifier(t)||void 0===(n=root.lookup(t+"_status")).value()&&n.assign("not queued",root.scope,root.lookup("SpeakingWords")),this.prepareUtterance=function(){var e;!g.hasBeenSpoken||"chrome"in window||((e=new window.SpeechSynthesisUtterance(g.utterance.text)).lang=g.utterance.lang,e.volume=g.utterance.volume,e.rate=g.utterance.rate,e.pitch=g.utterance.pitch,e.voiceURI=g.utterance.voiceURI,e.voice=g.utterance.voice,e.onboundary=g.utterance.onboundary,e.onend=g.utterance.onend,e.onerror=g.utterance.onerror,g.utterance=e,g.hasBeenSpoken=!1)},this.utterance.onboundary=function(e){var t=root.lookup("speak");root.lookup("speakingCharIndex").assign(e.charIndex+1,root.scope,t);e=e.elapsedTime;e<=1e7&&root.lookup("speakingTime").assign(e,root.scope,t)},this.utterance.onend=function(){m("finished",!0)},this.utterance.onerror=function(){m("error",!0)}},Eden.Selectors.execute("plugins > speech-synthesis > speech-synthesis",eden.root.scope,function(){eden.root.lookup("plugins_speech_sythesis_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),e&&e()})},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!",EdenUI.plugins.MIDI=function(e,o){var r=this,s=!1;Object.defineProperty(this,"initialized",{get:function(){return s},enumerable:!0});var l=[];this.addSoftwareDriver=function(e){console.log("New JavaScript MIDI driver registered."),l.push(e),s&&e()};var d=[],c=[],u=root.lookup("midiNumberOfOutputs");u.assign(0,eden.root.scope);var p=root.lookup("midiNumberOfInputs");p.assign(0,eden.root.scope);var h={};function g(e,t){if(e<d.length){for(var n=d[e],i=0;i<t.length&&i<16;i++){var o=t[i];Number.isInteger(o)&&1<=o&&o<=128&&n.send([192+i,o-1])}16<t.length&&eden.error(new Error("MIDI programs list is too long."))}}this.addSoftSynth=function(e){var t;d.push(e),u.assign(d.length,eden.root.scope),console.log('Added software synthesizer "'+e.name+'".'),s&&(t=d.length-1,void 0!==(e=h[t])&&g(t,e.value()))},this.addSoftInput=function(e){c.push(e),p.assign(c.length,eden.root.scope),console.log('Added software input "'+e.name+'".')};var n=0,a=0;function v(e){if(void 0===e)return n;if(Number.isInteger(e)){if(e<1||s&&e>d.length)throw new Error("No MIDI output device exists with device number "+e);return e-1}if(s&&"string"==typeof e){for(var t=0;t<d.length;t++)if(e==d[t].name)return t;throw new Error("No MIDI output device exists with device name "+e)}throw new Error("The output device must be given as a positive integer.")}Object.defineProperty(this,"outputNames",{get:function(){for(var e=[],t=0;t<d.length;t++)e.push(d[t].name);return e},enumerable:!0}),Object.defineProperty(this,"inputNames",{get:function(){for(var e=[],t=0;t<c.length;t++)e.push(c[t].name);return e},enumerable:!0}),this.roundValue=function(e){if("number"==typeof e)return e<=0?0:e<=1?1:127<=e?127:Math.round(e)},this.isValidNote=function(e){return Number.isInteger(e)&&-20<=e&&e<=107},this.loadPrograms=function(e,t){e=v(e);e=d[e];if(!Array.isArray(t))throw new Error("MIDI programs must be given as a list.");for(var n=t.length,i=new Array(n),o=0;o<n;o++){var a=t[o];if(!(Number.isInteger(a)&&1<=a&&a<=128))throw new Error("Item "+o+" must be an integer between 1 and 128.");i[o]=a-1}e.loadPrograms&&e.loadPrograms(i)},this.bindPrograms=function(e,n){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");n=v(n),Array.isArray(e.value())||void 0!==e.definition||e.assign([1],eden.root.scope);function t(e,t){Array.isArray(t)?s&&g(n,t):eden.error(new Error("Illegal MIDI programs list: "+Eden.edenCodeForValue(t)))}t(0,e.value()),e.addJSObserver("bind",t),h[n]=e};var m=!(this.getInputs=function(){return c}),f=[],b=[];this.initialize=function(e,t){e=e.value();function a(e){if(e<l.length)0==e&&console.log("Found "+l.length+" MIDI drivers written in JavaScript."),l[e](a,[e+1]);else{for(var t in h)g(t,h[t].value());m=!(s=!0),eden.root.lookup("plugins_midi_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),o&&o(),console.log("Done.");for(var n=0;n<f.length;n++)f[n].apply(null,b[n])}}s?e.apply(null,t):(f.push(e),b.push(t),m||(m=!0,console.log("Initializing MIDI..."),window.navigator.requestMIDIAccess?window.navigator.requestMIDIAccess().then(function(e){if(e){var t=e.outputs.values(),n=t.next();for(n.done&&console.log("No MIDI output devices found.");!n.done;){var i=n.value;console.log("Found MIDI output device "+i.name+"."),d.push(i),n=t.next()}for((n=(t=e.inputs.values()).next()).done&&console.log("No MIDI input devices found.");!n.done;){var o=n.value;console.log("Found MIDI input device "+o.name+"."),c.push(o),n=t.next()}u.assign(d.length,eden.root.scope),p.assign(c.length,eden.root.scope)}a(0)},function(e){e="Unable to access WebMIDI: "+e;console.log(e),eden.error(new Error(e)),a(0)}):(console.log("This browser does not support the WebMIDI API.  No access to hardware MIDI devices is possible."),a(0))))},this.mergeMessageLists=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(Array.isArray(i))t.push(i);else if(void 0!==i)throw new Error("Item "+n+" must be a list of MIDI messages.")}for(var o=t.length,a=new Array(o),s=0,n=0;n<o;n++)a[n]=0,s+=t[n].length;for(var r=new Array(s),n=0;n<s;n+=2){for(var l,d,c=1/0,u=0;u<o;u++){var p,h,g=a[u];g<t[u].length&&(h=(p=t[u])[g],(g=p[g+1])<c&&(c=g,d=h,l=u))}r[n]=d,r[n+1]=c,a[l]=a[l]+2}return r},this.playMIDI=function(e,t,n){if(e=v(e),void 0===t)t=0;else if("number"!=typeof t)throw new Error("The delay must be a number.");if(!Array.isArray(n))throw new Error("The message stream must be an array.");for(var i=d[e],o=window.performance.now()+t,a=0;a<n.length;a+=2)i.send(n[a],o+n[a+1])};var y={};this.alterNote=function(e,t,n,i,o,a){var s=y[e],t=d[v(t)];r.isValidNote(i)?i===s?0<o&&(a?t.send([144+n,i+20,r.roundValue(o)]):t.send([144+n,i+20,0])):(0<o?(void 0!==s&&t.send([144+n,s+20,0]),a&&t.send([144+n,i+20,r.roundValue(o)])):o<0?void 0!==s&&t.send([128+n,s+20,r.roundValue(-o)]):void 0!==s&&t.send([144+n,s+20,0]),y[e]=i):void 0!==s&&t.send([144+n,s+20,0])},this.alterVelocity=function(e,t,n,i,o){i===y[e]&&void 0!==i&&(t=d[v(t)],0<o?t.send([160+n,i+20,r.roundValue(o)]):o<0?t.send([128+n,i+20,r.roundValue(-o)]):t.send([144+n,i+20,0]))};var w={volume:7};this.bindControlChange=function(e,t,n,i){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");var o,a=d[v(t)];if("string"==typeof i){if(void 0===(o=w[i.toLowerCase()]))throw new Error("Unknown control name "+i)}else{if(!(Number.isInteger(i)&&0<=i&&i<=127))throw new Error("The control must be specified either as a string or as an integer between 0 and 127 inclusive.");o=i}function s(e,t){t=r.roundValue(t);void 0!==t&&a.send([176+n,o,t])}s(0,e.value()),e.addJSObserver("bind",s)};var E=16,S=new Array(E),x=root.lookup("midiInputDevice"),I=root.lookup("midiInputTimestamp"),k=root.lookup("midiInputMessage"),A=0,C=0,_=root.lookup("midiInputMessageCount");function t(e){root.lookup("startMIDIInput");if(A==C)(S=S.length>E?new Array(E):S)[0]=e,A=1,C=0;else{for(var t=e.timeStamp,n=A-1;C<=n&&!(S[n].timeStamp<=t);n--);n==A-1?S[A]=e:S.splice(n+1,0,e),A++}_.assign(A-C,eden.root.scope)}this.startInput=function(e){if(void 0===e)for(i=0;i<c.length;i++)c[i].onmidimessage=t;else e=function(e){if(void 0===e)return a;if(Number.isInteger(e)){if(e<1||s&&e>c.length)throw new Error("No MIDI input device exists with device number "+e);return e-1}if(s&&"string"==typeof e){for(var t=0;t<c.length;t++)if(e==c[t].name)return t;throw new Error("No MIDI input device exists with device name "+e)}throw new Error("The input device must be given as a positive integer.")}(e),c[e].onmidimessage=t},this.fetchInputMessage=function(){var e,t,n;C!=A&&(root.lookup("startMIDIInput"),e=S[C],t=S.length,C++,2*E<=t&&.8*t-1<C&&(S.splice(0,C),A-=C,C=0),(t=e.target)&&(n=t.name),root.beginAutocalcOff(),x.assign(n,root.scope),I.assign(e.timeStamp,root.scope),k.assign(e.data,eden.root.scope),_.assign(A-C,eden.root.scope),root.endAutocalcOff())},this.clearInputMessages=function(){S.length>E&&(S=new Array(E)),C=A=0,_.assign(0,eden.root.scope)},Eden.Selectors.execute("plugins > midi > midi",eden.root.scope,function(){})},EdenUI.plugins.MIDI.title="MIDI",EdenUI.plugins.MIDI.description="Adds musical capabilities to JS-EDEN.",EdenUI.plugins.MIDIDotJS=function(s,e){var d="plugins/midi/emulation/soundfonts/FluidR3_GM/",c=new Array(127);function t(){s.plugins.MIDI.addSoftwareDriver(function(n,i){var l,o={name:"MIDI.js",loadPrograms:function(e){for(var t=0;t<e.length;t++)c[e[t]]=!0;l.loadPlugin({soundfontUrl:d,instrument:e})},send:function(e,t){var n,i=e[0],o=240&i,a=15&i,s=e[1],r=e[2];switch(void 0===t?t=0:t-=window.performance.now(),o){case 128:l.noteOff(a,s,t/1e3);break;case 144:0==r?l.noteOff(a,s,t/1e3):l.noteOn(a,s,r,t/1e3);break;case 176:7===s?(n=r/127*(r/127)*64,MIDI.setVolume(a,n,t/1e3)):console.log("Unable to change MIDI control number "+s+" using MIDI.js");break;case 192:c[s]||(c[s]=!0,l.loadPlugin({soundfontUrl:d,instrument:s})),l.setInstrument(a,s,t);break;default:console.log("Unable to map MIDI command "+i.toString(16)+" to MIDI.js")}},clear:function(){}},a=["inc/shim/Base64binary.js"];"true"==s.getOptionValue("developer")?a.push("build/MIDI.js"):a.push("build/MIDI.min.js"),function e(t){t==a.length?(l=window.MIDI).loadPlugin({soundfontUrl:d,onsuccess:function(){s.plugins.MIDI.addSoftSynth(o),n&&n.apply(this,i)}}):$.ajax({url:"plugins/midi/emulation/lib/MIDI.js/"+a[t],success:function(){e(t+1)}})}(0)}),e()}s.plugins.MIDI?t():s.loadPlugin("MIDI",t)},EdenUI.plugins.MIDIDotJS.title="MIDI.JS",EdenUI.plugins.MIDIDotJS.description="Uses the MIDI.js JavaScript library to add a software synthesizer for users who cannot access a MIDI instrument via WebMIDI and the basic MIDI plug-in.",EdenUI.plugins.MIDIFileInput=function(n,e){var l={};function t(){n.plugins.MIDI.addSoftwareDriver(function(e,t){n.plugins.MIDI.addSoftInput(l),e&&e.apply(this,t)})}l.name="MIDI Input from MIDI File",this.queue=function(o){var a=window.performance.now(),s=o.length;function r(e){e=new Uint8Array(e.slice(1));return new MIDIMessageEvent("midimessage",{target:l,data:e})}!function t(n){var i,e;n!=s&&(i=o[n],0<(e=a+i[0]-window.performance.now())?window.setTimeout(function(){var e=r(i);l.onmidimessage(e),t(n+1)},e):(e=r(i),l.onmidimessage(e),t(n+1)))}(0)},n.plugins.MIDI?t():n.loadPlugin("MIDI",t)},EdenUI.plugins.MIDIFileInput.title="MIDI File Input",EdenUI.plugins.MIDIFileInput.description="Use a MIDI file to simulate MIDI file input.",EdenUI.plugins.DependencyMap=function(d,e){var c=this;function h(e){var t=e.value(),n=typeof t,i=null,i=void 0===t?{code:"",face:"FontAwesome"}:"number"==n?{code:Math.round(t),face:"arial"}:"string"==n?{code:"",face:"FontAwesome"}:"boolean"==n?{code:t?"":"",face:"FontAwesome"}:"function"==n?{code:"",face:"FontAwesome"}:Array.isArray(t)?{code:"",face:"FontAwesome"}:t instanceof CanvasImage?{code:"",face:"FontAwesome"}:t instanceof Text?{code:"",face:"FontAwesome"}:{code:"",face:"FontAwesome"};return{id:e.name,label:e.name,shape:"icon",icon:i,face:"FontAwesome"}}this.createDialog=function(e,t){var n={nodes:new vis.DataSet([]),edges:new vis.DataSet([])},i=$('<div id="'+e+'" style="overflow: hidden"></div>'),e=$('<div class="dependency-map-content"></div>');i.append(e);var o=new vis.Network(e.get(0),n,{}),e=$('<div class="dependency-map-controls"></div>');i.append(e);var a=$('<input type="text" placeholder="search"/>'),s=a.get(0),n=$('<input type="checkbox" checked="checked"/>'),r=n.get(0);function l(){var e=""==s.value?/^$/:d.regExpFromStr(a,"",r.checked);c.updateGraph(o,e)}e.append(a),e.append($("<label>Exact matches only </label>").append(n)),a.on("input",l),n.on("change",l),i.on("mouseenter",l),i.dialog({appendTo:"#jseden-views",title:t,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(e,t){e.re=t,e.newNodes=[],e.newEdges=[];var n,i,o={};for(n in root.symbols){var a=root.symbols[n],s=a.name;if(t.test(s)){o[s]||(o[s]=!0,e.newNodes.push(h(a)));var r=a.dependencies;for(l in r)o[c=r[l].name]||(o[c]=!0,e.newNodes.push(h(r[l]))),e.newEdges.push({from:c,to:s,arrows:"to"});var l,d=a.subscribers;for(l in d){var c,u=d[l];o[c=u.name]||(o[c]=!0,e.newNodes.push(h(d[l])));a.name in u.dynamicDependencies;e.newEdges.push({from:s,to:c,arrows:"to"})}for(l in d=a.observers)o[c=d[l].id]||(o[c]=!0,e.newNodes.push((i=d[l])instanceof EdenSymbol?h(i):{id:i.id,label:"when",shape:"icon",icon:{code:"",face:"FontAwesome"}})),e.newEdges.push({from:s,to:c,arrows:"to"})}}var p={nodes:new vis.DataSet(e.newNodes),edges:new vis.DataSet(e.newEdges)};e.setData(p)},d.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:d.viewCategories.comprehension,menuPriority:2},e()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler";