function getCaretCharacterOffsetWithin(e){var t,n=0,i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var a=o.getSelection().getRangeAt(0),s=a.cloneRange();s.selectNodeContents(e),s.setEnd(a.endContainer,a.endOffset),n=s.toString().length}}else if((t=i.selection)&&"Control"!=t.type){var r=t.createRange(),l=i.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",r),n=l.text.length}return n}function getStartCaretCharacterOffsetWithin(e){var t,n=0,i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var a=o.getSelection().getRangeAt(0),s=a.cloneRange();s.selectNodeContents(e),s.setEnd(a.startContainer,a.startOffset),n=s.toString().length}}else if((t=i.selection)&&"Control"!=t.type){var r=t.createRange(),l=i.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",r),n=l.text.length}return n}function get_time_diff(e){var t=1e3*e,n=Date.now();if(t-=6e4*(new Date).getTimezoneOffset(),isNaN(t))return"";if(t<n)var i=n-t;else i=t-n;var o=Math.floor(i/1e3/60/1440),a=new Date(i);if(o>5)return new Date(t).toDateString();var s="";if(o>0)s+=o,s+=o>1?" days ago":" day ago";else if(a.getUTCHours()>0){var r=a.getUTCHours();s+=r,s+=r>1?" hours ago":" hour ago"}else{var l=a.getUTCMinutes();if(l>0)s+=l,s+=l>1?" minutes ago":" minute ago";else{var d=a.getUTCSeconds();s+=d,s+=" seconds ago"}}return s}function changeClassString(e,t,n){var i=e.split(" "),o=i.indexOf(t);if(-1==o){if(n)return i.push(t),i.join(" ")}else if(!n)return i.splice(o,1),i.join(" ");return e}function changeClass(e,t,n){if(e){var i=changeClassString(e.className,t,n);i!=e.className&&(e.className=i)}}function makeCurlyBrace(e,t,n,i,o,a){var s=e-n,r=t-i,l=Math.sqrt(s*s+r*r),d=e-.5*l*(s/=l)+o*(r/=l),c=t-.5*l*r-o*s;return"M "+e+" "+t+" Q "+(e+a*o*r)+" "+(t-a*o*s)+" "+(e-.25*l*s+(1-a)*o*r)+" "+(t-.25*l*r-(1-a)*o*s)+" T "+d+" "+c+" M "+n+" "+i+" Q "+(n+a*o*r)+" "+(i-a*o*s)+" "+(e-.75*l*s+(1-a)*o*r)+" "+(t-.75*l*r-(1-a)*o*s)+" T "+d+" "+c}function EdenScriptGutter(e,t,n){var i=this;this.lineelements=n,this.$gutter=$('<div class="eden-gutter"></div>');var o="http://www.w3.org/2000/svg";this.brace=document.createElementNS(o,"svg"),this.brace.style.position="absolute",this.brace.style.display="none",this.brace.setAttribute("width","22"),this.brace.style.left="10px",this.bracepath=document.createElementNS(o,"path"),this.bracepath.setAttribute("style","stroke: #444; fill: none; stroke-width: 3px"),this.brace.appendChild(this.bracepath),this.gutter=this.$gutter.get(0),e.insertBefore(this.gutter,e.firstChild),e.insertBefore(this.brace,e.firstChild),this.ast=void 0,this.lines=[],this.errors=[],this.agents={},this.hovering=!1,this.ctx=void 0,this.edits=void 0;var a,s,r=!1,l=0,d=!1,c=!1;function u(){console.log("GUTTER HOLD"),a=void 0;for(var e=0;e<i.lines.length;e++)i.lines[e].selected&&(changeClass(i.gutter.childNodes[e],"select",!1),changeClass(i.gutter.childNodes[e],"live",!0),i.lines[e].selected=!1,i.lines[e].live=!0)}function p(e,t){var n;if(t&&r){if(n=i.ast.getStatementByLine(e)){(a=n.getRange())[0]<a[1]&&i.showBrace(a[0],a[1]);for(var o=a[0];o<=a[1];o++)i.lines[o].selected=!d,changeClass(i.gutter.childNodes[o],"select",!d),changeClass(i.gutter.childNodes[o],"hover",!1)}}else if(n=i.ast.getStatementByLine(e)){var a=n.getRange();i.lines[e].live||t||changeClass(i.gutter.childNodes[e],"play",!0),i.selectLine(e+1,!0),i.hovering=!0}}function h(e,t){r&&!t&&(i.lines[e].selected=!d,changeClass(i.gutter.childNodes[e],"select",!d),changeClass(i.gutter.childNodes[e],"hover",!1),changeClass(i.gutter.childNodes[e],"play",!1)),r&&(t=!0),i.hovering=!1,clearTimeout(a),a=void 0;var n=i.ast.getStatementByLine(e);if(n){var o=n.getRange();i.hideBrace();for(var s=o[0];s<=o[1];s++)changeClass(i.gutter.childNodes[s],"hover",!1),changeClass(i.gutter.childNodes[s],"play",!1)}}this.curline=-1,this.textwidth=getTextWidth("M","14px/20px Roboto Mono,monospace"),i.startHover=p,i.endHover=h,this.$gutter.on("mousedown",".eden-gutter-item",function(e){if(!this.edits&&!i.ast.hasErrors()){var t=parseInt(e.target.getAttribute("data-line"));s=e.shiftKey,l=t,d=!!i.lines[t]&&i.lines[t].selected,r=e.shiftKey,c=i.lines[t]&&i.lines[t].live;var n=i.ast.getStatementByLine(t);if(n){var o=n.getRange();if(i.lines[t].live&&!s)if(i.lines[t].selected)for(p=0;p<i.lines.length;p++)i.lines[p].selected&&(i.lines[p].live=!1,changeClass(i.gutter.childNodes[p],"live",!1));else for(var p=o[0];p<=o[1];p++)i.lines[p].live=!1,changeClass(i.gutter.childNodes[p],"live",!1);else for(p=o[0];p<=o[1];p++)i.lines[p].selected=!s||!i.lines[p].selected,changeClass(i.gutter.childNodes[p],"select",i.lines[p].selected),changeClass(i.gutter.childNodes[p],"hover",!1)}a=setTimeout(u,1e3)}}).on("click",".eden-gutter-item",function(e){if(!this.edits){var t=parseInt(e.target.getAttribute("data-line"));i.ast.getStatementByLine(t)}}).on("mouseup",".eden-gutter-item",function(e){if(!this.edits){if(!i.ast.hasErrors()&&!s){var t,n=parseInt(e.target.getAttribute("data-line"));if(!((t=i.ast.getStatementByLine(n))&&t.hasErrors()||i.lines[n].live||c))if(i.executeSelected(),!d)if(t=i.ast.getStatementByLine(l))for(var o=t.getRange(),u=o[0];u<=o[1];u++)i.lines[u].selected=!1,changeClass(i.gutter.childNodes[u],"select",!1)}clearTimeout(a),a=void 0,r=!1}}).on("mouseenter",".eden-gutter-item",function(e){i.ast.hasErrors()||p(parseInt(e.target.getAttribute("data-line")),e.shiftKey)}).on("mouseleave",".eden-gutter-item",function(e){h(parseInt(e.target.getAttribute("data-line")),e.shiftKey)})}CSSUtil={},CSSUtil.setStyle=function(e,t){var n=e.style;if(void 0===t)n.cssText="";else if("object"==typeof t){var i=/([A-Z])/g;function o(e,t){return"-"+t.toLowerCase()}var a=/^\w*[A-Z]\w*$/,s="";for(var r in t){if("string"==typeof t[r])s=s+(a.test(r)?r.replace(i,o):r)+": "+t[r]+";\n"}n.cssText=s}else n.cssText=t},CSSUtil.getStyle=function(e){for(var t=document.styleSheets,n=t.length-1;n>=0;n--)for(var i=t[n].cssRules,o=i.length-1;o>=0;o--)if(i[o].type==CSSRule.STYLE_RULE&&i[o].selectorText==e)return i[o].style;var a=document.getElementById("javascript-injected-styles");if(null===a){var s=document.getElementsByTagName("body")[0];(a=document.createElement("style")).id="javascript-injected-styles",s.appendChild(a)}var r=a.sheet;return r.insertRule(e+"{ }",r.cssRules.length),r.cssRules[0].style},EdenUI.plugins.ScriptInput=function(e,t){EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var n=this;$(document.body).delegate(null,"drop",function(t){if(void 0!==t.originalEvent.dataTransfer){var n=t.originalEvent.dataTransfer.getData("selector");if(!n||""==n)return console.log(t.originalEvent.dataTransfer.files),Eden.Project.loadFromFile(t.originalEvent.dataTransfer.files[0]),void t.preventDefault();n.sp;var i=n.replace(/[^a-zA-Z0-9]+/g,"");eden.root.lookup("view_"+i+"_tabs").assign([n],eden.root.scope,EdenSymbol.hciAgent),e.createView(i,"ScriptInput"),eden.root.lookup("view_"+i+"_current").assign(0,eden.root.scope,EdenSymbol.hciAgent)}}).delegate(null,"dragover",function(e){e.preventDefault()}),this.createCommon=function(e,t,n,i){console.log("CREATING",e);var o=$('<div class="inputdialogcontent"><div class="agent-tabs handle"></div><div class="scriptsubcontent">\t<div class="inputhider">\t\t<div class="control-bar noselect">\t\t</div>\t</div></div><div class="info-bar"></div></div></div>'),a=o.find(".inputhider").get(0),s=o.find(".info-bar").get(0),r=o.find(".agent-tabs"),l=o.find(".control-bar"),d=r.get(0),c=l.get(0);$(s).hide();var u=new EdenUI.ScriptArea;a.appendChild(u.contents);var p=0,h=void 0;a.addEventListener("scroll",function(e){void 0!==h&&clearTimeout(h),document.activeElement!==u.outdiv&&(h=setTimeout(function(){h=void 0;var e=a.scrollTop;(e=Math.floor((e-50)/20))<0&&(e=0),Math.abs(e-p)>=50&&(console.log("FORCE RE HIGHLIGHT",e),u.highlighter.setScrollTop(e),p=e,u.updateCachedHighlight(),u.gutter.clear())},100))});var v=-1,g=[],f=[],m="view_"+e+"_current",b="view_"+e+"_showtabs",y="view_"+e+"_showbuttons",w="view_"+e+"_tabs",S="view_"+e+"_zoom",E="view_"+e+"_readonly",x=eden.root.lookup(w),I=(eden.root.lookup(S),eden.root.lookup(m)),k=eden.root.lookup(b),A=eden.root.lookup(y),C=eden.root.lookup(E),_=0,T=3,D=1;function M(e,t){t?(d.style.display="flex",a.parentNode.style.top="35px"):(d.style.display="none",a.parentNode.style.top="0")}function L(e,t){t?(c.style.display="flex",u.codearea.style.top="30px"):(c.style.display="none",u.codearea.style.top="0")}function U(e,t){u.setReadonly(t)}function P(t,n){"number"==typeof n&&n>=0&&n<f.length?(v!=n&&(v=n,u.setFragment(f[v]),u.fragment.originast&&u.fragment.originast.doxyComment&&u.fragment.originast.doxyComment.getProperty("nobuttons")&&(A.assign(!1,eden.root.scope,EdenSymbol.localJSAgent),console.log("DISABLE BUTTONS"))),V()):(V(),-1==n&&(v=-1,u.setFragment(void 0),function(t){""==t&&(t="*");var n=eden.root.lookup("view_"+e+"_query").value();void 0===n&&(n=".type(script).name");Eden.Selectors.query(n,"path,name,remote,executed,type",{minimum:0},e=>{if(-1==v){u.outdiv.innerHTML="";for(var t=0;t<e.length;t++){var n,i=e[t][1],o="";if(i==eden.project.name)o=" project",n="&#xf0f6;";else if("ACTIVE"==i)o=" root",n="&#xf0e7;";else if(e[t][2])n="&#xf08e;";else{switch(e[t][4]){case"script":n="&#xf0f6;";break;case"when":n="&#xf1ae;";break;default:n="&#xf128;"}o=e[t][3]?" executed":""}var a=$('<div class="browse-entry" data-path="'+e[t][0]+'"><div class="browse-icon'+o+'">'+n+"</div>"+i+"</div>");u.outdiv.appendChild(a.get(0))}}})}(""))),O()}function N(e,t){if(Array.isArray(t)){var n=g;g=edenCopy(t);for(var i=f,o=i.filter(function(e){return-1==t.indexOf(e.selector)}),a=0;a<o.length;a++)o[a].destroy(),console.log("REMOVE FRAG",o[a].selector);f=[];for(a=0;a<t.length;a++){var s=n.indexOf(t[a]);s>=0?f.push(i[s]):f.push(new Eden.Fragment(t[a],()=>{P(0,I.value())}))}v=-2,P(0,I.value())}}function O(){if(v>=0){var e='<button class="script-button script-run" title="Run the entire script"><span class="explorer-control-icon">&#xf04b;</span>Run</button>';eden.root.lookup("jseden_script_diffs").value()&&(e+='<button class="script-button script-changes" title="Show recent changes"><span class="explorer-control-icon">&#xf044;</span>Edits</button>');var t=f[v];t&&t.scratch&&!t.edited?e+='<span class="scratchsearch"><input type="text" class="scratchsearch" placeholder="Populate..."></input></span>':t&&t.scratch&&(e+='<span class="editname"><input type="text" class="editname" placeholder="Enter a name..."></input></span>'),l.html(e)}else l.html("")}function B(e,t,n,i,o){var a=document.createElement("div");a.style.left=160*o+"px";var s="agent-tab noselect";s+=i?" agent-tab-current handle":" agent-tab-notcurrent";var r,l=f[t].getTitle();l.length>18&&(l="..."+l.slice(-15)),r=f[t]&&f[t].ast?f[t].ast.errors&&f[t].ast.errors.length>0?"tab-icon errored":f[t].originast&&f[t].originast.executed?"tab-icon executed":"tab-icon":"tab-icon noagent";var d="&#xf1ae;";f[t].remote?d="&#xf08e;":void 0===f[t].origin?d="&#xf0c3;":f[t].locked&&(d="&#xf023;"),a.className=s,a.innerHTML="<span class='"+r+"'>"+d+"</span>"+l+"<span class='close'>&#xf00d;</span>",a.draggable=!0,a.setAttribute("data-index",t),e.appendChild(a)}function V(){for(;d.firstChild;)d.removeChild(d.firstChild);var e=I.value(),t=document.createElement("div");if(t.className="agent-tab-more",t.innerHTML="<span class='tab-icon2'>&#xf0c9;</span>",d.appendChild(t),f.length>3&&0!=e){var n=document.createElement("div");n.className="agent-tableft noselect",d.appendChild(n)}var i=document.createElement("div");i.className="agent-tab-container",d.appendChild(i),e>_+(T-1)&&(_=e-(T-1)),e<_&&(_=e);for(var o=0;o<f.length;o++){f[o].getTitle();_<=o&&B(i,o,0,o==e,o)}var a=document.createElement("div");if(a.className="agent-newtab noselect",a.style.left=160*f.length+20+"px",i.appendChild(a),f.length>3&&e!=f.length-1){var s=document.createElement("div");s.className="agent-tabright noselect",d.appendChild(s)}var r=document.createElement("div");r.className="script-input-windowcontrols",r.innerHTML="<span class='windowcontrol'>&#xf00d;</span>",d.appendChild(r)}function H(t){return"view_"+e+"_"+t}void 0===k.value()&&void 0===k.definition&&k.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),k.addJSObserver("scriptview_"+e,M),M(0,k.value()),void 0===A.value()&&void 0===A.definition&&A.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),A.addJSObserver("scriptview_"+e,L),L(0,A.value()),C.addJSObserver("scriptview_"+e,U),U(0,C.value()),I.addJSObserver("scriptview_"+e,P),x.addJSObserver("scriptview_"+e,N),N(0,x.value()),void 0===x.value()&&void 0===x.definition&&x.assign([],eden.root.scope,EdenSymbol.defaultAgent),void 0===I.value()&&void 0===I.definition&&I.assign(-1,eden.root.scope,EdenSymbol.defaultAgent),Eden.Fragment.listenTo("changed",u,function(e){e===f[v]&&(V(),O(),u.refresh())}),Eden.Fragment.listenTo("locked",u,function(e){e===f[v]&&(console.log("LOCKED",e),P(0,I.value()))}),Eden.Fragment.listenTo("unlocked",u,function(e){e===f[v]&&P(0,I.value())}),Eden.Fragment.listenTo("errored",u,function(e){}),Eden.Fragment.listenTo("status",u,function(e){e===f[v]&&(V(),O())}),Eden.Fragment.listenTo("gotoline",u,function(e,t){for(var n=0;n<f.length;n++)if(e===f[n]){console.log("I have the goto frag"),v!=n&&I.assign(n,eden.root.scope,EdenSymbol.localJSAgent),u.gotoLine(t);var i=50+20*(t-5);i<0&&(i=0),a.scrollTop=i;break}}),void 0===eden.root.lookup("view_"+e+"_query").definition&&eden.execute("view_"+e+"_query is jseden_script_query;");var R=[H("tabs"),H("current"),H("showtabs"),H("showbuttons"),H("zoom")];o.get(0).setAttribute("data-observables",R.join(",")),l.on("keyup","input.editname",function(e){f[v].name=e.target.value,V()}).on("change","input.editname",function(e){console.log("FINISH NAME",e.target.value),f[v].makeReal(e.target.value);var t=x.value();t[v]=f[v].selector,x.assign(t,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".script-run",function(){v>=0&&f[v]&&(f[v].originast?(console.log("ONRUN",f[v].originast),f[v].ast.executeStatement(f[v].originast,0,f[v])):f[v].ast.execute(f[v]),V())}).on("click",".script-changes",function(e){u.gutter.edits?(u.gutter.setDiffs(void 0),u.cachedhlopt=void 0,u.updateCachedHighlight()):u.makeDiff()}).on("click",".script-details",function(e){u.details.toggle()}).on("keyup","input.scratchsearch",function(e){var t=e.target.value;console.log("SCRATCH SEARCH",t),Eden.Selectors.query(t,"innersource",{minimum:1},function(e){u.intextarea.value=e.join("\n"),f[v].setSourceInitial(u.intextarea.value),u.highlighter.ast=u.fragment.ast,u.updateCachedHighlight()})}),o.on("click","button,.executable,a",function(e){var t=e.currentTarget.getAttribute("data-jseden");t&&""!=t&&(console.log(t),eden.execute2(t,{name:"execute"}))}).on("input","textarea,input",function(e){var t=e.currentTarget.getAttribute("name");t&&""!=t&&eden.root.lookup(t).assign(e.currentTarget.value,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".close",function(e){var t=parseInt(e.currentTarget.parentNode.getAttribute("data-index"));if(t>=0&&t<f.length){var n=x.value();n.splice(t,1),x.assign(n,eden.root.scope,EdenSymbol.localJSAgent);var i=I.value();i>=n.length&&I.assign(i-1,eden.root.scope,EdenSymbol.localJSAgent)}e.stopPropagation()}).on("click",".agent-tab-more",function(){I.assign(-1,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".browse-entry",function(e){var t=e.currentTarget.getAttribute("data-path"),n=x.value(),i=n.indexOf(t);-1==i?(n.push(t),x.assign(n,eden.root.scope,EdenSymbol.localJSAgent),I.assign(n.length-1,eden.root.scope,EdenSymbol.localJSAgent)):I.assign(i,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".agent-tab",function(e){var t=e.currentTarget.getAttribute("data-index");I.assign(parseInt(t),eden.root.scope,EdenSymbol.hciAgent),u.intextarea.focus()}).on("click",".agent-tableft",function(){var e=v;--e>=0&&I.assign(e,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".agent-tabright",function(){var e=v;++e<f.length&&I.assign(e,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".agent-newtab",function(){var e=x.value();e.push("scratch"+D),D++,x.assign(e,eden.root.scope,EdenSymbol.localJSAgent),I.assign(e.length-1,eden.root.scope,EdenSymbol.localJSAgent)}).on("dragstart",".agent-tab",function(e){var t=parseInt(e.target.getAttribute("data-index")),n=f[t].selector;e.originalEvent.dataTransfer.setData("selector",n),e.originalEvent.offsetX,e.originalEvent.offsetY}).on("dragend",".agent-tab",function(e){var t=parseInt(e.target.getAttribute("data-index")),n=f[t].selector;if("none"!=e.originalEvent.dataTransfer.dropEffect){console.log("DRAGEND: "+n),console.log(e);var i=x.value(),o=i.indexOf(n);o>=0&&(i.splice(o,1),--o<0&&(o=0),i.length,x.assign(i,eden.root.scope,EdenSymbol.hciAgent)),i.length}}).on("dragover",function(e){e.preventDefault()}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.getData("selector");if(console.log("DROP"),console.log(e),t&&""!=t){var n=x.value();-1==n.indexOf(t)&&(n.push(t),x.assign(n,eden.root.scope,EdenSymbol.hciAgent))}else if(window.FileReader)for(var i=e.originalEvent.dataTransfer.files,o=0;o<i.length;o++){var a=i[o];if(a.name.match(/.*\.jse|.*\.js-e/)){var s=a.name.slice(0,-4);s="local/file/"+(s=s.replace(/[\.\-\/\s]/g,""));var r=new FileReader;r.onload=function(e){new Eden.Agent(void 0,s).setSource(e.target.result,!1,-1),agent.state[obs_agent]=s},r.readAsText(a)}}});var F={contents:o,update:function(t){if(void 0===I.value()){var n="view/script/"+e;Eden.Agent.importAgent(n,"default",["noexec","create"],function(e){agent.state[obs_agent]=n,t instanceof EdenSymbol?(agent.setScope(t.getValueScope(eden.root.scope)),intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(agent.code),updateEntireHighlight()):t instanceof Array?(intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(t),updateEntireHighlight()):"string"==typeof t&&(intextarea.value=t,updateEntireHighlight())})}},destroy:function(){console.log("CLOSE SCRIPT"),clearInterval(u.gutterinterval);for(var t=0;t<f.length;t++)f[t].unlock(),f[t].ast&&f[t].ast.destroy();scriptast=void 0,f=void 0,Eden.Fragment.unListen(u),u=void 0,I.removeJSObserver("scriptview_"+e),x.removeJSObserver("scriptview_"+e)},resize:function(e,t){t&&t.size&&(T=Math.floor((t.size.width-90)/160))},setValue:function(e){intextarea.value=e,updateEntireHighlight()}};return u.updateEntireHighlight(),F},this.createDialog=function(t,i,o){var a=t.slice(0,-7),s=n.createCommon(a,i,o,!1,!1),r=405;if(o){var l=s.contents.find("textarea").val().split("\n").length;r=EdenUI.plugins.ScriptInput.getRequiredHeight(l+1)}function d(e,t){return root.lookup("view_"+e+"_"+t)}return s.contents.on("click",".windowcontrol",function(){e.hideView(a,!0)}),$dialog=$('<div id="'+t+'"></div>').html(s.contents).dialog({appendTo:"#jseden-views",title:i,width:600,height:r,minHeight:203,minWidth:300,classes:{"ui-dialog":"input-dialog ui-front no-print"},resizeStop:s.resize,draggable:!1}),$dialog.parent().draggable({handle:".handle",cancel:".agent-tab-notcurrent",stop:function(e,t){var n=eden.root;n.beginAutocalcOff(),d(a,"x").assign(t.position.left,eden.root.scope,EdenSymbol.hciAgent),d(a,"y").assign(t.position.top,eden.root.scope,EdenSymbol.hciAgent),n.endAutocalcOff()},start:function(e,t){if(d(a,"x").eden_definition||d(a,"y").definition)return!1}}),s.confirmClose=!1,s},this.createEmbedded=function(e,t,i){return n.createCommon(e,t,i,!0)},e.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:e.viewCategories.interpretation,menuPriority:0},e.history=this.history,t()},EdenUI.plugins.ScriptInput.getRequiredHeight=function(e,t){return t?55+20*e+20:45+20*e+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog script-subdialog-newagent noselect"><span class="script-subdialog-title">Create Tab:</span><div class="script-subdialog-panel"><button>Scratch</button></div><div class="script-subdialog-panel"><input class="namebox" type="text" spellcheck="false" placeholder="New Tab"></input><button class="button-new">New</button></div><div class="script-subdialog-panel"><input type="text" class="searchbox" spellcheck="false" placeholder="Search"></input><button class="button-search">Load</button><br/></div></div>'),o=i.find(".searchbox").get(0),a=i.find(".namebox").get(0);i.on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),i.on("click",".button-search",function(){e.get(0).removeChild(n.get(0)),t(!0,o.value)}),i.on("click",".button-new",function(){eden.project.addAction(a.value),e.get(0).removeChild(n.get(0)),t(!0,"."+a.value)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.localChanges=function(e,t,n){EdenUI.plugins.ScriptInput.dialogs.hide&&EdenUI.plugins.ScriptInput.dialogs.hide();var i=$('<div class="script-obscurer noselect"></div>'),o=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-text">You have local changes to '+n.name+', use these?</span><br><br><button class="button-icon-green button-ok">Yes</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">No</button></div>');o.on("click",".button-ok",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!1)}),i.append(o),e.append(i),EdenUI.plugins.ScriptInput.dialogs.hide=function(){EdenUI.plugins.ScriptInput.dialogs.hide=void 0,e.get(0).removeChild(i.get(0)),t(!1)}},EdenUI.plugins.ScriptInput.dialogs.uploadFailed=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload Failed! Try again...</span><br><br><button class="button-icon-green button-upload">Retry</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>');i.on("click",".button-upload",function(){e.get(0).removeChild(n.get(0)),t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.uploadAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload agent. Give an optional version name:</span><br/><input class="script-subdialog-text tagname" type="text" spellcheck="false"></input><span class="status missing"></span><br><input class="script-subdialog-check makepublic" type="checkbox">Public</input><br><br><button class="button-icon-green button-upload">Upload</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>'),o=i.find(".tagname"),a=i.find(".makepublic"),s=o.get(0).nextSibling,r=!0;i.on("input blur",".script-subdialog-text",function(){var e=o.get(0).value;console.log(e),""==e?(r=!0,s.className="addnew"):/^[a-z][a-z0-9]+$/i.test(e)?(s.className="addnew",r=!0):(s.className="invalid",r=!1)}).on("click",".button-upload",function(){r&&(e.get(0).removeChild(n.get(0)),t(!0,o.get(0).value,a.get(0).checked))}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(e,t,n){var i,o=$('<div class="script-obscurer noselect"></div>'),a=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),s=a.find(".script-history-list"),r=n.index,l=n.meta.saveID;function d(e){if(n.history[e])for(var t=n.history[e].length-1;t>=0;t--){var o=$('<div class="script-history-item"></div>');r==t&&(o.addClass("current"),o.addClass("original"),i=o),o.get(0).setAttribute("data-index",""+t);var a=$('<div class="script-history-bookmark"></div>'),l=$('<div class="script-history-time"></div>'),d=$('<div class="script-history-content"></div>');l.html(get_time_diff(n.history[e][t].time)),l.get(0).title=n.history[e][t].time,n.history[e][t].bookmark&&a.addClass("bookmarked"),n.history[e][t].title?d.html(n.history[e][t].title):d.html("[Autosave]"),o.append(a),o.append(d),o.append(l),s.append(o)}}function c(e){if(Eden.DB.getVersions(n.name,function(t){if(null!=t)for(var n=0;n<t.length;n++){var o=$('<div class="script-history-item"></div>');t[n].saveID==l&&(o.addClass("original"),-1==r&&(o.addClass("current"),i=o)),o.get(0).setAttribute("data-version",""+t[n].saveID);var a="script-history-stored";0==t[n].public?a+=" private":t[n].mine?a+=" mine":a+=" public";var c=$('<div class="'+a+'"></div>'),u=t[n].date.split(/[- :]/),p=$('<div class="script-history-time">'+get_time_diff(new Date(u[0],u[1]-1,u[2],u[3],u[4],u[5]).getTime()/1e3)+"</div>"),h=t[n].tag;null==t[n].tag&&(h=t[n].saveID);var v=$('<div class="script-history-content">'+h+" ("+t[n].saveID+") by "+t[n].name+"</div>");o.append(c),o.append(v),o.append(p),s.append(o),t[n].saveID==l&&d(e)}}),n.history.origin){var t=$('<div class="script-history-item"></div>');"origin"==l&&(t.addClass("original"),-1==r&&(t.addClass("current"),i=t)),t.get(0).setAttribute("data-version","origin");var o=$('<div class="script-history-bookmark"></div>'),a="origin";n.meta&&n.meta.file&&(a=n.meta.file);var c=$('<div class="script-history-content">'+a+"</div>");t.append(o),t.append(c),s.append(t),"origin"==l&&d("origin")}}c(n.meta.saveID),a.on("input",".script-history-content",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));n.history[n.meta.saveID][t].title=e.target.textContent,n.saveHistory(),n.makeSnapshot(t)}).on("click",".script-history-item",function(e){var t=e.currentTarget.getAttribute("data-version");if(t)"origin"!=t&&(t=parseInt(t)),l=t,function(){for(var e=s.get(0);e.firstChild;)e.removeChild(e.firstChild);i=void 0}(),r=-1,c(l);else{var n=parseInt(e.currentTarget.getAttribute("data-index"));r=n,i&&i.removeClass("current"),(i=$(e.currentTarget)).addClass("current")}}).on("click",".script-history-bookmark",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));void 0===n.history[n.meta.saveID][t].bookmark?n.history[n.meta.saveID][t].bookmark=!0:n.history[n.meta.saveID][t].bookmark=!n.history[n.meta.saveID][t].bookmark,n.saveHistory(),n.history[n.meta.saveID][t].bookmark?e.target.className="script-history-bookmark bookmarked":e.target.className="script-history-bookmark"}).on("click",".button-ok",function(){e.get(0).removeChild(o.get(0)),console.log("Rollback to: "+r+"@"+l),t(!0,r,l)}).on("click",".button-cancel",function(){e.get(0).removeChild(o.get(0)),t(!1)}),o.append(a),e.append(o)},EdenUI.plugins.ScriptInput.dialogs.browseAgents=function(e,t,n){var i=$('<div class="script-obscurer noselect"></div>'),o=$('<div class="script-subdialog-agents noselect"><span class="script-subdialog-title">'+Language.ui.input_window.browse_agents+':</span><br/><div class="script-agents-list"></div><div class="script-agents-buttons"><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),a=o.find(".script-agents-list"),s=0,r={};function l(e,t,i){Eden.DB.getDirectory(i,function(o){if(void 0!==o){var s=[];for(var r in o)s.push(r);s.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});for(var l=0;l<s.length;l++){var d=""==i?s[l]:i+"/"+s[l],c=s[l],u=$('<div class="script-agents-item"></div>'),p=$('<div class="script-agents-expand" style="width: '+(27+15*t)+'px"></div>'),h=$('<div class="script-agents-content"></div>'),v=$('<div class="script-agents-cbcont"></div>');(function(e,t,i,o,a){Eden.DB.getMeta(t,function(t,a){if(a){var s="";if(a.date){var r=a.date.split(/[- :]/);s=get_time_diff(new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]).getTime()/1e3)}var l=a.title;if("Script View"!=l&&void 0!==l||(l=""),e.html(i+' <span class="script-agents-title">'+l+'</span><span class="script-agents-date">'+s+"</span>"),a.remote&&-1==a.defaultID&&-1==a.latestID)o.html("&nbsp;");else{var d=$('<input type="checkbox"></input>');o.append(d),n.indexOf(t)>=0&&(d.get(0).checked=!0)}}else e.html(i),o.html("&nbsp;")})}).call(this,h,d,c,v,p),Eden.Agent.agents[d]&&u.addClass("loaded"),u.get(0).setAttribute("data-path",d),u.get(0).setAttribute("data-depth",""+(t+1)),u.append(p),u.append(v),u.append(h),void 0===e||void 0===e.nextSibling?a.append(u):a.get(0).insertBefore(u.get(0),e.nextSibling)}}})}return l(void 0,0,""),o.on("click",".script-agents-item",function(e){}).on("click",".script-agents-expand",function(e){var t=e.currentTarget.parentNode.getAttribute("data-path"),n=parseInt(e.currentTarget.parentNode.getAttribute("data-depth"));e.currentTarget.className.indexOf("expanded")<0?(l(e.currentTarget.parentNode,n,t),changeClass(e.currentTarget,"expanded",!0)):(!function(e){for(var t=parseInt(e.getAttribute("data-depth")),n=e.nextSibling;n&&parseInt(n.getAttribute("data-depth"))>t;){var i=n.nextSibling;a.get(0).removeChild(n),n=i}}(e.currentTarget.parentNode),changeClass(e.currentTarget,"expanded",!1))}).on("change",".script-agents-cbcont input",function(e){var t=e.currentTarget.parentNode.parentNode.getAttribute("data-path");e.currentTarget.checked?r[t]=!0:r[t]=!1}).on("click",".button-add",function(){s=a.scrollTop(),e.get(0).removeChild(i.get(0)),t(!0,r)}).on("click",".button-cancel",function(){s=a.scrollTop(),e.get(0).removeChild(i.get(0)),t(!1)}),i.append(o),{show:function(){e.append(i),a.scrollTop(s)}}},EdenScriptGutter.prototype.clear=function(){for(this.ast=void 0,this.lines=[],this.curline=-1,this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild)},EdenScriptGutter.prototype.setBaseAST=function(e,t){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);this.ast=e,this.errors=t,this.lines=[],this.edits=void 0,this.hideBrace()},EdenScriptGutter.prototype.executeSelected=function(){if(void 0!==this.ast)for(var e=0;e<this.lines.length;e++)if(this.lines[e].selected){var t=this.ast.getStatementByLine(e),n=this.ast.getStatementByLine(e).getRange();eden.project.ast.executeStatement(t,e,eden.project),e=n[1],eden.root.lookup("jseden_fragment_executed").assign(".id("+t.id+")",eden.root.scope,EdenSymbol.hciAgent)}},EdenScriptGutter.prototype.showBrace=function(e,t){this.brace.style.display="block";var n=this.lineelements.childNodes[e].offsetTop;this.brace.style.top=n+"px";var i=this.lineelements.childNodes[t].offsetTop+this.lineelements.childNodes[t].clientHeight;i-=n,this.brace.setAttribute("height",""+i),this.bracepath.setAttribute("d",makeCurlyBrace(20,4,20,i-4,20,.52))},EdenScriptGutter.prototype.hideBrace=function(){this.brace.style.display="none"},EdenScriptGutter.prototype.selectLine=function(e,t){if(!(this.edits||this.ast.errors.length>0)){var n;if(this.curline>=0)if(n=this.ast.getStatementByLine(this.curline)){var i=n.getRange(),o=Math.floor((i[1]-i[0])/2)+i[0];t||(changeClass(this.gutter.childNodes[o],"play",!1),changeClass(this.gutter.childNodes[o],"current",!1))}if(this.curline=e-1,n=this.ast.getStatementByLine(e-1))if(n.getRange||console.error("NO GETRANGE",n),(i=n.getRange())[0]<i[1])this.showBrace(i[0],i[1]);else if(this.hideBrace(),n){o=Math.floor((i[1]-i[0])/2)+i[0];changeClass(this.gutter.childNodes[o],"play","true"),t||changeClass(this.gutter.childNodes[o],"current","true")}}},EdenScriptGutter.prototype.setDiffs=function(e){this.edits=e;if(console.log(e,this.ast),void 0!==e){this.hideBrace();for(var t=0,n=0,i=this.lines.length+Object.keys(e.remove).length,o=!1,a=0;a<i;a++){if(e.remove[n]&&e.remove[n].nline<=t){var s="eden-gutter-item removed";(d=this.gutter.childNodes[a]).className=s,d.textContent=e.remove[n].rline;for(var r=e.remove[n].chars,l=0;l<r.length;l++){(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(255,0,0,0.3)",u.style.height="20px",u.style.width=r[l].length*this.textwidth+"px",u.style.top="0px",u.style.left=r[l].start*this.textwidth+43+"px",d.appendChild(u)}if(!e.remove[n].partial){n++;continue}n++,o=!0}var d=this.gutter.childNodes[a];s="eden-gutter-item";if(o||e.insert[t]){s+=" inserted";var c=!1;if(e.insert[t])for(r=e.insert[t].chars,l=0;l<r.length;l++){var u;(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(0,255,0,0.3)",u.style.height="20px",u.style.width=r[l].length*this.textwidth+"px",c=c||0==r[l].length&&!e.insert[t].partial,u.style.top="0px",u.style.left=r[l].start*this.textwidth+53+"px",d.appendChild(u)}e.insert[t]&&e.insert[t].partial&&!o&&n++}else n++;o=!1,d.className=s,d.setAttribute("data-line",""+t),t++,void 0===this.lines[t]&&(this.lines[t]={selected:!1,live:!1})}}},EdenScriptGutter.prototype.updateLine=function(e,t){var n="eden-gutter-item",i=this.ast,o="",a=t,s=void 0,r=i.getStatementByLine(e);r?(r.errors.length>0?(r.errors[0].line==e+1?(n+=" error",o="&#xf06a",s=r.errors[0].messageText(),e):"runtime"==r.errors[0].type&&(n+=" error",o="&#xf06a",s=r.errors[0].messageText()),this.lines[e].errored=!0,a=!0):(i.errors.length>0&&i.errors[0].line==e+1&&(this.lines[e].errored=!0,n+=" error",o="&#xf06a",s=i.errors[0].messageText()),this.lines[e].errored&&(a=!0,this.lines[e].errored=!1),r.warning&&(1!=r.warning.warnno||eden.root.lookup("jseden_parser_warndeprecate").value())&&(n+=" warning",o="&#xf071",a=!0,r.warning&&(s=r.warning.messageText())),1==r.executed?(n+=" executed",a=!0,this.lines[e].executed=!0):2==r.executed?(n+=" guarded",a=!0,this.lines[e].executed=!0):3==r.executed?(n+=" errorblock",a=!0):"section"!=r.type&&(n+=" unexecuted",a=!0)),this.lines&&this.lines[e]&&(this.lines[e].executed&&r.executed<=0&&(a=!0,this.lines[e].executed=!1),this.lines[e].selected&&(n+=" select"),this.lines[e].live&&(n+=" live"))):(this.errors&&this.errors.length>0&&this.errors[0].line==e+1?this.lines[e].errored||(n+=" error",o="&#xf06a",s=this.errors[0].messageText(),e,this.lines[e].errored=!0,a=!0):this.lines[e].errored&&(a=!0,this.lines[e].errored=!1,s=""),this.lines[e].executed&&(a=!0,this.lines[e].executed=!0)),a&&(this.gutter.childNodes[e].className.indexOf("hover")>=0&&(n+=" hover"),this.gutter.childNodes[e].className.indexOf("play")>=0&&(n+=" play"),this.gutter.childNodes[e].className.indexOf("current")>=0&&(n+=" current"),this.gutter.childNodes[e].innerHTML=o,this.gutter.childNodes[e].className=n,s&&(this.gutter.childNodes[e].title=s))},EdenScriptGutter.prototype.generate=function(e,t){if(this.ast=e,!this.edits){var n=!1,i=e.getNumberOfInnerLines()+1;if(i>this.lineelements.childNodes.length&&(i=this.lineelements.childNodes.length),i!=this.gutter.childNodes.length){for(this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(var o=0;o<i;o++){var a=document.createElement("div");a.className="eden-gutter-item",a.setAttribute("data-line",""+o),a.style.height=this.lineelements.childNodes[o].clientHeight+"px",this.gutter.appendChild(a),void 0===this.lines[o]&&(this.lines[o]={selected:!1,live:!1,executed:!1,errored:!1})}n=!0}for(o=0;o<i;o++)this.updateLine(o,n);this.ast.errors.length>0?this.hideBrace():this.hovering||this.selectLine(t)}},EdenUI.ScriptArea=function(){this.contents=document.createElement("div"),this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contenteditable=!0,this.outdiv.className="outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.fragment=void 0,this.readonly=!1,this.alwaysreadonly=!1,this.currentlineno=-1,this.currentcharno=-1,this.gotomode=!1,this.highlighter=new EdenUI.Highlight(this.outdiv),this.gutter=new EdenScriptGutter(this.codearea,this.infobox,this.outdiv),this.details=new EdenUI.ScriptArea.Details(this),this.cachedhlopt=void 0,this.disablehl=!1,this.highlighter.setScrollTop(0);var e=this;this.gutterinterval=setInterval(function(){if(void 0!==e.fragment&&void 0!==e.fragment.ast)for(var t in e.gutter.generate(e.fragment.ast.script,e.currentlineno),e.highlighter.metrics)if(e.currentlineno!=t){var n=e.highlighter.metrics[t];if(n.query)for(var i=0;i<n.qelements.length;i++){var o=n.qelements[i].getAttribute("data-query"),a=n.qelements[i].getAttribute("data-attribs");(function(e){Eden.Selectors.query(o,null!==a&&a.length>0?a:"value",{minimum:1},t=>{t=1==t.length?t[0]:t.length>1?t.join(", "):"",e.setAttribute("data-result",t)})})(n.qelements[i])}n.squery&&e.highlightContent(t,e.intextarea.selectionEnd)}},300);new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.rebuildinterval=400},EdenUI.ScriptArea.prototype.setReadonly=function(e){this.alwaysreadonly=e,!0===e?(this.readonly=!0,this.outdiv.contentEditable=!1):(this.readonly=!!this.fragment&&this.fragment.locked,this.outdiv.contentEditable=!this.readonly,"comment"==e&&this.updateEntireHighlight())},EdenUI.ScriptArea.prototype.setFragment=function(e){if(this.fragment&&this.fragment!==e&&(this.fragment.unlock(),this.currentlineno=-1),this.details.hide(),this.fragment=e,void 0===e)return this.gutter.clear(),changeClass(this.outdiv,"browser",!0),this.outdiv.contentEditable=!1,void(this.readonly=!0);var t=this;e.reset(function(){changeClass(t.outdiv,"browser",!1),t.intextarea.value=e.getSource(),e.ast&&(t.highlightContent(-1,0),t.intextarea.focus(),t.checkScroll(),t.gutter.setBaseAST(e.ast.script)),e.locked?(t.readonly=!0,t.outdiv.contentEditable=!1):(t.readonly=!0===t.alwaysreadonly,t.outdiv.contentEditable=!t.readonly)})},EdenUI.ScriptArea.prototype.refresh=function(){this.intextarea.value=this.fragment.getSource(),this.fragment.ast&&this.highlightContent(-1,0)},EdenUI.ScriptArea.prototype.updateSource=function(e,t){this.fragment.setSource(e),this.fragment.ast&&(this.gutter.errors=this.fragment.ast.errors),this.highlighter.ast=this.fragment.ast},EdenUI.ScriptArea.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.updateSource(this.intextarea.value,e),this.runScript(e),this.highlightContent(e,t)},EdenUI.ScriptArea.prototype.runScript=function(e){if(this.gutter.lines[e-1]&&this.gutter.lines[e-1].live&&!this.fragment.ast.hasErrors()){var t=this.fragment.ast.script.getStatementByLine(e-1);this.fragment.ast.executeStatement(t,e,this.fragment)}},EdenUI.ScriptArea.prototype.hideInfoBox=function(){},EdenUI.ScriptArea.prototype.updateLineCachedHighlight=function(){if(this.fragment){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(e,t)}},EdenUI.ScriptArea.prototype.updateEntireHighlight=function(e,t){if(void 0!==this.fragment){this.cachedhlopt=t,this.updateSource(this.intextarea.value,-1);var n=-1;document.activeElement===this.intextarea&&(n=this.intextarea.selectionEnd),e&&runScript(0),this.highlightContent(-1,n,t)}},EdenUI.ScriptArea.prototype.updateCachedHighlight=function(e){var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),this.highlightContent(-1,t,e||this.cachedhlopt)},EdenUI.ScriptArea.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;return parseInt(t.getAttribute("data-line"))},EdenUI.ScriptArea.prototype.replaceLine=function(e,t){var n=this.intextarea.value.split("\n");n[e]=t,this.intextarea.value=n.join("\n")},EdenUI.ScriptArea.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.ScriptArea.prototype.focusText=function(){if(!this.readonly){var e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=t,t!=e&&(this.refreshentire=!0)}},EdenUI.ScriptArea.prototype.toggleHighlighting=function(){this.disablehl=!this.disablehl,this.updateEntireHighlight(),this.gutter.clear()},EdenUI.ScriptArea.prototype.highlightContent=function(e,t,n){if(this.fragment){var i=this.fragment.ast;if(i){if(void 0===n&&this.disablehl&&(n={}),this.disablehl&&(n.disabled=!0),this.highlighter.highlight(i,e,t,n),document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret"),"comment"==this.alwaysreadonly)for(var o=$(this.outdiv).find(".eden-comment-line"),a=0;a<o.length;a++)o[a].contentEditable=!1;this.delayRebuild()}}},EdenUI.ScriptArea.prototype.moveCaret=function(){this.updateLineCachedHighlight(),this.checkScroll()},EdenUI.ScriptArea.prototype.selectAll=function(){this.outdiv.focus();var e=document.createRange();e.selectNodeContents(this.outdiv);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},EdenUI.ScriptArea.prototype.makeNumbersDrag=function(){var e=this;this.readonly||$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(t,n){var i;if(!e.readonly&&(i=e.dragint?Math.round(e.dragvalue+(n.position.left-e.dragstart)/2):(i=e.dragvalue+.005*(n.position.left-e.dragstart)).toFixed(4))!=e.draglast){e.draglast=i,t.target.innerHTML=""+i;var o=t.target.parentNode.textContent;"\n"==o.charAt(o.length-1)&&(o=o.slice(0,-1)),e.replaceLine(e.dragline,o),e.updateSource(e.intextarea.value,e.dragline),e.runScript(e.dragline+1),e.highlightContent(e.dragline,-1)}},start:function(t,n){if(!e.readonly){e.edited=!0,e.dragline=e.findElementLineNumber(t.target),e.dragstart=n.position.left;var i=t.target.textContent;-1==i.indexOf(".")?(e.dragvalue=parseInt(i),e.dragint=!0):(e.dragvalue=parseFloat(i),e.dragint=!1),e.draglast=e.dragvalue,$(t.target).addClass("eden-select"),$(e.outdiv).css("cursor","ew-resize")}},stop:function(t,n){e.readonly||($(t.target).removeClass("eden-select"),$(e.outdiv).css("cursor","text"),e.dragline=-1)},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptArea.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.ScriptArea.prototype.gotoLine=function(e){var t=this.intextarea.value.split("\n");t.length=e+1;var n=t.join("\n").length;this.intextarea.focus(),this.intextarea.selectionEnd=n,this.intextarea.selectionStart=n,this.updateLineCachedHighlight()},EdenUI.ScriptArea.prototype.checkScroll=function(){var e=$(this.outdiv.childNodes[this.currentlineno-1]).find(".fake-caret").get(0);if(void 0!==e){for(var t=this.contents.parentNode,n=e.offsetLeft-t.scrollLeft+25,i=t.clientWidth+t.scrollLeft-e.offsetLeft-25;e.parentNode!=this.outdiv;)e=e.parentNode;var o=e.offsetTop-t.scrollTop+15,a=t.clientHeight+t.scrollTop-e.offsetTop-15;n<80&&(t.scrollLeft=t.scrollLeft-(80-n)),i<80&&(t.scrollLeft=t.scrollLeft+(80-i)),o<40&&(t.scrollTop=t.scrollTop-(40-o)),a<40&&(t.scrollTop=t.scrollTop+(40-a))}},EdenUI.ScriptArea.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0);if(e){var t=document.createRange(),n=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),n.removeAllRanges(),n.addRange(t),$(this.outdiv).remove(".fake-caret")}},EdenUI.ScriptArea.prototype.makeDiff=function(){var e={},t=this.fragment.diff();for(var n in t.remove)if(!t.remove[n].consecutive){var i=parseInt(n),o=0,a=20;do{a+=20,o++}while(t.remove[i+o]&&t.remove[i+o].consecutive);e[t.remove[n].nline+0]=a}this.gutter.setDiffs(t),this.cachedhlopt={spacing:e},this.updateCachedHighlight()},EdenUI.ScriptArea.prototype.doRebuild=function(){this.makeNumbersDrag()},EdenUI.ScriptArea.prototype.delayRebuild=function(){var e=this;clearTimeout(this.rebuildtimer),this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptArea.prototype.rebuild=function(){this.gutter.edits?(this.updateSource(this.intextarea.value,-1),this.gutter.ast=this.fragment.ast,this.makeDiff()):(this.edited=!0,this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight(),this.checkScroll(),this.dirty=!1)},EdenUI.ScriptArea.prototype.enableGotoMode=function(){this.gotomode||(this.outdiv.contentEditable=!1,changeClass(this.outdiv,"goto",!0),this.gotomode=!0)},EdenUI.ScriptArea.prototype.disableGotoMode=function(){this.gotomode&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv,"goto",!1),this.gotomode=!1)},EdenUI.ScriptArea.prototype.insertTab=function(){var e=this.intextarea.selectionStart,t=this.intextarea.selectionEnd;this.intextarea.value=this.intextarea.value.substring(0,e)+"\t"+this.intextarea.value.substring(t),this.intextarea.selectionStart=this.intextarea.selectionEnd=e+1,this.rebuild()},EdenUI.ScriptArea.Details=function(e){this.scriptarea=e,this.contents=document.createElement("div"),this.contents.className="script-details",this.contents.addEventListener("keyup",function(e){var t=e.target.parentNode.getAttribute("data-name"),n=e.target.value;console.log("CHANGE PROP",t,n)}),this.visible=!1},EdenUI.ScriptArea.Details.prototype.addProperty=function(e,t,n,i){var o=document.createElement("div");o.className="script-details-prop",o.setAttribute("data-name",e);var a=document.createElement("div");a.className="script-details-label",a.textContent=t,o.appendChild(a);var s=document.createElement("input");s.className="script-details-value",s.value=n||"",s.setAttribute("type","text"),i&&i.readonly&&(s.className+=" script-details-readonly",s.setAttribute("readonly","true")),o.appendChild(s);var r=document.createElement("div");return r.className="script-details-status",i&&i.readonly?r.innerHTML="&#xf023;":r.innerHTML="&#xf00c;",o.appendChild(r),this.contents.appendChild(o),o},EdenUI.ScriptArea.Details.prototype.clear=function(){for(;this.contents.lastChild;)this.contents.removeChild(this.contents.lastChild)},EdenUI.ScriptArea.Details.prototype.addButtons=function(){var e=document.createElement("div");e.className="script-details-buttons";var t=document.createElement("button");t.className="script-button",t.innerHTML='<span class="explorer-control-icon">&#xf00d;</span>Close',e.appendChild(t),this.contents.appendChild(e)},EdenUI.ScriptArea.Details.prototype.show=function(){this.clear(),this.addProperty("name","Name",this.scriptarea.fragment.name),this.addProperty("selector","Path",this.scriptarea.fragment.selector,{readonly:!0}),this.scriptarea.fragment.originast&&this.addProperty("id","Full Name",Eden.Selectors.getID(this.scriptarea.fragment.originast),{readonly:!0});var e=this.scriptarea.fragment.doxy;if(e){this.addProperty("desc","Description",e.stripped()),this.addProperty("tags","Tags",e.getHashTags().join(" "));var t=e.getControls();for(var n in t)this.addProperty(n,n.substring(1),t[n])}this.addButtons(),this.scriptarea.codearea.appendChild(this.contents),changeClass(this.scriptarea.outdiv,"blur",!0),this.visible=!0},EdenUI.ScriptArea.Details.prototype.hide=function(){this.visible&&(this.scriptarea.codearea.removeChild(this.contents),this.visible=!1,changeClass(this.scriptarea.outdiv,"blur",!1))},EdenUI.ScriptArea.Details.prototype.toggle=function(){this.visible?this.hide():this.show()},EdenUI.ScriptArea.Keyboard=function(e){function t(e){var t=e.key;return e.shiftKey&&(t="Shift-"+t),e.altKey&&(t="Alt-"+t),(e.ctrlKey||e.metaKey)&&(t="Ctrl-"+t),t}e.intextarea.addEventListener("input",function(t){e.dirty=!0,e.rebuild()}),e.intextarea.addEventListener("keydown",function(n){switch(t(n)){case"Tab":n.preventDefault(),e.insertTab();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":e.moveCaret();break;case"Ctrl-a":e.selectAll(),n.preventDefault();break;case"Ctrl-h":e.toggleHighlighting(),n.preventDefault();break;case"Ctrl-Shift-ArrowLeft":case"Ctrl-Shift-ArrowRight":case"Ctrl-Shift-ArrowUp":case"Ctrl-Shift-ArrowDown":case"Ctrl-Shift-Home":case"Ctrl-Shift-End":case"Shift-ArrowLeft":case"Shift-ArrowRight":case"Shift-ArrowUp":case"Shift-ArrowDown":case"Shift-Home":case"Shift-End":e.focusOutput();break;case"Backspace":e.refreshentire=10==e.intextarea.value.charCodeAt(e.intextarea.selectionStart-1);break;case"Enter":e.refreshentire=!0;break;case"Ctrl-Control":e.enableGotoMode()}}),e.intextarea.addEventListener("keyup",function(n){var i=t(n);switch(n.ctrlKey||e.disableGotoMode(),i){case"Ctrl-Control":e.disableGotoMode();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":e.updateLineCachedHighlight(),e.gutter&&e.gutter.selectLine(e.currentlineno),e.checkScroll()}}),e.intextarea.addEventListener("paste",function(t){e.refreshentire=!0}),e.outdiv.addEventListener("keydown",function(t){"INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(!t.shiftKey||37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode&&35!=t.keyCode&&36!=t.keyCode)&&"Control"!=t.key&&"Shift"!=t.key&&"c"!=t.key&&e.focusText()}),e.outdiv.addEventListener("keyup",function(t){"INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(17!=t.keyCode&&91!=t.keyCode&&92!=t.keyCode||e.disableGotoMode())}),e.outdiv.addEventListener("paste",function(t){e.intextarea.focus(),setTimeout(function(){e.updateEntireHighlight()},0)}),e.intextarea.addEventListener("blur",function(t){$(e.outdiv).find(".fake-caret").remove()}),e.intextarea.addEventListener("focus",function(e){})},EdenUI.ScriptArea.Mouse=function(e){e.outdiv.addEventListener("mouseup",function(t){if("INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(e.hideInfoBox(),!e.readonly&&0!=t.target.isContentEditable))if(e.gotomode){var n=t.target;if(""==n.className&&"SPAN"==n.parentNode.nodeName&&(n=n.parentNode),"eden-selector"==n.className||"eden-selector2"==n.className){e.disableGotoMode();var i=n.parentNode.textContent;Eden.Selectors.goto(i)}else if("eden-observable"==n.className){var o=n.getAttribute("data-observable");Eden.Selectors.goto(o+":active")}t.preventDefault()}else if(document.activeElement===e.outdiv){var a=getCaretCharacterOffsetWithin(e.outdiv);getStartCaretCharacterOffsetWithin(e.outdiv)!=a?e.refreshentire=!0:(e.intextarea.focus(),e.intextarea.selectionEnd=a,e.intextarea.selectionStart=a,e.currentlineno,e.updateLineCachedHighlight())}}),e.outdiv.addEventListener("mousedown",function(t){e.readonly})},EdenUI.plugins.PluginManager=function(e,t){this.createDialog=function(t,n){var i,o,a=$('<div class="projectlist-results noselect"></div>'),s=function(t){return e.plugins[t]?"(loaded)":"(not loaded)"};pluginNames=Object.keys(EdenUI.plugins).sort(function(t,n){var i=e.plugins[t],o=e.plugins[n];return i&&!o?1:o&&!i?-1:t<n?-1:t==n?0:1});for(var r=0;r<pluginNames.length;r++){o=pluginNames[r],i=EdenUI.plugins[o];var l='<div class="projectlist-result-element'+(o in e.plugins?" pluginmanager-loaded":"")+'"><div class="projectlist-result-name">'+i.title+"</div><div class='projectlist-result-metadata'>"+i.description+"</div>";void 0!==i.originalAuthor&&(l=l+"<div class='projectlist-result-metadata'>Original version by "+i.originalAuthor+"</div>"),void 0!==i.author&&(l=l+"<div class='projectlist-result-metadata'>"+(void 0===i.originalAuthor?"By ":"Built on by ")+i.author+"</div>"),l=l+'<div class="pluginlist-loaded projectlist-result-metadata">'+s(o)+"</div></div>",$(l).click(function(t){return function(){var n=$(this);e.loadPlugin(t,function(){e.plugins[t]&&(n.find(".pluginlist-loaded").html(s(t)),n.addClass("pluginmanager-loaded",100)),e.menu.updateViewsMenu()})}}(o)).appendTo(a)}var d=$('<div class="projectlist-listing"></div>');d.append(a),$dialog=$('<div id="'+t+'"></div>').html(d).dialog({title:n,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},e.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:e.viewCategories.environment,name:"plugins"},t()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.Canvas2D=function(e,t){var n=this;this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx,this.defaultLineWidth=2;canvases={},contents={};var i,o,a,s={},r=!1,l=!1;Object.defineProperty(this,"mouseIdleTimeout",{set:function(e){clearInterval(o),o=setInterval(function(){if(r)l=!1,r=!1;else if(!l){var e=root.lookup("mouseFollow").value();root.lookup("mouseVelocity").assign(new Point(0,0),root.scope,EdenSymbol.hciAgent,e),l=!0,a=void 0}},e/2),i=e},get:function(){return i},enumerable:!0}),this.mouseVelocitySampleTime=100,this.mouseVelocityDampening=.3,this.mouseIdleTimeout=300;this.thumbnail=function(e){var t=canvases.picture;if(void 0===t)for(var n in canvases){t=canvases[n];break}if(void 0!==t){var i,o,a,s,r=t.clientWidth,l=t.clientHeight,d=r/l;d<200/112?(a=(200-(o=r*((i=112)/l)))/2,s=0):d>200/112?(a=0,s=(112-(i=l*((o=200)/r)))/2):(i=112,o=200,a=0,s=0);var c,u=document.createElement("canvas");u.setAttribute("width","200"),u.setAttribute("height","112"),u.getContext("2d").drawImage(t,a,s,o,i);try{c=u.toDataURL("image/png")}catch(e){}e&&e(c)}else e&&e()},this.drawPicture=function(e){var t=canvases[e];if(void 0!==t&&!t.drawingQueued&&(t.drawingQueued=!0,!t.drawingInProgress)){var i=function(){t.drawingInProgress=!0,t.drawingQueued=!1;var o=s[e],a={},r="view_"+e+"_content",l=root.lookup(r),d=l.value(),c=t.getContext("2d"),u=contents[e],p=0;if(void 0!==u){var h,v=root.lookup("view_"+e+"_background_colour").value();for(h in void 0===v&&(v="white"),c.setTransform(1,0,0,1,0,0),n.setFillStyle(c,v),u.style.backgroundColor=v,c.fillRect(0,0,t.width,t.height),o)o[h][0].setAttribute("data-garbage",!0);if(Array.isArray(d)){var g=root.lookup("view_"+e+"_scale").value();"number"!=typeof g&&(g=1);var f=root.lookup("view_"+e+"_zoom").value();"number"!=typeof f&&(f=1);var m,b,y=g*f;g<0?(c.scale(-y,y),y=-y,b=-g,m=!0):(1!=y&&c.scale(y,y),b=g,m=!1);var w=root.lookup("view_"+e+"_offset").value();if(w instanceof Point)if(m){var S=t.height/y-w.y;c.translate(w.x,-S),w=new Point(w.x,S)}else c.translate(w.x,w.y);else w=new Point(0,0);n.configureContextDefaults(c,b);for(var E=[d],x=[0],I=[],k="";E.length>0;){var A=E.pop(),C=x.pop();for(C>0&&A[C-1]instanceof EdenUI.plugins.Canvas2D.Transform&&(c.restore(),I.pop(),k=I.join(" "));C<A.length;){var _=A[C];if(_ instanceof Object)if(Array.isArray(_))E.push(A),x.push(C+1),A=_,C=0;else if(_ instanceof EdenUI.plugins.Canvas2D.Transform){E.push(A),x.push(C+1),c.save(),_.transform(c);var T=_.getCSS(y);k=k+T+" ",I.push(T),A=_.items,Array.isArray(A)||(A=[A]),C=0}else{var D=_.hash&&_.hash(),M=D&&o[D];if(M)_.elements=M;else{c.save();try{n.configureContext(c,b,f,_.drawingOptions)&&_.draw(c,g,e)}catch(e){void 0!==_&&console.error(_,e)}c.restore()}if(void 0!==_.elements){var L=_.elements[0].parentElement;if(L&&L!=u){for(var U=[],P=0;P<_.elements.length;P++)U.push($(_.elements[P]).clone(!0,!0).get(0));_.elements=U,_.scale(y,f,w)}else M&&!t.rescale||_.scale(y,f,w)}var N=_.elements;N&&(N[0].style.transform=(_.transformCSS?_.transformCSS+" ":"")+k,N[0].setAttribute("data-garbage",!1),M||(u.length<=p?u.appendChild(N[0]):u.insertBefore(N[0],u.childNodes[p])),a[D]=N,p++),C++}else C++}}if(1==root.lookup("view_"+e+"_grid_visible").value()){var O,B,V=root.lookup("view_"+e+"_grid_spacing").value(),H=-w.x,R=t.width/y-w.x;m?(O=w.y-t.height/y,B=w.y):(O=-w.y,B=t.height/y-w.y),c.save(),c.lineWidth=1/y,c.strokeStyle="thistle",n.drawGridLines(w,y,V,H,O,R,B,c),c.strokeStyle="magenta",n.drawGridLines(w,y,3*V,H,O,R,B,c),c.beginPath(),c.strokeStyle="blue",c.fillStyle="blue",c.arc(0,0,9/y,0,2*Math.PI,!1),c.fill(),c.beginPath(),c.moveTo(3*V,0),c.lineTo(2*V,.4*V),c.lineTo(2*V,-.4*V),c.moveTo(0,3*V),c.lineTo(.4*V,2*V),c.lineTo(-.4*V,2*V),c.fill(),c.beginPath(),c.lineWidth=4/y,c.moveTo(2*V,0),c.lineTo(0,0),c.lineTo(0,3*V),c.stroke(),c.restore()}}else{var F=r,j=l.eden_definition;if(j){var W=new RegExp("^"+r+"\\s+is\\s+([a-zA-Z0-9_]+)(;)?$"),z=j.match(W);null!==z&&(F=z[1])}c.save(),c.font="18px sans-serif",c.fillStyle="black",c.textAlign="center",u.textBaseline="middle",c.fillText("Give the observable named '"+F+"' a list-typed value",t.width/2,t.height/2),c.fillText("to create a picture here.",t.width/2,t.height/2+30),c.restore()}!function(e,t){var n;for(n in t)if("false"!=t[n][0].getAttribute("data-garbage"))for(var i=t[n],o=0;o<i.length;o++)null!==i[o].parentElement&&e.removeChild(i[o])}(u,o),s[e]=a,t.drawingInProgress=!1,t.drawingQueued&&setTimeout(i,40)}};setTimeout(i,40)}},this.drawGridLines=function(e,t,n,i,o,a,s,r){r.beginPath();for(var l=0==e.x?n:0;l<=a;l+=n){var d=(Math.round(l*t)-.5)/t;r.moveTo(d,o),r.lineTo(d,s),r.stroke()}for(l=-n;l>=i;l-=n){d=(Math.round(l*t)-.5)/t;r.moveTo(d,o),r.lineTo(d,s),r.stroke()}for(var c=0==e.y?n:0;c<=s;c+=n){var u=(Math.round(c*t)-.5)/t;r.moveTo(i,u),r.lineTo(a,u),r.stroke()}for(c=-n;c>=o;c-=n){u=(Math.round(c*t)-.5)/t;r.moveTo(i,u),r.lineTo(a,u),r.stroke()}},this.configureContextDefaults=function(e,t){e.lineJoin="bevel",e.miterLimit=429496656,e.lineWidth=this.defaultLineWidth/t},this.configureContext=function(e,t,n,i){if("object"!=typeof i)return!0;if(!1===i.visible)return!1;if(Array.isArray(i.dashes)&&(e.setLineDash(i.dashes),"dashOffset"in i&&(e.lineDashOffset=i.dashOffset)),"cap"in i&&(e.lineCap=i.cap),"join"in i&&(e.lineJoin=i.join),"miterLimit"in i&&(e.miterLimit=i.miterLimit),"lineWidth"in i&&(e.lineWidth=i.lineWidth/t),"opacity"in i&&(e.globalAlpha=i.opacity),"object"==typeof i.shadow)if(e.shadowColor=i.shadow.colour,i.shadow.scale){var o=n*t;e.shadowBlur=i.shadow.blur*o,e.shadowOffsetX=i.shadow.xOffset*o,e.shadowOffsetY=i.shadow.yOffset*o}else e.shadowBlur=i.shadow.blur*n,e.shadowOffsetX=i.shadow.xOffset*n,e.shadowOffsetY=i.shadow.yOffset*n;return!0},this.setFillStyle=function(e,t){if(t instanceof CanvasImage){var n=e.createPattern(t.image,"repeat");e.fillStyle=n}else t instanceof EdenUI.plugins.Canvas2D.FillStyle?e.fillStyle=t.getColour(e):e.fillStyle=t},this.initZoneFromDrawingOpts=function(t,n){var i;if(t instanceof Object&&!1!==t.zone){if(void 0===(i=t.name)&&!0===t.zone)return root.currentObservableName();if(e.eden.isValidIdentifier(i)){var o=root.lookup(i+"_click");void 0===o.value()&&o.assign(!1,root.scope,root.lookup(n))}return i}},this.initZoneFromName=function(t,n){if(e.eden.isValidIdentifier(t)){var i=root.lookup(t+"_click");void 0===i.value()&&i.assign(!1,root.scope,root.lookup(n))}return t},this.findDrawableHit=function(e,t,n,i,o){var a=root.lookup("view_"+e+"_content").value(),s=canvases[e];if(s){var r=s.getContext("2d"),l=root.lookup("view_"+e+"_scale").value();return this.findDrawableHitInList(a,r,l,t,n,i,o)}},this.findDrawableHitInList=function(e,t,n,i,o,a,s){if(Array.isArray(e)){var r,l;a?(r=0,l=1):(r=e.length-1,l=-1);for(var d=r;a?d<e.length:d>=0;d+=l){var c=e[d];if("object"==typeof c)if(Array.isArray(c)){if(p=this.findDrawableHitInList(c,t,n,i,o,a,s))return p}else if(void 0!==c.isHit){if(!s&&void 0===c.name)continue;t.save();var u=c.isHit(t,n,i,o);if(t.restore(),!0===u)return c}else if(c.inverse){var p,h=c.inverse(i,o);if(void 0!==(p=this.findDrawableHitInList(c.items,t,n,h.x,h.y,a,s)))return p}}}},this.findAllDrawablesHit=function(e,t,n,i){var o=root.lookup("view_"+e+"_content").value(),a=canvases[e].getContext("2d"),s=root.lookup("view_"+e+"_scale").value();return this.findAllDrawablesHitInList(o,a,s,t,n,i)},this.findAllDrawablesHitInList=function(e,t,n,i,o,a){if(!Array.isArray(e))return[];for(var s=[],r=0;r<e.length;r++){var l=e[r];if("object"==typeof l)if(void 0!==l.isHit){if(!a&&void 0===l.name)continue;t.save();var d=l.isHit(t,n,i,o);t.restore(),!0===d&&s.push(l)}else if(l.inverse){var c=l.inverse(i,o),u=this.findAllDrawablesHitInList(l.items,t,n,c.x,c.y,a);u.length>0&&(s=s.concat(u))}}return s};var d={leftButton:!1,middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1};this.createCommon=function(t,i){var o,l,c=t,u=canvases[t];function p(){n.drawPicture(c)}function h(e){return"view_"+t+"_"+e}void 0===u?((o=$('<div id="'+t+'-canvascontent" class="canvashtml-content"></div>')).html('<canvas class="canvashtml-canvas noselect" id="'+t+'-canvas" tabindex="1"></canvas>'),l=o.find(".canvashtml-canvas"),u=l[0],canvases[t]=u,contents[t]=o[0],s[t]={},u.drawingQueued=!1,u.drawingInProgress=!1,u.rescale=!1):l=(o=$("#"+t+"-canvascontent")).find(".canvashtml-canvas");var v=[h("content"),h("background_colour"),h("scale"),h("zoom"),h("offset"),h("canvas_right"),h("canvas_bottom"),"mousePosition","mouseButton","mouseButtons","mouseCapture","mouseCaptured","mouseDown","mouseDownView","mouseFollow","mousePressed","mouseUp","mouseWheel","mouseWheelEnabled","mouseWheelVelocity","mouseView","mouseZone","mouseVelocity"];u.setAttribute("data-observables",v.join(",")),root.lookup("view_"+c+"_content").addJSObserver("repaintView",p);var g=root.lookup("view_"+c+"_background_colour");void 0===g.value()&&g.assign("white",root.scope,EdenSymbol.defaultAgent),g.addJSObserver("refreshView",p);var f=root.lookup("view_"+c+"_scale"),m=root.lookup("view_"+c+"_zoom"),b=root.lookup("view_"+c+"_offset"),y=root.lookup("view_"+c+"_canvas_right"),w=root.lookup("view_"+c+"_canvas_bottom"),S=root.lookup("view_"+c+"_width"),E=root.lookup("view_"+c+"_height"),x=!1;function I(){var t,i,o=f.value(),a=m.value(),s=o*a,r=b.value();r instanceof Point?(t=r.x,i=r.y):(t=0,i=0);var l,d=y.value();void 0!==d?(d=Math.ceil((y.value()+t)*s),u.width=d):u.width=a>1?Math.ceil(S.value()*a):Math.floor(S.value()),void 0!==w.value()?l=Math.ceil((w.value()+i)*s):a>1?l=Math.ceil(E.value()*a):(l=E.value(),void 0!==d&&d>Math.floor(S.value())&&(l-=e.scrollBarSize),l=Math.floor(l-1)),u.height=l,u.rescale=!0,n.drawPicture(c)}var k=f.value();void 0===k&&(f.assign(1,root.scope,EdenSymbol.defaultAgent),k=1),f.addJSObserver("refreshView",I);var A=m.value();void 0===A&&(m.assign(1,root.scope,EdenSymbol.defaultAgent),A=1);var C=!1;function _(){x?(x=!1,u.rescale=!0,n.drawPicture(c),C||(C=!0,setTimeout(_,1e3))):(I(),C=!1)}m.addJSObserver("refreshView",function(e,t){Math.round(100*t);x=!0,_()});var T,D,M=b.value();M instanceof Point?(T=M.x,D=M.y):(b.assign(new Point(0,0),root.scope,EdenSymbol.defaultAgent),T=0,D=0),b.addJSObserver("refreshView",I),null==y.value()&&y.assign(void 0,root.scope,EdenSymbol.defaultAgent),y.addJSObserver("repaintView",I),null==w.value()&&w.assign(void 0,root.scope,EdenSymbol.defaultAgent),w.addJSObserver("repaintView",I);var L=y.value();L=void 0===L?600:L*k+T;var U=w.value();U=void 0===U?500:U*k+D;var P=root.lookup("view_"+c+"_grid_visible");void 0===P.value()&&P.assign(!1,root.scope,EdenSymbol.defaultAgent),P.addJSObserver("refreshView",p);var N=root.lookup("view_"+c+"_grid_spacing");function O(e){var t,i=root.lookup("mouseFollow").value();switch(root.beginAutocalcOff(),d.insideCanvas=!0,e.button){case 0:d.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,EdenSymbol.hciAgent,i),t="Left";break;case 1:d.middleButton=!0,t="Middle";break;case 2:d.rightButton=!0,t="Right";break;case 3:d.button4=!0,t="Button4";break;case 4:d.button5=!0,t="Button5";break;default:t="Unknown"}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5;var o="|";if(d.leftButton&&(o+="Left|"),d.middleButton&&(o+="Middle|"),d.rightButton&&(o+="Right|"),d.button4&&(o+="Button4|"),d.button5&&(o+="Button5|"),root.lookup("mouseButtons").assign(o,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseButton").assign(t+" down",root.scope,EdenSymbol.hciAgent,i),1==d.buttonCount){var a=root.lookup("mousePosition").value();root.lookup("mouseDownView").assign(c,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseDown").assign(a,root.scope,EdenSymbol.hciAgent,i);var s=root.lookup("view_"+c+"_scale").value()*root.lookup("view_"+c+"_zoom").value(),r=$(this).offset(),l=(e.pageX-Math.round(r.left))/s,u=(e.pageY-Math.round(r.top))/s,p=root.lookup("view_"+c+"_offset").value();p instanceof Point&&(l-=p.x,u-=p.y);var h,v=n.findDrawableHit(c,l,u,!1,!1);h=void 0===v?void 0:v.name;var g=root.lookup("mouseZone");h!==g.value()&&g.assign(h,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseDownZone").assign(h,root.scope,EdenSymbol.hciAgent,i)}root.endAutocalcOff()}return void 0===N.value()&&N.assign(20,root.scope,EdenSymbol.defaultAgent),N.addJSObserver("refreshView",p),l.on("mousedown",O),l.on("mouseup",function(t){var n,i=root.lookup("mouseFollow").value();switch(root.beginAutocalcOff(),d.insideCanvas=!0,navigator.platform.toUpperCase().indexOf("MAC")>=0&&t.ctrlKey&&(t.button=2),t.button){case 0:d.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,EdenSymbol.hciAgent,i),n="Left";break;case 1:d.middleButton=!1,n="Middle";break;case 2:d.rightButton=!1,n="Right";break;case 3:d.button4=!1,n="Button4";break;case 4:d.button5=!1,n="Button5";break;default:n="Unknown"}if(d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5,root.lookup("mouseButton").assign(n+" up",root.scope,EdenSymbol.hciAgent,i),0==d.buttonCount){var o=root.lookup("mousePosition").value();root.lookup("mouseButtons").assign("",root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseUp").assign(o,root.scope,EdenSymbol.hciAgent,i),e.plugins.Canvas2D.endClick()}else{var a="|";d.leftButton&&(a+="Left|"),d.middleButton&&(a+="Middle|"),d.rightButton&&(a+="Right|"),d.button4&&(a+="Button4|"),d.button5&&(a+="Button5|"),root.lookup("mouseButtons").assign(a,root.scope,EdenSymbol.hciAgent,i)}root.endAutocalcOff()}).on("contextmenu",function(e){navigator.platform.toUpperCase().indexOf("MAC")>=0&&e.ctrlKey&&(e.button=2,O(e)),root.lookup("mouseContextMenuEnabled").value()||(e.preventDefault(),e.stopPropagation())}).on("click",function(e){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(e){var t=root.lookup("mouseFollow").value(),n=root.lookup("mouseDoubleClicks"),i=n.value();n.assign(i+1,root.scope,EdenSymbol.hciAgent,t)}).on("wheel",function(e){var t,i=e.originalEvent,o=E.value();t=i.deltaMode==WheelEvent.DOM_DELTA_LINE?n.defaultLineHeight:i.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=i.deltaX?S.value():o:1;var a=root.lookup("mouseFollow").value();if(0==i.deltaY||!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey){if(root.lookup("mouseWheelEnabled").value()){if(root.beginAutocalcOff(),0!==i.deltaY&&(!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey)){e.preventDefault(),e.stopPropagation();var s=root.lookup("mouseWheel"),r=s.value();r+=u=i.deltaY*t,s.assign(r,root.scope,EdenSymbol.hciAgent,a),root.lookup("mouseWheelVelocity").assign(u,root.scope,EdenSymbol.hciAgent,a)}if(0!==i.deltaX){e.preventDefault(),e.stopPropagation();var l=root.lookup("touchPanX"),d=l.value(),c=i.deltaX*t;d+=c,l.assign(d,root.scope,EdenSymbol.hciAgent,a),root.lookup("touchPanXSpeed").assign(c,root.scope,EdenSymbol.hciAgent,a)}root.endAutocalcOff()}}else{e.preventDefault(),e.stopPropagation(),root.beginAutocalcOff();var u=-i.deltaY*t;if(root.lookup("touchPinchEnabled").value()){var p=root.lookup("touchPinch"),h=p.value();h+=u,p.assign(h,root.scope,EdenSymbol.hciAgent,a)}else{var v=m.value();(v=v*(o+2*u)/o)<.05&&(v=.05),m.assign(v,root.scope,EdenSymbol.hciAgent,a)}root.endAutocalcOff()}}).on("mouseout",function(e){d.insideCanvas=!1;var t=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,EdenSymbol.hciAgent,t)}).on("mouseenter",function(e){if(!d.insideCanvas){var t;d.insideCanvas=!0,0==d.buttonCount?t="":(t="|",d.leftButton&&(t+="Left|"),d.middleButton&&(t+="Middle|"),d.rightButton&&(t+="Right|"),d.button4&&(t+="Button4|"),d.button5&&(t+="Button5|"));var n=root.lookup("mouseButtons"),i=n.value();if(t!=i){var o=root.lookup("mouseFollow").value();root.beginAutocalcOff(),n.assign(t,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseButton").assign("Enter window",root.scope,EdenSymbol.hciAgent,o);var a=root.lookup("mousePressed");a.value()!=d.leftButton&&a.assign(d.leftButton,root.scope,EdenSymbol.hciAgent,o),""==i&&""!=t&&(root.lookup("mouseDown").assign(void 0,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseDownView").assign(void 0,root.scope,EdenSymbol.hciAgent,o)),root.endAutocalcOff()}}}).on("mousemove",function(e){r=!0;var t=root.lookup("mouseFollow").value();root.beginAutocalcOff();var i,o,s,l,u=root.lookup("mouseView"),p=root.lookup("mousePosition"),h=u.value(),v=p.value();v&&(s=v.x,l=v.y);var g=root.lookup("view_"+c+"_scale").value()*root.lookup("view_"+c+"_zoom").value();if(d.capturing){var f=e.originalEvent;i=s+f.movementX/g,o=l+f.movementY/g}else{var m=$(this).offset();i=(e.pageX-Math.round(m.left))/g,o=(e.pageY-Math.round(m.top))/g;var b=root.lookup("view_"+c+"_offset").value();b instanceof Point&&(i-=b.x,o-=b.y)}u.assign(c,root.scope,EdenSymbol.hciAgent,t);var y,w=new Point(i,o);p.assign(w,root.scope,EdenSymbol.hciAgent,t);var S=Date.now();if(h==c&&void 0!==a){if((y=S-a)>=n.mouseVelocitySampleTime){var E=root.lookup("mouseVelocity"),x=E.value(),I=1e3*(i-s)/y,k=1e3*(o-l)/y;if(x){var A=n.mouseVelocityDampening,C=x.x;(I>0&&C>0||I<0&&C<0)&&(I=A*C+(1-A)*I);var _=x.y;(k>0&&_>0||k<0&&_<0)&&(k=A*_+(1-A)*k)}I=Math.ceil(I*g)/g,k=Math.ceil(k*g)/g;var T=new Point(I,k);E.assign(T,root.scope,EdenSymbol.hciAgent,t),a=S}}else a=S;var D,M=n.findDrawableHit(c,i,o,!1,!1);D=void 0===M?void 0:M.name;var L=root.lookup("mouseZone");D!==L.value()&&L.assign(D,root.scope,EdenSymbol.hciAgent,t),root.endAutocalcOff()}).on("keyup",function(e){var t=e.which,n=!1;if(e.altKey&&!e.shiftKey&&!e.ctrlKey){var i=root.lookup("view_"+c+"_zoom"),o=i.value();61==t||187==t?(o*=1.25,n=!0):173==t||189==t?(o/=1.25,n=!0):48==t&&(o=1,n=!0),i.assign(o,root.scope,EdenSymbol.hciAgent)}n&&(e.preventDefault(),e.stopPropagation())}),{initialWidth:L,initialHeight:U,code_entry:o,offsetSym:b,zoomSym:m,widthSym:y,heightSym:w,scaleSym:f}},this.createEmbedded=function(t,i,o){var a=t;eden.execute2("view_"+a+"_content is "+o+";");var s=n.createCommon(t,i),r=(s.initialWidth,s.initialHeight,s.code_entry),l=s.offsetSym,d=s.zoomSym,c=s.widthSym,u=s.heightSym,p=s.scaleSym;return{code_entry:r,contents:r,destroy:function(){delete canvases[a],delete contents[a]},resize:function(t,i){var o,s=l.value();s instanceof Point?(o=s.x,s.y):o=0;var r,h=d.value(),v=document.getElementById(a+"-canvas"),g=!1,f=c.value();if(void 0===f?(r=h>1?Math.ceil(t*h):Math.floor(t),v.width!=r&&(v.width=r,g=!0)):f=Math.ceil(f*p.value()*h+o),void 0===u.value()){if(h>1)m=Math.ceil(i*h);else{m=i,void 0!==f&&f>m&&(m-=e.scrollBarSize);var m=Math.floor(m-1)}m!=v.height&&(v.height=m,g=!0)}g&&n.drawPicture(a)}}},this.createDialog=function(t,i){var o,a=t.slice(0,-7),r=n.createCommon(a,i),l=r.initialWidth,d=r.initialHeight,c=r.code_entry,u=r.offsetSym,p=r.zoomSym,h=r.widthSym,v=r.heightSym,g=r.scaleSym;return $('<div id="'+t+'"></div>').html(c).dialog({appendTo:"#jseden-views",title:i,width:l+e.scrollBarSize,height:d+e.titleBarHeight,minHeight:120,minWidth:230,classes:{"ui-dialog":"canvas-dialog unpadded-dialog ui-front"}}),o={confirmClose:!0,destroy:function(){var e=s[a];for(var t in e)for(var n=e[t],i=0;i<n.length;i++){var o=n[i];$(o).detach()}delete canvases[a],delete contents[a]},resize:function(t,i){var o,s=u.value();s instanceof Point?(o=s.x,s.y):o=0;var r,l=p.value(),d=document.getElementById(a+"-canvas"),c=!1,f=h.value();if(void 0===f?(r=l>1?Math.ceil(t*l):Math.floor(t),d.width!=r&&(d.width=r,c=!0)):f=Math.ceil(f*g.value()*l+o),void 0===v.value()){if(l>1)m=Math.ceil(i*l);else{m=i,void 0!==f&&f>m&&(m-=e.scrollBarSize);var m=Math.floor(m-1)}m!=d.height&&(d.height=m,c=!0)}c&&n.drawPicture(a)}},n.drawPicture(a),o},root.lookup("mouseDownZone").addJSObserver("recordClick",function(e,t){if(eden.isValidIdentifier(t)){var n=root.lookup(t+"_click");!1===n.value()&&n.assign(!0,root.scope,EdenSymbol.hciAgent,!0)}}),this.endClick=function(){var e=root.lookup("mouseDownZone").value();if(eden.isValidIdentifier(e)){var t=root.lookup(e+"_click");!0===t.value()&&t.assign(!1,root.scope,EdenSymbol.hciAgent,!0)}},this.canvasNameFromElement=function(e){for(;e;){var t=e.id;if("-canvascontent"==t.slice(-14))return t.slice(0,-14);e=e.parentElement}return null},document.addEventListener("mouseup",function(t){var n=root.lookup("mouseFollow").value();if(root.beginAutocalcOff(),!d.insideCanvas){var i;switch(t.button){case 0:d.leftButton=!1,i="Left";break;case 1:d.middleButton=!1,i="Middle";break;case 2:d.rightButton=!1,i="Right";break;case 3:d.button4=!1,i="Button4";break;case 4:d.button5=!1,i="Button5";break;default:i="Unknown"}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5;var o=root.lookup("mouseButtons");if(0==d.buttonCount&&""!=o.value()){var a=root.lookup("mousePressed"),s=a.value();root.lookup("mouseButton").assign(i+" up",root.scope,EdenSymbol.hciAgent,n),o.assign("",root.scope,EdenSymbol.hciAgent,n),root.lookup("mousePosition").assign(void 0,root.scope,EdenSymbol.hciAgent,n),s&&a.assign(!1,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseUp").assign(void 0,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseView").assign(void 0,root.scope,EdenSymbol.hciAgent,n),e.plugins.Canvas2D.endClick()}}root.endAutocalcOff()}),document.addEventListener("mousedown",function(e){if(!d.insideCanvas){switch(e.button){case 0:d.leftButton=!0;break;case 1:d.middleButton=!0;break;case 2:d.rightButton=!0;break;case 3:d.button4=!0;break;case 4:d.button5=!0}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5}}),document.addEventListener("pointerlockchange",function(e){var t=null!==document.pointerLockElement;d.capturing=t;var n=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(t,root.scope,void 0,n)}),e.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:e.viewCategories.visualization,holdsContent:!0},document.location.pathname.slice(-15),Eden.Selectors.execute("plugins > canvas_merged",function(){eden.root.lookup("plugins_canvas_loaded").assign(!0,eden.root.scope),t&&t()})},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.Transform.CSSInfo=function(e,t,n){this.css=e,this.scaleX=t,this.scaleY=n},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Page=function(e,t){var n,i=e.eden.root.lookup("page"),o=e.eden.root.lookup("document"),a=i.value(),s=$("<div class='main-page page'></div>");$("#jseden-views").append(s).addClass("page-body");var r=[],l={},d={},c={},u=0;function p(e){if(!e)return"";if("header"!=e[0])return"";switch(e[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+e[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+e[1]+"</h2>")}}var h=["top","bottom","left","right","width","height","background","position","color","border","font","fontSize","fontFamily","fontWeight","borderBottom","borderLeft","borderRight","borderTop","overflow","padding","paddingTop","paddingLeft","paddingRight","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","textShadow"];function v(e){switch(typeof e){case"string":return e;case"number":return e+"px";default:return""}}function g(e){var t=[],n=[],i=(e=(e=(e=e.replace(/"jseden:([^"]*)"/g,"\"javascript:eden.execute2('$1;')\"")).replace(/'jseden:([^']*)'/g,"'javascript:eden.execute2(\"$1;\")'")).replace(/<jseden(-([\w\-]+))?(\s+(?:[^"'/>]*(?:"[^"]*")*(?:'[^']*')*)*)?(?:\/|(?:>((?:[^<]*(?:<(?!\/jseden\1>))*)*)<\/jseden\1))>/g,function(e,i,o,a,s,r,l){return void 0===s&&(s=""),t.push(s),n.push(function(e,t){var n={};if(n.tagType=e,void 0===t)return n;for(var i,o=/([^\s=]+)(?:\s*=\s*((?:"[^"]*")|(?:'[^']*')|\S*))?/g;null!==(i=o.exec(t));)if(void 0===i[2]||""==i[2])n[i[1]]=!0;else{var a,s=i[2][0];a='"'==s||"'"==s?i[2].slice(1,-1):i[2],/^\d+$/.test(a)&&(a=parseInt(a)),n[i[1]]=a}return n}(o,a)),"\0\0"})).split("\0\0");if(1==i.length)return e;for(var o=$("<div></div>"),a=0;a<i.length-1;a++)if(o.append($("<div class='page-paragraph'>"+i[a]+"</div>")),void 0===n[a].tagType){var s=t[a].split("\n").length;void 0===n[a].lines&&(n[a].lines=s),void 0===n[a].width&&(n[a].width="50%"),void 0===n[a].box&&(n[a].box=!0);var r=y(["script",n[a].static,[t[a]],n[a].name,n[a].box,n[a].lines,!1,n[a].float,n[a].width]);o.append(r)}else if(n[a])if("canvas"==n[a].tagType){var l=S(["canvas",n[a].name,n[a].source,n[a].width,n[a].height,n[a].float,n[a].box]);o.append(l)}else if("veden"==n[a].tagType){var d=w(["veden",n[a].name,n[a].width,n[a].height,n[a].float,t[a]]);o.append(d)}return o.append($("<div class='page-paragraph'>"+i[i.length-1]+"</div>")),o.get(0)}function f(e){if(e&&"element"==e[0]){var t,n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],r=e[6],l=(e[7],e[8],e[9],e[10],e[11],e[12]),d=e[13];switch(n){case"div":case"span":case"button":case"img":case"p":case"ul":case"ol":case"li":case"br":case"pre":case"h1":case"h2":case"h3":case"a":case"input":t=document.createElement(n);break;default:return void console.error("Invalid element type: "+n)}if(i&&(t.id=i),o&&(t.className=o),a&&"string"==typeof a){var c=g(a);"string"==typeof c?t.innerHTML=c:t.appendChild(c)}return a&&a instanceof Array&&m(t,a),s&&"string"==typeof s&&(t.cssText=s),s&&s instanceof Array&&function(e,t){for(var n=0;n<t.length;n++)void 0!==t[n]&&h[n]&&(e.style[h[n]]=v(t[n]))}(t,s),r&&i&&(t.onclick=function(e){var t=eden.root.lookup(i+"_click");console.log("ELEMENT CLICK"),t.assign(!0,eden.root.scope)}),"img"==n&&l&&(t.src=l),"a"==n&&d&&(t.href=d),t}}function m(e,t){if("string"!=typeof t[0])for(var n=0;n<t.length;n++){var i;(i=f(t[n]))&&e.appendChild(i)}else(i=f(t))&&e.appendChild(i)}function b(e){if(!e)return"";if("p"!=e[0])return"";var t;t=e[1]instanceof Array?e[1].join("&nbsp;"):e[1];var n=[],i=(t=t.replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden>/g,function(e,t,i,o,a){return console.log("ATTRIBS: "+t),n.push(i),"\0\0"})).split("\0\0");if(1==i.length)return $("<div class='page-paragraph'>"+t+"</div>");for(var o=$("<div></div"),a=0;a<i.length-1;a++){o.append($("<div class='page-paragraph'>"+i[a]+"</div>"));var s=n[a].split("\n").length,r=y(["script",!1,[n[a]],void 0,!0,s,!1,!1,"50%"]);o.append(r)}return o.append($("<div class='page-paragraph'>"+i[i.length-1]+"</div>")),o}function y(t){if(t&&"script"==t[0]){var n,i,o=t[1],a=t[2],s=t[3],r=t[4],l=t[5],c=t[6],p=t[7],h=t[8];if(void 0===s&&(s="embedded"+u,u++),o){var v;v=r?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>");var g,f=new EdenUI.Highlight(v.get(0));g=a instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(a):a;var m=new Eden.AST(g);f.highlight(m,-1,-1),p&&"none"!=p&&v.css("float",p),"50%"!=h&&("number"==typeof h?v.width(h):v.css("width",h));b=EdenUI.plugins.ScriptInput.getRequiredHeight(l,!0);return v.height(b),v}d[s]?(n=d[s]).update(a):(n=e.views.ScriptInput.embed(s,s,a,c),d[s]=n),i=r?$("<div id='"+s+"-dialog' class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>");var b=EdenUI.plugins.ScriptInput.getRequiredHeight(l,!0);return i.height(b),p&&"none"!=p&&i.css("float",p),"50%"!=h&&("number"==typeof h?i.width(h):i.css("width",h)),n.contents.appendTo(i),i.resizable(),i}}function w(t){if(t&&"veden"==t[0]){var n,i,o=t[1],a=t[2],s=t[3],r=t[4],l=t[5];return c[o]?n=c[o]:(n=e.views.Veden.embed(o,o,l),c[o]=n),(i=$("<div id='"+o+"-dialog' class='page-script-live page-script-live-box'></div>")).height(s),r&&"none"!=r&&i.css("float",r),"50%"!=a&&("number"==typeof a?i.width(a):i.css("width",a)),n.contents.appendTo(i),i.resizable(),i}}function S(t){var n,i=t[6],o=t[3],a=t[4];if(n=i?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>"),o&&n.css("width",v(o)),a&&n.css("height",v(a)),void 0===l[t[1]]){var s=e.views.Canvas2D.embedded(t[1],t[1],t[2]);l[t[1]]=s,n.append(s.code_entry),r.push(function(){s.resize(t[3],t[4])})}else l[t[1]].code_entry.appendTo(n),r.push(function(){l[t[1]].resize(t[3],t[4])});return"none"!=t[5]&&n.css("float",t[5]),n}function E(e){var t;if(t=e[1]?$("<ul></ul>"):$("<ol></ol>"),e[2]&&e[2]instanceof Array)for(var n=0;n<e[2].length;n++){var i=$("<li>"+e[2][n]+"</li>");t.append(i)}return t}function x(e,t){if(void 0!==t&&t instanceof Array){for(var i in u=0,l)l[i].code_entry.detach();for(var o in d)d[o].contents.detach();"default"==(n=t[2])&&(n="page-theme-default"),s.html(""),s.append(function(e){if(!e)return"";if("title"!=e[0])return"";var t,i=$("<div class='page-title "+n+"'></div>"),o=$("<div class='page-title-block'></div>");e[6]&&i.css("height",e[6]+"px"),t=e[1]?$("<span class='page-title-text "+n+"'>"+e[1]+"</span>"):$('<img border=0 src="'+e[5]+'"></img>');var a=$("<br/><span class='page-subtitle-text "+n+"'>"+e[2]+"</span>");return o.append(t),o.append(a),i.append(o),e[3],i}(t[1])),s.append(function(e,t){if(!e)return"";if(!(e instanceof Array))return"";for(var i=$("<div class='page-content "+n+"'></div>"),o=0;o<e.length;o++)if(void 0!==e[o])switch(e[o][0]){case"header":i.append(p(e[o]));break;case"p":i.append(b(e[o]));break;case"script":i.append(y(e[o]));break;case"canvas":i.append(S(e[o]));break;case"break":i.append($("<div class='clear'></div>"));break;case"list":i.append(E(e[o]))}return i}(t[3]));for(var a=0;a<r.length;a++)r[a]();r=[]}}x(0,a),i.addJSObserver("pageGenerator",x),o.addJSObserver("pageGenerator",function(e,t){if(void 0!==t&&t instanceof Array){for(var n in l)l[n].code_entry.detach();for(var i in d)d[i].contents.detach();s.html(""),m(s.get(0),t);for(var o=0;o<r.length;o++)r[o]();r=[]}}),Eden.Selectors.execute("plugins > page > page",function(){eden.root.lookup("plugins_page_loaded").assign(!0,eden.root.scope),t&&t()})},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";var edenfunctions={};function _formatVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}EdenUI.plugins.SymbolViewer=function(e,t){var n=this;this.instances=[];var i=0;this.createDialog=function(t,o,a){var s,r=t.slice(0,-7),d=root.lookup("createView"),c=$('<div class="symbollist-outer"></div>');c.html((s='\t\t\t<div class="symbollist-search-box-outer"> \t\t\t\t<input type="text" class="symbollist-search symbollist-control" /> \t\t\t\t<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> \t\t\t\t',s+='\t\t\t</div> \t\t\t<div class="symbollist-results"></div>'));var u=new EdenUI.plugins.SymbolViewer.SymbolList(e.eden.root,c.find(".symbollist-results")[0],a);$dialog=$('<div id="'+t+'"></div>').append(c).dialog({appendTo:"#jseden-views",title:o,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"symbollist-dialog ui-front"}}),n.instances.push(u),1==++i&&e.eden.root.addGlobal(l),c.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var t="edit_"+r;if(h.value.startsWith("select: ")){e.createView(t,"ScriptInput",void 0);var n=eden.root.lookup("view_"+t+"_tabs").value();Array.isArray(n)||(n=[]),n.push(h.value.substring(8)),eden.root.lookup("view_"+t+"_tabs").assign(n,eden.root.scope,EdenSymbol.hciAgent),eden.root.lookup("view_"+t+"_current").assign(n.length-1,eden.root.scope,EdenSymbol.hciAgent)}});var p=c.find(".symbollist-search-box-outer > .symbollist-search"),h=p[0],v=root.lookup("view_"+r+"_search_language");function g(){var t=v.value();return p.val().startsWith("select: ")?e.regExpFromStr("","",!1,t):e.regExpFromStr(p,"",!1,t)}function f(e,t){u.search(h.value,g()),"regexp"==t?p.attr("placeholder","search regular expression"):"simple"==t?p.attr("placeholder","simple search"):p.attr("placeholder","search")}f(0,v.value()),v.addJSObserver("refreshView",f);var m=root.lookup("view_"+r+"_search_string"),b=function(e,t){void 0!==t&&(t!==h.value&&(h.value=t),u.search(t,g()))},y=m.value();return void 0===y?(m.assign("",root.scope,d),u.search("",new RegExp(""))):b(0,y),m.addJSObserver("refreshView",b),p.keyup(function(){m.assign(h.value,root.scope,EdenSymbol.hciAgent)}),{destroy:function(){var t=n.instances.indexOf(u);n.instances.splice(t,1),0==--i&&e.eden.root.removeGlobal(l)}}},this.createObservableDialog=function(e,t){return n.createDialog(e,t,"obs")},this.createFunctionDialog=function(e,t){return n.createDialog(e,t,"func")},this.createAgentDialog=function(e,t){return n.createDialog(e,t,"agent")},this.createSymbolDialog=function(e,t){return n.createDialog(e,t,"all")};var o={},a={},s=!1;this.isCreationPending=function(e){return e in a},this.delay=40;var r=function(){for(x in n.instances){var e,t,i,r=n.instances[x];for(var l in void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(t=(e=$(r.symresults)).parent(),i=e.scrollTop(),e.detach()),a){var d=a[l];r.filter?r.filter.indexOf(l)>=0&&r.addSymbol(d,l):r.addSymbol(d,l)}for(var l in o)r.updateSymbol(l);void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(e.appendTo(t),e.scrollTop(i))}o={},a={},s=!1},l=function(e,t){var i=e.name;if(1==t)a[i]=e;else{if(i in a)return;o[i]=e}s||(s=!0,setTimeout(r,n.delay))};e.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:e.viewCategories.comprehension,menuPriority:0},e.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:e.viewCategories.comprehension,menuPriority:0},e.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:e.viewCategories.comprehension,menuPriority:0},e.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:e.viewCategories.comprehension,menuPriority:1},eden.root.lookup("plugins_symbolviewer_loaded").assign(!0,eden.root.scope),t()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(e,t,n){this.root=e,this.regExp=new RegExp(""),this.type=n,this.category="all",this.customCategory=!1,this.subtypes="all",this.symresults=t,this.symbols={},this.filter=void 0},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(e,t,n,i){if(void 0!==e)if(e.startsWith("select: ")){var o=Eden.Selectors.query(e.substr(8),"symbol");console.log(o),this.filter=o,this.regExp=t,this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};for(var a=0;a<o.length;a++){var s=o[a],r=this.root.symbols[s];r&&this.addSymbol(r,s)}}else{var l,d;for(l in this.searchStr=e,this.searchStrLowerCase=e.toLowerCase(),this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={},this.root.symbols)edenUI.plugins.SymbolViewer.isCreationPending(l)||(d=this.root.symbols[l],this.addSymbol(d,l))}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(e){void 0!==this.symbols[e]&&this.symbols[e].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(e,t){var n,i=!1;if(t.toLowerCase()==this.searchStrLowerCase)i=!0,n="exact-match";else if(!this.regExp.test(t))return;var o=!0;if(this.customCategory?Eden.isitCategory(t,this.category,this.type)||(o=!1):Eden.isitSystemSymbol(t)?"user"==this.category&&(o=!1):"system"==this.category&&(o=!1),void 0!==e.definition?"vars"==this.subtypes&&(o=!1):"formulas"==this.subtypes&&(o=!1),!o){if(!i)return;n="dirty-match"}var a="obs";if(e.definition){var s=e.getSource();a=/^proc\s/.test(s)?"agent":/^func\s/.test(s)?"func":"function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs"}else a="function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs";if("all"==this.type||this.type==a){var r=new EdenUI.plugins.SymbolViewer.Symbol(e,t,a,n);i?r.element.prependTo(this.symresults):r.element.appendTo(this.symresults),this.symbols[t]=r}},EdenUI.plugins.SymbolViewer.Symbol=function(e,t,n,i){switch(this.symbol=e,this.name=t,this.type=n,this.details=void 0,this.update=void 0,this.element=$('<div class="symbollist-result-element"></div>'),i&&this.element.addClass("symbollist-"+i+"-result"),n){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var o=this,a=!1;function s(){o.element.removeClass("symbollist-inline-editor"),o.update(),o.element.scrollLeft(0)}this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||a||(a=!0,setTimeout(function(){if(!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&a){a=!1;o.name;Eden.Selectors.goto("> :not(ACTIVE) >> "+e.name)}},350))}),"obs"==n&&this.element.dblclick(function(){if(a=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==o){var e=o.symbol.cache.value;if(void 0!==o.symbol.definition||"boolean"!=typeof e){EdenUI.plugins.SymbolViewer.inlineEditorSymbol=o,o.element.addClass("symbollist-inline-editor");var n,i,r=o.element.find(".result_value"),l=o.element.find(".result_separator");r.html(""),void 0!==o.symbol.definition?(n=o.symbol.getSource().replace(new RegExp("^\\s*"+t+"\\s+is\\s+"),""),i="is"):(n=Eden.edenCodeForValue(e),i="=");var d=$("<select></select>");"="==i?(d.append('<option value="is">is</option>'),d.append('<option value="=" selected="selected">=</option>')):(d.append('<option value="is" selected="selected">is</option>'),d.append('<option value="=">=</option>')),l.html(" "),l.append(d);var c=Eden.htmlEscape(n,!0),u=$('<input type="text" value="'+c+'" spellcheck="false" style="width: 100%"/>'),p=u.get(0);function h(e){var t,n,i=e.which;13==i?(t=d.get(0).value,";"!=(n=p.value).slice(-1)&&(n+=";"),eden.execute2(o.name+" "+t+" "+n),s(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0):27==i&&(s(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}u.on("keyup",h),u.on("blur",function(){setTimeout(function(){d.is(document.activeElement)||(s(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===o&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),d.on("keydown",h),d.on("blur",function(){setTimeout(function(){u.is(document.activeElement)||(s(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===o&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),r.append(u);var v=o.element.find(".symbollist-result-inner");v.length>0&&(v.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),p.focus(),p.select();var g=n.slice(0,1);'"'!=g&&"'"!=g&&"["!=g&&"{"!=g||(p.selectionStart=1,p.selectionEnd=n.length-1)}else!0===e?o.symbol.assign(!1,eden.root.scope,EdenSymbol.hciAgent,!0):o.symbol.assign(!0,eden.root.scope,EdenSymbol.hciAgent,!0)}}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var e,t,n=this.symbol.getSource();(e=void 0===this.symbol.definition||/^func\s/.test(n)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",null!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name])?(this.details=edenfunctions.functions[this.name],t="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):t="";var i="<span class='result_name'>"+e+"</span>"+t;if(void 0!==this.symbol.definition&&!/^func\s/.test(this.symbol.eden_definition)){var o=Eden.htmlEscape(n,!1,!0);i="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(o=Eden.htmlEscape("<pre>"+o+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+i+"</span>"}this.element.html(i)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var e=_formatVal(this.symbol.value()),t="<span class='result_name'>"+(void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+e+"</span>";if(void 0!==this.symbol.definition){var n=Eden.htmlEscape(this.symbol.getSource(),!1,!0);t="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(n=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+n+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+t+"</span>"}this.element.html(t)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var e,t,n=this.symbol.getSource();(e=void 0===this.symbol.definition||/^proc\s/.test(n)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",null!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name])?(this.details=edenfunctions.procedures[this.name],t="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):t="";var i="<span class='result_name'>"+e+"</span>"+t;if(void 0!==this.symbol.definition&&!/^proc\s/.test(n)){var o=Eden.htmlEscape(n,!1,!0);i="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(o=Eden.htmlEscape("<pre>"+o+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+i+"</span>"}this.element.html(i)};edenfunctions={};EdenUI.plugins.VersionViewer=function(e,t){var n=this;this.instances=[];var i=0;this.createDialog=function(t,o,a){var s=t.slice(0,-7),r=(root.lookup("createView"),$('<div class="versionviewer-outer"></div>'));r.html('<table class="version-viewer-list"></table>'),$dialog=$('<div id="'+t+'"></div>').append(r).dialog({appendTo:"#jseden-views",title:o,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"versionviewer-dialog ui-front"}});var l;root.lookup("view_"+s+"_search_string");return l=URLUtil.getParameterByName("load"),$.get(Eden.DB.remoteURL+"/project/versions",{projectID:l},function(e){var t=r.find(".version-viewer-list").html(""),n=$("<tr><th>Vid</th><th>Date</th><th>ParentDiff</th><th>Private</th></tr>");t.append(n),$(e).each(function(e,n){var i="";n.private&&(i="&#xf023;");var o=$('<tr><td><a href="?load='+l+"&vid="+n.saveID+'">'+n.saveID+"</td><td>"+n.date+"</td><td>"+n.parentDiff+"</td><td style=\"font-family:'FontAwesome'; font-size:20pt; color:gold\">"+i+"</td></tr>");t.append(o)})}),{destroy:function(){var t=n.instances.indexOf(symbollist);n.instances.splice(t,1),0==--i&&e.eden.root.removeGlobal(symbolChanged)}}},this.createVersionListDialog=function(e,t){return n.createDialog(e,t,"all")},e.views.VersionList={dialog:this.createVersionListDialog,title:"Version List",category:e.viewCategories.history,menuPriority:1},eden.root.lookup("plugins_VersionViewer_loaded").assign(!0,eden.root.scope),t()},EdenUI.plugins.VersionViewer.title="Version Viewer",EdenUI.plugins.VersionViewer.description="Show version details for a specified project.",EdenUI.plugins.VersionViewer.inlineEditorSymbol=void 0,EdenUI.plugins.ExternalHTMLContent=function(e,t){var n=!1,i=!1;function o(){n=!1}this.createDialog=function(t,a){i||(""==document.location.hash&&window.history.pushState({},"","#noNavigateAway"),window.addEventListener("popstate",function(){""==document.location.hash&&(n?window.history.forward(1):e.modalDialog("Leave Environment?","<p>Leaving this page will discard the current script. Your work will not be saved.</p><p>Are you sure you want to close JS-EDEN?</p>",["Close JS-EDEN","Return to Construal"],1,function(e){0==e?(doingNavigateAway=!0,window.history.back(1)):window.history.forward(1)}))}),i=!0);var s=t.slice(0,-7),r=root.lookup("createView"),l=$('<iframe marginwidth="13" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts" allowfullscreen="true" name="'+t+'"></iframe>'),d=root.lookup("_view_"+s+"_url"),c=l[0];function u(e,t){c.src=void 0===t?"plugins/external-html-content/undefined-url.html?view="+encodeURI(s):"plugins/external-html-content/redirect.html?view="+encodeURI(s)+"&url="+encodeURI(t)}u(0,d.value()),d.addJSObserver("refreshView",u);var p=$('<div id="'+t+'"></div>').html(l).dialog({title:a,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"external-html-content"}),h=$('<div class="external-html-content-toolbar">');p.append(h);var v=root.lookup("_view_"+s+"_toolbar_visible"),g=root.lookup("_view_"+s+"_toolbar_pinned");function f(e,t){t?(g.value()&&l.addClass("external-html-content-pinned"),h.css("display","block")):(l.removeClass("external-html-content-pinned"),h.css("display","none"))}void 0===v.value()&&v.assign(!0,root.scope,r),void 0===g.value()&&g.assign(!1,root.scope,r),f(0,v.value()),v.addJSObserver("refreshView",f),g.addJSObserver("refreshView",function(e,t){v.value()&&l.toggleClass("external-html-content-pinned",t)});var m=$('<input type="image" src="images/pin.png" width="28" height="28" alt="Pin toolbar" title="Click to pin the toolbar in place"/>');m.on("click",function(){g.assign(!g.value(),root.scope,Symbol.hciAgent),c.focus()}),h.append(m);var b=$('<input type="image" src="images/back-button.svg" width="28" height="28" alt="Back" title="Click to go back"/>');b.on("click",function(){n||setTimeout(o,1e3),n=!0,window.history.back(1),c.focus()}),h.append(b);var y=$('<input type="image" src="images/forward-button.svg" width="28" height="28" alt="Forward" title="Click to go forward"/>');y.on("click",function(){window.history.forward(1),c.focus()}),h.append(y);var w=$('<input type="image" src="images/refresh-button.png" height="28" alt="Refresh" title="Click to reload the page specified by _view_'+s+'_url"/>');return w.on("click",function(){u(0,d.value()),c.focus()}),h.append(w),{confirmClose:!0}},e.views.ExternalHTMLContent={dialog:this.createDialog,title:"External HTML Content",category:e.viewCategories.visualization,holdsContent:!0},e.eden.include("plugins/external-html-content/external-html-content.js-e",t)},EdenUI.plugins.ExternalHTMLContent.title="External HTML Content",EdenUI.plugins.ExternalHTMLContent.description="Allows construals to display web pages created outside of JS-EDEN.",EdenUI.plugins.HTMLContent=function(e,t){this.createDialog=function(e,t){var n=e.slice(0,-7);function i(e){return"view_"+n+"_"+e}var o=[i("background_colour"),i("content")],a=$('<div id="'+e+'-content" class="htmlviews-content" data-observables="'+o.join(",")+'"></div>');a.on("mousedown","button",function(e){var t=e.currentTarget.name,n=e.currentTarget.getAttribute("data-value");null!==n&&null!==n.charAt(0).match(/[0-9]?/)&&(n=parseInt(n)),eden.root.lookup(t).assign(null===n||n,eden.root.scope,EdenSymbol.hciAgent)}),a.on("mouseup","button",function(e){var t=e.currentTarget.name;null===e.currentTarget.getAttribute("data-value")&&eden.root.lookup(t).assign(!1,eden.root.scope,EdenSymbol.hciAgent)}),a.on("click",function(e){var t=e.srcElement.getAttribute("data-jseden");t&&""!=t&&(console.log(t),eden.execute2(t,{name:"execute"}))});var s=root.lookup("view_"+n+"_content"),r=function(e,t){if(void 0===t)a.html('<div class="htmlviews-undefined">Give view_'+n+"_content a value to display HTML formatted text here.</div>");else if("string"==typeof t)a.html(t);else{var i=a[0];if(i.firstChild===i.lastChild===t);else{for(;i.lastChild;)i.removeChild(i.lastChild);i.appendChild(t)}}};r(0,s.value()),s.addJSObserver("repaintView",r);var l=root.lookup("view_"+n+"_background_colour");function d(e,t){c.get(0).parentNode.style.background=t}l.addJSObserver("changeColour",d);var c=$('<div id="'+e+'"></div>').html(a).dialog({appendTo:"#jseden-views",title:t,width:600,height:450,minHeight:120,minWidth:230,classes:{"ui-dialog":"htmlviews-dialog ui-front"}}),u=l.value();return u&&d(0,u),{confirmClose:!0}},e.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:e.viewCategories.visualization,holdsContent:!0},Eden.Selectors.execute("plugins > html > html",function(){eden.root.lookup("plugins_html_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t()})},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(e,t){var n=this;this.createDialog=function(e,t){$dialog=$('<div id="'+e+'"></div>').html('<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230})};var i,o,a,s,r,l,d={"=":{precedence:1,associativity:"right",text:"=",whitespace:!0},"+=":{precedence:1,associativity:"right",text:"+=",whitespace:!0},"-=":{precedence:1,associativity:"right",text:"-=",whitespace:!0},"||":{precedence:3,associativity:"left",text:"||",whitespace:!0},or:{precedence:3,associativity:"left",text:"or",whitespace:!0},"&&":{precedence:4,associativity:"left",text:"&&",whitespace:!0},and:{precedence:4,associativity:"left",text:"and",whitespace:!0},"==":{precedence:5,associativity:"left",text:"==",whitespace:!0},"!=":{precedence:5,associativity:"left",text:"!=",whitespace:!0},"<":{precedence:6,associativity:"left",text:"<",whitespace:!0},"<=":{precedence:6,associativity:"left",text:"<=",whitespace:!0},">":{precedence:6,associativity:"left",text:">=",whitespace:!0},">=":{precedence:6,associativity:"left",text:">",whitespace:!0},"=~":{precedence:6,associativity:"left",text:"=~",whitespace:!0},"!~":{precedence:6,associativity:"left",text:"!=",whitespace:!0},"//":{precedence:7,associativity:"left",text:"//",whitespace:!0},"+":{precedence:8,associativity:"left",text:"+",whitespace:!0},"-":{precedence:8,associativity:"left",text:"-",whitespace:!0},"*":{precedence:9,associativity:"left",text:"*",whitespace:!0},"/":{precedence:9,associativity:"left",text:"/",whitespace:!0},"%":{precedence:9,associativity:"left",text:"%",whitespace:!0},"^":{precedence:11,associativity:"right",text:".",whitespace:!1},".":{precedence:14,associativity:"left",text:".",whitespace:!1}},c={"-":{precedence:10,text:"-"},"!":{precedence:10,text:"!"},"&":{precedence:10,text:"&"},not:{precedence:10,text:"!"},"++.":{precedence:11,text:"++"},"--.":{precedence:11,text:"--"},"*":{precedence:12,text:"*"}},u={"#":{precedence:11,text:"#"},".++":{precedence:11,text:"++"},".--":{precedence:11,text:"--"}},p={};this.convertTreeToEden=(i=c,o=d,a=u,s=p,r=13,l=function(e,t,n){if(!e.hasOwnProperty("children"))return e.name;var d,c,u,p=e.name,h=e.children;if(o.hasOwnProperty(p)&&2==h.length){c=(d=o[p]).precedence;var v=d.associativity,g=l(h[0],c,d.text),f=l(h[1],c,d.text);if("left"==v){var m=h[1].name;h[1].hasOwnProperty("children")&&2==h[1].children.length&&o.hasOwnProperty(m)&&c==o[m].precedence&&(f="("+f+")")}else{var b=h[0].name;h[0].hasOwnProperty("children")&&2==h[0].children.length&&o.hasOwnProperty(b)&&c==o[b].precedence&&(g="("+g+")")}u=d.whitespace?g+" "+d.text+" "+f:g+d.text+f}else if(i.hasOwnProperty(p))c=(d=i[p]).precedence,u=d.text+l(h[0],c,d.text);else if(a.hasOwnProperty(p))c=(d=a[p]).precedence,u=l(h[0],c,d.text)+d.text;else if(s.hasOwnProperty(p))d=s[p],this.precedence=d.precedence,u=d.code(h,n);else{c=r;for(var y=[],w=0;w<h.length;w++)y.push(l(h[w],0,void 0));u=p+"("+y.join(", ")+")"}return c<t&&(u="("+u+")"),u},function(e){return l(e,0,void 0)}),p["?"]={precedence:2,code:function(e){return n.convertTreeToEden(e[0])+"? "+n.convertTreeToEden(e[1])+" : "+n.convertTreeToEden(e[2])}},p["`...`"]={precedence:13,code:function(e){return"`"+n.convertTreeToEden(e[0])+"`"}},p["${{...}}$"]={precedence:13,code:function(e){return"${{ "+e[0].name+" }}$"}},p["(...)"]={precedence:13,code:function(e){for(var t=n.convertTreeToEden(e[0]),i=[],o=1;o<e.length;o++)i.push(n.convertTreeToEden(e[o]));return"("+t+")("+i.join(", ")+")"}},p["[...]"]={precedence:13,code:function(e){for(var t=[],i=0;i<e.length;i++)t.push(n.convertTreeToEden(e[i]));return"["+t.join(", ")+"]"}},p["[n]"]={precedence:13,code:function(e){return n.convertTreeToEden(e[0])+"["+n.convertTreeToEden(e[1])+"]"}},p["{...}"]={precedence:13,code:function(e){for(var t=[],i=0;i<e.length-1;i+=2)t.push(e[i].name+": "+n.convertTreeToEden(e[i+1]));return"{"+t.join(", ")+"}"}},p.Point={precedence:13,code:function(e,t){if("."==t){for(var i=[],o=0;o<e.length;o++)i.push(n.convertTreeToEden(e[o]));return"Point("+i.join(", ")+")"}return"{"+n.convertTreeToEden(e[0])+", "+n.convertTreeToEden(e[1])+"}"}},e.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:e.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_content","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","semicircleAngle","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,background_audio:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,semicircleAngle:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createExternalHTMLView:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,loadTextFileIntoObservable:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showAgents:!0,showFunctions:!0,showObservables:!0,showSymbols:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0,bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0},Eden.systemFunctionNames={Arc:!0,Arrowhead:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Object:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,semicircleAngle:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Arrowhead:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,hslColour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgbColour:!0,rotatePoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,semicircleAngle:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.symbolCategories["Sound and Video"]={agent:{bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0,unbind:!0},obs:{background_audio:!0,background_audio_url:!0,background_audio_paused:!0,background_audio_chapter:!0,background_audio_chapters:!0,background_audio_looping:!0,background_audio_speed:!0,background_audio_time:!0,background_audio_volume:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0},func:{Audio:!0,Video:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0}},Eden.isitSystemSymbol=function(e){return Eden.isitSystemObservable(e)||Eden.isitSystemAgent(e)||Eden.isitSystemFunction(e)},Eden.isitSystemObservable=function(e){return!!/^(_view|background_audio)_/.test(e)||e in Eden.systemObservableNames},Eden.isitSystemAgent=function(e){return!!/^_View_/.test(e)||e in Eden.systemAgentNames},Eden.isitSystemFunction=function(e){return e in Eden.systemFunctionNames},Eden.isitCategory=function(e,t,n){var i=Eden.symbolCategories[t];return"all"==n?"obs"in i&&e in i.obs||"agent"in i&&e in i.agent||"func"in i&&e in i.func:n in i&&e in i[n]},Eden.getSymbolCategories=function(e){if("all"==e)return Object.keys(Eden.symbolCategories);var t=[];for(var n in Eden.symbolCategories)e in Eden.symbolCategories[n]&&t.push(n);return t},EdenUI.plugins.SymbolLookUpTable=function(e,t){this.createDialog=function(e,t){code_entry=$('<div id="'+e+'-content" class="symbol-lookup-table-content">'+n(e)+"</div>"),$dialog=$('<div id="'+e+'"></div>').html(code_entry).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230})},e.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:e.viewCategories.comprehension,menuPriority:3},this.search=function(t){var n=$("#"+t+"-regexp"),o=e.regExpFromStr(n);document.getElementById(t+"-table-div").innerHTML=i(o,t)};var n=function(e){return"<div class='upper'>"+("<input id='"+e+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+e+"')\" placeholder='search' onload='setFocus()' />")+"</div><div id='"+e+"-table-div' class='lower'>"+i(new RegExp(""),e)+"</div>"},i=function(e,t){tableBodyHTML="";var n,i=[],r={};for(var l in root.symbols)if(n=root.symbols[l],e.test(l)){var d,c,u;if(void 0===n.eden_definition)c="-",d="function"==typeof n.cache.value?"Function":"Observable",u=Eden.htmlEscape(Eden.edenCodeForValue(n.cache.value));else if(0==(c=Eden.htmlEscape(n.eden_definition)).indexOf("proc")){if(Eden.isitSystemAgent(l)&&!new RegExp("\\b"+l+"\\b").test(e.source))continue;d="Agent",u=""}else if(0==c.indexOf("func")){if(Eden.isitSystemFunction(l)&&!new RegExp("\\b"+l+"\\b").test(e.source))continue;d="Function",u=""}else d="Dependency",u=Eden.htmlEscape(Eden.edenCodeForValue(n.cache.value));i.push([n,l,d,c,u]),r[l]=!0}for(var p=0;p<i.length;p++){var h=i[p];n=h[0];var v=o(n.observees,r,t),g=o(n.dependencies,r,t),f=v;""!=v&&""!=g&&(f+=", "),f+=g;var m=o(n.observers,r,t),b=o(n.subscribers,r,t),y=m;""!=m&&""!=b&&(y+=", "),y+=b;var w=a(n.dynamicDependencyTable,r,t),S=n.last_modified_by?n.last_modified_by:"Not yet defined";S=s(S,r,t);var E=Object.keys(n.jsObservers).join(", "),x="<tr id='"+t+"-symbol-"+h[1]+'\'><td class="lower"><p>'+h[1]+'</p></td><td class="lower"><p>'+h[2]+'</p></td><td class="lower"><p>'+h[3]+'</p></td><td class="lower"><p>'+h[4]+'</p></td><td class="lower"><p>'+f+'</p></td><td class="lower"><p>'+y+'</p></td><td class="lower"><p>'+w+'</p></td><td class="lower"><p>'+S+'</p></td><td class="lower"><p>'+E+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(h[1])?tableBodyHTML+=x:tableBodyHTML=x+tableBodyHTML}return'<table><tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower"><b>Definition</b></td><td class="lower"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>'+tableBodyHTML+"</table>"},o=function(e,t,n){var i=[];for(var o in e){var a=o.slice(1);i.push(s(a,t,n))}return i.join(", ")},a=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var a=e[o];void 0===a&&(a=""),i.push(s(a,t,n))}return i.join(", ")},s=function(e,t,n){return"*"==e[0]||"include"==e||"Not yet defined"==e?e:e in t?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+n+"-symbol-"+e+"')\">"+e+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+n+"', '"+e+"')\">"+e+"</a>"};this.addSymbolToSearch=function(t,n){var i,o=document.getElementById(t+"-regexp");i="false"==e.getOptionValue("optSimpleWildcards")?o.value+"|^"+n+"$":o.value+" "+Language.ui.search.disjunction+" "+n,o.value=i,this.search(t)},this.jump=function(e){var t=location.href;location.href="#"+e,history.replaceState(null,null,t)},t()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";edenfunctions={};function _formatFramerVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}SymbolMeta=function(e){this.symbol=e,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(e){var t=0,n=0,i=.1;for(var o in this.symbol.dependencies){t++,i+=(1-i)*SymbolMeta.DependencyComplexityRate;var a=o.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&n++}return i-=t*SymbolMeta.DependencyChangeProbability,0!=t&&(i=.5*i+n/t*.5),i<0?0:i},SymbolMeta.prototype.subscriberInterestingness=function(e){var t=0,n=0,i=0;for(var o in this.symbol.subscribers){t++,i+=(1-i)*SymbolMeta.SubscriberRate;var a=o.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&n++}return i=1-i,0!=t&&(i=.5*i+n/t*.5),i},SymbolMeta.prototype.nameInterestingness=function(){var e=this.symbol.name.substr(1);return"_"==e[0]?.5:/\d/.test(e)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(e){var t;t=this.dependencyInterestingness(e)*this.subscriberInterestingness(e)*this.nameInterestingness()*this.significance,this.interestingness=t},EdenUI.plugins.ObservableMining=function(e,t){var n=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];this.createDialog=function(e,t){e.slice(0,-7);var i=$("<div></div>");i.html('<div class="symbolframer-results"></div>'),n.symresults=i.find(".symbolframer-results")[0],$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var i=void 0,o=function(){if(void 0!==n.symresults){var e=$(n.symresults).parent();$(n.symresults).detach();for(var t=0;t<n.symbolsui.length;t++)if(n.symbolsui[t].meta.dodelete)n.symbolsui.splice(t,1);else if(0==n.symbolsui[t].meta.isinteresting){var a=n.symbolsui[t].element;n.symbolsui[t].element.hide("drop",{direction:"right"},"slow",function(){a.remove()}),n.symbolsui.splice(t,1)}var s=n.minInteresting(),r=n.maxInteresting();for(t=0;t<n.interesting.length;t++){for(var l=!1,d=0;d<n.symbolsui.length;d++)if(n.symbolsui[d].meta==n.interesting[t]){l=!0;break}if(!l){var c=new EdenUI.plugins.ObservableMining.Symbol;n.symbolsui.push(c),c.element.appendTo(n.symresults),c.symbol=n.interesting[t].symbol;var u=c.symbol.name.substr(1);c.name=u,c.meta=n.interesting[t],c.outofdate=!0,c.symbolChanged=i}}for(t=0;t<n.symbolsui.length;t++)n.symbolsui[t].update(s,r);$(n.symresults).appendTo(e)}for(t=0;t<n.interesting.length;t++)n.interesting[t].interestingness*=SymbolMeta.DecayRate;setTimeout(o,n.delay)};o(),i=function(e,t){var i=e.name.substr(1),o=n.meta[i];if(void 0!==n.symresults){if(e.definition&&e.eden_definition){var a=e.eden_definition;if(/^proc\s/.test(a))return;if(/^func\s/.test(a))return;if("function"==typeof e.cache.value)return}else if("function"==typeof e.cache.value)return;if((t||void 0===o)&&(n.meta[i]=new SymbolMeta(e),o=n.meta[i]),o.update(n),0==o.isinteresting&&(n.interesting.sort(function(e,t){return t.interestingness-e.interestingness}),o.interestingness>=n.minInteresting())){n.interesting.length;if(n.interesting.length==n.limitInteresting)n.interesting[n.interesting.length-1].isinteresting=!1,n.interesting.pop();n.interesting.push(o),o.isinteresting=!0,o.significance*=SymbolMeta.SigInterestingRate,n.interesting.sort(function(e,t){return t.interestingness-e.interestingness})}}},e.eden.root.addGlobal(i),e.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:e.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),t()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return this.interesting.length>0?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return this.interesting.length>0?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var e=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==e.editing&&(e.editing=!1,e.element.find("textarea").remove(),e.element.animate({height:"20px"},"fast"))}).click(function(){var t;e.editing||(t="function"==typeof e.symbol.value()&&void 0!==e.symbol.eden_definition?e.symbol.eden_definition:e.symbol.definition?e.symbol.eden_definition+";":e.name+" = "+Eden.edenCodeForValue(e.symbol.value())+";",e.element.animate({height:"60px"},{duration:200,complete:function(){var n=$('<textarea class="mine_edit_box" style="display: none"></textarea>');n.val(t),n.appendTo(e.element),n.show("fast")}}),e.editing=!0)}).draggable({distance:40,axis:"x",scroll:!1,drag:function(t,n){n.position.left>150?e.dodelete=!0:e.dodelete=!1},revert:function(t,n){return!e.dodelete},stop:function(t,n){e.dodelete&&(e.meta.significance*=SymbolMeta.SigDeleteRate,e.symbolChanged(e.symbol,!1),e.element.hide("drop",{direction:"right"},"slow",function(){e.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(e,t){if(void 0!==this.symbol){0==t&&(t=1);var n=(this.meta.interestingness-e)*(1/(t-e)),i=Math.round(8+12*n),o=_formatFramerVal(this.symbol.value()),a="<span>"+(void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+o+"</span>";if(void 0!==this.symbol.definition){var s=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);a="<span onmouseenter='EdenUI.showTooltip(event, \""+(s=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+s+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+a+"</span>"}var r=this.element.find(".observable");r.html(a),r.css({"font-size":i+"px"})}},EdenUI.plugins.ObservablePalette=function(e,t){var n=0,i={};function o(e){var t=e.value();return"function"!=typeof t||!/\breturn\s+([^\/;]|(\/[^\/*]))/.test(t.toString())}function a(e,t){var n=e.term,a=i[n];if(void 0===a){var s=new RegExp("^"+n);for(var r in a=[],root.symbols)s.test(r)&&o(root.symbols[r])&&a.push(r);i[n]=a}t(a)}function s(){var e=n;return n++,e}function r(e,t){e.target.style.minWidth=t.size.width+"px"}root.addGlobal(function(e,t,n){if(n&&o(t)){var a=t.name.slice(1);for(var s in i)new RegExp("^"+s).test(a)&&i[s].push(a)}}),this.createDialog=function(t,n){var i=t.slice(0,-7),o=root.lookup("createView"),l=$('<div class="observable-palette" id="'+t+'"></div>'),d={},c=$('<input type="text" class="observable-palette-search-box" placeholder="observable name"/>'),u=c[0];c.on("keyup",function(e){13==e.which&&(C(u.value,0,!1),u.value="")}),c.autocomplete({minLength:2,source:a});var p=$('<button type="button">+</button>');p.click(function(){C(u.value,0,!1),u.value=""});var h=$('<button type="button">-</button>');h.on("click",function(e){!function(e){var n=d[e];if(n){var i=t+"/"+e+"/",o=i.length,a=root.lookup(e);for(var s in a.jsObservers)s.slice(0,o)==i&&a.removeJSObserver(s);for(var r=[],c=0;c<n.length;c++){var u=n[c];u[0].parentNode.parentNode===l[0]?u.slideUp(400,"swing",function(){u.remove()}):r.push(u)}d[e]=r}}(u.value),u.value=""});var v=$("<label></label>"),g=$('<input type="checkbox"/>'),f=g[0];v.append(g),v.append(" Advanced");var m=root.lookup("_view_"+i+"_advanced"),b=m.value();void 0===b?(m.assign(!1,root.scope,o),l.addClass("observable-palette-no-advanced")):b||l.addClass("observable-palette-no-advanced"),m.addJSObserver("repaintView",function(e,t){l.toggleClass("observable-palette-no-advanced",!t),f.checked=t}),g.on("change",function(e){m.assign(e.target.checked,root.scope,o)});var y=$('<div class="observable-palette-toolbox"></div>');y.append(c),y.append(p),y.append(h),y.append(v);var w=[],S=7,E=root.lookup("_view_"+i+"_observables").value();Array.isArray(E)&&(E.length>0&&!Array.isArray(E[0])&&(E=[E]),E.length>S&&(S=E.length));for(var x=0;x<S;x++){var I=$('<div class="observable-palette-column"></div>');I.sortable({connectWith:".observable-palette-column, .observable-palette-dependencies",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",scroll:!1,tolerance:"pointer",receive:function(e,t){A(e.target,t.item)}}),x<S-1&&I.resizable({handles:"e",resize:r}),w.push(I),l.append(I)}w[0].append(y);var k={register:function(e,t){var n=d[e];void 0===n&&(n=[],d[e]=n);n.push(t)},remove:function(e,n,i){var o=d[e];if(void 0!==o)for(var a=0;a<o.length;a++)o[a]===n&&o.splice(a,1);root.lookup(e).removeJSObserver(t+"/"+e+"/"+i),n.slideUp(400,"swing",function(){n.remove()})},removeDuplicates:A};function A(e,t){for(var n=t.data("observable"),i=t[0],o=d[n],a=0;a<o.length;a++){var s=o[a],r=s[0];if(r!==i&&r.parentNode===e){s.removeFromDialog();break}}}function C(n,i,o){if(e.eden.isValidIdentifier(n)){var a,r=d[n];if(void 0===r)r=[],d[n]=r;else for(var l=0;l<r.length;l++){var c=r[l];if(c[0].parentNode===w[i][0]){a=c;break}}void 0===a?(a=function t(n,i,o,a,r,l){a?(a.hasClass("ui-accordion")&&a.accordion("destroy"),a.html("")):(a=$('<div class="observable-palette-obs-box observable-palette-visible" data-observable="'+i+'"></div>'),l&&a.data("editor","read-only"));var d,c=e.eden.root,u=c.lookup(i),p=u.value(),h=typeof p,v="string"==h,g=!l||v,f=u.eden_definition;if(!l&&void 0!==u.eden_definition){var m=f.match(/^\S+\s+is\s+(.*?);?$/);rhs=m[1],h="definition"}var b=$('<h3><span class="observable-palette-obs-heading">'+i+"</span> </h3>");l&&a.addClass("observable-palette-dependency-value-box");var y=$('<div class="observable-palette-heading-right"></div>');b.append(y),a.append(b);var w=Eden.prettyPrintValue("",p,128,!1,!1),S=$("<a>"+w+"</a>");y.append(S);var E=$("<select></select>");function x(e){var t,n=e.target.value;"hide"!=n?("boolean"==n?t=!1:"number"==n?t=0:"string"==n&&(t=""),u.assign(t,c.scope,EdenSymbol.hciAgent,!0)):r.remove(i,a,o)}l?E.append('<option value="'+h+'">'+h[0].toUpperCase()+h.slice(1)+"</option>"):(E.append('<option value="number">Number</option>'),E.append('<option value="string">Text (String)</option>'),E.append('<option value="boolean">Yes/No (Boolean)</option>'),E.append('<option value="undefined">Undefined</option>')),E.append('<option value="hide">Hide</option>'),E[0].value=h,E.on("change",x),y.on("click",function(e){e.stopPropagation()}),S.on("click",function(e){S.detach(),y.append(E),E.focus()}),E.on("blur",function(e){E.detach(),y.append(S)});var I=$("<div></div>");if("definition"==h){var k=$('<div class="observable-palette-definition"></div>');k.append(i+" is "),rhsSpan=$('<span class="observable-palette-definition-rhs" contenteditable="true"></span>'),rhsSpan.append(Eden.htmlEscape(rhs)),k.append(rhsSpan),k.append(";"),k.on("click",function(e){rhsSpan.focus(),k.addClass("focussed")}),rhsSpan.on("blur",function(e){k.removeClass("focussed")}),I.append(k);var A=$('<div class="observable-palette-view-commands"> </div>');I.append(A);var C=$('<a onclick="">Expand</a>');C.click(function(){L.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",0)});var _=$('<a onclick="">Collapse</a>');_.click(function(){L.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",!1)});var T=$('<a onclick="">Hide</a>');T.click(function(){var e=L.find(".observable-palette-obs-box");e.removeClass("observable-palette-visible"),e.slideUp()});var D=$('<a onclick="">Show</a>');D.click(function(){var e=L.find(".observable-palette-obs-box");e.addClass("observable-palette-visible"),e.slideDown()}),A.append(C),A.append(_),A.append(T),A.append(D);var M,L=$('<div class="observable-palette-dependencies"></div>');L.sortable({connectWith:".observable-palette-column",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",tolerance:"pointer",receive:function(e,t){var n=t.item,o=n.data("observable");(!u.isDependentOn("/"+o)||o==i&&"read-only"!=n.data("editor"))&&t.sender.sortable("cancel"),2==L.children(".observable-palette-visible").length&&A.slideDown(),r.removeDuplicates(e.target,n)},remove:function(e,t){L.children(".observable-palette-visible").length<2&&A.slideUp()}});var U=0;for(var P in u.dependencies){var N=u.dependencies[P];P=P.slice(1),void 0===N.eden_definition&&(M=t(n,P,s(),void 0,r,!1),r.register(P,M),L.append(M),U++)}if(U<2&&A.hide(),d=function(e,s){var l=e.eden_definition;void 0===l?t(n,i,o,a,r,!1):S.html(Eden.prettyPrintValue("",s,128,!1,!1))},I.append(L),v){var O=t(n,i,s(),void 0,r,!0);L.append(O)}}else if("number"==h){var B,V,H;if(H=1==p||-1==p||p!=Math.floor(p)?5e-4:1,0==p)B=0,V=10;else if(p>=-1&&p<=1)B=p>0?0:-1,V=1;else if(p<0){B=2*p;var R=Number((-p%H).toPrecision(14));0!=R&&R!=H&&(B=B+R-H),V=B+2*(p-B)}else B=0,V=2*Math.ceil((p/H).toPrecision(16))*H;var F=$('<input type="range" min="'+B+'" max="'+V+'" step="'+H+'" value="'+p+'" class="observable-palette-slider"/>'),j=F[0];F.on("input",function(e){u.assign(parseFloat(j.value),c.scope,EdenSymbol.hciAgent,!0)});var W=$('<table class="observable-palette-number-controls"></table>'),z=$("<tr></tr>");W.append(z);var G=$('<td colspan="3" class="observable-palette-left-cell observable-palette-right-cell observable-palette-slider-cell"></td>');G.append(F),z.append(G);var J=$('<tr class="observable-palette-limits"></tr>');W.append(J);var q,K,X=$('<td class="observable-palette-advanced observable-palette-left-cell"></td>'),Y=$('<input type="number" value="'+B+'" step='+H+'" title="Smallest value"/>'),Z=Y[0];X.append(Y),J.append(X),Y.on("input",function(e){var t=e.target.value;if(""!=t){var n=parseFloat(t);j.min=t;var i=u.value();n>=0&&i<n&&u.assign(n,c.scope,EdenSymbol.hciAgent,!0)}});var Q=!1;Y.on("focus",function(e){q=e.target.value}),Y.on("blur",function(e){var t=e.target.value;if(""==t)e.target.value=q,j.min=q;else{var n=parseFloat(t),i=parseFloat(j.max),o=parseFloat(j.step),a=n+Math.round((i-n)/o)*o;a<=n&&(a=n>0?n+Math.ceil((n/o).toPrecision(16))*o:Math.ceil((n/2/o).toPrecision(16))*o)<n+10*o&&(a=n+10*o),j.max=a,re.value=a,u.value()<n&&u.assign(n,c.scope,EdenSymbol.hciAgent,!0)}});var ee=$('<td class="observable-palette-centre-cell"></td>');J.append(ee);var te=$('<div class="observable-palette-number-centre"></div>');ee.append(te);var ne=$('<label><span class="observable-palette-label">Value&nbsp;</span></label>');te.append(ne);var ie=$('<input type="number" value="'+p+'" step='+H+'"/>'),oe=ie[0];ne.append(ie),ie.on("input",function(e){var t=e.target.value;""!=t&&(j.value=t,u.assign(parseFloat(t),c.scope,EdenSymbol.hciAgent,!0))}),ie.on("focus",function(e){Q=!0,K=e.target.value}),ie.on("blur",function(e){if(""==e.target.value)u.assign(parseFloat(K),c.scope,EdenSymbol.hciAgent,!0);else{var t=u.value();t<parseFloat(j.min)&&(Z.value=t,j.min=t),j.value=t}Q=!1});var ae=$('<td  class="observable-palette-advanced observable-palette-right-cell"></td>'),se=$('<input type="number" value="'+V+'" step='+H+'" title="Biggest value"/>'),re=se[0];ae.append(se),J.append(ae),se.on("input",function(e){j.max=e.target.value});var le=$('<label class="observable-palette-advanced"><span class="observable-palette-label observable-palette-step-label">Step&nbsp;</span></label>');te.append(le);var de=$('<input type="number" value="'+H+'" min="0" title="Slider step size"/>'),ce=de[0];ce.acceptedValue=H,le.append(de),de.on("input",function(e){var t=parseFloat(ce.value);if(t>0){var n,i=Math.floor(t);if(t==i){var o=String(t).match(/(0*)$/);n=Math.pow(10,o[1].length)}else n=Math.pow(10,-((t-i).toPrecision(15).replace(/0*$/,"").length-2));t==n&&t<ce.acceptedValue&&(n/=10),ce.acceptedValue=t,ce.step=n}}),de.on("blur",function(e){var t=parseFloat(ce.value);0==t?(ce.value=1,ce.acceptedValue=1):t<0||isNaN(t)?ce.value=ce.acceptedValue:(j.step=t,Z.step=t,re.step=t,oe.step=t)}),d=function(e,s){if("number"!=typeof s||void 0!==e.eden_definition)t(n,i,o,a,r,l);else if(S.html(Eden.prettyPrintValue("",s,128,!1,!1)),!Q){var d,c,u,p=parseFloat(j.min),h=parseFloat(j.max),v=parseFloat(j.step);s<p?(0==s?d=0:s>0?(d=Math.ceil(s/2/v)*v-v,0!=(u=Number((s%v).toPrecision(14)))&&u!=v&&(d+=u)):(d=2*s,0!=(u=Number((-s%v).toPrecision(14)))&&u!=v&&(d=d+u-v)),j.min=d,Z.value=d,c=d+Math.round((h-d)/v)*v,j.max=c,re.value=c):s>h&&(c=p+2*Math.ceil(((s-p)/v).toPrecision(16))*v,j.max=c,re.value=c),j.value=s,oe.value=s}},I.append(W)}else if("boolean"==h){var ue=$('<input type="checkbox"/>'),pe=ue[0],he=$('<span class="bool_text"></span>');function ve(e){he.fadeOut(250,"linear",function(){e?(he.html("true"),he.css("color","green")):(he.html("false"),he.css("color","red")),he.fadeIn(400,"swing",function(){S.html(e?"true":"false")})})}ue.on("change",function(e){var t=pe.checked;u.assign(t,c.scope,EdenSymbol.hciAgent,!0)}),d=function(e,s){!0!==s&&!1!==s||void 0!==e.eden_definition?t(n,i,o,a,r,l):(pe.checked=s,ve(s))},ve(p);var ge=$('<label class="observable-palette-bool"></label>');ge.append(ue),ge.append(he),I.append(ge)}else if("string"==h){var fe=$('<textarea class="string-input">'+p+"</textarea>"),me=fe[0];fe.on("input",function(e){var t=me.value;u.assign(t,c.scope,EdenSymbol.hciAgent,!0),me.style.height="",me.style.height=String(me.scrollHeight+4)+"px"}),d=function(e,s){"string"!=typeof s||void 0!==e.eden_definition?t(n,i,o,a,r,l):(me.value=s,me.rows=s.split("\n").length,S.html(Eden.prettyPrintValue("",s,128,!1,!1)))},I.append($('<div class="quote left-quote">&ldquo;</div>')),I.append(fe),I.append($('<div class="quote right-quote">&rdquo;</div>'))}else if("undefined"==h){if(I.append($('<p><span class="result_name">'+i+"</span> is currently undefined.</p>")),!l){var be=E.clone();be[0].value="undefined",be.on("change",x);var ye=$("<label>Choose type: </label>");ye.append(be);var we=$("<div></div>");we.append(ye),I.append(we)}d=function(e,s){void 0===s&&void 0===e.eden_definition||t(n,i,o,a,r,l)}}else d=function(e,s){void 0===s&&void 0===e.eden_definition||t(n,i,o,a,r,l)};return u.addJSObserver(n+"/"+i+"/"+o,d),g?(l&&I.find("input, textarea").attr("readonly","readonly"),a.append(I),a.accordion({active:"undefined"!=h&&void 0,collapsible:!0,heightStyle:"content"})):b.addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all observable-palette-static-header"),a.removeFromDialog=function(){r.remove(i,a,o)},a}(t,n,s(),void 0,k,!1),r.push(a),u(a)):a.slideUp(400,"swing",function(){a.detach(),u(a)})}function u(e){o?w[i].append(e):(0==i?y.after(e):w[i].prepend(e),e.hide(0,"linear",function(){e.slideDown(400)}))}}if(Array.isArray(E)){for(var _=!1,T=root.lookup("_view_"+i+"_search_language").value(),D=[],M=0;M<E.length;M++){var L=E[M];if(D[M]=[],Array.isArray(L))for(var U=0;U<L.length;U++){var P=L[U];if(e.eden.isValidIdentifier(P)&&!/[\\*+?^$|({[]|(\s+or\s+)/i.test(P))C(P,M,!0);else{var N=e.regExpFromStr(P,"",!0,T);D[M].push(N),_=!0}}}if(_)for(name in root.symbols)for(M=0;M<D.length;M++){var O=D[M];for(U=0;U<O.length;U++){if((N=O[U]).test(name)){C(name,M,!0);break}}}}l.dialog({title:n,width:260,height:400+e.scrollBarSize})},e.views.ObservablePalette={dialog:this.createDialog,title:"Observable Palette",category:e.viewCategories.interpretation},t()},EdenUI.plugins.ObservablePalette.title="Observable Palette",EdenUI.plugins.ObservablePalette.description="Provides the ability to change observables using a simple form.",EdenUI.plugins.ScriptGenerator=function(e,t){var n=this;this.createDialog=function(e,t){e.slice(0,-7);var i=$('<div class="script-generator"></div>'),o=($("<div></div>"),$('<div class="script-generator-controls"></div>'),$('<div class="script-generator-controls" style="float: right"></div>'),$('<div class="script-generator-code readonly" spellcheck="false"></div>'));i.append(o);var a=$('<button class="script-generator-refresh">&#xf021;</button>');i.append(a);var s={};o.on("click",".scriptgen-importex",function(e){var t=e.currentTarget.getAttribute("data-agent");s[t]?s[t]=!1:s[t]=!0,r()});var r=function(){o.html("");for(var e=n.generateScriptLines(s),t=0;t<e.imports.length;t++)if(""!=e.imports[t]){var i=e.imports[t].split(" ")[1].split("@")[0],a=e.imports[t].split(" "),r='<span class="eden-keyword">'+a[0]+'</span> <span class="eden-path">'+a[1]+"</span>";if(a.length>2)for(var l=2;l<a.length;l++)r+=" "+a[l];var d=$('<div class="eden-line"><span class="scriptgen-importex" data-agent="'+i+'">'+(s[i]?"&#xf055;":"&#xf056;")+"</span><span>"+(s[i]?'<span class="eden-comment">## '+e.imports[t]+"</span>":r)+"</span></div>");o.append(d)}o.append($('<div class="eden-line"></div>'));var c=$("<div></div>");o.append(c);var u=e.definitions.join("\n")+"\n## When agents\n\n"+e.agents,p=new Eden.AST(u,void 0,{name:"*JavaScript"});new EdenUI.Highlight(c.get(0)).highlight(p,-1,-1)};a.click(function(){r()}),r(),$('<div id="'+e+'"></div>').html(i).dialog({appendTo:"#jseden-views",title:t,width:790,height:700,minHeight:120,minWidth:230,dialogClass:"scriptgen-dialog"})};this.generateScriptLines=function(e){var t={},n=Eden.Generator.importsScript().split("\n");t.imports=n;var i=Eden.Generator.symbolScript(e).split("\n");t.definitions=i;var o=Eden.Agent.getActiveAgents(e,!1);return t.agents=o,t},this.baseConstrualSymbols={},this.changeListener=function(e,t){var i=e.last_modified_by;if(!t&&"include"!=i){var o=e.name.slice(1);void 0!==e.eden_definition&&void 0!==e.definition?n.baseConstrualSymbols[o]={eden_definition:e.eden_definition,last_modified_by:i}:n.baseConstrualSymbols[o]={cached_value:e.cached_value,last_modified_by:i}}},e.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(e,t){root.removeGlobal(n.changeListener)}),this.baseConstrualURL="",e.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:e.viewCategories.history},t()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(e){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(e,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=e)})},EdenUI.plugins.StateTimeLine=function(e,t){var n=this;this.createDialog=function(t,o){n.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+t+'-content" class="st-content"></div>').append($('<input id="'+t+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){n.ST.states.push(i("partial"));var o=document.getElementById(t+"-regex").value;""==o&&(o="State "+n.ST.nextBlankState),$("#"+t+"-content-states").append("<div id='stdiv"+e.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+o+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+e.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+e.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(t+"-regex").value="",e.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+t+'-content-states"></div>')),$dialog=$('<div id="'+t+'"></div>').html(code_entry).dialog({title:o,width:300,height:450,minHeight:120,minWidth:230})},n.ST={},n.ST.states=[],n.ST.nextBlankState=0,this.deleteState=function(e){$(document.getElementById("stdiv"+e)).remove()},this.changeState=function(t){for(var n in root.symbols)Eden.isitSystemSymbol(root.symbols[n].name.substring(1,root.symbols[n].name.length))||e.plugins.StateTimeLine.ignoreRE.test(root.symbols[n].name.substring(1,root.symbols[n].name.length))||delete root.symbols[n];e.plugins.ScriptInput.submitEdenCode(e.plugins.StateTimeLine.ST.states[t])};var i=function(t){var n=[],i=[],o=[],a=[],s=root.lookup("picture").eden_definition;for(var r in null==s?s="picture is [];":s+=";",root.symbols){var l=5,d=root.symbols[r],c=d.eden_definition;if(null==c&&(c="@"),0==c.indexOf("proc")){if("(Action)",l=2,"partial"==t&&Eden.isitSystemAgent(r))continue}else if(0==c.indexOf("func")){if("(Function)",l=1,"partial"==t&&Eden.isitSystemFunction(r))continue}else if("(Observable)",l=0,"partial"==t&&Eden.isitSystemObservable(r))continue;var u=Eden.edenCodeForValue(d.cached_value);if(!e.plugins.StateTimeLine.ignoreRE.test(r))if(1==l)a.push(c);else if(0==l){if("@"==u&&"@"==c)continue;"@"==c?i.push(r+" = "+u+";"):n.push(c+";")}else 2==l?o.push(c):console.log("oh dear error")}var p=[];p.push("autocalc = 0;");for(var h=0;h<i.length;h++)p.push(i[h]);for(h=0;h<n.length;h++)p.push(n[h]);for(h=0;h<o.length;h++)p.push(o[h]),p.push("");for(h=0;h<a.length;h++)p.push(a[h]),p.push("");return p.push(s),p.push("autocalc = 1;"),p.join("\n")};e.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:e.viewCategories.history},t()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(e,t){this.createDialog=function(t,n){var i={confirmClose:!1};return $dialog=$('<div id="'+t+'"></div>').html('<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>').dialog({title:n,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var t="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",n=new WebSocket(t);eden.listenTo("executeBegin",this,function(e,t){"net"!=e&&n.send(t)}),eden.listenTo("beforeAssign",this,function(e,t,i){"net"!=i&&n.send(e.name.slice(1)+"="+Eden.edenCodeForValue(t)+";")}),$("#sl-status").html("<p>Connected to: "+t+"</p>"),n.onerror=function(e){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+t+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),i.confirmClose=!1},n.onmessage=function(e){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(e.data)+"</p>"),eden.execute(e.data,"net","",{name:"/execute"},noop)},n.onopen=function(){i.confirmClose=!0,randomSeedSym=e.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):o("randomSeed"),o("randomGenerator")}}else console.log("WebSockets not supported");function o(t){var i=e.eden.root,o=i.lookup("definitionOf").definition(i)(t);n.send(o)}}),i},e.views.StateListener={dialog:this.createDialog,title:"State Listener",category:e.viewCategories.extension},e.eden.include("plugins/state-listener/state-listener.js-e",t)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(e,t){var n,i=this,o=!1,a=!1;Eden.Agent.importAgent("lib/dynamic","default",void 0,function(){}),i.connect=function(){var t=eden.root.lookup("network_address").value(),o=eden.root.lookup("network_port").value(),s=eden.root.lookup("network_key").value();if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var r="ws://"+t+":"+o+"/",l=new WebSocket(r);Eden.Agent.listenTo("executeline",this,function(e,t){if(e){var n=JSON.stringify({action:"executeline",name:e.name,lineno:t});l.send(n)}}),Eden.Agent.listenTo("patch",this,function(e,t,n){if(e){var i=JSON.stringify({action:"patch",name:e.name,patch:t,lineno:n});l.send(i)}}),Eden.Agent.listenTo("owned",this,function(e,t){"net"!=t&&l.send(JSON.stringify({action:"ownership",name:e.name,owned:e.owned}))}),eden.listenTo("beforeAssign",this,function(e,t,n){"net"!=n&&(console.log("ASSIGN: "+e.name+" = "+Eden.edenCodeForValue(t)),l.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:t})))}),$("#nr-status").html("<p>Connected to: "+r+"</p>"),l.onopen=function(t){for(var n in l.send(s),randomSeedSym=e.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):d("randomSeed"),d("randomGenerator"),a=!0,Eden.Agent.agents)Eden.Agent.agents[n].owned&&l.send(JSON.stringify({action:"ownership",name:n,owned:!0}));eden.root.lookup("network_connected").assign(!0,eden.root.scope)},l.onerror=function(e){a=!1,eden.root.lookup("network_connected").assign(!1,eden.root.scope),eden.root.lookup("network_error").assign(e,eden.root.scope)},l.onclose=function(){eden.root.lookup("network_connected").assign(!1,eden.root.scope)},i.sendControl=function(e,t){console.log("Send Control: "+e+"= "+t),console.log(t),l.send(JSON.stringify({action:"control",key:e,value:t}))},i.sendAssign=function(e){"net"!=e.last_modified_by&&l.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:e.value()}))},l.onmessage=function(e){n=JSON.parse(e.data);for(var t=0;t<n.length;t++)switch(line=n[t].code,line.action){case"patch":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.applyPatch(line.patch,line.lineno)});break;case"ownership":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.setOwned(line.owned,"net")});break;case"executeline":Eden.Agent.importAgent(line.name,"default",["noexec"],function(e){e.executeLine(line.lineno,!0)});break;case"assign":eden.root.lookup(line.symbol).assign(line.value,eden.root.scope,{name:"net"})}}}else console.log("WebSockets not supported");function d(t){var n=e.eden.root,i=n.lookup("definitionOf").definition(n)(t);l.send(JSON.stringify({code:i}))}},this.createDialog=function(e,t){return $dialog=$('<div id="'+e+'"></div>').html('<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){a?(a=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")):(eden.root.lookup("network_address").assign($("#nr-ipaddr").val(),eden.root.scope),eden.root.lookup("network_port").assign($("#nr-port").val(),eden.root.scope),eden.root.lookup("network_key").assign($("#nr-key").val(),eden.root.scope),i.connect())}),{confirmClose:!1}},this.playCode=function(e){if(void 0!==n[e]){var t=n[e].time/$("#nr-speedrange").val();t>1e3?($("#nr-status").html("<p>Next line in "+t+" milliseconds</p>"),o=!0):o&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(n[e].code,"net","",{name:"/execute"},noop),i.playCode(e+1)},t)}else $("#nr-status").html("<p>Replay finished</p>")},e.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:e.viewCategories.extension},e.eden.include("plugins/network-remote/network-remote.js-e",t),eden.root.lookup("plugins_network_loaded").assign(!0,eden.root.scope)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(e,t){var n="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");var i=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(i);i=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(i),this.name="window_name",this.createDialog=function(t,i){""==n&&(n=t);var o=[];viewlayoutstr="View Layout";var a=5*e.gridSizeY,s=3*e.gridSizeX,r=[],l=root.lookup("_views_list").value(),d=this.name;l.forEach(function(t){if(t!=d){var n=root.lookup("_view_"+t+"_x").value(),i=root.lookup("_view_"+t+"_y").value();r=[t,n=void 0!==n?n:0,i=void 0!==i?i:0,root.lookup("_view_"+t+"_width").value()+e.scrollBarSize,root.lookup("_view_"+t+"_height").value()+e.titleBarHeight,root.lookup("_view_"+t+"_title").value()],console.log(r),o.push(r)}});var c="";o.forEach(function(e,t){c+='<li data-row="'+Math.round(e[2]/a)+'" data-col="'+Math.round(e[1]/s)+'" data-sizex="'+Math.round(e[3]/(1*s))+'" data-sizey="'+Math.round(e[4]/(1*a))+'" data-name="'+e[0]+'" data-num="'+t+'">'+e[5]+" ["+e[0]+"]</li>"});var u='<a class="vl-update">Update</a><div class="gridster"><ul>'+c+"</ul></div>";$dialog=$('<div id="'+t+'"></div>').html(u).dialog({title:i,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[s,a],widget_margins:[0,0],min_cols:Math.round($(window).width()/s),max_cols:Math.round($(window).width()/s),helper:"clone",resize:{enabled:!0},serialize_params:function(e,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y,name:t.name,name:$(t.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var t=gridster.serialize(),n=1,i=1;t.forEach(function(e,t){e.col<n&&(n=e.col),e.row<i&&(i=e.row)}),t.forEach(function(t,o){var r="_view_"+t.name+"_y = "+(t.row-i)*a+";_view_"+t.name+"_x = "+(t.col-n)*s+";_view_"+t.name+"_width = "+(t.size_x*s-e.dialogFrameWidth)+";_view_"+t.name+"_height = "+(t.size_y*a-e.dialogFrameHeight)+";";console.log(r),eden.execute(r)})})},e.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:e.viewCategories.environment},t()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(e,t){var n=this;function i(e,t,n){this.edenVar=e,this.guard=t,this.actions=n}function o(e,t,n,i){this.name=e,this.parameters=t,this.definitions=n,this.actionsArr=i}this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(e,t,n,i,o){E(e)}}),i.prototype.toString=function(){return this.guard+" --\x3e "+this.actions},o.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};var a=function(e,t){for(var n=new Array,o=0;o<t.length;o++){var a=new String(t[o]).split("--\x3e");if(2==a.length){var s="this_g"+n.length;n.push(new i(s,a[0],a[1]))}}return n},s=function(){for(var e=document.getElementById("adm-name"),t=e.value.split("(")[0],i=!0,o=0;o<n.templates.length;o++){n.templates[o].name==t&&(i=!1)}t&&i?-1!=function(e){var t,n=new Array;e.split("(").length<2?t=e:(n=e.split("(")[1].split(")")[0].split(","),t=e.split("(")[0]);var i=[];(o=document.getElementById("adm-definitions")).value.length>0&&(i=o.value.split("\n"));var o,s=(o=document.getElementById("adm-actions")).value.split("\n"),r=a(0,s);return S(t,n,i,r),0}(e.value)&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",n.currIndex=-1):(alert("Please enter a unique name for this template."),e.focus())},r=function(e){if(e<-1?e=n.templates.length-1:e>=n.templates.length&&(e=-1),-1==e)document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="";else{var t=n.templates[e];document.getElementById("adm-name").value=t.name,document.getElementById("adm-definitions").value=t.definitions.join("\n"),document.getElementById("adm-actions").value=t.actionsArr.join("\n")}n.currIndex=e};this.createTemplateCreator=function(e,t){var i=$("<div></div>");i.html(function(e){return'<div id="'+e+'-input" class="adm-input-code">\t\t\t<div>Name:</div>\t\t\t<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>\t\t\t<div>Definitions:</div>\t\t\t<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>\t\t\t<div>Actions:</div>\t\t\t<div><textarea id="adm-actions" class="adm-actions"></textarea></div>\t\t</div>\t\t<div id="adm-results" class="entitylist-results">\t\t\t<ul id="results"> </ul>\t\t</div>'}(e)),$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){s()}},{id:"btn-delete",text:"Delete Template",click:function(){var e;(e=n.currIndex)>-1&&(alert("Deleting template "+n.templates[e].name),n.templates.splice(e),n.currIndex=e-1,r(n.currIndex))}},{text:"Previous",click:function(){r(n.currIndex-1)}},{text:"Next",click:function(){r(n.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};var l=function(e,t){var n=new Array;for(x in t){var i=t[x];n.push(i.replace(/this/g,e))}return n},d=function(e){var t;for(x in n.templates)if(n.templates[x].name==e){t=n.templates[x];break}return t},c=function(){for(var e=document.getElementById("template-menu"),t=e.options[e.selectedIndex].value,i=d(t),o=document.getElementById("entity-name"),a=o.value,s=!0,r=0;r<n.entities.length;r++){n.entities[r].name==a&&(s=!1)}if(0!=s){var c=$("#instantiate-params").find("input"),p=0,h=new Array;for(x in c){var g=c[x];if("text"==g.type){var f=b(i.parameters[p]),m=b(g.value);h.push(g),eden.executeEden(a+"_"+f+" is "+m+";"),p++}}var y=l(a,i.definitions);-1!=u(a,y)&&(v(a,y,i.actionsArr),alert("Successfully added instantiation of "+t+" as "+a),function(e,t){for(x in e.value="",t)t[x].value=""}(o,h))}else alert("please enter a unique name for this instantiation")},u=function(e,t){e=b(e);for(var i=0;i<t.length;i++){var o=b(t[i]);eden.executeEden(e+"_"+o),n.definitions.push(e+"_"+o)}};this.createInstantiator=function(e,t){var i=$("<div></div>");for(x in i=$('<div id="template-instantiator">\t\t\t\t\t<div>Templates:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<select id="template-menu">\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t\t<div>Entity name:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<textarea id="entity-name"></textarea>\t\t\t\t\t</div>\t\t\t\t\t<div>Parameters:</div>\t\t\t\t\t<div id="instantiate-params"></div>\t\t\t\t</div>'),$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){c()}}]}),n.templateList=new EdenUI.plugins.ADM.TemplateList,n.templates){var o=n.templates[x];n.templateList.addTemplate(o.name,o.parameters)}};var p=function(e){var t,i;for(x in n.entities)if(n.entities[x].name==e){t=n.entities[x],i=x;break}if(null!=t){for(x in n.entities.splice(i,1),n.actionLists)if(n.actionLists[x].entityName==e){i=x,n.actionLists[x].remove();break}null!=n.actionLists&&n.actionLists.splice(i,1),null!=n.entityList&&n.entityList.removeEntity(e)}else alert(e+" doesn't exist to delete.")},h=function(e,t,i){var o=d(e);if(null==o)return alert("no template with name "+e),-1;for(x in n.entities)if(n.entities[x].name==i)return alert("Please enter a unique entity name"),-1;if(""==t)var a=[];else if(-1==t.indexOf(","))a=[t];else a=t.split(",");if(a.length!=o.parameters.length)return alert("not enough parameters to instantiate "+o),-1;for(x in a){var s=b(o.parameters[x]),r=b(a[x]);eden.executeEden(i+"_"+s+" is "+r+";")}var c=l(i,o.definitions),p=u(i,c);return-1!=p&&v(i,c,o.actionsArr),p},v=function(e,t,o){var a=function(e,t){var n=new Array;for(x in t){var o=t[x],a=o.guard.replace(/this/g,e),s=o.actions.replace(/this/g,e),r=o.edenVar.replace(/this/g,e);n.push(new i(r,a,s))}return n}(e,o),s=new function(e,t,n){this.name=e,this.definitions=t,this.actionsArr=n,this.queuedActions=new Array}(e,t,a);for(x in n.entities.push(s),a){var r=a[x],l=r.edenVar+" is "+r.guard+";";eden.executeEden(l)}if(null!=n.actionLists){var d=new EdenUI.plugins.ADM.ActionsList(e);n.actionLists.push(d),g(s,d)}null!=n.entityList&&n.entityList.addEntity(e,t,a)};this.actionPush=function(e){n.selectedActions.push(e)},this.actionRemove=function(e){var t=new Array;for(x in n.selectedActions){var i=n.selectedActions[x];i!=e&&t.push(i)}n.selectedActions=t},this.refreshHumanPerspective=function(){for(x in n.entities){var e,t=n.entities[x];for(y in n.actionLists){var i=n.actionLists[y];if(i.entityName==t.name){e=i;break}}e.clear();var o=[];for(x in t.queuedActions){var a=t.queuedActions[x].split(";"),s=a[0];if(s.length>0){a.splice(0,1);var r=!0;a[0].length>0&&(o.push(a.join(";")),r=!1),e.addAction(s,r)}}t.queuedActions=o,g(t,e)}};var g=function(e,t){for(var n=0;n<e.actionsArr.length;n++){var i=e.actionsArr[n];if(!0===eden.root.lookup(i.edenVar).value()){var o=i.actions.split(";"),a=o[0],s=!0;o.splice(0,1),o[0].length>0&&(e.queuedActions.push(o.join(";")),s=!1),t.addAction(a,s)}}};this.createHumanPerspective=function(t,i){var o=$("<div></div>");for(x in o=$('<div id="human-perspective" class="actionlist"></div>'),$dialog=$('<div id="'+t+'"></div>').html(o).dialog({title:i,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){e.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){!function(){for(x in n.selectedActions){var t=n.selectedActions[x];if(945==(t=b(t)).charCodeAt(0))if("r"==t[2])a=(a=t.split("(")[1]).substring(0,a.length-1),p(a);else if("i"==t[2]){var i=t.split("(")[1],o=t.split("(")[2].split(")")[0],a=t.split("as")[1];if(-1==h(i,o,a))break}else alert("Action on another entity must one of α_remove(entity_name), α_r, α_instantiate(template(param_value) as entity_name) or α_i");else eden.executeEden(t+";")}n.selectedActions=new Array,e.plugins.ADM.refreshHumanPerspective()}()}}]}),n.actionLists=new Array,n.entities){t=n.entities[x].name;n.actionLists.push(new EdenUI.plugins.ADM.ActionsList(t))}e.plugins.ADM.refreshHumanPerspective()};this.entityPush=function(e){n.selectedEntities.push(e)},this.entityRemove=function(e){var t=new Array;for(x in n.selectedEntities){var i=n.selectedEntities[x];i!=e&&t.push(i)}n.selectedEntities=t};this.createInstanceList=function(e,t){var i=$("<div></div>");for(x in i.html('<div id="entity-list" class="instance-list"></div>'),$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){!function(){for(x in n.selectedEntities)p(n.selectedEntities[x]);alert("Entities successfully deleted."),n.selectedEntities=new Array}()}}]}),n.entityList=new EdenUI.plugins.ADM.EntityList,n.entities){var o=n.entities[x];n.entityList.addEntity(o.name,o.definitions.join("\n"),o.actionsArr.join("\n"))}};var f=function(e){var t=e.split(":")[1];return b(t.split("(")[0])},m=function(e){var t=e.split(":")[1].split("(")[1];return t.length>1?t.split(")")[0].split(","):[]},b=function(e){for(;32==e.charCodeAt(0)||9==e.charCodeAt(0);)e=e.substring(1,e.length);for(;32==e.charCodeAt(e.length-1)||9==e.charCodeAt(e.length-1);)e=w(e);return e},w=function(e){return e.substring(0,e.length-1)},S=function(e,t,i,s){for(x in n.templates)if(n.templates[x].name==e)return alert("Templates must have unique names."),-1;var r=new o(e,t,i,a(0,s));return n.templates.push(r),null!=n.templateList&&n.templateList.addTemplate(e,t),1},E=function(e){var t,n=e.split("\n"),i=new Array,o=new Array,a=new Array,s=!1,r=!1,l=!1;for(x in n){var d=n[x];if(""!=(d=b(d)))if(0==l)if("{"==d[0])l=!0,-1!=d.indexOf("name:")&&(t=f(d),i=m(d));else{var c=d.split("(")[0],u=d.split("(")[1].split(")")[0],p=w(b(d.split("as")[1]));if(-1==(v=h(c,u,p)))break}else if(1==s){-1!=d.indexOf("}")&&(d=w(d),s=!1),d.length>0&&o.push(d)}else if(1==r){-1!=d.indexOf("}")&&(d=w(d),r=!1),d.length>0&&a.push(d)}else if("}"==d[0]){l=!1;var v=S(t,i,o,a);if(t="",i=new Array,o=new Array,a=new Array,-1==v)return}else if(-1!=d.indexOf("name:"))t=f(d),i=m(d);else if(-1!=d.indexOf("definitions:")||-1!=d.indexOf("defs:")){if(s=!0,(d=b(d)).split("{").length>1)-1!=(g=b(d.split("{")[1])).indexOf("}")&&(g=w(g),s=!1),g.length>0&&o.push(g)}else if(-1!=d.indexOf("actions:")){var g;if(r=!0,(d=b(d)).split("{").length>1)-1!=(g=b(d.split("{")[1])).indexOf("}")&&(g=w(g),r=!1),g.length>0&&a.push(g)}}};this.createAdvancedInput=function(e,t){var n=document.createElement("textarea");n.style.boxSizing="border-box",n.style.width="100%",n.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(n),$dialog=$('<div id="'+e+'"></div>').html($code_entry).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var e=n.value;E(e),n.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},e.addViewCategory("adm","Abstract Definitive Machine"),e.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:e.viewCategories.adm},e.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:e.viewCategories.adm},e.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:e.viewCategories.adm},e.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:e.viewCategories.adm},e.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:e.viewCategories.adm},t()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(e,t){var n=new EdenUI.plugins.ADM.Template(e,t);n.element.appendTo(this.templateList),this.templates.push(n)},EdenUI.plugins.ADM.Template=function(e,t){this.template=e,this.element=$("<option value="+e+">"+e+"</option>");var n=this.showParamInput;this.element.click(function(){n(t)}),""==document.getElementById("instantiate-params").innerHTML&&n(t)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(e){var t=document.getElementById("instantiate-params");for(x in t.innerHTML="",e){var n=e[x],i=document.createElement("label");i.innerHTML=n+":",t.appendChild(i);var o=document.createElement("input");o.type="text",t.appendChild(o);var a=document.createElement("br");t.appendChild(a)}},EdenUI.plugins.ADM.ActionsList=function(e){var t=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+e),this.actionresults.innerHTML="<label><b>Actions for "+e+":</b></label>",t.appendChild(this.actionresults),this.actions=new Array,this.entityName=e},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(e,t){var n=new EdenUI.plugins.ADM.Action(e,t);n.element.appendTo(this.actionresults),this.actions.push(n)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){document.getElementById("human-perspective").removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(e,t){e=e;this.action=e,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var n=!1;this.element.hover(function(){0==n?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==n?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){0==n?(edenUI.plugins.ADM.actionPush(e),$(this).css("backgroundColor","#6666CC"),n=!0):(edenUI.plugins.ADM.actionRemove(e),$(this).css("backgroundColor","white"),n=!1)}),this.update(t)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(e){var t='<li class="type-function"><span class="result_name">';t=1==e?t+this.action+"</span></li>":t+this.action+" ... </span></li>",this.element.html(t)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(e,t,n){var i=new EdenUI.plugins.ADM.Entity(e,t,n);i.element.appendTo(this.entityList),this.entities.push(i)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(e){var t;for(x in this.entities)if(this.entities[x].entity==e){t=x;break}this.entities.splice(t,1);var n=document.getElementById("element-"+e);this.entityList.removeChild(n)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(e,t,n){this.entity=e,this.element=$('<div class="entitylist-element" id=element-'+e+"></div>");var i='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(i);t=t,n=n;var o=!1;this.element.hover(function(){0==o?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==o?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){if(this.innerHTML==i){var a=document.createElement("div");a.innerHTML="<label>Definitions:</label><br>\t\t\t\t\t<textarea disabled>"+t+"</textarea><br>\t\t\t\t\t<label>Actions:</label><br>\t\t\t\t\t<textarea disabled>"+n+"</textarea><br>",this.appendChild(a),edenUI.plugins.ADM.entityPush(e),$(this).css("backgroundColor","#6666CC"),o=!0}else this.innerHTML=i,edenUI.plugins.ADM.entityRemove(e),$(this).css("backgroundColor","white"),o=!1})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var e='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(e)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.DBView=function(e,t){this.createDialog=function(e,t){var n,i,o=$('<div id="'+e+'-content" class="dbview-content"><div class="dbview-controls"><div class="dbview-select"><span class="dbview-label">Query:</span><input class="dbview-select-text" type="text"></input></div></div></div>'),a=$('<table class="dbview-table"></table>');a.appendTo(o);var s=o.find(".dbview-select-text").get(0),r=void 0,l=e.slice(0,-7),d=new Eden.Agent(void 0,"view/db/"+l+"/config"),c="_view_"+l+"_source";function u(){0==Array.isArray(r)&&(r=[["Value"],[[r]]]);for(var e=a.get(0);e.firstChild;)e.removeChild(e.firstChild);if(n=r[0],i=r[1],Array.isArray(n)||(i=r,n=[["List"]]),Array.isArray(i)){for(var t=$("<tr></tr>"),o=0;o<n.length;o++){var s=$("<th></th>");s.html(n[o]),s.appendTo(t)}t.appendTo(a);for(var l=0;l<i.length;l++){var d=$("<tr></tr>");for(o=0;o<n.length;o++){var c;(c="scope"==n[o]?$('<td class="dbview-disabled"></td>'):$("<td contenteditable></td>")).appendTo(d);var u=Array.isArray(i[l])?i[l][o]:i[l];c.html("<div class='dbview-cellcontent'>"+Eden.edenCodeForValue(u)+"</div>")}d.appendTo(a)}}}return d.declare(c),a.on("input","td",function(e){var t=e.target.cellIndex,n=e.target.parentNode.rowIndex-1;if(!(t<0||n<0))e.target.textContent}).on("mouseenter","td",function(e){e.target.cellIndex,e.target.parentNode.rowIndex}).on("mouseleave","td",function(e){a.find(".dbview-dependant").removeClass("dbview-dependant"),a.find(".dbview-dependency").removeClass("dbview-dependency")}),o.on("input",".dbview-select-text",function(e){d.setSource("_view_"+l+"_source is "+s.value),d.execute(!0,!0)}),r=d.state[c],u(),d.on(c,function(e,t){r=t,u()}),$('<div id="'+e+'"></div>').html(o).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dbview-dialog"}),{confirmClose:!0}},e.views.DBView={dialog:this.createDialog,title:"Database Viewer",category:e.viewCategories.visualization},t()},EdenUI.plugins.DBView.title="DBView",EdenUI.plugins.DBView.description="Display a table showing entire database contents.",EdenUI.plugins.SpeechSynthesis=function(e,t){var n=!1;function i(e,t){if(n)n=!1;else{var o,a,s=root.lookup("speak"),r=root.lookup("speakingList"),l=root.lookup("speakingIndex"),d=root.lookup("speaking"),c=root.lookup("speakingID"),u=root.lookup("speakingText"),p=root.lookup("speakingSpeech"),h=root.lookup("speakingCharIndex"),v=r.value(),g=l.value();if(a=window.speechSynthesis.paused,window.speechSynthesis.cancel(),a&&window.speechSynthesis.pause(),g||(g=1),""!=e){if("finished"==e){var f=u.value();"string"==typeof f&&h.assign(f.length+1,root.scope,s)}else"interrupted"==e&&(n=!0);o=c.value(),eden.isValidIdentifier(o)&&root.lookup(o+"_status").assign(e,root.scope,s)}if(t&&g++,h.assign(1,root.scope,s),root.lookup("speakingTime").assign(0,root.scope,s),Array.isArray(v)&&g<=v.length){d.value()||d.assign(!0,root.scope,s);var m=v[g-1];if(!(m instanceof SpeakingWords)||m.cancelled)return void i("",!0);m.prepareUtterance();var b=m.utterance;o=m.id,c.assign(o,root.scope,s),eden.isValidIdentifier(o)&&root.lookup(o+"_status").assign("speaking",root.scope,s),u.assign(b.text,root.scope,s),p.assign(m,root.scope,s),t&&l.assign(g,root.scope,s),m.hasBeenSpoken=!0,window.speechSynthesis.speak(b)}else d.assign(!1,root.scope,s),c.assign("",root.scope,s),u.assign("",root.scope,s),p.assign(void 0,root.scope,s),Array.isArray(v)&&l.assign(v.length+1,root.scope,s)}}function o(e,t){var n,i,o,a,s=window.speechSynthesis.getVoices();e&&(-1!=(i=(e=e.toLowerCase()).indexOf("-"))?(o=e.slice(0,i),a=!0):(o=e,a=!1)),t&&(n=new RegExp("\\b"+t+"\\b","i"));for(var r=void 0,l=!1,d=!1,c=!1,u=!1,p=0;p<s.length;p++){var h=s[p],v=h.lang,g=!1,f=!1,m=!1;if(e&&v&&(e==(v=v.toLowerCase())?(g=!0,f=!0):o==v?g=!0:-1!=(i=v.indexOf("-"))&&v.slice(0,i)==o&&(g=!0)),t&&n.test(h.name)&&(m=!0),(!d&&!v&&!l||!d&&(!v||!e)&&h.default||g&&!d||a&&f&&!c||g&&!a&&h.default||f&&h.default||m&&!u&&(!e||!v&&!d||g))&&(!u||m||g&&!d)){if(l=!g,d=g,c=f,u=m,(!t||u)&&(c||d&&!a)&&h.default)return h;r=h}}return void 0===r&&(r=s[0]),r}root.lookup("speakingList").addJSObserver("sendToTTS",function(e,t){var n=root.lookup("speak");if(Array.isArray(t)){var o=root.lookup("speakingIndex"),a=o.value();if(a>t.length+1)o.assign(t.length+1,root.scope,n);else if(a<=t.length){for(var s=a<1?0:a-1;s<t.length;s++){var r=t[s];if(r instanceof SpeakingWords){r.prepareUtterance();var l=r.id;eden.isValidIdentifier(l)&&root.lookup(l+"_status").assign("waiting",root.scope,n)}}root.lookup("speaking").value()?t[a-1]!==root.lookup("speakingSpeech").value()&&i("interrupted",!1):i("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(e,t){if("speak"!=e.last_modified_by){var n=root.lookup("speakingList").value();if(Array.isArray(n)&&t<=n.length){root.lookup("speaking").value()?i("interrupted",!1):i("",!1);for(var o=t;o<n.length;o++)n[o]instanceof SpeakingWords&&n[o].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(e,t){t?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(t,n,a,s,r,l,d){var c,u,p,h,v,g,f;this.id=t,this.utterance=new window.SpeechSynthesisUtterance(String(n)),this.hasBeenSpoken=!1,void 0===s?(g=e.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===g&&(g="native"),p=!0):(g=s,p=!1),this.utterance.volume=r,void 0===l?(null!==(c=e.getOptionValue("speechSynthDefaultRate"))&&(this.utterance.rate=parseFloat(c)),h=!0):(this.utterance.rate=l,h=!1),void 0===d?(null!==(c=e.getOptionValue("speechSynthDefaultPitch"))&&(this.utterance.pitch=parseFloat(c)),v=!0):(this.utterance.pitch=d,v=!1);var m=this;if(Object.defineProperty(this,"text",{get:function(){return m.utterance.text},set:function(e){m.utterance.text=e},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return m.utterance.lang},set:function(e){if(e){var t=e.indexOf("-");-1!=t&&(e=e.slice(0,t+1)+e.slice(t+1).toUpperCase()),m.utterance.lang=e}else m.utterance.lang="";u=!1;var n=o(e,g);m.utterance.voiceURI=n.voiceURI,m.utterance.voice=n},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return g},set:function(e){g=e,p=!1;var t=o(this.utterance.lang,g);m.utterance.voiceURI=t.voiceURI,m.utterance.voice=t},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return m.utterance.volume},set:function(e){m.utterance.volume=e},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return m.utterance.rate},set:function(e){m.utterance.rate=e,h=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return m.utterance.pitch},set:function(e){m.utterance.text=e,v=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return f},set:function(e){(f=e)&&m.id&&root.lookup(m.id+"_status").assign("cancelled",root.scope,root.lookup("SpeakingWords"))},enumerable:!0}),this.toString=function(){var e="SpeakingWords("+Eden.edenCodeForValue(t)+', "'+m.utterance.text+'", ';return u?e+="@, ":e=e+'"'+m.utterance.lang+'", ',p?e+="@, ":e=e+Eden.edenCodeForValue(g)+", ",e=e+m.utterance.volume+", ",h?e+="@, ":e=e+this.utterance.rate+", ",v?e+="@)":e=e+this.utterance.pitch+")",e},void 0===a?(this.lang=e.getOptionValue("speechSynthDefaultLanguage"),u=!0):this.lang=a,eden.isValidIdentifier(t)){var b=root.lookup(t+"_status");void 0===b.value()&&b.assign("not queued",root.scope,root.lookup("SpeakingWords"))}this.prepareUtterance=function(){if(m.hasBeenSpoken&&!("chrome"in window)){var e=new window.SpeechSynthesisUtterance(m.utterance.text);e.lang=m.utterance.lang,e.volume=m.utterance.volume,e.rate=m.utterance.rate,e.pitch=m.utterance.pitch,e.voiceURI=m.utterance.voiceURI,e.voice=m.utterance.voice,e.onboundary=m.utterance.onboundary,e.onend=m.utterance.onend,e.onerror=m.utterance.onerror,m.utterance=e,m.hasBeenSpoken=!1}},this.utterance.onboundary=function(e){var t=root.lookup("speak");root.lookup("speakingCharIndex").assign(e.charIndex+1,root.scope,t);var n=e.elapsedTime;n<=1e7&&root.lookup("speakingTime").assign(n,root.scope,t)},this.utterance.onend=function(){i("finished",!0)},this.utterance.onerror=function(){i("error",!0)}},Eden.Selectors.execute("plugins > speech-synthesis > speech-synthesis",function(){eden.root.lookup("plugins_speech_sythesis_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t()})},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!",EdenUI.plugins.MIDI=function(e,t){var n=this,o=!1;Object.defineProperty(this,"initialized",{get:function(){return o},enumerable:!0});var a=[];this.addSoftwareDriver=function(e){console.log("New JavaScript MIDI driver registered."),a.push(e),o&&e()};var s=[],r=[],l=root.lookup("midiNumberOfOutputs");l.assign(0,eden.root.scope);var d=root.lookup("midiNumberOfInputs");d.assign(0,eden.root.scope);var c={};function u(e,t){if(e<s.length){for(var n=s[e],i=0;i<t.length&&i<16;i++){var o=t[i];Number.isInteger(o)&&o>=1&&o<=128&&n.send([192+i,o-1])}t.length>16&&eden.error(new Error("MIDI programs list is too long."))}}this.addSoftSynth=function(e){if(s.push(e),l.assign(s.length,eden.root.scope),console.log('Added software synthesizer "'+e.name+'".'),o){var t=s.length-1,n=c[t];void 0!==n&&u(t,n.value())}},this.addSoftInput=function(e){r.push(e),d.assign(r.length,eden.root.scope),console.log('Added software input "'+e.name+'".')};var p=0,h=0;function v(e){if(void 0===e)return p;if(Number.isInteger(e)){if(e<1||o&&e>s.length)throw new Error("No MIDI output device exists with device number "+e);return e-1}if(o&&"string"==typeof e){for(var t=0;t<s.length;t++)if(e==s[t].name)return t;throw new Error("No MIDI output device exists with device name "+e)}throw new Error("The output device must be given as a positive integer.")}Object.defineProperty(this,"outputNames",{get:function(){for(var e=[],t=0;t<s.length;t++)e.push(s[t].name);return e},enumerable:!0}),Object.defineProperty(this,"inputNames",{get:function(){for(var e=[],t=0;t<r.length;t++)e.push(r[t].name);return e},enumerable:!0}),this.roundValue=function(e){return"number"==typeof e?e<=0?0:e<=1?1:e>=127?127:Math.round(e):void 0},this.isValidNote=function(e){return Number.isInteger(e)&&e>=-20&&e<=107},this.loadPrograms=function(e,t){e=v(e);var n=s[e];if(!Array.isArray(t))throw new Error("MIDI programs must be given as a list.");for(var i=t.length,o=new Array(i),a=0;a<i;a++){var r=t[a];if(!(Number.isInteger(r)&&r>=1&&r<=128))throw new Error("Item "+a+" must be an integer between 1 and 128.");o[a]=r-1}n.loadPrograms&&n.loadPrograms(o)},this.bindPrograms=function(e,t){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");t=v(t),Array.isArray(e.value())||void 0!==e.definition||e.assign([1],eden.root.scope);var n=function(e,n){Array.isArray(n)?o&&u(t,n):eden.error(new Error("Illegal MIDI programs list: "+Eden.edenCodeForValue(n)))};n(0,e.value()),e.addJSObserver("bind",n),c[t]=e},this.getInputs=function(){return r};var g=!1,f=[],m=[];this.initialize=function(e,n){var i=e.value();if(o)i.apply(null,n);else if(f.push(i),m.push(n),!g){g=!0;console.log("Initializing MIDI..."),window.navigator.requestMIDIAccess?window.navigator.requestMIDIAccess().then(function(e){if(e){var t,n;for((n=(t=e.outputs.values()).next()).done&&console.log("No MIDI output devices found.");!n.done;){var i=n.value;console.log("Found MIDI output device "+i.name+"."),s.push(i),n=t.next()}for((n=(t=e.inputs.values()).next()).done&&console.log("No MIDI input devices found.");!n.done;){var o=n.value;console.log("Found MIDI input device "+o.name+"."),r.push(o),n=t.next()}l.assign(s.length,eden.root.scope),d.assign(r.length,eden.root.scope)}p(0)},function(e){var t="Unable to access WebMIDI: "+e;console.log(t),eden.error(new Error(t)),p(0)}):(console.log("This browser does not support the WebMIDI API.  No access to hardware MIDI devices is possible."),p(0))}function p(e){if(e<a.length)0==e&&console.log("Found "+a.length+" MIDI drivers written in JavaScript."),a[e](p,[e+1]);else{for(var n in c)u(n,c[n].value());o=!0,g=!1,eden.root.lookup("plugins_midi_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t(),console.log("Done.");for(var i=0;i<f.length;i++)f[i].apply(null,m[i])}}},this.mergeMessageLists=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(Array.isArray(i))t.push(i);else if(void 0!==i)throw new Error("Item "+n+" must be a list of MIDI messages.")}var o=t.length,a=new Array(o),s=0;for(n=0;n<o;n++)a[n]=0,s+=t[n].length;var r=new Array(s);for(n=0;n<s;n+=2){for(var l,d,c=1/0,u=0;u<o;u++){var p=a[u];if(p<t[u].length){var h=t[u],v=h[p],g=h[p+1];g<c&&(c=g,d=v,l=u)}}r[n]=d,r[n+1]=c,a[l]=a[l]+2}return r},this.playMIDI=function(e,t,n){if(e=v(e),void 0===t)t=0;else if("number"!=typeof t)throw new Error("The delay must be a number.");if(!Array.isArray(n))throw new Error("The message stream must be an array.");for(var i=s[e],o=window.performance.now()+t,a=0;a<n.length;a+=2)i.send(n[a],o+n[a+1])};var b={};this.alterNote=function(e,t,i,o,a,r){var l=b[e],d=s[v(t)];n.isValidNote(o)?o===l?a>0&&(r?d.send([144+i,o+20,n.roundValue(a)]):d.send([144+i,o+20,0])):(a>0?(void 0!==l&&d.send([144+i,l+20,0]),r&&d.send([144+i,o+20,n.roundValue(a)])):a<0?void 0!==l&&d.send([128+i,l+20,n.roundValue(-a)]):void 0!==l&&d.send([144+i,l+20,0]),b[e]=o):void 0!==l&&d.send([144+i,l+20,0])},this.alterVelocity=function(e,t,i,o,a){if(o===b[e]&&void 0!==o){var r=s[v(t)];a>0?r.send([160+i,o+20,n.roundValue(a)]):a<0?r.send([128+i,o+20,n.roundValue(-a)]):r.send([144+i,o+20,0])}};var y={volume:7};this.bindControlChange=function(e,t,i,o){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");var a,r=s[v(t)];if("string"==typeof o){if(void 0===(a=y[o.toLowerCase()]))throw new Error("Unknown control name "+o)}else{if(!(Number.isInteger(o)&&o>=0&&o<=127))throw new Error("The control must be specified either as a string or as an integer between 0 and 127 inclusive.");a=o}function l(e,t){var o=n.roundValue(t);void 0!==o&&r.send([176+i,a,o])}l(0,e.value()),e.addJSObserver("bind",l)};var w=16,S=new Array(w),E=root.lookup("midiInputDevice"),x=root.lookup("midiInputTimestamp"),I=root.lookup("midiInputMessage"),k=0,A=0,C=root.lookup("midiInputMessageCount");function _(e){root.lookup("startMIDIInput");if(k==A)S.length>w&&(S=new Array(w)),S[0]=e,k=1,A=0;else{var t,n=e.timeStamp;for(t=k-1;t>=A&&!(S[t].timeStamp<=n);t--);t==k-1?S[k]=e:S.splice(t+1,0,e),k++}C.assign(k-A,eden.root.scope)}this.startInput=function(e){if(void 0===e)for(i=0;i<r.length;i++)r[i].onmidimessage=_;else e=function(e){if(void 0===e)return h;if(Number.isInteger(e)){if(e<1||o&&e>r.length)throw new Error("No MIDI input device exists with device number "+e);return e-1}if(o&&"string"==typeof e){for(var t=0;t<r.length;t++)if(e==r[t].name)return t;throw new Error("No MIDI input device exists with device name "+e)}throw new Error("The input device must be given as a positive integer.")}(e),r[e].onmidimessage=_},this.fetchInputMessage=function(){if(A!=k){root.lookup("startMIDIInput");var e=S[A],t=S.length;A++,t>=2*w&&A>.8*t-1&&(S.splice(0,A),k-=A,A=0);var n,i=e.target;i&&(n=i.name),root.beginAutocalcOff(),E.assign(n,root.scope),x.assign(e.timeStamp,root.scope),I.assign(e.data,eden.root.scope),C.assign(k-A,eden.root.scope),root.endAutocalcOff()}},this.clearInputMessages=function(){S.length>w&&(S=new Array(w)),k=0,A=0,C.assign(0,eden.root.scope)},Eden.Selectors.execute("plugins > midi > midi",function(){})},EdenUI.plugins.MIDI.title="MIDI",EdenUI.plugins.MIDI.description="Adds musical capabilities to JS-EDEN.",EdenUI.plugins.MIDIDotJS=function(e,t){var n="plugins/midi/emulation/soundfonts/FluidR3_GM/",i=new Array(127);function o(){e.plugins.MIDI.addSoftwareDriver(function(t,o){var a,s={name:"MIDI.js",loadPrograms:function(e){for(var t=0;t<e.length;t++)i[e[t]]=!0;a.loadPlugin({soundfontUrl:n,instrument:e})},send:function(e,t){var o=e[0],s=240&o,r=15&o,l=e[1],d=e[2];switch(void 0===t?t=0:t-=window.performance.now(),s){case 128:a.noteOff(r,l,t/1e3);break;case 144:0==d?a.noteOff(r,l,t/1e3):a.noteOn(r,l,d,t/1e3);break;case 176:switch(l){case 7:var c=d/127*(d/127)*64;MIDI.setVolume(r,c,t/1e3);break;default:console.log("Unable to change MIDI control number "+l+" using MIDI.js")}break;case 192:i[l]||(i[l]=!0,a.loadPlugin({soundfontUrl:n,instrument:l})),a.setInstrument(r,l,t);break;default:console.log("Unable to map MIDI command "+o.toString(16)+" to MIDI.js")}},clear:function(){}},r=["inc/shim/Base64binary.js"];"true"==e.getOptionValue("developer")?r.push("build/MIDI.js"):r.push("build/MIDI.min.js"),function i(l){l==r.length?(a=window.MIDI).loadPlugin({soundfontUrl:n,onsuccess:function(){e.plugins.MIDI.addSoftSynth(s),t&&t.apply(this,o)}}):$.ajax({url:"plugins/midi/emulation/lib/MIDI.js/"+r[l],success:function(){i(l+1)}})}(0)}),t()}e.plugins.MIDI?o():e.loadPlugin("MIDI",o)},EdenUI.plugins.MIDIDotJS.title="MIDI.JS",EdenUI.plugins.MIDIDotJS.description="Uses the MIDI.js JavaScript library to add a software synthesizer for users who cannot access a MIDI instrument via WebMIDI and the basic MIDI plug-in.",EdenUI.plugins.MIDIFileInput=function(e,t){var n={};function i(){e.plugins.MIDI.addSoftwareDriver(function(t,i){e.plugins.MIDI.addSoftInput(n),t&&t.apply(this,i)})}n.name="MIDI Input from MIDI File",this.queue=function(e){var t=window.performance.now(),i=e.length;function o(e){var t=new Uint8Array(e.slice(1));return new MIDIMessageEvent("midimessage",{target:n,data:t})}!function a(s){if(s!=i){var r=e[s],l=t+r[0]-window.performance.now();if(l>0)window.setTimeout(function(){var e=o(r);n.onmidimessage(e),a(s+1)},l);else{var d=o(r);n.onmidimessage(d),a(s+1)}}}(0)},e.plugins.MIDI?i():e.loadPlugin("MIDI",i)},EdenUI.plugins.MIDIFileInput.title="MIDI File Input",EdenUI.plugins.MIDIFileInput.description="Use a MIDI file to simulate MIDI file input.",EdenUI.plugins.DependencyMap=function(e,t){var n=this;function i(e){var t=e.value(),n=typeof t,i=null;return i=void 0===t?{code:"",face:"FontAwesome"}:"number"==n?{code:Math.round(t),face:"arial"}:"string"==n?{code:"",face:"FontAwesome"}:"boolean"==n?{code:t?"":"",face:"FontAwesome"}:"function"==n?{code:"",face:"FontAwesome"}:Array.isArray(t)?{code:"",face:"FontAwesome"}:t instanceof CanvasImage?{code:"",face:"FontAwesome"}:t instanceof Text?{code:"",face:"FontAwesome"}:{code:"",face:"FontAwesome"},{id:e.name,label:e.name,shape:"icon",icon:i,face:"FontAwesome"}}this.createDialog=function(t,i){var o=void 0,a={nodes:new vis.DataSet([]),edges:new vis.DataSet([])},s=$('<div id="'+t+'" style="overflow: hidden"></div>'),r=$('<div class="dependency-map-content"></div>');s.append(r);o=new vis.Network(r.get(0),a,{});var l=$('<div class="dependency-map-controls"></div>');s.append(l);var d=$('<input type="text" placeholder="search"/>'),c=d.get(0),u=$('<input type="checkbox" checked="checked"/>'),p=u.get(0);function h(){var t;t=""==c.value?/^$/:e.regExpFromStr(d,"",p.checked),n.updateGraph(o,t)}l.append(d),l.append($("<label>Exact matches only </label>").append(u)),d.on("input",h),u.on("change",h),s.on("mouseenter",h),s.dialog({appendTo:"#jseden-views",title:i,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(e,t){e.re=t,e.newNodes=[],e.newEdges=[];var n,o={};for(var a in root.symbols){var s=root.symbols[a],r=s.name;if(t.test(r)){o[r]||(o[r]=!0,e.newNodes.push(i(s)));var l=s.dependencies;for(var d in l){o[p=l[d].name]||(o[p]=!0,e.newNodes.push(i(l[d]))),e.newEdges.push({from:p,to:r,arrows:"to"})}var c=s.subscribers;for(var d in c){var u=c[d];o[p=u.name]||(o[p]=!0,e.newNodes.push(i(c[d])));s.name,u.dynamicDependencies;e.newEdges.push({from:r,to:p,arrows:"to"})}for(var d in c=s.observers){var p;o[p=c[d].id]||(o[p]=!0,e.newNodes.push((n=c[d])instanceof EdenSymbol?i(n):{id:n.id,label:"when",shape:"icon",icon:{code:"",face:"FontAwesome"}})),e.newEdges.push({from:r,to:p,arrows:"to"})}}}var h={nodes:new vis.DataSet(e.newNodes),edges:new vis.DataSet(e.newEdges)};e.setData(h)},e.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:e.viewCategories.comprehension,menuPriority:2},t()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler";