function getCaretCharacterOffsetWithin(a){var b,c=0,d=a.ownerDocument||a.document,e=d.defaultView||d.parentWindow;if(void 0!==e.getSelection){if(b=e.getSelection(),b.rangeCount>0){var f=e.getSelection().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.endContainer,f.endOffset),c=g.toString().length}}else if((b=d.selection)&&"Control"!=b.type){var h=b.createRange(),i=d.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),c=i.text.length}return c}function getStartCaretCharacterOffsetWithin(a){var b,c=0,d=a.ownerDocument||a.document,e=d.defaultView||d.parentWindow;if(void 0!==e.getSelection){if(b=e.getSelection(),b.rangeCount>0){var f=e.getSelection().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.startContainer,f.startOffset),c=g.toString().length}}else if((b=d.selection)&&"Control"!=b.type){var h=b.createRange(),i=d.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),c=i.text.length}return c}function get_time_diff(a){var b=1e3*a,c=Date.now();if(b-=6e4*(new Date).getTimezoneOffset(),isNaN(b))return"";if(b<c)var d=c-b;else var d=b-c;var e=Math.floor(d/1e3/60/1440),f=new Date(d);if(e>5)return new Date(b).toDateString();var g="";if(e>0)g+=e,g+=e>1?" days ago":" day ago";else if(f.getUTCHours()>0){var h=f.getUTCHours();g+=h,g+=h>1?" hours ago":" hour ago"}else{var i=f.getUTCMinutes();if(i>0)g+=i,g+=i>1?" minutes ago":" minute ago";else{var j=f.getUTCSeconds();g+=j,g+=" seconds ago"}}return g}function changeClassString(a,b,c){var d=a.split(" "),e=d.indexOf(b);if(-1==e){if(c)return d.push(b),d.join(" ")}else if(!c)return d.splice(e,1),d.join(" ");return a}function changeClass(a,b,c){if(a){var d=changeClassString(a.className,b,c);d!=a.className&&(a.className=d)}}function makeCurlyBrace(a,b,c,d,e,f){var g=a-c,h=b-d,i=Math.sqrt(g*g+h*h);g/=i,h/=i;var j=a+f*e*h,k=b-f*e*g,l=a-.25*i*g+(1-f)*e*h,m=b-.25*i*h-(1-f)*e*g,n=a-.5*i*g+e*h,o=b-.5*i*h-e*g;return"M "+a+" "+b+" Q "+j+" "+k+" "+l+" "+m+" T "+n+" "+o+" M "+c+" "+d+" Q "+(c+f*e*h)+" "+(d-f*e*g)+" "+(a-.75*i*g+(1-f)*e*h)+" "+(b-.75*i*h-(1-f)*e*g)+" T "+n+" "+o}function EdenScriptGutter(a,b,c){function d(){console.log("GUTTER HOLD"),i=void 0;for(var a=0;a<g.lines.length;a++)g.lines[a].selected&&(changeClass(g.gutter.childNodes[a],"select",!1),changeClass(g.gutter.childNodes[a],"live",!0),g.lines[a].selected=!1,g.lines[a].live=!0)}function e(a,b){if(b&&k){var c=g.ast.getStatementByLine(a);if(c){var d=c.getRange();d[0]<d[1]&&g.showBrace(d[0],d[1]);for(var e=d[0];e<=d[1];e++)g.lines[e].selected=!m,changeClass(g.gutter.childNodes[e],"select",!m),changeClass(g.gutter.childNodes[e],"hover",!1)}}else{var c=g.ast.getStatementByLine(a);if(c){var d=c.getRange();g.lines[a].live||b||changeClass(g.gutter.childNodes[a],"play",!0),g.selectLine(a+1,!0),g.hovering=!0}}}function f(a,b){k&&!b&&(g.lines[a].selected=!m,changeClass(g.gutter.childNodes[a],"select",!m),changeClass(g.gutter.childNodes[a],"hover",!1),changeClass(g.gutter.childNodes[a],"play",!1)),k&&(b=!0),g.hovering=!1,clearTimeout(i),i=void 0;var c=g.ast.getStatementByLine(a);if(c){var d=c.getRange();g.hideBrace();for(var e=d[0];e<=d[1];e++)changeClass(g.gutter.childNodes[e],"hover",!1),changeClass(g.gutter.childNodes[e],"play",!1)}}var g=this;this.lineelements=c,this.$gutter=$('<div class="eden-gutter"></div>');var h="http://www.w3.org/2000/svg";this.brace=document.createElementNS(h,"svg"),this.brace.style.position="absolute",this.brace.style.display="none",this.brace.setAttribute("width","22"),this.brace.style.left="10px",this.bracepath=document.createElementNS(h,"path"),this.bracepath.setAttribute("style","stroke: #444; fill: none; stroke-width: 3px"),this.brace.appendChild(this.bracepath),this.gutter=this.$gutter.get(0),a.insertBefore(this.gutter,a.firstChild),a.insertBefore(this.brace,a.firstChild),this.ast=void 0,this.lines=[],this.errors=[],this.agents={},this.hovering=!1,this.ctx=void 0,this.edits=void 0;var i,j,k=!1,l=0,m=!1,n=!1;this.curline=-1,this.textwidth=getTextWidth("M","14px/20px Roboto Mono,monospace"),g.startHover=e,g.endHover=f,this.$gutter.on("mousedown",".eden-gutter-item",function(a){if(!this.edits&&!g.ast.hasErrors()){var b=parseInt(a.target.getAttribute("data-line"));j=a.shiftKey,l=b,m=!!g.lines[b]&&g.lines[b].selected,k=a.shiftKey,n=g.lines[b]&&g.lines[b].live;var c=g.ast.getStatementByLine(b);if(c){var e=c.getRange();if(g.lines[b].live&&!j)if(g.lines[b].selected)for(var f=0;f<g.lines.length;f++)g.lines[f].selected&&(g.lines[f].live=!1,changeClass(g.gutter.childNodes[f],"live",!1));else for(var f=e[0];f<=e[1];f++)g.lines[f].live=!1,changeClass(g.gutter.childNodes[f],"live",!1);else for(var f=e[0];f<=e[1];f++)g.lines[f].selected=!j||!g.lines[f].selected,changeClass(g.gutter.childNodes[f],"select",g.lines[f].selected),changeClass(g.gutter.childNodes[f],"hover",!1)}i=setTimeout(d,1e3)}}).on("click",".eden-gutter-item",function(a){if(!this.edits){var b=parseInt(a.target.getAttribute("data-line"));g.ast.getStatementByLine(b)}}).on("mouseup",".eden-gutter-item",function(a){if(!this.edits){if(!g.ast.hasErrors()&&!j){var b=parseInt(a.target.getAttribute("data-line")),c=g.ast.getStatementByLine(b);if(!(c&&c.hasErrors()||g.lines[b].live||n||(g.executeSelected(),m))){var c=g.ast.getStatementByLine(l);if(c)for(var d=c.getRange(),e=d[0];e<=d[1];e++)g.lines[e].selected=!1,changeClass(g.gutter.childNodes[e],"select",!1)}}clearTimeout(i),i=void 0,k=!1}}).on("mouseenter",".eden-gutter-item",function(a){if(!g.ast.hasErrors()){e(parseInt(a.target.getAttribute("data-line")),a.shiftKey)}}).on("mouseleave",".eden-gutter-item",function(a){f(parseInt(a.target.getAttribute("data-line")),a.shiftKey)})}function _formatVal(a){var b=Eden.prettyPrintValue("",a,200,!1,!1);switch(typeof a){case"boolean":return"<span class='special_text'>"+b+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+b+"</span>";case"number":return"<span class='numeric_text'>"+b+"</span>";default:return b}}function _formatFramerVal(a){var b=Eden.prettyPrintValue("",a,200,!1,!1);switch(typeof a){case"boolean":return"<span class='special_text'>"+b+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+b+"</span>";case"number":return"<span class='numeric_text'>"+b+"</span>";default:return b}}CSSUtil={},CSSUtil.setStyle=function(a,b){function c(a,b){return"-"+b.toLowerCase()}var d=a.style;if(void 0===b)d.cssText="";else if("object"==typeof b){var e=/^\w*[A-Z]\w*$/,f="";for(var g in b)if("string"==typeof b[g]){var h;h=e.test(g)?g.replace(/([A-Z])/g,c):g,f=f+h+": "+b[g]+";\n"}d.cssText=f}else d.cssText=b},CSSUtil.getStyle=function(a){for(var b=document.styleSheets,c=b.length-1;c>=0;c--)for(var d=b[c].cssRules,e=d.length-1;e>=0;e--)if(d[e].type==CSSRule.STYLE_RULE&&d[e].selectorText==a)return d[e].style;var f=document.getElementById("javascript-injected-styles");if(null===f){var g=document.getElementsByTagName("body")[0];f=document.createElement("style"),f.id="javascript-injected-styles",g.appendChild(f)}var h=f.sheet;return h.insertRule(a+"{ }",h.cssRules.length),h.cssRules[0].style},EdenUI.plugins.ScriptInput=function(a,b){EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var c=this;$(document.body).delegate(null,"drop",function(b){if(void 0!==b.originalEvent.dataTransfer){var c=b.originalEvent.dataTransfer.getData("selector");if(!c||""==c)return console.log(b.originalEvent.dataTransfer.files),void b.preventDefault();var d=(c.sp,c.replace(/[^a-zA-Z0-9]+/g,""));eden.root.lookup("view_"+d+"_tabs").assign([c],eden.root.scope,Symbol.hciAgent),a.createView(d,"ScriptInput"),eden.root.lookup("view_"+d+"_current").assign(0,eden.root.scope,Symbol.hciAgent)}}).delegate(null,"dragover",function(a){a.preventDefault()}),this.createCommon=function(a,b,c,d){function e(a,b){b?(M.style.display="flex",I.parentNode.style.top="35px"):(M.style.display="none",I.parentNode.style.top="0")}function f(a,b){b?(N.style.display="flex",O.codearea.style.top="30px"):(N.style.display="none",O.codearea.style.top="0")}function g(a,b){O.setReadonly(b)}function h(a,b){"number"==typeof b&&b>=0&&b<T.length?(R!=b&&(R=b,O.setFragment(T[R]),O.fragment.originast&&O.fragment.originast.doxyComment&&O.fragment.originast.doxyComment.getProperty("nobuttons")&&(ca.assign(!1,eden.root.scope,Symbol.localJSAgent),console.log("DISABLE BUTTONS"))),m()):(m(),-1==b&&(R=-1,O.setFragment(void 0),j(""))),k()}function i(a,b){if(Array.isArray(b)){var c=S;S=edenCopy(b);for(var d=T,e=d.filter(function(a){return-1==b.indexOf(a.selector)}),f=0;f<e.length;f++)e[f].destroy(),console.log("REMOVE FRAG",e[f].selector);T=[];for(var f=0;f<b.length;f++){var g=c.indexOf(b[f]);g>=0?T.push(d[g]):T.push(new Eden.Fragment(b[f]))}R=-2,h(aa,aa.value())}}function j(b){""==b&&(b="*");var c=eden.root.lookup("view_"+a+"_query").value();void 0===c&&(c=".type(script).name");var d=Eden.Selectors.query(c,"path,name,remote,executed,type");O.outdiv.innerHTML="";for(var e=0;e<d.length;e++){var f,g=d[e][1],h="";if(g==eden.project.name)h=" project",f="&#xf0f6;";else if("ACTIVE"==g)h=" root",f="&#xf0e7;";else if(d[e][2])f="&#xf08e;";else{switch(d[e][4]){case"script":f="&#xf0f6;";break;case"when":f="&#xf1ae;";break;default:f="&#xf128;"}h=d[e][3]?" executed":""}var i=$('<div class="browse-entry" data-path="'+d[e][0]+'"><div class="browse-icon'+h+'">'+f+"</div>"+g+"</div>");O.outdiv.appendChild(i.get(0))}}function k(){if(R>=0){var a='<button class="script-button script-run" title="Run the entire script"><span class="explorer-control-icon">&#xf04b;</span>Run</button>',b=T[R];b&&b.scratch&&!b.edited?a+='<span class="scratchsearch"><input type="text" class="scratchsearch" placeholder="Populate..."></input></span>':b&&b.scratch&&(a+='<span class="editname"><input type="text" class="editname" placeholder="Enter a name..."></input></span>'),L.html(a)}else L.html("")}function l(a,b,c,d,e){var f=document.createElement("div");f.style.left=160*e+"px";var g="agent-tab noselect";g+=d?" agent-tab-current handle":" agent-tab-notcurrent";var h=T[b].getTitle();h.length>18&&(h="..."+h.slice(-15));var i;i=T[b]&&T[b].ast?T[b].ast.errors&&T[b].ast.errors.length>0?"tab-icon errored":T[b].originast&&T[b].originast.executed?"tab-icon executed":"tab-icon":"tab-icon noagent";var j="&#xf1ae;";T[b].remote?j="&#xf08e;":void 0===T[b].origin?j="&#xf0c3;":T[b].locked&&(j="&#xf023;"),f.className=g,f.innerHTML="<span class='"+i+"'>"+j+"</span>"+h+"<span class='close'>&#xf00d;</span>",f.draggable=!0,f.setAttribute("data-index",b),a.appendChild(f)}function m(){for(;M.firstChild;)M.removeChild(M.firstChild);var a=aa.value(),b=document.createElement("div");if(b.className="agent-tab-more",b.innerHTML="<span class='tab-icon2'>&#xf0c9;</span>",M.appendChild(b),T.length>3&&0!=a){var c=document.createElement("div");c.className="agent-tableft noselect",M.appendChild(c)}var d=document.createElement("div");d.className="agent-tab-container",M.appendChild(d),a>ea+(fa-1)&&(ea=a-(fa-1)),a<ea&&(ea=a);for(var e=0;e<T.length;e++){var f=T[e].getTitle();ea<=e&&l(d,e,f,e==a,e)}var g=document.createElement("div");if(g.className="agent-newtab noselect",g.style.left=160*T.length+20+"px",d.appendChild(g),T.length>3&&a!=T.length-1){var h=document.createElement("div");h.className="agent-tabright noselect",M.appendChild(h)}var i=document.createElement("div");i.className="script-input-windowcontrols",i.innerHTML="<span class='windowcontrol'>&#xf00d;</span>",M.appendChild(i)}function n(b){return"view_"+a+"_"+b}function o(){R>=0&&T[R]&&(T[R].originast?(console.log("ONRUN",T[R].originast),T[R].ast.executeStatement(T[R].originast,0,T[R])):T[R].ast.execute(T[R]),m())}function p(){aa.assign(-1,eden.root.scope,Symbol.localJSAgent)}function q(a){var b=a.currentTarget.getAttribute("data-index");aa.assign(parseInt(b),eden.root.scope,Symbol.hciAgent),O.intextarea.focus()}function r(a){var b=parseInt(a.currentTarget.parentNode.getAttribute("data-index"));if(b>=0&&b<T.length){var c=_.value();c.splice(b,1),_.assign(c,eden.root.scope,Symbol.localJSAgent);var d=aa.value();d>=c.length&&aa.assign(d-1,eden.root.scope,Symbol.localJSAgent)}a.stopPropagation()}function s(){var a=R;--a>=0&&aa.assign(a,eden.root.scope,Symbol.hciAgent)}function t(){var a=R;++a<T.length&&aa.assign(a,eden.root.scope,Symbol.hciAgent)}function u(){var a=_.value();a.push("scratch"+ga),ga++,_.assign(a,eden.root.scope,Symbol.localJSAgent),aa.assign(a.length-1,eden.root.scope,Symbol.localJSAgent)}function v(a){var b=parseInt(a.target.getAttribute("data-index")),c=T[b].selector;a.originalEvent.dataTransfer.setData("selector",c),ia=a.originalEvent.offsetX,ja=a.originalEvent.offsetY}function w(a){a.preventDefault()}function x(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer.getData("selector");if(console.log("DROP"),console.log(a),b&&""!=b){var c=_.value();-1==c.indexOf(b)&&(c.push(b),_.assign(c,eden.root.scope,Symbol.hciAgent))}else if(window.FileReader)for(var d=a.originalEvent.dataTransfer.files,e=0;e<d.length;e++){var f=d[e];if(f.name.match(/.*\.jse|.*\.js-e/)){var g=f.name.slice(0,-4);g=g.replace(/[\.\-\/\s]/g,""),g="local/file/"+g;var h=new FileReader;h.onload=function(a){new Eden.Agent(void 0,g).setSource(a.target.result,!1,-1),agent.state[obs_agent]=g},h.readAsText(f)}}}function y(a){var b=parseInt(a.target.getAttribute("data-index")),c=T[b].selector;if("none"!=a.originalEvent.dataTransfer.dropEffect){console.log("DRAGEND: "+c),console.log(a);var d=_.value(),e=d.indexOf(c);e>=0&&(d.splice(e,1),e--,e<0&&(e=0),d.length,_.assign(d,eden.root.scope,Symbol.hciAgent)),d.length}}function z(a){var b=a.target.value;console.log("SCRATCH SEARCH",b),Eden.Selectors.query(b,"innersource",{minimum:1},function(a){O.intextarea.value=a.join("\n"),T[R].setSourceInitial(O.intextarea.value),O.highlighter.ast=O.fragment.ast,O.updateCachedHighlight()})}function A(a){T[R].name=a.target.value,m()}function B(a){console.log("FINISH NAME",a.target.value),T[R].makeReal(a.target.value);var b=_.value();b[R]=T[R].selector,_.assign(b,eden.root.scope,Symbol.localJSAgent)}function C(a){var b=a.currentTarget.getAttribute("data-path"),c=_.value(),d=c.indexOf(b);-1==d?(c.push(b),_.assign(c,eden.root.scope,Symbol.localJSAgent),aa.assign(c.length-1,eden.root.scope,Symbol.localJSAgent)):aa.assign(d,eden.root.scope,Symbol.localJSAgent)}function D(a){O.gutter.edits?(O.gutter.setDiffs(void 0),O.cachedhlopt=void 0,O.updateCachedHighlight()):O.makeDiff()}function E(a){O.details.toggle()}function F(a){var b=a.currentTarget.getAttribute("data-jseden");b&&""!=b&&(console.log(b),eden.execute2(b,{name:"execute"}))}function G(a){var b=a.currentTarget.getAttribute("name");b&&""!=b&&eden.root.lookup(b).assign(a.currentTarget.value,eden.root.scope,Symbol.hciAgent)}console.log("CREATING",a);var H=$('<div class="inputdialogcontent"><div class="agent-tabs handle"></div><div class="scriptsubcontent">\t<div class="inputhider">\t\t<div class="control-bar noselect">\t\t</div>\t</div></div><div class="info-bar"></div></div></div>'),I=H.find(".inputhider").get(0),J=H.find(".info-bar").get(0),K=H.find(".agent-tabs"),L=H.find(".control-bar"),M=K.get(0),N=L.get(0);$(J).hide();var O=new EdenUI.ScriptArea;I.appendChild(O.contents);var P=0,Q=void 0;I.addEventListener("scroll",function(a){void 0!==Q&&clearTimeout(Q),document.activeElement!==O.outdiv&&(Q=setTimeout(function(){Q=void 0;var a=I.scrollTop;a=Math.floor((a-50)/20),a<0&&(a=0),Math.abs(a-P)>=50&&(console.log("FORCE RE HIGHLIGHT",a),O.highlighter.setScrollTop(a),P=a,O.updateCachedHighlight(),O.gutter.clear())},100))});var R=-1,S=[],T=[],U="view_"+a+"_current",V="view_"+a+"_showtabs",W="view_"+a+"_showbuttons",X="view_"+a+"_tabs",Y="view_"+a+"_zoom",Z="view_"+a+"_readonly",_=eden.root.lookup(X),aa=(eden.root.lookup(Y),eden.root.lookup(U)),ba=eden.root.lookup(V),ca=eden.root.lookup(W),da=eden.root.lookup(Z),ea=0,fa=3,ga=1;void 0===ba.value()&&void 0===ba.definition&&ba.assign(!0,eden.root.scope,Symbol.defaultAgent),ba.addJSObserver("scriptview_"+a,e),e(ba,ba.value()),void 0===ca.value()&&void 0===ca.definition&&ca.assign(!0,eden.root.scope,Symbol.defaultAgent),ca.addJSObserver("scriptview_"+a,f),f(ca,ca.value()),da.addJSObserver("scriptview_"+a,g),g(da,da.value()),aa.addJSObserver("scriptview_"+a,h),_.addJSObserver("scriptview_"+a,i),i(_,_.value()),void 0===_.value()&&void 0===_.definition&&_.assign([],eden.root.scope,Symbol.defaultAgent),void 0===aa.value()&&void 0===aa.definition&&aa.assign(-1,eden.root.scope,Symbol.defaultAgent),Eden.Fragment.listenTo("changed",O,function(a){a===T[R]&&(m(),k(),O.refresh())}),Eden.Fragment.listenTo("locked",O,function(a){a===T[R]&&(console.log("LOCKED",a),h(aa,aa.value()))}),Eden.Fragment.listenTo("unlocked",O,function(a){a===T[R]&&h(aa,aa.value())}),Eden.Fragment.listenTo("errored",O,function(a){}),Eden.Fragment.listenTo("status",O,function(a){a===T[R]&&(m(),k())}),Eden.Fragment.listenTo("gotoline",O,function(a,b){for(var c=0;c<T.length;c++)if(a===T[c]){console.log("I have the goto frag"),R!=c&&aa.assign(c,eden.root.scope,Symbol.localJSAgent),O.gotoLine(b);var d=50+20*(b-5);d<0&&(d=0),I.scrollTop=d;break}}),void 0===eden.root.lookup("view_"+a+"_query").definition&&eden.execute("view_"+a+"_query is jseden_script_query;");var ha=[n("tabs"),n("current"),n("showtabs"),n("showbuttons"),n("zoom")];H.get(0).setAttribute("data-observables",ha.join(","));var ia,ja;L.on("keyup","input.editname",A).on("change","input.editname",B).on("click",".script-run",o).on("click",".script-changes",D).on("click",".script-details",E).on("keyup","input.scratchsearch",z),H.on("click","button,.executable,a",F).on("input","textarea,input",G).on("click",".close",r).on("click",".agent-tab-more",p).on("click",".browse-entry",C).on("click",".agent-tab",q).on("click",".agent-tableft",s).on("click",".agent-tabright",t).on("click",".agent-newtab",u).on("dragstart",".agent-tab",v).on("dragend",".agent-tab",y).on("dragover",w).on("drop",x);var ka={contents:H,update:function(b){if(void 0===aa.value()){var c="view/script/"+a;Eden.Agent.importAgent(c,"default",["noexec","create"],function(a){agent.state[obs_agent]=c,b instanceof Symbol?(agent.setScope(b.getValueScope(eden.root.scope)),intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(agent.code),updateEntireHighlight()):b instanceof Array?(intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(b),updateEntireHighlight()):"string"==typeof b&&(intextarea.value=b,updateEntireHighlight())})}},destroy:function(){console.log("CLOSE SCRIPT"),clearInterval(O.gutterinterval);for(var b=0;b<T.length;b++)T[b].unlock(),T[b].ast&&T[b].ast.destroy();scriptast=void 0,T=void 0,Eden.Fragment.unListen(O),O=void 0,aa.removeJSObserver("scriptview_"+a),_.removeJSObserver("scriptview_"+a)},resize:function(a,b){b&&b.size&&(fa=Math.floor((b.size.width-90)/160))},setValue:function(a){intextarea.value=a,updateEntireHighlight()}};return O.updateEntireHighlight(),ka},this.createDialog=function(b,d,e){function f(a,b){return root.lookup("view_"+a+"_"+b)}var g=b.slice(0,-7),h=c.createCommon(g,d,e,!1,!1),i=405;if(e){var j=h.contents.find("textarea").val().split("\n").length;i=EdenUI.plugins.ScriptInput.getRequiredHeight(j+1)}return h.contents.on("click",".windowcontrol",function(){a.hideView(g,!0)}),$dialog=$('<div id="'+b+'"></div>').html(h.contents).dialog({appendTo:"#jseden-views",title:d,width:600,height:i,minHeight:203,minWidth:300,classes:{"ui-dialog":"input-dialog ui-front no-print"},resizeStop:h.resize,draggable:!1}),$dialog.parent().draggable({handle:".handle",cancel:".agent-tab-notcurrent",stop:function(a,b){var c=eden.root;c.beginAutocalcOff(),f(g,"x").assign(b.position.left,eden.root.scope,Symbol.hciAgent),f(g,"y").assign(b.position.top,eden.root.scope,Symbol.hciAgent),c.endAutocalcOff()},start:function(a,b){if(f(g,"x").eden_definition||f(g,"y").definition)return!1}}),h.confirmClose=!1,h},this.createEmbedded=function(a,b,d){return c.createCommon(a,b,d,!0)},a.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:a.viewCategories.interpretation,menuPriority:0},a.history=this.history,b()},EdenUI.plugins.ScriptInput.getRequiredHeight=function(a,b){return b?55+20*a+20:45+20*a+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(a,b){var c=$('<div class="script-obscurer noselect"></div>'),d=$('<div class="script-subdialog script-subdialog-newagent noselect"><span class="script-subdialog-title">Create Tab:</span><div class="script-subdialog-panel"><button>Scratch</button></div><div class="script-subdialog-panel"><input class="namebox" type="text" spellcheck="false" placeholder="New Tab"></input><button class="button-new">New</button></div><div class="script-subdialog-panel"><input type="text" class="searchbox" spellcheck="false" placeholder="Search"></input><button class="button-search">Load</button><br/></div></div>'),e=d.find(".searchbox").get(0),f=d.find(".namebox").get(0);d.on("click",".button-cancel",function(){a.get(0).removeChild(c.get(0)),b(!1)}),d.on("click",".button-search",function(){a.get(0).removeChild(c.get(0)),b(!0,e.value)}),d.on("click",".button-new",function(){eden.project.addAction(f.value),a.get(0).removeChild(c.get(0)),b(!0,"."+f.value)}),c.append(d),a.append(c)},EdenUI.plugins.ScriptInput.dialogs.localChanges=function(a,b,c){EdenUI.plugins.ScriptInput.dialogs.hide&&EdenUI.plugins.ScriptInput.dialogs.hide();var d=$('<div class="script-obscurer noselect"></div>'),e=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-text">You have local changes to '+c.name+', use these?</span><br><br><button class="button-icon-green button-ok">Yes</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">No</button></div>');e.on("click",".button-ok",function(){a.get(0).removeChild(d.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,b(!0)}).on("click",".button-cancel",function(){a.get(0).removeChild(d.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,b(!1)}),d.append(e),a.append(d),EdenUI.plugins.ScriptInput.dialogs.hide=function(){EdenUI.plugins.ScriptInput.dialogs.hide=void 0,a.get(0).removeChild(d.get(0)),b(!1)}},EdenUI.plugins.ScriptInput.dialogs.uploadFailed=function(a,b){var c=$('<div class="script-obscurer noselect"></div>'),d=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload Failed! Try again...</span><br><br><button class="button-icon-green button-upload">Retry</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>');d.on("click",".button-upload",function(){a.get(0).removeChild(c.get(0)),b(!0)}).on("click",".button-cancel",function(){a.get(0).removeChild(c.get(0)),b(!1)}),c.append(d),a.append(c)},EdenUI.plugins.ScriptInput.dialogs.uploadAgent=function(a,b){var c=$('<div class="script-obscurer noselect"></div>'),d=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload agent. Give an optional version name:</span><br/><input class="script-subdialog-text tagname" type="text" spellcheck="false"></input><span class="status missing"></span><br><input class="script-subdialog-check makepublic" type="checkbox">Public</input><br><br><button class="button-icon-green button-upload">Upload</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>'),e=d.find(".tagname"),f=d.find(".makepublic"),g=e.get(0).nextSibling,h=!0;d.on("input blur",".script-subdialog-text",function(){var a=e.get(0).value;console.log(a),""==a?(h=!0,g.className="addnew"):/^[a-z][a-z0-9]+$/i.test(a)?(g.className="addnew",h=!0):(g.className="invalid",h=!1)}).on("click",".button-upload",function(){h&&(a.get(0).removeChild(c.get(0)),b(!0,e.get(0).value,f.get(0).checked))}).on("click",".button-cancel",function(){a.get(0).removeChild(c.get(0)),b(!1)}),c.append(d),a.append(c)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(a,b,c){function d(){for(var a=j.get(0);a.firstChild;)a.removeChild(a.firstChild);g=void 0}function e(a){if(c.history[a])for(var b=c.history[a].length-1;b>=0;b--){var d=$('<div class="script-history-item"></div>');k==b&&(d.addClass("current"),d.addClass("original"),g=d),d.get(0).setAttribute("data-index",""+b);var e=$('<div class="script-history-bookmark"></div>'),f=$('<div class="script-history-time"></div>'),h=$('<div class="script-history-content"></div>');f.html(get_time_diff(c.history[a][b].time)),f.get(0).title=c.history[a][b].time,c.history[a][b].bookmark&&e.addClass("bookmarked"),c.history[a][b].title?h.html(c.history[a][b].title):h.html("[Autosave]"),d.append(e),d.append(h),d.append(f),j.append(d)}}function f(a){if(Eden.DB.getVersions(c.name,function(b){if(null!=b)for(var c=0;c<b.length;c++){var d=$('<div class="script-history-item"></div>');b[c].saveID==l&&(d.addClass("original"),-1==k&&(d.addClass("current"),g=d)),d.get(0).setAttribute("data-version",""+b[c].saveID);var f="script-history-stored";0==b[c].public?f+=" private":b[c].mine?f+=" mine":f+=" public";var h=$('<div class="'+f+'"></div>'),i=b[c].date.split(/[- :]/),m=$('<div class="script-history-time">'+get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)+"</div>"),n=b[c].tag;null==b[c].tag&&(n=b[c].saveID);var o=$('<div class="script-history-content">'+n+" ("+b[c].saveID+") by "+b[c].name+"</div>");d.append(h),d.append(o),d.append(m),j.append(d),b[c].saveID==l&&e(a)}}),c.history.origin){var b=$('<div class="script-history-item"></div>');"origin"==l&&(b.addClass("original"),-1==k&&(b.addClass("current"),g=b)),b.get(0).setAttribute("data-version","origin");var d=$('<div class="script-history-bookmark"></div>'),f="origin";c.meta&&c.meta.file&&(f=c.meta.file);var h=$('<div class="script-history-content">'+f+"</div>");b.append(d),b.append(h),j.append(b),"origin"==l&&e("origin")}}var g,h=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),j=i.find(".script-history-list"),k=c.index,l=c.meta.saveID;f(c.meta.saveID),i.on("input",".script-history-content",function(a){var b=parseInt(a.target.parentNode.getAttribute("data-index"));c.history[c.meta.saveID][b].title=a.target.textContent,c.saveHistory(),c.makeSnapshot(b)}).on("click",".script-history-item",function(a){var b=a.currentTarget.getAttribute("data-version");if(b)"origin"!=b&&(b=parseInt(b)),l=b,d(),k=-1,f(l);else{var c=parseInt(a.currentTarget.getAttribute("data-index"));k=c,g&&g.removeClass("current"),g=$(a.currentTarget),g.addClass("current")}}).on("click",".script-history-bookmark",function(a){var b=parseInt(a.target.parentNode.getAttribute("data-index"));void 0===c.history[c.meta.saveID][b].bookmark?c.history[c.meta.saveID][b].bookmark=!0:c.history[c.meta.saveID][b].bookmark=!c.history[c.meta.saveID][b].bookmark,c.saveHistory(),c.history[c.meta.saveID][b].bookmark?a.target.className="script-history-bookmark bookmarked":a.target.className="script-history-bookmark"}).on("click",".button-ok",function(){a.get(0).removeChild(h.get(0)),console.log("Rollback to: "+k+"@"+l),b(!0,k,l)}).on("click",".button-cancel",function(){a.get(0).removeChild(h.get(0)),b(!1)}),h.append(i),a.append(h)},EdenUI.plugins.ScriptInput.dialogs.browseAgents=function(a,b,c){function d(a,b,d){Eden.DB.getDirectory(d,function(e){if(void 0!==e){var f=[];for(var g in e)f.push(g);f.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())});for(var h=0;h<f.length;h++){var j=""==d?f[h]:d+"/"+f[h],k=f[h],l=$('<div class="script-agents-item"></div>'),m=$('<div class="script-agents-expand" style="width: '+(27+15*b)+'px"></div>'),n=$('<div class="script-agents-content"></div>'),o=$('<div class="script-agents-cbcont"></div>');(function(a,b,d,e,f){Eden.DB.getMeta(b,function(b,f){if(f){var g="";if(f.date){var h=f.date.split(/[- :]/);g=get_time_diff(new Date(h[0],h[1]-1,h[2],h[3],h[4],h[5]).getTime()/1e3)}var i=f.title;if("Script View"!=i&&void 0!==i||(i=""),a.html(d+' <span class="script-agents-title">'+i+'</span><span class="script-agents-date">'+g+"</span>"),f.remote&&-1==f.defaultID&&-1==f.latestID)e.html("&nbsp;");else{var j=$('<input type="checkbox"></input>');e.append(j),c.indexOf(b)>=0&&(j.get(0).checked=!0)}}else a.html(d),e.html("&nbsp;")})}).call(this,n,j,k,o,m),Eden.Agent.agents[j]&&l.addClass("loaded"),l.get(0).setAttribute("data-path",j),l.get(0).setAttribute("data-depth",""+(b+1)),l.append(m),l.append(o),l.append(n),void 0===a||void 0===a.nextSibling?i.append(l):i.get(0).insertBefore(l.get(0),a.nextSibling)}}})}function e(a){for(var b=parseInt(a.getAttribute("data-depth")),c=a.nextSibling;c;){if(!(parseInt(c.getAttribute("data-depth"))>b))break;var d=c.nextSibling;i.get(0).removeChild(c),c=d}}function f(){a.append(g),i.scrollTop(j)}var g=$('<div class="script-obscurer noselect"></div>'),h=$('<div class="script-subdialog-agents noselect"><span class="script-subdialog-title">'+Language.ui.input_window.browse_agents+':</span><br/><div class="script-agents-list"></div><div class="script-agents-buttons"><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),i=h.find(".script-agents-list"),j=0,k={};return d(void 0,0,""),h.on("click",".script-agents-item",function(a){}).on("click",".script-agents-expand",function(a){var b=a.currentTarget.parentNode.getAttribute("data-path"),c=parseInt(a.currentTarget.parentNode.getAttribute("data-depth"));a.currentTarget.className.indexOf("expanded")<0?(d(a.currentTarget.parentNode,c,b),changeClass(a.currentTarget,"expanded",!0)):(e(a.currentTarget.parentNode),changeClass(a.currentTarget,"expanded",!1))}).on("change",".script-agents-cbcont input",function(a){var b=a.currentTarget.parentNode.parentNode.getAttribute("data-path");a.currentTarget.checked?k[b]=!0:k[b]=!1}).on("click",".button-add",function(){j=i.scrollTop(),a.get(0).removeChild(g.get(0)),b(!0,k)}).on("click",".button-cancel",function(){j=i.scrollTop(),a.get(0).removeChild(g.get(0)),b(!1)}),g.append(h),{show:f}},EdenScriptGutter.prototype.clear=function(){for(this.ast=void 0,this.lines=[],this.curline=-1,this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild)},EdenScriptGutter.prototype.setBaseAST=function(a,b){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);this.ast=a,this.errors=b,this.lines=[],this.edits=void 0,this.hideBrace()},EdenScriptGutter.prototype.executeSelected=function(){if(void 0!==this.ast)for(var a=0;a<this.lines.length;a++)if(this.lines[a].selected){var b=this.ast.getStatementByLine(a),c=this.ast.getStatementByLine(a).getRange();eden.project.ast.executeStatement(b,a,eden.project),a=c[1],eden.root.lookup("jseden_fragment_executed").assign(".id("+b.id+")",eden.root.scope,Symbol.hciAgent)}},EdenScriptGutter.prototype.showBrace=function(a,b){this.brace.style.display="block";var c=this.lineelements.childNodes[a].offsetTop;this.brace.style.top=c+"px";var d=this.lineelements.childNodes[b].offsetTop+this.lineelements.childNodes[b].clientHeight;d-=c,this.brace.setAttribute("height",""+d),this.bracepath.setAttribute("d",makeCurlyBrace(20,4,20,d-4,20,.52))},EdenScriptGutter.prototype.hideBrace=function(){this.brace.style.display="none"},EdenScriptGutter.prototype.selectLine=function(a,b){if(!(this.edits||this.ast.errors.length>0)){if(this.curline>=0){var c=this.ast.getStatementByLine(this.curline);if(c){var d=c.getRange(),e=Math.floor((d[1]-d[0])/2)+d[0]
;b||(changeClass(this.gutter.childNodes[e],"play",!1),changeClass(this.gutter.childNodes[e],"current",!1))}}this.curline=a-1;var c=this.ast.getStatementByLine(a-1);if(c){c.getRange||console.error("NO GETRANGE",c);var d=c.getRange();if(d[0]<d[1])this.showBrace(d[0],d[1]);else if(this.hideBrace(),c){var e=Math.floor((d[1]-d[0])/2)+d[0];changeClass(this.gutter.childNodes[e],"play","true"),b||changeClass(this.gutter.childNodes[e],"current","true")}}}},EdenScriptGutter.prototype.setDiffs=function(a){this.edits=a;for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);if(void 0!==a){this.hideBrace();for(var b=0,c=0,d=this.ast.lines.length+Object.keys(a.remove).length,e=!1,f=0;f<d;f++){if(a.remove[c]&&a.remove[c].nline<=b){var g=document.createElement("div"),h="eden-gutter-item removed";g.className=h,g.textContent=a.remove[c].rline,this.gutter.appendChild(g);for(var i=a.remove[c].chars,j=0;j<i.length;j++){var k=document.createElement("div");k.style.position="absolute",k.style.background="rgba(255,0,0,0.3)",k.style.height="20px",k.style.width=i[j].length*this.textwidth+"px",k.style.top="0px",k.style.left=i[j].start*this.textwidth+43+"px",g.appendChild(k)}if(!a.remove[c].partial){c++;continue}c++,e=!0}var g=document.createElement("div"),h="eden-gutter-item";if(e||a.insert[b]){h+=" inserted";var l=!1;if(a.insert[b])for(var i=a.insert[b].chars,j=0;j<i.length;j++){var k=document.createElement("div");k.style.position="absolute",k.style.background="rgba(0,255,0,0.3)",k.style.height="20px",k.style.width=i[j].length*this.textwidth+"px",l=l||0==i[j].length&&!a.insert[b].partial,k.style.top="0px",k.style.left=i[j].start*this.textwidth+43+"px",g.appendChild(k)}a.insert[b]&&a.insert[b].partial&&!e&&c++}else c++;e=!1,g.className=h,g.setAttribute("data-line",""+b),this.gutter.appendChild(g),b++,void 0===this.lines[b]&&(this.lines[b]={selected:!1,live:!1})}}},EdenScriptGutter.prototype.updateLine=function(a,b){var c="eden-gutter-item",d=this.ast,e="",f=b,g=void 0,h=d.getStatementByLine(a);h?(h.errors.length>0?(h.errors[0].line==a+1?(c+=" error",e="&#xf06a",g=h.errors[0].messageText(),a):"runtime"==h.errors[0].type&&(c+=" error",e="&#xf06a",g=h.errors[0].messageText()),this.lines[a].errored=!0,f=!0):(d.errors.length>0&&d.errors[0].line==a+1&&(this.lines[a].errored=!0,c+=" error",e="&#xf06a",g=d.errors[0].messageText()),this.lines[a].errored&&(f=!0,this.lines[a].errored=!1),h.warning&&(c+=" warning",e="&#xf071",f=!0,h.warning&&(g=h.warning.messageText())),1==h.executed?(c+=" executed",f=!0,this.lines[a].executed=!0):2==h.executed?(c+=" guarded",f=!0,this.lines[a].executed=!0):3==h.executed&&(c+=" errorblock",f=!0)),this.lines&&this.lines[a]&&(this.lines[a].executed&&h.executed<=0&&(f=!0,this.lines[a].executed=!1),this.lines[a].selected&&(c+=" select"),this.lines[a].live&&(c+=" live"))):(this.errors&&this.errors.length>0&&this.errors[0].line==a+1?this.lines[a].errored||(c+=" error",e="&#xf06a",g=this.errors[0].messageText(),a,this.lines[a].errored=!0,f=!0):this.lines[a].errored&&(f=!0,this.lines[a].errored=!1,g=""),this.lines[a].executed&&(f=!0,this.lines[a].executed=!0));f&&(this.gutter.childNodes[a].className.indexOf("hover")>=0&&(c+=" hover"),this.gutter.childNodes[a].className.indexOf("play")>=0&&(c+=" play"),this.gutter.childNodes[a].className.indexOf("current")>=0&&(c+=" current"),this.gutter.childNodes[a].innerHTML=e,this.gutter.childNodes[a].className=c,g&&(this.gutter.childNodes[a].title=g))},EdenScriptGutter.prototype.generate=function(a,b){if(this.ast=a,!this.edits){var c=!1,d=a.getNumberOfLines()+1;if(d>this.lineelements.childNodes.length&&(d=this.lineelements.childNodes.length),d!=this.gutter.childNodes.length){for(this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(var e=0;e<d;e++){var f=document.createElement("div");f.className="eden-gutter-item",f.setAttribute("data-line",""+e),f.style.height=this.lineelements.childNodes[e].clientHeight+"px",this.gutter.appendChild(f),void 0===this.lines[e]&&(this.lines[e]={selected:!1,live:!1,executed:!1,errored:!1})}c=!0}for(var e=0;e<d;e++)this.updateLine(e,c);this.ast.errors.length>0?this.hideBrace():this.hovering||this.selectLine(b)}},EdenUI.ScriptArea=function(){this.contents=document.createElement("div"),this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contenteditable=!0,this.outdiv.className="outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.fragment=void 0,this.readonly=!1,this.alwaysreadonly=!1,this.currentlineno=-1,this.currentcharno=-1,this.gotomode=!1,this.highlighter=new EdenUI.Highlight(this.outdiv),this.gutter=new EdenScriptGutter(this.codearea,this.infobox,this.outdiv),this.details=new EdenUI.ScriptArea.Details(this),this.cachedhlopt=void 0,this.disablehl=!1,this.highlighter.setScrollTop(0);var a=this;this.gutterinterval=setInterval(function(){if(void 0!==a.fragment&&void 0!==a.fragment.ast){a.gutter.generate(a.fragment.ast.script,a.currentlineno);for(var b in a.highlighter.metrics)if(a.currentlineno!=b){var c=a.highlighter.metrics[b];if(c.query)for(var d=0;d<c.qelements.length;d++){var e=c.qelements[d].getAttribute("data-query"),f=c.qelements[d].getAttribute("data-attribs"),g=Eden.Selectors.query(e,null!==f&&f.length>0?f:"value");g=1==g.length?g[0]:g.length>1?g.join(", "):"",c.qelements[d].setAttribute("data-result",g)}c.squery&&a.highlightContent(b,a.intextarea.selectionEnd)}}},300);new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.rebuildinterval=400},EdenUI.ScriptArea.prototype.setReadonly=function(a){this.alwaysreadonly=a,!0===a?(this.readonly=!0,this.outdiv.contentEditable=!1):(this.readonly=!!this.fragment&&this.fragment.locked,this.outdiv.contentEditable=!this.readonly,"comment"==a&&this.updateEntireHighlight())},EdenUI.ScriptArea.prototype.setFragment=function(a){if(this.fragment&&this.fragment!==a&&(this.fragment.unlock(),this.currentlineno=-1),this.details.hide(),this.fragment=a,void 0===a)return this.gutter.clear(),changeClass(this.outdiv,"browser",!0),this.outdiv.contentEditable=!1,void(this.readonly=!0);var b=this;a.reset(function(){changeClass(b.outdiv,"browser",!1),b.intextarea.value=a.getSource(),a.ast&&(b.highlightContent(-1,0),b.intextarea.focus(),b.checkScroll(),b.gutter.setBaseAST(a.ast.script)),a.locked?(b.readonly=!0,b.outdiv.contentEditable=!1):(b.readonly=!0===b.alwaysreadonly,b.outdiv.contentEditable=!b.readonly)})},EdenUI.ScriptArea.prototype.refresh=function(){this.intextarea.value=this.fragment.getSource(),this.fragment.ast&&this.highlightContent(-1,0)},EdenUI.ScriptArea.prototype.updateSource=function(a,b){this.fragment.setSource(a),this.gutter.errors=this.fragment.ast.errors,this.highlighter.ast=this.fragment.ast},EdenUI.ScriptArea.prototype.updateLineHighlight=function(){var a=-1,b=-1;document.activeElement===this.intextarea&&(b=this.intextarea.selectionEnd,a=this.getLineNumber(this.intextarea)),this.updateSource(this.intextarea.value,a),this.runScript(a),this.highlightContent(a,b)},EdenUI.ScriptArea.prototype.runScript=function(a){if(this.gutter.lines[a-1]&&this.gutter.lines[a-1].live&&!this.fragment.ast.hasErrors()){var b=this.fragment.ast.script.getStatementByLine(a-1);this.fragment.ast.executeStatement(b,a,this.fragment)}},EdenUI.ScriptArea.prototype.hideInfoBox=function(){},EdenUI.ScriptArea.prototype.updateLineCachedHighlight=function(){if(this.fragment){var a=-1,b=-1;document.activeElement===this.intextarea&&(b=this.intextarea.selectionEnd,a=this.getLineNumber(this.intextarea)),this.highlightContent(a,b)}},EdenUI.ScriptArea.prototype.updateEntireHighlight=function(a,b){if(void 0!==this.fragment){this.cachedhlopt=b,this.updateSource(this.intextarea.value,-1);var c=-1;document.activeElement===this.intextarea&&(c=this.intextarea.selectionEnd),a&&runScript(0),this.highlightContent(-1,c,b)}},EdenUI.ScriptArea.prototype.updateCachedHighlight=function(a){var b=-1;document.activeElement===this.intextarea&&(b=this.intextarea.selectionEnd),this.highlightContent(-1,b,a||this.cachedhlopt)},EdenUI.ScriptArea.prototype.findElementLineNumber=function(a){for(var b=a;b.parentNode!==this.outdiv;)b=b.parentNode;return parseInt(b.getAttribute("data-line"))},EdenUI.ScriptArea.prototype.replaceLine=function(a,b){var c=this.intextarea.value.split("\n");c[a]=b,this.intextarea.value=c.join("\n")},EdenUI.ScriptArea.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.ScriptArea.prototype.focusText=function(){if(!this.readonly){var a=getCaretCharacterOffsetWithin(this.outdiv),b=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=a,this.intextarea.selectionStart=b,b!=a&&(this.refreshentire=!0)}},EdenUI.ScriptArea.prototype.toggleHighlighting=function(){this.disablehl=!this.disablehl,this.updateEntireHighlight(),this.gutter.clear()},EdenUI.ScriptArea.prototype.highlightContent=function(a,b,c){if(this.fragment){var d=this.fragment.ast;if(d){if(void 0===c&&this.disablehl&&(c={}),this.disablehl&&(c.disabled=!0),this.highlighter.highlight(d,a,b,c),document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret"),"comment"==this.alwaysreadonly)for(var e=$(this.outdiv).find(".eden-comment-line"),f=0;f<e.length;f++)e[f].contentEditable=!1;this.delayRebuild()}}},EdenUI.ScriptArea.prototype.moveCaret=function(){this.updateLineCachedHighlight(),this.checkScroll()},EdenUI.ScriptArea.prototype.selectAll=function(){this.outdiv.focus();var a=document.createRange();a.selectNodeContents(this.outdiv);var b=window.getSelection();b.removeAllRanges(),b.addRange(a)},EdenUI.ScriptArea.prototype.makeNumbersDrag=function(){var a=this;this.readonly||$(this.outdiv).find(".eden-number").draggable({helper:function(a){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(b,c){if(!a.readonly){var d;if(a.dragint?d=Math.round(a.dragvalue+(c.position.left-a.dragstart)/2):(d=a.dragvalue+.005*(c.position.left-a.dragstart),d=d.toFixed(4)),d!=a.draglast){a.draglast=d,b.target.innerHTML=""+d;var e=b.target.parentNode.textContent;"\n"==e.charAt(e.length-1)&&(e=e.slice(0,-1)),a.replaceLine(a.dragline,e),a.updateSource(a.intextarea.value,a.dragline),a.runScript(a.dragline+1),a.highlightContent(a.dragline,-1)}}},start:function(b,c){if(!a.readonly){a.edited=!0,a.dragline=a.findElementLineNumber(b.target),a.dragstart=c.position.left;var d=b.target.textContent;-1==d.indexOf(".")?(a.dragvalue=parseInt(d),a.dragint=!0):(a.dragvalue=parseFloat(d),a.dragint=!1),a.draglast=a.dragvalue,$(b.target).addClass("eden-select"),$(a.outdiv).css("cursor","ew-resize")}},stop:function(b,c){a.readonly||($(b.target).removeClass("eden-select"),$(a.outdiv).css("cursor","text"),a.dragline=-1)},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptArea.prototype.getLineNumber=function(){var a=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=a.length,this.currentcharno=a[a.length-1].length,this.currentlineno},EdenUI.ScriptArea.prototype.gotoLine=function(a){var b=this.intextarea.value.split("\n");b.length=a+1;var c=b.join("\n").length;this.intextarea.focus(),this.intextarea.selectionEnd=c,this.intextarea.selectionStart=c,this.updateLineCachedHighlight()},EdenUI.ScriptArea.prototype.checkScroll=function(){var a=$(this.outdiv.childNodes[this.currentlineno-1]).find(".fake-caret").get(0);if(void 0!==a){for(var b=this.contents.parentNode,c=a.offsetLeft-b.scrollLeft+25,d=b.clientWidth+b.scrollLeft-a.offsetLeft-25;a.parentNode!=this.outdiv;)a=a.parentNode;var e=a.offsetTop-b.scrollTop+15,f=b.clientHeight+b.scrollTop-a.offsetTop-15;c<80&&(b.scrollLeft=b.scrollLeft-(80-c)),d<80&&(b.scrollLeft=b.scrollLeft+(80-d)),e<40&&(b.scrollTop=b.scrollTop-(40-e)),f<40&&(b.scrollTop=b.scrollTop+(40-f))}},EdenUI.ScriptArea.prototype.setCaretToFakeCaret=function(){var a=$(this.outdiv).find(".fake-caret").get(0);if(a){var b=document.createRange(),c=window.getSelection();a.nextSibling&&(a=a.nextSibling),b.setStart(a,0),b.collapse(!0),c.removeAllRanges(),c.addRange(b),$(this.outdiv).remove(".fake-caret")}},EdenUI.ScriptArea.prototype.makeDiff=function(){var a={},b=this.fragment.diff();for(var c in b.remove)if(!b.remove[c].consecutive){var d=parseInt(c),e=0,f=20;do{f+=20,e++}while(b.remove[d+e]&&b.remove[d+e].consecutive);a[b.remove[c].nline+0]=f}this.gutter.setDiffs(b),this.cachedhlopt={spacing:a},this.updateCachedHighlight()},EdenUI.ScriptArea.prototype.doRebuild=function(){this.makeNumbersDrag()},EdenUI.ScriptArea.prototype.delayRebuild=function(){var a=this;clearTimeout(this.rebuildtimer),this.rebuildtimer=setTimeout(function(){a.doRebuild()},this.rebuildinterval)},EdenUI.ScriptArea.prototype.rebuild=function(){this.gutter.edits?(this.updateSource(this.intextarea.value,-1),this.gutter.ast=this.fragment.ast,this.makeDiff()):(this.edited=!0,this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight(),this.checkScroll(),this.dirty=!1)},EdenUI.ScriptArea.prototype.enableGotoMode=function(){this.gotomode||(this.outdiv.contentEditable=!1,changeClass(this.outdiv,"goto",!0),this.gotomode=!0)},EdenUI.ScriptArea.prototype.disableGotoMode=function(){this.gotomode&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv,"goto",!1),this.gotomode=!1)},EdenUI.ScriptArea.prototype.insertTab=function(){var a=this.intextarea.selectionStart,b=this.intextarea.selectionEnd;this.intextarea.value=this.intextarea.value.substring(0,a)+"\t"+this.intextarea.value.substring(b),this.intextarea.selectionStart=this.intextarea.selectionEnd=a+1,this.rebuild()},EdenUI.ScriptArea.Details=function(a){this.scriptarea=a,this.contents=document.createElement("div"),this.contents.className="script-details",this.contents.addEventListener("keyup",function(a){var b=a.target.parentNode.getAttribute("data-name"),c=a.target.value;console.log("CHANGE PROP",b,c)}),this.visible=!1},EdenUI.ScriptArea.Details.prototype.addProperty=function(a,b,c,d){var e=document.createElement("div");e.className="script-details-prop",e.setAttribute("data-name",a);var f=document.createElement("div");f.className="script-details-label",f.textContent=b,e.appendChild(f);var g=document.createElement("input");g.className="script-details-value",g.value=c||"",g.setAttribute("type","text"),d&&d.readonly&&(g.className+=" script-details-readonly",g.setAttribute("readonly","true")),e.appendChild(g);var h=document.createElement("div");return h.className="script-details-status",d&&d.readonly?h.innerHTML="&#xf023;":h.innerHTML="&#xf00c;",e.appendChild(h),this.contents.appendChild(e),e},EdenUI.ScriptArea.Details.prototype.clear=function(){for(;this.contents.lastChild;)this.contents.removeChild(this.contents.lastChild)},EdenUI.ScriptArea.Details.prototype.addButtons=function(){var a=document.createElement("div");a.className="script-details-buttons";var b=document.createElement("button");b.className="script-button",b.innerHTML='<span class="explorer-control-icon">&#xf00d;</span>Close',a.appendChild(b),this.contents.appendChild(a)},EdenUI.ScriptArea.Details.prototype.show=function(){this.clear(),this.addProperty("name","Name",this.scriptarea.fragment.name),this.addProperty("selector","Path",this.scriptarea.fragment.selector,{readonly:!0}),this.scriptarea.fragment.originast&&this.addProperty("id","Full Name",Eden.Selectors.getID(this.scriptarea.fragment.originast),{readonly:!0});var a=this.scriptarea.fragment.doxy;if(a){this.addProperty("desc","Description",a.stripped()),this.addProperty("tags","Tags",a.getHashTags().join(" "));var b=a.getControls();for(var c in b)this.addProperty(c,c.substring(1),b[c])}this.addButtons(),this.scriptarea.codearea.appendChild(this.contents),changeClass(this.scriptarea.outdiv,"blur",!0),this.visible=!0},EdenUI.ScriptArea.Details.prototype.hide=function(){this.visible&&(this.scriptarea.codearea.removeChild(this.contents),this.visible=!1,changeClass(this.scriptarea.outdiv,"blur",!1))},EdenUI.ScriptArea.Details.prototype.toggle=function(){this.visible?this.hide():this.show()},EdenUI.ScriptArea.Keyboard=function(a){function b(a){var b=a.key;return a.shiftKey&&(b="Shift-"+b),a.altKey&&(b="Alt-"+b),(a.ctrlKey||a.metaKey)&&(b="Ctrl-"+b),b}function c(c){switch(b(c)){case"Tab":c.preventDefault(),a.insertTab();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":a.moveCaret();break;case"Ctrl-a":a.selectAll(),c.preventDefault();break;case"Ctrl-h":a.toggleHighlighting(),c.preventDefault();break;case"Ctrl-Shift-ArrowLeft":case"Ctrl-Shift-ArrowRight":case"Ctrl-Shift-ArrowUp":case"Ctrl-Shift-ArrowDown":case"Ctrl-Shift-Home":case"Ctrl-Shift-End":case"Shift-ArrowLeft":case"Shift-ArrowRight":case"Shift-ArrowUp":case"Shift-ArrowDown":case"Shift-Home":case"Shift-End":a.focusOutput();break;case"Backspace":a.refreshentire=10==a.intextarea.value.charCodeAt(a.intextarea.selectionStart-1);break;case"Enter":a.refreshentire=!0;break;case"Ctrl-Control":a.enableGotoMode()}}function d(b){a.refreshentire=!0}function e(c){var d=b(c);switch(c.ctrlKey||a.disableGotoMode(),d){case"Ctrl-Control":a.disableGotoMode();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":a.updateLineCachedHighlight(),a.gutter&&a.gutter.selectLine(a.currentlineno),a.checkScroll()}}function f(b){"INPUT"!=b.target.nodeName&&"textarea"!=b.target.nodeName&&(!b.shiftKey||37!=b.keyCode&&38!=b.keyCode&&39!=b.keyCode&&40!=b.keyCode&&35!=b.keyCode&&36!=b.keyCode)&&"Control"!=b.key&&"Shift"!=b.key&&"c"!=b.key&&a.focusText()}function g(b){a.intextarea.focus(),setTimeout(function(){a.updateEntireHighlight()},0)}function h(b){"INPUT"!=b.target.nodeName&&"textarea"!=b.target.nodeName&&(17!=b.keyCode&&91!=b.keyCode&&92!=b.keyCode||a.disableGotoMode())}function i(b){$(a.outdiv).find(".fake-caret").remove()}function j(b){a.dirty=!0,a.rebuild()}function k(a){}a.intextarea.addEventListener("input",j),a.intextarea.addEventListener("keydown",c),a.intextarea.addEventListener("keyup",e),a.intextarea.addEventListener("paste",d),a.outdiv.addEventListener("keydown",f),a.outdiv.addEventListener("keyup",h),a.outdiv.addEventListener("paste",g),a.intextarea.addEventListener("blur",i),a.intextarea.addEventListener("focus",k)},EdenUI.ScriptArea.Mouse=function(a){function b(b){a.readonly}function c(b){if("INPUT"!=b.target.nodeName&&"textarea"!=b.target.nodeName&&(a.hideInfoBox(),!a.readonly&&0!=b.target.isContentEditable))if(a.gotomode){var c=b.target;if(""==c.className&&"SPAN"==c.parentNode.nodeName&&(c=c.parentNode),"eden-selector"==c.className||"eden-selector2"==c.className){a.disableGotoMode();var d=c.parentNode.textContent;Eden.Selectors.goto(d)}else if("eden-observable"==c.className){var e=c.getAttribute("data-observable");Eden.Selectors.goto(e+":active")}b.preventDefault()}else if(document.activeElement===a.outdiv){var f=getCaretCharacterOffsetWithin(a.outdiv),g=getStartCaretCharacterOffsetWithin(a.outdiv);if(g!=f)a.refreshentire=!0;else{a.intextarea.focus(),a.intextarea.selectionEnd=f,a.intextarea.selectionStart=f;a.currentlineno;a.updateLineCachedHighlight()}}}a.outdiv.addEventListener("mouseup",c),a.outdiv.addEventListener("mousedown",b)},EdenUI.plugins.PluginManager=function(a,b){this.createDialog=function(b,c){var d,e,f,g=$('<div class="projectlist-results noselect"></div>'),h=function(b){return a.plugins[b]?"(loaded)":"(not loaded)"};pluginNames=Object.keys(EdenUI.plugins).sort(function(b,c){var d=a.plugins[b],e=a.plugins[c];return d&&!e?1:e&&!d?-1:b<c?-1:b==c?0:1});for(var i=0;i<pluginNames.length;i++){e=pluginNames[i],d=EdenUI.plugins[e];var j=e in a.plugins?" pluginmanager-loaded":"",k='<div class="projectlist-result-element'+j+'"><div class="projectlist-result-name">'+d.title+"</div><div class='projectlist-result-metadata'>"+d.description+"</div>";void 0!==d.originalAuthor&&(k=k+"<div class='projectlist-result-metadata'>Original version by "+d.originalAuthor+"</div>"),void 0!==d.author&&(f=void 0===d.originalAuthor?"By ":"Built on by ",k=k+"<div class='projectlist-result-metadata'>"+f+d.author+"</div>"),k=k+'<div class="pluginlist-loaded projectlist-result-metadata">'+h(e)+"</div></div>",$(k).click(function(b){return function(){var c=$(this);a.loadPlugin(b,function(){a.plugins[b]&&(c.find(".pluginlist-loaded").html(h(b)),c.addClass("pluginmanager-loaded",100)),a.menu.updateViewsMenu()})}}(e)).appendTo(g)}var l=$('<div class="projectlist-listing"></div>');l.append(g),$dialog=$('<div id="'+b+'"></div>').html(l).dialog({title:c,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},a.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:a.viewCategories.environment,name:"plugins"},b()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.Canvas2D=function(a,b){var c=this;this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx,this.defaultLineWidth=2;canvases={},contents={};var d,e,f,g={},h=!1,i=!1;Object.defineProperty(this,"mouseIdleTimeout",{set:function(a){clearInterval(e),e=setInterval(function(){if(h)i=!1,h=!1;else if(!i){var a=root.lookup("mouseFollow").value();root.lookup("mouseVelocity").assign(new Point(0,0),root.scope,Symbol.hciAgent,a),i=!0,f=void 0}},a/2),d=a},get:function(){return d},enumerable:!0}),this.mouseVelocitySampleTime=100,this.mouseVelocityDampening=.3,this.mouseIdleTimeout=300;var j=function(a,b){var c;for(c in b)if("false"!=b[c][0].getAttribute("data-garbage"))for(var d=b[c],e=0;e<d.length;e++)null!==d[e].parentElement&&a.removeChild(d[e])};this.thumbnail=function(a){var b=canvases.picture;if(void 0===b)for(var c in canvases){b=canvases[c];break}if(void 0===b)return void(a&&a());var d,e,f,g,h=b.clientWidth,i=b.clientHeight,j=h/i;j<200/112?(d=112,e=h*(d/i),f=(200-e)/2,g=0):j>200/112?(e=200,d=i*(e/h),f=0,g=(112-d)/2):(d=112,e=200,f=0,g=0);var k=document.createElement("canvas");k.setAttribute("width","200"),k.setAttribute("height","112"),k.getContext("2d").drawImage(b,f,g,e,d);var l;try{l=k.toDataURL("image/png")}catch(a){}a&&a(l)},this.drawPicture=function(a){var b=canvases[a];if(void 0!==b&&!b.drawingQueued&&(b.drawingQueued=!0,!b.drawingInProgress)){var d=function(){b.drawingInProgress=!0,b.drawingQueued=!1;var e=g[a],f={},h="view_"+a+"_content",i=root.lookup(h),k=i.value(),l=b.getContext("2d"),m=contents[a],n=0;if(void 0!==m){var o=root.lookup("view_"+a+"_background_colour").value();void 0===o&&(o="white"),l.setTransform(1,0,0,1,0,0),c.setFillStyle(l,o),m.style.backgroundColor=o,l.fillRect(0,0,b.width,b.height);var p;for(p in e)e[p][0].setAttribute("data-garbage",!0);if(Array.isArray(k)){var q=root.lookup("view_"+a+"_scale").value();"number"!=typeof q&&(q=1);var r=root.lookup("view_"+a+"_zoom").value();"number"!=typeof r&&(r=1);var s,t,u=q*r;q<0?(l.scale(-u,u),u=-u,t=-q,s=!0):(1!=u&&l.scale(u,u),t=q,s=!1);var v=root.lookup("view_"+a+"_offset").value();if(v instanceof Point)if(s){var w=b.height/u-v.y;l.translate(v.x,-w),v=new Point(v.x,w)}else l.translate(v.x,v.y);else v=new Point(0,0);c.configureContextDefaults(l,t);for(var x=[k],y=[0],z=[],A="";x.length>0;){var B=x.pop(),C=y.pop();for(C>0&&B[C-1]instanceof EdenUI.plugins.Canvas2D.Transform&&(l.restore(),z.pop(),A=z.join(" "));C<B.length;){var D=B[C];if(D instanceof Object)if(Array.isArray(D))x.push(B),y.push(C+1),B=D,C=0;else if(D instanceof EdenUI.plugins.Canvas2D.Transform){x.push(B),y.push(C+1),l.save(),D.transform(l);var E=D.getCSS(u);A=A+E+" ",z.push(E),B=D.items,Array.isArray(B)||(B=[B]),C=0}else{var F=D.hash&&D.hash(),G=F&&e[F];if(G)D.elements=G;else{l.save();try{var H=c.configureContext(l,t,r,D.drawingOptions);H&&D.draw(l,q,a)}catch(a){void 0!==D&&console.log(a)}l.restore()}if(void 0!==D.elements){var I=D.elements[0].parentElement;if(I&&I!=m){for(var J=[],K=0;K<D.elements.length;K++)J.push($(D.elements[K]).clone(!0,!0).get(0));D.elements=J,D.scale(u,r,v)}else G&&!b.rescale||D.scale(u,r,v)}var L=D.elements;L&&(L[0].setAttribute("data-garbage",!1),G||(m.length<=n?m.appendChild(L[0]):m.insertBefore(L[0],m.childNodes[n])),f[F]=L,n++),C++}else C++}}if(1==root.lookup("view_"+a+"_grid_visible").value()){var M,N,O=root.lookup("view_"+a+"_grid_spacing").value(),P=-v.x,Q=b.width/u-v.x;s?(M=v.y-b.height/u,N=v.y):(M=-v.y,N=b.height/u-v.y),l.save(),l.lineWidth=1/u,l.strokeStyle="thistle",c.drawGridLines(v,u,O,P,M,Q,N,l),l.strokeStyle="magenta",c.drawGridLines(v,u,3*O,P,M,Q,N,l),l.beginPath(),l.strokeStyle="blue",l.fillStyle="blue",l.arc(0,0,9/u,0,2*Math.PI,!1),l.fill(),l.beginPath(),l.moveTo(3*O,0),l.lineTo(2*O,.4*O),l.lineTo(2*O,-.4*O),l.moveTo(0,3*O),l.lineTo(.4*O,2*O),l.lineTo(-.4*O,2*O),l.fill(),l.beginPath(),l.lineWidth=4/u,l.moveTo(2*O,0),l.lineTo(0,0),l.lineTo(0,3*O),l.stroke(),l.restore()}}else{var R=h,S=i.eden_definition;if(S){var T=new RegExp("^"+h+"\\s+is\\s+([a-zA-Z0-9_]+)(;)?$"),U=S.match(T);null!==U&&(R=U[1])}l.save(),l.font="18px sans-serif",l.fillStyle="black",l.textAlign="center",m.textBaseline="middle",l.fillText("Give the observable named '"+R+"' a list-typed value",b.width/2,b.height/2),l.fillText("to create a picture here.",b.width/2,b.height/2+30),l.restore()}j(m,e),g[a]=f,b.drawingInProgress=!1,b.drawingQueued&&setTimeout(d,40)}};setTimeout(d,40)}},this.drawGridLines=function(a,b,c,d,e,f,g,h){h.beginPath();for(var i=0==a.x?c:0;i<=f;i+=c){var j=(Math.round(i*b)-.5)/b;h.moveTo(j,e),h.lineTo(j,g),h.stroke()}for(var i=-c;i>=d;i-=c){var j=(Math.round(i*b)-.5)/b;h.moveTo(j,e),h.lineTo(j,g),h.stroke()}for(var k=0==a.y?c:0;k<=g;k+=c){var l=(Math.round(k*b)-.5)/b;h.moveTo(d,l),h.lineTo(f,l),h.stroke()}for(var k=-c;k>=e;k-=c){var l=(Math.round(k*b)-.5)/b;h.moveTo(d,l),h.lineTo(f,l),h.stroke()}},this.configureContextDefaults=function(a,b){a.lineJoin="bevel",a.miterLimit=429496656,a.lineWidth=this.defaultLineWidth/b},this.configureContext=function(a,b,c,d){if("object"!=typeof d)return!0;if(!1===d.visible)return!1;if(Array.isArray(d.dashes)&&(a.setLineDash(d.dashes),"dashOffset"in d&&(a.lineDashOffset=d.dashOffset)),"cap"in d&&(a.lineCap=d.cap),"join"in d&&(a.lineJoin=d.join),"miterLimit"in d&&(a.miterLimit=d.miterLimit),"lineWidth"in d&&(a.lineWidth=d.lineWidth/b),"opacity"in d&&(a.globalAlpha=d.opacity),"object"==typeof d.shadow)if(a.shadowColor=d.shadow.colour,d.shadow.scale){var e=c*b;a.shadowBlur=d.shadow.blur*e,a.shadowOffsetX=d.shadow.xOffset*e,a.shadowOffsetY=d.shadow.yOffset*e}else a.shadowBlur=d.shadow.blur*c,a.shadowOffsetX=d.shadow.xOffset*c,a.shadowOffsetY=d.shadow.yOffset*c;return!0},this.setFillStyle=function(a,b){if(b instanceof CanvasImage){var c=a.createPattern(b.image,"repeat");a.fillStyle=c}else b instanceof EdenUI.plugins.Canvas2D.FillStyle?a.fillStyle=b.getColour(a):a.fillStyle=b},this.initZoneFromDrawingOpts=function(b,c){var d;if(b instanceof Object&&!1!==b.zone){if(void 0===(d=b.name)&&!0===b.zone)return root.currentObservableName();if(a.eden.isValidIdentifier(d)){var e=root.lookup(d+"_click");void 0===e.value()&&e.assign(!1,root.scope,root.lookup(c))}return d}},this.initZoneFromName=function(b,c){if(a.eden.isValidIdentifier(b)){var d=root.lookup(b+"_click");void 0===d.value()&&d.assign(!1,root.scope,root.lookup(c))}return b},this.findDrawableHit=function(a,b,c,d,e){var f=root.lookup("view_"+a+"_content").value(),g=canvases[a];if(g){var h=g.getContext("2d"),i=root.lookup("view_"+a+"_scale").value();return this.findDrawableHitInList(f,h,i,b,c,d,e)}},this.findDrawableHitInList=function(a,b,c,d,e,f,g){if(Array.isArray(a)){var h,i;f?(h=0,i=1):(h=a.length-1,i=-1);for(var j=h;f?j<a.length:j>=0;j+=i){var k=a[j];if("object"==typeof k)if(Array.isArray(k)){var l=this.findDrawableHitInList(k,b,c,d,e,f,g);if(l)return l}else{var m=k.isHit;if(void 0!==m){if(!g&&void 0===k.name)continue;b.save();var n=k.isHit(b,c,d,e);if(b.restore(),!0===n)return k}else if(k.inverse){var o=k.inverse(d,e),l=this.findDrawableHitInList(k.items,b,c,o.x,o.y,f,g);if(void 0!==l)return l}}}}},this.findAllDrawablesHit=function(a,b,c,d){var e=root.lookup("view_"+a+"_content").value(),f=canvases[a],g=f.getContext("2d"),h=root.lookup("view_"+a+"_scale").value();return this.findAllDrawablesHitInList(e,g,h,b,c,d)},this.findAllDrawablesHitInList=function(a,b,c,d,e,f){if(!Array.isArray(a))return[];for(var g=[],h=0;h<a.length;h++){var i=a[h];if("object"==typeof i){if(void 0!==i.isHit){if(!f&&void 0===i.name)continue;b.save();var j=i.isHit(b,c,d,e);b.restore(),!0===j&&g.push(i)}else if(i.inverse){var k=i.inverse(d,e),l=this.findAllDrawablesHitInList(i.items,b,c,k.x,k.y,f);l.length>0&&(g=g.concat(l))}}}return g};var k={leftButton:!1,middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1};this.createCommon=function(b,d){function e(){c.drawPicture(q)}function i(a){return"view_"+b+"_"+a}function j(){var b,d,e=u.value(),f=v.value(),g=e*f,h=w.value();h instanceof Point?(b=h.x,d=h.y):(b=0,d=0);var i=x.value();void 0!==i?(i=Math.ceil((x.value()+b)*g),r.width=i):r.width=f>1?Math.ceil(z.value()*f):Math.floor(z.value());var j;void 0!==y.value()?j=Math.ceil((y.value()+d)*g):f>1?j=Math.ceil(A.value()*f):(j=A.value(),void 0!==i&&i>Math.floor(z.value())&&(j-=a.scrollBarSize),j=Math.floor(j-1)),r.height=j,r.rescale=!0,c.drawPicture(q)}function l(){B?(B=!1,r.rescale=!0,c.drawPicture(q),E||(E=!0,setTimeout(l,1e3))):(j(),E=!1)}function m(a){var b=root.lookup("mouseFollow").value();root.beginAutocalcOff(),k.insideCanvas=!0;var d;switch(a.button){case 0:k.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,Symbol.hciAgent,b),d="Left";break;case 1:k.middleButton=!0,d="Middle";break;case 2:k.rightButton=!0,d="Right";break;case 3:k.button4=!0,d="Button4";break;case 4:k.button5=!0,d="Button5";break;default:d="Unknown"}k.buttonCount=k.leftButton+k.middleButton+k.rightButton+k.button4+k.button5;var e="|";if(k.leftButton&&(e+="Left|"),k.middleButton&&(e+="Middle|"),k.rightButton&&(e+="Right|"),k.button4&&(e+="Button4|"),k.button5&&(e+="Button5|"),root.lookup("mouseButtons").assign(e,root.scope,Symbol.hciAgent,b),root.lookup("mouseButton").assign(d+" down",root.scope,Symbol.hciAgent,b),1==k.buttonCount){var f=root.lookup("mousePosition").value();root.lookup("mouseDownView").assign(q,root.scope,Symbol.hciAgent,b),root.lookup("mouseDown").assign(f,root.scope,Symbol.hciAgent,b);var g=root.lookup("view_"+q+"_scale").value(),h=root.lookup("view_"+q+"_zoom").value(),i=g*h,j=$(this).offset(),l=(a.pageX-Math.round(j.left))/i,m=(a.pageY-Math.round(j.top))/i,n=root.lookup("view_"+q+"_offset").value();n instanceof Point&&(l-=n.x,m-=n.y);var o,p=c.findDrawableHit(q,l,m,!1,!1);o=void 0===p?void 0:p.name;var r=root.lookup("mouseZone");o!==r.value()&&r.assign(o,root.scope,Symbol.hciAgent,b),root.lookup("mouseDownZone").assign(o,root.scope,Symbol.hciAgent,b)}root.endAutocalcOff()}var n,o,p={name:"*Default"},q=b,r=canvases[b];void 0===r?(n=$('<div id="'+b+'-canvascontent" class="canvashtml-content"></div>'),n.html('<canvas class="canvashtml-canvas noselect" id="'+b+'-canvas" tabindex="1"></canvas>'),o=n.find(".canvashtml-canvas"),r=o[0],canvases[b]=r,contents[b]=n[0],g[b]={},r.drawingQueued=!1,r.drawingInProgress=!1,r.rescale=!1):(n=$("#"+b+"-canvascontent"),o=n.find(".canvashtml-canvas"));var s=[i("content"),i("background_colour"),i("scale"),i("zoom"),i("offset"),i("canvas_right"),i("canvas_bottom"),"mousePosition","mouseButton","mouseButtons","mouseCapture","mouseCaptured","mouseDown","mouseDownView","mouseFollow","mousePressed","mouseUp","mouseWheel","mouseWheelEnabled","mouseWheelVelocity","mouseView","mouseZone","mouseVelocity"]
;r.setAttribute("data-observables",s.join(",")),root.lookup("view_"+q+"_content").addJSObserver("repaintView",e);var t=root.lookup("view_"+q+"_background_colour");void 0===t.value()&&t.assign("white",root.scope,p),t.addJSObserver("refreshView",e);var u=root.lookup("view_"+q+"_scale"),v=root.lookup("view_"+q+"_zoom"),w=root.lookup("view_"+q+"_offset"),x=root.lookup("view_"+q+"_canvas_right"),y=root.lookup("view_"+q+"_canvas_bottom"),z=root.lookup("view_"+q+"_width"),A=root.lookup("view_"+q+"_height"),B=!1,C=u.value();void 0===C&&(u.assign(1,root.scope,p),C=1),u.addJSObserver("refreshView",j);var D=v.value();void 0===D&&(v.assign(1,root.scope,p),D=1);var E=!1;v.addJSObserver("refreshView",function(a,b){Math.round(100*b);B=!0,l()});var F,G,H=w.value();H instanceof Point?(F=H.x,G=H.y):(w.assign(new Point(0,0),root.scope,p),F=0,G=0),w.addJSObserver("refreshView",j),void 0==x.value()&&x.assign(void 0,root.scope,p),x.addJSObserver("repaintView",j),void 0==y.value()&&y.assign(void 0,root.scope,p),y.addJSObserver("repaintView",j);var I=x.value();I=void 0===I?600:I*C+F;var J=y.value();J=void 0===J?500:J*C+G;var K=root.lookup("view_"+q+"_grid_visible");void 0===K.value()&&K.assign(!1,root.scope,p),K.addJSObserver("refreshView",e);var L=root.lookup("view_"+q+"_grid_spacing");return void 0===L.value()&&L.assign(20,root.scope,p),L.addJSObserver("refreshView",e),o.on("mousedown",m),o.on("mouseup",function(b){var c=root.lookup("mouseFollow").value();root.beginAutocalcOff(),k.insideCanvas=!0;var d;switch(navigator.platform.toUpperCase().indexOf("MAC")>=0&&b.ctrlKey&&(b.button=2),b.button){case 0:k.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,Symbol.hciAgent,c),d="Left";break;case 1:k.middleButton=!1,d="Middle";break;case 2:k.rightButton=!1,d="Right";break;case 3:k.button4=!1,d="Button4";break;case 4:k.button5=!1,d="Button5";break;default:d="Unknown"}if(k.buttonCount=k.leftButton+k.middleButton+k.rightButton+k.button4+k.button5,root.lookup("mouseButton").assign(d+" up",root.scope,Symbol.hciAgent,c),0==k.buttonCount){var e=root.lookup("mousePosition").value();root.lookup("mouseButtons").assign("",root.scope,Symbol.hciAgent,c),root.lookup("mouseUp").assign(e,root.scope,Symbol.hciAgent,c),a.plugins.Canvas2D.endClick()}else{var f="|";k.leftButton&&(f+="Left|"),k.middleButton&&(f+="Middle|"),k.rightButton&&(f+="Right|"),k.button4&&(f+="Button4|"),k.button5&&(f+="Button5|"),root.lookup("mouseButtons").assign(f,root.scope,Symbol.hciAgent,c)}root.endAutocalcOff()}).on("contextmenu",function(a){navigator.platform.toUpperCase().indexOf("MAC")>=0&&a.ctrlKey&&(a.button=2,m(a)),root.lookup("mouseContextMenuEnabled").value()||(a.preventDefault(),a.stopPropagation())}).on("click",function(a){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(a){var b=root.lookup("mouseFollow").value(),c=root.lookup("mouseDoubleClicks"),d=c.value();c.assign(d+1,root.scope,Symbol.hciAgent,b)}).on("wheel",function(a){var b,d=a.originalEvent,e=A.value();b=d.deltaMode==WheelEvent.DOM_DELTA_LINE?c.defaultLineHeight:d.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=d.deltaX?z.value():e:1;var f=root.lookup("mouseFollow").value();if(0!=d.deltaY&&a.ctrlKey&&!a.altKey&&!a.metaKey&&!a.shiftKey){a.preventDefault(),a.stopPropagation(),root.beginAutocalcOff();var g=-d.deltaY*b;if(root.lookup("touchPinchEnabled").value()){var h=root.lookup("touchPinch"),i=h.value();i+=g,h.assign(i,root.scope,Symbol.hciAgent,f)}else{var j=v.value();j=j*(e+2*g)/e,j<.05&&(j=.05),v.assign(j,root.scope,Symbol.hciAgent,f)}return void root.endAutocalcOff()}if(root.lookup("mouseWheelEnabled").value()){if(root.beginAutocalcOff(),0!==d.deltaY&&(!a.ctrlKey||a.altKey||a.metaKey||a.shiftKey)){a.preventDefault(),a.stopPropagation();var k=root.lookup("mouseWheel"),l=k.value(),g=d.deltaY*b;l+=g,k.assign(l,root.scope,Symbol.hciAgent,f),root.lookup("mouseWheelVelocity").assign(g,root.scope,Symbol.hciAgent,f)}if(0!==d.deltaX){a.preventDefault(),a.stopPropagation();var m=root.lookup("touchPanX"),n=m.value(),o=d.deltaX*b;n+=o,m.assign(n,root.scope,Symbol.hciAgent,f),root.lookup("touchPanXSpeed").assign(o,root.scope,Symbol.hciAgent,f)}root.endAutocalcOff()}}).on("mouseout",function(a){k.insideCanvas=!1;var b=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,Symbol.hciAgent,b)}).on("mouseenter",function(a){if(!k.insideCanvas){k.insideCanvas=!0;var b;0==k.buttonCount?b="":(b="|",k.leftButton&&(b+="Left|"),k.middleButton&&(b+="Middle|"),k.rightButton&&(b+="Right|"),k.button4&&(b+="Button4|"),k.button5&&(b+="Button5|"));var c=root.lookup("mouseButtons"),d=c.value();if(b!=d){var e=root.lookup("mouseFollow").value();root.beginAutocalcOff(),c.assign(b,root.scope,Symbol.hciAgent,e),root.lookup("mouseButton").assign("Enter window",root.scope,Symbol.hciAgent,e);var f=root.lookup("mousePressed");f.value()!=k.leftButton&&f.assign(k.leftButton,root.scope,Symbol.hciAgent,e),""==d&&""!=b&&(root.lookup("mouseDown").assign(void 0,root.scope,Symbol.hciAgent,e),root.lookup("mouseDownView").assign(void 0,root.scope,Symbol.hciAgent,e)),root.endAutocalcOff()}}}).on("mousemove",function(a){h=!0;var b=root.lookup("mouseFollow").value();root.beginAutocalcOff();var d,e,g,i,j=root.lookup("mouseView"),l=root.lookup("mousePosition"),m=j.value(),n=l.value();n&&(g=n.x,i=n.y);var o=root.lookup("view_"+q+"_scale").value(),p=root.lookup("view_"+q+"_zoom").value(),r=o*p;if(k.capturing){var s=a.originalEvent;d=g+s.movementX/r,e=i+s.movementY/r}else{var t=$(this).offset();d=(a.pageX-Math.round(t.left))/r,e=(a.pageY-Math.round(t.top))/r;var u=root.lookup("view_"+q+"_offset").value();u instanceof Point&&(d-=u.x,e-=u.y)}j.assign(q,root.scope,Symbol.hciAgent,b);var v=new Point(d,e);l.assign(v,root.scope,Symbol.hciAgent,b);var w,x=Date.now();if(m==q&&void 0!==f){if((w=x-f)>=c.mouseVelocitySampleTime){var y=root.lookup("mouseVelocity"),z=y.value(),A=1e3*(d-g)/w,B=1e3*(e-i)/w;if(z){var C=c.mouseVelocityDampening,D=z.x;(A>0&&D>0||A<0&&D<0)&&(A=C*D+(1-C)*A);var E=z.y;(B>0&&E>0||B<0&&E<0)&&(B=C*E+(1-C)*B)}A=Math.ceil(A*r)/r,B=Math.ceil(B*r)/r;var F=new Point(A,B);y.assign(F,root.scope,Symbol.hciAgent,b),f=x}}else f=x;var G,H=c.findDrawableHit(q,d,e,!1,!1);G=void 0===H?void 0:H.name;var I=root.lookup("mouseZone");G!==I.value()&&I.assign(G,root.scope,Symbol.hciAgent,b),root.endAutocalcOff()}).on("keyup",function(a){var b=a.which,c=!1;if(a.altKey&&!a.shiftKey&&!a.ctrlKey){var d=root.lookup("view_"+q+"_zoom"),e=d.value();61==b||187==b?(e*=1.25,c=!0):173==b||189==b?(e/=1.25,c=!0):48==b&&(e=1,c=!0),d.assign(e,root.scope,Symbol.hciAgent)}c&&(a.preventDefault(),a.stopPropagation())}),{initialWidth:I,initialHeight:J,code_entry:n,offsetSym:w,zoomSym:v,widthSym:x,heightSym:y,scaleSym:u}},this.createEmbedded=function(b,d,e){var f=b;eden.execute2("view_"+f+"_content is "+e+";");var g=c.createCommon(b,d),h=(g.initialWidth,g.initialHeight,g.code_entry),i=g.offsetSym,j=g.zoomSym,k=g.widthSym,l=g.heightSym,m=g.scaleSym;return{code_entry:h,contents:h,destroy:function(){delete canvases[f],delete contents[f]},resize:function(b,d){var e,g=i.value();g instanceof Point?(e=g.x,g.y):e=0;var h,n,o=j.value(),p=document.getElementById(f+"-canvas"),q=!1,r=k.value();if(void 0===r?(h=o>1?Math.ceil(b*o):Math.floor(b),p.width!=h&&(p.width=h,q=!0)):r=Math.ceil(r*m.value()*o+e),void 0===l.value()){if(o>1)n=Math.ceil(d*o);else{n=d,void 0!==r&&r>n&&(n-=a.scrollBarSize);var n=Math.floor(n-1)}n!=p.height&&(p.height=n,q=!0)}q&&c.drawPicture(f)}}},this.createDialog=function(b,d){var e,f=b.slice(0,-7),h=c.createCommon(f,d),i=h.initialWidth,j=h.initialHeight,k=h.code_entry,l=h.offsetSym,m=h.zoomSym,n=h.widthSym,o=h.heightSym,p=h.scaleSym;return $('<div id="'+b+'"></div>').html(k).dialog({appendTo:"#jseden-views",title:d,width:i+a.scrollBarSize,height:j+a.titleBarHeight,minHeight:120,minWidth:230,classes:{"ui-dialog":"canvas-dialog unpadded-dialog ui-front"}}),e={confirmClose:!0,destroy:function(){var a=g[f];for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];$(e).detach()}delete canvases[f],delete contents[f]},resize:function(b,d){var e,g=l.value();g instanceof Point?(e=g.x,g.y):e=0;var h,i,j=m.value(),k=document.getElementById(f+"-canvas"),q=!1,r=n.value();if(void 0===r?(h=j>1?Math.ceil(b*j):Math.floor(b),k.width!=h&&(k.width=h,q=!0)):r=Math.ceil(r*p.value()*j+e),void 0===o.value()){if(j>1)i=Math.ceil(d*j);else{i=d,void 0!==r&&r>i&&(i-=a.scrollBarSize);var i=Math.floor(i-1)}i!=k.height&&(k.height=i,q=!0)}q&&c.drawPicture(f)}},c.drawPicture(f),e},root.lookup("mouseDownZone").addJSObserver("recordClick",function(a,b){if(eden.isValidIdentifier(b)){var c=root.lookup(b+"_click");!1===c.value()&&c.assign(!0,root.scope,Symbol.hciAgent,!0)}}),this.endClick=function(){var a=root.lookup("mouseDownZone").value();if(eden.isValidIdentifier(a)){var b=root.lookup(a+"_click");!0===b.value()&&b.assign(!1,root.scope,Symbol.hciAgent,!0)}},this.canvasNameFromElement=function(a){for(;a;){var b=a.id;if("-canvascontent"==b.slice(-14))return b.slice(0,-14);a=a.parentElement}return null},document.addEventListener("mouseup",function(b){var c=root.lookup("mouseFollow").value();if(root.beginAutocalcOff(),!k.insideCanvas){var d;switch(b.button){case 0:k.leftButton=!1,d="Left";break;case 1:k.middleButton=!1,d="Middle";break;case 2:k.rightButton=!1,d="Right";break;case 3:k.button4=!1,d="Button4";break;case 4:k.button5=!1,d="Button5";break;default:d="Unknown"}k.buttonCount=k.leftButton+k.middleButton+k.rightButton+k.button4+k.button5;var e=root.lookup("mouseButtons");if(0==k.buttonCount&&""!=e.value()){var f=root.lookup("mousePressed"),g=f.value();root.lookup("mouseButton").assign(d+" up",root.scope,Symbol.hciAgent,c),e.assign("",root.scope,Symbol.hciAgent,c),root.lookup("mousePosition").assign(void 0,root.scope,Symbol.hciAgent,c),g&&f.assign(!1,root.scope,Symbol.hciAgent,c),root.lookup("mouseUp").assign(void 0,root.scope,Symbol.hciAgent,c),root.lookup("mouseView").assign(void 0,root.scope,Symbol.hciAgent,c),a.plugins.Canvas2D.endClick()}}root.endAutocalcOff()}),document.addEventListener("mousedown",function(a){if(!k.insideCanvas){switch(a.button){case 0:k.leftButton=!0;break;case 1:k.middleButton=!0;break;case 2:k.rightButton=!0;break;case 3:k.button4=!0;break;case 4:k.button5=!0}k.buttonCount=k.leftButton+k.middleButton+k.rightButton+k.button4+k.button5}}),document.addEventListener("pointerlockchange",function(a){var b=null!==document.pointerLockElement;k.capturing=b;var c=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(b,root.scope,void 0,c)}),a.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:a.viewCategories.visualization,holdsContent:!0};document.location.pathname.slice(-15),Eden.Selectors.execute("plugins > canvas > canvas",function(){eden.root.lookup("plugins_canvas_loaded").assign(!0,eden.root.scope),b&&b()})},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.Transform.CSSInfo=function(a,b,c){this.css=a,this.scaleX=b,this.scaleY=c},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Page=function(a,b){function c(a){if(!a)return"";if("title"!=a[0])return"";var b,c=$("<div class='page-title "+s+"'></div>"),d=$("<div class='page-title-block'></div>");a[6]&&c.css("height",a[6]+"px"),b=a[1]?$("<span class='page-title-text "+s+"'>"+a[1]+"</span>"):$('<img border=0 src="'+a[5]+'"></img>');var e=$("<br/><span class='page-subtitle-text "+s+"'>"+a[2]+"</span>");return d.append(b),d.append(e),c.append(d),a[3],c}function d(a){if(!a)return"";if("header"!=a[0])return"";switch(a[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+a[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+a[1]+"</h2>")}}function e(a){switch(typeof a){case"string":return a;case"number":return a+"px";default:return""}}function f(a,b){for(var c=0;c<b.length;c++)void 0!==b[c]&&C[c]&&(a.style[C[c]]=e(b[c]))}function g(a,b){var c={};if(c.tagType=a,void 0===b)return c;for(var d,e=/([^\s=]+)(?:\s*=\s*((?:"[^"]*")|(?:'[^']*')|\S*))?/g;null!==(d=e.exec(b));)if(void 0===d[2]||""==d[2])c[d[1]]=!0;else{var f,g=d[2][0];f='"'==g||"'"==g?d[2].slice(1,-1):d[2],/^\d+$/.test(f)&&(f=parseInt(f)),c[d[1]]=f}return c}function h(a){var b=[],c=[];a=a.replace(/"jseden:([^"]*)"/g,"\"javascript:eden.execute2('$1;')\""),a=a.replace(/'jseden:([^']*)'/g,"'javascript:eden.execute2(\"$1;\")'"),a=a.replace(/<jseden(-([\w\-]+))?(\s+(?:[^"'\/>]*(?:"[^"]*")*(?:'[^']*')*)*)?(?:\/|(?:>((?:[^<]*(?:<(?!\/jseden\1>))*)*)<\/jseden\1))>/g,function(a,d,e,f,h,i,j){return void 0===h&&(h=""),b.push(h),c.push(g(e,f)),"\0\0"});var d=a.split("\0\0");if(1==d.length)return a;for(var e=$("<div></div>"),f=0;f<d.length-1;f++)if(e.append($("<div class='page-paragraph'>"+d[f]+"</div>")),void 0===c[f].tagType){var h=b[f].split("\n").length;void 0===c[f].lines&&(c[f].lines=h),void 0===c[f].width&&(c[f].width="50%"),void 0===c[f].box&&(c[f].box=!0);var i=l(["script",c[f].static,[b[f]],c[f].name,c[f].box,c[f].lines,!1,c[f].float,c[f].width]);e.append(i)}else if(c[f])if("canvas"==c[f].tagType){var j=n(["canvas",c[f].name,c[f].source,c[f].width,c[f].height,c[f].float,c[f].box]);e.append(j)}else if("veden"==c[f].tagType){var k=m(["veden",c[f].name,c[f].width,c[f].height,c[f].float,b[f]]);e.append(k)}return e.append($("<div class='page-paragraph'>"+d[d.length-1]+"</div>")),e.get(0)}function i(a){if(a&&"element"==a[0]){var b,c=a[1],d=a[2],e=a[3],g=a[4],i=a[5],k=a[6],l=(a[7],a[8],a[9],a[10],a[11],a[12]),m=a[13];switch(c){case"div":case"span":case"button":case"img":case"p":case"ul":case"ol":case"li":case"br":case"pre":case"h1":case"h2":case"h3":case"a":case"input":b=document.createElement(c);break;default:return void console.error("Invalid element type: "+c)}if(d&&(b.id=d),e&&(b.className=e),g&&"string"==typeof g){var n=h(g);"string"==typeof n?b.innerHTML=n:b.appendChild(n)}return g&&g instanceof Array&&j(b,g),i&&"string"==typeof i&&(b.cssText=i),i&&i instanceof Array&&f(b,i),k&&d&&(b.onclick=function(a){var b=eden.root.lookup(d+"_click");console.log("ELEMENT CLICK"),b.assign(!0,eden.root.scope)}),"img"==c&&l&&(b.src=l),"a"==c&&m&&(b.href=m),b}}function j(a,b){if("string"==typeof b[0]){var c=i(b);return void(c&&a.appendChild(c))}for(var d=0;d<b.length;d++){var c=i(b[d]);c&&a.appendChild(c)}}function k(a){if(!a)return"";if("p"!=a[0])return"";var b;b=a[1]instanceof Array?a[1].join("&nbsp;"):a[1];var c=[];b=b.replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden>/g,function(a,b,d,e,f){return console.log("ATTRIBS: "+b),c.push(d),"\0\0"});var d=b.split("\0\0");if(1==d.length)return $("<div class='page-paragraph'>"+b+"</div>");for(var e=$("<div></div"),f=0;f<d.length-1;f++){e.append($("<div class='page-paragraph'>"+d[f]+"</div>"));var g=c[f].split("\n").length,h=l(["script",!1,[c[f]],void 0,!0,g,!1,!1,"50%"]);e.append(h)}return e.append($("<div class='page-paragraph'>"+d[d.length-1]+"</div>")),e}function l(b){if(b&&"script"==b[0]){var c=b[1],d=b[2],e=b[3],f=b[4],g=b[5],h=b[6],i=b[7],j=b[8];if(void 0===e&&(e="embedded"+B,B++),c){var k;k=f?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>");var l,m=new EdenUI.Highlight(k.get(0));l=d instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(d):d;var n=new Eden.AST(l);m.highlight(n,-1,-1),i&&"none"!=i&&k.css("float",i),"50%"!=j&&("number"==typeof j?k.width(j):k.css("width",j));var o=EdenUI.plugins.ScriptInput.getRequiredHeight(g,!0);return k.height(o),k}var p;z[e]?(p=z[e],p.update(d)):(p=a.views.ScriptInput.embed(e,e,d,h),z[e]=p);var q;q=f?$("<div id='"+e+"-dialog' class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>");var o=EdenUI.plugins.ScriptInput.getRequiredHeight(g,!0);return q.height(o),i&&"none"!=i&&q.css("float",i),"50%"!=j&&("number"==typeof j?q.width(j):q.css("width",j)),p.contents.appendTo(q),q.resizable(),q}}function m(b){if(b&&"veden"==b[0]){var c,d=b[1],e=b[2],f=b[3],g=b[4],h=b[5];A[d]?c=A[d]:(c=a.views.Veden.embed(d,d,h),A[d]=c);var i;return i=$("<div id='"+d+"-dialog' class='page-script-live page-script-live-box'></div>"),i.height(f),g&&"none"!=g&&i.css("float",g),"50%"!=e&&("number"==typeof e?i.width(e):i.css("width",e)),c.contents.appendTo(i),i.resizable(),i}}function n(b){var c,d=b[6],f=b[3],g=b[4];if(c=d?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>"),f&&c.css("width",e(f)),g&&c.css("height",e(g)),void 0===y[b[1]]){var h=a.views.Canvas2D.embedded(b[1],b[1],b[2]);y[b[1]]=h,c.append(h.code_entry),x.push(function(){h.resize(b[3],b[4])})}else y[b[1]].code_entry.appendTo(c),x.push(function(){y[b[1]].resize(b[3],b[4])});return"none"!=b[5]&&c.css("float",b[5]),c}function o(a){var b;if(b=a[1]?$("<ul></ul>"):$("<ol></ol>"),a[2]&&a[2]instanceof Array)for(var c=0;c<a[2].length;c++){var d=$("<li>"+a[2][c]+"</li>");b.append(d)}return b}function p(a,b){if(!a)return"";if(!(a instanceof Array))return"";for(var c=$("<div class='page-content "+s+"'></div>"),e=0;e<a.length;e++)if(void 0!==a[e])switch(a[e][0]){case"header":c.append(d(a[e]));break;case"p":c.append(k(a[e]));break;case"script":c.append(l(a[e]));break;case"canvas":c.append(n(a[e]));break;case"break":c.append($("<div class='clear'></div>"));break;case"list":c.append(o(a[e]))}return c}function q(a,b){if(void 0!==b&&b instanceof Array){for(var c in y)y[c].code_entry.detach();for(var d in z)z[d].contents.detach();w.html(""),j(w.get(0),b);for(var e=0;e<x.length;e++)x[e]();x=[]}}function r(a,b){if(void 0!==b&&b instanceof Array){B=0;for(var d in y)y[d].code_entry.detach();for(var e in z)z[e].contents.detach();s=b[2],"default"==s&&(s="page-theme-default"),w.html(""),w.append(c(b[1])),w.append(p(b[3],0));for(var f=0;f<x.length;f++)x[f]();x=[]}}var s,t=a.eden.root.lookup("page"),u=a.eden.root.lookup("document"),v=t.value(),w=$("<div class='main-page page'></div>");$("#jseden-views").append(w).addClass("page-body");var x=[],y={},z={},A={},B=0,C=["top","bottom","left","right","width","height","background","position","color","border","font","fontSize","fontFamily","fontWeight","borderBottom","borderLeft","borderRight","borderTop","overflow","padding","paddingTop","paddingLeft","paddingRight","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","textShadow"];r(t,v),t.addJSObserver("pageGenerator",r),u.addJSObserver("pageGenerator",q),Eden.Selectors.execute("plugins > page > page",function(){eden.root.lookup("plugins_page_loaded").assign(!0,eden.root.scope),b&&b()})},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";var edenfunctions={};EdenUI.plugins.SymbolViewer=function(a,b){var c=this;this.instances=[];var d=0,e=function(a,b){var c='\t\t\t<div class="symbollist-search-box-outer"> \t\t\t\t<input type="text" class="symbollist-search symbollist-control" /> \t\t\t\t<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> \t\t\t\t';return c+='\t\t\t</div> \t\t\t<div class="symbollist-results"></div>'};this.createDialog=function(b,f,g){function h(){var b=q.value();return o.val().startsWith("select: ")?a.regExpFromStr("","",!1,b):a.regExpFromStr(o,"",!1,b)}function i(a,b){n.search(p.value,h()),"regexp"==b?o.attr("placeholder","search regular expression"):"simple"==b?o.attr("placeholder","simple search"):o.attr("placeholder","search")}var k=b.slice(0,-7),l=root.lookup("createView"),m=$('<div class="symbollist-outer"></div>');m.html(e());var n=new EdenUI.plugins.SymbolViewer.SymbolList(a.eden.root,m.find(".symbollist-results")[0],g);$dialog=$('<div id="'+b+'"></div>').append(m).dialog({appendTo:"#jseden-views",title:f,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"symbollist-dialog ui-front"}}),c.instances.push(n),d++,1==d&&a.eden.root.addGlobal(j),m.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var b="edit_"+k;if(p.value.startsWith("select: ")){a.createView(b,"ScriptInput",void 0);var c=eden.root.lookup("view_"+b+"_tabs").value();Array.isArray(c)||(c=[]),c.push(p.value.substring(8)),eden.root.lookup("view_"+b+"_tabs").assign(c,eden.root.scope,Symbol.hciAgent),eden.root.lookup("view_"+b+"_current").assign(c.length-1,eden.root.scope,Symbol.hciAgent)}});var o=m.find(".symbollist-search-box-outer > .symbollist-search"),p=o[0],q=root.lookup("view_"+k+"_search_language");i(q,q.value()),q.addJSObserver("refreshView",i);var r=root.lookup("view_"+k+"_search_string"),s=function(a,b){void 0!==b&&(b!==p.value&&(p.value=b),n.search(b,h()))},t=r.value();return void 0===t?(r.assign("",root.scope,l),n.search("",new RegExp(""))):s(0,t),r.addJSObserver("refreshView",s),o.keyup(function(){r.assign(p.value,root.scope,Symbol.hciAgent)}),{destroy:function(){var b=c.instances.indexOf(n);c.instances.splice(b,1),0==--d&&a.eden.root.removeGlobal(j)}}},this.createObservableDialog=function(a,b){return c.createDialog(a,b,"obs")},this.createFunctionDialog=function(a,b){return c.createDialog(a,b,"func")},this.createAgentDialog=function(a,b){return c.createDialog(a,b,"agent")},this.createSymbolDialog=function(a,b){return c.createDialog(a,b,"all")};var f={},g={},h=!1;this.isCreationPending=function(a){return a in g},this.delay=40;var i=function(){for(x in c.instances){var a,b,d,e=c.instances[x];void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(a=$(e.symresults),b=a.parent(),d=a.scrollTop(),a.detach());for(var i in g){var j=g[i];e.filter?e.filter.indexOf(i)>=0&&e.addSymbol(j,i):e.addSymbol(j,i)}for(var i in f)e.updateSymbol(i);void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(a.appendTo(b),a.scrollTop(d))}f={},g={},h=!1},j=function(a,b){var d=a.name;if(1==b)g[d]=a;else{if(d in g)return;f[d]=a}h||(h=!0,setTimeout(i,c.delay))};a.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:a.viewCategories.comprehension,menuPriority:0},a.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:a.viewCategories.comprehension,menuPriority:0},a.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:a.viewCategories.comprehension,menuPriority:0},a.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:a.viewCategories.comprehension,menuPriority:1},eden.root.lookup("plugins_symbolviewer_loaded").assign(!0,eden.root.scope),b()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(a,b,c){this.root=a,this.regExp=new RegExp(""),this.type=c,this.category="all",this.customCategory=!1,this.subtypes="all",this.symresults=b,this.symbols={},this.filter=void 0},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(a,b,c,d){if(void 0!==a)if(a.startsWith("select: ")){var e=Eden.Selectors.query(a.substr(8),"symbol");console.log(e),this.filter=e,this.regExp=b,this.regExp=b,void 0!==d&&(this.subtypes=d),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};for(var f=0;f<e.length;f++){var g=e[f],h=this.root.symbols[g];h&&this.addSymbol(h,g)}}else{this.searchStr=a,this.searchStrLowerCase=a.toLowerCase(),this.regExp=b,void 0!==d&&(this.subtypes=d),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};var i,j;for(i in this.root.symbols)edenUI.plugins.SymbolViewer.isCreationPending(i)||(j=this.root.symbols[i],this.addSymbol(j,i))}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(a){void 0!==this.symbols[a]&&this.symbols[a].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(a,b){var c,d=!1;if(b.toLowerCase()==this.searchStrLowerCase)d=!0,c="exact-match";else if(!this.regExp.test(b))return;var e=!0;if(this.customCategory?Eden.isitCategory(b,this.category,this.type)||(e=!1):Eden.isitSystemSymbol(b)?"user"==this.category&&(e=!1):"system"==this.category&&(e=!1),void 0!==a.definition?"vars"==this.subtypes&&(e=!1):"formulas"==this.subtypes&&(e=!1),!e){if(!d)return;c="dirty-match"}var f="obs";if(a.definition){var g=a.getSource();f=/^proc\s/.test(g)?"agent":/^func\s/.test(g)?"func":"function"==typeof a.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(a.cache.value.toString())?"func":"agent":"obs"}else f="function"==typeof a.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(a.cache.value.toString())?"func":"agent":"obs";if("all"==this.type||this.type==f){var h=new EdenUI.plugins.SymbolViewer.Symbol(a,b,f,c);d?h.element.prependTo(this.symresults):h.element.appendTo(this.symresults),this.symbols[b]=h}},EdenUI.plugins.SymbolViewer.Symbol=function(a,b,c,d){function e(){f.element.removeClass("symbollist-inline-editor"),f.update(),f.element.scrollLeft(0)}switch(this.symbol=a,this.name=b,this.type=c,this.details=void 0,this.update=void 0,this.element=$('<div class="symbollist-result-element"></div>'),d&&this.element.addClass("symbollist-"+d+"-result"),c){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var f=this,g=!1;this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||g||(g=!0,setTimeout(function(){if(!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&g){g=!1;f.name;Eden.Selectors.goto("> :not(ACTIVE) >> "+a.name)}},350))}),"obs"==c&&this.element.dblclick(function(){function a(){var a=l.get(0).value,b=o.value;";"!=b.slice(-1)&&(b+=";"),eden.execute2(f.name+" "+a+" "+b),e(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0}function c(b){var c=b.which;13==c?a():27==c&&(e(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}if(g=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==f){var d=f.symbol.cache.value;if(void 0!==f.symbol.definition||"boolean"!=typeof d){EdenUI.plugins.SymbolViewer.inlineEditorSymbol=f,f.element.addClass("symbollist-inline-editor");var h=f.element.find(".result_value"),i=f.element.find(".result_separator");h.html("");var j,k;void 0!==f.symbol.definition?(j=f.symbol.getSource().replace(new RegExp("^\\s*"+b+"\\s+is\\s+"),""),k="is"):(j=Eden.edenCodeForValue(d),k="=");var l=$("<select></select>");"="==k?(l.append('<option value="is">is</option>'),l.append('<option value="=" selected="selected">=</option>')):(l.append('<option value="is" selected="selected">is</option>'),l.append('<option value="=">=</option>')),i.html(" "),i.append(l);var m=Eden.htmlEscape(j,!0),n=$('<input type="text" value="'+m+'" spellcheck="false" style="width: 100%"/>'),o=n.get(0);n.on("keyup",c),n.on("blur",function(){setTimeout(function(){l.is(document.activeElement)||(e(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===f&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),l.on("keydown",c),l.on("blur",function(){setTimeout(function(){n.is(document.activeElement)||(e(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===f&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),h.append(n);var p=f.element.find(".symbollist-result-inner");p.length>0&&(p.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),o.focus(),o.select();var q=j.slice(0,1);'"'!=q&&"'"!=q&&"["!=q&&"{"!=q||(o.selectionStart=1,o.selectionEnd=j.length-1)}else!0===d?f.symbol.assign(!1,eden.root.scope,Symbol.hciAgent,!0):f.symbol.assign(!0,eden.root.scope,Symbol.hciAgent,!0)}}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var a,b,c=this.symbol.getSource();if(a=void 0===this.symbol.definition||/^func\s/.test(c)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name]){this.details=edenfunctions.functions[this.name];b="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"}else b="";var d="<span class='result_name'>"+a+"</span>"+b;if(void 0!==this.symbol.definition&&!/^func\s/.test(this.symbol.eden_definition)){var e=Eden.htmlEscape(c,!1,!0);e=Eden.htmlEscape("<pre>"+e+";</pre>"),d="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+e+"\")' onmouseleave='EdenUI.closeTooltip()'>"+d+"</span>"}this.element.html(d)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var a,b=this.symbol.value(),c=_formatVal(b);a=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name;var d="<span class='result_name'>"+a+"</span><span class='result_separator'> = </span> <span class='result_value'>"+c+"</span>";if(void 0!==this.symbol.definition){var e=Eden.htmlEscape(this.symbol.getSource(),!1,!0);e=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+e+";</pre>"),d="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+e+"\")' onmouseleave='EdenUI.closeTooltip()'>"+d+"</span>"}this.element.html(d)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var a,b,c=this.symbol.getSource();if(a=void 0===this.symbol.definition||/^proc\s/.test(c)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name]){this.details=edenfunctions.procedures[this.name];b="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"}else b="";var d="<span class='result_name'>"+a+"</span>"+b;if(void 0!==this.symbol.definition&&!/^proc\s/.test(c)){var e=Eden.htmlEscape(c,!1,!0);e=Eden.htmlEscape("<pre>"+e+";</pre>"),d="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+e+"\")' onmouseleave='EdenUI.closeTooltip()'>"+d+"</span>"}this.element.html(d)};var edenfunctions={};EdenUI.plugins.VersionViewer=function(a,b){var c=this;this.instances=[];var d=0,e=function(a,b){return'<table class="version-viewer-list"></table>'};this.createDialog=function(b,f,g){var h=b.slice(0,-7),i=(root.lookup("createView"),$('<div class="versionviewer-outer"></div>'));i.html(e()),$dialog=$('<div id="'+b+'"></div>').append(i).dialog({appendTo:"#jseden-views",title:f,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"versionviewer-dialog ui-front"}});root.lookup("view_"+h+"_search_string");return function(){var a=URLUtil.getParameterByName("load");$.get(Eden.DB.remoteURL+"/project/versions",{projectID:a},function(b){var c=i.find(".version-viewer-list").html(""),d=$("<tr><th>Vid</th><th>Date</th><th>ParentDiff</th></tr>");c.append(d),$(b).each(function(b,d){var e=$('<tr><td><a href="?load='+a+"&vid="+d.saveID+'">'+d.saveID+"</td><td>"+d.date+"</td><td>"+d.parentDiff+"</td></tr>");c.append(e)})})}(),{destroy:function(){var b=c.instances.indexOf(symbollist);c.instances.splice(b,1),0==--d&&a.eden.root.removeGlobal(symbolChanged)}}},this.createVersionListDialog=function(a,b){return c.createDialog(a,b,"all")},a.views.VersionList={dialog:this.createVersionListDialog,title:"Version List",category:a.viewCategories.history,menuPriority:1},eden.root.lookup("plugins_VersionViewer_loaded").assign(!0,eden.root.scope),b()},EdenUI.plugins.VersionViewer.title="Version Viewer",EdenUI.plugins.VersionViewer.description="Show version details for a specified project.",EdenUI.plugins.VersionViewer.inlineEditorSymbol=void 0,EdenUI.plugins.ExternalHTMLContent=function(a,b){function c(){d=!1}var d=!1,e=!1;this.createDialog=function(b,f){function g(a,b){n.src=void 0===b?"plugins/external-html-content/undefined-url.html?view="+encodeURI(j):"plugins/external-html-content/redirect.html?view="+encodeURI(j)+"&url="+encodeURI(b)}function h(a,b){b?(r.value()&&l.addClass("external-html-content-pinned"),p.css("display","block")):(l.removeClass("external-html-content-pinned"),p.css("display","none"))}function i(a,b){q.value()&&l.toggleClass("external-html-content-pinned",b)}
e||(""==document.location.hash&&window.history.pushState({},"","#noNavigateAway"),window.addEventListener("popstate",function(){""==document.location.hash&&(d?window.history.forward(1):a.modalDialog("Leave Environment?","<p>Leaving this page will discard the current script. Your work will not be saved.</p><p>Are you sure you want to close JS-EDEN?</p>",["Close JS-EDEN","Return to Construal"],1,function(a){0==a?(doingNavigateAway=!0,window.history.back(1)):window.history.forward(1)}))}),e=!0);var j=b.slice(0,-7),k=root.lookup("createView"),l=$('<iframe marginwidth="13" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts" allowfullscreen="true" name="'+b+'"></iframe>'),m=root.lookup("_view_"+j+"_url"),n=l[0];g(m,m.value()),m.addJSObserver("refreshView",g);var o=$('<div id="'+b+'"></div>').html(l).dialog({title:f,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"external-html-content"}),p=$('<div class="external-html-content-toolbar">');o.append(p);var q=root.lookup("_view_"+j+"_toolbar_visible"),r=root.lookup("_view_"+j+"_toolbar_pinned");void 0===q.value()&&q.assign(!0,root.scope,k),void 0===r.value()&&r.assign(!1,root.scope,k),h(q,q.value()),q.addJSObserver("refreshView",h),r.addJSObserver("refreshView",i);var s=$('<input type="image" src="images/pin.png" width="28" height="28" alt="Pin toolbar" title="Click to pin the toolbar in place"/>');s.on("click",function(){r.assign(!r.value(),root.scope,Symbol.hciAgent),n.focus()}),p.append(s);var t=$('<input type="image" src="images/back-button.svg" width="28" height="28" alt="Back" title="Click to go back"/>');t.on("click",function(){d||setTimeout(c,1e3),d=!0,window.history.back(1),n.focus()}),p.append(t);var u=$('<input type="image" src="images/forward-button.svg" width="28" height="28" alt="Forward" title="Click to go forward"/>');u.on("click",function(){window.history.forward(1),n.focus()}),p.append(u);var v=$('<input type="image" src="images/refresh-button.png" height="28" alt="Refresh" title="Click to reload the page specified by _view_'+j+'_url"/>');return v.on("click",function(){g(m,m.value()),n.focus()}),p.append(v),{confirmClose:!0}},a.views.ExternalHTMLContent={dialog:this.createDialog,title:"External HTML Content",category:a.viewCategories.visualization,holdsContent:!0},a.eden.include("plugins/external-html-content/external-html-content.js-e",b)},EdenUI.plugins.ExternalHTMLContent.title="External HTML Content",EdenUI.plugins.ExternalHTMLContent.description="Allows construals to display web pages created outside of JS-EDEN.",EdenUI.plugins.HTMLContent=function(a,b){this.createDialog=function(a,b){function c(a){return"view_"+e+"_"+a}function d(a,b){k.get(0).parentNode.style.background=b}var e=a.slice(0,-7),f=[c("background_colour"),c("content")],g=$('<div id="'+a+'-content" class="htmlviews-content" data-observables="'+f.join(",")+'"></div>');g.on("mousedown","button",function(a){var b=a.currentTarget.name,c=a.currentTarget.getAttribute("data-value");null!==c&&null!==c.charAt(0).match(/[0-9]?/)&&(c=parseInt(c)),eden.root.lookup(b).assign(null===c||c,eden.root.scope,Symbol.hciAgent)}),g.on("mouseup","button",function(a){var b=a.currentTarget.name;null===a.currentTarget.getAttribute("data-value")&&eden.root.lookup(b).assign(!1,eden.root.scope,Symbol.hciAgent)}),g.on("click",function(a){var b=a.srcElement.getAttribute("data-jseden");b&&""!=b&&(console.log(b),eden.execute2(b,{name:"execute"}))});var h=root.lookup("view_"+e+"_content"),i=function(a,b){void 0===b?g.html('<div class="htmlviews-undefined">Give view_'+e+"_content a value to display HTML formatted text here.</div>"):g.html(b)};i(0,h.value()),h.addJSObserver("repaintView",i);var j=root.lookup("view_"+e+"_background_colour");j.addJSObserver("changeColour",d);var k=$('<div id="'+a+'"></div>').html(g).dialog({appendTo:"#jseden-views",title:b,width:600,height:450,minHeight:120,minWidth:230,classes:{"ui-dialog":"htmlviews-dialog ui-front"}}),l=j.value();return l&&d(j,l),{confirmClose:!0}},a.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:a.viewCategories.visualization,holdsContent:!0},Eden.Selectors.execute("plugins > html > html",function(){eden.root.lookup("plugins_html_loaded").assign(!0,eden.root.scope,Symbol.localJSAgent),b&&b()})},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(a,b){var c=this;this.createDialog=function(a,b){$dialog=$('<div id="'+a+'"></div>').html('<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>').dialog({title:b,width:300,height:450,minHeight:120,minWidth:230})};var d={};d["="]={precedence:1,associativity:"right",text:"=",whitespace:!0},d["+="]={precedence:1,associativity:"right",text:"+=",whitespace:!0},d["-="]={precedence:1,associativity:"right",text:"-=",whitespace:!0},d["||"]={precedence:3,associativity:"left",text:"||",whitespace:!0},d.or={precedence:3,associativity:"left",text:"or",whitespace:!0},d["&&"]={precedence:4,associativity:"left",text:"&&",whitespace:!0},d.and={precedence:4,associativity:"left",text:"and",whitespace:!0},d["=="]={precedence:5,associativity:"left",text:"==",whitespace:!0},d["!="]={precedence:5,associativity:"left",text:"!=",whitespace:!0},d["<"]={precedence:6,associativity:"left",text:"<",whitespace:!0},d["<="]={precedence:6,associativity:"left",text:"<=",whitespace:!0},d[">"]={precedence:6,associativity:"left",text:">=",whitespace:!0},d[">="]={precedence:6,associativity:"left",text:">",whitespace:!0},d["=~"]={precedence:6,associativity:"left",text:"=~",whitespace:!0},d["!~"]={precedence:6,associativity:"left",text:"!=",whitespace:!0},d["//"]={precedence:7,associativity:"left",text:"//",whitespace:!0},d["+"]={precedence:8,associativity:"left",text:"+",whitespace:!0},d["-"]={precedence:8,associativity:"left",text:"-",whitespace:!0},d["*"]={precedence:9,associativity:"left",text:"*",whitespace:!0},d["/"]={precedence:9,associativity:"left",text:"/",whitespace:!0},d["%"]={precedence:9,associativity:"left",text:"%",whitespace:!0},d["^"]={precedence:11,associativity:"right",text:".",whitespace:!1},d["."]={precedence:14,associativity:"left",text:".",whitespace:!1};var e={};e["-"]={precedence:10,text:"-"},e["!"]={precedence:10,text:"!"},e["&"]={precedence:10,text:"&"},e.not={precedence:10,text:"!"},e["++."]={precedence:11,text:"++"},e["--."]={precedence:11,text:"--"},e["*"]={precedence:12,text:"*"};var f={};f["#"]={precedence:11,text:"#"},f[".++"]={precedence:11,text:"++"},f[".--"]={precedence:11,text:"--"};var g={};this.convertTreeToEden=function(a,b,c,d,e){var f=function(g,h,i){if(!g.hasOwnProperty("children"))return g.name;var j,k,l,m=g.name,n=g.children;if(b.hasOwnProperty(m)&&2==n.length){j=b[m],k=j.precedence;var o=j.associativity,p=f(n[0],k,j.text),q=f(n[1],k,j.text);if("left"==o){var r=n[1].name;n[1].hasOwnProperty("children")&&2==n[1].children.length&&b.hasOwnProperty(r)&&k==b[r].precedence&&(q="("+q+")")}else{var s=n[0].name;n[0].hasOwnProperty("children")&&2==n[0].children.length&&b.hasOwnProperty(s)&&k==b[s].precedence&&(p="("+p+")")}l=j.whitespace?p+" "+j.text+" "+q:p+j.text+q}else if(a.hasOwnProperty(m))j=a[m],k=j.precedence,l=j.text+f(n[0],k,j.text);else if(c.hasOwnProperty(m))j=c[m],k=j.precedence,l=f(n[0],k,j.text)+j.text;else if(d.hasOwnProperty(m))j=d[m],this.precedence=j.precedence,l=j.code(n,i);else{k=e;for(var t=[],u=0;u<n.length;u++)t.push(f(n[u],0,void 0));l=m+"("+t.join(", ")+")"}return k<h&&(l="("+l+")"),l};return function(a){return f(a,0,void 0)}}(e,d,f,g,13),g["?"]={precedence:2,code:function(a){return c.convertTreeToEden(a[0])+"? "+c.convertTreeToEden(a[1])+" : "+c.convertTreeToEden(a[2])}},g["`...`"]={precedence:13,code:function(a){return"`"+c.convertTreeToEden(a[0])+"`"}},g["${{...}}$"]={precedence:13,code:function(a){return"${{ "+a[0].name+" }}$"}},g["(...)"]={precedence:13,code:function(a){for(var b=c.convertTreeToEden(a[0]),d=[],e=1;e<a.length;e++)d.push(c.convertTreeToEden(a[e]));return"("+b+")("+d.join(", ")+")"}},g["[...]"]={precedence:13,code:function(a){for(var b=[],d=0;d<a.length;d++)b.push(c.convertTreeToEden(a[d]));return"["+b.join(", ")+"]"}},g["[n]"]={precedence:13,code:function(a){return c.convertTreeToEden(a[0])+"["+c.convertTreeToEden(a[1])+"]"}},g["{...}"]={precedence:13,code:function(a){for(var b=[],d=0;d<a.length-1;d+=2)b.push(a[d].name+": "+c.convertTreeToEden(a[d+1]));return"{"+b.join(", ")+"}"}},g.Point={precedence:13,code:function(a,b){if("."==b){for(var d=[],e=0;e<a.length;e++)d.push(c.convertTreeToEden(a[e]));return"Point("+d.join(", ")+")"}return"{"+c.convertTreeToEden(a[0])+", "+c.convertTreeToEden(a[1])+"}"}},a.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:a.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_content","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","semicircleAngle","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,background_audio:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,semicircleAngle:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createExternalHTMLView:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,loadTextFileIntoObservable:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showAgents:!0,showFunctions:!0,showObservables:!0,showSymbols:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0,bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0},Eden.systemFunctionNames={Arc:!0,Arrowhead:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Object:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,semicircleAngle:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Arrowhead:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,hslColour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgbColour:!0,rotatePoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,semicircleAngle:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.symbolCategories["Sound and Video"]={agent:{bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0,unbind:!0},obs:{background_audio:!0,background_audio_url:!0,background_audio_paused:!0,background_audio_chapter:!0,background_audio_chapters:!0,background_audio_looping:!0,background_audio_speed:!0,background_audio_time:!0,background_audio_volume:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0},func:{Audio:!0,Video:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0}},Eden.isitSystemSymbol=function(a){return Eden.isitSystemObservable(a)||Eden.isitSystemAgent(a)||Eden.isitSystemFunction(a)},Eden.isitSystemObservable=function(a){return!!/^(_view|background_audio)_/.test(a)||a in Eden.systemObservableNames},Eden.isitSystemAgent=function(a){return!!/^_View_/.test(a)||a in Eden.systemAgentNames},Eden.isitSystemFunction=function(a){return a in Eden.systemFunctionNames},Eden.isitCategory=function(a,b,c){var d=Eden.symbolCategories[b];return"all"==c?"obs"in d&&a in d.obs||"agent"in d&&a in d.agent||"func"in d&&a in d.func:c in d&&a in d[c]},Eden.getSymbolCategories=function(a){if("all"==a)return Object.keys(Eden.symbolCategories);var b=[];for(var c in Eden.symbolCategories)a in Eden.symbolCategories[c]&&b.push(c);return b},EdenUI.plugins.SymbolLookUpTable=function(a,b){this.createDialog=function(a,b){code_entry=$('<div id="'+a+'-content" class="symbol-lookup-table-content">'+c(a)+"</div>"),$dialog=$('<div id="'+a+'"></div>').html(code_entry).dialog({title:b,width:600,height:450,minHeight:120,minWidth:230})},a.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:a.viewCategories.comprehension,menuPriority:3},this.search=function(b){var c=$("#"+b+"-regexp"),e=a.regExpFromStr(c);document.getElementById(b+"-table-div").innerHTML=d(e,b)};var c=function(a){return"<div class='upper'><input id='"+a+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+a+"')\" placeholder='search' onload='setFocus()' /></div><div id='"+a+"-table-div' class='lower'>"+d(new RegExp(""),a)+"</div>"},d=function(a,b){tableBodyHTML="";var c,d=[],h={};for(var i in root.symbols)if(c=root.symbols[i],a.test(i)){var j,k,l;if(void 0===c.eden_definition)k="-",j="function"==typeof c.cache.value?"Function":"Observable",l=Eden.htmlEscape(Eden.edenCodeForValue(c.cache.value));else if(k=Eden.htmlEscape(c.eden_definition),0==k.indexOf("proc")){if(Eden.isitSystemAgent(i)&&!new RegExp("\\b"+i+"\\b").test(a.source))continue;j="Agent",l=""}else if(0==k.indexOf("func")){if(Eden.isitSystemFunction(i)&&!new RegExp("\\b"+i+"\\b").test(a.source))continue;j="Function",l=""}else j="Dependency",l=Eden.htmlEscape(Eden.edenCodeForValue(c.cache.value));d.push([c,i,j,k,l]),h[i]=!0}for(var m=0;m<d.length;m++){var n=d[m];c=n[0];var o=e(c.observees,h,b),p=e(c.dependencies,h,b),q=o;""!=o&&""!=p&&(q+=", "),q+=p;var r=e(c.observers,h,b),s=e(c.subscribers,h,b),t=r;""!=r&&""!=s&&(t+=", "),t+=s;var u=f(c.dynamicDependencyTable,h,b),v=c.last_modified_by?c.last_modified_by:"Not yet defined";v=g(v,h,b);var w=Object.keys(c.jsObservers).join(", "),x="<tr id='"+b+"-symbol-"+n[1]+'\'><td class="lower"><p>'+n[1]+'</p></td><td class="lower"><p>'+n[2]+'</p></td><td class="lower"><p>'+n[3]+'</p></td><td class="lower"><p>'+n[4]+'</p></td><td class="lower"><p>'+q+'</p></td><td class="lower"><p>'+t+'</p></td><td class="lower"><p>'+u+'</p></td><td class="lower"><p>'+v+'</p></td><td class="lower"><p>'+w+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(n[1])?tableBodyHTML+=x:tableBodyHTML=x+tableBodyHTML}return'<table><tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower"><b>Definition</b></td><td class="lower"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>'+tableBodyHTML+"</table>"},e=function(a,b,c){var d=[];for(var e in a){var f=e.slice(1);d.push(g(f,b,c))}return d.join(", ")},f=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];void 0===f&&(f=""),d.push(g(f,b,c))}return d.join(", ")},g=function(a,b,c){return"*"==a[0]||"include"==a||"Not yet defined"==a?a:a in b?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+c+"-symbol-"+a+"')\">"+a+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+c+"', '"+a+"')\">"+a+"</a>"};this.addSymbolToSearch=function(b,c){var d,e=document.getElementById(b+"-regexp");d="false"==a.getOptionValue("optSimpleWildcards")?e.value+"|^"+c+"$":e.value+" "+Language.ui.search.disjunction+" "+c,e.value=d,this.search(b)},this.jump=function(a){var b=location.href;location.href="#"+a,history.replaceState(null,null,b)},b()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";var edenfunctions={};SymbolMeta=function(a){this.symbol=a,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(a){var b=0,c=0,d=.1;for(var e in this.symbol.dependencies){b++,d+=(1-d)*SymbolMeta.DependencyComplexityRate;var f=e.substr(1);void 0!==a.meta[f]&&a.meta[f].interestingness>=a.minInteresting()&&c++}return d-=b*SymbolMeta.DependencyChangeProbability,0!=b&&(d=.5*d+c/b*.5),d<0?0:d},SymbolMeta.prototype.subscriberInterestingness=function(a){var b=0,c=0,d=0;for(var e in this.symbol.subscribers){b++,d+=(1-d)*SymbolMeta.SubscriberRate;var f=e.substr(1);void 0!==a.meta[f]&&a.meta[f].interestingness>=a.minInteresting()&&c++}return d=1-d,0!=b&&(d=.5*d+c/b*.5),d},SymbolMeta.prototype.nameInterestingness=function(){var a=this.symbol.name.substr(1);return"_"==a[0]?.5:/\d/.test(a)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(a){var b=0;b=this.dependencyInterestingness(a)*this.subscriberInterestingness(a)*this.nameInterestingness()*this.significance,this.interestingness=b},EdenUI.plugins.ObservableMining=function(a,b){var c=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];var d=function(a){return'<div class="symbolframer-results"></div>'};this.createDialog=function(a,b){var e=(a.slice(0,-7),$("<div></div>"));e.html(d()),c.symresults=e.find(".symbolframer-results")[0],$dialog=$('<div id="'+a+'"></div>').html(e).dialog({title:b,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var e=void 0,f=function(){if(void 0!==c.symresults){var a=$(c.symresults).parent();$(c.symresults).detach();for(var b=0;b<c.symbolsui.length;b++)if(c.symbolsui[b].meta.dodelete)c.symbolsui.splice(b,1);else if(0==c.symbolsui[b].meta.isinteresting){var d=c.symbolsui[b].element;c.symbolsui[b].element.hide("drop",{direction:"right"},"slow",function(){d.remove()}),c.symbolsui.splice(b,1)}for(var g=c.minInteresting(),h=c.maxInteresting(),b=0;b<c.interesting.length;b++){for(var i=!1,j=0;j<c.symbolsui.length;j++)if(c.symbolsui[j].meta==c.interesting[b]){i=!0;break}if(!i){var k=new EdenUI.plugins.ObservableMining.Symbol;c.symbolsui.push(k),k.element.appendTo(c.symresults),k.symbol=c.interesting[b].symbol;var l=k.symbol.name.substr(1);k.name=l,k.meta=c.interesting[b],k.outofdate=!0,k.symbolChanged=e}}for(var b=0;b<c.symbolsui.length;b++)c.symbolsui[b].update(g,h);$(c.symresults).appendTo(a)}for(var b=0;b<c.interesting.length;b++)c.interesting[b].interestingness*=SymbolMeta.DecayRate;setTimeout(f,c.delay)};f(),e=function(a,b){var d=a.name.substr(1),e=c.meta[d];if(void 0!==c.symresults){if(a.definition&&a.eden_definition){var f=a.eden_definition;if(/^proc\s/.test(f))return;if(/^func\s/.test(f))return;if("function"==typeof a.cache.value)return}else if("function"==typeof a.cache.value)return;if((b||void 0===e)&&(c.meta[d]=new SymbolMeta(a),e=c.meta[d]),e.update(c),0==e.isinteresting&&(c.interesting.sort(function(a,b){return b.interestingness-a.interestingness}),e.interestingness>=c.minInteresting())){c.interesting.length;if(c.interesting.length==c.limitInteresting){c.interesting[c.interesting.length-1].isinteresting=!1,c.interesting.pop()}c.interesting.push(e),e.isinteresting=!0,e.significance*=SymbolMeta.SigInterestingRate,c.interesting.sort(function(a,b){return b.interestingness-a.interestingness})}}},a.eden.root.addGlobal(e),a.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:a.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),b()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return this.interesting.length>0?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return this.interesting.length>0?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var a=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==a.editing&&(a.editing=!1,a.element.find("textarea").remove(),a.element.animate({height:"20px"},"fast"))}).click(function(){if(!a.editing){var b;b="function"==typeof a.symbol.value()&&void 0!==a.symbol.eden_definition?a.symbol.eden_definition:a.symbol.definition?a.symbol.eden_definition+";":a.name+" = "+Eden.edenCodeForValue(a.symbol.value())+";",a.element.animate({height:"60px"},{duration:200,complete:function(){var c=$('<textarea class="mine_edit_box" style="display: none"></textarea>');c.val(b),c.appendTo(a.element),c.show("fast")}}),a.editing=!0}}).draggable({distance:40,axis:"x",scroll:!1,drag:function(b,c){c.position.left>150?a.dodelete=!0:a.dodelete=!1},revert:function(b,c){return!a.dodelete},stop:function(b,c){a.dodelete&&(a.meta.significance*=SymbolMeta.SigDeleteRate,a.symbolChanged(a.symbol,!1),a.element.hide("drop",{direction:"right"},"slow",function(){a.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(a,b){if(void 0!==this.symbol){0==b&&(b=1);var c,d=(this.meta.interestingness-a)*(1/(b-a)),e=Math.round(8+12*d),f=this.symbol.value(),g=_formatFramerVal(f);c=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name;var h="<span>"+c+"</span><span class='result_separator'> = </span> <span class='result_value'>"+g+"</span>";if(void 0!==this.symbol.definition){var i=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);i=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+i+";</pre>"),h="<span onmouseenter='EdenUI.showTooltip(event, \""+i+"\")' onmouseleave='EdenUI.closeTooltip()'>"+h+"</span>"}var j=this.element.find(".observable");j.html(h),j.css({"font-size":e+"px"})}},EdenUI.plugins.ObservablePalette=function(a,b){function c(a){var b=a.value();return"function"!=typeof b||!/\breturn\s+([^\/;]|(\/[^\/*]))/.test(b.toString())}function d(a,b){var d=a.term,e=i[d];if(void 0===e){var f=new RegExp("^"+d);e=[];for(var g in root.symbols)f.test(g)&&c(root.symbols[g])&&e.push(g);i[d]=e}b(e)}function e(){var a=h;return h++,a}function f(b,c,d,g,h,i){function j(a){var b=a.target.value;if("hide"==b)return void h.remove(c,g,d);var e;"boolean"==b?e=!1:"number"==b?e=0:"string"==b&&(e=""),n.assign(e,Symbol.hciAgent,!0)}function k(a){oa.fadeOut(250,"linear",function(){a?(oa.html("true"),oa.css("color","green")):(oa.html("false"),oa.css("color","red")),oa.fadeIn(400,"swing",function(){x.html(a?"true":"false")})})}g?(g.hasClass("ui-accordion")&&g.accordion("destroy"),g.html("")):(g=$('<div class="observable-palette-obs-box observable-palette-visible" data-observable="'+c+'"></div>'),i&&g.data("editor","read-only"));var l,m=a.eden.root,n=m.lookup(c),o=n.value(),p=typeof o,q="string"==p,r=!i||q,s=n.eden_definition;if(!i&&void 0!==n.eden_definition){var t=s.match(/^\S+\s+is\s+(.*?);?$/);rhs=t[1],p="definition"}var u=$('<h3><span class="observable-palette-obs-heading">'+c+"</span> </h3>");i&&g.addClass("observable-palette-dependency-value-box");var v=$('<div class="observable-palette-heading-right"></div>');u.append(v),g.append(u);var w=Eden.prettyPrintValue("",o,128,!1,!1),x=$("<a>"+w+"</a>");v.append(x);var y=$("<select></select>");i?y.append('<option value="'+p+'">'+p[0].toUpperCase()+p.slice(1)+"</option>"):(y.append('<option value="number">Number</option>'),y.append('<option value="string">Text (String)</option>'),y.append('<option value="boolean">Yes/No (Boolean)</option>'),y.append('<option value="undefined">Undefined</option>')),y.append('<option value="hide">Hide</option>'),y[0].value=p,y.on("change",j),v.on("click",function(a){a.stopPropagation()}),x.on("click",function(a){x.detach(),v.append(y),y.focus()}),y.on("blur",function(a){y.detach(),v.append(x)});var z=$("<div></div>");if("definition"==p){var A=$('<div class="observable-palette-definition"></div>');A.append(c+" is "),rhsSpan=$('<span class="observable-palette-definition-rhs" contenteditable="true"></span>'),rhsSpan.append(Eden.htmlEscape(rhs)),A.append(rhsSpan),A.append(";"),A.on("click",function(a){rhsSpan.focus(),A.addClass("focussed")}),rhsSpan.on("blur",function(a){A.removeClass("focussed")}),z.append(A);var B=$('<div class="observable-palette-view-commands"> </div>');z.append(B);var C=$('<a onclick="">Expand</a>');C.click(function(){G.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",0)});var D=$('<a onclick="">Collapse</a>');D.click(function(){G.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",!1)});var E=$('<a onclick="">Hide</a>');E.click(function(){var a=G.find(".observable-palette-obs-box");a.removeClass("observable-palette-visible"),a.slideUp()});var F=$('<a onclick="">Show</a>');F.click(function(){var a=G.find(".observable-palette-obs-box");a.addClass("observable-palette-visible"),a.slideDown()}),B.append(C),B.append(D),B.append(E),B.append(F);var G=$('<div class="observable-palette-dependencies"></div>');G.sortable({connectWith:".observable-palette-column",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",tolerance:"pointer",receive:function(a,b){var d=b.item,e=d.data("observable");(!n.isDependentOn("/"+e)||e==c&&"read-only"!=d.data("editor"))&&b.sender.sortable("cancel"),2==G.children(".observable-palette-visible").length&&B.slideDown(),h.removeDuplicates(a.target,d)},remove:function(a,b){G.children(".observable-palette-visible").length<2&&B.slideUp()}});var H,I=0;for(var J in n.dependencies){var K=n.dependencies[J];J=J.slice(1),void 0===K.eden_definition&&(H=f(b,J,e(),void 0,h,!1),h.register(J,H),G.append(H),I++)}if(I<2&&B.hide(),l=function(a,e){var i=a.eden_definition;void 0===i?f(b,c,d,g,h,!1):x.html(Eden.prettyPrintValue("",e,128,!1,!1))},z.append(G),q){var L=f(b,c,e(),void 0,h,!0);G.append(L)}}else if("number"==p){var M,N,O;if(O=1==o||-1==o||o!=Math.floor(o)?5e-4:1,0==o)M=0,N=10;else if(o>=-1&&o<=1)M=o>0?0:-1,N=1;else if(o<0){M=2*o;var P=Number((-o%O).toPrecision(14));0!=P&&P!=O&&(M=M+P-O),N=M+2*(o-M)}else M=0,N=2*Math.ceil((o/O).toPrecision(16))*O;var Q=$('<input type="range" min="'+M+'" max="'+N+'" step="'+O+'" value="'+o+'" class="observable-palette-slider"/>'),R=Q[0];Q.on("input",function(a){
n.assign(parseFloat(R.value),Symbol.hciAgent,!0)});var S=$('<table class="observable-palette-number-controls"></table>'),T=$("<tr></tr>");S.append(T);var U=$('<td colspan="3" class="observable-palette-left-cell observable-palette-right-cell observable-palette-slider-cell"></td>');U.append(Q),T.append(U);var V=$('<tr class="observable-palette-limits"></tr>');S.append(V);var W=$('<td class="observable-palette-advanced observable-palette-left-cell"></td>'),X=$('<input type="number" value="'+M+'" step='+O+'" title="Smallest value"/>'),Y=X[0];W.append(X),V.append(W),X.on("input",function(a){var b=a.target.value;if(""!=b){var c=parseFloat(b);R.min=b;var d=n.value();c>=0&&d<c&&n.assign(c,Symbol.hciAgent,!0)}});var Z,_,aa=!1;X.on("focus",function(a){Z=a.target.value}),X.on("blur",function(a){var b=a.target.value;if(""==b)a.target.value=Z,R.min=Z;else{var c=parseFloat(b),d=parseFloat(R.max),e=parseFloat(R.step),f=c+Math.round((d-c)/e)*e;f<=c&&(f=c>0?c+Math.ceil((c/e).toPrecision(16))*e:Math.ceil((c/2/e).toPrecision(16))*e)<c+10*e&&(f=c+10*e),R.max=f,ia.value=f;n.value()<c&&n.assign(c,Symbol.hciAgent,!0)}});var ba=$('<td class="observable-palette-centre-cell"></td>');V.append(ba);var ca=$('<div class="observable-palette-number-centre"></div>');ba.append(ca);var da=$('<label><span class="observable-palette-label">Value&nbsp;</span></label>');ca.append(da);var ea=$('<input type="number" value="'+o+'" step='+O+'"/>'),fa=ea[0];da.append(ea),ea.on("input",function(a){var b=a.target.value;""!=b&&(R.value=b,n.assign(parseFloat(b),Symbol.hciAgent,!0))}),ea.on("focus",function(a){aa=!0,_=a.target.value}),ea.on("blur",function(a){if(""==a.target.value)n.assign(parseFloat(_),Symbol.hciAgent,!0);else{var b=n.value();b<parseFloat(R.min)&&(Y.value=b,R.min=b),R.value=b}aa=!1});var ga=$('<td  class="observable-palette-advanced observable-palette-right-cell"></td>'),ha=$('<input type="number" value="'+N+'" step='+O+'" title="Biggest value"/>'),ia=ha[0];ga.append(ha),V.append(ga),ha.on("input",function(a){R.max=a.target.value});var ja=$('<label class="observable-palette-advanced"><span class="observable-palette-label observable-palette-step-label">Step&nbsp;</span></label>');ca.append(ja);var ka=$('<input type="number" value="'+O+'" min="0" title="Slider step size"/>'),la=ka[0];la.acceptedValue=O,ja.append(ka),ka.on("input",function(a){var b=parseFloat(la.value);if(b>0){var c,d=Math.floor(b);if(b==d){var e=String(b).match(/(0*)$/);c=Math.pow(10,e[1].length)}else c=Math.pow(10,-((b-d).toPrecision(15).replace(/0*$/,"").length-2));b==c&&b<la.acceptedValue&&(c/=10),la.acceptedValue=b,la.step=c}}),ka.on("blur",function(a){var b=parseFloat(la.value);0==b?(la.value=1,la.acceptedValue=1):b<0||isNaN(b)?la.value=la.acceptedValue:(R.step=b,Y.step=b,ia.step=b,fa.step=b)}),l=function(a,e){if("number"!=typeof e||void 0!==a.eden_definition)f(b,c,d,g,h,i);else if(x.html(Eden.prettyPrintValue("",e,128,!1,!1)),!aa){var j,k,l,m=parseFloat(R.min),n=parseFloat(R.max),o=parseFloat(R.step);e<m?(0==e?j=0:e>0?(j=Math.ceil(e/2/o)*o-o,0!=(l=Number((e%o).toPrecision(14)))&&l!=o&&(j+=l)):(j=2*e,0!=(l=Number((-e%o).toPrecision(14)))&&l!=o&&(j=j+l-o)),R.min=j,Y.value=j,k=j+Math.round((n-j)/o)*o,R.max=k,ia.value=k):e>n&&(k=m+2*Math.ceil(((e-m)/o).toPrecision(16))*o,R.max=k,ia.value=k),R.value=e,fa.value=e}},z.append(S)}else if("boolean"==p){var ma=$('<input type="checkbox"/>'),na=ma[0],oa=$('<span class="bool_text"></span>');ma.on("change",function(a){var b=na.checked;n.assign(b,n.hciAgent,!0)}),l=function(a,e){!0!==e&&!1!==e||void 0!==a.eden_definition?f(b,c,d,g,h,i):(na.checked=e,k(e))},k(o);var pa=$('<label class="observable-palette-bool"></label>');pa.append(ma),pa.append(oa),z.append(pa)}else if("string"==p){var qa=$('<textarea class="string-input">'+o+"</textarea>"),ra=qa[0];qa.on("input",function(a){var b=ra.value;n.assign(b,Symbol.hciAgent,!0),ra.style.height="",ra.style.height=String(ra.scrollHeight+4)+"px"}),l=function(a,e){"string"!=typeof e||void 0!==a.eden_definition?f(b,c,d,g,h,i):(ra.value=e,ra.rows=e.split("\n").length,x.html(Eden.prettyPrintValue("",e,128,!1,!1)))},z.append($('<div class="quote left-quote">&ldquo;</div>')),z.append(qa),z.append($('<div class="quote right-quote">&rdquo;</div>'))}else if("undefined"==p){if(z.append($('<p><span class="result_name">'+c+"</span> is currently undefined.</p>")),!i){var sa=y.clone();sa[0].value="undefined",sa.on("change",j);var ta=$("<label>Choose type: </label>");ta.append(sa);var ua=$("<div></div>");ua.append(ta),z.append(ua)}l=function(a,e){void 0===e&&void 0===a.eden_definition||f(b,c,d,g,h,i)}}else l=function(a,e){void 0===e&&void 0===a.eden_definition||f(b,c,d,g,h,i)};return n.addJSObserver(b+"/"+c+"/"+d,l),r?(i&&z.find("input, textarea").attr("readonly","readonly"),g.append(z),g.accordion({active:"undefined"!=p&&void 0,collapsible:!0,heightStyle:"content"})):u.addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all observable-palette-static-header"),g.removeFromDialog=function(){h.remove(c,g,d)},g}function g(a,b){a.target.style.minWidth=b.size.width+"px"}var h=0,i={};root.addGlobal(function(a,b,d){if(d&&c(b)){var e=b.name.slice(1);for(var f in i)new RegExp("^"+f).test(e)&&i[f].push(e)}}),this.createDialog=function(b,c){function h(a,b){for(var c=b.data("observable"),d=b[0],e=p[c],f=0;f<e.length;f++){var g=e[f],h=g[0];if(h!==d&&h.parentNode===a){g.removeFromDialog();break}}}function i(a,b){var c=p[a];void 0===c&&(c=[],p[a]=c),c.push(b)}function j(c,d,g){function h(a){g?A[d].append(a):(0==d?z.after(a):A[d].prepend(a),a.hide(0,"linear",function(){a.slideDown(400)}))}if(a.eden.isValidIdentifier(c)){var i,j=p[c];if(void 0===j)j=[],p[c]=j;else for(var k=0;k<j.length;k++){var l=j[k];if(l[0].parentNode===A[d][0]){i=l;break}}void 0===i?(i=f(b,c,e(),void 0,G,!1),j.push(i),h(i)):i.slideUp(400,"swing",function(){i.detach(),h(i)})}}function k(a,c,d){var e=p[a];if(void 0!==e)for(var f=0;f<e.length;f++)e[f]===c&&e.splice(f,1);root.lookup(a).removeJSObserver(b+"/"+a+"/"+d),c.slideUp(400,"swing",function(){c.remove()})}function l(a){var c=p[a];if(c){var d=b+"/"+a+"/",e=d.length,f=root.lookup(a);for(var g in f.jsObservers)g.slice(0,e)==d&&f.removeJSObserver(g);for(var h=[],i=0;i<c.length;i++){var j=c[i];j[0].parentNode.parentNode===o[0]?j.slideUp(400,"swing",function(){j.remove()}):h.push(j)}p[a]=h}}var m=b.slice(0,-7),n=root.lookup("createView"),o=$('<div class="observable-palette" id="'+b+'"></div>'),p={},q=$('<input type="text" class="observable-palette-search-box" placeholder="observable name"/>'),r=q[0];q.on("keyup",function(a){13==a.which&&(j(r.value,0,!1),r.value="")}),q.autocomplete({minLength:2,source:d});var s=$('<button type="button">+</button>');s.click(function(){j(r.value,0,!1),r.value=""});var t=$('<button type="button">-</button>');t.on("click",function(a){l(r.value),r.value=""});var u=$("<label></label>"),v=$('<input type="checkbox"/>'),w=v[0];u.append(v),u.append(" Advanced");var x=root.lookup("_view_"+m+"_advanced"),y=x.value();void 0===y?(x.assign(!1,n),o.addClass("observable-palette-no-advanced")):y||o.addClass("observable-palette-no-advanced"),x.addJSObserver("repaintView",function(a,b){o.toggleClass("observable-palette-no-advanced",!b),w.checked=b}),v.on("change",function(a){x.assign(a.target.checked,n)});var z=$('<div class="observable-palette-toolbox"></div>');z.append(q),z.append(s),z.append(t),z.append(u);var A=[],B=7,C=root.lookup("_view_"+m+"_observables"),D=C.value();Array.isArray(D)&&(D.length>0&&!Array.isArray(D[0])&&(D=[D]),D.length>B&&(B=D.length));for(var E=0;E<B;E++){var F=$('<div class="observable-palette-column"></div>');F.sortable({connectWith:".observable-palette-column, .observable-palette-dependencies",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",scroll:!1,tolerance:"pointer",receive:function(a,b){h(a.target,b.item)}}),E<B-1&&F.resizable({handles:"e",resize:g}),A.push(F),o.append(F)}A[0].append(z);var G={register:i,remove:k,removeDuplicates:h};if(Array.isArray(D)){for(var H=!1,I=root.lookup("_view_"+m+"_search_language").value(),J=[],K=0;K<D.length;K++){var L=D[K];if(J[K]=[],Array.isArray(L))for(var M=0;M<L.length;M++){var N=L[M];if(a.eden.isValidIdentifier(N)&&!/[\\*+?^$|({[]|(\s+or\s+)/i.test(N))j(N,K,!0);else{var O=a.regExpFromStr(N,"",!0,I);J[K].push(O),H=!0}}}if(H)for(name in root.symbols)for(var K=0;K<J.length;K++)for(var P=J[K],M=0;M<P.length;M++){var O=P[M];if(O.test(name)){j(name,K,!0);break}}}o.dialog({title:c,width:260,height:400+a.scrollBarSize})},a.views.ObservablePalette={dialog:this.createDialog,title:"Observable Palette",category:a.viewCategories.interpretation},b()},EdenUI.plugins.ObservablePalette.title="Observable Palette",EdenUI.plugins.ObservablePalette.description="Provides the ability to change observables using a simple form.",EdenUI.plugins.ScriptGenerator=function(a,b){var c=this;this.createDialog=function(a,b){var d=(a.slice(0,-7),$('<div class="script-generator"></div>')),e=($("<div></div>"),$('<div class="script-generator-controls"></div>'),$('<div class="script-generator-controls" style="float: right"></div>'),$('<div class="script-generator-code readonly" spellcheck="false"></div>'));d.append(e);var f=$('<button class="script-generator-refresh">&#xf021;</button>');d.append(f);var g={};e.on("click",".scriptgen-importex",function(a){var b=a.currentTarget.getAttribute("data-agent");g[b]?g[b]=!1:g[b]=!0,h()});var h=function(){e.html("");for(var a=c.generateScriptLines(g),b=0;b<a.imports.length;b++)if(""!=a.imports[b]){var d=a.imports[b].split(" ")[1].split("@")[0],f=a.imports[b].split(" "),h='<span class="eden-keyword">'+f[0]+'</span> <span class="eden-path">'+f[1]+"</span>";if(f.length>2)for(var i=2;i<f.length;i++)h+=" "+f[i];var j=$('<div class="eden-line"><span class="scriptgen-importex" data-agent="'+d+'">'+(g[d]?"&#xf055;":"&#xf056;")+"</span><span>"+(g[d]?'<span class="eden-comment">## '+a.imports[b]+"</span>":h)+"</span></div>");e.append(j)}e.append($('<div class="eden-line"></div>'));var k=$("<div></div>");e.append(k);var l=a.definitions.join("\n")+"\n## When agents\n\n"+a.agents,m=new Eden.AST(l,void 0,{name:"*JavaScript"});new EdenUI.Highlight(k.get(0)).highlight(m,-1,-1)};f.click(function(){h()}),h(),$('<div id="'+a+'"></div>').html(d).dialog({appendTo:"#jseden-views",title:b,width:790,height:700,minHeight:120,minWidth:230,dialogClass:"scriptgen-dialog"})};this.generateScriptLines=function(a){var b={},c=Eden.Generator.importsScript().split("\n");b.imports=c;var d=Eden.Generator.symbolScript(a).split("\n");b.definitions=d;var e=Eden.Agent.getActiveAgents(a,!1);return b.agents=e,b},this.baseConstrualSymbols={},this.changeListener=function(a,b){var d=a.last_modified_by;if(!b&&"include"!=d){var e=a.name.slice(1);void 0!==a.eden_definition&&void 0!==a.definition?c.baseConstrualSymbols[e]={eden_definition:a.eden_definition,last_modified_by:d}:c.baseConstrualSymbols[e]={cached_value:a.cached_value,last_modified_by:d}}},a.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(a,b){root.removeGlobal(c.changeListener)}),this.baseConstrualURL="",a.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:a.viewCategories.history},b()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(a){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(a,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=a)})},function(){"use strict";var a,b=this;a="undefined"!=typeof exports?exports:b.Springy={};var c=a.Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]},d=a.Node=function(a,b){this.id=a,this.data=void 0!==b?b:{}},e=a.Edge=function(a,b,c,d){this.id=a,this.source=b,this.target=c,this.data=void 0!==d?d:{}};c.prototype.addNode=function(a){return a.id in this.nodeSet||this.nodes.push(a),this.nodeSet[a.id]=a,this.notify(),a},c.prototype.addNodes=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=new d(b,{label:b});this.addNode(c)}},c.prototype.addEdge=function(a){var b=!1;return this.edges.forEach(function(c){a.id===c.id&&(b=!0)}),b||this.edges.push(a),a.source.id in this.adjacency||(this.adjacency[a.source.id]={}),a.target.id in this.adjacency[a.source.id]||(this.adjacency[a.source.id][a.target.id]=[]),b=!1,this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===c.id&&(b=!0)}),b||this.adjacency[a.source.id][a.target.id].push(a),this.notify(),a},c.prototype.addEdges=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=this.nodeSet[b[0]];if(void 0==c)throw new TypeError("invalid node name: "+b[0]);var d=this.nodeSet[b[1]];if(void 0==d)throw new TypeError("invalid node name: "+b[1]);var e=b[2];this.newEdge(c,d,e)}},c.prototype.newNode=function(a){var b=new d(this.nextNodeId++,a);return this.addNode(b),b},c.prototype.newEdge=function(a,b,c){var d=new e(this.nextEdgeId++,a,b,c);return this.addEdge(d),d},c.prototype.loadJSON=function(a){("string"==typeof a||a instanceof String)&&(a=JSON.parse(a)),("nodes"in a||"edges"in a)&&(this.addNodes.apply(this,a.nodes),this.addEdges.apply(this,a.edges))},c.prototype.getEdges=function(a,b){return a.id in this.adjacency&&b.id in this.adjacency[a.id]?this.adjacency[a.id][b.id]:[]},c.prototype.removeNode=function(a){a.id in this.nodeSet&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;b>=0;b--)this.nodes[b].id===a.id&&this.nodes.splice(b,1);this.detachNode(a)},c.prototype.detachNode=function(a){this.edges.slice().forEach(function(b){try{b.source.id!==a.id&&b.target.id!==a.id||this.removeEdge(b)}catch(a){}},this),this.notify()},c.prototype.removeEdge=function(a){for(var b=this.edges.length-1;b>=0;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency){for(var d in this.adjacency[c]){for(var e=this.adjacency[c][d],f=e.length-1;f>=0;f--)this.adjacency[c][d][f].id===a.id&&this.adjacency[c][d].splice(f,1);0==this.adjacency[c][d].length&&delete this.adjacency[c][d]}i(this.adjacency[c])&&delete this.adjacency[c]}this.notify()},c.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new d(a.id,a.data)))},this),a.edges.forEach(function(a){var c=b[a.from],d=b[a.to],f=a.directed?f=a.type+"-"+c.id+"-"+d.id:c.id<d.id?a.type+"-"+c.id+"-"+d.id:a.type+"-"+d.id+"-"+c.id;this.addEdge(new e(f,c,d,a.data)).data.type=a.type},this)},c.prototype.filterNodes=function(a){this.nodes.slice().forEach(function(b){a(b)||this.removeNode(b)},this)},c.prototype.filterEdges=function(a){this.edges.slice().forEach(function(b){a(b)||this.removeEdge(b)},this)},c.prototype.addGraphListener=function(a){this.eventListeners.push(a)},c.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var f=a.Layout={};f.ForceDirected=function(a,b,c,d){this.graph=a,this.stiffness=b,this.repulsion=c,this.damping=d,this.nodePoints={},this.edgeSprings={}},f.ForceDirected.prototype.point=function(a){if(!(a.id in this.nodePoints)){var b=void 0!==a.data.mass?a.data.mass:1;this.nodePoints[a.id]=new f.ForceDirected.Point(g.random(),b)}return this.nodePoints[a.id]},f.ForceDirected.prototype.spring=function(a){if(!(a.id in this.edgeSprings)){var b=void 0!==a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);if(d.forEach(function(a){!1===c&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this),!1!==c)return new f.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);if(d.forEach(function(a){!1===c&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this),!1!==c)return new f.ForceDirected.Spring(c.point2,c.point1,0,0);this.edgeSprings[a.id]=new f.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,this.stiffness)}return this.edgeSprings[a.id]},f.ForceDirected.prototype.eachNode=function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})},f.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})},f.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})},f.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,c){if(b!==c){var d=b.p.subtract(c.p),e=d.magnitude()+.1,f=d.normalise();b.applyForce(f.multiply(this.repulsion).divide(e*e*.5)),c.applyForce(f.multiply(this.repulsion).divide(e*e*-.5))}})})},f.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),d=b.normalise();a.point1.applyForce(d.multiply(a.k*c*-.5)),a.point2.applyForce(d.multiply(a.k*c*.5))})},f.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(this.repulsion/50))})},f.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping),c.a=new g(0,0)})},f.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})},f.ForceDirected.prototype.totalEnergy=function(a){var b=0;return this.eachNode(function(a,c){var d=c.v.magnitude();b+=.5*c.m*d*d}),b};a.requestAnimationFrame=function(a,b){return function(){return a.apply(b,arguments)}}(b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a,c){b.setTimeout(a,10)},b),f.ForceDirected.prototype.start=function(b,c){var d=this;this._started||(this._started=!0,this._stop=!1,a.requestAnimationFrame(function e(){d.applyCoulombsLaw(),d.applyHookesLaw(),d.attractToCentre(),d.updateVelocity(.03),d.updatePosition(.03),void 0!==b&&b(),d._stop||d.totalEnergy()<.01?(d._started=!1,void 0!==c&&c()):a.requestAnimationFrame(e)}))},f.ForceDirected.prototype.stop=function(){this._stop=!0},f.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;return this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();(null===b.distance||f<b.distance)&&(b={node:d,point:e,distance:f})}),b},f.ForceDirected.prototype.getBoundingBox=function(){var a=new g(-2,-2),b=new g(2,2);this.eachNode(function(c,d){d.p.x<a.x&&(a.x=d.p.x),d.p.y<a.y&&(a.y=d.p.y),d.p.x>b.x&&(b.x=d.p.x),d.p.y>b.y&&(b.y=d.p.y)});var c=b.subtract(a).multiply(.07);return{bottomleft:a.subtract(c),topright:b.add(c)}};var g=a.Vector=function(a,b){this.x=a,this.y=b};g.random=function(){return new g(10*(Math.random()-.5),10*(Math.random()-.5))},g.prototype.add=function(a){return new g(this.x+a.x,this.y+a.y)},g.prototype.subtract=function(a){return new g(this.x-a.x,this.y-a.y)},g.prototype.multiply=function(a){return new g(this.x*a,this.y*a)},g.prototype.divide=function(a){return new g(this.x/a||0,this.y/a||0)},g.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},g.prototype.normal=function(){return new g(-this.y,this.x)},g.prototype.normalise=function(){return this.divide(this.magnitude())},f.ForceDirected.Point=function(a,b){this.p=a,this.m=b,this.v=new g(0,0),this.a=new g(0,0)},f.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))},f.ForceDirected.Spring=function(a,b,c,d){this.point1=a,this.point2=b,this.length=c,this.k=d};var h=a.Renderer=function(a,b,c,d){this.layout=a,this.clear=b,this.drawEdge=c,this.drawNode=d,this.layout.graph.addGraphListener(this)};h.prototype.graphChanged=function(a){this.start()},h.prototype.start=function(){var a=this;this.layout.start(function(){a.clear(),a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)}),a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})},h.prototype.stop=function(){this.layout.stop()},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}});var i=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}}.call(this),function(){jQuery.fn.springy=function(a){function b(a,b,c,d){var e=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0===e)return!1;var f=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/e,g=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/e;return!(f<0||f>1||g<0||g>1)&&new Springy.Vector(a.x+f*(b.x-a.x),a.y+f*(b.y-a.y))}function c(a,c,d,e,f){var g,h={x:d.x,y:d.y},i={x:d.x+e,y:d.y},j={x:d.x,y:d.y+f},k={x:d.x+e,y:d.y+f};return(g=b(a,c,h,i))?g:(g=b(a,c,i,k))?g:(g=b(a,c,k,j))?g:!!(g=b(a,c,j,h))&&g}var d=this.graph=a.graph||new Springy.Graph,e=a.stiffness||100,f=a.repulsion||5e3,g=a.damping||.5,h=a.nodeSelected||null,i=this[0],j=i.getContext("2d"),k=this.layout=new Springy.Layout.ForceDirected(d,e,f,g),l=k.getBoundingBox(),m={bottomleft:new Springy.Vector(-2,-2),topright:new Springy.Vector(2,2)};Springy.requestAnimationFrame(function a(){m=k.getBoundingBox(),l={bottomleft:l.bottomleft.add(m.bottomleft.subtract(l.bottomleft).divide(10)),topright:l.topright.add(m.topright.subtract(l.topright).divide(10))},Springy.requestAnimationFrame(a)});var n=function(a){var b=l.topright.subtract(l.bottomleft),c=a.subtract(l.bottomleft).divide(b.x).x*i.width,d=a.subtract(l.bottomleft).divide(b.y).y*i.height;return new Springy.Vector(c,d)},o=function(a){var b=l.topright.subtract(l.bottomleft),c=a.x/i.width*b.x+l.bottomleft.x,d=a.y/i.height*b.y+l.bottomleft.y;return new Springy.Vector(c,d)},p=null,q=null,r=null;jQuery(i).mousedown(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});p=q=r=k.nearest(c),null!==p.node&&(r.point.m=1e4,h&&h(p.node)),s.start()}),jQuery(i).dblclick(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});p=k.nearest(c),node=p.node,node&&node.data&&node.data.ondoubleclick&&node.data.ondoubleclick()}),jQuery(i).mousemove(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});q=k.nearest(c),null!==r&&null!==r.node&&(r.point.p.x=c.x,r.point.p.y=c.y),s.start()}),jQuery(window).bind("mouseup",function(a){r=null}),Springy.Node.prototype.getWidth=function(){var a=void 0!==this.data.label?this.data.label:this.id;if(this._width&&this._width[a])return this._width[a];j.save(),j.font="16px Verdana, sans-serif";var b=j.measureText(a).width+10;return j.restore(),this._width||(this._width={}),this._width[a]=b,b},Springy.Node.prototype.getHeight=function(){return 20};var s=this.renderer=new Springy.Renderer(k,function(){var a=i.parentNode;null!==a&&(i.height=a.clientHeight,i.width=a.clientWidth),j.clearRect(0,0,i.width,i.height)},function(a,b,e){for(var f=n(b).x,g=n(b).y,h=n(e).x,i=n(e).y,k=new Springy.Vector(h-f,i-g),l=k.normal().normalise(),m=d.getEdges(a.source,a.target),o=d.getEdges(a.target,a.source),p=m.length+o.length,q=0,r=0;r<m.length;r++)m[r].id===a.id&&(q=r);var s=l.multiply(-0*(p-1)/2+0*q),t=n(b).add(s),u=n(e).add(s),v=a.target.getWidth(),w=a.target.getHeight(),x=c(t,u,{x:h-v/2,y:i-w/2},v,w);x||(x=u);var y,z=void 0!==a.data.color?a.data.color:"#C0C0C0";y="dashes"in a.data?a.data.dashes:[];var A,B,C=void 0!==a.data.weight?a.data.weight:1;j.lineWidth=Math.max(3*C,.1),A=1+j.lineWidth,B=8;var D,E=void 0===a.data.directional||a.data.directional;D=E?x.subtract(k.normalise().multiply(.5*B)):u,j.strokeStyle=z,j.setLineDash(y),j.beginPath(),j.moveTo(t.x,t.y),j.lineTo(D.x,D.y),j.stroke(),E&&(j.save(),j.fillStyle=z,j.translate(x.x,x.y),j.rotate(Math.atan2(i-g,h-f)),j.beginPath(),j.moveTo(-B,A),j.lineTo(0,0),j.lineTo(-B,-A),j.lineTo(.8*-B,-0),j.closePath(),j.fill(),j.restore()),void 0!==a.data.label&&(text=a.data.label,j.save(),j.textAlign="center",j.textBaseline="top",j.font="10px Helvetica, sans-serif",j.fillStyle="#5BA6EC",j.fillText(text,(f+h)/2,(g+i)/2),j.restore())},function(a,b){var c=n(b);j.save();var e=a.getWidth();a.getHeight();j.fillStyle="#FFFFFF",j.fillRect(c.x-e/2,c.y-10,e,20),j.setLineDash([]),j.textAlign="left",j.textBaseline="top",j.font="16px Verdana, sans-serif";var f=void 0!==a.data.label?a.data.label:a.id,g=root.lookup(f).eden_definition;void 0==g?j.fillStyle="#0000FF":0==g.toString().indexOf("proc")?j.fillStyle="#FF0000":0==g.toString().indexOf("func")?j.fillStyle="#336600":j.fillStyle="#0000FF",d.re.test(f)&&(j.lineWidth=1,j.strokeStyle="#000000",j.strokeRect(c.x-e/2,c.y-10,e,20)),j.fillText(f,c.x-e/2+5,c.y-8),j.restore()});return s.start(),this}}(),EdenUI.plugins.DependencyMap=function(a,b){var c=this;this.createDialog=function(b,d){function e(){var b;b=""==k.value?/^$/:a.regExpFromStr(j,"",m.checked),c.updateGraph(f,b)}var f=void 0;f=new Springy.Graph,f.previousNodes=[],f.previousEdges=[],f.newNodes=[],f.newEdges=[];var g=$('<div id="'+b+'" style="overflow: hidden"></div>'),h=$("<canvas></canvas>").springy({graph:f,nodeSelected:function(a){}});g.append(h);var i=$('<div class="dependency-map-controls"></div>');g.append(i);var j=$('<input type="text" placeholder="search"/>'),k=j.get(0),l=$('<input type="checkbox" checked="checked"/>'),m=l.get(0);i.append(j),i.append($("<label>Exact matches only </label>").append(l)),j.on("input",e),l.on("change",e),g.on("mouseenter",e),g.dialog({appendTo:"#jseden-views",title:d,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(a,b){a.re=b,a.newNodes=[],a.newEdges=[];for(var c in root.symbols){var d=root.symbols[c],e=d.name;if(b.test(e)){-1==a.newNodes.indexOf(e)&&a.newNodes.push(e);var f=d.dependencies;for(var g in f){var h=f[g].name;-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!1])}f=d.dynamicDependencies;for(var g in f){var h=f[g].name;-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!0])}f=d.observees;for(var g in f){var h=f[g].name;-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!1])}var i=d.subscribers;for(var g in i){var j=i[g],h=j.name;-1==a.newNodes.indexOf(h)&&a.newNodes.push(h);var k=d.name in j.dynamicDependencies;a.newEdges.push([e,h,k])}i=d.observers;for(var g in i){var h=i[g].name;-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([e,h,!1])}}}if(!arrayCompare(a.previousNodes,a.newNodes)||!arrayCompare(a.previousEdges,a.newEdges)){a.previousNodes=a.newNodes,a.previousEdges=a.newEdges,a.filterEdges(function(a){return!1}),a.filterNodes(function(a){return!1}),a.nodeObjectsStore={};for(var c in a.previousNodes){var l=a.previousNodes[c];a.nodeObjectsStore[l]=a.newNode({label:l},{color:"#6A4A3C"})}for(var g in a.previousEdges){var m=a.previousEdges[g][0],n=a.previousEdges[g][1],o={};a.previousEdges[g][2]&&(o.dashes=[10,10]),a.newEdge(a.nodeObjectsStore[m],a.nodeObjectsStore[n],o)}}},a.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:a.viewCategories.comprehension,menuPriority:2},b()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler",EdenUI.plugins.StateTimeLine=function(a,b){var c=this;this.createDialog=function(b,e){c.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+b+'-content" class="st-content"></div>').append($('<input id="'+b+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){c.ST.states.push(d("partial"));var e=document.getElementById(b+"-regex").value;""==e&&(e="State "+c.ST.nextBlankState),$("#"+b+"-content-states").append("<div id='stdiv"+a.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+e+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+a.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+a.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(b+"-regex").value="",a.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+b+'-content-states"></div>')),$dialog=$('<div id="'+b+'"></div>').html(code_entry).dialog({title:e,width:300,height:450,minHeight:120,minWidth:230})},c.ST={},c.ST.states=[],c.ST.nextBlankState=0,this.deleteState=function(a){$(document.getElementById("stdiv"+a)).remove()},this.changeState=function(b){for(var c in root.symbols)Eden.isitSystemSymbol(root.symbols[c].name.substring(1,root.symbols[c].name.length))||a.plugins.StateTimeLine.ignoreRE.test(root.symbols[c].name.substring(1,root.symbols[c].name.length))||delete root.symbols[c];a.plugins.ScriptInput.submitEdenCode(a.plugins.StateTimeLine.ST.states[b])};var d=function(b){var c=[],d=[],e=[],f=[],g=root.lookup("picture").eden_definition;void 0==g?g="picture is [];":g+=";";for(var h in root.symbols){var i=5,j=root.symbols[h],k=j.eden_definition;if(void 0==k&&(k="@"),0==k.indexOf("proc")){if("(Action)",i=2,"partial"==b&&Eden.isitSystemAgent(h))continue}else if(0==k.indexOf("func")){if("(Function)",i=1,"partial"==b&&Eden.isitSystemFunction(h))continue}else if("(Observable)",i=0,"partial"==b&&Eden.isitSystemObservable(h))continue;var l=Eden.edenCodeForValue(j.cached_value);if(!a.plugins.StateTimeLine.ignoreRE.test(h))if(1==i)f.push(k);else if(0==i){if("@"==l&&"@"==k)continue;"@"==k?d.push(h+" = "+l+";"):c.push(k+";")}else 2==i?e.push(k):console.log("oh dear error")}var m=[];m.push("autocalc = 0;");for(var n=0;n<d.length;n++)m.push(d[n]);for(var n=0;n<c.length;n++)m.push(c[n]);for(var n=0;n<e.length;n++)m.push(e[n]),m.push("");for(var n=0;n<f.length;n++)m.push(f[n]),m.push("");return m.push(g),m.push("autocalc = 1;"),m.join("\n")};a.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:a.viewCategories.history},b()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(a,b){this.createDialog=function(b,c){var d={confirmClose:!1};return $dialog=$('<div id="'+b+'"></div>').html('<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>').dialog({title:c,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){function b(b){var c=a.eden.root,d=c.lookup("definitionOf").definition(c)(b);e.send(d)}if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void console.log("WebSockets not supported");var c="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",e=new WebSocket(c);eden.listenTo("executeBegin",this,function(a,b){"net"!=a&&e.send(b)}),eden.listenTo("beforeAssign",this,function(a,b,c){"net"!=c&&e.send(a.name.slice(1)+"="+Eden.edenCodeForValue(b)+";")}),$("#sl-status").html("<p>Connected to: "+c+"</p>"),e.onerror=function(a){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+c+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),d.confirmClose=!1},
e.onmessage=function(a){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(a.data)+"</p>"),eden.execute(a.data,"net","",{name:"/execute"},noop)},e.onopen=function(){d.confirmClose=!0,randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):b("randomSeed"),b("randomGenerator")}}),d},a.views.StateListener={dialog:this.createDialog,title:"State Listener",category:a.viewCategories.extension},a.eden.include("plugins/state-listener/state-listener.js-e",b)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(a,b){function c(){h=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")}function d(){eden.root.lookup("network_address").assign($("#nr-ipaddr").val(),eden.root.scope),eden.root.lookup("network_port").assign($("#nr-port").val(),eden.root.scope),eden.root.lookup("network_key").assign($("#nr-key").val(),eden.root.scope),f.connect()}var e,f=this,g=!1,h=!1;Eden.Agent.importAgent("lib/dynamic","default",void 0,function(){}),f.connect=function(){function b(b){var c=a.eden.root,d=c.lookup("definitionOf").definition(c)(b);j.send(JSON.stringify({code:d}))}var c=eden.root.lookup("network_address").value(),d=eden.root.lookup("network_port").value(),g=eden.root.lookup("network_key").value();if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void console.log("WebSockets not supported");var i="ws://"+c+":"+d+"/",j=new WebSocket(i);Eden.Agent.listenTo("executeline",this,function(a,b){if(a){var c=JSON.stringify({action:"executeline",name:a.name,lineno:b});j.send(c)}}),Eden.Agent.listenTo("patch",this,function(a,b,c){if(a){var d=JSON.stringify({action:"patch",name:a.name,patch:b,lineno:c});j.send(d)}}),Eden.Agent.listenTo("owned",this,function(a,b){"net"!=b&&j.send(JSON.stringify({action:"ownership",name:a.name,owned:a.owned}))}),eden.listenTo("beforeAssign",this,function(a,b,c){"net"!=c&&(console.log("ASSIGN: "+a.name+" = "+Eden.edenCodeForValue(b)),j.send(JSON.stringify({action:"assign",symbol:a.name.slice(1),value:b})))}),$("#nr-status").html("<p>Connected to: "+i+"</p>"),j.onopen=function(c){j.send(g),randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):b("randomSeed"),b("randomGenerator"),h=!0;for(var d in Eden.Agent.agents)Eden.Agent.agents[d].owned&&j.send(JSON.stringify({action:"ownership",name:d,owned:!0}));eden.root.lookup("network_connected").assign(!0,eden.root.scope)},j.onerror=function(a){h=!1,eden.root.lookup("network_connected").assign(!1,eden.root.scope),eden.root.lookup("network_error").assign(a,eden.root.scope)},j.onclose=function(){eden.root.lookup("network_connected").assign(!1,eden.root.scope)},f.sendControl=function(a,b){console.log("Send Control: "+a+"= "+b),console.log(b),j.send(JSON.stringify({action:"control",key:a,value:b}))},f.sendAssign=function(a){"net"!=a.last_modified_by&&j.send(JSON.stringify({action:"assign",symbol:a.name.slice(1),value:a.value()}))},j.onmessage=function(a){e=JSON.parse(a.data);for(var b=0;b<e.length;b++)switch(line=e[b].code,line.action){case"patch":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(a){a.applyPatch(line.patch,line.lineno)});break;case"ownership":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(a){a.setOwned(line.owned,"net")});break;case"executeline":Eden.Agent.importAgent(line.name,"default",["noexec"],function(a){a.executeLine(line.lineno,!0)});break;case"assign":eden.root.lookup(line.symbol).assign(line.value,eden.root.scope,{name:"net"})}}},this.createDialog=function(a,b){var e={confirmClose:!1};return $dialog=$('<div id="'+a+'"></div>').html('<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>').dialog({title:b,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){h?c():d()}),e},this.playCode=function(a){if(void 0===e[a])return void $("#nr-status").html("<p>Replay finished</p>");var b=e[a].time/$("#nr-speedrange").val();b>1e3?($("#nr-status").html("<p>Next line in "+b+" milliseconds</p>"),g=!0):g&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(e[a].code,"net","",{name:"/execute"},noop),f.playCode(a+1)},b)},a.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:a.viewCategories.extension},a.eden.include("plugins/network-remote/network-remote.js-e",b),eden.root.lookup("plugins_network_loaded").assign(!0,eden.root.scope)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(a,b){var c="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");var d=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(d);var d=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(d),this.name="window_name",this.createDialog=function(b,d){""==c&&(c=b);var e=[];viewlayoutstr="View Layout";var f=5*a.gridSizeY,g=3*a.gridSizeX,h=[],i=root.lookup("_views_list").value(),j=this.name;i.forEach(function(b){if(b!=j){var c=root.lookup("_view_"+b+"_x").value(),d=root.lookup("_view_"+b+"_y").value();c=void 0!==c?c:0,d=void 0!==d?d:0,h=[b,c,d,root.lookup("_view_"+b+"_width").value()+a.scrollBarSize,root.lookup("_view_"+b+"_height").value()+a.titleBarHeight,root.lookup("_view_"+b+"_title").value()],console.log(h),e.push(h)}});var k="";e.forEach(function(a,b){k+='<li data-row="'+Math.round(a[2]/f)+'" data-col="'+Math.round(a[1]/g)+'" data-sizex="'+Math.round(a[3]/(1*g))+'" data-sizey="'+Math.round(a[4]/(1*f))+'" data-name="'+a[0]+'" data-num="'+b+'">'+a[5]+" ["+a[0]+"]</li>"});var l='<a class="vl-update">Update</a><div class="gridster"><ul>'+k+"</ul></div>";$dialog=$('<div id="'+b+'"></div>').html(l).dialog({title:d,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[g,f],widget_margins:[0,0],min_cols:Math.round($(window).width()/g),max_cols:Math.round($(window).width()/g),helper:"clone",resize:{enabled:!0},serialize_params:function(a,b){return{col:b.col,row:b.row,size_x:b.size_x,size_y:b.size_y,name:b.name,name:$(b.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var b=gridster.serialize(),c=1,d=1;b.forEach(function(a,b){a.col<c&&(c=a.col),a.row<d&&(d=a.row)}),b.forEach(function(b,e){var h="_view_"+b.name+"_y = "+(b.row-d)*f+";_view_"+b.name+"_x = "+(b.col-c)*g+";_view_"+b.name+"_width = "+(b.size_x*g-a.dialogFrameWidth)+";_view_"+b.name+"_height = "+(b.size_y*f-a.dialogFrameHeight)+";";console.log(h),eden.execute(h)})})},a.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:a.viewCategories.environment},b()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(a,b){function c(a,b,c){this.edenVar=a,this.guard=b,this.actions=c}function d(a,b,c,d){this.name=a,this.parameters=b,this.definitions=c,this.actionsArr=d}function e(a,b,c){this.name=a,this.definitions=b,this.actionsArr=c,this.queuedActions=new Array}var f=this;this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(a,b,c,d,e){F(a)}}),c.prototype.toString=function(){return this.guard+" --\x3e "+this.actions},d.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};var g=function(a,b){for(var d=new Array,e=0;e<b.length;e++){var f=new String(b[e]),g=f.split("--\x3e");if(2==g.length){var h="this_g"+d.length;d.push(new c(h,g[0],g[1]))}}return d},h=function(a){var b,c=new Array;a.split("(").length<2?b=a:(c=a.split("(")[1].split(")")[0].split(","),b=a.split("(")[0]);var d=document.getElementById("adm-definitions"),e=[];d.value.length>0&&(e=d.value.split("\n"));var d=document.getElementById("adm-actions"),f=d.value.split("\n"),h=g(0,f);return E(b,c,e,h),0},i=function(){for(var a=document.getElementById("adm-name"),b=a.value.split("(")[0],c=!0,d=0;d<f.templates.length;d++){f.templates[d].name==b&&(c=!1)}if(b&&c){-1!=h(a.value)&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",f.currIndex=-1)}else alert("Please enter a unique name for this template."),a.focus()},j=function(a){if(a<-1?a=f.templates.length-1:a>=f.templates.length&&(a=-1),-1==a)document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="";else{var b=f.templates[a];document.getElementById("adm-name").value=b.name,document.getElementById("adm-definitions").value=b.definitions.join("\n"),document.getElementById("adm-actions").value=b.actionsArr.join("\n")}f.currIndex=a},k=function(a){a>-1&&(alert("Deleting template "+f.templates[a].name),f.templates.splice(a),f.currIndex=a-1,j(f.currIndex))},l=function(a){return'<div id="'+a+'-input" class="adm-input-code">\t\t\t<div>Name:</div>\t\t\t<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>\t\t\t<div>Definitions:</div>\t\t\t<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>\t\t\t<div>Actions:</div>\t\t\t<div><textarea id="adm-actions" class="adm-actions"></textarea></div>\t\t</div>\t\t<div id="adm-results" class="entitylist-results">\t\t\t<ul id="results"> </ul>\t\t</div>'};this.createTemplateCreator=function(a,b){var c=$("<div></div>");c.html(l(a)),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){i()}},{id:"btn-delete",text:"Delete Template",click:function(){k(f.currIndex)}},{text:"Previous",click:function(){j(f.currIndex-1)}},{text:"Next",click:function(){j(f.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};var m=function(a,b){var c=new Array;for(x in b){var d=b[x];c.push(d.replace(/this/g,a))}return c},n=function(a,b){var d=new Array;for(x in b){var e=b[x],f=e.guard.replace(/this/g,a),g=e.actions.replace(/this/g,a),h=e.edenVar.replace(/this/g,a);d.push(new c(h,f,g))}return d},o=function(a,b){a.value="";for(x in b)b[x].value=""},p=function(a){var b;for(x in f.templates)if(f.templates[x].name==a){b=f.templates[x];break}return b},q=function(){for(var a=document.getElementById("template-menu"),b=a.options[a.selectedIndex].value,c=p(b),d=document.getElementById("entity-name"),e=d.value,g=!0,h=0;h<f.entities.length;h++){f.entities[h].name==e&&(g=!1)}if(0==g)return void alert("please enter a unique name for this instantiation");var i=$("#instantiate-params"),j=i.find("input"),k=0,l=new Array;for(x in j){var n=j[x];if("text"==n.type){var q=C(c.parameters[k]),s=C(n.value);l.push(n),eden.executeEden(e+"_"+q+" is "+s+";"),k++}}var t=m(e,c.definitions);-1!=r(e,t)&&(u(e,t,c.actionsArr),alert("Successfully added instantiation of "+b+" as "+e),o(d,l))},r=function(a,b){a=C(a);for(var c=0;c<b.length;c++){var d=C(b[c]);eden.executeEden(a+"_"+d),f.definitions.push(a+"_"+d)}};this.createInstantiator=function(a,b){var c=$("<div></div>");c=$('<div id="template-instantiator">\t\t\t\t\t<div>Templates:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<select id="template-menu">\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t\t<div>Entity name:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<textarea id="entity-name"></textarea>\t\t\t\t\t</div>\t\t\t\t\t<div>Parameters:</div>\t\t\t\t\t<div id="instantiate-params"></div>\t\t\t\t</div>'),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){q()}}]}),f.templateList=new EdenUI.plugins.ADM.TemplateList;for(x in f.templates){var d=f.templates[x];f.templateList.addTemplate(d.name,d.parameters)}};var s=function(a){var b,c;for(x in f.entities)if(f.entities[x].name==a){b=f.entities[x],c=x;break}if(null==b)return void alert(a+" doesn't exist to delete.");f.entities.splice(c,1);for(x in f.actionLists)if(f.actionLists[x].entityName==a){c=x,f.actionLists[x].remove();break}null!=f.actionLists&&f.actionLists.splice(c,1),null!=f.entityList&&f.entityList.removeEntity(a)},t=function(a,b,c){var d=p(a);if(null==d)return alert("no template with name "+a),-1;for(x in f.entities)if(f.entities[x].name==c)return alert("Please enter a unique entity name"),-1;if(""==b)var e=[];else if(-1==b.indexOf(","))var e=[b];else var e=b.split(",");if(e.length!=d.parameters.length)return alert("not enough parameters to instantiate "+d),-1;for(x in e){var g=C(d.parameters[x]),h=C(e[x]);eden.executeEden(c+"_"+g+" is "+h+";")}var i=m(c,d.definitions),j=r(c,i);return-1!=j&&u(c,i,d.actionsArr),j},u=function(a,b,c){var d=n(a,c),g=new e(a,b,d);f.entities.push(g);for(x in d){var h=d[x],i=h.edenVar+" is "+h.guard+";";eden.executeEden(i)}if(null!=f.actionLists){var j=new EdenUI.plugins.ADM.ActionsList(a);f.actionLists.push(j),w(g,j)}null!=f.entityList&&f.entityList.addEntity(a,b,d)},v=function(){for(x in f.selectedActions){var b=f.selectedActions[x];if(b=C(b),945==b.charCodeAt(0))if("r"==b[2]){var c=b.split("(")[1];c=c.substring(0,c.length-1),s(c)}else if("i"==b[2]){var d=b.split("(")[1],e=b.split("(")[2].split(")")[0],c=b.split("as")[1],g=t(d,e,c);if(-1==g)break}else alert("Action on another entity must one of α_remove(entity_name), α_r, α_instantiate(template(param_value) as entity_name) or α_i");else eden.executeEden(b+";")}f.selectedActions=new Array,a.plugins.ADM.refreshHumanPerspective()};this.actionPush=function(a){f.selectedActions.push(a)},this.actionRemove=function(a){var b=new Array;for(x in f.selectedActions){var c=f.selectedActions[x];c!=a&&b.push(c)}f.selectedActions=b},this.refreshHumanPerspective=function(){for(x in f.entities){var a,b=f.entities[x];for(y in f.actionLists){var c=f.actionLists[y];if(c.entityName==b.name){a=c;break}}a.clear();var d=[];for(x in b.queuedActions){var e=b.queuedActions[x].split(";"),g=e[0];if(g.length>0){e.splice(0,1);var h=!0;e[0].length>0&&(d.push(e.join(";")),h=!1),a.addAction(g,h)}}b.queuedActions=d,w(b,a)}};var w=function(a,b){for(var c=0;c<a.actionsArr.length;c++){var d=a.actionsArr[c];if(!0===eden.root.lookup(d.edenVar).value()){var e=d.actions.split(";"),f=e[0],g=!0;e.splice(0,1),e[0].length>0&&(a.queuedActions.push(e.join(";")),g=!1),b.addAction(f,g)}}};this.createHumanPerspective=function(b,c){var d=$("<div></div>");d=$('<div id="human-perspective" class="actionlist"></div>'),$dialog=$('<div id="'+b+'"></div>').html(d).dialog({title:c,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){a.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){v()}}]}),f.actionLists=new Array;for(x in f.entities){var b=f.entities[x].name;f.actionLists.push(new EdenUI.plugins.ADM.ActionsList(b))}a.plugins.ADM.refreshHumanPerspective()};var z=function(){for(x in f.selectedEntities)s(f.selectedEntities[x]);alert("Entities successfully deleted."),f.selectedEntities=new Array};this.entityPush=function(a){f.selectedEntities.push(a)},this.entityRemove=function(a){var b=new Array;for(x in f.selectedEntities){var c=f.selectedEntities[x];c!=a&&b.push(c)}f.selectedEntities=b};this.createInstanceList=function(a,b){var c=$("<div></div>");c.html('<div id="entity-list" class="instance-list"></div>'),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){z()}}]}),f.entityList=new EdenUI.plugins.ADM.EntityList;for(x in f.entities){var d=f.entities[x];f.entityList.addEntity(d.name,d.definitions.join("\n"),d.actionsArr.join("\n"))}};var A=function(a){var b=a.split(":")[1];return C(b.split("(")[0])},B=function(a){var b=a.split(":")[1].split("(")[1];return b.length>1?b.split(")")[0].split(","):[]},C=function(a){for(;32==a.charCodeAt(0)||9==a.charCodeAt(0);)a=a.substring(1,a.length);for(;32==a.charCodeAt(a.length-1)||9==a.charCodeAt(a.length-1);)a=D(a);return a},D=function(a){return a.substring(0,a.length-1)},E=function(a,b,c,e){for(x in f.templates)if(f.templates[x].name==a)return alert("Templates must have unique names."),-1;var h=g(0,e),i=new d(a,b,c,h);return f.templates.push(i),null!=f.templateList&&f.templateList.addTemplate(a,b),1},F=function(a){var b,c=a.split("\n"),d=new Array,e=new Array,f=new Array,g=!1,h=!1,i=!1;for(x in c){var j=c[x];if(""!=(j=C(j)))if(0==i)if("{"==j[0])i=!0,-1!=j.indexOf("name:")&&(b=A(j),d=B(j));else{var k=j.split("(")[0],l=j.split("(")[1].split(")")[0],m=D(C(j.split("as")[1])),n=t(k,l,m);if(-1==n)break}else if(1==g){var o=j.indexOf("}");-1!=o&&(j=D(j),g=!1),j.length>0&&e.push(j)}else if(1==h){var o=j.indexOf("}");-1!=o&&(j=D(j),h=!1),j.length>0&&f.push(j)}else if("}"==j[0]){i=!1;var n=E(b,d,e,f);if(b="",d=new Array,e=new Array,f=new Array,-1==n)return}else if(-1!=j.indexOf("name:"))b=A(j),d=B(j);else if(-1!=j.indexOf("definitions:")||-1!=j.indexOf("defs:")){if(g=!0,j=C(j),j.split("{").length>1){var p=C(j.split("{")[1]);-1!=p.indexOf("}")&&(p=D(p),g=!1),p.length>0&&e.push(p)}}else if(-1!=j.indexOf("actions:")&&(h=!0,j=C(j),j.split("{").length>1)){var p=C(j.split("{")[1]),o=p.indexOf("}");-1!=o&&(p=D(p),h=!1),p.length>0&&f.push(p)}}};this.createAdvancedInput=function(a,b){var c=document.createElement("textarea");c.style.boxSizing="border-box",c.style.width="100%",c.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(c),$dialog=$('<div id="'+a+'"></div>').html($code_entry).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var a=c.value;F(a),c.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},a.addViewCategory("adm","Abstract Definitive Machine"),a.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:a.viewCategories.adm},a.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:a.viewCategories.adm},a.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:a.viewCategories.adm},a.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:a.viewCategories.adm},a.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:a.viewCategories.adm},b()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(a,b){var c=new EdenUI.plugins.ADM.Template(a,b);c.element.appendTo(this.templateList),this.templates.push(c)},EdenUI.plugins.ADM.Template=function(a,b){this.template=a,this.element=$("<option value="+a+">"+a+"</option>");var c=this.showParamInput;this.element.click(function(){c(b)}),""==document.getElementById("instantiate-params").innerHTML&&c(b)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(a){var b=document.getElementById("instantiate-params");b.innerHTML="";for(x in a){var c=a[x],d=document.createElement("label");d.innerHTML=c+":",b.appendChild(d);var e=document.createElement("input");e.type="text",b.appendChild(e);var f=document.createElement("br");b.appendChild(f)}},EdenUI.plugins.ADM.ActionsList=function(a){var b=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+a),this.actionresults.innerHTML="<label><b>Actions for "+a+":</b></label>",b.appendChild(this.actionresults),this.actions=new Array,this.entityName=a},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(a,b){var c=new EdenUI.plugins.ADM.Action(a,b);c.element.appendTo(this.actionresults),this.actions.push(c)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){document.getElementById("human-perspective").removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(a,b){var a=a;this.action=a,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var c=!1;this.element.hover(function(){0==c?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==c?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){0==c?(edenUI.plugins.ADM.actionPush(a),$(this).css("backgroundColor","#6666CC"),c=!0):(edenUI.plugins.ADM.actionRemove(a),$(this).css("backgroundColor","white"),c=!1)}),this.update(b)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(a){var b='<li class="type-function"><span class="result_name">';b=1==a?b+this.action+"</span></li>":b+this.action+" ... </span></li>",this.element.html(b)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(a,b,c){var d=new EdenUI.plugins.ADM.Entity(a,b,c);d.element.appendTo(this.entityList),this.entities.push(d)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(a){var b;for(x in this.entities)if(this.entities[x].entity==a){b=x;break}this.entities.splice(b,1);var c=document.getElementById("element-"+a);this.entityList.removeChild(c)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(a,b,c){this.entity=a,this.element=$('<div class="entitylist-element" id=element-'+a+"></div>");var d='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(d);var b=b,c=c,e=!1;this.element.hover(function(){0==e?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==e?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){if(this.innerHTML==d){var f=document.createElement("div");f.innerHTML="<label>Definitions:</label><br>\t\t\t\t\t<textarea disabled>"+b+"</textarea><br>\t\t\t\t\t<label>Actions:</label><br>\t\t\t\t\t<textarea disabled>"+c+"</textarea><br>",this.appendChild(f),edenUI.plugins.ADM.entityPush(a),$(this).css("backgroundColor","#6666CC"),e=!0}else this.innerHTML=d,edenUI.plugins.ADM.entityRemove(a),$(this).css("backgroundColor","white"),e=!1})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var a='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(a)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.DBView=function(a,b){this.createDialog=function(a,b){function c(){0==Array.isArray(j)&&(j=[["Value"],[[j]]]);for(var a=f.get(0);a.firstChild;)a.removeChild(a.firstChild);if(g=j[0],h=j[1],Array.isArray(g)||(h=j,g=[["List"]]),Array.isArray(h)){for(var b=$("<tr></tr>"),c=0;c<g.length;c++){var d=$("<th></th>");d.html(g[c]),d.appendTo(b)}b.appendTo(f);for(var e=0;e<h.length;e++){for(var i=$("<tr></tr>"),c=0;c<g.length;c++){var k;k="scope"==g[c]?$('<td class="dbview-disabled"></td>'):$("<td contenteditable></td>"),k.appendTo(i);var l=Array.isArray(h[e])?h[e][c]:h[e];k.html("<div class='dbview-cellcontent'>"+Eden.edenCodeForValue(l)+"</div>")}i.appendTo(f)}}}function d(){f.find(".dbview-dependant").removeClass("dbview-dependant"),f.find(".dbview-dependency").removeClass("dbview-dependency")}var e=$('<div id="'+a+'-content" class="dbview-content"><div class="dbview-controls"><div class="dbview-select"><span class="dbview-label">Query:</span><input class="dbview-select-text" type="text"></input></div></div></div>'),f=$('<table class="dbview-table"></table>');f.appendTo(e);var g,h,i=e.find(".dbview-select-text").get(0),j=void 0,k=a.slice(0,-7),l=new Eden.Agent(void 0,"view/db/"+k+"/config"),m="_view_"+k+"_source";return l.declare(m),f.on("input","td",function(a){var b=a.target.cellIndex,c=a.target.parentNode.rowIndex-1;if(!(b<0||c<0)){a.target.textContent}}).on("mouseenter","td",function(a){a.target.cellIndex,a.target.parentNode.rowIndex}).on("mouseleave","td",function(a){d()}),e.on("input",".dbview-select-text",function(a){l.setSource("_view_"+k+"_source is "+i.value),l.execute(!0,!0)}),j=l.state[m],c(),l.on(m,function(a,b){j=b,c()}),$('<div id="'+a+'"></div>').html(e).dialog({title:b,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dbview-dialog"}),{confirmClose:!0}},a.views.DBView={dialog:this.createDialog,title:"Database Viewer",category:a.viewCategories.visualization},b()},EdenUI.plugins.DBView.title="DBView",EdenUI.plugins.DBView.description="Display a table showing entire database contents.",EdenUI.plugins.SpeechSynthesis=function(a,b){function c(){var a=window.speechSynthesis.paused;window.speechSynthesis.cancel(),a&&window.speechSynthesis.pause()}function d(a,b){if(f)return void(f=!1);var e,g=root.lookup("speak"),h=root.lookup("speakingList"),i=root.lookup("speakingIndex"),j=root.lookup("speaking"),k=root.lookup("speakingID"),l=root.lookup("speakingText"),m=root.lookup("speakingSpeech"),n=root.lookup("speakingCharIndex"),o=h.value(),p=i.value();if(c(),p||(p=1),""!=a){if("finished"==a){var q=l.value();"string"==typeof q&&n.assign(q.length+1,g)}else"interrupted"==a&&(f=!0);e=k.value(),eden.isValidIdentifier(e)&&root.lookup(e+"_status").assign(a,g)}if(b&&p++,n.assign(1,g),root.lookup("speakingTime").assign(0,g),Array.isArray(o)&&p<=o.length){j.value()||j.assign(!0,g);var r=o[p-1];if(!(r instanceof SpeakingWords)||r.cancelled)return void d("",!0);r.prepareUtterance();var s=r.utterance;e=r.id,k.assign(e,g),eden.isValidIdentifier(e)&&root.lookup(e+"_status").assign("speaking",g),l.assign(s.text,g),m.assign(r,g),b&&i.assign(p,g),r.hasBeenSpoken=!0,window.speechSynthesis.speak(s)}else j.assign(!1,g),k.assign("",g),l.assign("",g),m.assign(void 0,g),Array.isArray(o)&&i.assign(o.length+1,g)}function e(a,b){var c,d,e,f,g=window.speechSynthesis.getVoices();a&&(a=a.toLowerCase(),d=a.indexOf("-"),-1!=d?(e=a.slice(0,d),f=!0):(e=a,f=!1)),b&&(c=new RegExp("\\b"+b+"\\b","i"));for(var h=void 0,i=!1,j=!1,k=!1,l=!1,m=0;m<g.length;m++){var n=g[m],o=n.lang,p=!1,q=!1,r=!1;if(a&&o&&(o=o.toLowerCase(),a==o?(p=!0,q=!0):e==o?p=!0:-1!=(d=o.indexOf("-"))&&o.slice(0,d)==e&&(p=!0)),b&&c.test(n.name)&&(r=!0),(!j&&!o&&!i||!j&&(!o||!a)&&n.default||p&&!j||f&&q&&!k||p&&!f&&n.default||q&&n.default||r&&!l&&(!a||!o&&!j||p))&&(!l||r||p&&!j)){if(i=!p,j=p,k=q,l=r,(!b||l)&&(k||j&&!f)&&n.default)return n;h=n}}return void 0===h&&(h=g[0]),h}var f=!1;root.lookup("speakingList").addJSObserver("sendToTTS",function(a,b){var c=root.lookup("speak");if(Array.isArray(b)){var e=root.lookup("speakingIndex"),f=e.value();if(f>b.length+1)e.assign(b.length+1,c);else if(f<=b.length){for(var g=f<1?0:f-1;g<b.length;g++){var h=b[g];if(h instanceof SpeakingWords){h.prepareUtterance();var i=h.id;eden.isValidIdentifier(i)&&root.lookup(i+"_status").assign("waiting",c)}}root.lookup("speaking").value()?b[f-1]!==root.lookup("speakingSpeech").value()&&d("interrupted",!1):d("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(a,b){if("speak"!=a.last_modified_by){var c=root.lookup("speakingList").value();if(Array.isArray(c)&&b<=c.length){root.lookup("speaking").value()?d("interrupted",!1):d("",!1);for(var e=b;e<c.length;e++)c[e]instanceof SpeakingWords&&c[e].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(a,b){b?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(b,c,f,g,h,i,j){this.id=b,this.utterance=new window.SpeechSynthesisUtterance(String(c));var k,l,m,n,o,p,q;this.hasBeenSpoken=!1,void 0===g?(p=a.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===p&&(p="native"),m=!0):(p=g,m=!1),this.utterance.volume=h,void 0===i?(k=a.getOptionValue("speechSynthDefaultRate"),null!==k&&(this.utterance.rate=parseFloat(k)),n=!0):(this.utterance.rate=i,n=!1),void 0===j?(k=a.getOptionValue("speechSynthDefaultPitch"),null!==k&&(this.utterance.pitch=parseFloat(k)),o=!0):(this.utterance.pitch=j,o=!1);var r=this;if(Object.defineProperty(this,"text",{get:function(){return r.utterance.text},set:function(a){r.utterance.text=a},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return r.utterance.lang},set:function(a){if(a){var b=a.indexOf("-");-1!=b&&(a=a.slice(0,b+1)+a.slice(b+1).toUpperCase()),r.utterance.lang=a}else r.utterance.lang="";l=!1;var c=e(a,p);r.utterance.voiceURI=c.voiceURI,r.utterance.voice=c},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return p},set:function(a){p=a,m=!1;var b=e(this.utterance.lang,p);r.utterance.voiceURI=b.voiceURI,r.utterance.voice=b},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return r.utterance.volume},set:function(a){r.utterance.volume=a},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return r.utterance.rate},set:function(a){r.utterance.rate=a,n=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return r.utterance.pitch},set:function(a){r.utterance.text=a,o=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return q},set:function(a){(q=a)&&r.id&&root.lookup(r.id+"_status").assign("cancelled",{name:"/SpeakingWords"})},enumerable:!0}),this.toString=function(){var a="SpeakingWords("+Eden.edenCodeForValue(b)+', "'+r.utterance.text+'", ';return l?a+="@, ":a=a+'"'+r.utterance.lang+'", ',m?a+="@, ":a=a+Eden.edenCodeForValue(p)+", ",a=a+r.utterance.volume+", ",n?a+="@, ":a=a+this.utterance.rate+", ",o?a+="@)":a=a+this.utterance.pitch+")",a},void 0===f?(this.lang=a.getOptionValue("speechSynthDefaultLanguage"),l=!0):this.lang=f,eden.isValidIdentifier(b)){var s=root.lookup(b+"_status");void 0===s.value()&&s.assign("not queued",{name:"/speakingWords"})}this.prepareUtterance=function(){if(r.hasBeenSpoken&&!("chrome"in window)){var a=new window.SpeechSynthesisUtterance(r.utterance.text);a.lang=r.utterance.lang,a.volume=r.utterance.volume,a.rate=r.utterance.rate,a.pitch=r.utterance.pitch,
a.voiceURI=r.utterance.voiceURI,a.voice=r.utterance.voice,a.onboundary=r.utterance.onboundary,a.onend=r.utterance.onend,a.onerror=r.utterance.onerror,r.utterance=a,r.hasBeenSpoken=!1}},this.utterance.onboundary=function(a){var b={name:"/speak"};root.lookup("speakingCharIndex").assign(a.charIndex+1,b);var c=a.elapsedTime;c<=1e7&&root.lookup("speakingTime").assign(c,b)},this.utterance.onend=function(){d("finished",!0)},this.utterance.onerror=function(){d("error",!0)}},a.eden.include("plugins/speech-synthesis/speech-synthesis.js-e",b)},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!",EdenUI.plugins.MIDI=function(a,b){function c(a,b){if(a<k.length){for(var c=k[a],d=0;d<b.length&&d<16;d++){var e=b[d];Number.isInteger(e)&&e>=1&&e<=128&&c.send([192+d,e-1])}b.length>16&&eden.error(new Error("MIDI programs list is too long."))}}function d(a){if(void 0===a)return p;if(Number.isInteger(a)){if(a<1||h&&a>k.length)throw new Error("No MIDI output device exists with device number "+a);return a-1}if(h&&"string"==typeof a){for(var b=0;b<k.length;b++)if(a==k[b].name)return b;throw new Error("No MIDI output device exists with device name "+a)}throw new Error("The output device must be given as a positive integer.")}function e(a){if(void 0===a)return q;if(Number.isInteger(a)){if(a<1||h&&a>l.length)throw new Error("No MIDI input device exists with device number "+a);return a-1}if(h&&"string"==typeof a){for(var b=0;b<l.length;b++)if(a==l[b].name)return b;throw new Error("No MIDI input device exists with device name "+a)}throw new Error("The input device must be given as a positive integer.")}function f(a){root.lookup("startMIDIInput");if(B==C)x.length>w&&(x=new Array(w)),x[0]=a,B=1,C=0;else{var b,c=a.timeStamp;for(b=B-1;b>=C&&!(x[b].timeStamp<=c);b--);b==B-1?x[B]=a:x.splice(b+1,0,a),B++}D.assign(B-C)}var g=this,h=!1;Object.defineProperty(this,"initialized",{get:function(){return h},enumerable:!0});var j=[];this.addSoftwareDriver=function(a){console.log("New JavaScript MIDI driver registered."),j.push(a),h&&a()};var k=[],l=[],m=root.lookup("midiNumberOfOutputs");m.assign(0);var n=root.lookup("midiNumberOfInputs");n.assign(0);var o={};this.addSoftSynth=function(a){if(k.push(a),m.assign(k.length),console.log('Added software synthesizer "'+a.name+'".'),h){var b=k.length-1,d=o[b];void 0!==d&&c(b,d.value())}},this.addSoftInput=function(a){l.push(a),n.assign(l.length),console.log('Added software input "'+a.name+'".')};var p=0,q=0;Object.defineProperty(this,"outputNames",{get:function(){for(var a=[],b=0;b<k.length;b++)a.push(k[b].name);return a},enumerable:!0}),Object.defineProperty(this,"inputNames",{get:function(){for(var a=[],b=0;b<l.length;b++)a.push(l[b].name);return a},enumerable:!0}),this.roundValue=function(a){return"number"==typeof a?a<=0?0:a<=1?1:a>=127?127:Math.round(a):void 0},this.isValidNote=function(a){return Number.isInteger(a)&&a>=-20&&a<=107},this.loadPrograms=function(a,b){a=d(a);var c=k[a];if(!Array.isArray(b))throw new Error("MIDI programs must be given as a list.");for(var e=b.length,f=new Array(e),g=0;g<e;g++){var h=b[g];if(!(Number.isInteger(h)&&h>=1&&h<=128))throw new Error("Item "+g+" must be an integer between 1 and 128.");f[g]=h-1}c.loadPrograms&&c.loadPrograms(f)},this.bindPrograms=function(a,b){if(!(a instanceof Symbol))throw new Error("The first argument must be a Symbol.");b=d(b),Array.isArray(a.value())||void 0!==a.definition||a.assign([1]);var e=function(a,d){if(!Array.isArray(d))return void eden.error(new Error("Illegal MIDI programs list: "+Eden.edenCodeForValue(d)));h&&c(b,d)};e(0,a.value()),a.addJSObserver("bind",e),o[b]=a},this.getInputs=function(){return l};var r=!1,s=[],t=[];this.initialize=function(a,b){function d(a){if(a<j.length)0==a&&console.log("Found "+j.length+" MIDI drivers written in JavaScript."),j[a](d,[a+1]);else{for(var b in o)c(b,o[b].value());h=!0,r=!1,console.log("Done.");for(var e=0;e<s.length;e++)s[e].apply(null,t[e])}}var e=a.value();if(h)return void e.apply(null,b);if(s.push(e),t.push(b),!r){r=!0;var f=function(a){if(a){var b=a.outputs.values(),c=b.next();for(c.done&&console.log("No MIDI output devices found.");!c.done;){var e=c.value;console.log("Found MIDI output device "+e.name+"."),k.push(e),c=b.next()}var b=a.inputs.values(),c=b.next();for(c.done&&console.log("No MIDI input devices found.");!c.done;){var f=c.value;console.log("Found MIDI input device "+f.name+"."),l.push(f),c=b.next()}m.assign(k.length),n.assign(l.length)}d(0)},g=function(a){var b="Unable to access WebMIDI: "+a;console.log(b),eden.error(new Error(b)),d(0)};console.log("Initializing MIDI..."),window.navigator.requestMIDIAccess?window.navigator.requestMIDIAccess().then(f,g):(console.log("This browser does not support the WebMIDI API.  No access to hardware MIDI devices is possible."),d(0))}},this.mergeMessageLists=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(Array.isArray(d))b.push(d);else if(void 0!==d)throw new Error("Item "+c+" must be a list of MIDI messages.")}for(var e=b.length,f=new Array(e),g=0,c=0;c<e;c++)f[c]=0,g+=b[c].length;for(var h=new Array(g),c=0;c<g;c+=2){for(var i,j,k=1/0,l=0;l<e;l++){var m=f[l];if(m<b[l].length){var n=b[l],o=n[m],p=n[m+1];p<k&&(k=p,j=o,i=l)}}h[c]=j,h[c+1]=k,f[i]=f[i]+2}return h},this.playMIDI=function(a,b,c){if(a=d(a),void 0===b)b=0;else if("number"!=typeof b)throw new Error("The delay must be a number.");if(!Array.isArray(c))throw new Error("The message stream must be an array.");for(var e=k[a],f=window.performance.now()+b,g=0;g<c.length;g+=2)e.send(c[g],f+c[g+1])};var u={};this.alterNote=function(a,b,c,e,f,h){var i=u[a],j=k[d(b)];g.isValidNote(e)?e===i?h&&f>0&&j.send([144+c,e+20,g.roundValue(f)]):(f>0?(void 0!==i&&j.send([144+c,i+20,0]),h&&j.send([144+c,e+20,g.roundValue(f)])):f<0?void 0!==i&&j.send([128+c,i+20,g.roundValue(-f)]):void 0!==i&&j.send([144+c,i+20,0]),u[a]=e):void 0!==i&&j.send([144+c,i+20,0])},this.alterVelocity=function(a,b,c,e,f){if(e===u[a]&&void 0!==e){var h=k[d(b)];f>0?h.send([160+c,e+20,g.roundValue(f)]):f<0?h.send([128+c,e+20,g.roundValue(-f)]):h.send([144+c,e+20,0])}};var v={};v.volume=7,this.bindControlChange=function(a,b,c,e){function f(a,b){var d=g.roundValue(b);void 0!==d&&i.send([176+c,h,d])}if(!(a instanceof Symbol))throw new Error("The first argument must be a Symbol.");var h,i=k[d(b)];if("string"==typeof e){if(void 0===(h=v[e.toLowerCase()]))throw new Error("Unknown control name "+e)}else{if(!(Number.isInteger(e)&&e>=0&&e<=127))throw new Error("The control must be specified either as a string or as an integer between 0 and 127 inclusive.");h=e}f(a,a.value()),a.addJSObserver("bind",f)};var w=16,x=new Array(w),y=root.lookup("midiInputDevice"),z=root.lookup("midiInputTimestamp"),A=root.lookup("midiInputMessage"),B=0,C=0,D=root.lookup("midiInputMessageCount");this.startInput=function(a){if(void 0===a)for(i=0;i<l.length;i++)l[i].onmidimessage=f;else a=e(a),l[a].onmidimessage=f},this.fetchInputMessage=function(){if(C!=B){var a=root.lookup("startMIDIInput"),b=x[C],c=x.length;C++,c>=2*w&&C>.8*c-1&&(x.splice(0,C),B-=C,C=0);var d,e=b.target;e&&(d=e.name),root.beginAutocalcOff(),y.assign(d,a),z.assign(b.timeStamp,a),A.assign(b.data),D.assign(B-C),root.endAutocalcOff()}},this.clearInputMessages=function(){x.length>w&&(x=new Array(w)),B=0,C=0,D.assign(0)},Eden.Agent.importAgent("plugins/midi","default",[],b)},EdenUI.plugins.MIDI.title="MIDI",EdenUI.plugins.MIDI.description="Adds musical capabilities to JS-EDEN.",EdenUI.plugins.Debugger=function(a,b){this.createDialog=function(a,b){function c(a){var b="";return"when"==a.type&&a.base&&a.base.origin?(b+="## "+a.base.origin.name,a.line&&(b+=":"+(a.line+1)),b+="\n"):a.name&&(b+="## "+a.name+"\n"),a.getSource&&(b+=a.getSource()),b}var d=(a.slice(0,-7),!1),e=void 0,f=!1,g=500,h=$('<div class="debugger"></div>'),i=$('<div class="debugger-controls"><button title="Toggle capture all agents" style="margin-left: 20px; margin-right: 20px;" class="debugger-button debug">&#xf188;</button><button class="debugger-button play" title="Auto Play">&#xf04b;</button><button class="debugger-button stepforward">&#xf051;</button><button class="debugger-button autostep">&#xf050;</button><input type="range" class="debugger-speed" value="500" max="1000" min="50"></input></div>');h.append(i);var j=$('<div class="debugger-agents"></div>');h.append(j);var k={},l=1,m=function(a){var b=a.agent,e=c(b);if(k[b.id]){var h=k[b.id].html;if(k[b.id].data=a,f=!1,h){var i=new Eden.AST(e,void 0,b);if(new EdenUI.Highlight(h.get(0).childNodes[1]).highlight(i,-1,-1),a.statement){var j=a.statement.line-b.getLine(),l=h.get(0).childNodes[1].childNodes[j+1];l?l.className="eden-line debugger-line":console.error("Missing line: "+j)}}else console.error("Missing output")}d&&setTimeout(a.next,g)};Eden.AST.debugstep_cb=m;var n=function(a){var b=a.agent;void 0!==b.id&&(o(a),console.log("WHEN ALREADY LOGGED")),b.id=l,l++;var d=$('<div class="debugger-agent" data-agent="'+b.id+'"><div class="debugger-agent-controls"></div><div class="debugger-code"></div></div>');j.append(d),k[b.id]={html:d,data:a},void 0===e&&(e=k[b.id],d.get(0).className="debugger-agent active");var f=c(b),g=new Eden.AST(f,void 0,b);new EdenUI.Highlight(d.get(0).childNodes[1]).highlight(g,-1,-1)};Eden.AST.debug_begin_cb=n;var o=function(a){var b=a.agent;if(void 0!==b.id&&void 0!==k[b.id]){e===k[b.id]&&(f=!1,e=void 0);var d=c(b),g=k[b.id].html,h=new Eden.AST(d,void 0,b);new EdenUI.Highlight(g.get(0).childNodes[1]).highlight(h,-1,-1),k[b.id].html.remove(),delete k[b.id],b.id=void 0}};return Eden.AST.debug_end_cb=o,Eden.AST.debug=!0,Eden.AST.debugstep=!1,$('<div id="'+a+'"></div>').html(h).dialog({appendTo:"#jseden-views",title:b,width:590,height:500,minHeight:120,minWidth:230,dialogClass:"debugger-dialog"}),i.on("click",".play",function(a){d=!d,d?(a.currentTarget.innerHTML="&#xf04c;",a.currentTarget.className="debugger-button play active"):(a.currentTarget.innerHTML="&#xf04b;",a.currentTarget.className="debugger-button play")}).on("click",".stepforward",function(a){e&&e.data.next&&(e.data.next(),e&&(e.data.next=void 0))}).on("click",".debug",function(a){Eden.AST.debugstep=!Eden.AST.debugstep,Eden.AST.debugstep?a.currentTarget.className="debugger-button debug active":a.currentTarget.className="debugger-button debug"}).on("change",".debugger-speed",function(a){g=a.currentTarget.value,console.log("Change speed: "+g)}),j.on("click",".debugger-agent",function(a){e&&(e.html.get(0).className="debugger-agent"),e=k[a.currentTarget.getAttribute("data-agent")],e.html.get(0).className="debugger-agent active"}),{destroy:function(){Eden.AST.debug=!1}}},a.views.Debugger={dialog:this.createDialog,title:"Debugger",category:a.viewCategories.history},b()},EdenUI.plugins.Debugger.title="Debugger",EdenUI.plugins.Debugger.description="",EdenUI.plugins.Debugger.originalAuthor="Nicolas Pope",EdenUI.plugins.MIDIDotJS=function(a,b){function c(){a.plugins.MIDI.addSoftwareDriver(function(b,c){function f(e){e==i.length?(g=window.MIDI,g.loadPlugin({soundfontUrl:d,onsuccess:function(){a.plugins.MIDI.addSoftSynth(h),b&&b.apply(this,c)}})):$.ajax({url:"plugins/midi/emulation/lib/MIDI.js/"+i[e],success:function(){f(e+1)}})}var g,h={};h.name="MIDI.js",h.loadPrograms=function(a){for(var b=0;b<a.length;b++)e[a[b]]=!0;g.loadPlugin({soundfontUrl:d,instrument:a})},h.send=function(a,b){var c=a[0],f=240&c,h=15&c,i=a[1],j=a[2];switch(void 0===b?b=0:b-=window.performance.now(),f){case 128:g.noteOff(h,i,b/1e3);break;case 144:g.noteOn(h,i,j,b/1e3);break;case 176:switch(i){case 7:var k=j/127*(j/127)*64;MIDI.setVolume(h,k,b/1e3);break;default:console.log("Unable to change MIDI control number "+i+" using MIDI.js")}break;case 192:e[i]||(e[i]=!0,g.loadPlugin({soundfontUrl:d,instrument:i})),g.setInstrument(h,i,b);break;default:console.log("Unable to map MIDI command "+c.toString(16)+" to MIDI.js")}},h.clear=function(){};var i=["inc/shim/Base64binary.js"];"true"==a.getOptionValue("developer")?i.push("build/MIDI.js"):i.push("build/MIDI.min.js"),f(0)}),b()}var d="plugins/midi/emulation/soundfonts/FluidR3_GM/",e=new Array(127);a.plugins.MIDI?c():a.loadPlugin("MIDI",c)},EdenUI.plugins.MIDIDotJS.title="MIDI.JS",EdenUI.plugins.MIDIDotJS.description="Uses the MIDI.js JavaScript library to add a software synthesizer for users who cannot access a MIDI instrument via WebMIDI and the basic MIDI plug-in.",EdenUI.plugins.MIDIFileInput=function(a,b){function c(){a.plugins.MIDI.addSoftwareDriver(function(b,c){a.plugins.MIDI.addSoftInput(d),b&&b.apply(this,c)})}var d={};d.name="MIDI Input from MIDI File",this.queue=function(a){function b(a){var b=new Uint8Array(a.slice(1));return new MIDIMessageEvent("midimessage",{target:d,data:b})}function c(g){if(g!=f){var h=a[g],i=e+h[0]-window.performance.now();if(i>0)window.setTimeout(function(){var a=b(h);d.onmidimessage(a),c(g+1)},i);else{var j=b(h);d.onmidimessage(j),c(g+1)}}}var e=window.performance.now(),f=a.length;c(0)},a.plugins.MIDI?c():a.loadPlugin("MIDI",c)},EdenUI.plugins.MIDIFileInput.title="MIDI File Input",EdenUI.plugins.MIDIFileInput.description="Use a MIDI file to simulate MIDI file input.";