function getCaretCharacterOffsetWithin(e){var t,n=0,i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var a=o.getSelection().getRangeAt(0),s=a.cloneRange();s.selectNodeContents(e),s.setEnd(a.endContainer,a.endOffset),n=s.toString().length}}else if((t=i.selection)&&"Control"!=t.type){var r=t.createRange(),l=i.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",r),n=l.text.length}return n}function getStartCaretCharacterOffsetWithin(e){var t,n=0,i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var a=o.getSelection().getRangeAt(0),s=a.cloneRange();s.selectNodeContents(e),s.setEnd(a.startContainer,a.startOffset),n=s.toString().length}}else if((t=i.selection)&&"Control"!=t.type){var r=t.createRange(),l=i.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",r),n=l.text.length}return n}function get_time_diff(e){var t=1e3*e,n=Date.now();if(t-=6e4*(new Date).getTimezoneOffset(),isNaN(t))return"";if(t<n)i=n-t;else var i=t-n;var o=Math.floor(i/1e3/60/1440),a=new Date(i);if(o>5)return new Date(t).toDateString();var s="";if(o>0)s+=o,s+=o>1?" days ago":" day ago";else if(a.getUTCHours()>0){var r=a.getUTCHours();s+=r,s+=r>1?" hours ago":" hour ago"}else{var l=a.getUTCMinutes();if(l>0)s+=l,s+=l>1?" minutes ago":" minute ago";else{var d=a.getUTCSeconds();s+=d,s+=" seconds ago"}}return s}function changeClassString(e,t,n){var i=e.split(" "),o=i.indexOf(t);if(-1==o){if(n)return i.push(t),i.join(" ")}else if(!n)return i.splice(o,1),i.join(" ");return e}function changeClass(e,t,n){if(e){var i=changeClassString(e.className,t,n);i!=e.className&&(e.className=i)}}function makeCurlyBrace(e,t,n,i,o,a){var s=e-n,r=t-i,l=Math.sqrt(s*s+r*r),d=e-.5*l*(s/=l)+o*(r/=l),c=t-.5*l*r-o*s;return"M "+e+" "+t+" Q "+(e+a*o*r)+" "+(t-a*o*s)+" "+(e-.25*l*s+(1-a)*o*r)+" "+(t-.25*l*r-(1-a)*o*s)+" T "+d+" "+c+" M "+n+" "+i+" Q "+(n+a*o*r)+" "+(i-a*o*s)+" "+(e-.75*l*s+(1-a)*o*r)+" "+(t-.75*l*r-(1-a)*o*s)+" T "+d+" "+c}function EdenScriptGutter(e,t,n){function i(){console.log("GUTTER HOLD"),l=void 0;for(var e=0;e<s.lines.length;e++)s.lines[e].selected&&(changeClass(s.gutter.childNodes[e],"select",!1),changeClass(s.gutter.childNodes[e],"live",!0),s.lines[e].selected=!1,s.lines[e].live=!0)}function o(e,t){if(t&&c){if(i=s.ast.getStatementByLine(e)){(o=i.getRange())[0]<o[1]&&s.showBrace(o[0],o[1]);for(var n=o[0];n<=o[1];n++)s.lines[n].selected=!p,changeClass(s.gutter.childNodes[n],"select",!p),changeClass(s.gutter.childNodes[n],"hover",!1)}}else{var i=s.ast.getStatementByLine(e);if(i){var o=i.getRange();s.lines[e].live||t||changeClass(s.gutter.childNodes[e],"play",!0),s.selectLine(e+1,!0),s.hovering=!0}}}function a(e,t){c&&!t&&(s.lines[e].selected=!p,changeClass(s.gutter.childNodes[e],"select",!p),changeClass(s.gutter.childNodes[e],"hover",!1),changeClass(s.gutter.childNodes[e],"play",!1)),c&&(t=!0),s.hovering=!1,clearTimeout(l),l=void 0;var n=s.ast.getStatementByLine(e);if(n){var i=n.getRange();s.hideBrace();for(var o=i[0];o<=i[1];o++)changeClass(s.gutter.childNodes[o],"hover",!1),changeClass(s.gutter.childNodes[o],"play",!1)}}var s=this;this.lineelements=n,this.$gutter=$('<div class="eden-gutter"></div>');var r="http://www.w3.org/2000/svg";this.brace=document.createElementNS(r,"svg"),this.brace.style.position="absolute",this.brace.style.display="none",this.brace.setAttribute("width","22"),this.brace.style.left="10px",this.bracepath=document.createElementNS(r,"path"),this.bracepath.setAttribute("style","stroke: #444; fill: none; stroke-width: 3px"),this.brace.appendChild(this.bracepath),this.gutter=this.$gutter.get(0),e.insertBefore(this.gutter,e.firstChild),e.insertBefore(this.brace,e.firstChild),this.ast=void 0,this.lines=[],this.errors=[],this.agents={},this.hovering=!1,this.ctx=void 0,this.edits=void 0;var l,d,c=!1,u=0,p=!1,h=!1;this.curline=-1,this.textwidth=getTextWidth("M","14px/20px Roboto Mono,monospace"),s.startHover=o,s.endHover=a,this.$gutter.on("mousedown",".eden-gutter-item",function(e){if(!this.edits&&!s.ast.hasErrors()){var t=parseInt(e.target.getAttribute("data-line"));d=e.shiftKey,u=t,p=!!s.lines[t]&&s.lines[t].selected,c=e.shiftKey,h=s.lines[t]&&s.lines[t].live;var n=s.ast.getStatementByLine(t);if(n){var o=n.getRange();if(s.lines[t].live&&!d)if(s.lines[t].selected)for(a=0;a<s.lines.length;a++)s.lines[a].selected&&(s.lines[a].live=!1,changeClass(s.gutter.childNodes[a],"live",!1));else for(a=o[0];a<=o[1];a++)s.lines[a].live=!1,changeClass(s.gutter.childNodes[a],"live",!1);else for(var a=o[0];a<=o[1];a++)s.lines[a].selected=!d||!s.lines[a].selected,changeClass(s.gutter.childNodes[a],"select",s.lines[a].selected),changeClass(s.gutter.childNodes[a],"hover",!1)}l=setTimeout(i,1e3)}}).on("click",".eden-gutter-item",function(e){if(!this.edits){var t=parseInt(e.target.getAttribute("data-line"));s.ast.getStatementByLine(t)}}).on("mouseup",".eden-gutter-item",function(e){if(!this.edits){if(!s.ast.hasErrors()&&!d){var t=parseInt(e.target.getAttribute("data-line")),n=s.ast.getStatementByLine(t);if(!(n&&n.hasErrors()||s.lines[t].live||h)&&(s.executeSelected(),!p&&(n=s.ast.getStatementByLine(u))))for(var i=n.getRange(),o=i[0];o<=i[1];o++)s.lines[o].selected=!1,changeClass(s.gutter.childNodes[o],"select",!1)}clearTimeout(l),l=void 0,c=!1}}).on("mouseenter",".eden-gutter-item",function(e){s.ast.hasErrors()||o(parseInt(e.target.getAttribute("data-line")),e.shiftKey)}).on("mouseleave",".eden-gutter-item",function(e){a(parseInt(e.target.getAttribute("data-line")),e.shiftKey)})}function _formatVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}function _formatFramerVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}CSSUtil={},CSSUtil.setStyle=function(e,t){function n(e,t){return"-"+t.toLowerCase()}var i=e.style;if(void 0===t)i.cssText="";else if("object"==typeof t){var o=/([A-Z])/g,a=/^\w*[A-Z]\w*$/,s="";for(var r in t)if("string"==typeof t[r]){s=s+(a.test(r)?r.replace(o,n):r)+": "+t[r]+";\n"}i.cssText=s}else i.cssText=t},CSSUtil.getStyle=function(e){for(var t=document.styleSheets,n=t.length-1;n>=0;n--)for(var i=t[n].cssRules,o=i.length-1;o>=0;o--)if(i[o].type==CSSRule.STYLE_RULE&&i[o].selectorText==e)return i[o].style;var a=document.getElementById("javascript-injected-styles");if(null===a){var s=document.getElementsByTagName("body")[0];(a=document.createElement("style")).id="javascript-injected-styles",s.appendChild(a)}var r=a.sheet;return r.insertRule(e+"{ }",r.cssRules.length),r.cssRules[0].style},EdenUI.plugins.ScriptInput=function(e,t){EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var n=this;$(document.body).delegate(null,"drop",function(t){if(void 0!==t.originalEvent.dataTransfer){var n=t.originalEvent.dataTransfer.getData("selector");if(!n||""==n)return console.log(t.originalEvent.dataTransfer.files),Eden.Project.loadFromFile(t.originalEvent.dataTransfer.files[0]),void t.preventDefault();n.sp;var i=n.replace(/[^a-zA-Z0-9]+/g,"");eden.root.lookup("view_"+i+"_tabs").assign([n],eden.root.scope,EdenSymbol.hciAgent),e.createView(i,"ScriptInput"),eden.root.lookup("view_"+i+"_current").assign(0,eden.root.scope,EdenSymbol.hciAgent)}}).delegate(null,"dragover",function(e){e.preventDefault()}),this.createCommon=function(e,t,n,i){function o(e,t){t?(V.style.display="flex",N.parentNode.style.top="35px"):(V.style.display="none",N.parentNode.style.top="0")}function a(e,t){t?(F.style.display="flex",H.codearea.style.top="30px"):(F.style.display="none",H.codearea.style.top="0")}function s(e,t){H.setReadonly(t)}function r(e,t){"number"==typeof t&&t>=0&&t<z.length?(W!=t&&(W=t,H.setFragment(z[W]),H.fragment.originast&&H.fragment.originast.doxyComment&&H.fragment.originast.doxyComment.getProperty("nobuttons")&&(ne.assign(!1,eden.root.scope,EdenSymbol.localJSAgent),console.log("DISABLE BUTTONS"))),p()):(p(),-1==t&&(W=-1,H.setFragment(void 0),d(""))),c()}function l(e,t){if(Array.isArray(t)){var n=G;G=edenCopy(t);for(var i=z,o=i.filter(function(e){return-1==t.indexOf(e.selector)}),a=0;a<o.length;a++)o[a].destroy(),console.log("REMOVE FRAG",o[a].selector);z=[];for(a=0;a<t.length;a++){var s=n.indexOf(t[a]);s>=0?z.push(i[s]):z.push(new Eden.Fragment(t[a]))}W=-2,r(ee,ee.value())}}function d(t){""==t&&(t="*");var n=eden.root.lookup("view_"+e+"_query").value();void 0===n&&(n=".type(script).name");var i=Eden.Selectors.query(n,"path,name,remote,executed,type");H.outdiv.innerHTML="";for(var o=0;o<i.length;o++){var a,s=i[o][1],r="";if(s==eden.project.name)r=" project",a="&#xf0f6;";else if("ACTIVE"==s)r=" root",a="&#xf0e7;";else if(i[o][2])a="&#xf08e;";else{switch(i[o][4]){case"script":a="&#xf0f6;";break;case"when":a="&#xf1ae;";break;default:a="&#xf128;"}r=i[o][3]?" executed":""}var l=$('<div class="browse-entry" data-path="'+i[o][0]+'"><div class="browse-icon'+r+'">'+a+"</div>"+s+"</div>");H.outdiv.appendChild(l.get(0))}}function c(){if(W>=0){var e='<button class="script-button script-run" title="Run the entire script"><span class="explorer-control-icon">&#xf04b;</span>Run</button>',t=z[W];t&&t.scratch&&!t.edited?e+='<span class="scratchsearch"><input type="text" class="scratchsearch" placeholder="Populate..."></input></span>':t&&t.scratch&&(e+='<span class="editname"><input type="text" class="editname" placeholder="Enter a name..."></input></span>'),B.html(e)}else B.html("")}function u(e,t,n,i,o){var a=document.createElement("div");a.style.left=160*o+"px";var s="agent-tab noselect";s+=i?" agent-tab-current handle":" agent-tab-notcurrent";var r=z[t].getTitle();r.length>18&&(r="..."+r.slice(-15));var l;l=z[t]&&z[t].ast?z[t].ast.errors&&z[t].ast.errors.length>0?"tab-icon errored":z[t].originast&&z[t].originast.executed?"tab-icon executed":"tab-icon":"tab-icon noagent";var d="&#xf1ae;";z[t].remote?d="&#xf08e;":void 0===z[t].origin?d="&#xf0c3;":z[t].locked&&(d="&#xf023;"),a.className=s,a.innerHTML="<span class='"+l+"'>"+d+"</span>"+r+"<span class='close'>&#xf00d;</span>",a.draggable=!0,a.setAttribute("data-index",t),e.appendChild(a)}function p(){for(;V.firstChild;)V.removeChild(V.firstChild);var e=ee.value(),t=document.createElement("div");if(t.className="agent-tab-more",t.innerHTML="<span class='tab-icon2'>&#xf0c9;</span>",V.appendChild(t),z.length>3&&0!=e){var n=document.createElement("div");n.className="agent-tableft noselect",V.appendChild(n)}var i=document.createElement("div");i.className="agent-tab-container",V.appendChild(i),e>oe+(ae-1)&&(oe=e-(ae-1)),e<oe&&(oe=e);for(var o=0;o<z.length;o++){var a=z[o].getTitle();oe<=o&&u(i,o,a,o==e,o)}var s=document.createElement("div");if(s.className="agent-newtab noselect",s.style.left=160*z.length+20+"px",i.appendChild(s),z.length>3&&e!=z.length-1){var r=document.createElement("div");r.className="agent-tabright noselect",V.appendChild(r)}var l=document.createElement("div");l.className="script-input-windowcontrols",l.innerHTML="<span class='windowcontrol'>&#xf00d;</span>",V.appendChild(l)}function h(t){return"view_"+e+"_"+t}function g(){W>=0&&z[W]&&(z[W].originast?(console.log("ONRUN",z[W].originast),z[W].ast.executeStatement(z[W].originast,0,z[W])):z[W].ast.execute(z[W]),p())}function v(){ee.assign(-1,eden.root.scope,EdenSymbol.localJSAgent)}function f(e){var t=e.currentTarget.getAttribute("data-index");ee.assign(parseInt(t),eden.root.scope,EdenSymbol.hciAgent),H.intextarea.focus()}function m(e){var t=parseInt(e.currentTarget.parentNode.getAttribute("data-index"));if(t>=0&&t<z.length){var n=Q.value();n.splice(t,1),Q.assign(n,eden.root.scope,EdenSymbol.localJSAgent);var i=ee.value();i>=n.length&&ee.assign(i-1,eden.root.scope,EdenSymbol.localJSAgent)}e.stopPropagation()}function b(){var e=W;--e>=0&&ee.assign(e,eden.root.scope,EdenSymbol.hciAgent)}function y(){var e=W;++e<z.length&&ee.assign(e,eden.root.scope,EdenSymbol.hciAgent)}function w(){var e=Q.value();e.push("scratch"+se),se++,Q.assign(e,eden.root.scope,EdenSymbol.localJSAgent),ee.assign(e.length-1,eden.root.scope,EdenSymbol.localJSAgent)}function E(e){var t=parseInt(e.target.getAttribute("data-index")),n=z[t].selector;e.originalEvent.dataTransfer.setData("selector",n),le=e.originalEvent.offsetX,de=e.originalEvent.offsetY}function S(e){e.preventDefault()}function x(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.getData("selector");if(console.log("DROP"),console.log(e),t&&""!=t){var n=Q.value();-1==n.indexOf(t)&&(n.push(t),Q.assign(n,eden.root.scope,EdenSymbol.hciAgent))}else if(window.FileReader)for(var i=e.originalEvent.dataTransfer.files,o=0;o<i.length;o++){var a=i[o];if(a.name.match(/.*\.jse|.*\.js-e/)){var s=a.name.slice(0,-4);s=s.replace(/[\.\-\/\s]/g,""),s="local/file/"+s;var r=new FileReader;r.onload=function(e){new Eden.Agent(void 0,s).setSource(e.target.result,!1,-1),agent.state[obs_agent]=s},r.readAsText(a)}}}function I(e){var t=parseInt(e.target.getAttribute("data-index")),n=z[t].selector;if("none"!=e.originalEvent.dataTransfer.dropEffect){console.log("DRAGEND: "+n),console.log(e);var i=Q.value(),o=i.indexOf(n);o>=0&&(i.splice(o,1),--o<0&&(o=0),i.length,Q.assign(i,eden.root.scope,EdenSymbol.hciAgent)),i.length}}function k(e){var t=e.target.value;console.log("SCRATCH SEARCH",t),Eden.Selectors.query(t,"innersource",{minimum:1},function(e){H.intextarea.value=e.join("\n"),z[W].setSourceInitial(H.intextarea.value),H.highlighter.ast=H.fragment.ast,H.updateCachedHighlight()})}function A(e){z[W].name=e.target.value,p()}function C(e){console.log("FINISH NAME",e.target.value),z[W].makeReal(e.target.value);var t=Q.value();t[W]=z[W].selector,Q.assign(t,eden.root.scope,EdenSymbol.localJSAgent)}function _(e){var t=e.currentTarget.getAttribute("data-path"),n=Q.value(),i=n.indexOf(t);-1==i?(n.push(t),Q.assign(n,eden.root.scope,EdenSymbol.localJSAgent),ee.assign(n.length-1,eden.root.scope,EdenSymbol.localJSAgent)):ee.assign(i,eden.root.scope,EdenSymbol.localJSAgent)}function T(e){H.gutter.edits?(H.gutter.setDiffs(void 0),H.cachedhlopt=void 0,H.updateCachedHighlight()):H.makeDiff()}function D(e){H.details.toggle()}function L(e){var t=e.currentTarget.getAttribute("data-jseden");t&&""!=t&&(console.log(t),eden.execute2(t,{name:"execute"}))}function M(e){var t=e.currentTarget.getAttribute("name");t&&""!=t&&eden.root.lookup(t).assign(e.currentTarget.value,eden.root.scope,EdenSymbol.hciAgent)}console.log("CREATING",e);var U=$('<div class="inputdialogcontent"><div class="agent-tabs handle"></div><div class="scriptsubcontent">\t<div class="inputhider">\t\t<div class="control-bar noselect">\t\t</div>\t</div></div><div class="info-bar"></div></div></div>'),N=U.find(".inputhider").get(0),P=U.find(".info-bar").get(0),O=U.find(".agent-tabs"),B=U.find(".control-bar"),V=O.get(0),F=B.get(0);$(P).hide();var H=new EdenUI.ScriptArea;N.appendChild(H.contents);var R=0,j=void 0;N.addEventListener("scroll",function(e){void 0!==j&&clearTimeout(j),document.activeElement!==H.outdiv&&(j=setTimeout(function(){j=void 0;var e=N.scrollTop;(e=Math.floor((e-50)/20))<0&&(e=0),Math.abs(e-R)>=50&&(console.log("FORCE RE HIGHLIGHT",e),H.highlighter.setScrollTop(e),R=e,H.updateCachedHighlight(),H.gutter.clear())},100))});var W=-1,G=[],z=[],J="view_"+e+"_current",q="view_"+e+"_showtabs",K="view_"+e+"_showbuttons",Y="view_"+e+"_tabs",X="view_"+e+"_zoom",Z="view_"+e+"_readonly",Q=eden.root.lookup(Y),ee=(eden.root.lookup(X),eden.root.lookup(J)),te=eden.root.lookup(q),ne=eden.root.lookup(K),ie=eden.root.lookup(Z),oe=0,ae=3,se=1;void 0===te.value()&&void 0===te.definition&&te.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),te.addJSObserver("scriptview_"+e,o),o(te,te.value()),void 0===ne.value()&&void 0===ne.definition&&ne.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),ne.addJSObserver("scriptview_"+e,a),a(ne,ne.value()),ie.addJSObserver("scriptview_"+e,s),s(ie,ie.value()),ee.addJSObserver("scriptview_"+e,r),Q.addJSObserver("scriptview_"+e,l),l(Q,Q.value()),void 0===Q.value()&&void 0===Q.definition&&Q.assign([],eden.root.scope,EdenSymbol.defaultAgent),void 0===ee.value()&&void 0===ee.definition&&ee.assign(-1,eden.root.scope,EdenSymbol.defaultAgent),Eden.Fragment.listenTo("changed",H,function(e){e===z[W]&&(p(),c(),H.refresh())}),Eden.Fragment.listenTo("locked",H,function(e){e===z[W]&&(console.log("LOCKED",e),r(ee,ee.value()))}),Eden.Fragment.listenTo("unlocked",H,function(e){e===z[W]&&r(ee,ee.value())}),Eden.Fragment.listenTo("errored",H,function(e){}),Eden.Fragment.listenTo("status",H,function(e){e===z[W]&&(p(),c())}),Eden.Fragment.listenTo("gotoline",H,function(e,t){for(var n=0;n<z.length;n++)if(e===z[n]){console.log("I have the goto frag"),W!=n&&ee.assign(n,eden.root.scope,EdenSymbol.localJSAgent),H.gotoLine(t);var i=50+20*(t-5);i<0&&(i=0),N.scrollTop=i;break}}),void 0===eden.root.lookup("view_"+e+"_query").definition&&eden.execute("view_"+e+"_query is jseden_script_query;");var re=[h("tabs"),h("current"),h("showtabs"),h("showbuttons"),h("zoom")];U.get(0).setAttribute("data-observables",re.join(","));var le,de;B.on("keyup","input.editname",A).on("change","input.editname",C).on("click",".script-run",g).on("click",".script-changes",T).on("click",".script-details",D).on("keyup","input.scratchsearch",k),U.on("click","button,.executable,a",L).on("input","textarea,input",M).on("click",".close",m).on("click",".agent-tab-more",v).on("click",".browse-entry",_).on("click",".agent-tab",f).on("click",".agent-tableft",b).on("click",".agent-tabright",y).on("click",".agent-newtab",w).on("dragstart",".agent-tab",E).on("dragend",".agent-tab",I).on("dragover",S).on("drop",x);var ce={contents:U,update:function(t){if(void 0===ee.value()){var n="view/script/"+e;Eden.Agent.importAgent(n,"default",["noexec","create"],function(e){agent.state[obs_agent]=n,t instanceof EdenSymbol?(agent.setScope(t.getValueScope(eden.root.scope)),intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(agent.code),updateEntireHighlight()):t instanceof Array?(intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(t),updateEntireHighlight()):"string"==typeof t&&(intextarea.value=t,updateEntireHighlight())})}},destroy:function(){console.log("CLOSE SCRIPT"),clearInterval(H.gutterinterval);for(var t=0;t<z.length;t++)z[t].unlock(),z[t].ast&&z[t].ast.destroy();scriptast=void 0,z=void 0,Eden.Fragment.unListen(H),H=void 0,ee.removeJSObserver("scriptview_"+e),Q.removeJSObserver("scriptview_"+e)},resize:function(e,t){t&&t.size&&(ae=Math.floor((t.size.width-90)/160))},setValue:function(e){intextarea.value=e,updateEntireHighlight()}};return H.updateEntireHighlight(),ce},this.createDialog=function(t,i,o){function a(e,t){return root.lookup("view_"+e+"_"+t)}var s=t.slice(0,-7),r=n.createCommon(s,i,o,!1,!1),l=405;if(o){var d=r.contents.find("textarea").val().split("\n").length;l=EdenUI.plugins.ScriptInput.getRequiredHeight(d+1)}return r.contents.on("click",".windowcontrol",function(){e.hideView(s,!0)}),$dialog=$('<div id="'+t+'"></div>').html(r.contents).dialog({appendTo:"#jseden-views",title:i,width:600,height:l,minHeight:203,minWidth:300,classes:{"ui-dialog":"input-dialog ui-front no-print"},resizeStop:r.resize,draggable:!1}),$dialog.parent().draggable({handle:".handle",cancel:".agent-tab-notcurrent",stop:function(e,t){var n=eden.root;n.beginAutocalcOff(),a(s,"x").assign(t.position.left,eden.root.scope,EdenSymbol.hciAgent),a(s,"y").assign(t.position.top,eden.root.scope,EdenSymbol.hciAgent),n.endAutocalcOff()},start:function(e,t){if(a(s,"x").eden_definition||a(s,"y").definition)return!1}}),r.confirmClose=!1,r},this.createEmbedded=function(e,t,i){return n.createCommon(e,t,i,!0)},e.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:e.viewCategories.interpretation,menuPriority:0},e.history=this.history,t()},EdenUI.plugins.ScriptInput.getRequiredHeight=function(e,t){return t?55+20*e+20:45+20*e+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog script-subdialog-newagent noselect"><span class="script-subdialog-title">Create Tab:</span><div class="script-subdialog-panel"><button>Scratch</button></div><div class="script-subdialog-panel"><input class="namebox" type="text" spellcheck="false" placeholder="New Tab"></input><button class="button-new">New</button></div><div class="script-subdialog-panel"><input type="text" class="searchbox" spellcheck="false" placeholder="Search"></input><button class="button-search">Load</button><br/></div></div>'),o=i.find(".searchbox").get(0),a=i.find(".namebox").get(0);i.on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),i.on("click",".button-search",function(){e.get(0).removeChild(n.get(0)),t(!0,o.value)}),i.on("click",".button-new",function(){eden.project.addAction(a.value),e.get(0).removeChild(n.get(0)),t(!0,"."+a.value)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.localChanges=function(e,t,n){EdenUI.plugins.ScriptInput.dialogs.hide&&EdenUI.plugins.ScriptInput.dialogs.hide();var i=$('<div class="script-obscurer noselect"></div>'),o=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-text">You have local changes to '+n.name+', use these?</span><br><br><button class="button-icon-green button-ok">Yes</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">No</button></div>');o.on("click",".button-ok",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!1)}),i.append(o),e.append(i),EdenUI.plugins.ScriptInput.dialogs.hide=function(){EdenUI.plugins.ScriptInput.dialogs.hide=void 0,e.get(0).removeChild(i.get(0)),t(!1)}},EdenUI.plugins.ScriptInput.dialogs.uploadFailed=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload Failed! Try again...</span><br><br><button class="button-icon-green button-upload">Retry</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>');i.on("click",".button-upload",function(){e.get(0).removeChild(n.get(0)),t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.uploadAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload agent. Give an optional version name:</span><br/><input class="script-subdialog-text tagname" type="text" spellcheck="false"></input><span class="status missing"></span><br><input class="script-subdialog-check makepublic" type="checkbox">Public</input><br><br><button class="button-icon-green button-upload">Upload</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>'),o=i.find(".tagname"),a=i.find(".makepublic"),s=o.get(0).nextSibling,r=!0;i.on("input blur",".script-subdialog-text",function(){var e=o.get(0).value;console.log(e),""==e?(r=!0,s.className="addnew"):/^[a-z][a-z0-9]+$/i.test(e)?(s.className="addnew",r=!0):(s.className="invalid",r=!1)}).on("click",".button-upload",function(){r&&(e.get(0).removeChild(n.get(0)),t(!0,o.get(0).value,a.get(0).checked))}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(e,t,n){function i(){for(var e=d.get(0);e.firstChild;)e.removeChild(e.firstChild);s=void 0}function o(e){if(n.history[e])for(var t=n.history[e].length-1;t>=0;t--){var i=$('<div class="script-history-item"></div>');c==t&&(i.addClass("current"),i.addClass("original"),s=i),i.get(0).setAttribute("data-index",""+t);var o=$('<div class="script-history-bookmark"></div>'),a=$('<div class="script-history-time"></div>'),r=$('<div class="script-history-content"></div>');a.html(get_time_diff(n.history[e][t].time)),a.get(0).title=n.history[e][t].time,n.history[e][t].bookmark&&o.addClass("bookmarked"),n.history[e][t].title?r.html(n.history[e][t].title):r.html("[Autosave]"),i.append(o),i.append(r),i.append(a),d.append(i)}}function a(e){if(Eden.DB.getVersions(n.name,function(t){if(null!=t)for(var n=0;n<t.length;n++){var i=$('<div class="script-history-item"></div>');t[n].saveID==u&&(i.addClass("original"),-1==c&&(i.addClass("current"),s=i)),i.get(0).setAttribute("data-version",""+t[n].saveID);var a="script-history-stored";0==t[n].public?a+=" private":t[n].mine?a+=" mine":a+=" public";var r=$('<div class="'+a+'"></div>'),l=t[n].date.split(/[- :]/),p=$('<div class="script-history-time">'+get_time_diff(new Date(l[0],l[1]-1,l[2],l[3],l[4],l[5]).getTime()/1e3)+"</div>"),h=t[n].tag;null==t[n].tag&&(h=t[n].saveID);var g=$('<div class="script-history-content">'+h+" ("+t[n].saveID+") by "+t[n].name+"</div>");i.append(r),i.append(g),i.append(p),d.append(i),t[n].saveID==u&&o(e)}}),n.history.origin){var t=$('<div class="script-history-item"></div>');"origin"==u&&(t.addClass("original"),-1==c&&(t.addClass("current"),s=t)),t.get(0).setAttribute("data-version","origin");var i=$('<div class="script-history-bookmark"></div>'),a="origin";n.meta&&n.meta.file&&(a=n.meta.file);var r=$('<div class="script-history-content">'+a+"</div>");t.append(i),t.append(r),d.append(t),"origin"==u&&o("origin")}}var s,r=$('<div class="script-obscurer noselect"></div>'),l=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),d=l.find(".script-history-list"),c=n.index,u=n.meta.saveID;a(n.meta.saveID),l.on("input",".script-history-content",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));n.history[n.meta.saveID][t].title=e.target.textContent,n.saveHistory(),n.makeSnapshot(t)}).on("click",".script-history-item",function(e){var t=e.currentTarget.getAttribute("data-version");if(t)"origin"!=t&&(t=parseInt(t)),u=t,i(),c=-1,a(u);else{var n=parseInt(e.currentTarget.getAttribute("data-index"));c=n,s&&s.removeClass("current"),(s=$(e.currentTarget)).addClass("current")}}).on("click",".script-history-bookmark",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));void 0===n.history[n.meta.saveID][t].bookmark?n.history[n.meta.saveID][t].bookmark=!0:n.history[n.meta.saveID][t].bookmark=!n.history[n.meta.saveID][t].bookmark,n.saveHistory(),n.history[n.meta.saveID][t].bookmark?e.target.className="script-history-bookmark bookmarked":e.target.className="script-history-bookmark"}).on("click",".button-ok",function(){e.get(0).removeChild(r.get(0)),console.log("Rollback to: "+c+"@"+u),t(!0,c,u)}).on("click",".button-cancel",function(){e.get(0).removeChild(r.get(0)),t(!1)}),r.append(l),e.append(r)},EdenUI.plugins.ScriptInput.dialogs.browseAgents=function(e,t,n){function i(e,t,i){Eden.DB.getDirectory(i,function(o){if(void 0!==o){var a=[];for(var s in o)a.push(s);a.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});for(var r=0;r<a.length;r++){var d=""==i?a[r]:i+"/"+a[r],c=a[r],u=$('<div class="script-agents-item"></div>'),p=$('<div class="script-agents-expand" style="width: '+(27+15*t)+'px"></div>'),h=$('<div class="script-agents-content"></div>'),g=$('<div class="script-agents-cbcont"></div>');(function(e,t,i,o,a){Eden.DB.getMeta(t,function(t,a){if(a){var s="";if(a.date){var r=a.date.split(/[- :]/);s=get_time_diff(new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]).getTime()/1e3)}var l=a.title;if("Script View"!=l&&void 0!==l||(l=""),e.html(i+' <span class="script-agents-title">'+l+'</span><span class="script-agents-date">'+s+"</span>"),a.remote&&-1==a.defaultID&&-1==a.latestID)o.html("&nbsp;");else{var d=$('<input type="checkbox"></input>');o.append(d),n.indexOf(t)>=0&&(d.get(0).checked=!0)}}else e.html(i),o.html("&nbsp;")})}).call(this,h,d,c,g,p),Eden.Agent.agents[d]&&u.addClass("loaded"),u.get(0).setAttribute("data-path",d),u.get(0).setAttribute("data-depth",""+(t+1)),u.append(p),u.append(g),u.append(h),void 0===e||void 0===e.nextSibling?l.append(u):l.get(0).insertBefore(u.get(0),e.nextSibling)}}})}function o(e){for(var t=parseInt(e.getAttribute("data-depth")),n=e.nextSibling;n&&parseInt(n.getAttribute("data-depth"))>t;){var i=n.nextSibling;l.get(0).removeChild(n),n=i}}function a(){e.append(s),l.scrollTop(d)}var s=$('<div class="script-obscurer noselect"></div>'),r=$('<div class="script-subdialog-agents noselect"><span class="script-subdialog-title">'+Language.ui.input_window.browse_agents+':</span><br/><div class="script-agents-list"></div><div class="script-agents-buttons"><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),l=r.find(".script-agents-list"),d=0,c={};return i(void 0,0,""),r.on("click",".script-agents-item",function(e){}).on("click",".script-agents-expand",function(e){var t=e.currentTarget.parentNode.getAttribute("data-path"),n=parseInt(e.currentTarget.parentNode.getAttribute("data-depth"));e.currentTarget.className.indexOf("expanded")<0?(i(e.currentTarget.parentNode,n,t),changeClass(e.currentTarget,"expanded",!0)):(o(e.currentTarget.parentNode),changeClass(e.currentTarget,"expanded",!1))}).on("change",".script-agents-cbcont input",function(e){var t=e.currentTarget.parentNode.parentNode.getAttribute("data-path");e.currentTarget.checked?c[t]=!0:c[t]=!1}).on("click",".button-add",function(){d=l.scrollTop(),e.get(0).removeChild(s.get(0)),t(!0,c)}).on("click",".button-cancel",function(){d=l.scrollTop(),e.get(0).removeChild(s.get(0)),t(!1)}),s.append(r),{show:a}},EdenScriptGutter.prototype.clear=function(){for(this.ast=void 0,this.lines=[],this.curline=-1,this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild)},EdenScriptGutter.prototype.setBaseAST=function(e,t){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);this.ast=e,this.errors=t,this.lines=[],this.edits=void 0,this.hideBrace()},EdenScriptGutter.prototype.executeSelected=function(){if(void 0!==this.ast)for(var e=0;e<this.lines.length;e++)if(this.lines[e].selected){var t=this.ast.getStatementByLine(e),n=this.ast.getStatementByLine(e).getRange();eden.project.ast.executeStatement(t,e,eden.project),e=n[1],eden.root.lookup("jseden_fragment_executed").assign(".id("+t.id+")",eden.root.scope,EdenSymbol.hciAgent)}},EdenScriptGutter.prototype.showBrace=function(e,t){this.brace.style.display="block";var n=this.lineelements.childNodes[e].offsetTop;this.brace.style.top=n+"px";var i=this.lineelements.childNodes[t].offsetTop+this.lineelements.childNodes[t].clientHeight;i-=n,this.brace.setAttribute("height",""+i),this.bracepath.setAttribute("d",makeCurlyBrace(20,4,20,i-4,20,.52))},EdenScriptGutter.prototype.hideBrace=function(){this.brace.style.display="none"},EdenScriptGutter.prototype.selectLine=function(e,t){if(!(this.edits||this.ast.errors.length>0)){if(this.curline>=0&&(o=this.ast.getStatementByLine(this.curline))){var n=o.getRange(),i=Math.floor((n[1]-n[0])/2)+n[0];t||(changeClass(this.gutter.childNodes[i],"play",!1),changeClass(this.gutter.childNodes[i],"current",!1))}this.curline=e-1;var o=this.ast.getStatementByLine(e-1);if(o)if(o.getRange||console.error("NO GETRANGE",o),(n=o.getRange())[0]<n[1])this.showBrace(n[0],n[1]);else if(this.hideBrace(),o){i=Math.floor((n[1]-n[0])/2)+n[0];changeClass(this.gutter.childNodes[i],"play","true"),t||changeClass(this.gutter.childNodes[i],"current","true")}}},EdenScriptGutter.prototype.setDiffs=function(e){this.edits=e;for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);if(void 0!==e){this.hideBrace();for(var t=0,n=0,i=this.ast.lines.length+Object.keys(e.remove).length,o=!1,a=0;a<i;a++){if(e.remove[n]&&e.remove[n].nline<=t){d="eden-gutter-item removed";(l=document.createElement("div")).className=d,l.textContent=e.remove[n].rline,this.gutter.appendChild(l);for(var s=e.remove[n].chars,r=0;r<s.length;r++)(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(255,0,0,0.3)",u.style.height="20px",u.style.width=s[r].length*this.textwidth+"px",u.style.top="0px",u.style.left=s[r].start*this.textwidth+43+"px",l.appendChild(u);if(!e.remove[n].partial){n++;continue}n++,o=!0}var l=document.createElement("div"),d="eden-gutter-item";if(o||e.insert[t]){d+=" inserted";var c=!1;if(e.insert[t])for(var s=e.insert[t].chars,r=0;r<s.length;r++){var u=document.createElement("div");u.style.position="absolute",u.style.background="rgba(0,255,0,0.3)",u.style.height="20px",u.style.width=s[r].length*this.textwidth+"px",c=c||0==s[r].length&&!e.insert[t].partial,u.style.top="0px",u.style.left=s[r].start*this.textwidth+43+"px",l.appendChild(u)}e.insert[t]&&e.insert[t].partial&&!o&&n++}else n++;o=!1,l.className=d,l.setAttribute("data-line",""+t),this.gutter.appendChild(l),t++,void 0===this.lines[t]&&(this.lines[t]={selected:!1,live:!1})}}},EdenScriptGutter.prototype.updateLine=function(e,t){var n="eden-gutter-item",i=this.ast,o="",a=t,s=void 0,r=i.getStatementByLine(e);r?(r.errors.length>0?(r.errors[0].line==e+1?(n+=" error",o="&#xf06a",s=r.errors[0].messageText(),e):"runtime"==r.errors[0].type&&(n+=" error",o="&#xf06a",s=r.errors[0].messageText()),this.lines[e].errored=!0,a=!0):(i.errors.length>0&&i.errors[0].line==e+1&&(this.lines[e].errored=!0,n+=" error",o="&#xf06a",s=i.errors[0].messageText()),this.lines[e].errored&&(a=!0,this.lines[e].errored=!1),r.warning&&(n+=" warning",o="&#xf071",a=!0,r.warning&&(s=r.warning.messageText())),1==r.executed?(n+=" executed",a=!0,this.lines[e].executed=!0):2==r.executed?(n+=" guarded",a=!0,this.lines[e].executed=!0):3==r.executed&&(n+=" errorblock",a=!0)),this.lines&&this.lines[e]&&(this.lines[e].executed&&r.executed<=0&&(a=!0,this.lines[e].executed=!1),this.lines[e].selected&&(n+=" select"),this.lines[e].live&&(n+=" live"))):(this.errors&&this.errors.length>0&&this.errors[0].line==e+1?this.lines[e].errored||(n+=" error",o="&#xf06a",s=this.errors[0].messageText(),e,this.lines[e].errored=!0,a=!0):this.lines[e].errored&&(a=!0,this.lines[e].errored=!1,s=""),this.lines[e].executed&&(a=!0,this.lines[e].executed=!0));a&&(this.gutter.childNodes[e].className.indexOf("hover")>=0&&(n+=" hover"),this.gutter.childNodes[e].className.indexOf("play")>=0&&(n+=" play"),this.gutter.childNodes[e].className.indexOf("current")>=0&&(n+=" current"),this.gutter.childNodes[e].innerHTML=o,this.gutter.childNodes[e].className=n,s&&(this.gutter.childNodes[e].title=s))},EdenScriptGutter.prototype.generate=function(e,t){if(this.ast=e,!this.edits){var n=!1,i=e.getNumberOfLines()+1;if(i>this.lineelements.childNodes.length&&(i=this.lineelements.childNodes.length),i!=this.gutter.childNodes.length){for(this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(a=0;a<i;a++){var o=document.createElement("div");o.className="eden-gutter-item",o.setAttribute("data-line",""+a),o.style.height=this.lineelements.childNodes[a].clientHeight+"px",this.gutter.appendChild(o),void 0===this.lines[a]&&(this.lines[a]={selected:!1,live:!1,executed:!1,errored:!1})}n=!0}for(var a=0;a<i;a++)this.updateLine(a,n);this.ast.errors.length>0?this.hideBrace():this.hovering||this.selectLine(t)}},EdenUI.ScriptArea=function(){this.contents=document.createElement("div"),this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contenteditable=!0,this.outdiv.className="outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.fragment=void 0,this.readonly=!1,this.alwaysreadonly=!1,this.currentlineno=-1,this.currentcharno=-1,this.gotomode=!1,this.highlighter=new EdenUI.Highlight(this.outdiv),this.gutter=new EdenScriptGutter(this.codearea,this.infobox,this.outdiv),this.details=new EdenUI.ScriptArea.Details(this),this.cachedhlopt=void 0,this.disablehl=!1,this.highlighter.setScrollTop(0);var e=this;this.gutterinterval=setInterval(function(){if(void 0!==e.fragment&&void 0!==e.fragment.ast){e.gutter.generate(e.fragment.ast.script,e.currentlineno);for(var t in e.highlighter.metrics)if(e.currentlineno!=t){var n=e.highlighter.metrics[t];if(n.query)for(var i=0;i<n.qelements.length;i++){var o=n.qelements[i].getAttribute("data-query"),a=n.qelements[i].getAttribute("data-attribs"),s=Eden.Selectors.query(o,null!==a&&a.length>0?a:"value");s=1==s.length?s[0]:s.length>1?s.join(", "):"",n.qelements[i].setAttribute("data-result",s)}n.squery&&e.highlightContent(t,e.intextarea.selectionEnd)}}},300);new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.rebuildinterval=400},EdenUI.ScriptArea.prototype.setReadonly=function(e){this.alwaysreadonly=e,!0===e?(this.readonly=!0,this.outdiv.contentEditable=!1):(this.readonly=!!this.fragment&&this.fragment.locked,this.outdiv.contentEditable=!this.readonly,"comment"==e&&this.updateEntireHighlight())},EdenUI.ScriptArea.prototype.setFragment=function(e){if(this.fragment&&this.fragment!==e&&(this.fragment.unlock(),this.currentlineno=-1),this.details.hide(),this.fragment=e,void 0===e)return this.gutter.clear(),changeClass(this.outdiv,"browser",!0),this.outdiv.contentEditable=!1,void(this.readonly=!0);var t=this;e.reset(function(){changeClass(t.outdiv,"browser",!1),t.intextarea.value=e.getSource(),e.ast&&(t.highlightContent(-1,0),t.intextarea.focus(),t.checkScroll(),t.gutter.setBaseAST(e.ast.script)),e.locked?(t.readonly=!0,t.outdiv.contentEditable=!1):(t.readonly=!0===t.alwaysreadonly,t.outdiv.contentEditable=!t.readonly)})},EdenUI.ScriptArea.prototype.refresh=function(){this.intextarea.value=this.fragment.getSource(),this.fragment.ast&&this.highlightContent(-1,0)},EdenUI.ScriptArea.prototype.updateSource=function(e,t){this.fragment.setSource(e),this.gutter.errors=this.fragment.ast.errors,this.highlighter.ast=this.fragment.ast},EdenUI.ScriptArea.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.updateSource(this.intextarea.value,e),this.runScript(e),this.highlightContent(e,t)},EdenUI.ScriptArea.prototype.runScript=function(e){if(this.gutter.lines[e-1]&&this.gutter.lines[e-1].live&&!this.fragment.ast.hasErrors()){var t=this.fragment.ast.script.getStatementByLine(e-1);this.fragment.ast.executeStatement(t,e,this.fragment)}},EdenUI.ScriptArea.prototype.hideInfoBox=function(){},EdenUI.ScriptArea.prototype.updateLineCachedHighlight=function(){if(this.fragment){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(e,t)}},EdenUI.ScriptArea.prototype.updateEntireHighlight=function(e,t){if(void 0!==this.fragment){this.cachedhlopt=t,this.updateSource(this.intextarea.value,-1);var n=-1;document.activeElement===this.intextarea&&(n=this.intextarea.selectionEnd),e&&runScript(0),this.highlightContent(-1,n,t)}},EdenUI.ScriptArea.prototype.updateCachedHighlight=function(e){var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),this.highlightContent(-1,t,e||this.cachedhlopt)},EdenUI.ScriptArea.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;return parseInt(t.getAttribute("data-line"))},EdenUI.ScriptArea.prototype.replaceLine=function(e,t){var n=this.intextarea.value.split("\n");n[e]=t,this.intextarea.value=n.join("\n")},EdenUI.ScriptArea.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.ScriptArea.prototype.focusText=function(){if(!this.readonly){var e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=t,t!=e&&(this.refreshentire=!0)}},EdenUI.ScriptArea.prototype.toggleHighlighting=function(){this.disablehl=!this.disablehl,this.updateEntireHighlight(),this.gutter.clear()},EdenUI.ScriptArea.prototype.highlightContent=function(e,t,n){if(this.fragment){var i=this.fragment.ast;if(i){if(void 0===n&&this.disablehl&&(n={}),this.disablehl&&(n.disabled=!0),this.highlighter.highlight(i,e,t,n),document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret"),"comment"==this.alwaysreadonly)for(var o=$(this.outdiv).find(".eden-comment-line"),a=0;a<o.length;a++)o[a].contentEditable=!1;this.delayRebuild()}}},EdenUI.ScriptArea.prototype.moveCaret=function(){this.updateLineCachedHighlight(),this.checkScroll()},EdenUI.ScriptArea.prototype.selectAll=function(){this.outdiv.focus();var e=document.createRange();e.selectNodeContents(this.outdiv);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},EdenUI.ScriptArea.prototype.makeNumbersDrag=function(){var e=this;this.readonly||$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(t,n){if(!e.readonly){var i;if((i=e.dragint?Math.round(e.dragvalue+(n.position.left-e.dragstart)/2):(i=e.dragvalue+.005*(n.position.left-e.dragstart)).toFixed(4))!=e.draglast){e.draglast=i,t.target.innerHTML=""+i;var o=t.target.parentNode.textContent;"\n"==o.charAt(o.length-1)&&(o=o.slice(0,-1)),e.replaceLine(e.dragline,o),e.updateSource(e.intextarea.value,e.dragline),e.runScript(e.dragline+1),e.highlightContent(e.dragline,-1)}}},start:function(t,n){if(!e.readonly){e.edited=!0,e.dragline=e.findElementLineNumber(t.target),e.dragstart=n.position.left;var i=t.target.textContent;-1==i.indexOf(".")?(e.dragvalue=parseInt(i),e.dragint=!0):(e.dragvalue=parseFloat(i),e.dragint=!1),e.draglast=e.dragvalue,$(t.target).addClass("eden-select"),$(e.outdiv).css("cursor","ew-resize")}},stop:function(t,n){e.readonly||($(t.target).removeClass("eden-select"),$(e.outdiv).css("cursor","text"),e.dragline=-1)},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptArea.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.ScriptArea.prototype.gotoLine=function(e){var t=this.intextarea.value.split("\n");t.length=e+1;var n=t.join("\n").length;this.intextarea.focus(),this.intextarea.selectionEnd=n,this.intextarea.selectionStart=n,this.updateLineCachedHighlight()},EdenUI.ScriptArea.prototype.checkScroll=function(){var e=$(this.outdiv.childNodes[this.currentlineno-1]).find(".fake-caret").get(0);if(void 0!==e){for(var t=this.contents.parentNode,n=e.offsetLeft-t.scrollLeft+25,i=t.clientWidth+t.scrollLeft-e.offsetLeft-25;e.parentNode!=this.outdiv;)e=e.parentNode;var o=e.offsetTop-t.scrollTop+15,a=t.clientHeight+t.scrollTop-e.offsetTop-15;n<80&&(t.scrollLeft=t.scrollLeft-(80-n)),i<80&&(t.scrollLeft=t.scrollLeft+(80-i)),o<40&&(t.scrollTop=t.scrollTop-(40-o)),a<40&&(t.scrollTop=t.scrollTop+(40-a))}},EdenUI.ScriptArea.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0);if(e){var t=document.createRange(),n=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),n.removeAllRanges(),n.addRange(t),$(this.outdiv).remove(".fake-caret")}},EdenUI.ScriptArea.prototype.makeDiff=function(){var e={},t=this.fragment.diff();for(var n in t.remove)if(!t.remove[n].consecutive){var i=parseInt(n),o=0,a=20;do{a+=20,o++}while(t.remove[i+o]&&t.remove[i+o].consecutive);e[t.remove[n].nline+0]=a}this.gutter.setDiffs(t),this.cachedhlopt={spacing:e},this.updateCachedHighlight()},EdenUI.ScriptArea.prototype.doRebuild=function(){this.makeNumbersDrag()},EdenUI.ScriptArea.prototype.delayRebuild=function(){var e=this;clearTimeout(this.rebuildtimer),this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptArea.prototype.rebuild=function(){this.gutter.edits?(this.updateSource(this.intextarea.value,-1),this.gutter.ast=this.fragment.ast,this.makeDiff()):(this.edited=!0,this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight(),this.checkScroll(),this.dirty=!1)},EdenUI.ScriptArea.prototype.enableGotoMode=function(){this.gotomode||(this.outdiv.contentEditable=!1,changeClass(this.outdiv,"goto",!0),this.gotomode=!0)},EdenUI.ScriptArea.prototype.disableGotoMode=function(){this.gotomode&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv,"goto",!1),this.gotomode=!1)},EdenUI.ScriptArea.prototype.insertTab=function(){var e=this.intextarea.selectionStart,t=this.intextarea.selectionEnd;this.intextarea.value=this.intextarea.value.substring(0,e)+"\t"+this.intextarea.value.substring(t),this.intextarea.selectionStart=this.intextarea.selectionEnd=e+1,this.rebuild()},EdenUI.ScriptArea.Details=function(e){this.scriptarea=e,this.contents=document.createElement("div"),this.contents.className="script-details",this.contents.addEventListener("keyup",function(e){var t=e.target.parentNode.getAttribute("data-name"),n=e.target.value;console.log("CHANGE PROP",t,n)}),this.visible=!1},EdenUI.ScriptArea.Details.prototype.addProperty=function(e,t,n,i){var o=document.createElement("div");o.className="script-details-prop",o.setAttribute("data-name",e);var a=document.createElement("div");a.className="script-details-label",a.textContent=t,o.appendChild(a);var s=document.createElement("input");s.className="script-details-value",s.value=n||"",s.setAttribute("type","text"),i&&i.readonly&&(s.className+=" script-details-readonly",s.setAttribute("readonly","true")),o.appendChild(s);var r=document.createElement("div");return r.className="script-details-status",i&&i.readonly?r.innerHTML="&#xf023;":r.innerHTML="&#xf00c;",o.appendChild(r),this.contents.appendChild(o),o},EdenUI.ScriptArea.Details.prototype.clear=function(){for(;this.contents.lastChild;)this.contents.removeChild(this.contents.lastChild)},EdenUI.ScriptArea.Details.prototype.addButtons=function(){var e=document.createElement("div");e.className="script-details-buttons";var t=document.createElement("button");t.className="script-button",t.innerHTML='<span class="explorer-control-icon">&#xf00d;</span>Close',e.appendChild(t),this.contents.appendChild(e)},EdenUI.ScriptArea.Details.prototype.show=function(){this.clear(),this.addProperty("name","Name",this.scriptarea.fragment.name),this.addProperty("selector","Path",this.scriptarea.fragment.selector,{readonly:!0}),this.scriptarea.fragment.originast&&this.addProperty("id","Full Name",Eden.Selectors.getID(this.scriptarea.fragment.originast),{readonly:!0});var e=this.scriptarea.fragment.doxy;if(e){this.addProperty("desc","Description",e.stripped()),this.addProperty("tags","Tags",e.getHashTags().join(" "));var t=e.getControls();for(var n in t)this.addProperty(n,n.substring(1),t[n])}this.addButtons(),this.scriptarea.codearea.appendChild(this.contents),changeClass(this.scriptarea.outdiv,"blur",!0),this.visible=!0},EdenUI.ScriptArea.Details.prototype.hide=function(){this.visible&&(this.scriptarea.codearea.removeChild(this.contents),this.visible=!1,changeClass(this.scriptarea.outdiv,"blur",!1))},EdenUI.ScriptArea.Details.prototype.toggle=function(){this.visible?this.hide():this.show()},EdenUI.ScriptArea.Keyboard=function(e){function t(e){var t=e.key;return e.shiftKey&&(t="Shift-"+t),e.altKey&&(t="Alt-"+t),(e.ctrlKey||e.metaKey)&&(t="Ctrl-"+t),t}function n(n){switch(t(n)){case"Tab":n.preventDefault(),e.insertTab();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":e.moveCaret();break;case"Ctrl-a":e.selectAll(),n.preventDefault();break;case"Ctrl-h":e.toggleHighlighting(),n.preventDefault();break;case"Ctrl-Shift-ArrowLeft":case"Ctrl-Shift-ArrowRight":case"Ctrl-Shift-ArrowUp":case"Ctrl-Shift-ArrowDown":case"Ctrl-Shift-Home":case"Ctrl-Shift-End":case"Shift-ArrowLeft":case"Shift-ArrowRight":case"Shift-ArrowUp":case"Shift-ArrowDown":case"Shift-Home":case"Shift-End":e.focusOutput();break;case"Backspace":e.refreshentire=10==e.intextarea.value.charCodeAt(e.intextarea.selectionStart-1);break;case"Enter":e.refreshentire=!0;break;case"Ctrl-Control":e.enableGotoMode()}}function i(t){e.refreshentire=!0}function o(n){var i=t(n);switch(n.ctrlKey||e.disableGotoMode(),i){case"Ctrl-Control":e.disableGotoMode();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":e.updateLineCachedHighlight(),e.gutter&&e.gutter.selectLine(e.currentlineno),e.checkScroll()}}function a(t){"INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(!t.shiftKey||37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode&&35!=t.keyCode&&36!=t.keyCode)&&"Control"!=t.key&&"Shift"!=t.key&&"c"!=t.key&&e.focusText()}function s(t){e.intextarea.focus(),setTimeout(function(){e.updateEntireHighlight()},0)}function r(t){"INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(17!=t.keyCode&&91!=t.keyCode&&92!=t.keyCode||e.disableGotoMode())}function l(t){$(e.outdiv).find(".fake-caret").remove()}function d(t){e.dirty=!0,e.rebuild()}function c(e){}e.intextarea.addEventListener("input",d),e.intextarea.addEventListener("keydown",n),e.intextarea.addEventListener("keyup",o),e.intextarea.addEventListener("paste",i),e.outdiv.addEventListener("keydown",a),e.outdiv.addEventListener("keyup",r),e.outdiv.addEventListener("paste",s),e.intextarea.addEventListener("blur",l),e.intextarea.addEventListener("focus",c)},EdenUI.ScriptArea.Mouse=function(e){function t(t){e.readonly}function n(t){if("INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(e.hideInfoBox(),!e.readonly&&0!=t.target.isContentEditable))if(e.gotomode){var n=t.target;if(""==n.className&&"SPAN"==n.parentNode.nodeName&&(n=n.parentNode),"eden-selector"==n.className||"eden-selector2"==n.className){e.disableGotoMode();var i=n.parentNode.textContent;Eden.Selectors.goto(i)}else if("eden-observable"==n.className){var o=n.getAttribute("data-observable");Eden.Selectors.goto(o+":active")}t.preventDefault()}else if(document.activeElement===e.outdiv){var a=getCaretCharacterOffsetWithin(e.outdiv);if(getStartCaretCharacterOffsetWithin(e.outdiv)!=a)e.refreshentire=!0;else{e.intextarea.focus(),e.intextarea.selectionEnd=a,e.intextarea.selectionStart=a;e.currentlineno;e.updateLineCachedHighlight()}}}e.outdiv.addEventListener("mouseup",n),e.outdiv.addEventListener("mousedown",t)},EdenUI.plugins.PluginManager=function(e,t){this.createDialog=function(t,n){var i,o,a=$('<div class="projectlist-results noselect"></div>'),s=function(t){return e.plugins[t]?"(loaded)":"(not loaded)"};pluginNames=Object.keys(EdenUI.plugins).sort(function(t,n){var i=e.plugins[t],o=e.plugins[n];return i&&!o?1:o&&!i?-1:t<n?-1:t==n?0:1});for(var r=0;r<pluginNames.length;r++){o=pluginNames[r],i=EdenUI.plugins[o];var l='<div class="projectlist-result-element'+(o in e.plugins?" pluginmanager-loaded":"")+'"><div class="projectlist-result-name">'+i.title+"</div><div class='projectlist-result-metadata'>"+i.description+"</div>";void 0!==i.originalAuthor&&(l=l+"<div class='projectlist-result-metadata'>Original version by "+i.originalAuthor+"</div>"),void 0!==i.author&&(l=l+"<div class='projectlist-result-metadata'>"+(void 0===i.originalAuthor?"By ":"Built on by ")+i.author+"</div>"),l=l+'<div class="pluginlist-loaded projectlist-result-metadata">'+s(o)+"</div></div>",$(l).click(function(t){return function(){var n=$(this);e.loadPlugin(t,function(){e.plugins[t]&&(n.find(".pluginlist-loaded").html(s(t)),n.addClass("pluginmanager-loaded",100)),e.menu.updateViewsMenu()})}}(o)).appendTo(a)}var d=$('<div class="projectlist-listing"></div>');d.append(a),$dialog=$('<div id="'+t+'"></div>').html(d).dialog({title:n,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},e.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:e.viewCategories.environment,name:"plugins"},t()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.Canvas2D=function(e,t){var n=this;this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx,this.defaultLineWidth=2;canvases={},contents={};var i,o,a,s={},r=!1,l=!1;Object.defineProperty(this,"mouseIdleTimeout",{set:function(e){clearInterval(o),o=setInterval(function(){if(r)l=!1,r=!1;else if(!l){var e=root.lookup("mouseFollow").value();root.lookup("mouseVelocity").assign(new Point(0,0),root.scope,EdenSymbol.hciAgent,e),l=!0,a=void 0}},e/2),i=e},get:function(){return i},enumerable:!0}),this.mouseVelocitySampleTime=100,this.mouseVelocityDampening=.3,this.mouseIdleTimeout=300;var d=function(e,t){var n;for(n in t)if("false"!=t[n][0].getAttribute("data-garbage"))for(var i=t[n],o=0;o<i.length;o++)null!==i[o].parentElement&&e.removeChild(i[o])};this.thumbnail=function(e){var t=canvases.picture;if(void 0===t)for(var n in canvases){t=canvases[n];break}if(void 0!==t){var i,o,a,s,r=t.clientWidth,l=t.clientHeight,d=r/l;d<200/112?(a=(200-(o=r*((i=112)/l)))/2,s=0):d>200/112?(a=0,s=(112-(i=l*((o=200)/r)))/2):(i=112,o=200,a=0,s=0);var c=document.createElement("canvas");c.setAttribute("width","200"),c.setAttribute("height","112"),c.getContext("2d").drawImage(t,a,s,o,i);var u;try{u=c.toDataURL("image/png")}catch(e){}e&&e(u)}else e&&e()},this.drawPicture=function(e){var t=canvases[e];if(void 0!==t&&!t.drawingQueued&&(t.drawingQueued=!0,!t.drawingInProgress)){var i=function(){t.drawingInProgress=!0,t.drawingQueued=!1;var o=s[e],a={},r="view_"+e+"_content",l=root.lookup(r),c=l.value(),u=t.getContext("2d"),p=contents[e],h=0;if(void 0!==p){var g=root.lookup("view_"+e+"_background_colour").value();void 0===g&&(g="white"),u.setTransform(1,0,0,1,0,0),n.setFillStyle(u,g),p.style.backgroundColor=g,u.fillRect(0,0,t.width,t.height);var v;for(v in o)o[v][0].setAttribute("data-garbage",!0);if(Array.isArray(c)){var f=root.lookup("view_"+e+"_scale").value();"number"!=typeof f&&(f=1);var m=root.lookup("view_"+e+"_zoom").value();"number"!=typeof m&&(m=1);var b,y,w=f*m;f<0?(u.scale(-w,w),w=-w,y=-f,b=!0):(1!=w&&u.scale(w,w),y=f,b=!1);var E=root.lookup("view_"+e+"_offset").value();if(E instanceof Point)if(b){var S=t.height/w-E.y;u.translate(E.x,-S),E=new Point(E.x,S)}else u.translate(E.x,E.y);else E=new Point(0,0);n.configureContextDefaults(u,y);for(var x=[c],I=[0],k=[],A="";x.length>0;){var C=x.pop(),_=I.pop();for(_>0&&C[_-1]instanceof EdenUI.plugins.Canvas2D.Transform&&(u.restore(),k.pop(),A=k.join(" "));_<C.length;){var T=C[_];if(T instanceof Object)if(Array.isArray(T))x.push(C),I.push(_+1),C=T,_=0;else if(T instanceof EdenUI.plugins.Canvas2D.Transform){x.push(C),I.push(_+1),u.save(),T.transform(u);var D=T.getCSS(w);A=A+D+" ",k.push(D),C=T.items,Array.isArray(C)||(C=[C]),_=0}else{var L=T.hash&&T.hash(),M=L&&o[L];if(M)T.elements=M;else{u.save();try{n.configureContext(u,y,m,T.drawingOptions)&&T.draw(u,f,e)}catch(e){void 0!==T&&console.log(e)}u.restore()}if(void 0!==T.elements){var U=T.elements[0].parentElement;if(U&&U!=p){for(var N=[],P=0;P<T.elements.length;P++)N.push($(T.elements[P]).clone(!0,!0).get(0));T.elements=N,T.scale(w,m,E)}else M&&!t.rescale||T.scale(w,m,E)}var O=T.elements;O&&(O[0].setAttribute("data-garbage",!1),M||(p.length<=h?p.appendChild(O[0]):p.insertBefore(O[0],p.childNodes[h])),a[L]=O,h++),_++}else _++}}if(1==root.lookup("view_"+e+"_grid_visible").value()){var B,V,F=root.lookup("view_"+e+"_grid_spacing").value(),H=-E.x,R=t.width/w-E.x;b?(B=E.y-t.height/w,V=E.y):(B=-E.y,V=t.height/w-E.y),u.save(),u.lineWidth=1/w,u.strokeStyle="thistle",n.drawGridLines(E,w,F,H,B,R,V,u),u.strokeStyle="magenta",n.drawGridLines(E,w,3*F,H,B,R,V,u),u.beginPath(),u.strokeStyle="blue",u.fillStyle="blue",u.arc(0,0,9/w,0,2*Math.PI,!1),u.fill(),u.beginPath(),u.moveTo(3*F,0),u.lineTo(2*F,.4*F),u.lineTo(2*F,-.4*F),u.moveTo(0,3*F),u.lineTo(.4*F,2*F),u.lineTo(-.4*F,2*F),u.fill(),u.beginPath(),u.lineWidth=4/w,u.moveTo(2*F,0),u.lineTo(0,0),u.lineTo(0,3*F),u.stroke(),u.restore()}}else{var j=r,W=l.eden_definition;if(W){var G=new RegExp("^"+r+"\\s+is\\s+([a-zA-Z0-9_]+)(;)?$"),z=W.match(G);null!==z&&(j=z[1])}u.save(),u.font="18px sans-serif",u.fillStyle="black",u.textAlign="center",p.textBaseline="middle",u.fillText("Give the observable named '"+j+"' a list-typed value",t.width/2,t.height/2),u.fillText("to create a picture here.",t.width/2,t.height/2+30),u.restore()}d(p,o),s[e]=a,t.drawingInProgress=!1,t.drawingQueued&&setTimeout(i,40)}};setTimeout(i,40)}},this.drawGridLines=function(e,t,n,i,o,a,s,r){r.beginPath();for(l=0==e.x?n:0;l<=a;l+=n){d=(Math.round(l*t)-.5)/t;r.moveTo(d,o),r.lineTo(d,s),r.stroke()}for(var l=-n;l>=i;l-=n){var d=(Math.round(l*t)-.5)/t;r.moveTo(d,o),r.lineTo(d,s),r.stroke()}for(c=0==e.y?n:0;c<=s;c+=n){u=(Math.round(c*t)-.5)/t;r.moveTo(i,u),r.lineTo(a,u),r.stroke()}for(var c=-n;c>=o;c-=n){var u=(Math.round(c*t)-.5)/t;r.moveTo(i,u),r.lineTo(a,u),r.stroke()}},this.configureContextDefaults=function(e,t){e.lineJoin="bevel",e.miterLimit=429496656,e.lineWidth=this.defaultLineWidth/t},this.configureContext=function(e,t,n,i){if("object"!=typeof i)return!0;if(!1===i.visible)return!1;if(Array.isArray(i.dashes)&&(e.setLineDash(i.dashes),"dashOffset"in i&&(e.lineDashOffset=i.dashOffset)),"cap"in i&&(e.lineCap=i.cap),"join"in i&&(e.lineJoin=i.join),"miterLimit"in i&&(e.miterLimit=i.miterLimit),"lineWidth"in i&&(e.lineWidth=i.lineWidth/t),"opacity"in i&&(e.globalAlpha=i.opacity),"object"==typeof i.shadow)if(e.shadowColor=i.shadow.colour,i.shadow.scale){var o=n*t;e.shadowBlur=i.shadow.blur*o,e.shadowOffsetX=i.shadow.xOffset*o,e.shadowOffsetY=i.shadow.yOffset*o}else e.shadowBlur=i.shadow.blur*n,e.shadowOffsetX=i.shadow.xOffset*n,e.shadowOffsetY=i.shadow.yOffset*n;return!0},this.setFillStyle=function(e,t){if(t instanceof CanvasImage){var n=e.createPattern(t.image,"repeat");e.fillStyle=n}else t instanceof EdenUI.plugins.Canvas2D.FillStyle?e.fillStyle=t.getColour(e):e.fillStyle=t},this.initZoneFromDrawingOpts=function(t,n){var i;if(t instanceof Object&&!1!==t.zone){if(void 0===(i=t.name)&&!0===t.zone)return root.currentObservableName();if(e.eden.isValidIdentifier(i)){var o=root.lookup(i+"_click");void 0===o.value()&&o.assign(!1,root.scope,root.lookup(n))}return i}},this.initZoneFromName=function(t,n){if(e.eden.isValidIdentifier(t)){var i=root.lookup(t+"_click");void 0===i.value()&&i.assign(!1,root.scope,root.lookup(n))}return t},this.findDrawableHit=function(e,t,n,i,o){var a=root.lookup("view_"+e+"_content").value(),s=canvases[e];if(s){var r=s.getContext("2d"),l=root.lookup("view_"+e+"_scale").value();return this.findDrawableHitInList(a,r,l,t,n,i,o)}},this.findDrawableHitInList=function(e,t,n,i,o,a,s){if(Array.isArray(e)){var r,l;a?(r=0,l=1):(r=e.length-1,l=-1);for(var d=r;a?d<e.length:d>=0;d+=l){var c=e[d];if("object"==typeof c)if(Array.isArray(c)){if(h=this.findDrawableHitInList(c,t,n,i,o,a,s))return h}else if(void 0!==c.isHit){if(!s&&void 0===c.name)continue;t.save();var u=c.isHit(t,n,i,o);if(t.restore(),!0===u)return c}else if(c.inverse){var p=c.inverse(i,o),h=this.findDrawableHitInList(c.items,t,n,p.x,p.y,a,s);if(void 0!==h)return h}}}},this.findAllDrawablesHit=function(e,t,n,i){var o=root.lookup("view_"+e+"_content").value(),a=canvases[e].getContext("2d"),s=root.lookup("view_"+e+"_scale").value();return this.findAllDrawablesHitInList(o,a,s,t,n,i)},this.findAllDrawablesHitInList=function(e,t,n,i,o,a){if(!Array.isArray(e))return[];for(var s=[],r=0;r<e.length;r++){var l=e[r];if("object"==typeof l)if(void 0!==l.isHit){if(!a&&void 0===l.name)continue;t.save();var d=l.isHit(t,n,i,o);t.restore(),!0===d&&s.push(l)}else if(l.inverse){var c=l.inverse(i,o),u=this.findAllDrawablesHitInList(l.items,t,n,c.x,c.y,a);u.length>0&&(s=s.concat(u))}}return s};var c={leftButton:!1,middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1};this.createCommon=function(t,i){function o(){n.drawPicture(v)}function l(e){return"view_"+t+"_"+e}function d(){var t,i,o=y.value(),a=w.value(),s=o*a,r=E.value();r instanceof Point?(t=r.x,i=r.y):(t=0,i=0);var l=S.value();void 0!==l?(l=Math.ceil((S.value()+t)*s),f.width=l):f.width=a>1?Math.ceil(I.value()*a):Math.floor(I.value());var d;void 0!==x.value()?d=Math.ceil((x.value()+i)*s):a>1?d=Math.ceil(k.value()*a):(d=k.value(),void 0!==l&&l>Math.floor(I.value())&&(d-=e.scrollBarSize),d=Math.floor(d-1)),f.height=d,f.rescale=!0,n.drawPicture(v)}function u(){A?(A=!1,f.rescale=!0,n.drawPicture(v),T||(T=!0,setTimeout(u,1e3))):(d(),T=!1)}function p(e){var t=root.lookup("mouseFollow").value();root.beginAutocalcOff(),c.insideCanvas=!0;var i;switch(e.button){case 0:c.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,EdenSymbol.hciAgent,t),i="Left";break;case 1:c.middleButton=!0,i="Middle";break;case 2:c.rightButton=!0,i="Right";break;case 3:c.button4=!0,i="Button4";break;case 4:c.button5=!0,i="Button5";break;default:i="Unknown"}c.buttonCount=c.leftButton+c.middleButton+c.rightButton+c.button4+c.button5;var o="|";if(c.leftButton&&(o+="Left|"),c.middleButton&&(o+="Middle|"),c.rightButton&&(o+="Right|"),c.button4&&(o+="Button4|"),c.button5&&(o+="Button5|"),root.lookup("mouseButtons").assign(o,root.scope,EdenSymbol.hciAgent,t),root.lookup("mouseButton").assign(i+" down",root.scope,EdenSymbol.hciAgent,t),1==c.buttonCount){var a=root.lookup("mousePosition").value();root.lookup("mouseDownView").assign(v,root.scope,EdenSymbol.hciAgent,t),root.lookup("mouseDown").assign(a,root.scope,EdenSymbol.hciAgent,t);var s=root.lookup("view_"+v+"_scale").value()*root.lookup("view_"+v+"_zoom").value(),r=$(this).offset(),l=(e.pageX-Math.round(r.left))/s,d=(e.pageY-Math.round(r.top))/s,u=root.lookup("view_"+v+"_offset").value();u instanceof Point&&(l-=u.x,d-=u.y);var p,h=n.findDrawableHit(v,l,d,!1,!1);p=void 0===h?void 0:h.name;var g=root.lookup("mouseZone");p!==g.value()&&g.assign(p,root.scope,EdenSymbol.hciAgent,t),root.lookup("mouseDownZone").assign(p,root.scope,EdenSymbol.hciAgent,t)}root.endAutocalcOff()}var h,g,v=t,f=canvases[t];void 0===f?((h=$('<div id="'+t+'-canvascontent" class="canvashtml-content"></div>')).html('<canvas class="canvashtml-canvas noselect" id="'+t+'-canvas" tabindex="1"></canvas>'),g=h.find(".canvashtml-canvas"),f=g[0],canvases[t]=f,contents[t]=h[0],s[t]={},f.drawingQueued=!1,f.drawingInProgress=!1,f.rescale=!1):g=(h=$("#"+t+"-canvascontent")).find(".canvashtml-canvas");var m=[l("content"),l("background_colour"),l("scale"),l("zoom"),l("offset"),l("canvas_right"),l("canvas_bottom"),"mousePosition","mouseButton","mouseButtons","mouseCapture","mouseCaptured","mouseDown","mouseDownView","mouseFollow","mousePressed","mouseUp","mouseWheel","mouseWheelEnabled","mouseWheelVelocity","mouseView","mouseZone","mouseVelocity"];f.setAttribute("data-observables",m.join(",")),root.lookup("view_"+v+"_content").addJSObserver("repaintView",o);var b=root.lookup("view_"+v+"_background_colour");void 0===b.value()&&b.assign("white",root.scope,EdenSymbol.defaultAgent),b.addJSObserver("refreshView",o);var y=root.lookup("view_"+v+"_scale"),w=root.lookup("view_"+v+"_zoom"),E=root.lookup("view_"+v+"_offset"),S=root.lookup("view_"+v+"_canvas_right"),x=root.lookup("view_"+v+"_canvas_bottom"),I=root.lookup("view_"+v+"_width"),k=root.lookup("view_"+v+"_height"),A=!1,C=y.value();void 0===C&&(y.assign(1,root.scope,EdenSymbol.defaultAgent),C=1),y.addJSObserver("refreshView",d);var _=w.value();void 0===_&&(w.assign(1,root.scope,EdenSymbol.defaultAgent),_=1);var T=!1;w.addJSObserver("refreshView",function(e,t){Math.round(100*t);A=!0,u()});var D,L,M=E.value();M instanceof Point?(D=M.x,L=M.y):(E.assign(new Point(0,0),root.scope,EdenSymbol.defaultAgent),D=0,L=0),E.addJSObserver("refreshView",d),void 0==S.value()&&S.assign(void 0,root.scope,EdenSymbol.defaultAgent),S.addJSObserver("repaintView",d),void 0==x.value()&&x.assign(void 0,root.scope,EdenSymbol.defaultAgent),x.addJSObserver("repaintView",d);var U=S.value();U=void 0===U?600:U*C+D;var N=x.value();N=void 0===N?500:N*C+L;var P=root.lookup("view_"+v+"_grid_visible");void 0===P.value()&&P.assign(!1,root.scope,EdenSymbol.defaultAgent),P.addJSObserver("refreshView",o);var O=root.lookup("view_"+v+"_grid_spacing");return void 0===O.value()&&O.assign(20,root.scope,EdenSymbol.defaultAgent),O.addJSObserver("refreshView",o),g.on("mousedown",p),g.on("mouseup",function(t){var n=root.lookup("mouseFollow").value();root.beginAutocalcOff(),c.insideCanvas=!0;var i;switch(navigator.platform.toUpperCase().indexOf("MAC")>=0&&t.ctrlKey&&(t.button=2),t.button){case 0:c.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,EdenSymbol.hciAgent,n),i="Left";break;case 1:c.middleButton=!1,i="Middle";break;case 2:c.rightButton=!1,i="Right";break;case 3:c.button4=!1,i="Button4";break;case 4:c.button5=!1,i="Button5";break;default:i="Unknown"}if(c.buttonCount=c.leftButton+c.middleButton+c.rightButton+c.button4+c.button5,root.lookup("mouseButton").assign(i+" up",root.scope,EdenSymbol.hciAgent,n),0==c.buttonCount){var o=root.lookup("mousePosition").value();root.lookup("mouseButtons").assign("",root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseUp").assign(o,root.scope,EdenSymbol.hciAgent,n),e.plugins.Canvas2D.endClick()}else{var a="|";c.leftButton&&(a+="Left|"),c.middleButton&&(a+="Middle|"),c.rightButton&&(a+="Right|"),c.button4&&(a+="Button4|"),c.button5&&(a+="Button5|"),root.lookup("mouseButtons").assign(a,root.scope,EdenSymbol.hciAgent,n)}root.endAutocalcOff()}).on("contextmenu",function(e){navigator.platform.toUpperCase().indexOf("MAC")>=0&&e.ctrlKey&&(e.button=2,p(e)),root.lookup("mouseContextMenuEnabled").value()||(e.preventDefault(),e.stopPropagation())}).on("click",function(e){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(e){var t=root.lookup("mouseFollow").value(),n=root.lookup("mouseDoubleClicks"),i=n.value();n.assign(i+1,root.scope,EdenSymbol.hciAgent,t)}).on("wheel",function(e){var t,i=e.originalEvent,o=k.value();t=i.deltaMode==WheelEvent.DOM_DELTA_LINE?n.defaultLineHeight:i.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=i.deltaX?I.value():o:1;var a=root.lookup("mouseFollow").value();if(0!=i.deltaY&&e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey){e.preventDefault(),e.stopPropagation(),root.beginAutocalcOff();var s=-i.deltaY*t;if(root.lookup("touchPinchEnabled").value()){var r=root.lookup("touchPinch"),l=r.value();l+=s,r.assign(l,root.scope,EdenSymbol.hciAgent,a)}else{var d=w.value();(d=d*(o+2*s)/o)<.05&&(d=.05),w.assign(d,root.scope,EdenSymbol.hciAgent,a)}return void root.endAutocalcOff()}if(root.lookup("mouseWheelEnabled").value()){if(root.beginAutocalcOff(),0!==i.deltaY&&(!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey)){e.preventDefault(),e.stopPropagation();var c=root.lookup("mouseWheel"),u=c.value();u+=s=i.deltaY*t,c.assign(u,root.scope,EdenSymbol.hciAgent,a),root.lookup("mouseWheelVelocity").assign(s,root.scope,EdenSymbol.hciAgent,a)}if(0!==i.deltaX){e.preventDefault(),e.stopPropagation();var p=root.lookup("touchPanX"),h=p.value(),g=i.deltaX*t;h+=g,p.assign(h,root.scope,EdenSymbol.hciAgent,a),root.lookup("touchPanXSpeed").assign(g,root.scope,EdenSymbol.hciAgent,a)}root.endAutocalcOff()}}).on("mouseout",function(e){c.insideCanvas=!1;var t=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,EdenSymbol.hciAgent,t)}).on("mouseenter",function(e){if(!c.insideCanvas){c.insideCanvas=!0;var t;0==c.buttonCount?t="":(t="|",c.leftButton&&(t+="Left|"),c.middleButton&&(t+="Middle|"),c.rightButton&&(t+="Right|"),c.button4&&(t+="Button4|"),c.button5&&(t+="Button5|"));var n=root.lookup("mouseButtons"),i=n.value();if(t!=i){var o=root.lookup("mouseFollow").value();root.beginAutocalcOff(),n.assign(t,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseButton").assign("Enter window",root.scope,EdenSymbol.hciAgent,o);var a=root.lookup("mousePressed");a.value()!=c.leftButton&&a.assign(c.leftButton,root.scope,EdenSymbol.hciAgent,o),""==i&&""!=t&&(root.lookup("mouseDown").assign(void 0,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseDownView").assign(void 0,root.scope,EdenSymbol.hciAgent,o)),root.endAutocalcOff()}}}).on("mousemove",function(e){r=!0;var t=root.lookup("mouseFollow").value();root.beginAutocalcOff();var i,o,s,l,d=root.lookup("mouseView"),u=root.lookup("mousePosition"),p=d.value(),h=u.value();h&&(s=h.x,l=h.y);var g=root.lookup("view_"+v+"_scale").value()*root.lookup("view_"+v+"_zoom").value();if(c.capturing){var f=e.originalEvent;i=s+f.movementX/g,o=l+f.movementY/g}else{var m=$(this).offset();i=(e.pageX-Math.round(m.left))/g,o=(e.pageY-Math.round(m.top))/g;var b=root.lookup("view_"+v+"_offset").value();b instanceof Point&&(i-=b.x,o-=b.y)}d.assign(v,root.scope,EdenSymbol.hciAgent,t);var y=new Point(i,o);u.assign(y,root.scope,EdenSymbol.hciAgent,t);var w,E=Date.now();if(p==v&&void 0!==a){if((w=E-a)>=n.mouseVelocitySampleTime){var S=root.lookup("mouseVelocity"),x=S.value(),I=1e3*(i-s)/w,k=1e3*(o-l)/w;if(x){var A=n.mouseVelocityDampening,C=x.x;(I>0&&C>0||I<0&&C<0)&&(I=A*C+(1-A)*I);var _=x.y;(k>0&&_>0||k<0&&_<0)&&(k=A*_+(1-A)*k)}I=Math.ceil(I*g)/g,k=Math.ceil(k*g)/g;var T=new Point(I,k);S.assign(T,root.scope,EdenSymbol.hciAgent,t),a=E}}else a=E;var D,L=n.findDrawableHit(v,i,o,!1,!1);D=void 0===L?void 0:L.name;var M=root.lookup("mouseZone");D!==M.value()&&M.assign(D,root.scope,EdenSymbol.hciAgent,t),root.endAutocalcOff()}).on("keyup",function(e){var t=e.which,n=!1;if(e.altKey&&!e.shiftKey&&!e.ctrlKey){var i=root.lookup("view_"+v+"_zoom"),o=i.value();61==t||187==t?(o*=1.25,n=!0):173==t||189==t?(o/=1.25,n=!0):48==t&&(o=1,n=!0),i.assign(o,root.scope,EdenSymbol.hciAgent)}n&&(e.preventDefault(),e.stopPropagation())}),{initialWidth:U,initialHeight:N,code_entry:h,offsetSym:E,zoomSym:w,widthSym:S,heightSym:x,scaleSym:y}},this.createEmbedded=function(t,i,o){var a=t;eden.execute2("view_"+a+"_content is "+o+";");var s=n.createCommon(t,i),r=(s.initialWidth,s.initialHeight,s.code_entry),l=s.offsetSym,d=s.zoomSym,c=s.widthSym,u=s.heightSym,p=s.scaleSym;return{code_entry:r,contents:r,destroy:function(){delete canvases[a],delete contents[a]},resize:function(t,i){var o,s=l.value();s instanceof Point?(o=s.x,s.y):o=0;var r,h=d.value(),g=document.getElementById(a+"-canvas"),v=!1,f=c.value();if(void 0===f?(r=h>1?Math.ceil(t*h):Math.floor(t),g.width!=r&&(g.width=r,v=!0)):f=Math.ceil(f*p.value()*h+o),void 0===u.value()){if(h>1)m=Math.ceil(i*h);else{m=i,void 0!==f&&f>m&&(m-=e.scrollBarSize);var m=Math.floor(m-1)}m!=g.height&&(g.height=m,v=!0)}v&&n.drawPicture(a)}}},this.createDialog=function(t,i){var o,a=t.slice(0,-7),r=n.createCommon(a,i),l=r.initialWidth,d=r.initialHeight,c=r.code_entry,u=r.offsetSym,p=r.zoomSym,h=r.widthSym,g=r.heightSym,v=r.scaleSym;return $('<div id="'+t+'"></div>').html(c).dialog({appendTo:"#jseden-views",title:i,width:l+e.scrollBarSize,height:d+e.titleBarHeight,minHeight:120,minWidth:230,classes:{"ui-dialog":"canvas-dialog unpadded-dialog ui-front"}}),o={confirmClose:!0,destroy:function(){var e=s[a];for(var t in e)for(var n=e[t],i=0;i<n.length;i++){var o=n[i];$(o).detach()}delete canvases[a],delete contents[a]},resize:function(t,i){var o,s=u.value();s instanceof Point?(o=s.x,s.y):o=0;var r,l=p.value(),d=document.getElementById(a+"-canvas"),c=!1,f=h.value();if(void 0===f?(r=l>1?Math.ceil(t*l):Math.floor(t),d.width!=r&&(d.width=r,c=!0)):f=Math.ceil(f*v.value()*l+o),void 0===g.value()){if(l>1)m=Math.ceil(i*l);else{m=i,void 0!==f&&f>m&&(m-=e.scrollBarSize);var m=Math.floor(m-1)}m!=d.height&&(d.height=m,c=!0)}c&&n.drawPicture(a)}},n.drawPicture(a),o},root.lookup("mouseDownZone").addJSObserver("recordClick",function(e,t){if(eden.isValidIdentifier(t)){var n=root.lookup(t+"_click");!1===n.value()&&n.assign(!0,root.scope,EdenSymbol.hciAgent,!0)}}),this.endClick=function(){var e=root.lookup("mouseDownZone").value();if(eden.isValidIdentifier(e)){var t=root.lookup(e+"_click");!0===t.value()&&t.assign(!1,root.scope,EdenSymbol.hciAgent,!0)}},this.canvasNameFromElement=function(e){for(;e;){var t=e.id;if("-canvascontent"==t.slice(-14))return t.slice(0,-14);e=e.parentElement}return null},document.addEventListener("mouseup",function(t){var n=root.lookup("mouseFollow").value();if(root.beginAutocalcOff(),!c.insideCanvas){var i;switch(t.button){case 0:c.leftButton=!1,i="Left";break;case 1:c.middleButton=!1,i="Middle";break;case 2:c.rightButton=!1,i="Right";break;case 3:c.button4=!1,i="Button4";break;case 4:c.button5=!1,i="Button5";break;default:i="Unknown"}c.buttonCount=c.leftButton+c.middleButton+c.rightButton+c.button4+c.button5;var o=root.lookup("mouseButtons");if(0==c.buttonCount&&""!=o.value()){var a=root.lookup("mousePressed"),s=a.value();root.lookup("mouseButton").assign(i+" up",root.scope,EdenSymbol.hciAgent,n),o.assign("",root.scope,EdenSymbol.hciAgent,n),root.lookup("mousePosition").assign(void 0,root.scope,EdenSymbol.hciAgent,n),s&&a.assign(!1,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseUp").assign(void 0,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseView").assign(void 0,root.scope,EdenSymbol.hciAgent,n),e.plugins.Canvas2D.endClick()}}root.endAutocalcOff()}),document.addEventListener("mousedown",function(e){if(!c.insideCanvas){switch(e.button){case 0:c.leftButton=!0;break;case 1:c.middleButton=!0;break;case 2:c.rightButton=!0;break;case 3:c.button4=!0;break;case 4:c.button5=!0}c.buttonCount=c.leftButton+c.middleButton+c.rightButton+c.button4+c.button5}}),document.addEventListener("pointerlockchange",function(e){var t=null!==document.pointerLockElement;c.capturing=t;var n=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(t,root.scope,void 0,n)}),e.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:e.viewCategories.visualization,holdsContent:!0};document.location.pathname.slice(-15),Eden.Selectors.execute("plugins > canvas_merged",function(){eden.root.lookup("plugins_canvas_loaded").assign(!0,eden.root.scope),t&&t()})},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.Transform.CSSInfo=function(e,t,n){this.css=e,this.scaleX=t,this.scaleY=n},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Page=function(e,t){function n(e){if(!e)return"";if("title"!=e[0])return"";var t,n=$("<div class='page-title "+b+"'></div>"),i=$("<div class='page-title-block'></div>");e[6]&&n.css("height",e[6]+"px"),t=e[1]?$("<span class='page-title-text "+b+"'>"+e[1]+"</span>"):$('<img border=0 src="'+e[5]+'"></img>');var o=$("<br/><span class='page-subtitle-text "+b+"'>"+e[2]+"</span>");return i.append(t),i.append(o),n.append(i),e[3],n}function i(e){if(!e)return"";if("header"!=e[0])return"";switch(e[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+e[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+e[1]+"</h2>")}}function o(e){switch(typeof e){case"string":return e;case"number":return e+"px";default:return""}}function a(e,t){for(var n=0;n<t.length;n++)void 0!==t[n]&&_[n]&&(e.style[_[n]]=o(t[n]))}function s(e,t){var n={};if(n.tagType=e,void 0===t)return n;for(var i,o=/([^\s=]+)(?:\s*=\s*((?:"[^"]*")|(?:'[^']*')|\S*))?/g;null!==(i=o.exec(t));)if(void 0===i[2]||""==i[2])n[i[1]]=!0;else{var a,s=i[2][0];a='"'==s||"'"==s?i[2].slice(1,-1):i[2],/^\d+$/.test(a)&&(a=parseInt(a)),n[i[1]]=a}return n}function r(e){var t=[],n=[],i=(e=(e=(e=e.replace(/"jseden:([^"]*)"/g,"\"javascript:eden.execute2('$1;')\"")).replace(/'jseden:([^']*)'/g,"'javascript:eden.execute2(\"$1;\")'")).replace(/<jseden(-([\w\-]+))?(\s+(?:[^"'/>]*(?:"[^"]*")*(?:'[^']*')*)*)?(?:\/|(?:>((?:[^<]*(?:<(?!\/jseden\1>))*)*)<\/jseden\1))>/g,function(e,i,o,a,r,l,d){return void 0===r&&(r=""),t.push(r),n.push(s(o,a)),"\0\0"})).split("\0\0");if(1==i.length)return e;for(var o=$("<div></div>"),a=0;a<i.length-1;a++)if(o.append($("<div class='page-paragraph'>"+i[a]+"</div>")),void 0===n[a].tagType){var r=t[a].split("\n").length;void 0===n[a].lines&&(n[a].lines=r),void 0===n[a].width&&(n[a].width="50%"),void 0===n[a].box&&(n[a].box=!0);var l=u(["script",n[a].static,[t[a]],n[a].name,n[a].box,n[a].lines,!1,n[a].float,n[a].width]);o.append(l)}else if(n[a])if("canvas"==n[a].tagType){var d=h(["canvas",n[a].name,n[a].source,n[a].width,n[a].height,n[a].float,n[a].box]);o.append(d)}else if("veden"==n[a].tagType){var c=p(["veden",n[a].name,n[a].width,n[a].height,n[a].float,t[a]]);o.append(c)}return o.append($("<div class='page-paragraph'>"+i[i.length-1]+"</div>")),o.get(0)}function l(e){if(e&&"element"==e[0]){var t,n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=(e[7],e[8],e[9],e[10],e[11],e[12]),p=e[13];switch(n){case"div":case"span":case"button":case"img":case"p":case"ul":case"ol":case"li":case"br":case"pre":case"h1":case"h2":case"h3":case"a":case"input":t=document.createElement(n);break;default:return void console.error("Invalid element type: "+n)}if(i&&(t.id=i),o&&(t.className=o),s&&"string"==typeof s){var h=r(s);"string"==typeof h?t.innerHTML=h:t.appendChild(h)}return s&&s instanceof Array&&d(t,s),l&&"string"==typeof l&&(t.cssText=l),l&&l instanceof Array&&a(t,l),c&&i&&(t.onclick=function(e){var t=eden.root.lookup(i+"_click");console.log("ELEMENT CLICK"),t.assign(!0,eden.root.scope)}),"img"==n&&u&&(t.src=u),"a"==n&&p&&(t.href=p),t}}function d(e,t){if("string"!=typeof t[0])for(var n=0;n<t.length;n++){var i=l(t[n]);i&&e.appendChild(i)}else(i=l(t))&&e.appendChild(i)}function c(e){if(!e)return"";if("p"!=e[0])return"";var t,n=[],i=(t=(t=e[1]instanceof Array?e[1].join("&nbsp;"):e[1]).replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden>/g,function(e,t,i,o,a){return console.log("ATTRIBS: "+t),n.push(i),"\0\0"})).split("\0\0");if(1==i.length)return $("<div class='page-paragraph'>"+t+"</div>");for(var o=$("<div></div"),a=0;a<i.length-1;a++){o.append($("<div class='page-paragraph'>"+i[a]+"</div>"));var s=n[a].split("\n").length,r=u(["script",!1,[n[a]],void 0,!0,s,!1,!1,"50%"]);o.append(r)}return o.append($("<div class='page-paragraph'>"+i[i.length-1]+"</div>")),o}function u(t){if(t&&"script"==t[0]){var n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],r=t[6],l=t[7],d=t[8];if(void 0===o&&(o="embedded"+C,C++),n){var c;c=a?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>");var u,p=new EdenUI.Highlight(c.get(0));u=i instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(i):i;var h=new Eden.AST(u);p.highlight(h,-1,-1),l&&"none"!=l&&c.css("float",l),"50%"!=d&&("number"==typeof d?c.width(d):c.css("width",d));f=EdenUI.plugins.ScriptInput.getRequiredHeight(s,!0);return c.height(f),c}var g;k[o]?(g=k[o]).update(i):(g=e.views.ScriptInput.embed(o,o,i,r),k[o]=g);var v;v=a?$("<div id='"+o+"-dialog' class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>");var f=EdenUI.plugins.ScriptInput.getRequiredHeight(s,!0);return v.height(f),l&&"none"!=l&&v.css("float",l),"50%"!=d&&("number"==typeof d?v.width(d):v.css("width",d)),g.contents.appendTo(v),v.resizable(),v}}function p(t){if(t&&"veden"==t[0]){var n,i=t[1],o=t[2],a=t[3],s=t[4],r=t[5];A[i]?n=A[i]:(n=e.views.Veden.embed(i,i,r),A[i]=n);var l;return(l=$("<div id='"+i+"-dialog' class='page-script-live page-script-live-box'></div>")).height(a),s&&"none"!=s&&l.css("float",s),"50%"!=o&&("number"==typeof o?l.width(o):l.css("width",o)),n.contents.appendTo(l),l.resizable(),l}}function h(t){var n,i=t[6],a=t[3],s=t[4];if(n=i?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>"),a&&n.css("width",o(a)),s&&n.css("height",o(s)),void 0===I[t[1]]){var r=e.views.Canvas2D.embedded(t[1],t[1],t[2]);I[t[1]]=r,n.append(r.code_entry),x.push(function(){r.resize(t[3],t[4])})}else I[t[1]].code_entry.appendTo(n),x.push(function(){I[t[1]].resize(t[3],t[4])});return"none"!=t[5]&&n.css("float",t[5]),n}function g(e){var t;if(t=e[1]?$("<ul></ul>"):$("<ol></ol>"),e[2]&&e[2]instanceof Array)for(var n=0;n<e[2].length;n++){var i=$("<li>"+e[2][n]+"</li>");t.append(i)}return t}function v(e,t){if(!e)return"";if(!(e instanceof Array))return"";for(var n=$("<div class='page-content "+b+"'></div>"),o=0;o<e.length;o++)if(void 0!==e[o])switch(e[o][0]){case"header":n.append(i(e[o]));break;case"p":n.append(c(e[o]));break;case"script":n.append(u(e[o]));break;case"canvas":n.append(h(e[o]));break;case"break":n.append($("<div class='clear'></div>"));break;case"list":n.append(g(e[o]))}return n}function f(e,t){if(void 0!==t&&t instanceof Array){for(var n in I)I[n].code_entry.detach();for(var i in k)k[i].contents.detach();S.html(""),d(S.get(0),t);for(var o=0;o<x.length;o++)x[o]();x=[]}}function m(e,t){if(void 0!==t&&t instanceof Array){C=0;for(var i in I)I[i].code_entry.detach();for(var o in k)k[o].contents.detach();"default"==(b=t[2])&&(b="page-theme-default"),S.html(""),S.append(n(t[1])),S.append(v(t[3],0));for(var a=0;a<x.length;a++)x[a]();x=[]}}var b,y=e.eden.root.lookup("page"),w=e.eden.root.lookup("document"),E=y.value(),S=$("<div class='main-page page'></div>");$("#jseden-views").append(S).addClass("page-body");var x=[],I={},k={},A={},C=0,_=["top","bottom","left","right","width","height","background","position","color","border","font","fontSize","fontFamily","fontWeight","borderBottom","borderLeft","borderRight","borderTop","overflow","padding","paddingTop","paddingLeft","paddingRight","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","textShadow"];m(y,E),y.addJSObserver("pageGenerator",m),w.addJSObserver("pageGenerator",f),Eden.Selectors.execute("plugins > page > page",function(){eden.root.lookup("plugins_page_loaded").assign(!0,eden.root.scope),t&&t()})},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";edenfunctions={};EdenUI.plugins.SymbolViewer=function(e,t){var n=this;this.instances=[];var i=0,o=function(e,t){var n='\t\t\t<div class="symbollist-search-box-outer"> \t\t\t\t<input type="text" class="symbollist-search symbollist-control" /> \t\t\t\t<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> \t\t\t\t';return n+='\t\t\t</div> \t\t\t<div class="symbollist-results"></div>'};this.createDialog=function(t,a,s){function r(){var t=f.value();return g.val().startsWith("select: ")?e.regExpFromStr("","",!1,t):e.regExpFromStr(g,"",!1,t)}function l(e,t){h.search(v.value,r()),"regexp"==t?g.attr("placeholder","search regular expression"):"simple"==t?g.attr("placeholder","simple search"):g.attr("placeholder","search")}var c=t.slice(0,-7),u=root.lookup("createView"),p=$('<div class="symbollist-outer"></div>');p.html(o());var h=new EdenUI.plugins.SymbolViewer.SymbolList(e.eden.root,p.find(".symbollist-results")[0],s);$dialog=$('<div id="'+t+'"></div>').append(p).dialog({appendTo:"#jseden-views",title:a,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"symbollist-dialog ui-front"}}),n.instances.push(h),1==++i&&e.eden.root.addGlobal(d),p.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var t="edit_"+c;if(v.value.startsWith("select: ")){e.createView(t,"ScriptInput",void 0);var n=eden.root.lookup("view_"+t+"_tabs").value();Array.isArray(n)||(n=[]),n.push(v.value.substring(8)),eden.root.lookup("view_"+t+"_tabs").assign(n,eden.root.scope,EdenSymbol.hciAgent),eden.root.lookup("view_"+t+"_current").assign(n.length-1,eden.root.scope,EdenSymbol.hciAgent)}});var g=p.find(".symbollist-search-box-outer > .symbollist-search"),v=g[0],f=root.lookup("view_"+c+"_search_language");l(f,f.value()),f.addJSObserver("refreshView",l);var m=root.lookup("view_"+c+"_search_string"),b=function(e,t){void 0!==t&&(t!==v.value&&(v.value=t),h.search(t,r()))},y=m.value();return void 0===y?(m.assign("",root.scope,u),h.search("",new RegExp(""))):b(0,y),m.addJSObserver("refreshView",b),g.keyup(function(){m.assign(v.value,root.scope,EdenSymbol.hciAgent)}),{destroy:function(){var t=n.instances.indexOf(h);n.instances.splice(t,1),0==--i&&e.eden.root.removeGlobal(d)}}},this.createObservableDialog=function(e,t){return n.createDialog(e,t,"obs")},this.createFunctionDialog=function(e,t){return n.createDialog(e,t,"func")},this.createAgentDialog=function(e,t){return n.createDialog(e,t,"agent")},this.createSymbolDialog=function(e,t){return n.createDialog(e,t,"all")};var a={},s={},r=!1;this.isCreationPending=function(e){return e in s},this.delay=40;var l=function(){for(x in n.instances){var e,t,i,o=n.instances[x];void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(t=(e=$(o.symresults)).parent(),i=e.scrollTop(),e.detach());for(var l in s){var d=s[l];o.filter?o.filter.indexOf(l)>=0&&o.addSymbol(d,l):o.addSymbol(d,l)}for(var l in a)o.updateSymbol(l);void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(e.appendTo(t),e.scrollTop(i))}a={},s={},r=!1},d=function(e,t){var i=e.name;if(1==t)s[i]=e;else{if(i in s)return;a[i]=e}r||(r=!0,setTimeout(l,n.delay))};e.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:e.viewCategories.comprehension,menuPriority:0},e.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:e.viewCategories.comprehension,menuPriority:0},e.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:e.viewCategories.comprehension,menuPriority:0},e.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:e.viewCategories.comprehension,menuPriority:1},eden.root.lookup("plugins_symbolviewer_loaded").assign(!0,eden.root.scope),t()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(e,t,n){this.root=e,this.regExp=new RegExp(""),this.type=n,this.category="all",this.customCategory=!1,this.subtypes="all",this.symresults=t,this.symbols={},this.filter=void 0},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(e,t,n,i){if(void 0!==e)if(e.startsWith("select: ")){var o=Eden.Selectors.query(e.substr(8),"symbol");console.log(o),this.filter=o,this.regExp=t,this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};for(var a=0;a<o.length;a++){var s=o[a],r=this.root.symbols[s];r&&this.addSymbol(r,s)}}else{this.searchStr=e,this.searchStrLowerCase=e.toLowerCase(),this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};var l,d;for(l in this.root.symbols)edenUI.plugins.SymbolViewer.isCreationPending(l)||(d=this.root.symbols[l],this.addSymbol(d,l))}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(e){void 0!==this.symbols[e]&&this.symbols[e].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(e,t){var n,i=!1;if(t.toLowerCase()==this.searchStrLowerCase)i=!0,n="exact-match";else if(!this.regExp.test(t))return;var o=!0;if(this.customCategory?Eden.isitCategory(t,this.category,this.type)||(o=!1):Eden.isitSystemSymbol(t)?"user"==this.category&&(o=!1):"system"==this.category&&(o=!1),void 0!==e.definition?"vars"==this.subtypes&&(o=!1):"formulas"==this.subtypes&&(o=!1),!o){if(!i)return;n="dirty-match"}var a="obs";if(e.definition){var s=e.getSource();a=/^proc\s/.test(s)?"agent":/^func\s/.test(s)?"func":"function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs"}else a="function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs";if("all"==this.type||this.type==a){var r=new EdenUI.plugins.SymbolViewer.Symbol(e,t,a,n);i?r.element.prependTo(this.symresults):r.element.appendTo(this.symresults),this.symbols[t]=r}},EdenUI.plugins.SymbolViewer.Symbol=function(e,t,n,i){function o(){a.element.removeClass("symbollist-inline-editor"),a.update(),a.element.scrollLeft(0)}switch(this.symbol=e,this.name=t,this.type=n,this.details=void 0,this.update=void 0,this.element=$('<div class="symbollist-result-element"></div>'),i&&this.element.addClass("symbollist-"+i+"-result"),n){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var a=this,s=!1;this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||s||(s=!0,setTimeout(function(){if(!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&s){s=!1;a.name;Eden.Selectors.goto("> :not(ACTIVE) >> "+e.name)}},350))}),"obs"==n&&this.element.dblclick(function(){function e(){var e=u.get(0).value,t=g.value;";"!=t.slice(-1)&&(t+=";"),eden.execute2(a.name+" "+e+" "+t),o(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0}function n(t){var n=t.which;13==n?e():27==n&&(o(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}if(s=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==a){var i=a.symbol.cache.value;if(void 0!==a.symbol.definition||"boolean"!=typeof i){EdenUI.plugins.SymbolViewer.inlineEditorSymbol=a,a.element.addClass("symbollist-inline-editor");var r=a.element.find(".result_value"),l=a.element.find(".result_separator");r.html("");var d,c;void 0!==a.symbol.definition?(d=a.symbol.getSource().replace(new RegExp("^\\s*"+t+"\\s+is\\s+"),""),c="is"):(d=Eden.edenCodeForValue(i),c="=");var u=$("<select></select>");"="==c?(u.append('<option value="is">is</option>'),u.append('<option value="=" selected="selected">=</option>')):(u.append('<option value="is" selected="selected">is</option>'),u.append('<option value="=">=</option>')),l.html(" "),l.append(u);var p=Eden.htmlEscape(d,!0),h=$('<input type="text" value="'+p+'" spellcheck="false" style="width: 100%"/>'),g=h.get(0);h.on("keyup",n),h.on("blur",function(){setTimeout(function(){u.is(document.activeElement)||(o(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===a&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),u.on("keydown",n),u.on("blur",function(){setTimeout(function(){h.is(document.activeElement)||(o(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===a&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),r.append(h);var v=a.element.find(".symbollist-result-inner");v.length>0&&(v.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),g.focus(),g.select();var f=d.slice(0,1);'"'!=f&&"'"!=f&&"["!=f&&"{"!=f||(g.selectionStart=1,g.selectionEnd=d.length-1)}else!0===i?a.symbol.assign(!1,eden.root.scope,EdenSymbol.hciAgent,!0):a.symbol.assign(!0,eden.root.scope,EdenSymbol.hciAgent,!0)}}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var e,t,n=this.symbol.getSource();e=void 0===this.symbol.definition||/^func\s/.test(n)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name]?(this.details=edenfunctions.functions[this.name],t="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):t="";var i="<span class='result_name'>"+e+"</span>"+t;if(void 0!==this.symbol.definition&&!/^func\s/.test(this.symbol.eden_definition)){var o=Eden.htmlEscape(n,!1,!0);i="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(o=Eden.htmlEscape("<pre>"+o+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+i+"</span>"}this.element.html(i)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var e,t=_formatVal(this.symbol.value()),n="<span class='result_name'>"+(e=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+t+"</span>";if(void 0!==this.symbol.definition){var i=Eden.htmlEscape(this.symbol.getSource(),!1,!0);n="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(i=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+i+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+n+"</span>"}this.element.html(n)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var e,t,n=this.symbol.getSource();e=void 0===this.symbol.definition||/^proc\s/.test(n)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name]?(this.details=edenfunctions.procedures[this.name],t="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):t="";var i="<span class='result_name'>"+e+"</span>"+t;if(void 0!==this.symbol.definition&&!/^proc\s/.test(n)){var o=Eden.htmlEscape(n,!1,!0);i="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(o=Eden.htmlEscape("<pre>"+o+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+i+"</span>"}this.element.html(i)};edenfunctions={};EdenUI.plugins.VersionViewer=function(e,t){var n=this;this.instances=[];var i=0;this.createDialog=function(t,o,a){var s=t.slice(0,-7),r=(root.lookup("createView"),$('<div class="versionviewer-outer"></div>'));r.html('<table class="version-viewer-list"></table>'),$dialog=$('<div id="'+t+'"></div>').append(r).dialog({appendTo:"#jseden-views",title:o,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"versionviewer-dialog ui-front"}});root.lookup("view_"+s+"_search_string");return function(){var e=URLUtil.getParameterByName("load");$.get(Eden.DB.remoteURL+"/project/versions",{projectID:e},function(t){var n=r.find(".version-viewer-list").html(""),i=$("<tr><th>Vid</th><th>Date</th><th>ParentDiff</th></tr>");n.append(i),$(t).each(function(t,i){var o=$('<tr><td><a href="?load='+e+"&vid="+i.saveID+'">'+i.saveID+"</td><td>"+i.date+"</td><td>"+i.parentDiff+"</td></tr>");n.append(o)})})}(),{destroy:function(){var t=n.instances.indexOf(symbollist);n.instances.splice(t,1),0==--i&&e.eden.root.removeGlobal(symbolChanged)}}},this.createVersionListDialog=function(e,t){return n.createDialog(e,t,"all")},e.views.VersionList={dialog:this.createVersionListDialog,title:"Version List",category:e.viewCategories.history,menuPriority:1},eden.root.lookup("plugins_VersionViewer_loaded").assign(!0,eden.root.scope),t()},EdenUI.plugins.VersionViewer.title="Version Viewer",EdenUI.plugins.VersionViewer.description="Show version details for a specified project.",EdenUI.plugins.VersionViewer.inlineEditorSymbol=void 0,EdenUI.plugins.ExternalHTMLContent=function(e,t){function n(){i=!1}var i=!1,o=!1;this.createDialog=function(t,a){function s(e,t){h.src=void 0===t?"plugins/external-html-content/undefined-url.html?view="+encodeURI(d):"plugins/external-html-content/redirect.html?view="+encodeURI(d)+"&url="+encodeURI(t)}function r(e,t){t?(m.value()&&u.addClass("external-html-content-pinned"),v.css("display","block")):(u.removeClass("external-html-content-pinned"),v.css("display","none"))}function l(e,t){f.value()&&u.toggleClass("external-html-content-pinned",t)}o||(""==document.location.hash&&window.history.pushState({},"","#noNavigateAway"),window.addEventListener("popstate",function(){""==document.location.hash&&(i?window.history.forward(1):e.modalDialog("Leave Environment?","<p>Leaving this page will discard the current script. Your work will not be saved.</p><p>Are you sure you want to close JS-EDEN?</p>",["Close JS-EDEN","Return to Construal"],1,function(e){0==e?(doingNavigateAway=!0,window.history.back(1)):window.history.forward(1)}))}),o=!0);var d=t.slice(0,-7),c=root.lookup("createView"),u=$('<iframe marginwidth="13" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts" allowfullscreen="true" name="'+t+'"></iframe>'),p=root.lookup("_view_"+d+"_url"),h=u[0];s(p,p.value()),p.addJSObserver("refreshView",s);var g=$('<div id="'+t+'"></div>').html(u).dialog({title:a,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"external-html-content"}),v=$('<div class="external-html-content-toolbar">');g.append(v);var f=root.lookup("_view_"+d+"_toolbar_visible"),m=root.lookup("_view_"+d+"_toolbar_pinned");void 0===f.value()&&f.assign(!0,root.scope,c),void 0===m.value()&&m.assign(!1,root.scope,c),r(f,f.value()),f.addJSObserver("refreshView",r),m.addJSObserver("refreshView",l);var b=$('<input type="image" src="images/pin.png" width="28" height="28" alt="Pin toolbar" title="Click to pin the toolbar in place"/>');b.on("click",function(){m.assign(!m.value(),root.scope,Symbol.hciAgent),h.focus()}),v.append(b);var y=$('<input type="image" src="images/back-button.svg" width="28" height="28" alt="Back" title="Click to go back"/>');y.on("click",function(){i||setTimeout(n,1e3),i=!0,window.history.back(1),h.focus()}),v.append(y);var w=$('<input type="image" src="images/forward-button.svg" width="28" height="28" alt="Forward" title="Click to go forward"/>');w.on("click",function(){window.history.forward(1),h.focus()}),v.append(w);var E=$('<input type="image" src="images/refresh-button.png" height="28" alt="Refresh" title="Click to reload the page specified by _view_'+d+'_url"/>');return E.on("click",function(){s(p,p.value()),h.focus()}),v.append(E),{confirmClose:!0}},e.views.ExternalHTMLContent={dialog:this.createDialog,title:"External HTML Content",category:e.viewCategories.visualization,holdsContent:!0},e.eden.include("plugins/external-html-content/external-html-content.js-e",t)},EdenUI.plugins.ExternalHTMLContent.title="External HTML Content",EdenUI.plugins.ExternalHTMLContent.description="Allows construals to display web pages created outside of JS-EDEN.",EdenUI.plugins.HTMLContent=function(e,t){this.createDialog=function(e,t){function n(e){return"view_"+o+"_"+e}function i(e,t){c.get(0).parentNode.style.background=t}var o=e.slice(0,-7),a=[n("background_colour"),n("content")],s=$('<div id="'+e+'-content" class="htmlviews-content" data-observables="'+a.join(",")+'"></div>');s.on("mousedown","button",function(e){var t=e.currentTarget.name,n=e.currentTarget.getAttribute("data-value");null!==n&&null!==n.charAt(0).match(/[0-9]?/)&&(n=parseInt(n)),eden.root.lookup(t).assign(null===n||n,eden.root.scope,EdenSymbol.hciAgent)}),s.on("mouseup","button",function(e){var t=e.currentTarget.name;null===e.currentTarget.getAttribute("data-value")&&eden.root.lookup(t).assign(!1,eden.root.scope,EdenSymbol.hciAgent)}),s.on("click",function(e){var t=e.srcElement.getAttribute("data-jseden");t&&""!=t&&(console.log(t),eden.execute2(t,{name:"execute"}))});var r=root.lookup("view_"+o+"_content"),l=function(e,t){void 0===t?s.html('<div class="htmlviews-undefined">Give view_'+o+"_content a value to display HTML formatted text here.</div>"):s.html(t)};l(0,r.value()),r.addJSObserver("repaintView",l);var d=root.lookup("view_"+o+"_background_colour");d.addJSObserver("changeColour",i);var c=$('<div id="'+e+'"></div>').html(s).dialog({appendTo:"#jseden-views",title:t,width:600,height:450,minHeight:120,minWidth:230,classes:{"ui-dialog":"htmlviews-dialog ui-front"}}),u=d.value();return u&&i(d,u),{confirmClose:!0}},e.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:e.viewCategories.visualization,holdsContent:!0},Eden.Selectors.execute("plugins > html > html",function(){eden.root.lookup("plugins_html_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t()})},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(e,t){var n=this;this.createDialog=function(e,t){$dialog=$('<div id="'+e+'"></div>').html('<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230})};var i={};i["="]={precedence:1,associativity:"right",text:"=",whitespace:!0},i["+="]={precedence:1,associativity:"right",text:"+=",whitespace:!0},i["-="]={precedence:1,associativity:"right",text:"-=",whitespace:!0},i["||"]={precedence:3,associativity:"left",text:"||",whitespace:!0},i.or={precedence:3,associativity:"left",text:"or",whitespace:!0},i["&&"]={precedence:4,associativity:"left",text:"&&",whitespace:!0},i.and={precedence:4,associativity:"left",text:"and",whitespace:!0},i["=="]={precedence:5,associativity:"left",text:"==",whitespace:!0},i["!="]={precedence:5,associativity:"left",text:"!=",whitespace:!0},i["<"]={precedence:6,associativity:"left",text:"<",whitespace:!0},i["<="]={precedence:6,associativity:"left",text:"<=",whitespace:!0},i[">"]={precedence:6,associativity:"left",text:">=",whitespace:!0},i[">="]={precedence:6,associativity:"left",text:">",whitespace:!0},i["=~"]={precedence:6,associativity:"left",text:"=~",whitespace:!0},i["!~"]={precedence:6,associativity:"left",text:"!=",whitespace:!0},i["//"]={precedence:7,associativity:"left",text:"//",whitespace:!0},i["+"]={precedence:8,associativity:"left",text:"+",whitespace:!0},i["-"]={precedence:8,associativity:"left",text:"-",whitespace:!0},i["*"]={precedence:9,associativity:"left",text:"*",whitespace:!0},i["/"]={precedence:9,associativity:"left",text:"/",whitespace:!0},i["%"]={precedence:9,associativity:"left",text:"%",whitespace:!0},i["^"]={precedence:11,associativity:"right",text:".",whitespace:!1},i["."]={precedence:14,associativity:"left",text:".",whitespace:!1};var o={};o["-"]={precedence:10,text:"-"},o["!"]={precedence:10,text:"!"},o["&"]={precedence:10,text:"&"},o.not={precedence:10,text:"!"},o["++."]={precedence:11,text:"++"},o["--."]={precedence:11,text:"--"},o["*"]={precedence:12,text:"*"};var a={};a["#"]={precedence:11,text:"#"},a[".++"]={precedence:11,text:"++"},a[".--"]={precedence:11,text:"--"};var s={};this.convertTreeToEden=function(e,t,n,i,o){var a=function(s,r,l){if(!s.hasOwnProperty("children"))return s.name;var d,c,u,p=s.name,h=s.children;if(t.hasOwnProperty(p)&&2==h.length){c=(d=t[p]).precedence;var g=d.associativity,v=a(h[0],c,d.text),f=a(h[1],c,d.text);if("left"==g){var m=h[1].name;h[1].hasOwnProperty("children")&&2==h[1].children.length&&t.hasOwnProperty(m)&&c==t[m].precedence&&(f="("+f+")")}else{var b=h[0].name;h[0].hasOwnProperty("children")&&2==h[0].children.length&&t.hasOwnProperty(b)&&c==t[b].precedence&&(v="("+v+")")}u=d.whitespace?v+" "+d.text+" "+f:v+d.text+f}else if(e.hasOwnProperty(p))c=(d=e[p]).precedence,u=d.text+a(h[0],c,d.text);else if(n.hasOwnProperty(p))c=(d=n[p]).precedence,u=a(h[0],c,d.text)+d.text;else if(i.hasOwnProperty(p))d=i[p],this.precedence=d.precedence,u=d.code(h,l);else{c=o;for(var y=[],w=0;w<h.length;w++)y.push(a(h[w],0,void 0));u=p+"("+y.join(", ")+")"}return c<r&&(u="("+u+")"),u};return function(e){return a(e,0,void 0)}}(o,i,a,s,13),s["?"]={precedence:2,code:function(e){return n.convertTreeToEden(e[0])+"? "+n.convertTreeToEden(e[1])+" : "+n.convertTreeToEden(e[2])}},s["`...`"]={precedence:13,code:function(e){return"`"+n.convertTreeToEden(e[0])+"`"}},s["${{...}}$"]={precedence:13,code:function(e){return"${{ "+e[0].name+" }}$"}},s["(...)"]={precedence:13,code:function(e){for(var t=n.convertTreeToEden(e[0]),i=[],o=1;o<e.length;o++)i.push(n.convertTreeToEden(e[o]));return"("+t+")("+i.join(", ")+")"}},s["[...]"]={precedence:13,code:function(e){for(var t=[],i=0;i<e.length;i++)t.push(n.convertTreeToEden(e[i]));return"["+t.join(", ")+"]"}},s["[n]"]={precedence:13,code:function(e){return n.convertTreeToEden(e[0])+"["+n.convertTreeToEden(e[1])+"]"}},s["{...}"]={precedence:13,code:function(e){for(var t=[],i=0;i<e.length-1;i+=2)t.push(e[i].name+": "+n.convertTreeToEden(e[i+1]));return"{"+t.join(", ")+"}"}},s.Point={precedence:13,code:function(e,t){if("."==t){for(var i=[],o=0;o<e.length;o++)i.push(n.convertTreeToEden(e[o]));return"Point("+i.join(", ")+")"}return"{"+n.convertTreeToEden(e[0])+", "+n.convertTreeToEden(e[1])+"}"}},e.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:e.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_content","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","semicircleAngle","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,background_audio:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,semicircleAngle:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createExternalHTMLView:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,loadTextFileIntoObservable:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showAgents:!0,showFunctions:!0,showObservables:!0,showSymbols:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0,bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0},Eden.systemFunctionNames={Arc:!0,Arrowhead:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Object:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,semicircleAngle:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Arrowhead:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,hslColour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgbColour:!0,rotatePoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,semicircleAngle:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.symbolCategories["Sound and Video"]={agent:{bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0,unbind:!0},obs:{background_audio:!0,background_audio_url:!0,background_audio_paused:!0,background_audio_chapter:!0,background_audio_chapters:!0,background_audio_looping:!0,background_audio_speed:!0,background_audio_time:!0,background_audio_volume:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0},func:{Audio:!0,Video:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0}},Eden.isitSystemSymbol=function(e){return Eden.isitSystemObservable(e)||Eden.isitSystemAgent(e)||Eden.isitSystemFunction(e)},Eden.isitSystemObservable=function(e){return!!/^(_view|background_audio)_/.test(e)||e in Eden.systemObservableNames},Eden.isitSystemAgent=function(e){return!!/^_View_/.test(e)||e in Eden.systemAgentNames},Eden.isitSystemFunction=function(e){return e in Eden.systemFunctionNames},Eden.isitCategory=function(e,t,n){var i=Eden.symbolCategories[t];return"all"==n?"obs"in i&&e in i.obs||"agent"in i&&e in i.agent||"func"in i&&e in i.func:n in i&&e in i[n]},Eden.getSymbolCategories=function(e){if("all"==e)return Object.keys(Eden.symbolCategories);var t=[];for(var n in Eden.symbolCategories)e in Eden.symbolCategories[n]&&t.push(n);return t},EdenUI.plugins.SymbolLookUpTable=function(e,t){this.createDialog=function(e,t){code_entry=$('<div id="'+e+'-content" class="symbol-lookup-table-content">'+n(e)+"</div>"),$dialog=$('<div id="'+e+'"></div>').html(code_entry).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230})},e.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:e.viewCategories.comprehension,menuPriority:3},this.search=function(t){var n=$("#"+t+"-regexp"),o=e.regExpFromStr(n);document.getElementById(t+"-table-div").innerHTML=i(o,t)};var n=function(e){return"<div class='upper'>"+("<input id='"+e+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+e+"')\" placeholder='search' onload='setFocus()' />")+"</div><div id='"+e+"-table-div' class='lower'>"+i(new RegExp(""),e)+"</div>"},i=function(e,t){tableBodyHTML="";var n,i=[],r={};for(var l in root.symbols)if(n=root.symbols[l],e.test(l)){var d,c,u;if(void 0===n.eden_definition)c="-",d="function"==typeof n.cache.value?"Function":"Observable",u=Eden.htmlEscape(Eden.edenCodeForValue(n.cache.value));else if(0==(c=Eden.htmlEscape(n.eden_definition)).indexOf("proc")){if(Eden.isitSystemAgent(l)&&!new RegExp("\\b"+l+"\\b").test(e.source))continue;d="Agent",u=""}else if(0==c.indexOf("func")){if(Eden.isitSystemFunction(l)&&!new RegExp("\\b"+l+"\\b").test(e.source))continue;d="Function",u=""}else d="Dependency",u=Eden.htmlEscape(Eden.edenCodeForValue(n.cache.value));i.push([n,l,d,c,u]),r[l]=!0}for(var p=0;p<i.length;p++){var h=i[p];n=h[0];var g=o(n.observees,r,t),v=o(n.dependencies,r,t),f=g;""!=g&&""!=v&&(f+=", "),f+=v;var m=o(n.observers,r,t),b=o(n.subscribers,r,t),y=m;""!=m&&""!=b&&(y+=", "),y+=b;var w=a(n.dynamicDependencyTable,r,t),E=n.last_modified_by?n.last_modified_by:"Not yet defined";E=s(E,r,t);var S=Object.keys(n.jsObservers).join(", "),x="<tr id='"+t+"-symbol-"+h[1]+'\'><td class="lower"><p>'+h[1]+'</p></td><td class="lower"><p>'+h[2]+'</p></td><td class="lower"><p>'+h[3]+'</p></td><td class="lower"><p>'+h[4]+'</p></td><td class="lower"><p>'+f+'</p></td><td class="lower"><p>'+y+'</p></td><td class="lower"><p>'+w+'</p></td><td class="lower"><p>'+E+'</p></td><td class="lower"><p>'+S+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(h[1])?tableBodyHTML+=x:tableBodyHTML=x+tableBodyHTML}return'<table><tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower"><b>Definition</b></td><td class="lower"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>'+tableBodyHTML+"</table>"},o=function(e,t,n){var i=[];for(var o in e){var a=o.slice(1);i.push(s(a,t,n))}return i.join(", ")},a=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var a=e[o];void 0===a&&(a=""),i.push(s(a,t,n))}return i.join(", ")},s=function(e,t,n){return"*"==e[0]||"include"==e||"Not yet defined"==e?e:e in t?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+n+"-symbol-"+e+"')\">"+e+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+n+"', '"+e+"')\">"+e+"</a>"};this.addSymbolToSearch=function(t,n){var i,o=document.getElementById(t+"-regexp");i="false"==e.getOptionValue("optSimpleWildcards")?o.value+"|^"+n+"$":o.value+" "+Language.ui.search.disjunction+" "+n,o.value=i,this.search(t)},this.jump=function(e){var t=location.href;location.href="#"+e,history.replaceState(null,null,t)},t()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";var edenfunctions={};SymbolMeta=function(e){this.symbol=e,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(e){var t=0,n=0,i=.1;for(var o in this.symbol.dependencies){t++,i+=(1-i)*SymbolMeta.DependencyComplexityRate;var a=o.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&n++}return i-=t*SymbolMeta.DependencyChangeProbability,0!=t&&(i=.5*i+n/t*.5),i<0?0:i},SymbolMeta.prototype.subscriberInterestingness=function(e){var t=0,n=0,i=0;for(var o in this.symbol.subscribers){t++,i+=(1-i)*SymbolMeta.SubscriberRate;var a=o.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&n++}return i=1-i,0!=t&&(i=.5*i+n/t*.5),i},SymbolMeta.prototype.nameInterestingness=function(){var e=this.symbol.name.substr(1);return"_"==e[0]?.5:/\d/.test(e)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(e){var t=0;t=this.dependencyInterestingness(e)*this.subscriberInterestingness(e)*this.nameInterestingness()*this.significance,this.interestingness=t},EdenUI.plugins.ObservableMining=function(e,t){var n=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];this.createDialog=function(e,t){e.slice(0,-7);var i=$("<div></div>");i.html('<div class="symbolframer-results"></div>'),n.symresults=i.find(".symbolframer-results")[0],$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var i=void 0,o=function(){if(void 0!==n.symresults){var e=$(n.symresults).parent();$(n.symresults).detach();for(r=0;r<n.symbolsui.length;r++)if(n.symbolsui[r].meta.dodelete)n.symbolsui.splice(r,1);else if(0==n.symbolsui[r].meta.isinteresting){var t=n.symbolsui[r].element;n.symbolsui[r].element.hide("drop",{direction:"right"},"slow",function(){t.remove()}),n.symbolsui.splice(r,1)}for(var a=n.minInteresting(),s=n.maxInteresting(),r=0;r<n.interesting.length;r++){for(var l=!1,d=0;d<n.symbolsui.length;d++)if(n.symbolsui[d].meta==n.interesting[r]){l=!0;break}if(!l){var c=new EdenUI.plugins.ObservableMining.Symbol;n.symbolsui.push(c),c.element.appendTo(n.symresults),c.symbol=n.interesting[r].symbol;var u=c.symbol.name.substr(1);c.name=u,c.meta=n.interesting[r],c.outofdate=!0,c.symbolChanged=i}}for(r=0;r<n.symbolsui.length;r++)n.symbolsui[r].update(a,s);$(n.symresults).appendTo(e)}for(r=0;r<n.interesting.length;r++)n.interesting[r].interestingness*=SymbolMeta.DecayRate;setTimeout(o,n.delay)};o(),i=function(e,t){var i=e.name.substr(1),o=n.meta[i];if(void 0!==n.symresults){if(e.definition&&e.eden_definition){var a=e.eden_definition;if(/^proc\s/.test(a))return;if(/^func\s/.test(a))return;if("function"==typeof e.cache.value)return}else if("function"==typeof e.cache.value)return;if((t||void 0===o)&&(n.meta[i]=new SymbolMeta(e),o=n.meta[i]),o.update(n),0==o.isinteresting&&(n.interesting.sort(function(e,t){return t.interestingness-e.interestingness}),o.interestingness>=n.minInteresting())){n.interesting.length;n.interesting.length==n.limitInteresting&&(n.interesting[n.interesting.length-1].isinteresting=!1,n.interesting.pop()),n.interesting.push(o),o.isinteresting=!0,o.significance*=SymbolMeta.SigInterestingRate,n.interesting.sort(function(e,t){return t.interestingness-e.interestingness})}}},e.eden.root.addGlobal(i),e.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:e.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),t()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return this.interesting.length>0?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return this.interesting.length>0?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var e=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==e.editing&&(e.editing=!1,e.element.find("textarea").remove(),e.element.animate({height:"20px"},"fast"))}).click(function(){if(!e.editing){var t;t="function"==typeof e.symbol.value()&&void 0!==e.symbol.eden_definition?e.symbol.eden_definition:e.symbol.definition?e.symbol.eden_definition+";":e.name+" = "+Eden.edenCodeForValue(e.symbol.value())+";",e.element.animate({height:"60px"},{duration:200,complete:function(){var n=$('<textarea class="mine_edit_box" style="display: none"></textarea>');n.val(t),n.appendTo(e.element),n.show("fast")}}),e.editing=!0}}).draggable({distance:40,axis:"x",scroll:!1,drag:function(t,n){n.position.left>150?e.dodelete=!0:e.dodelete=!1},revert:function(t,n){return!e.dodelete},stop:function(t,n){e.dodelete&&(e.meta.significance*=SymbolMeta.SigDeleteRate,e.symbolChanged(e.symbol,!1),e.element.hide("drop",{direction:"right"},"slow",function(){e.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(e,t){if(void 0!==this.symbol){0==t&&(t=1);var n,i=(this.meta.interestingness-e)*(1/(t-e)),o=Math.round(8+12*i),a=_formatFramerVal(this.symbol.value()),s="<span>"+(n=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+a+"</span>";if(void 0!==this.symbol.definition){var r=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);s="<span onmouseenter='EdenUI.showTooltip(event, \""+(r=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+r+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+s+"</span>"}var l=this.element.find(".observable");l.html(s),l.css({"font-size":o+"px"})}},EdenUI.plugins.ObservablePalette=function(e,t){function n(e){var t=e.value();return"function"!=typeof t||!/\breturn\s+([^\/;]|(\/[^\/*]))/.test(t.toString())}function i(e,t){var i=e.term,o=l[i];if(void 0===o){var a=new RegExp("^"+i);o=[];for(var s in root.symbols)a.test(s)&&n(root.symbols[s])&&o.push(s);l[i]=o}t(o)}function o(){var e=r;return r++,e}function a(t,n,i,s,r,l){function d(e){var t=e.target.value;if("hide"!=t){var o;"boolean"==t?o=!1:"number"==t?o=0:"string"==t&&(o=""),p.assign(o,EdenSymbol.hciAgent,!0)}else r.remove(n,s,i)}function c(e){he.fadeOut(250,"linear",function(){e?(he.html("true"),he.css("color","green")):(he.html("false"),he.css("color","red")),he.fadeIn(400,"swing",function(){S.html(e?"true":"false")})})}s?(s.hasClass("ui-accordion")&&s.accordion("destroy"),s.html("")):(s=$('<div class="observable-palette-obs-box observable-palette-visible" data-observable="'+n+'"></div>'),l&&s.data("editor","read-only"));var u,p=e.eden.root.lookup(n),h=p.value(),g=typeof h,v="string"==g,f=!l||v,m=p.eden_definition;if(!l&&void 0!==p.eden_definition){var b=m.match(/^\S+\s+is\s+(.*?);?$/);rhs=b[1],g="definition"}var y=$('<h3><span class="observable-palette-obs-heading">'+n+"</span> </h3>");l&&s.addClass("observable-palette-dependency-value-box");var w=$('<div class="observable-palette-heading-right"></div>');y.append(w),s.append(y);var E=Eden.prettyPrintValue("",h,128,!1,!1),S=$("<a>"+E+"</a>");w.append(S);var x=$("<select></select>");l?x.append('<option value="'+g+'">'+g[0].toUpperCase()+g.slice(1)+"</option>"):(x.append('<option value="number">Number</option>'),x.append('<option value="string">Text (String)</option>'),x.append('<option value="boolean">Yes/No (Boolean)</option>'),x.append('<option value="undefined">Undefined</option>')),x.append('<option value="hide">Hide</option>'),x[0].value=g,x.on("change",d),w.on("click",function(e){e.stopPropagation()}),S.on("click",function(e){S.detach(),w.append(x),x.focus()}),x.on("blur",function(e){x.detach(),w.append(S)});var I=$("<div></div>");if("definition"==g){var k=$('<div class="observable-palette-definition"></div>');k.append(n+" is "),rhsSpan=$('<span class="observable-palette-definition-rhs" contenteditable="true"></span>'),rhsSpan.append(Eden.htmlEscape(rhs)),k.append(rhsSpan),k.append(";"),k.on("click",function(e){rhsSpan.focus(),k.addClass("focussed")}),rhsSpan.on("blur",function(e){k.removeClass("focussed")}),I.append(k);var A=$('<div class="observable-palette-view-commands"> </div>');I.append(A);var C=$('<a onclick="">Expand</a>');C.click(function(){L.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",0)});var _=$('<a onclick="">Collapse</a>');_.click(function(){L.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",!1)});var T=$('<a onclick="">Hide</a>');T.click(function(){var e=L.find(".observable-palette-obs-box");e.removeClass("observable-palette-visible"),e.slideUp()});var D=$('<a onclick="">Show</a>');D.click(function(){var e=L.find(".observable-palette-obs-box");e.addClass("observable-palette-visible"),e.slideDown()}),A.append(C),A.append(_),A.append(T),A.append(D);var L=$('<div class="observable-palette-dependencies"></div>');L.sortable({connectWith:".observable-palette-column",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",tolerance:"pointer",receive:function(e,t){var i=t.item,o=i.data("observable");(!p.isDependentOn("/"+o)||o==n&&"read-only"!=i.data("editor"))&&t.sender.sortable("cancel"),2==L.children(".observable-palette-visible").length&&A.slideDown(),r.removeDuplicates(e.target,i)},remove:function(e,t){L.children(".observable-palette-visible").length<2&&A.slideUp()}});var M,U=0;for(var N in p.dependencies){var P=p.dependencies[N];N=N.slice(1),void 0===P.eden_definition&&(M=a(t,N,o(),void 0,r,!1),r.register(N,M),L.append(M),U++)}if(U<2&&A.hide(),u=function(e,o){var l=e.eden_definition;void 0===l?a(t,n,i,s,r,!1):S.html(Eden.prettyPrintValue("",o,128,!1,!1))},I.append(L),v){var O=a(t,n,o(),void 0,r,!0);L.append(O)}}else if("number"==g){var B,V,F;if(F=1==h||-1==h||h!=Math.floor(h)?5e-4:1,0==h)B=0,V=10;else if(h>=-1&&h<=1)B=h>0?0:-1,V=1;else if(h<0){B=2*h;var H=Number((-h%F).toPrecision(14));0!=H&&H!=F&&(B=B+H-F),V=B+2*(h-B)}else B=0,V=2*Math.ceil((h/F).toPrecision(16))*F;var R=$('<input type="range" min="'+B+'" max="'+V+'" step="'+F+'" value="'+h+'" class="observable-palette-slider"/>'),j=R[0];R.on("input",function(e){p.assign(parseFloat(j.value),EdenSymbol.hciAgent,!0)});var W=$('<table class="observable-palette-number-controls"></table>'),G=$("<tr></tr>");W.append(G);var z=$('<td colspan="3" class="observable-palette-left-cell observable-palette-right-cell observable-palette-slider-cell"></td>');z.append(R),G.append(z);var J=$('<tr class="observable-palette-limits"></tr>');W.append(J);var q=$('<td class="observable-palette-advanced observable-palette-left-cell"></td>'),K=$('<input type="number" value="'+B+'" step='+F+'" title="Smallest value"/>'),Y=K[0];q.append(K),J.append(q),K.on("input",function(e){var t=e.target.value;if(""!=t){var n=parseFloat(t);j.min=t;var i=p.value();n>=0&&i<n&&p.assign(n,EdenSymbol.hciAgent,!0)}});var X,Z,Q=!1;K.on("focus",function(e){X=e.target.value}),K.on("blur",function(e){var t=e.target.value;if(""==t)e.target.value=X,j.min=X;else{var n=parseFloat(t),i=parseFloat(j.max),o=parseFloat(j.step),a=n+Math.round((i-n)/o)*o;a<=n&&(a=n>0?n+Math.ceil((n/o).toPrecision(16))*o:Math.ceil((n/2/o).toPrecision(16))*o)<n+10*o&&(a=n+10*o),j.max=a,re.value=a,p.value()<n&&p.assign(n,EdenSymbol.hciAgent,!0)}});var ee=$('<td class="observable-palette-centre-cell"></td>');J.append(ee);var te=$('<div class="observable-palette-number-centre"></div>');ee.append(te);var ne=$('<label><span class="observable-palette-label">Value&nbsp;</span></label>');te.append(ne);var ie=$('<input type="number" value="'+h+'" step='+F+'"/>'),oe=ie[0];ne.append(ie),ie.on("input",function(e){var t=e.target.value;""!=t&&(j.value=t,p.assign(parseFloat(t),EdenSymbol.hciAgent,!0))}),ie.on("focus",function(e){Q=!0,Z=e.target.value}),ie.on("blur",function(e){if(""==e.target.value)p.assign(parseFloat(Z),EdenSymbol.hciAgent,!0);else{var t=p.value();t<parseFloat(j.min)&&(Y.value=t,j.min=t),j.value=t}Q=!1});var ae=$('<td  class="observable-palette-advanced observable-palette-right-cell"></td>'),se=$('<input type="number" value="'+V+'" step='+F+'" title="Biggest value"/>'),re=se[0];ae.append(se),J.append(ae),se.on("input",function(e){j.max=e.target.value});var le=$('<label class="observable-palette-advanced"><span class="observable-palette-label observable-palette-step-label">Step&nbsp;</span></label>');te.append(le);var de=$('<input type="number" value="'+F+'" min="0" title="Slider step size"/>'),ce=de[0];ce.acceptedValue=F,le.append(de),de.on("input",function(e){var t=parseFloat(ce.value);if(t>0){var n,i=Math.floor(t);if(t==i){var o=String(t).match(/(0*)$/);n=Math.pow(10,o[1].length)}else n=Math.pow(10,-((t-i).toPrecision(15).replace(/0*$/,"").length-2));t==n&&t<ce.acceptedValue&&(n/=10),ce.acceptedValue=t,ce.step=n}}),de.on("blur",function(e){var t=parseFloat(ce.value);0==t?(ce.value=1,ce.acceptedValue=1):t<0||isNaN(t)?ce.value=ce.acceptedValue:(j.step=t,Y.step=t,re.step=t,oe.step=t)}),u=function(e,o){if("number"!=typeof o||void 0!==e.eden_definition)a(t,n,i,s,r,l);else if(S.html(Eden.prettyPrintValue("",o,128,!1,!1)),!Q){var d,c,u,p=parseFloat(j.min),h=parseFloat(j.max),g=parseFloat(j.step);o<p?(0==o?d=0:o>0?(d=Math.ceil(o/2/g)*g-g,0!=(u=Number((o%g).toPrecision(14)))&&u!=g&&(d+=u)):(d=2*o,0!=(u=Number((-o%g).toPrecision(14)))&&u!=g&&(d=d+u-g)),j.min=d,Y.value=d,c=d+Math.round((h-d)/g)*g,j.max=c,re.value=c):o>h&&(c=p+2*Math.ceil(((o-p)/g).toPrecision(16))*g,j.max=c,re.value=c),j.value=o,oe.value=o}},I.append(W)}else if("boolean"==g){var ue=$('<input type="checkbox"/>'),pe=ue[0],he=$('<span class="bool_text"></span>');ue.on("change",function(e){var t=pe.checked;p.assign(t,p.hciAgent,!0)}),u=function(e,o){!0!==o&&!1!==o||void 0!==e.eden_definition?a(t,n,i,s,r,l):(pe.checked=o,c(o))},c(h);var ge=$('<label class="observable-palette-bool"></label>');ge.append(ue),ge.append(he),I.append(ge)}else if("string"==g){var ve=$('<textarea class="string-input">'+h+"</textarea>"),fe=ve[0];ve.on("input",function(e){var t=fe.value;p.assign(t,EdenSymbol.hciAgent,!0),fe.style.height="",fe.style.height=String(fe.scrollHeight+4)+"px"}),u=function(e,o){"string"!=typeof o||void 0!==e.eden_definition?a(t,n,i,s,r,l):(fe.value=o,fe.rows=o.split("\n").length,S.html(Eden.prettyPrintValue("",o,128,!1,!1)))},I.append($('<div class="quote left-quote">&ldquo;</div>')),I.append(ve),I.append($('<div class="quote right-quote">&rdquo;</div>'))}else if("undefined"==g){if(I.append($('<p><span class="result_name">'+n+"</span> is currently undefined.</p>")),!l){var me=x.clone();me[0].value="undefined",me.on("change",d);var be=$("<label>Choose type: </label>");be.append(me);var ye=$("<div></div>");ye.append(be),I.append(ye)}u=function(e,o){void 0===o&&void 0===e.eden_definition||a(t,n,i,s,r,l)}}else u=function(e,o){void 0===o&&void 0===e.eden_definition||a(t,n,i,s,r,l)};return p.addJSObserver(t+"/"+n+"/"+i,u),f?(l&&I.find("input, textarea").attr("readonly","readonly"),s.append(I),s.accordion({active:"undefined"!=g&&void 0,collapsible:!0,heightStyle:"content"})):y.addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all observable-palette-static-header"),s.removeFromDialog=function(){r.remove(n,s,i)},s}function s(e,t){e.target.style.minWidth=t.size.width+"px"}var r=0,l={};root.addGlobal(function(e,t,i){if(i&&n(t)){var o=t.name.slice(1);for(var a in l)new RegExp("^"+a).test(o)&&l[a].push(o)}}),this.createDialog=function(t,n){function r(e,t){for(var n=t.data("observable"),i=t[0],o=v[n],a=0;a<o.length;a++){var s=o[a],r=s[0];if(r!==i&&r.parentNode===e){s.removeFromDialog();break}}}function l(e,t){var n=v[e];void 0===n&&(n=[],v[e]=n),n.push(t)}function d(n,i,s){function r(e){s?A[i].append(e):(0==i?k.after(e):A[i].prepend(e),e.hide(0,"linear",function(){e.slideDown(400)}))}if(e.eden.isValidIdentifier(n)){var l,d=v[n];if(void 0===d)d=[],v[n]=d;else for(var c=0;c<d.length;c++){var u=d[c];if(u[0].parentNode===A[i][0]){l=u;break}}void 0===l?(l=a(t,n,o(),void 0,L,!1),d.push(l),r(l)):l.slideUp(400,"swing",function(){l.detach(),r(l)})}}function c(e,n,i){var o=v[e];if(void 0!==o)for(var a=0;a<o.length;a++)o[a]===n&&o.splice(a,1);root.lookup(e).removeJSObserver(t+"/"+e+"/"+i),n.slideUp(400,"swing",function(){n.remove()})}function u(e){var n=v[e];if(n){var i=t+"/"+e+"/",o=i.length,a=root.lookup(e);for(var s in a.jsObservers)s.slice(0,o)==i&&a.removeJSObserver(s);for(var r=[],l=0;l<n.length;l++){var d=n[l];d[0].parentNode.parentNode===g[0]?d.slideUp(400,"swing",function(){d.remove()}):r.push(d)}v[e]=r}}var p=t.slice(0,-7),h=root.lookup("createView"),g=$('<div class="observable-palette" id="'+t+'"></div>'),v={},f=$('<input type="text" class="observable-palette-search-box" placeholder="observable name"/>'),m=f[0];f.on("keyup",function(e){13==e.which&&(d(m.value,0,!1),m.value="")}),f.autocomplete({minLength:2,source:i});var b=$('<button type="button">+</button>');b.click(function(){d(m.value,0,!1),m.value=""});var y=$('<button type="button">-</button>');y.on("click",function(e){u(m.value),m.value=""});var w=$("<label></label>"),E=$('<input type="checkbox"/>'),S=E[0];w.append(E),w.append(" Advanced");var x=root.lookup("_view_"+p+"_advanced"),I=x.value();void 0===I?(x.assign(!1,h),g.addClass("observable-palette-no-advanced")):I||g.addClass("observable-palette-no-advanced"),x.addJSObserver("repaintView",function(e,t){g.toggleClass("observable-palette-no-advanced",!t),S.checked=t}),E.on("change",function(e){x.assign(e.target.checked,h)});var k=$('<div class="observable-palette-toolbox"></div>');k.append(f),k.append(b),k.append(y),k.append(w);var A=[],C=7,_=root.lookup("_view_"+p+"_observables").value();Array.isArray(_)&&(_.length>0&&!Array.isArray(_[0])&&(_=[_]),_.length>C&&(C=_.length));for(var T=0;T<C;T++){var D=$('<div class="observable-palette-column"></div>');D.sortable({connectWith:".observable-palette-column, .observable-palette-dependencies",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",scroll:!1,tolerance:"pointer",receive:function(e,t){r(e.target,t.item)}}),T<C-1&&D.resizable({handles:"e",resize:s}),A.push(D),g.append(D)}A[0].append(k);var L={register:l,remove:c,removeDuplicates:r};if(Array.isArray(_)){for(var M=!1,U=root.lookup("_view_"+p+"_search_language").value(),N=[],P=0;P<_.length;P++){var O=_[P];if(N[P]=[],Array.isArray(O))for(H=0;H<O.length;H++){var B=O[H];if(e.eden.isValidIdentifier(B)&&!/[\\*+?^$|({[]|(\s+or\s+)/i.test(B))d(B,P,!0);else{var V=e.regExpFromStr(B,"",!0,U);N[P].push(V),M=!0}}}if(M)for(name in root.symbols)for(P=0;P<N.length;P++)for(var F=N[P],H=0;H<F.length;H++)if((V=F[H]).test(name)){d(name,P,!0);break}}g.dialog({title:n,width:260,height:400+e.scrollBarSize})},e.views.ObservablePalette={dialog:this.createDialog,title:"Observable Palette",category:e.viewCategories.interpretation},t()},EdenUI.plugins.ObservablePalette.title="Observable Palette",EdenUI.plugins.ObservablePalette.description="Provides the ability to change observables using a simple form.",EdenUI.plugins.ScriptGenerator=function(e,t){var n=this;this.createDialog=function(e,t){e.slice(0,-7);var i=$('<div class="script-generator"></div>'),o=($("<div></div>"),$('<div class="script-generator-controls"></div>'),$('<div class="script-generator-controls" style="float: right"></div>'),$('<div class="script-generator-code readonly" spellcheck="false"></div>'));i.append(o);var a=$('<button class="script-generator-refresh">&#xf021;</button>');i.append(a);var s={};o.on("click",".scriptgen-importex",function(e){var t=e.currentTarget.getAttribute("data-agent");s[t]?s[t]=!1:s[t]=!0,r()});var r=function(){o.html("");for(var e=n.generateScriptLines(s),t=0;t<e.imports.length;t++)if(""!=e.imports[t]){var i=e.imports[t].split(" ")[1].split("@")[0],a=e.imports[t].split(" "),r='<span class="eden-keyword">'+a[0]+'</span> <span class="eden-path">'+a[1]+"</span>";if(a.length>2)for(var l=2;l<a.length;l++)r+=" "+a[l];var d=$('<div class="eden-line"><span class="scriptgen-importex" data-agent="'+i+'">'+(s[i]?"&#xf055;":"&#xf056;")+"</span><span>"+(s[i]?'<span class="eden-comment">## '+e.imports[t]+"</span>":r)+"</span></div>");o.append(d)}o.append($('<div class="eden-line"></div>'));var c=$("<div></div>");o.append(c);var u=e.definitions.join("\n")+"\n## When agents\n\n"+e.agents,p=new Eden.AST(u,void 0,{name:"*JavaScript"});new EdenUI.Highlight(c.get(0)).highlight(p,-1,-1)};a.click(function(){r()}),r(),$('<div id="'+e+'"></div>').html(i).dialog({appendTo:"#jseden-views",title:t,width:790,height:700,minHeight:120,minWidth:230,dialogClass:"scriptgen-dialog"})};this.generateScriptLines=function(e){var t={},n=Eden.Generator.importsScript().split("\n");t.imports=n;var i=Eden.Generator.symbolScript(e).split("\n");t.definitions=i;var o=Eden.Agent.getActiveAgents(e,!1);return t.agents=o,t},this.baseConstrualSymbols={},this.changeListener=function(e,t){var i=e.last_modified_by;if(!t&&"include"!=i){var o=e.name.slice(1);void 0!==e.eden_definition&&void 0!==e.definition?n.baseConstrualSymbols[o]={eden_definition:e.eden_definition,last_modified_by:i}:n.baseConstrualSymbols[o]={cached_value:e.cached_value,last_modified_by:i}}},e.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(e,t){root.removeGlobal(n.changeListener)}),this.baseConstrualURL="",e.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:e.viewCategories.history},t()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(e){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(e,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=e)})},function(){"use strict";var e,t=this,n=(e="undefined"!=typeof exports?exports:t.Springy={}).Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]},i=e.Node=function(e,t){this.id=e,this.data=void 0!==t?t:{}},o=e.Edge=function(e,t,n,i){this.id=e,this.source=t,this.target=n,this.data=void 0!==i?i:{}};n.prototype.addNode=function(e){return e.id in this.nodeSet||this.nodes.push(e),this.nodeSet[e.id]=e,this.notify(),e},n.prototype.addNodes=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=new i(t,{label:t});this.addNode(n)}},n.prototype.addEdge=function(e){var t=!1;return this.edges.forEach(function(n){e.id===n.id&&(t=!0)}),t||this.edges.push(e),e.source.id in this.adjacency||(this.adjacency[e.source.id]={}),e.target.id in this.adjacency[e.source.id]||(this.adjacency[e.source.id][e.target.id]=[]),t=!1,this.adjacency[e.source.id][e.target.id].forEach(function(n){e.id===n.id&&(t=!0)}),t||this.adjacency[e.source.id][e.target.id].push(e),this.notify(),e},n.prototype.addEdges=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=this.nodeSet[t[0]];if(void 0==n)throw new TypeError("invalid node name: "+t[0]);var i=this.nodeSet[t[1]];if(void 0==i)throw new TypeError("invalid node name: "+t[1]);var o=t[2];this.newEdge(n,i,o)}},n.prototype.newNode=function(e){var t=new i(this.nextNodeId++,e);return this.addNode(t),t},n.prototype.newEdge=function(e,t,n){var i=new o(this.nextEdgeId++,e,t,n);return this.addEdge(i),i},n.prototype.loadJSON=function(e){("string"==typeof e||e instanceof String)&&(e=JSON.parse(e)),("nodes"in e||"edges"in e)&&(this.addNodes.apply(this,e.nodes),this.addEdges.apply(this,e.edges))},n.prototype.getEdges=function(e,t){return e.id in this.adjacency&&t.id in this.adjacency[e.id]?this.adjacency[e.id][t.id]:[]},n.prototype.removeNode=function(e){e.id in this.nodeSet&&delete this.nodeSet[e.id];for(var t=this.nodes.length-1;t>=0;t--)this.nodes[t].id===e.id&&this.nodes.splice(t,1);this.detachNode(e)},n.prototype.detachNode=function(e){this.edges.slice().forEach(function(t){try{t.source.id!==e.id&&t.target.id!==e.id||this.removeEdge(t)}catch(e){}},this),this.notify()},n.prototype.removeEdge=function(e){for(var t=this.edges.length-1;t>=0;t--)this.edges[t].id===e.id&&this.edges.splice(t,1);for(var n in this.adjacency){for(var i in this.adjacency[n]){for(var o=this.adjacency[n][i].length-1;o>=0;o--)this.adjacency[n][i][o].id===e.id&&this.adjacency[n][i].splice(o,1);0==this.adjacency[n][i].length&&delete this.adjacency[n][i]}l(this.adjacency[n])&&delete this.adjacency[n]}this.notify()},n.prototype.merge=function(e){var t=[];e.nodes.forEach(function(e){t.push(this.addNode(new i(e.id,e.data)))},this),e.edges.forEach(function(e){var n=t[e.from],i=t[e.to],a=e.directed?a=e.type+"-"+n.id+"-"+i.id:n.id<i.id?e.type+"-"+n.id+"-"+i.id:e.type+"-"+i.id+"-"+n.id;this.addEdge(new o(a,n,i,e.data)).data.type=e.type},this)},n.prototype.filterNodes=function(e){this.nodes.slice().forEach(function(t){e(t)||this.removeNode(t)},this)},n.prototype.filterEdges=function(e){this.edges.slice().forEach(function(t){e(t)||this.removeEdge(t)},this)},n.prototype.addGraphListener=function(e){this.eventListeners.push(e)},n.prototype.notify=function(){this.eventListeners.forEach(function(e){e.graphChanged()})};var a=e.Layout={};a.ForceDirected=function(e,t,n,i){this.graph=e,this.stiffness=t,this.repulsion=n,this.damping=i,this.nodePoints={},this.edgeSprings={}},a.ForceDirected.prototype.point=function(e){if(!(e.id in this.nodePoints)){var t=void 0!==e.data.mass?e.data.mass:1;this.nodePoints[e.id]=new a.ForceDirected.Point(s.random(),t)}return this.nodePoints[e.id]},a.ForceDirected.prototype.spring=function(e){if(!(e.id in this.edgeSprings)){var t=void 0!==e.data.length?e.data.length:1,n=!1,i=this.graph.getEdges(e.source,e.target);if(i.forEach(function(e){!1===n&&e.id in this.edgeSprings&&(n=this.edgeSprings[e.id])},this),!1!==n)return new a.ForceDirected.Spring(n.point1,n.point2,0,0);this.graph.getEdges(e.target,e.source);if(i.forEach(function(e){!1===n&&e.id in this.edgeSprings&&(n=this.edgeSprings[e.id])},this),!1!==n)return new a.ForceDirected.Spring(n.point2,n.point1,0,0);this.edgeSprings[e.id]=new a.ForceDirected.Spring(this.point(e.source),this.point(e.target),t,this.stiffness)}return this.edgeSprings[e.id]},a.ForceDirected.prototype.eachNode=function(e){var t=this;this.graph.nodes.forEach(function(n){e.call(t,n,t.point(n))})},a.ForceDirected.prototype.eachEdge=function(e){var t=this;this.graph.edges.forEach(function(n){e.call(t,n,t.spring(n))})},a.ForceDirected.prototype.eachSpring=function(e){var t=this;this.graph.edges.forEach(function(n){e.call(t,t.spring(n))})},a.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(e,t){this.eachNode(function(e,n){if(t!==n){var i=t.p.subtract(n.p),o=i.magnitude()+.1,a=i.normalise();t.applyForce(a.multiply(this.repulsion).divide(o*o*.5)),n.applyForce(a.multiply(this.repulsion).divide(o*o*-.5))}})})},a.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(e){var t=e.point2.p.subtract(e.point1.p),n=e.length-t.magnitude(),i=t.normalise();e.point1.applyForce(i.multiply(e.k*n*-.5)),e.point2.applyForce(i.multiply(e.k*n*.5))})},a.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(e,t){var n=t.p.multiply(-1);t.applyForce(n.multiply(this.repulsion/50))})},a.ForceDirected.prototype.updateVelocity=function(e){this.eachNode(function(t,n){n.v=n.v.add(n.a.multiply(e)).multiply(this.damping),n.a=new s(0,0)})},a.ForceDirected.prototype.updatePosition=function(e){this.eachNode(function(t,n){n.p=n.p.add(n.v.multiply(e))})},a.ForceDirected.prototype.totalEnergy=function(e){var t=0;return this.eachNode(function(e,n){var i=n.v.magnitude();t+=.5*n.m*i*i}),t};e.requestAnimationFrame=function(e,t){return function(){return e.apply(t,arguments)}}(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,n){t.setTimeout(e,10)},t),a.ForceDirected.prototype.start=function(t,n){var i=this;this._started||(this._started=!0,this._stop=!1,e.requestAnimationFrame(function o(){i.applyCoulombsLaw(),i.applyHookesLaw(),i.attractToCentre(),i.updateVelocity(.03),i.updatePosition(.03),void 0!==t&&t(),i._stop||i.totalEnergy()<.01?(i._started=!1,void 0!==n&&n()):e.requestAnimationFrame(o)}))},a.ForceDirected.prototype.stop=function(){this._stop=!0},a.ForceDirected.prototype.nearest=function(e){var t={node:null,point:null,distance:null},n=this;return this.graph.nodes.forEach(function(i){var o=n.point(i),a=o.p.subtract(e).magnitude();(null===t.distance||a<t.distance)&&(t={node:i,point:o,distance:a})}),t},a.ForceDirected.prototype.getBoundingBox=function(){var e=new s(-2,-2),t=new s(2,2);this.eachNode(function(n,i){i.p.x<e.x&&(e.x=i.p.x),i.p.y<e.y&&(e.y=i.p.y),i.p.x>t.x&&(t.x=i.p.x),i.p.y>t.y&&(t.y=i.p.y)});var n=t.subtract(e).multiply(.07);return{bottomleft:e.subtract(n),topright:t.add(n)}};var s=e.Vector=function(e,t){this.x=e,this.y=t};s.random=function(){return new s(10*(Math.random()-.5),10*(Math.random()-.5))},s.prototype.add=function(e){return new s(this.x+e.x,this.y+e.y)},s.prototype.subtract=function(e){return new s(this.x-e.x,this.y-e.y)},s.prototype.multiply=function(e){return new s(this.x*e,this.y*e)},s.prototype.divide=function(e){return new s(this.x/e||0,this.y/e||0)},s.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.normal=function(){return new s(-this.y,this.x)},s.prototype.normalise=function(){return this.divide(this.magnitude())},a.ForceDirected.Point=function(e,t){this.p=e,this.m=t,this.v=new s(0,0),this.a=new s(0,0)},a.ForceDirected.Point.prototype.applyForce=function(e){this.a=this.a.add(e.divide(this.m))},a.ForceDirected.Spring=function(e,t,n,i){this.point1=e,this.point2=t,this.length=n,this.k=i};var r=e.Renderer=function(e,t,n,i){this.layout=e,this.clear=t,this.drawEdge=n,this.drawNode=i,this.layout.graph.addGraphListener(this)};r.prototype.graphChanged=function(e){this.start()},r.prototype.start=function(){var e=this;this.layout.start(function(){e.clear(),e.layout.eachEdge(function(t,n){e.drawEdge(t,n.point1.p,n.point2.p)}),e.layout.eachNode(function(t,n){e.drawNode(t,n.p)})})},r.prototype.stop=function(){this.layout.stop()},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),a=o.length>>>0;if("[object Function]"!={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(n=t),i=0;i<a;){var s;i in o&&(s=o[i],e.call(n,s,i,o)),i++}});var l=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}.call(this),function(){jQuery.fn.springy=function(e){function t(e,t,n,i){var o=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y);if(0===o)return!1;var a=((i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x))/o,s=((t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x))/o;return!(a<0||a>1||s<0||s>1)&&new Springy.Vector(e.x+a*(t.x-e.x),e.y+a*(t.y-e.y))}function n(e,n,i,o,a){var s,r={x:i.x,y:i.y},l={x:i.x+o,y:i.y},d={x:i.x,y:i.y+a},c={x:i.x+o,y:i.y+a};return(s=t(e,n,r,l))?s:(s=t(e,n,l,c))?s:(s=t(e,n,c,d))?s:!!(s=t(e,n,d,r))&&s}var i=this.graph=e.graph||new Springy.Graph,o=e.stiffness||100,a=e.repulsion||5e3,s=e.damping||.5,r=e.nodeSelected||null,l=this[0],d=l.getContext("2d"),c=this.layout=new Springy.Layout.ForceDirected(i,o,a,s),u=c.getBoundingBox(),p={bottomleft:new Springy.Vector(-2,-2),topright:new Springy.Vector(2,2)};Springy.requestAnimationFrame(function e(){p=c.getBoundingBox(),u={bottomleft:u.bottomleft.add(p.bottomleft.subtract(u.bottomleft).divide(10)),topright:u.topright.add(p.topright.subtract(u.topright).divide(10))},Springy.requestAnimationFrame(e)});var h=function(e){var t=u.topright.subtract(u.bottomleft),n=e.subtract(u.bottomleft).divide(t.x).x*l.width,i=e.subtract(u.bottomleft).divide(t.y).y*l.height;return new Springy.Vector(n,i)},g=function(e){var t=u.topright.subtract(u.bottomleft),n=e.x/l.width*t.x+u.bottomleft.x,i=e.y/l.height*t.y+u.bottomleft.y;return new Springy.Vector(n,i)},v=null,f=null,m=null;jQuery(l).mousedown(function(e){var t=jQuery(this).offset(),n=g({x:e.pageX-t.left,y:e.pageY-t.top});null!==(v=f=m=c.nearest(n)).node&&(m.point.m=1e4,r&&r(v.node)),b.start()}),jQuery(l).dblclick(function(e){var t=jQuery(this).offset(),n=g({x:e.pageX-t.left,y:e.pageY-t.top});v=c.nearest(n),node=v.node,node&&node.data&&node.data.ondoubleclick&&node.data.ondoubleclick()}),jQuery(l).mousemove(function(e){var t=jQuery(this).offset(),n=g({x:e.pageX-t.left,y:e.pageY-t.top});f=c.nearest(n),null!==m&&null!==m.node&&(m.point.p.x=n.x,m.point.p.y=n.y),b.start()}),jQuery(window).bind("mouseup",function(e){m=null}),Springy.Node.prototype.getWidth=function(){var e=void 0!==this.data.label?this.data.label:this.id;if(this._width&&this._width[e])return this._width[e];d.save(),d.font="16px Verdana, sans-serif";var t=d.measureText(e).width+10;return d.restore(),this._width||(this._width={}),this._width[e]=t,t},Springy.Node.prototype.getHeight=function(){return 20};var b=this.renderer=new Springy.Renderer(c,function(){var e=l.parentNode;null!==e&&(l.height=e.clientHeight,l.width=e.clientWidth),d.clearRect(0,0,l.width,l.height)},function(e,t,o){for(var a=h(t).x,s=h(t).y,r=h(o).x,l=h(o).y,c=new Springy.Vector(r-a,l-s),u=c.normal().normalise(),p=i.getEdges(e.source,e.target),g=i.getEdges(e.target,e.source),v=p.length+g.length,f=0,m=0;m<p.length;m++)p[m].id===e.id&&(f=m);var b=u.multiply(-0*(v-1)/2+0*f),y=h(t).add(b),w=h(o).add(b),E=e.target.getWidth(),S=e.target.getHeight(),x=n(y,w,{x:r-E/2,y:l-S/2},E,S);x||(x=w);var I,k=void 0!==e.data.color?e.data.color:"#C0C0C0";I="dashes"in e.data?e.data.dashes:[];var A,C=void 0!==e.data.weight?e.data.weight:1;d.lineWidth=Math.max(3*C,.1),A=1+d.lineWidth;var _,T=void 0===e.data.directional||e.data.directional;_=T?x.subtract(c.normalise().multiply(4)):w,d.strokeStyle=k,d.setLineDash(I),d.beginPath(),d.moveTo(y.x,y.y),d.lineTo(_.x,_.y),d.stroke(),T&&(d.save(),d.fillStyle=k,d.translate(x.x,x.y),d.rotate(Math.atan2(l-s,r-a)),d.beginPath(),d.moveTo(-8,A),d.lineTo(0,0),d.lineTo(-8,-A),d.lineTo(-6.4,-0),d.closePath(),d.fill(),d.restore()),void 0!==e.data.label&&(text=e.data.label,d.save(),d.textAlign="center",d.textBaseline="top",d.font="10px Helvetica, sans-serif",d.fillStyle="#5BA6EC",d.fillText(text,(a+r)/2,(s+l)/2),d.restore())},function(e,t){var n=h(t);d.save();var o=e.getWidth();e.getHeight();d.fillStyle="#FFFFFF",d.fillRect(n.x-o/2,n.y-10,o,20),d.setLineDash([]),d.textAlign="left",d.textBaseline="top",d.font="16px Verdana, sans-serif";var a=void 0!==e.data.label?e.data.label:e.id,s=root.lookup(a).eden_definition;void 0==s?d.fillStyle="#0000FF":0==s.toString().indexOf("proc")?d.fillStyle="#FF0000":0==s.toString().indexOf("func")?d.fillStyle="#336600":d.fillStyle="#0000FF",i.re.test(a)&&(d.lineWidth=1,d.strokeStyle="#000000",d.strokeRect(n.x-o/2,n.y-10,o,20)),d.fillText(a,n.x-o/2+5,n.y-8),d.restore()});return b.start(),this}}(),EdenUI.plugins.DependencyMap=function(e,t){var n=this;this.createDialog=function(t,i){function o(){var t;t=""==c.value?/^$/:e.regExpFromStr(d,"",p.checked),n.updateGraph(a,t)}var a=void 0;(a=new Springy.Graph).previousNodes=[],a.previousEdges=[],a.newNodes=[],a.newEdges=[];var s=$('<div id="'+t+'" style="overflow: hidden"></div>'),r=$("<canvas></canvas>").springy({graph:a,nodeSelected:function(e){}});s.append(r);var l=$('<div class="dependency-map-controls"></div>');s.append(l);var d=$('<input type="text" placeholder="search"/>'),c=d.get(0),u=$('<input type="checkbox" checked="checked"/>'),p=u.get(0);l.append(d),l.append($("<label>Exact matches only </label>").append(u)),d.on("input",o),u.on("change",o),s.on("mouseenter",o),s.dialog({appendTo:"#jseden-views",title:i,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(e,t){e.re=t,e.newNodes=[],e.newEdges=[];for(var n in root.symbols){var i=root.symbols[n],o=i.name;if(t.test(o)){-1==e.newNodes.indexOf(o)&&e.newNodes.push(o);var a=i.dependencies;for(var s in a){d=a[s].name;-1==e.newNodes.indexOf(d)&&e.newNodes.push(d),e.newEdges.push([d,o,!1])}a=i.dynamicDependencies;for(var s in a){d=a[s].name;-1==e.newNodes.indexOf(d)&&e.newNodes.push(d),e.newEdges.push([d,o,!0])}a=i.observees;for(var s in a){d=a[s].name;-1==e.newNodes.indexOf(d)&&e.newNodes.push(d),e.newEdges.push([d,o,!1])}var r=i.subscribers;for(var s in r){var l=r[s],d=l.name;-1==e.newNodes.indexOf(d)&&e.newNodes.push(d);var c=i.name in l.dynamicDependencies;e.newEdges.push([o,d,c])}r=i.observers;for(var s in r){d=r[s].name;-1==e.newNodes.indexOf(d)&&e.newNodes.push(d),e.newEdges.push([o,d,!1])}}}if(!arrayCompare(e.previousNodes,e.newNodes)||!arrayCompare(e.previousEdges,e.newEdges)){e.previousNodes=e.newNodes,e.previousEdges=e.newEdges,e.filterEdges(function(e){return!1}),e.filterNodes(function(e){return!1}),e.nodeObjectsStore={};for(var n in e.previousNodes){var u=e.previousNodes[n];e.nodeObjectsStore[u]=e.newNode({label:u},{color:"#6A4A3C"})}for(var s in e.previousEdges){var p=e.previousEdges[s][0],h=e.previousEdges[s][1],g={};e.previousEdges[s][2]&&(g.dashes=[10,10]),e.newEdge(e.nodeObjectsStore[p],e.nodeObjectsStore[h],g)}}},e.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:e.viewCategories.comprehension,menuPriority:2},t()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler",EdenUI.plugins.StateTimeLine=function(e,t){var n=this;this.createDialog=function(t,o){n.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+t+'-content" class="st-content"></div>').append($('<input id="'+t+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){n.ST.states.push(i("partial"));var o=document.getElementById(t+"-regex").value;""==o&&(o="State "+n.ST.nextBlankState),$("#"+t+"-content-states").append("<div id='stdiv"+e.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+o+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+e.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+e.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(t+"-regex").value="",e.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+t+'-content-states"></div>')),$dialog=$('<div id="'+t+'"></div>').html(code_entry).dialog({title:o,width:300,height:450,minHeight:120,minWidth:230})},n.ST={},n.ST.states=[],n.ST.nextBlankState=0,this.deleteState=function(e){$(document.getElementById("stdiv"+e)).remove()},this.changeState=function(t){for(var n in root.symbols)Eden.isitSystemSymbol(root.symbols[n].name.substring(1,root.symbols[n].name.length))||e.plugins.StateTimeLine.ignoreRE.test(root.symbols[n].name.substring(1,root.symbols[n].name.length))||delete root.symbols[n];e.plugins.ScriptInput.submitEdenCode(e.plugins.StateTimeLine.ST.states[t])};var i=function(t){var n=[],i=[],o=[],a=[],s=root.lookup("picture").eden_definition;void 0==s?s="picture is [];":s+=";";for(var r in root.symbols){var l=5,d=root.symbols[r],c=d.eden_definition;if(void 0==c&&(c="@"),0==c.indexOf("proc")){if("(Action)",l=2,"partial"==t&&Eden.isitSystemAgent(r))continue}else if(0==c.indexOf("func")){if("(Function)",l=1,"partial"==t&&Eden.isitSystemFunction(r))continue}else if("(Observable)",l=0,"partial"==t&&Eden.isitSystemObservable(r))continue;var u=Eden.edenCodeForValue(d.cached_value);if(!e.plugins.StateTimeLine.ignoreRE.test(r))if(1==l)a.push(c);else if(0==l){if("@"==u&&"@"==c)continue;"@"==c?i.push(r+" = "+u+";"):n.push(c+";")}else 2==l?o.push(c):console.log("oh dear error")}var p=[];p.push("autocalc = 0;");for(h=0;h<i.length;h++)p.push(i[h]);for(h=0;h<n.length;h++)p.push(n[h]);for(h=0;h<o.length;h++)p.push(o[h]),p.push("");for(var h=0;h<a.length;h++)p.push(a[h]),p.push("");return p.push(s),p.push("autocalc = 1;"),p.join("\n")};e.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:e.viewCategories.history},t()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(e,t){this.createDialog=function(t,n){var i={confirmClose:!1};return $dialog=$('<div id="'+t+'"></div>').html('<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>').dialog({title:n,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){function t(t){var n=e.eden.root,i=n.lookup("definitionOf").definition(n)(t);o.send(i)}if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var n="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",o=new WebSocket(n);eden.listenTo("executeBegin",this,function(e,t){"net"!=e&&o.send(t)}),eden.listenTo("beforeAssign",this,function(e,t,n){"net"!=n&&o.send(e.name.slice(1)+"="+Eden.edenCodeForValue(t)+";")}),$("#sl-status").html("<p>Connected to: "+n+"</p>"),o.onerror=function(e){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+n+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),i.confirmClose=!1},o.onmessage=function(e){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(e.data)+"</p>"),eden.execute(e.data,"net","",{name:"/execute"},noop)},o.onopen=function(){i.confirmClose=!0,randomSeedSym=e.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):t("randomSeed"),t("randomGenerator")}}else console.log("WebSockets not supported")}),i},e.views.StateListener={dialog:this.createDialog,title:"State Listener",category:e.viewCategories.extension},e.eden.include("plugins/state-listener/state-listener.js-e",t)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(e,t){function n(){r=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")}function i(){eden.root.lookup("network_address").assign($("#nr-ipaddr").val(),eden.root.scope),eden.root.lookup("network_port").assign($("#nr-port").val(),eden.root.scope),eden.root.lookup("network_key").assign($("#nr-key").val(),eden.root.scope),a.connect()}var o,a=this,s=!1,r=!1;Eden.Agent.importAgent("lib/dynamic","default",void 0,function(){}),a.connect=function(){function t(t){var n=e.eden.root,i=n.lookup("definitionOf").definition(n)(t);d.send(JSON.stringify({code:i}))}var n=eden.root.lookup("network_address").value(),i=eden.root.lookup("network_port").value(),s=eden.root.lookup("network_key").value();if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var l="ws://"+n+":"+i+"/",d=new WebSocket(l);Eden.Agent.listenTo("executeline",this,function(e,t){if(e){var n=JSON.stringify({action:"executeline",name:e.name,lineno:t});d.send(n)}}),Eden.Agent.listenTo("patch",this,function(e,t,n){if(e){var i=JSON.stringify({action:"patch",name:e.name,patch:t,lineno:n});d.send(i)}}),Eden.Agent.listenTo("owned",this,function(e,t){"net"!=t&&d.send(JSON.stringify({action:"ownership",name:e.name,owned:e.owned}))}),eden.listenTo("beforeAssign",this,function(e,t,n){"net"!=n&&(console.log("ASSIGN: "+e.name+" = "+Eden.edenCodeForValue(t)),d.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:t})))}),$("#nr-status").html("<p>Connected to: "+l+"</p>"),d.onopen=function(n){d.send(s),randomSeedSym=e.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):t("randomSeed"),t("randomGenerator"),r=!0;for(var i in Eden.Agent.agents)Eden.Agent.agents[i].owned&&d.send(JSON.stringify({action:"ownership",name:i,owned:!0}));eden.root.lookup("network_connected").assign(!0,eden.root.scope)},d.onerror=function(e){r=!1,eden.root.lookup("network_connected").assign(!1,eden.root.scope),eden.root.lookup("network_error").assign(e,eden.root.scope)},d.onclose=function(){eden.root.lookup("network_connected").assign(!1,eden.root.scope)},a.sendControl=function(e,t){console.log("Send Control: "+e+"= "+t),console.log(t),d.send(JSON.stringify({action:"control",key:e,value:t}))},a.sendAssign=function(e){"net"!=e.last_modified_by&&d.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:e.value()}))},d.onmessage=function(e){o=JSON.parse(e.data);for(var t=0;t<o.length;t++)switch(line=o[t].code,line.action){case"patch":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.applyPatch(line.patch,line.lineno)});break;case"ownership":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.setOwned(line.owned,"net")});break;case"executeline":Eden.Agent.importAgent(line.name,"default",["noexec"],function(e){e.executeLine(line.lineno,!0)});break;case"assign":eden.root.lookup(line.symbol).assign(line.value,eden.root.scope,{name:"net"})}}}else console.log("WebSockets not supported")},this.createDialog=function(e,t){var o={confirmClose:!1};return $dialog=$('<div id="'+e+'"></div>').html('<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){r?n():i()}),o},this.playCode=function(e){if(void 0!==o[e]){var t=o[e].time/$("#nr-speedrange").val();t>1e3?($("#nr-status").html("<p>Next line in "+t+" milliseconds</p>"),s=!0):s&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(o[e].code,"net","",{name:"/execute"},noop),a.playCode(e+1)},t)}else $("#nr-status").html("<p>Replay finished</p>")},e.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:e.viewCategories.extension},e.eden.include("plugins/network-remote/network-remote.js-e",t),eden.root.lookup("plugins_network_loaded").assign(!0,eden.root.scope)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(e,t){var n="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");i=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(i);var i=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(i),this.name="window_name",this.createDialog=function(t,i){""==n&&(n=t);var o=[];viewlayoutstr="View Layout";var a=5*e.gridSizeY,s=3*e.gridSizeX,r=[],l=root.lookup("_views_list").value(),d=this.name;l.forEach(function(t){if(t!=d){var n=root.lookup("_view_"+t+"_x").value(),i=root.lookup("_view_"+t+"_y").value();r=[t,n=void 0!==n?n:0,i=void 0!==i?i:0,root.lookup("_view_"+t+"_width").value()+e.scrollBarSize,root.lookup("_view_"+t+"_height").value()+e.titleBarHeight,root.lookup("_view_"+t+"_title").value()],console.log(r),o.push(r)}});var c="";o.forEach(function(e,t){c+='<li data-row="'+Math.round(e[2]/a)+'" data-col="'+Math.round(e[1]/s)+'" data-sizex="'+Math.round(e[3]/(1*s))+'" data-sizey="'+Math.round(e[4]/(1*a))+'" data-name="'+e[0]+'" data-num="'+t+'">'+e[5]+" ["+e[0]+"]</li>"});var u='<a class="vl-update">Update</a><div class="gridster"><ul>'+c+"</ul></div>";$dialog=$('<div id="'+t+'"></div>').html(u).dialog({title:i,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[s,a],widget_margins:[0,0],min_cols:Math.round($(window).width()/s),max_cols:Math.round($(window).width()/s),helper:"clone",resize:{enabled:!0},serialize_params:function(e,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y,name:t.name,name:$(t.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var t=gridster.serialize(),n=1,i=1;t.forEach(function(e,t){e.col<n&&(n=e.col),e.row<i&&(i=e.row)}),t.forEach(function(t,o){var r="_view_"+t.name+"_y = "+(t.row-i)*a+";_view_"+t.name+"_x = "+(t.col-n)*s+";_view_"+t.name+"_width = "+(t.size_x*s-e.dialogFrameWidth)+";_view_"+t.name+"_height = "+(t.size_y*a-e.dialogFrameHeight)+";";console.log(r),eden.execute(r)})})},e.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:e.viewCategories.environment},t()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(e,t){function n(e,t,n){this.edenVar=e,this.guard=t,this.actions=n}function i(e,t,n,i){this.name=e,this.parameters=t,this.definitions=n,this.actionsArr=i}function o(e,t,n){this.name=e,this.definitions=t,this.actionsArr=n,this.queuedActions=new Array}var a=this;this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(e,t,n,i,o){L(e)}}),n.prototype.toString=function(){return this.guard+" --\x3e "+this.actions},i.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};var s=function(e,t){for(var i=new Array,o=0;o<t.length;o++){var a=new String(t[o]).split("--\x3e");if(2==a.length){var s="this_g"+i.length;i.push(new n(s,a[0],a[1]))}}return i},r=function(e){var t,n=new Array;e.split("(").length<2?t=e:(n=e.split("(")[1].split(")")[0].split(","),t=e.split("(")[0]);var i=document.getElementById("adm-definitions"),o=[];i.value.length>0&&(o=i.value.split("\n"));var a=(i=document.getElementById("adm-actions")).value.split("\n"),r=s(0,a);return D(t,n,o,r),0},l=function(){for(var e=document.getElementById("adm-name"),t=e.value.split("(")[0],n=!0,i=0;i<a.templates.length;i++)a.templates[i].name==t&&(n=!1);t&&n?-1!=r(e.value)&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",a.currIndex=-1):(alert("Please enter a unique name for this template."),e.focus())},d=function(e){if(e<-1?e=a.templates.length-1:e>=a.templates.length&&(e=-1),-1==e)document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="";else{var t=a.templates[e];document.getElementById("adm-name").value=t.name,document.getElementById("adm-definitions").value=t.definitions.join("\n"),document.getElementById("adm-actions").value=t.actionsArr.join("\n")}a.currIndex=e},c=function(e){e>-1&&(alert("Deleting template "+a.templates[e].name),a.templates.splice(e),a.currIndex=e-1,d(a.currIndex))},u=function(e){return'<div id="'+e+'-input" class="adm-input-code">\t\t\t<div>Name:</div>\t\t\t<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>\t\t\t<div>Definitions:</div>\t\t\t<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>\t\t\t<div>Actions:</div>\t\t\t<div><textarea id="adm-actions" class="adm-actions"></textarea></div>\t\t</div>\t\t<div id="adm-results" class="entitylist-results">\t\t\t<ul id="results"> </ul>\t\t</div>'};this.createTemplateCreator=function(e,t){var n=$("<div></div>");n.html(u(e)),$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){l()}},{id:"btn-delete",text:"Delete Template",click:function(){c(a.currIndex)}},{text:"Previous",click:function(){d(a.currIndex-1)}},{text:"Next",click:function(){d(a.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};var p=function(e,t){var n=new Array;for(x in t){var i=t[x];n.push(i.replace(/this/g,e))}return n},h=function(e,t){var i=new Array;for(x in t){var o=t[x],a=o.guard.replace(/this/g,e),s=o.actions.replace(/this/g,e),r=o.edenVar.replace(/this/g,e);i.push(new n(r,a,s))}return i},g=function(e,t){e.value="";for(x in t)t[x].value=""},v=function(e){var t;for(x in a.templates)if(a.templates[x].name==e){t=a.templates[x];break}return t},f=function(){for(var e=document.getElementById("template-menu"),t=e.options[e.selectedIndex].value,n=v(t),i=document.getElementById("entity-name"),o=i.value,s=!0,r=0;r<a.entities.length;r++)a.entities[r].name==o&&(s=!1);if(0!=s){var l=$("#instantiate-params").find("input"),d=0,c=new Array;for(x in l){var u=l[x];if("text"==u.type){var h=_(n.parameters[d]),f=_(u.value);c.push(u),eden.executeEden(o+"_"+h+" is "+f+";"),d++}}var b=p(o,n.definitions);-1!=m(o,b)&&(E(o,b,n.actionsArr),alert("Successfully added instantiation of "+t+" as "+o),g(i,c))}else alert("please enter a unique name for this instantiation")},m=function(e,t){e=_(e);for(var n=0;n<t.length;n++){var i=_(t[n]);eden.executeEden(e+"_"+i),a.definitions.push(e+"_"+i)}};this.createInstantiator=function(e,t){var n=$("<div></div>");n=$('<div id="template-instantiator">\t\t\t\t\t<div>Templates:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<select id="template-menu">\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t\t<div>Entity name:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<textarea id="entity-name"></textarea>\t\t\t\t\t</div>\t\t\t\t\t<div>Parameters:</div>\t\t\t\t\t<div id="instantiate-params"></div>\t\t\t\t</div>'),$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){f()}}]}),a.templateList=new EdenUI.plugins.ADM.TemplateList;for(x in a.templates){var i=a.templates[x];a.templateList.addTemplate(i.name,i.parameters)}};var b=function(e){var t,n;for(x in a.entities)if(a.entities[x].name==e){t=a.entities[x],n=x;break}if(null!=t){a.entities.splice(n,1);for(x in a.actionLists)if(a.actionLists[x].entityName==e){n=x,a.actionLists[x].remove();break}null!=a.actionLists&&a.actionLists.splice(n,1),null!=a.entityList&&a.entityList.removeEntity(e)}else alert(e+" doesn't exist to delete.")},w=function(e,t,n){var i=v(e);if(null==i)return alert("no template with name "+e),-1;for(x in a.entities)if(a.entities[x].name==n)return alert("Please enter a unique entity name"),-1;if(""==t)o=[];else if(-1==t.indexOf(","))o=[t];else var o=t.split(",");if(o.length!=i.parameters.length)return alert("not enough parameters to instantiate "+i),-1;for(x in o){var s=_(i.parameters[x]),r=_(o[x]);eden.executeEden(n+"_"+s+" is "+r+";")}var l=p(n,i.definitions),d=m(n,l);return-1!=d&&E(n,l,i.actionsArr),d},E=function(e,t,n){var i=h(e,n),s=new o(e,t,i);a.entities.push(s);for(x in i){var r=i[x],l=r.edenVar+" is "+r.guard+";";eden.executeEden(l)}if(null!=a.actionLists){var d=new EdenUI.plugins.ADM.ActionsList(e);a.actionLists.push(d),I(s,d)}null!=a.entityList&&a.entityList.addEntity(e,t,i)},S=function(){for(x in a.selectedActions){var t=a.selectedActions[x];if(945==(t=_(t)).charCodeAt(0))if("r"==t[2])o=(o=t.split("(")[1]).substring(0,o.length-1),b(o);else if("i"==t[2]){var n=t.split("(")[1],i=t.split("(")[2].split(")")[0],o=t.split("as")[1];if(-1==w(n,i,o))break}else alert("Action on another entity must one of _remove(entity_name), _r, _instantiate(template(param_value) as entity_name) or _i");else eden.executeEden(t+";")}a.selectedActions=new Array,e.plugins.ADM.refreshHumanPerspective()};this.actionPush=function(e){a.selectedActions.push(e)},this.actionRemove=function(e){var t=new Array;for(x in a.selectedActions){var n=a.selectedActions[x];n!=e&&t.push(n)}a.selectedActions=t},this.refreshHumanPerspective=function(){for(x in a.entities){var e,t=a.entities[x];for(y in a.actionLists){var n=a.actionLists[y];if(n.entityName==t.name){e=n;break}}e.clear();var i=[];for(x in t.queuedActions){var o=t.queuedActions[x].split(";"),s=o[0];if(s.length>0){o.splice(0,1);var r=!0;o[0].length>0&&(i.push(o.join(";")),r=!1),e.addAction(s,r)}}t.queuedActions=i,I(t,e)}};var I=function(e,t){for(var n=0;n<e.actionsArr.length;n++){var i=e.actionsArr[n];if(!0===eden.root.lookup(i.edenVar).value()){var o=i.actions.split(";"),a=o[0],s=!0;o.splice(0,1),o[0].length>0&&(e.queuedActions.push(o.join(";")),s=!1),t.addAction(a,s)}}};this.createHumanPerspective=function(t,n){var i=$("<div></div>");i=$('<div id="human-perspective" class="actionlist"></div>'),$dialog=$('<div id="'+t+'"></div>').html(i).dialog({title:n,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){e.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){S()}}]}),a.actionLists=new Array;for(x in a.entities){var t=a.entities[x].name;a.actionLists.push(new EdenUI.plugins.ADM.ActionsList(t))}e.plugins.ADM.refreshHumanPerspective()};var k=function(){for(x in a.selectedEntities)b(a.selectedEntities[x]);alert("Entities successfully deleted."),a.selectedEntities=new Array};this.entityPush=function(e){a.selectedEntities.push(e)},this.entityRemove=function(e){var t=new Array;for(x in a.selectedEntities){var n=a.selectedEntities[x];n!=e&&t.push(n)}a.selectedEntities=t};this.createInstanceList=function(e,t){var n=$("<div></div>");n.html('<div id="entity-list" class="instance-list"></div>'),$dialog=$('<div id="'+e+'"></div>').html(n).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){k()}}]}),a.entityList=new EdenUI.plugins.ADM.EntityList;for(x in a.entities){var i=a.entities[x];a.entityList.addEntity(i.name,i.definitions.join("\n"),i.actionsArr.join("\n"))}};var A=function(e){var t=e.split(":")[1];return _(t.split("(")[0])},C=function(e){var t=e.split(":")[1].split("(")[1];return t.length>1?t.split(")")[0].split(","):[]},_=function(e){for(;32==e.charCodeAt(0)||9==e.charCodeAt(0);)e=e.substring(1,e.length);for(;32==e.charCodeAt(e.length-1)||9==e.charCodeAt(e.length-1);)e=T(e);return e},T=function(e){return e.substring(0,e.length-1)},D=function(e,t,n,o){for(x in a.templates)if(a.templates[x].name==e)return alert("Templates must have unique names."),-1;var r=new i(e,t,n,s(0,o));return a.templates.push(r),null!=a.templateList&&a.templateList.addTemplate(e,t),1},L=function(e){var t,n=e.split("\n"),i=new Array,o=new Array,a=new Array,s=!1,r=!1,l=!1;for(x in n){var d=n[x];if(""!=(d=_(d)))if(0==l)if("{"==d[0])l=!0,-1!=d.indexOf("name:")&&(t=A(d),i=C(d));else{var c=d.split("(")[0],u=d.split("(")[1].split(")")[0],p=T(_(d.split("as")[1]));if(-1==(h=w(c,u,p)))break}else if(1==s)-1!=(v=d.indexOf("}"))&&(d=T(d),s=!1),d.length>0&&o.push(d);else if(1==r)-1!=(v=d.indexOf("}"))&&(d=T(d),r=!1),d.length>0&&a.push(d);else if("}"==d[0]){l=!1;var h=D(t,i,o,a);if(t="",i=new Array,o=new Array,a=new Array,-1==h)return}else if(-1!=d.indexOf("name:"))t=A(d),i=C(d);else if(-1!=d.indexOf("definitions:")||-1!=d.indexOf("defs:"))s=!0,(d=_(d)).split("{").length>1&&(-1!=(g=_(d.split("{")[1])).indexOf("}")&&(g=T(g),s=!1),g.length>0&&o.push(g));else if(-1!=d.indexOf("actions:")&&(r=!0,(d=_(d)).split("{").length>1)){var g=_(d.split("{")[1]),v=g.indexOf("}");-1!=v&&(g=T(g),r=!1),g.length>0&&a.push(g)}}};this.createAdvancedInput=function(e,t){var n=document.createElement("textarea");n.style.boxSizing="border-box",n.style.width="100%",n.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(n),$dialog=$('<div id="'+e+'"></div>').html($code_entry).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var e=n.value;L(e),n.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},e.addViewCategory("adm","Abstract Definitive Machine"),e.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:e.viewCategories.adm},e.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:e.viewCategories.adm},e.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:e.viewCategories.adm},e.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:e.viewCategories.adm},e.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:e.viewCategories.adm},t()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(e,t){var n=new EdenUI.plugins.ADM.Template(e,t);n.element.appendTo(this.templateList),this.templates.push(n)},EdenUI.plugins.ADM.Template=function(e,t){this.template=e,this.element=$("<option value="+e+">"+e+"</option>");var n=this.showParamInput;this.element.click(function(){n(t)}),""==document.getElementById("instantiate-params").innerHTML&&n(t)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(e){var t=document.getElementById("instantiate-params");t.innerHTML="";for(x in e){var n=e[x],i=document.createElement("label");i.innerHTML=n+":",t.appendChild(i);var o=document.createElement("input");o.type="text",t.appendChild(o);var a=document.createElement("br");t.appendChild(a)}},EdenUI.plugins.ADM.ActionsList=function(e){var t=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+e),this.actionresults.innerHTML="<label><b>Actions for "+e+":</b></label>",t.appendChild(this.actionresults),this.actions=new Array,this.entityName=e},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(e,t){var n=new EdenUI.plugins.ADM.Action(e,t);n.element.appendTo(this.actionresults),this.actions.push(n)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){document.getElementById("human-perspective").removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(e,t){var e=e;this.action=e,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var n=!1;this.element.hover(function(){0==n?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==n?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){0==n?(edenUI.plugins.ADM.actionPush(e),$(this).css("backgroundColor","#6666CC"),n=!0):(edenUI.plugins.ADM.actionRemove(e),$(this).css("backgroundColor","white"),n=!1)}),this.update(t)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(e){var t='<li class="type-function"><span class="result_name">';t=1==e?t+this.action+"</span></li>":t+this.action+" ... </span></li>",this.element.html(t)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(e,t,n){var i=new EdenUI.plugins.ADM.Entity(e,t,n);i.element.appendTo(this.entityList),this.entities.push(i)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(e){var t;for(x in this.entities)if(this.entities[x].entity==e){t=x;break}this.entities.splice(t,1);var n=document.getElementById("element-"+e);this.entityList.removeChild(n)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(e,t,n){this.entity=e,this.element=$('<div class="entitylist-element" id=element-'+e+"></div>");var i='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(i);var t=t,n=n,o=!1;this.element.hover(function(){0==o?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==o?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){if(this.innerHTML==i){var a=document.createElement("div");a.innerHTML="<label>Definitions:</label><br>\t\t\t\t\t<textarea disabled>"+t+"</textarea><br>\t\t\t\t\t<label>Actions:</label><br>\t\t\t\t\t<textarea disabled>"+n+"</textarea><br>",this.appendChild(a),edenUI.plugins.ADM.entityPush(e),$(this).css("backgroundColor","#6666CC"),o=!0}else this.innerHTML=i,edenUI.plugins.ADM.entityRemove(e),$(this).css("backgroundColor","white"),o=!1})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var e='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(e)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.DBView=function(e,t){this.createDialog=function(e,t){function n(){0==Array.isArray(d)&&(d=[["Value"],[[d]]]);for(var e=a.get(0);e.firstChild;)e.removeChild(e.firstChild);if(s=d[0],r=d[1],Array.isArray(s)||(r=d,s=[["List"]]),Array.isArray(r)){for(var t=$("<tr></tr>"),n=0;n<s.length;n++){var i=$("<th></th>");i.html(s[n]),i.appendTo(t)}t.appendTo(a);for(var o=0;o<r.length;o++){for(var l=$("<tr></tr>"),n=0;n<s.length;n++){var c;(c="scope"==s[n]?$('<td class="dbview-disabled"></td>'):$("<td contenteditable></td>")).appendTo(l);var u=Array.isArray(r[o])?r[o][n]:r[o];c.html("<div class='dbview-cellcontent'>"+Eden.edenCodeForValue(u)+"</div>")}l.appendTo(a)}}}function i(){a.find(".dbview-dependant").removeClass("dbview-dependant"),a.find(".dbview-dependency").removeClass("dbview-dependency")}var o=$('<div id="'+e+'-content" class="dbview-content"><div class="dbview-controls"><div class="dbview-select"><span class="dbview-label">Query:</span><input class="dbview-select-text" type="text"></input></div></div></div>'),a=$('<table class="dbview-table"></table>');a.appendTo(o);var s,r,l=o.find(".dbview-select-text").get(0),d=void 0,c=e.slice(0,-7),u=new Eden.Agent(void 0,"view/db/"+c+"/config"),p="_view_"+c+"_source";return u.declare(p),a.on("input","td",function(e){var t=e.target.cellIndex,n=e.target.parentNode.rowIndex-1;if(!(t<0||n<0))e.target.textContent}).on("mouseenter","td",function(e){e.target.cellIndex,e.target.parentNode.rowIndex}).on("mouseleave","td",function(e){i()}),o.on("input",".dbview-select-text",function(e){u.setSource("_view_"+c+"_source is "+l.value),u.execute(!0,!0)}),d=u.state[p],n(),u.on(p,function(e,t){d=t,n()}),$('<div id="'+e+'"></div>').html(o).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dbview-dialog"}),{confirmClose:!0}},e.views.DBView={dialog:this.createDialog,title:"Database Viewer",category:e.viewCategories.visualization},t()},EdenUI.plugins.DBView.title="DBView",EdenUI.plugins.DBView.description="Display a table showing entire database contents.",EdenUI.plugins.SpeechSynthesis=function(e,t){function n(){var e=window.speechSynthesis.paused;window.speechSynthesis.cancel(),e&&window.speechSynthesis.pause()}function i(e,t){if(a)a=!1;else{var o,s=root.lookup("speak"),r=root.lookup("speakingList"),l=root.lookup("speakingIndex"),d=root.lookup("speaking"),c=root.lookup("speakingID"),u=root.lookup("speakingText"),p=root.lookup("speakingSpeech"),h=root.lookup("speakingCharIndex"),g=r.value(),v=l.value();if(n(),v||(v=1),""!=e){if("finished"==e){var f=u.value();"string"==typeof f&&h.assign(f.length+1,s)}else"interrupted"==e&&(a=!0);o=c.value(),eden.isValidIdentifier(o)&&root.lookup(o+"_status").assign(e,s)}if(t&&v++,h.assign(1,s),root.lookup("speakingTime").assign(0,s),Array.isArray(g)&&v<=g.length){d.value()||d.assign(!0,s);var m=g[v-1];if(!(m instanceof SpeakingWords)||m.cancelled)return void i("",!0);m.prepareUtterance();var b=m.utterance;o=m.id,c.assign(o,s),eden.isValidIdentifier(o)&&root.lookup(o+"_status").assign("speaking",s),u.assign(b.text,s),p.assign(m,s),t&&l.assign(v,s),m.hasBeenSpoken=!0,window.speechSynthesis.speak(b)}else d.assign(!1,s),c.assign("",s),u.assign("",s),p.assign(void 0,s),Array.isArray(g)&&l.assign(g.length+1,s)}}function o(e,t){var n,i,o,a,s=window.speechSynthesis.getVoices();e&&(-1!=(i=(e=e.toLowerCase()).indexOf("-"))?(o=e.slice(0,i),a=!0):(o=e,a=!1)),t&&(n=new RegExp("\\b"+t+"\\b","i"));for(var r=void 0,l=!1,d=!1,c=!1,u=!1,p=0;p<s.length;p++){var h=s[p],g=h.lang,v=!1,f=!1,m=!1;if(e&&g&&(e==(g=g.toLowerCase())?(v=!0,f=!0):o==g?v=!0:-1!=(i=g.indexOf("-"))&&g.slice(0,i)==o&&(v=!0)),t&&n.test(h.name)&&(m=!0),(!d&&!g&&!l||!d&&(!g||!e)&&h.default||v&&!d||a&&f&&!c||v&&!a&&h.default||f&&h.default||m&&!u&&(!e||!g&&!d||v))&&(!u||m||v&&!d)){if(l=!v,d=v,c=f,u=m,(!t||u)&&(c||d&&!a)&&h.default)return h;r=h}}return void 0===r&&(r=s[0]),r}var a=!1;root.lookup("speakingList").addJSObserver("sendToTTS",function(e,t){var n=root.lookup("speak");if(Array.isArray(t)){var o=root.lookup("speakingIndex"),a=o.value();if(a>t.length+1)o.assign(t.length+1,n);else if(a<=t.length){for(var s=a<1?0:a-1;s<t.length;s++){var r=t[s];if(r instanceof SpeakingWords){r.prepareUtterance();var l=r.id;eden.isValidIdentifier(l)&&root.lookup(l+"_status").assign("waiting",n)}}root.lookup("speaking").value()?t[a-1]!==root.lookup("speakingSpeech").value()&&i("interrupted",!1):i("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(e,t){if("speak"!=e.last_modified_by){var n=root.lookup("speakingList").value();if(Array.isArray(n)&&t<=n.length){root.lookup("speaking").value()?i("interrupted",!1):i("",!1);for(var o=t;o<n.length;o++)n[o]instanceof SpeakingWords&&n[o].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(e,t){t?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(t,n,a,s,r,l,d){this.id=t,this.utterance=new window.SpeechSynthesisUtterance(String(n));var c,u,p,h,g,v,f;this.hasBeenSpoken=!1,void 0===s?(v=e.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===v&&(v="native"),p=!0):(v=s,p=!1),this.utterance.volume=r,void 0===l?(null!==(c=e.getOptionValue("speechSynthDefaultRate"))&&(this.utterance.rate=parseFloat(c)),h=!0):(this.utterance.rate=l,h=!1),void 0===d?(null!==(c=e.getOptionValue("speechSynthDefaultPitch"))&&(this.utterance.pitch=parseFloat(c)),g=!0):(this.utterance.pitch=d,g=!1);var m=this;if(Object.defineProperty(this,"text",{get:function(){return m.utterance.text},set:function(e){m.utterance.text=e},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return m.utterance.lang},set:function(e){if(e){var t=e.indexOf("-");-1!=t&&(e=e.slice(0,t+1)+e.slice(t+1).toUpperCase()),m.utterance.lang=e}else m.utterance.lang="";u=!1;var n=o(e,v);m.utterance.voiceURI=n.voiceURI,m.utterance.voice=n},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return v},set:function(e){v=e,p=!1;var t=o(this.utterance.lang,v);m.utterance.voiceURI=t.voiceURI,m.utterance.voice=t},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return m.utterance.volume},set:function(e){m.utterance.volume=e},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return m.utterance.rate},set:function(e){m.utterance.rate=e,h=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return m.utterance.pitch},set:function(e){m.utterance.text=e,g=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return f},set:function(e){(f=e)&&m.id&&root.lookup(m.id+"_status").assign("cancelled",{name:"/SpeakingWords"})},enumerable:!0}),this.toString=function(){var e="SpeakingWords("+Eden.edenCodeForValue(t)+', "'+m.utterance.text+'", ';return u?e+="@, ":e=e+'"'+m.utterance.lang+'", ',p?e+="@, ":e=e+Eden.edenCodeForValue(v)+", ",e=e+m.utterance.volume+", ",h?e+="@, ":e=e+this.utterance.rate+", ",g?e+="@)":e=e+this.utterance.pitch+")",e},void 0===a?(this.lang=e.getOptionValue("speechSynthDefaultLanguage"),u=!0):this.lang=a,eden.isValidIdentifier(t)){var b=root.lookup(t+"_status");void 0===b.value()&&b.assign("not queued",{name:"/speakingWords"})}this.prepareUtterance=function(){if(m.hasBeenSpoken&&!("chrome"in window)){var e=new window.SpeechSynthesisUtterance(m.utterance.text);e.lang=m.utterance.lang,e.volume=m.utterance.volume,e.rate=m.utterance.rate,e.pitch=m.utterance.pitch,e.voiceURI=m.utterance.voiceURI,e.voice=m.utterance.voice,e.onboundary=m.utterance.onboundary,e.onend=m.utterance.onend,e.onerror=m.utterance.onerror,m.utterance=e,m.hasBeenSpoken=!1}},this.utterance.onboundary=function(e){var t={name:"/speak"};root.lookup("speakingCharIndex").assign(e.charIndex+1,t);var n=e.elapsedTime;n<=1e7&&root.lookup("speakingTime").assign(n,t)},this.utterance.onend=function(){i("finished",!0)},this.utterance.onerror=function(){i("error",!0)}},e.eden.include("plugins/speech-synthesis/speech-synthesis.js-e",t)},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!",EdenUI.plugins.MIDI=function(e,t){function n(e,t){if(e<c.length){for(var n=c[e],i=0;i<t.length&&i<16;i++){var o=t[i];Number.isInteger(o)&&o>=1&&o<=128&&n.send([192+i,o-1])}t.length>16&&eden.error(new Error("MIDI programs list is too long."))}}function o(e){if(void 0===e)return v;if(Number.isInteger(e)){if(e<1||l&&e>c.length)throw new Error("No MIDI output device exists with device number "+e);return e-1}if(l&&"string"==typeof e){for(var t=0;t<c.length;t++)if(e==c[t].name)return t;throw new Error("No MIDI output device exists with device name "+e)}throw new Error("The output device must be given as a positive integer.")}function a(e){if(void 0===e)return f;if(Number.isInteger(e)){if(e<1||l&&e>u.length)throw new Error("No MIDI input device exists with device number "+e);return e-1}if(l&&"string"==typeof e){for(var t=0;t<u.length;t++)if(e==u[t].name)return t;throw new Error("No MIDI input device exists with device name "+e)}throw new Error("The input device must be given as a positive integer.")}function s(e){root.lookup("startMIDIInput");if(C==_)x.length>S&&(x=new Array(S)),x[0]=e,C=1,_=0;else{var t,n=e.timeStamp;for(t=C-1;t>=_&&!(x[t].timeStamp<=n);t--);t==C-1?x[C]=e:x.splice(t+1,0,e),C++}T.assign(C-_,eden.root.scope)}var r=this,l=!1;Object.defineProperty(this,"initialized",{get:function(){return l},enumerable:!0});var d=[];this.addSoftwareDriver=function(e){console.log("New JavaScript MIDI driver registered."),d.push(e),l&&e()};var c=[],u=[],p=root.lookup("midiNumberOfOutputs");p.assign(0,eden.root.scope);var h=root.lookup("midiNumberOfInputs");h.assign(0,eden.root.scope);var g={};this.addSoftSynth=function(e){if(c.push(e),p.assign(c.length,eden.root.scope),console.log('Added software synthesizer "'+e.name+'".'),l){var t=c.length-1,i=g[t];void 0!==i&&n(t,i.value())}},this.addSoftInput=function(e){u.push(e),h.assign(u.length,eden.root.scope),console.log('Added software input "'+e.name+'".')};var v=0,f=0;Object.defineProperty(this,"outputNames",{get:function(){for(var e=[],t=0;t<c.length;t++)e.push(c[t].name);return e},enumerable:!0}),Object.defineProperty(this,"inputNames",{get:function(){for(var e=[],t=0;t<u.length;t++)e.push(u[t].name);return e},enumerable:!0}),this.roundValue=function(e){return"number"==typeof e?e<=0?0:e<=1?1:e>=127?127:Math.round(e):void 0},this.isValidNote=function(e){return Number.isInteger(e)&&e>=-20&&e<=107},this.loadPrograms=function(e,t){e=o(e);var n=c[e];if(!Array.isArray(t))throw new Error("MIDI programs must be given as a list.");for(var i=t.length,a=new Array(i),s=0;s<i;s++){var r=t[s];if(!(Number.isInteger(r)&&r>=1&&r<=128))throw new Error("Item "+s+" must be an integer between 1 and 128.");a[s]=r-1}n.loadPrograms&&n.loadPrograms(a)},this.bindPrograms=function(e,t){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");t=o(t),Array.isArray(e.value())||void 0!==e.definition||e.assign([1],eden.root.scope);var i=function(e,i){Array.isArray(i)?l&&n(t,i):eden.error(new Error("Illegal MIDI programs list: "+Eden.edenCodeForValue(i)))};i(0,e.value()),e.addJSObserver("bind",i),g[t]=e},this.getInputs=function(){return u};var m=!1,b=[],y=[];this.initialize=function(e,i){function o(e){if(e<d.length)0==e&&console.log("Found "+d.length+" MIDI drivers written in JavaScript."),d[e](o,[e+1]);else{for(var i in g)n(i,g[i].value());l=!0,m=!1,eden.root.lookup("plugins_midi_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t(),console.log("Done.");for(var a=0;a<b.length;a++)b[a].apply(null,y[a])}}var a=e.value();if(l)a.apply(null,i);else if(b.push(a),y.push(i),!m){m=!0;var s=function(e){if(e){var t=e.outputs.values(),n=t.next();for(n.done&&console.log("No MIDI output devices found.");!n.done;){var i=n.value;console.log("Found MIDI output device "+i.name+"."),c.push(i),n=t.next()}for((n=(t=e.inputs.values()).next()).done&&console.log("No MIDI input devices found.");!n.done;){var a=n.value;console.log("Found MIDI input device "+a.name+"."),u.push(a),n=t.next()}p.assign(c.length,eden.root.scope),h.assign(u.length,eden.root.scope)}o(0)},r=function(e){var t="Unable to access WebMIDI: "+e;console.log(t),eden.error(new Error(t)),o(0)};console.log("Initializing MIDI..."),window.navigator.requestMIDIAccess?window.navigator.requestMIDIAccess().then(s,r):(console.log("This browser does not support the WebMIDI API.  No access to hardware MIDI devices is possible."),o(0))}},this.mergeMessageLists=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(Array.isArray(i))t.push(i);else if(void 0!==i)throw new Error("Item "+n+" must be a list of MIDI messages.")}for(var o=t.length,a=new Array(o),s=0,n=0;n<o;n++)a[n]=0,s+=t[n].length;for(var r=new Array(s),n=0;n<s;n+=2){for(var l,d,c=1/0,u=0;u<o;u++){var p=a[u];if(p<t[u].length){var h=t[u],g=h[p],v=h[p+1];v<c&&(c=v,d=g,l=u)}}r[n]=d,r[n+1]=c,a[l]=a[l]+2}return r},this.playMIDI=function(e,t,n){if(e=o(e),void 0===t)t=0;else if("number"!=typeof t)throw new Error("The delay must be a number.");if(!Array.isArray(n))throw new Error("The message stream must be an array.");for(var i=c[e],a=window.performance.now()+t,s=0;s<n.length;s+=2)i.send(n[s],a+n[s+1])};var w={};this.alterNote=function(e,t,n,i,a,s){var l=w[e],d=c[o(t)];r.isValidNote(i)?i===l?a>0&&(s?d.send([144+n,i+20,r.roundValue(a)]):d.send([144+n,i+20,0])):(a>0?(void 0!==l&&d.send([144+n,l+20,0]),s&&d.send([144+n,i+20,r.roundValue(a)])):a<0?void 0!==l&&d.send([128+n,l+20,r.roundValue(-a)]):void 0!==l&&d.send([144+n,l+20,0]),w[e]=i):void 0!==l&&d.send([144+n,l+20,0])},this.alterVelocity=function(e,t,n,i,a){if(i===w[e]&&void 0!==i){var s=c[o(t)];a>0?s.send([160+n,i+20,r.roundValue(a)]):a<0?s.send([128+n,i+20,r.roundValue(-a)]):s.send([144+n,i+20,0])}};var E={};E.volume=7,this.bindControlChange=function(e,t,n,i){function a(e,t){var i=r.roundValue(t);void 0!==i&&l.send([176+n,s,i])}if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");var s,l=c[o(t)];if("string"==typeof i){if(void 0===(s=E[i.toLowerCase()]))throw new Error("Unknown control name "+i)}else{if(!(Number.isInteger(i)&&i>=0&&i<=127))throw new Error("The control must be specified either as a string or as an integer between 0 and 127 inclusive.");s=i}a(e,e.value()),e.addJSObserver("bind",a)};var S=16,x=new Array(S),I=root.lookup("midiInputDevice"),k=root.lookup("midiInputTimestamp"),A=root.lookup("midiInputMessage"),C=0,_=0,T=root.lookup("midiInputMessageCount");this.startInput=function(e){if(void 0===e)for(i=0;i<u.length;i++)u[i].onmidimessage=s;else e=a(e),u[e].onmidimessage=s},this.fetchInputMessage=function(){if(_!=C){root.lookup("startMIDIInput");var e=x[_],t=x.length;_++,t>=2*S&&_>.8*t-1&&(x.splice(0,_),C-=_,_=0);var n,i=e.target;i&&(n=i.name),root.beginAutocalcOff(),I.assign(n,root.scope),k.assign(e.timeStamp,root.scope),A.assign(e.data,eden.root.scope),T.assign(C-_,eden.root.scope),root.endAutocalcOff()}},this.clearInputMessages=function(){x.length>S&&(x=new Array(S)),C=0,_=0,T.assign(0,eden.root.scope)},Eden.Selectors.execute("plugins > midi > midi",function(){})},EdenUI.plugins.MIDI.title="MIDI",EdenUI.plugins.MIDI.description="Adds musical capabilities to JS-EDEN.",EdenUI.plugins.Debugger=function(e,t){this.createDialog=function(e,t){function n(e){var t="";return"when"==e.type&&e.base&&e.base.origin?(t+="## "+e.base.origin.name,e.line&&(t+=":"+(e.line+1)),t+="\n"):e.name&&(t+="## "+e.name+"\n"),e.getSource&&(t+=e.getSource()),t}e.slice(0,-7);var i=!1,o=void 0,a=!1,s=500,r=$('<div class="debugger"></div>'),l=$('<div class="debugger-controls"><button title="Toggle capture all agents" style="margin-left: 20px; margin-right: 20px;" class="debugger-button debug">&#xf188;</button><button class="debugger-button play" title="Auto Play">&#xf04b;</button><button class="debugger-button stepforward">&#xf051;</button><button class="debugger-button autostep">&#xf050;</button><input type="range" class="debugger-speed" value="500" max="1000" min="50"></input></div>');r.append(l);var d=$('<div class="debugger-agents"></div>');r.append(d);var c={},u=1,p=function(e){var t=e.agent,o=n(t);if(c[t.id]){var r=c[t.id].html;if(c[t.id].data=e,a=!1,r){var l=new Eden.AST(o,void 0,t);if(new EdenUI.Highlight(r.get(0).childNodes[1]).highlight(l,-1,-1),e.statement){var d=e.statement.line-t.getLine(),u=r.get(0).childNodes[1].childNodes[d+1];u?u.className="eden-line debugger-line":console.error("Missing line: "+d)}}else console.error("Missing output")}i&&setTimeout(e.next,s)};Eden.AST.debugstep_cb=p;var h=function(e){var t=e.agent;void 0!==t.id&&(g(e),console.log("WHEN ALREADY LOGGED")),t.id=u,u++;var i=$('<div class="debugger-agent" data-agent="'+t.id+'"><div class="debugger-agent-controls"></div><div class="debugger-code"></div></div>');d.append(i),c[t.id]={html:i,data:e},void 0===o&&(o=c[t.id],i.get(0).className="debugger-agent active");var a=n(t),s=new Eden.AST(a,void 0,t);new EdenUI.Highlight(i.get(0).childNodes[1]).highlight(s,-1,-1)};Eden.AST.debug_begin_cb=h;var g=function(e){var t=e.agent;if(void 0!==t.id&&void 0!==c[t.id]){o===c[t.id]&&(a=!1,o=void 0);var i=n(t),s=c[t.id].html,r=new Eden.AST(i,void 0,t);new EdenUI.Highlight(s.get(0).childNodes[1]).highlight(r,-1,-1),c[t.id].html.remove(),delete c[t.id],t.id=void 0}};return Eden.AST.debug_end_cb=g,Eden.AST.debug=!0,Eden.AST.debugstep=!1,$('<div id="'+e+'"></div>').html(r).dialog({appendTo:"#jseden-views",title:t,width:590,height:500,minHeight:120,minWidth:230,dialogClass:"debugger-dialog"}),l.on("click",".play",function(e){(i=!i)?(e.currentTarget.innerHTML="&#xf04c;",e.currentTarget.className="debugger-button play active"):(e.currentTarget.innerHTML="&#xf04b;",e.currentTarget.className="debugger-button play")}).on("click",".stepforward",function(e){o&&o.data.next&&(o.data.next(),o&&(o.data.next=void 0))}).on("click",".debug",function(e){Eden.AST.debugstep=!Eden.AST.debugstep,Eden.AST.debugstep?e.currentTarget.className="debugger-button debug active":e.currentTarget.className="debugger-button debug"}).on("change",".debugger-speed",function(e){s=e.currentTarget.value,console.log("Change speed: "+s)}),d.on("click",".debugger-agent",function(e){o&&(o.html.get(0).className="debugger-agent"),(o=c[e.currentTarget.getAttribute("data-agent")]).html.get(0).className="debugger-agent active"}),{destroy:function(){Eden.AST.debug=!1}}},e.views.Debugger={dialog:this.createDialog,title:"Debugger",category:e.viewCategories.history},t()},EdenUI.plugins.Debugger.title="Debugger",EdenUI.plugins.Debugger.description="",EdenUI.plugins.Debugger.originalAuthor="Nicolas Pope",EdenUI.plugins.MIDIDotJS=function(e,t){function n(){e.plugins.MIDI.addSoftwareDriver(function(t,n){function a(o){o==l.length?(s=window.MIDI).loadPlugin({soundfontUrl:i,onsuccess:function(){e.plugins.MIDI.addSoftSynth(r),t&&t.apply(this,n)}}):$.ajax({url:"plugins/midi/emulation/lib/MIDI.js/"+l[o],success:function(){a(o+1)}})}var s,r={};r.name="MIDI.js",r.loadPrograms=function(e){for(var t=0;t<e.length;t++)o[e[t]]=!0;s.loadPlugin({soundfontUrl:i,instrument:e})},r.send=function(e,t){var n=e[0],a=240&n,r=15&n,l=e[1],d=e[2];switch(void 0===t?t=0:t-=window.performance.now(),a){case 128:s.noteOff(r,l,t/1e3);break;case 144:0==d?s.noteOff(r,l,t/1e3):s.noteOn(r,l,d,t/1e3);break;case 176:switch(l){case 7:var c=d/127*(d/127)*64;MIDI.setVolume(r,c,t/1e3);break;default:console.log("Unable to change MIDI control number "+l+" using MIDI.js")}break;case 192:o[l]||(o[l]=!0,s.loadPlugin({soundfontUrl:i,instrument:l})),s.setInstrument(r,l,t);break;default:console.log("Unable to map MIDI command "+n.toString(16)+" to MIDI.js")}},r.clear=function(){};var l=["inc/shim/Base64binary.js"];"true"==e.getOptionValue("developer")?l.push("build/MIDI.js"):l.push("build/MIDI.min.js"),a(0)}),t()}var i="plugins/midi/emulation/soundfonts/FluidR3_GM/",o=new Array(127);e.plugins.MIDI?n():e.loadPlugin("MIDI",n)},EdenUI.plugins.MIDIDotJS.title="MIDI.JS",EdenUI.plugins.MIDIDotJS.description="Uses the MIDI.js JavaScript library to add a software synthesizer for users who cannot access a MIDI instrument via WebMIDI and the basic MIDI plug-in.",EdenUI.plugins.MIDIFileInput=function(e,t){function n(){e.plugins.MIDI.addSoftwareDriver(function(t,n){e.plugins.MIDI.addSoftInput(i),t&&t.apply(this,n)})}var i={};i.name="MIDI Input from MIDI File",this.queue=function(e){function t(e){var t=new Uint8Array(e.slice(1));return new MIDIMessageEvent("midimessage",{target:i,data:t})}function n(s){if(s!=a){var r=e[s],l=o+r[0]-window.performance.now();if(l>0)window.setTimeout(function(){var e=t(r);i.onmidimessage(e),n(s+1)},l);else{var d=t(r);i.onmidimessage(d),n(s+1)}}}var o=window.performance.now(),a=e.length;n(0)},e.plugins.MIDI?n():e.loadPlugin("MIDI",n)},EdenUI.plugins.MIDIFileInput.title="MIDI File Input",EdenUI.plugins.MIDIFileInput.description="Use a MIDI file to simulate MIDI file input.";