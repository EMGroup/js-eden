function getCaretCharacterOffsetWithin(a){var b,c=0,d=a.ownerDocument||a.document,e=d.defaultView||d.parentWindow;if("undefined"!=typeof e.getSelection){if(b=e.getSelection(),b.rangeCount>0){var f=e.getSelection().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.endContainer,f.endOffset),c=g.toString().length}}else if((b=d.selection)&&"Control"!=b.type){var h=b.createRange(),i=d.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),c=i.text.length}return c}function getStartCaretCharacterOffsetWithin(a){var b,c=0,d=a.ownerDocument||a.document,e=d.defaultView||d.parentWindow;if("undefined"!=typeof e.getSelection){if(b=e.getSelection(),b.rangeCount>0){var f=e.getSelection().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.startContainer,f.startOffset),c=g.toString().length}}else if((b=d.selection)&&"Control"!=b.type){var h=b.createRange(),i=d.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),c=i.text.length}return c}function get_time_diff(a){var b=1e3*a,c=Date.now();if(isNaN(b))return"";if(c>b)var d=c-b;else var d=b-c;var e=Math.floor(d/1e3/60/1440),f=new Date(d);if(e>5)return"";var g="";if(e>0)g+=e,g+=e>1?" days ago":" day ago";else if(f.getHours()>0){var h=f.getHours();g+=h,g+=h>1?" hours ago":" hour ago"}else{var i=f.getMinutes();if(i>0)g+=i,g+=i>1?" minutes ago":" minute ago";else{var j=f.getSeconds();g+=j,g+=" seconds ago"}}return g}function EdenScriptGutter(a){this.$gutter=$('<div class="eden-gutter"></div>'),this.gutter=this.$gutter.get(0),a.appendChild(this.gutter)}function _formatVal(a){var b=Eden.prettyPrintValue("",a,200,!1,!1);switch(typeof a){case"boolean":return"<span class='special_text'>"+b+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+b+"</span>";case"number":return"<span class='numeric_text'>"+b+"</span>";default:return b}}function _formatFramerVal(a){var b=Eden.prettyPrintValue("",a,200,!1,!1);switch(typeof a){case"boolean":return"<span class='special_text'>"+b+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+b+"</span>";case"number":return"<span class='numeric_text'>"+b+"</span>";default:return b}}"time"in console||(console.time=function(a){},console.endTime=function(a){}),EdenUI.plugins.ScriptInput=function(a,b){EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var c=this;({name:Symbol.getInputAgentName()});this.createHistory=function(a,b){historydialog=$('<div id="'+a+'"></div>').html('<div class="history"></div>').dialog({title:b,width:500,height:500,minHeight:300,minWidth:300}).find(".history")},this.createCommon=function(a,b,c,d,e){function f(a,b,c){var d=$('<div class="options-menu-item"><span class="options-menu-icon">'+a+"</span><span>"+b+"</span></div>");wa.append(d),d.click(c)}function g(){wa.hide("slide",{direction:"down"},200)}function h(){for(;xa.firstChild;)xa.removeChild(xa.firstChild);f(Ya.state[Wa]?"&#xf00c;":"&#xf00d;","Show Tabs",function(a){Ya.state[Wa]=!Ya.state[Wa],h()}),f(Ya.state[Xa]?"&#xf00c;":"&#xf00d;","Show Controls",function(a){Ya.state[Xa]=!Ya.state[Xa],h()}),f(Oa?"&#xf00c;":"&#xf00d;","Show Hidden",function(a){Oa=!Oa,n()}),f("&#xf0c0;","Browse Agents",function(a){}),f("&#xf05e;","Remove Agent",function(a){Eden.Agent.remove(za),g()}),f("&#xf036;","View History",function(a){U("showHistory",function(a,b){a&&za.rollback(b)},za),g()}),f("&#xf0d0;","Insert Template",function(a){}),e&&f("&#xf24d;","Un-embed",function(a){})}function i(){var a=ta.find(".share-agent");a.removeClass("control-enabled")}function j(){var a=ta.find(".next-input"),b=ta.find(".previous-input");Na||!za.canRedo()?a.removeClass("control-enabled"):a.addClass("control-enabled"),Na||!za.canUndo()?b.removeClass("control-enabled"):b.addClass("control-enabled")}function k(a,b,c){var d=document.createElement("div"),e="agent-tab noselect";e+=c?" agent-tab-current":" agent-tab-notcurrent",d.className=e,d.innerHTML=b,d.setAttribute("data-name",a),ra.childNodes.length<Ma+1&&(d.style.display="none"),ra.appendChild(d)}function l(a){a===za&&(p("[saved]"),j())}function m(a,b){if(za.name==a)if(Ma>0&&Ma--,b)t(void 0,b);else{for(var c in Eden.Agent.agents)return void t(void 0,c);t(void 0,void 0)}}function n(){for(;ra.firstChild;)ra.removeChild(ra.firstChild);var a=document.createElement("div");a.className="agent-tableft noselect",ra.appendChild(a);for(var b in Eden.Agent.agents){var c=Eden.Agent.agents[b];(Oa||!c.hidden)&&k(b,c.title,b==za.name)}var d=document.createElement("div");d.className="agent-newtab noselect",ra.appendChild(d);var e=document.createElement("div");e.className="agent-tabright noselect",ra.appendChild(e)}function o(a){za.setTitle(a),n();var b=ka.get(0).parentNode;b&&(b=b.parentNode,b&&$(b).find(".ui-dialog-title").html(a))}function p(a){if(!e){var b=ka.get(0).parentNode;if(b&&(b=b.parentNode)){var c=$(b).find(".ui-dialog-subtitle").get(0);void 0===c&&(c=document.createElement("span"),c.className="ui-dialog-subtitle",$(b).find(".ui-dialog-title").get(0).parentNode.appendChild(c)),c.textContent=za.name+" "+a}}}function q(a,b){var c="";if(b){if(b instanceof Array)for(var d=0;d<b.length;d++)"string"==typeof b[d]?c+=b[d]+"\n":"object"==typeof b[d]&&(c+=b[d].eden_definition+"\n");na.value=c,C()}}function r(a,b){$.get(b,function(a){na.value=a,C(za.enabled)},"text")}function s(a,b){b?N():M()}function t(a,b){if(b&&Eden.Agent.agents[b]){if(b==za.name)return;if(0==Na&&za.setOwned(!1),za=Eden.Agent.agents[b],0==Eden.Agent.agents[b].owned?(za.setOwned(!0),Na=!1,p(""),oa.className="outputcontent",oa.contentEditable=!0):(Na=!0,p("[readonly]"),oa.className="outputcontent readonly",oa.contentEditable=!1),za.ast&&(na.value=za.ast.stream.code,K(za.ast,-1,0)),za.enabled?N():M(),a){Ma=0;for(var c in Eden.Agent.agents){if(c==za.name)break;Ma++}Ma>0&&Ma--}j(),n()}}function u(a,b){b?ma.style.top="35px":ma.style.top="0"}function v(a,b){b?(ua.style.display="inherit",ma.style.bottom="30px"):(ua.style.display="none",ma.style.bottom="0")}function w(a,b){za.name==a.name&&"net"==b&&a.owned&&(Na=!0,p("[readonly]"),oa.className="outputcontent readonly",oa.contentEditable=!1)}function x(a){Ya&&void 0!==Ya.state[Va]&&a.name==Ya.state[Va]&&a.name!=za.name&&t(void 0,a.name)}function y(a){Ya&&void 0!==Ya.state[Va]&&(a.name==Ya.state[Va]&&a.name!=za.name?t(void 0,a.name):a.name==za.name&&(na.value=a.getSource(),K(za.ast,-1,0)))}function z(a){a===za&&(na.value=za.snapshot,C(!0),j())}function A(){za.setSource(na.value),Ia.ast=za.ast;var a=-1,b=-1;document.activeElement===na&&(b=na.selectionEnd,a=L(na)),T(a),K(za.ast,a,b)}function B(){var a=-1,b=-1;document.activeElement===na&&(b=na.selectionEnd,a=L(na)),K(Ia.ast,a,b)}function C(a){za.setSource(na.value),Ia.ast=za.ast;var b=-1;document.activeElement===na&&(b=na.selectionEnd),a&&T(0),K(za.ast,-1,b)}function D(a,b,c,d){"warning"==c?pa.innerHTML="<div class='info-warnitem'><span>"+d+"</span></div>":"error"==c&&(pa.innerHTML="<div class='info-erroritem'><span>"+d+"</span></div>"),$info=$(pa),$info.css("top",""+b+"px"),$info.css("left",""+a+"px"),$(pa).show("fast")}function E(){$(pa).hide("fast")}function F(a){var b=$(oa.childNodes[a-1]);b.addClass("eden-extendedline")}function G(a){var b=$(oa.childNodes[a-1]);b.addClass("eden-parentline")}function H(a,b){var c=na.value.split("\n");c[a]=b,na.value=c.join("\n")}function I(a){for(var b=a;b.parentNode!==oa;)b=b.parentNode;for(var c=0;c<oa.childNodes.length;c++)if(oa.childNodes[c]===b)return c;return-1}function J(){var a=$(oa).find(".fake-caret").get(0);if(void 0!==a){for(var b=la.get(0),c=a.offsetLeft-b.scrollLeft+25,d=b.clientWidth+b.scrollLeft-a.offsetLeft-25;a.parentNode!=oa;)a=a.parentNode;var e=a.offsetTop-b.scrollTop+15,f=b.clientHeight+b.scrollTop-a.offsetTop-15;80>c&&(b.scrollLeft=b.scrollLeft-(80-c)),80>d&&(b.scrollLeft=b.scrollLeft+(80-d)),40>e&&(b.scrollTop=b.scrollTop-(40-e)),40>f&&(b.scrollTop=b.scrollTop+(40-f))}}function K(a,b,c){Ia.highlight(a,b,c),sa.generate(a,b),(-1==b||1==b)&&"#"==a.stream.code.charAt(0)&&o(a.stream.code.split("\n")[0].substr(2));for(var d=0;d<a.lines.length;d++)if(a.lines[d]&&"definition"==a.lines[d].type){var e=eden.root.lookup(a.lines[d].lvalue.observable);e.extend&&(a.lines[d].lvalue.lvaluep.length>0?G(d+1):F(d+1))}document.activeElement!==na&&$(oa).find(".fake-caret").addClass("fake-blur-caret"),za.enabled&&$(oa).find(".eden-number").draggable({helper:function(a){return $("<div class='eden-drag-helper'></div>")},axis:"x",drag:function(a,b){var c;if(Ea?c=Math.round(Ba+(b.position.left-Aa)/2):(c=Ba+.005*(b.position.left-Aa),c=c.toFixed(4)),c!=Ca){Ca=c,a.target.innerHTML=""+c;var d=a.target.parentNode.textContent;"\n"==d.charAt(d.length-1)&&(d=d.slice(0,-1)),H(Da,d),za.setSource(na.value),Ia.ast=za.ast,za.enabled&&!za.hasErrors()&&za.executeLine(Da),K(za.ast,Da,-1)}},start:function(a,b){Ka=!0,Da=I(a.target),Aa=b.position.left;var c=a.target.textContent;-1==c.indexOf(".")?(Ba=parseInt(c),Ea=!0):(Ba=parseFloat(c),Ea=!1),Ca=Ba,$(a.target).addClass("eden-select"),$(oa).css("cursor","ew-resize")},stop:function(a,b){$(a.target).removeClass("eden-select"),$(oa).css("cursor","text"),Da=-1},cursor:"move",cursorAt:{top:-5,left:-5}})}function L(a){var b=a.value.substr(0,a.selectionStart).split("\n");return Ga=b.length,Ha=b[b.length-1].length,Ga}function M(){P(),va.removeClass("power-on").addClass("power-off"),za.setEnabled(!1)}function N(){va.removeClass("power-off").addClass("power-on"),za.setEnabled(!0)}function O(){za.enabled&&va.addClass("power-error")}function P(){va.hasClass("power-error")&&va.removeClass("power-error")}function Q(){var a=$(oa).find(".fake-caret").get(0),b=document.createRange(),c=window.getSelection();a.nextSibling&&(a=a.nextSibling),b.setStart(a,0),b.collapse(!0),c.removeAllRanges(),c.addRange(b),$(oa).remove(".fake-caret")}function R(){var a=document.createRange();a.selectNodeContents(oa);var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}function S(){Ja?(C(),Ja=!1):A(),J(),La=!1}function T(a){za.enabled&&!za.hasErrors()?(P(),za.executeLine(a-1)):za.enabled&&O()}function U(a,b,c){EdenUI.plugins.ScriptInput.dialogs[a]&&EdenUI.plugins.ScriptInput.dialogs[a](ka,b,c)}function V(){Ka=!0,za.isSaved()&&p(""),clearTimeout(ya),ya=setTimeout(S,Fa)}function W(a){La=!0,V()}function X(a){if(a.ctrlKey||17==a.keyCode||16==a.keyCode){if(a.ctrlKey)if(a.shiftKey){if(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||36==a.keyCode||35==a.keyCode)return Q(),void oa.focus()}else 38===a.keyCode?da():40===a.keyCode?ea():86===a.keyCode?M():65===a.keyCode&&(a.preventDefault(),oa.focus(),R())}else if(9==a.keyCode){a.preventDefault();var b=na.selectionStart,c=na.selectionEnd;na.value=na.value.substring(0,b)+"	"+na.value.substring(c),na.selectionStart=na.selectionEnd=b+1,V()}else if(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||36==a.keyCode||35==a.keyCode){if(a.shiftKey)return Q(),void oa.focus();B(),J()}else(13==a.keyCode||8==a.keyCode&&10==na.value.charCodeAt(na.selectionStart-1))&&(Ja=!0)}function Y(a){a.ctrlKey||37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&36!=a.keyCode&&35!=a.keyCode?!a.ctrlKey||86!=a.keyCode&&90!=a.keyCode?V():C():B()}function Z(a){if(16==a.keyCode||17==a.keyCode||a.ctrlKey&&67==a.keyCode);else if(!a.shiftKey||37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&35!=a.keyCode&&36!=a.keyCode){var b=getCaretCharacterOffsetWithin(oa),c=getStartCaretCharacterOffsetWithin(oa);na.focus(),na.selectionEnd=b,na.selectionStart=c}}function _(a){$(oa).find(".fake-caret").remove(),E()}function aa(a){}function ba(a){if(E(),g(),document.activeElement===oa){var b=getCaretCharacterOffsetWithin(oa),c=getStartCaretCharacterOffsetWithin(oa);if(c!=b)Ja=!0;else{var d=Ga;na.focus(),na.selectionEnd=b,na.selectionStart=b,Ia.highlight(Ia.ast,d,b),B()}}}function ca(a){for(var b=-1,c=0;c<sa.gutter.childNodes.length;c++)if(a.target===sa.gutter.childNodes[c]){b=c+1;break}if(za.ast.lines[b-1])if(za.ast.lines[b-1].errors.length>0){var d=za.ast.lines[b-1].errors[0];if(d.line==b||"runtime"==d.type){var e=Ya.state[Wa]?35:0;D(a.target.offsetLeft+20,a.target.offsetTop-la.get(0).scrollTop+25+e,"error",d.messageText())}}else za.clearExecutedState(),za.executeLine(b-1),sa.generate(za.ast,b)}function da(){1==Ya[Sa]?(Ya[Ra]=!0,Ya[Ra]=!1):!Na&&za.canUndo()&&(za.undo(),na.value=za.snapshot,C(!0),j())}function ea(){1==Ya[Sa]?(Ya[Qa]=!0,Ya[Qa]=!1):!Na&&za.canRedo()&&(za.redo(),na.value=za.snapshot,C(!0),j())}function fa(a){var b=a.target.getAttribute("data-name");console.log(b),Ya[Va]=b,t(void 0,b),j()}function ga(){Ma>0&&(Ma--,ra.childNodes[Ma+1].style.display="initial")}function ha(){Ma<ra.childNodes.length-3&&(ra.childNodes[Ma+1].style.display="none",Ma++)}function ia(){wa.toggle("slide",{direction:"down"},200)}function ja(){U("newAgent",function(a,b){if(a){var c=new Eden.Agent(void 0,b);c.setEnabled(!1),t(void 0,b)}})}var ka=$('<div class="inputdialogcontent"><div class="inputhider"><textarea autofocus tabindex="1" class="hidden-textarea"></textarea><div class="agent-tabs"></div><div class="inputCodeArea"><div class="eden_suggestions"></div><div spellcheck="false" contenteditable class="outputcontent"></div></div></div><div class="info-bar"></div><div class="outputbox"></div></div></div>'),la=ka.find(".inputCodeArea"),ma=la.get(0),na=ka.find(".hidden-textarea").get(0),oa=ka.find(".outputcontent").get(0),pa=ka.find(".info-bar").get(0),qa=(ka.find(".outputbox").get(0),ka.find(".eden_suggestions")),ra=ka.find(".agent-tabs").get(0);qa.hide(),$(pa).hide();var sa=new EdenScriptGutter(la.get(0)),ta=$('<div class="control-bar"><div class="buttonsDiv"><button class="control-button search-mode" title="Query state">&#xf002;</button><button class="control-button share-agent" title="Share on network">&#xf0e8;</button><button class="control-button previous-input" title="Undo">&#xf112;</button><button class="control-button next-input" title="Redo">&#xf064;</button><button class="control-button control-enabled menu-input">&#xf142;</button></div>');ta.appendTo(ka);var ua=ta.get(0),va=$('<div class="scriptswitch power-off" title="Enable Automation">&#xF011;</div>');ta.append(va);va.get(0);d&&N();var wa=$('<div class="options-menu noselect"></div>'),xa=wa.get(0);wa.appendTo(ka);var ya,za,Aa=0,Ba=0,Ca=0,Da=-1,Ea=!1,Fa=10,Ga=1,Ha=0,Ia=new EdenUI.Highlight(oa),Ja=!1,Ka=!1,La=!1,Ma=0,Na=!1,Oa=!1;za=void 0===Eden.Agent.agents["view/script/"+a]?new Eden.Agent(void 0,"view/script/"+a):Eden.Agent.agents["view/script/"+a],na.value=za.snapshot,za.setEnabled(d),za.setOwned(!0),i(),j(),n(),Eden.Agent.listenTo("create",this,n),Eden.Agent.listenTo("title",this,n),Eden.Agent.listenTo("remove",this,m),Eden.Agent.listenTo("autosave",this,l),p("");var Pa="_view_"+a+"_script",Qa="_view_"+a+"_next",Ra="_view_"+a+"_prev",Sa="_view_"+a+"_override",Ta="_view_"+a+"_file",Ua="_view_"+a+"_power",Va="_view_"+a+"_agent",Wa="_view_"+a+"_showtabs",Xa="_view_"+a+"_showbuttons",Ya=new Eden.Agent(void 0,"view/script/"+a+"/config");Ya.hidden=!0,Ya.declare(Va),Ya.declare(Wa),Ya.declare(Pa),Ya.declare(Ua),Ya.declare(Ta),Ya.declare(Sa),Ya.declare(Qa),Ya.declare(Ra),Ya.declare(Xa),Ya.setEnabled(!0),Ya.on(Pa,q),Ya.on(Ta,r),Ya.on(Ua,s),Ya.on(Va,t),Ya.on(Wa,u),Ya.on(Xa,v),void 0===Ya.state[Wa]&&(Ya.state[Wa]=!e),u(void 0,Ya.state[Wa]),void 0===Ya.state[Xa]&&(Ya.state[Xa]=!0),v(void 0,Ya.state[Xa]),Ya.setSource("## "+a+"\n_view_"+a+"_script = "+Eden.edenCodeForValue(Ya.state[Pa])+";\n_view_"+a+"_next = "+Eden.edenCodeForValue(Ya.state[Qa])+";\n_view_"+a+"_prev = "+Eden.edenCodeForValue(Ya.state[Ra])+";\n_view_"+a+"_override = "+Eden.edenCodeForValue(Ya.state[Sa])+";\n_view_"+a+"_power = "+Eden.edenCodeForValue(Ya.state[Ua])+";\n_view_"+a+"_agent = "+Eden.edenCodeForValue(Ya.state[Va])+";\n_view_"+a+"_showtabs = "+Eden.edenCodeForValue(Ya.state[Wa])+";\n_view_"+a+"_showbuttons = "+Eden.edenCodeForValue(Ya.state[Xa])+";\n"),Eden.Agent.listenTo("create",this,x),Eden.Agent.listenTo("loaded",this,y),Eden.Agent.listenTo("rollback",this,z),Eden.Agent.listenTo("owned",this,w),setInterval(function(){sa.generate(za.ast,-1),za.clearExecutedState()},50),h(),ka.on("input",".hidden-textarea",W).on("keydown",".hidden-textarea",X).on("keyup",".hidden-textarea",Y).on("keydown",".outputcontent",Z).on("blur",".hidden-textarea",_).on("focus",".hidden-textarea",aa).on("mouseup",".outputcontent",ba).on("click",".previous-input",da).on("click",".next-input",ea).on("click",".menu-input",ia).on("click",".eden-gutter-item",ca).on("click",".agent-tab",fa).on("click",".agent-tableft",ga).on("click",".agent-tabright",ha).on("click",".agent-newtab",ja),va.click(function(a){Na||(za.setEnabled(!za.enabled),za.enabled?(N(),C(!0)):M())}),c&&(na.value=EdenUI.plugins.ScriptInput.buildScriptFromList(c),C());var Za={contents:ka,update:function(a){0==Ka&&(a instanceof Symbol?(Ya.setScope(a.getValueScope(eden.root.scope)),na.value=EdenUI.plugins.ScriptInput.buildScriptFromList(Ya.code),C()):a instanceof Array&&(na.value=EdenUI.plugins.ScriptInput.buildScriptFromList(a),C()))},setValue:function(a){na.value=a}};return C(),Za},this.createDialog=function(b,d,e){var f=b.slice(0,-7),g=c.createCommon(f,d,e,!1,!1),h=305;if(e){var i=g.contents.find("textarea").val().split("\n").length;h=EdenUI.plugins.ScriptInput.getRequiredHeight(i+1)}return $dialog=$('<div id="'+b+'"></div>').html(g.contents).dialog({title:d,width:500,height:h,minHeight:203,minWidth:300,dialogClass:"input-dialog"}),g.confirmClose=!("MenuBar"in a.plugins),g},this.createEmbedded=function(a,b,d,e){var f=c.createCommon(a,b,d,e,!0);return f},a.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:a.viewCategories.interpretation,menuPriority:0},a.views.History={dialog:this.createHistory,title:"Input History",category:a.viewCategories.history},a.history=this.history,b()},EdenUI.plugins.ScriptInput.buildScriptFromList=function(a){var b="";if(a instanceof Array)for(var c=0;c<a.length;c++)if("string"==typeof a[c])b+=a[c]+"\n";else if("object"==typeof a[c])if(void 0!==a[c].definition)b+=a[c].eden_definition+"\n";else{var d=a[c].name.slice(1);b+=d+" = "+Eden.edenCodeForValue(a[c].value())+";\n"}return b},EdenUI.plugins.ScriptInput.getRequiredHeight=function(a,b){return b?15+20*a:45+20*a+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(a,b){var c=$('<div class="script-obscurer noselect"></div>'),d=$('<div class="script-subdialog-newagent noselect"><span class="script-subdialog-title">Create or import agent:</span><br/><input class="script-subdialog-text" type="text" spellcheck="false" placeholder="model/component/agent"></input><span class="status missing"></span><br><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div>'),e=d.find(".script-subdialog-text"),f=e.get(0).nextSibling,g=!1;d.on("input",".script-subdialog-text",function(){var a=e.get(0).value;""==a?(g=!1,f.className="missing"):/^[a-z][a-z0-9]*[\/][a-z0-9\/]+$/i.test(a)?void 0===Eden.Agent.agents[a]?edenUI.getOptionValue("agent_"+a+"_snap")?(f.className="valid",g=!0):(f.className="addnew",g=!0):(f.className="warning",g=!1):(f.className="invalid",g=!1)}).on("click",".button-add",function(){g&&(a.get(0).removeChild(c.get(0)),b(!0,e.get(0).value))}).on("click",".button-cancel",function(){a.get(0).removeChild(c.get(0)),b(!1)}),c.append(d),a.append(c)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(a,b,c){for(var d,e=$('<div class="script-obscurer noselect"></div>'),f=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),g=f.find(".script-history-list"),h=!0,i=c.index,j=c.history.length-1;j>=0;j--){var k=$('<div class="script-history-item"></div>');i==j&&(k.addClass("current"),k.addClass("original"),d=k),k.get(0).setAttribute("data-index",""+j);var l=$('<div class="script-history-bookmark"></div>'),m=$('<div class="script-history-time"></div>'),n=$('<div contenteditable class="script-history-content"></div>');m.html(get_time_diff(c.history[j].time)),m.get(0).title=c.history[j].time,c.history[j].bookmark&&l.addClass("bookmarked"),c.history[j].title?n.html(c.history[j].title):n.html("[Autosave]"),k.append(l),k.append(n),k.append(m),g.append(k)}f.on("input",".script-history-content",function(a){var b=parseInt(a.target.parentNode.getAttribute("data-index"));c.history[b].title=a.target.textContent,c.saveHistory(),c.makeSnapshot(b)}).on("click",".script-history-item",function(a){console.log(a);var b=parseInt(a.currentTarget.getAttribute("data-index"));i=b,d&&d.removeClass("current"),d=$(a.currentTarget),d.addClass("current")}).on("click",".script-history-bookmark",function(a){var b=parseInt(a.target.parentNode.getAttribute("data-index"));void 0===c.history[b].bookmark?c.history[b].bookmark=!0:c.history[b].bookmark=!c.history[b].bookmark,c.saveHistory(),c.history[b].bookmark?a.target.className="script-history-bookmark bookmarked":a.target.className="script-history-bookmark"}).on("click",".button-ok",function(){h&&(a.get(0).removeChild(e.get(0)),console.log("Rollback to: "+i),b(!0,i))}).on("click",".button-cancel",function(){a.get(0).removeChild(e.get(0)),b(!1)}),e.append(f),a.append(e)},function(a){function b(a,b,c,d){function e(){f.insertBefore(b,g)}var f=b.parentNode,g=b.nextSibling;f&&(f.removeChild(b),"boolean"!=typeof c&&(d=c,c=!1),d&&c?d.call(a,b,e):d&&(d.call(a,b),e()))}var c={"int":!0,str:!0,round:!0,min:!0,max:!0,random:!0,floor:!0,ceil:!0,abs:!0,acos:!0,asin:!0,atan:!0,cos:!0,exp:!0,ln:!0,log:!0,mod:!0,randomInteger:!0,randomFloat:!0,sin:!0,sqrt:!0,sum:!0,tan:!0,length:!0,error:!0,substr:!0,type:!0,createView:!0,createCanvas:!0,zonesAt:!0,execute:!0,indexOf:!0,forget:!0,eager:!0,time:!0,writeln:!0,apply:!0,todo:!0,"char":!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isValue:!0,isFunc:!0,isInt:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isProc:!0,showView:!0,array:!0,sublist:!0,reverse:!0,search:!0,sort:!0,tail:!0,concat:!0,decodeHTML:!0},d={autocalc:!0,mouseX:!0,mouseY:!0,mousePosition:!0,screenHeight:!0,screenWidth:!0,PI:!0},e={"true":!0,"false":!0,green:!0};EdenUI.Highlight=function(a){this.ast=void 0,this.outelement=a,this.line=1,this.currentline=-1,this.mode=0,this.mode_at_line={}},EdenUI.Highlight.isType=function(a){return a.charCodeAt(0)>=65&&a.charCodeAt(0)<=90},EdenUI.Highlight.prototype.highlightLine=function(a,b){var f=-1,g=-1,h="",i=!1,j=a.stream,k=!1,l="INVALID",m="INVALID";this.mode_at_line[this.line-1]?this.mode=this.mode_at_line[this.line-1]:this.mode=0,a.script.errors.length>0&&(f=a.script.errors[0].prevposition,g=a.script.errors[0].position,h=a.script.errors[0].messageText());for(var n="",o=document.createElement("span");;){if(j.position==b){if(""!=n){var p=document.createTextNode(n);o.appendChild(p),n=""}var q=document.createElement("span");q.className="fake-caret",o.appendChild(q)}var r=j.peek();if(10==r){if(""!=n){var p=document.createTextNode(n);o.appendChild(p),n=""}break}if(9!=r&&13!=r&&32!=r&&160!=r){if(""!=n){var p=document.createTextNode(n);o.appendChild(p),n=""}if(m=l,l=j.readToken(),"EOF"==l){if(""!=n){var p=document.createTextNode(n);o.appendChild(p),n=""}break}if("INVALID"!=l){var s=j.tokenType(l),t="",u=j.tokenText();if(-1!=f&&(f<=j.prevposition&&!i&&(i=!0),g<=j.prevposition&&i&&(i=!1),i&&(k=!0)),i&&"EOF"!=a.script.errors[0].token&&(t+="eden-error "),0==this.mode)if("##"==l){t+="eden-comment";for(var v="";j.valid()&&10!=j.peek();)v+=String.fromCharCode(j.get());u="##"+v}else"local"==l||"auto"==l||"para"==l?t+="eden-storage":"keyword"==s?(t+="eden-keyword","import"==j.data.value&&(this.mode=1)):"NUMBER"==l?t+="eden-number":"STRING"==l?t+="eden-string":"CHARACTER"==l?t+="eden-string":"BOOLEAN"==l?t+="eden-constant":"OBSERVABLE"==l?t+=c[j.data.value]?"eden-function":EdenUI.Highlight.isType(j.data.value)?"eden-type":e[j.data.value]?"eden-constant":d[j.data.value]?"eden-special":"eden-observable":"JAVASCRIPT"==l?t+="eden-javascript":"-"==l&&j.isNumeric(j.peek())?(l=j.readToken(),u="-"+j.tokenText(),t+="eden-number"):"/*"==l?(this.mode=2,t+="eden-comment"):t+="eden-operator";else 1==this.mode?";"==l?(this.mode=0,t+="eden-operator"):t+=Language.importoptions[j.data.value]?"eden-importopt":"eden-path":2==this.mode&&("*/"==l&&(this.mode=0),t+="eden-comment");if(j.prevposition<b&&j.position>b){var q=b-j.prevposition,w=u.slice(0,q),x=u.slice(q),y=document.createElement("span");y.className=t,y.appendChild(document.createTextNode(w)),o.appendChild(y);var q=document.createElement("span");q.className="fake-caret",o.appendChild(q),y=document.createElement("span"),y.className=t,y.appendChild(document.createTextNode(x)),o.appendChild(y)}else{var y=document.createElement("span");y.className=t,y.appendChild(document.createTextNode(u)),o.appendChild(y)}}else console.log("INVALID: "+j.peek()),j.skip()}else j.skip(),32==r||160==r?n+=" ":13!=r&&(n+=String.fromCharCode(r))}return this.mode_at_line[this.line]=this.mode,o},EdenUI.Highlight.prototype.highlight=function(a,c,d){this.ast=a,this.line=1;var e=-1,f=-1,g="",h=a.stream;if(void 0!==this.outelement){if(0==a.stream.code.length)return void(this.outelement&&(this.outelement.innerHTML="<div class='eden-line'><span class='fake-caret'></span></div>"));a.script.errors.length>0&&(e=a.script.errors[0].prevposition,f=a.script.errors[0].position,g=a.script.errors[0].messageText()),h.reset();var i=void 0,j=!1,k=0;if(-1==c)b(this,this.outelement,!1,function(){for(this.outelement.innerHTML="",this.mode_at_line={};h.valid();){var b=h.peek();if(10!=b)i=this.highlightLine(a,d);else{j=e>=k&&h.position>=f;var c=document.createElement("div");c.className="eden-line",this.line++,void 0!==i&&c.appendChild(i);var g=document.createTextNode("\n");c.appendChild(g),this.outelement.appendChild(c),k=h.position+1,i=void 0,h.skip()}}if(j=e>=k&&h.position>=f,void 0!==i){var c=document.createElement("div");c.className="eden-line",c.appendChild(i),this.outelement.appendChild(c)}else{var c=document.createElement("div");if(d>=h.position){c.className="eden-line";var l=document.createElement("span");l.className="fake-caret",c.appendChild(l)}else c.className="eden-line";this.outelement.appendChild(c)}});else{for(;h.valid()&&this.line<c-1;){var l=h.peek();10==l&&this.line++,h.skip()}for(var m=2;m>=0;m--){this.line=c-m+1;var n=this.outelement.childNodes[c-m];if(void 0!==n){for(;n.firstChild;)n.removeChild(n.firstChild);k=h.position,i=this.highlightLine(a,d),j=e>=k&&h.position>=f,n.appendChild(i);var o=document.createTextNode("\n");n.appendChild(o),h.skip()}}}}}}("undefined"!=typeof window?window:global),EdenScriptGutter.prototype.generate=function(a,b){if(a.lines.length!=this.gutter.childNodes.length){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(var c=0;c<a.lines.length;c++){var d=document.createElement("div");d.className="eden-gutter-item",this.gutter.appendChild(d)}}for(var c=0;c<a.lines.length;c++){var e="eden-gutter-item",f="";if(a.lines[c]){var g=a.lines[c];g.errors.length>0?(e+=" eden-gutter-errorblock",g.errors[0].line==c+1?(e+=" eden-gutter-error",f="&#xf06a"):"runtime"==g.errors[0].type&&(e+=" eden-gutter-error",f="&#xf06a")):("assignment"==g.type&&void 0===g.value&&g.compiled&&(e+=" eden-gutter-warning",f="&#xf071"),1==g.executed?e+=" eden-gutter-executed":2==g.executed?e+=" eden-gutter-guarded":3==g.executed&&(e+=" eden-gutter-errorblock"))}if("eden-gutter-item"!=e)if(""==f){var h=document.createElement("div");h.className=e,h.innerHTML="",this.gutter.replaceChild(h,this.gutter.childNodes[c])}else this.gutter.childNodes[c].className=e,this.gutter.childNodes[c].innerHTML=f;else this.gutter.childNodes[c].innerHTML="",this.gutter.childNodes[c].className=this.gutter.childNodes[c].className.replace(" eden-gutter-errorblock","").replace(" eden-gutter-error","")}},EdenUI.plugins.ProjectList=function(a,b){function c(){this.json={projects:[]},this.rootURL=void 0,this.atRoot=!0}function d(b){EdenUI.plugins.ScriptGenerator.loadBaseConstrual(b),a.plugins.ScriptInput&&a.plugins.ScriptInput.addHistory('include("'+b+'");')}function e(b,c){a.createView(b,"ScriptInput"),a.eden.root.lookup("_view_"+b+"_title").assign(b,root.scope),a.eden.root.lookup("_view_"+b+"_script").assign([c],root.scope),a.showView(b),a.brieflyHighlightView(b)}var f=Date.UTC(2015,8,5),g=getParameterByName("projects"),h="";"projectList"in a.branding&&("prologue"in a.branding.projectList&&(h='<div class="projectlist-prologue">'+a.branding.projectList.prologue.html+"</div>","href"in a.branding.projectList.prologue&&(h='<a href="'+a.branding.projectList.prologue.href+'" target="project-listing-link" style="text-decoration: none">'+h+"</a>")),""==g&&"data"in a.branding.projectList&&(g=a.branding.projectList.data)),""==g&&(g="models/projects.json");var i,j,k;this.loadCrossDomain=function(a){if(a.success)if("string"==typeof i)e(i,a.success);else{var b=JSON.parse(a.success);i.populateProjectData(b,j,k)}},c.prototype.loadProjectData=function(a,b){var c=this;/^[a-zA-Z][a-zA-Z\d+.-]*:\/\//.test(a)?(i=this,j=a,k=b,$.ajax({url:rt.config.proxyBaseURL+"?url="+a+"&callback=edenUI.plugins.ProjectList.loadCrossDomain",dataType:"script"})):$.ajax({url:a,dataType:"json",success:function(d){c.populateProjectData(d,a,b)},cache:!1})},c.prototype.loadProjectCode=function(a){var b=this;/^[a-zA-Z][a-zA-Z\d+.-]*:\/\//.test(a)?(i=this.json.target,j=a,$.ajax({url:rt.config.proxyBaseURL+"?url="+a+"&callback=edenUI.plugins.ProjectList.loadCrossDomain",dataType:"script"})):$.ajax({url:a,dataType:"text",success:function(a){e(b.json.target,a)},cache:!1})},c.prototype.populateProjectData=function(a,b,c){if(this.json=a,c)this.rootURL=b,this.atRoot=!0;else if(this.atRoot=b==this.rootURL,!this.atRoot){var d={name:"Return to main list",projects:this.rootURL};this.json.projects.push(d)}this.updateCollection("")},c.prototype.projectClick=function(b){var c=b.runfile;void 0!==c&&(void 0!==this.json.target?this.loadProjectCode(c):a.eden.isInInitialState()?(a.newProject(),d(c)):a.modalDialog("Open Project Action","<p>The work space contains an existing construal.</p>					<p>You can either abandon the existing construal or choose to merge the project with the existing definitions.</p>					<p>Which would you like to do?</p>",["Open Project","Merge"],0,function(b){2!=b&&(0==b&&a.newProject(),d(c))}));var e=b.projects;void 0!==e&&this.loadProjectData(e,!1)},c.prototype.makeProject=function(a){var b=this,c=$('<div class="projectlist-result-element"></div>'),d='<div class="projectlist-result-name">'+a.name+"</div>";return void 0!==a.description&&(d=d+'<div class="projectlist-result-metadata">'+a.description+"</div>"),(void 0!==a.author||void 0!==a.year)&&(d+='<div class="projectlist-result-metadata">',void 0!==a.author&&(d=d+"By "+a.author),void 0!==a.year&&(d=d+" ("+a.year+")"),d+="</div>"),c.html(d),c.click(function(){b.projectClick(a)}),c},c.prototype.updateCollection=function(b){this.element.parentElement.scrollTop=0;var c=$(this.element).find(".projectlist-results");c.html("");var d=void 0!==this.json.target;if(void 0!==this.json.projects)for(var e=new RegExp("(^|\\s)"+b,"im"),h=!1,i=0;i<this.json.projects.length;i++)if(e.test(this.json.projects[i].name)||e.test(this.json.projects[i].description)||e.test(this.json.projects[i].author)||e.test(this.json.projects[i].year)){h=!0;var j=this.json.projects[i],k=this.makeProject(j);c.append(k)}if(!d&&this.rootURL==g&&this.atRoot&&(""==b||e.test("Feature of The Day"))){var l,m=a.getOptionValue("fotdLastVisited");l=null===m||parseInt(m)<f?'<img id="fotd-sticker" src="images/new-sticker.png" width="24" height="14" style="vertical-align: 5%" />':"";
var k=this.makeProject({name:"Feature of The Day "+l,description:"Learn about the latest features added to JS-EDEN.",author:"JS-EDEN Development Team",runfile:"models/guides/feature-of-the-day.js-e"});c.prepend(k)}if(!d&&(!h||e.test("New Project"))){var n=$('<div class="projectlist-result-element"><div class="projectlist-result-name">New Project</div><div class="projectlist-result-metadata">An empty work space.</div><div class="projectlist-result-metadata">By JS-EDEN Development Team</div></div>').click(function(){eden.isInInitialState()?a.newProject():a.modalDialog("Reset Work Space","<p>This action will discard the current script. Your work will not be saved.</p>						<p>Are you sure you wish to continue?</p>",["Reset Work Space"],1,function(b){0==b&&a.newProject()})});c.prepend(n)}},this.createDialog=function(b,d){function e(a,b){i.loadProjectData(b,!0)}var f=b.slice(0,-7),i=new c,j=$('<div class="projectlist-listing"></div>');j.append(h);var k=$('<div class="projectlist-search-box-outer"></div>'),l=$('<input type="text" class="projectlist-search" placeholder="search" />').on("keyup",function(a){i.updateCollection(a.target.value)});k.append(l),j.append(k),j.append('<div class="projectlist-results noselect"></div>'),$('<div id="'+b+'"></div>').html(j).dialog({title:d,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"}),i.element=j.get(0);var m=a.eden.root.lookup("_view_"+f+"_source");void 0==m.value()&&m.assign(g,root.scope,a.eden.root.lookup("createView")),m.addJSObserver("reload",e),e(m,m.value())},a.views.ProjectList={dialog:this.createDialog,title:"Project List",category:a.viewCategories.interpretation},a.eden.include("plugins/project-listing/project-listing.js-e",b)},EdenUI.plugins.ProjectList.title="Project List",EdenUI.plugins.ProjectList.description="Displays a list of construals.",EdenUI.plugins.PluginManager=function(a,b){this.createDialog=function(b,c){var d,e,f,g=$('<div class="projectlist-results noselect"></div>'),h=function(b){return a.plugins[b]?"(loaded)":"(not loaded)"};pluginNames=Object.keys(EdenUI.plugins).sort(function(b,c){var d=a.plugins[b],e=a.plugins[c];return d&&!e?1:e&&!d?-1:c>b?-1:b==c?0:1});for(var i=0;i<pluginNames.length;i++){e=pluginNames[i],d=EdenUI.plugins[e];var j=e in a.plugins?" pluginmanager-loaded":"",k='<div class="projectlist-result-element'+j+'"><div class="projectlist-result-name">'+d.title+"</div><div class='projectlist-result-metadata'>"+d.description+"</div>";void 0!==d.originalAuthor&&(k=k+"<div class='projectlist-result-metadata'>Original version by "+d.originalAuthor+"</div>"),void 0!==d.author&&(f=void 0===d.originalAuthor?"By ":"Built on by ",k=k+"<div class='projectlist-result-metadata'>"+f+d.author+"</div>"),k=k+'<div class="pluginlist-loaded projectlist-result-metadata">'+h(e)+"</div></div>",$(k).click(function(b){return function(){var c=$(this);a.loadPlugin(b,function(){a.plugins[b]&&(c.find(".pluginlist-loaded").html(h(b)),c.addClass("pluginmanager-loaded",100)),a.plugins.MenuBar.updateViewsMenu()})}}(e)).appendTo(g)}var l=$('<div class="projectlist-listing"></div>');l.append(g),$dialog=$('<div id="'+b+'"></div>').html(l).dialog({title:c,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},a.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:a.viewCategories.environment,name:"plugins"},b()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.MenuBar=function(a,b){function c(){$(".menubar-menu").hide(),w=!1;var a=$("#menubar-mainitem-views");a.children().css("display",""),document.getElementById("menubar-view-type-search").value=""}function d(a){var b=$("#menubar-mainitem-"+a);b.show(),w=!0;var c=b.find('input[type="text"]');c.length>0&&setTimeout(function(){c[0].focus(),b.scrollTop(0)},0)}function e(){var a=$("<div></div>");return a.appendTo(t),a.menuGroupWidth=0,a}function f(a,b,e){var f=$('<div class="menubar-mainitem"></div>');f.html(b),f.appendTo(e);var g=f[0].clientWidth+10;e.menuGroupWidth=e.menuGroupWidth+g+10,f[0].style.width=g+"px",f.html(b+'<div id="menubar-mainitem-'+a+'" class="menubar-menu"></div>'),$("#menubar-mainitem-"+a).hide();var h=function(b){w?b.target===this&&c():(c(),d(a)),b.stopPropagation()};f.on("mousedown",h),f.on("mouseenter",function(){w&&(c(),d(a))})}function g(){var b=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(a.activeDialogs).length&&b.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function h(b){c();var d=a.eden.root,e=d.lookup("mouseFollow").value(),f=d.lookup("_views_number_created"),g=f.value()+1;f.assign(g,d.scope,Symbol.hciAgent,!0);var h=this.view,i=h.slice(0,1).toLowerCase()+h.slice(1)+g;e?a.eden.execute('createView("'+i+'", "'+h+'");'):a.createView(i,h),q.updateViewsMenu()}function i(b){var d=this.parentNode.viewname;a.viewInstances[d].confirmClose&&c(),a.closeView(d),g()}function j(b){var c=b.currentTarget.children[0],d=this.parentNode.viewname;a.viewInstances[d].pinned?(a.unpinView(d),c.src=s):(a.pinView(d),c.src=r)}function k(a){for(var b=$("<div class='menubar-item'></div>"),c=0;c<a.length;++c)b.append(a[c]);return b}function l(a,b){return $('<div class="'+a+' menubar-item-clickable">'+b+"</div>")}function m(a){return $("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+a+"</div></div>")}function n(b){return{mouseover:function(c){a.highlightView(b,!0)},mouseout:function(c){a.stopHighlightingView(b,!0,!1)},click:function(d){a.stopHighlightingView(b,!0,!0),c()}}}function o(a){return a&&"false"!=a?'checked="checked"':""}function p(){function b(b,c,e,f){var g=a.getOptionValue(b);null===g&&(g=e);var h=l("menubar-item-input",'<input id="menu-'+b+'" type="checkbox"'+o(g)+" />"),i=h.get(0).children[0],j=l("menubar-item-label",c),m=k([h,j]);m.click(function(c){c.target!=i&&(i.checked=!i.checked),a.setOptionValue(b,i.checked)}),a.listenTo("optionChange",void 0,function(a,c){if(a==b){var d="true"===c;i.checked=d,f&&f(b,d)}}),m.appendTo(d)}f("views",Language.ui.menu_bar.main_views,x),f("existing-views",Language.ui.menu_bar.main_existing,x),q.updateViewsMenu(),f("options",Language.ui.menu_bar.main_options,x);var d=$("#menubar-mainitem-options");b("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(a,b){b?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),b("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),b("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),b("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(a,b){var c;c=b?"collapse":"maximize",$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",c)})}),b("developer",Language.ui.menu_bar.opt_debug,!1,function(b,d){var e;e=d?"/index-dev.html":"/index.html";var f=document.location.pathname;e=f.slice(0,f.lastIndexOf("/"))+e,e!=document.location.pathname?(c(),a.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(b){if(0==b)window.onbeforeunload=void 0,document.location.pathname=e;else if(1==b)root.lookup("debug").mutate(function(a){a.cached_value.jsExceptions=d},Symbol.hciAgent);else{var c=document.getElementById("menu-developer");c.checked=!c.checked,a.setOptionValue("developer",c.checked)}})):root.lookup("debug").mutate(function(a){a.cached_value.jsExceptions=d},Symbol.hciAgent)})}EdenUI.plugins.MenuBar.title=Language.ui.menu_bar.title,EdenUI.plugins.MenuBar.description=Language.ui.menu_bar.description;var q=this;this.itemViews={},a.listenTo("createView",this,function(a,b){this.updateViewsMenu()}),a.listenTo("destroyView",this,function(a){$(this.itemViews[a]).remove(),delete this.itemViews[a],g()}),a.listenTo("loadPlugin",this,function(a,b){this.updateViewsMenu()});var r="images/pin.png",s="images/pin-greyed.png",t=$('<div id="menubar-main"></div>'),u=$('<div id="menubar-status"></div>');u.appendTo(t),t.appendTo("body"),$('<div id="menubar-bottom"></div>').appendTo("body");var v=getStyleBySelector(".menubar-menu");v.maxHeight="calc(100vh - "+String(30+a.scrollBarSize2)+"px)",this.updateStatus=function(a){u.html(Eden.htmlEscape(a,!0,!0))},this.appendStatus=function(a){u.html(u.html()+Eden.htmlEscape(a,!0,!0))};var w=!1;$(document.body).on("mousedown",function(){c()}),this.updateViewsMenu=function(){var b=$("#menubar-mainitem-views"),c=$("#menubar-mainitem-existing-views");b.html("");var d=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),e=$('<div class="menubar-item-fullwidth"></div>');e.append(d);var f=$("<div class='menubar-item-search'></div>");f.append(e),d.on("input",function(a){var c,d=a.target.value,e=new RegExp("(^|\\s)"+d,"i"),f=!1;b.children().each(function(a,b){if(!b.classList.contains("menubar-item-search")){var g=b.children[0],h=g.innerHTML,i=g.classList.contains("menubar-item-separator");i?(d.length>1&&(f=e.test(h)),c=b,f?b.style.display="":b.style.display="none"):f?b.style.display="":e.test(h)?(b.style.display="",c.style.display=""):b.style.display="none"}}),setTimeout(function(){b.scrollTop(0)},0)});var o,p,t,u,v,w,x=[];for(p in a.views){var y=a.views[p],z=y.title,A=y.category.getLabel(),B=y.category.getMenuPriority(),C=y.menuPriority;u=l("menubar-item-fullwidth menubar-view",z),t=k([u]),t[0].view=p,t.click(h),x.push({title:z,viewEntry:t,categoryLabel:A,categoryPriority:B,itemPriority:C})}x=x.sort(function(a,b){if(a.categoryPriority!=b.categoryPriority)return a.categoryPriority-b.categoryPriority;if(void 0!==a.itemPriority){if(void 0===b.itemPriority)return-1;if(a.itemPriority!=b.itemPriority)return a.itemPriority-b.itemPriority}else if(void 0!==b.itemPriority)return 1;return a.title>b.title?1:a.title<b.title?-1:0});for(var D,E=0;E<x.length;++E){var F=x[E],G=F.categoryLabel;if(D!=G){var H=m(G);H.appendTo(b),D=G}F.viewEntry.appendTo(b)}b.append(f),c.html(""),q.itemViews={},g();for(o in a.activeDialogs){var I=n(o),z=a.eden.root.lookup("_view_"+o+"_title").value();u=l("menubar-item-label",z+' <span class="menubar-view-name">['+o+"]</span>"),u.click(I.click);var J;J=a.viewInstances[o].pinned?r:s,v=l("menubar-item-pin",'<img src="'+J+'" width="18" height="18" class="menubar-item-pin-icon"/>'),v.click(j),w=l("menubar-item-close",'<div class="menubar-item-close-icon">X</div>'),w.click(i),t=k([u,v,w]),t.bind("mouseover",I.mouseover),t.bind("mouseout",I.mouseout),t[0].viewname=o,t.appendTo(c),q.itemViews[o]=t[0]}};var x=e();p(),$.ajax({url:"version.json",dataType:"json",success:function(a){var b="";a.tag&&(b+="Version "+a.tag,document.title=document.title+" "+a.tag),a.sha&&(b+=' Commit <a href="https://github.com/EMgroup/js-eden/commit/'+a.sha+'">'+a.sha+"</a>"),$('<div id="menubar-version-number"></div>').html(b).appendTo($("#menubar-main"))},cache:!1});var y=e();a.eden.root.lookup("menus").addJSObserver("updateMenus",function(a,b){y.menuGroupWidth=0;var c=y.children();if(c.detach(),Array.isArray(b))for(var d=0;d<b.length;d++){var e=b[d];if(void 0===e.element){var g="construal-"+d;f(g,e.text,y);var h=$("#menubar-mainitem-"+g);e.generate(h)}else y.append(e.element),y.menuGroupWidth=y.menuGroupWidth+e.element.clientWidth}var i=u[0].style,j=20+x.menuGroupWidth+y.menuGroupWidth;i.left=j+"px",i.minWidth="calc(100% - "+2*j+"px)"}),this.Menu=function(a,b){this.text=a,this.items=b},this.Menu.prototype.generate=function(a){if(void 0===this.element){for(var b=0;b<this.items.length;b++){var c=this.items[b];c.generate(),a.append(c.element)}this.element=a.parent().get(0)}},this.Menu.prototype.toString=function(){return"Menu("+Eden.edenCodeForValues(this.text,this.items)+")"},this.Menu.prototype.getEdenCode=this.Menu.prototype.toString,this.SimpleMenuItem=function(a,b){this.name=a,this.text=b},this.SimpleMenuItem.prototype.generate=function(){if(void 0===this.element){var a=l("menubar-item-fullwidth",this.text),b=k([a]),d=this.name;b.bind("click",function(a){c();var b=root.lookup(d+"_clicked");b.assign(!0,root.scope),b.assign(!1,root.scope)}),this.element=b.get(0)}},this.SimpleMenuItem.prototype.toString=function(){return"MenuItem("+Eden.edenCodeForValues(this.name,this.text)+")"},this.SimpleMenuItem.prototype.getEdenCode=this.SimpleMenuItem.prototype.toString,a.eden.include("plugins/menu-bar/menu-bar.js-e",b)},EdenUI.plugins.Canvas2D=function(a,b){var c=this;this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx;var d=600,e=500;canvases={},contents={};var f={},g={},h=40;this.destroyViews=function(b){var c=b.match(/^_view_(.*)_observable$/);if(null!==c){var d=c[1];a.destroyView(d,!0)}};var i=function(a,b){var c;for(c in b)if(b[c].togarbage)for(var d=b[c],e=0;e<d.length;e++)null!==d[e].parentElement&&a.removeChild(d[e])};this.setPictureObs=function(a,b){if(a in canvases){var d=canvases[a].pictureObs;void 0!==d&&delete g[d][a],b in g||(g[b]={}),g[b][a]=!0,canvases[a].pictureObs=b,root.lookup(b).addJSObserver("repaintView",function(a,d){c.drawPictures(b)}),this.drawPicture(a,b)}},this.drawPictures=function(a){for(var b in g[a])this.drawPicture(b,a)},this.drawPictureForView=function(a){var b=root.lookup("_view_"+a+"_observable").value();this.drawPicture(a,b)},this.drawPicture=function(a,b){var d=canvases[a];if(void 0!==d&&!d.drawingQueued&&(d.drawingQueued=!0,!d.drawingInProgress)){var e=function(){d.drawingInProgress=!0,d.drawingQueued=!1;var b=f[a],g={},j=d.pictureObs,k=root.lookup(j).value(),l=d.getContext("2d"),m=contents[a];if(void 0!==m){var n=root.lookup("_view_"+a+"_background_colour").value();void 0===n&&(n="white"),l.setTransform(1,0,0,1,0,0),c.setFillStyle(l,n),m.style.backgroundColor=n,l.fillRect(0,0,d.width,d.height);var o=root.lookup("_view_"+a+"_scale").value();"number"!=typeof o&&(o=1);var p=root.lookup("_view_"+a+"_zoom").value();"number"!=typeof p&&(p=1);var q=o*p,r=root.lookup("_view_"+a+"_offset").value();r instanceof Point?l.translate(r.x,r.y):r=new Point(0,0),l.scale(q,q),c.configureContextDefaults(l,o);var s;for(s in b)b[s].togarbage=!0;if(Array.isArray(k))for(var t=[k],u=[0];t.length>0;){var v=t.pop(),w=u.pop();for(w>0&&v[w-1]instanceof EdenUI.plugins.Canvas2D.Transform&&l.restore();w<v.length;){var x=v[w];if(x instanceof Object)if(Array.isArray(x))t.push(v),u.push(w+1),v=x,w=0;else if(x instanceof EdenUI.plugins.Canvas2D.Transform)t.push(v),u.push(w+1),l.save(),x.transform(l),v=x.items,Array.isArray(v)||(v=[v]),w=0;else{var y=x.hash&&x.hash(),z=y&&b[y];if(z)x.elements=z;else{l.save();try{var A=c.configureContext(l,o,p,x.drawingOptions);A&&x.draw(l,o,j)}catch(B){if(void 0!==x){console.log(B);var C=root.lookup("debug").value();"object"==typeof C&&C.jsExceptions}}l.restore()}if(void 0!==x.elements){var D=x.elements[0].parentElement;if(D&&D!=m){for(var E=[],F=0;F<x.elements.length;F++)E.push($(x.elements[F]).clone(!0,!0).get(0));x.elements=E,x.scale(q,p,r)}else(!z||d.rescale)&&x.scale(q,p,r)}var G=x.elements;G&&(G.togarbage=!1),G&&!z&&$(m).append(G),G&&(g[y]=G),w++}else w++}}i(m,b),f[a]=g,d.drawingInProgress=!1,d.drawingQueued&&setTimeout(e,h)}};setTimeout(e,h)}},this.configureContextDefaults=function(a,b){a.lineJoin="bevel",a.miterLimit=429496656,a.lineWidth=2/b},this.configureContext=function(a,b,c,d){if("object"!=typeof d)return!0;if(d.visible===!1)return!1;if(Array.isArray(d.dashes)&&(a.setLineDash(d.dashes),"dashOffset"in d&&(a.lineDashOffset=d.dashOffset)),"cap"in d&&(a.lineCap=d.cap),"join"in d&&(a.lineJoin=d.join),"miterLimit"in d&&(a.miterLimit=d.miterLimit),"lineWidth"in d&&(a.lineWidth=d.lineWidth/b),"opacity"in d&&(a.globalAlpha=d.opacity),"object"==typeof d.shadow)if(a.shadowColor=d.shadow.colour,d.shadow.scale){var e=c*b;a.shadowBlur=d.shadow.blur*e,a.shadowOffsetX=d.shadow.xOffset*e,a.shadowOffsetY=d.shadow.yOffset*e}else a.shadowBlur=d.shadow.blur*c,a.shadowOffsetX=d.shadow.xOffset*c,a.shadowOffsetY=d.shadow.yOffset*c;return!0},this.setFillStyle=function(a,b){b instanceof EdenUI.plugins.Canvas2D.FillStyle?a.fillStyle=b.getColour(a):a.fillStyle=b},this.initZoneFromDrawingOpts=function(b,c){var d;if(!(b instanceof Object))return void 0;if(b.zone===!1)return void 0;if(d=b.name,void 0===d&&b.zone===!0)return root.currentObservableName();if(a.eden.isValidIdentifier(d)){var e=root.lookup(d+"_click");void 0===e.value()&&e.assign(!1,root.scope,root.lookup(c))}return d},this.initZoneFromName=function(b,c){if(a.eden.isValidIdentifier(b)){var d=root.lookup(b+"_click");void 0===d.value()&&d.assign(!1,root.scope,root.lookup(c))}return b},this.findDrawableHit=function(a,b,c,d,e,f){var g=root.lookup(b).value();if(!Array.isArray(g))return void 0;var h,i,j=canvases[a],k=j.getContext("2d"),l=root.lookup("_view_"+a+"_scale").value();e?(h=0,i=1):(h=g.length-1,i=-1);for(var m=h;e?m<g.length:m>=0;m+=i){var n=g[m];if("object"==typeof n){var o=n.name;if(f||void 0!==o){var p=n.isHit;if(void 0!==p){k.save();var q=n.isHit(k,l,c,d);if(k.restore(),q)return n}}}}return void 0},this.findDrawableHit2=function(a,b,c,d,e){var f,h;if(a instanceof Symbol){h=a.name.slice(1);for(var i in g[h]){f=i;break}}else{if(f=a,!(f in canvases))return void 0;h=canvases[f].pictureObs}return this.findDrawableHit(f,h,b,c,d,e)},this.findAllDrawablesHit=function(a,b,c,d){var e,f,h;if(a instanceof Symbol){f=a.name.slice(1);for(var i in g[f]){e=i;break}h=a.value()}else{if(e=a,!(e in canvases))return void 0;f=canvases[e].pictureObs,h=root.lookup(f).value()}if(!Array.isArray(h))return[];for(var j=canvases[e],k=j.getContext("2d"),l=root.lookup("_view_"+e+"_scale").value(),m=[],n=0;n<h.length;n++){var o=h[n];if("object"==typeof o){var p=o.name;if(d||void 0!==p){var q=o.isHit;if(void 0!==q){k.save();var r=o.isHit(k,l,b,c);k.restore(),r&&m.push(o)}}}}return m},this.mouseInfo={leftButton:!1,middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1},this.createCommon=function(b,g){function h(){var b,d,e=s.value();e instanceof Point?(b=e.x,d=e.y):(b=0,d=0);var f=r.value(),g=t.value();void 0!==g?(g=Math.ceil(t.value()*q.value()*f+b),n.width=g):f>1?n.width=Math.ceil(v.value()*f):n.width=Math.floor(v.value());var h;void 0!==u.value()?h=Math.ceil(u.value()*q.value()*f+d):f>1?h=Math.ceil(w.value()*f):(h=w.value(),void 0!==g&&g>Math.floor(v.value())&&(h-=a.scrollBarSize),h=Math.floor(h-1)),n.height=h,n.rescale=!0,c.drawPictureForView(m)}function i(){x?(x=!1,n.rescale=!0,c.drawPictureForView(m),A||(A=!0,setTimeout(i,1e3))):(h(),A=!1)}var j,k,l=root.lookup("createView"),m=b,n=canvases[b];void 0===n?(j=$('<div id="'+b+'-canvascontent" class="canvashtml-content"></div>'),j.html('<canvas class="canvashtml-canvas" id="'+b+'-canvas" tabindex="1"></canvas>'),k=j.find(".canvashtml-canvas"),n=k[0],canvases[b]=n,contents[b]=j[0],f[b]={},n.drawingQueued=!1,n.drawingInProgress=!1,n.rescale=!1):(j=$("#"+b+"-canvascontent"),k=j.find(".canvashtml-canvas"));var o=root.lookup("_view_"+m+"_observable");o.addJSObserver("refreshView",function(b,c){a.plugins.Canvas2D.setPictureObs(m,c)});var p=root.lookup("_view_"+m+"_background_colour");void 0===p.value()&&p.assign("white",root.scope,l),p.addJSObserver("repaintView",function(a,b){c.drawPictureForView(m)});var q=root.lookup("_view_"+m+"_scale"),r=root.lookup("_view_"+m+"_zoom"),s=root.lookup("_view_"+m+"_offset"),t=root.lookup("_view_"+m+"_canvas_right"),u=root.lookup("_view_"+m+"_canvas_bottom"),v=root.lookup("_view_"+m+"_width"),w=root.lookup("_view_"+m+"_height"),x=!1,y=q.value();void 0===y&&(q.assign(1,root.scope,l),y=1),q.addJSObserver("repaintView",h);var z=r.value();void 0===z&&(r.assign(1,root.scope,l),z=1);var A=!1;r.addJSObserver("repaintView",function(a,b){Math.round(100*b);x=!0,i()});var B,C,D=s.value();D instanceof Point?(B=D.x,C=D.y):(s.assign(new Point(0,0),root.scope,l),B=0,C=0),s.addJSObserver("repaintView",h),void 0==t.value()&&t.assign(void 0,root.scope,l),t.addJSObserver("repaintView",h),void 0==u.value()&&u.assign(void 0,root.scope,l),u.addJSObserver("repaintView",h);var E=t.value();E=void 0===E?d:E*y+B;var F=u.value();return F=void 0===F?e:F*y+C,k.on("mousedown",function(a){var b=root.lookup("mouseFollow").value();root.beginAutocalcOff();var d=c.mouseInfo;d.insideCanvas=!0;var e;switch(a.button){case 0:d.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,Symbol.hciAgent,b),e="Left";break;case 1:d.middleButton=!0,e="Middle";break;case 2:d.rightButton=!0,e="Right";break;case 3:d.button4=!0,e="Button4";break;case 4:d.button5=!0,e="Button5";break;default:e="Unknown"}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5;var f="|";if(d.leftButton&&(f+="Left|"),d.middleButton&&(f+="Middle|"),d.rightButton&&(f+="Right|"),d.button4&&(f+="Button4|"),d.button5&&(f+="Button5|"),root.lookup("mouseButtons").assign(f,root.scope,Symbol.hciAgent,b),root.lookup("mouseButton").assign(e+" down",root.scope,Symbol.hciAgent,b),1==d.buttonCount){var g=root.lookup("mousePosition").value();root.lookup("mouseDownView").assign(m,root.scope,Symbol.hciAgent,b),root.lookup("mouseDown").assign(g,root.scope,Symbol.hciAgent,b);var h=root.lookup("mouseZone").value();root.lookup("mouseDownZone").assign(h,root.scope,Symbol.hciAgent,b)}root.endAutocalcOff()}).on("mouseup",function(b){var d=root.lookup("mouseFollow").value();root.beginAutocalcOff();var e=c.mouseInfo;e.insideCanvas=!0;var f;switch(b.button){case 0:e.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,Symbol.hciAgent,d),f="Left";break;case 1:e.middleButton=!1,f="Middle";break;case 2:e.rightButton=!1,f="Right";break;case 3:e.button4=!1,f="Button4";break;case 4:e.button5=!1,f="Button5";break;default:f="Unknown"}if(e.buttonCount=e.leftButton+e.middleButton+e.rightButton+e.button4+e.button5,root.lookup("mouseButton").assign(f+" up",root.scope,Symbol.hciAgent,d),0==e.buttonCount){var g=root.lookup("mousePosition").value();root.lookup("mouseButtons").assign("",root.scope,Symbol.hciAgent,d),root.lookup("mouseUp").assign(g,root.scope,Symbol.hciAgent,d),a.plugins.Canvas2D.endClick()}else{var h="|";e.leftButton&&(h+="Left|"),e.middleButton&&(h+="Middle|"),e.rightButton&&(h+="Right|"),e.button4&&(h+="Button4|"),e.button5&&(h+="Button5|"),root.lookup("mouseButtons").assign(h,root.scope,Symbol.hciAgent,d)}root.endAutocalcOff()}).on("contextmenu",function(a){root.lookup("mouseContextMenuEnabled").value()||(a.preventDefault(),a.stopPropagation())}).on("click",function(a){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(a){var b=root.lookup("mouseFollow").value(),c=root.lookup("mouseDoubleClicks"),d=c.value();c.assign(d+1,root.scope,Symbol.hciAgent,b)}).on("wheel",function(a){var b,d=a.originalEvent,e=w.value();b=d.deltaMode==WheelEvent.DOM_DELTA_LINE?c.defaultLineHeight:d.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=d.deltaX?t.value():e:1;var f=root.lookup("mouseFollow").value();if(0!=d.deltaY&&a.ctrlKey&&!a.altKey&&!a.metaKey&&!a.shiftKey){a.preventDefault(),a.stopPropagation(),root.beginAutocalcOff();var g=-d.deltaY*b;if(root.lookup("touchPinchEnabled").value()){var h=root.lookup("touchPinch"),i=h.value();i+=g,h.assign(i,root.scope,Symbol.hciAgent,f)}else{var j=r.value();j=j*(e+2*g)/e,.05>j&&(j=.05),r.assign(j,root.scope,Symbol.hciAgent,f)}return void root.endAutocalcOff()}if(root.lookup("mouseWheelEnabled").value()){if(root.beginAutocalcOff(),0!==d.deltaY&&(!a.ctrlKey||a.altKey||a.metaKey||a.shiftKey)){a.preventDefault(),a.stopPropagation();var k=root.lookup("mouseWheel"),l=k.value(),g=d.deltaY*b;l+=g,k.assign(l,root.scope,Symbol.hciAgent,f),root.lookup("mouseWheelSpeed").assign(g,root.scope,Symbol.hciAgent,f)}if(0!==d.deltaX){a.preventDefault(),a.stopPropagation();var m=root.lookup("touchPanX"),n=m.value(),o=d.deltaX*b;n+=o,m.assign(n,root.scope,Symbol.hciAgent,f),root.lookup("touchPanXSpeed").assign(o,root.scope,Symbol.hciAgent,f)}root.endAutocalcOff()}}).on("mouseout",function(a){c.mouseInfo.insideCanvas=!1;var b=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,Symbol.hciAgent,b)}).on("mouseenter",function(a){var b=c.mouseInfo;if(!b.insideCanvas){b.insideCanvas=!0;var d;0==b.buttonCount?d="":(d="|",b.leftButton&&(d+="Left|"),b.middleButton&&(d+="Middle|"),b.rightButton&&(d+="Right|"),b.button4&&(d+="Button4|"),b.button5&&(d+="Button5|"));var e=root.lookup("mouseButtons"),f=e.value();if(d!=f){var g=root.lookup("mouseFollow").value();root.beginAutocalcOff(),e.assign(d,root.scope,Symbol.hciAgent,g),root.lookup("mouseButton").assign("Enter window",root.scope,Symbol.hciAgent,g);var h=root.lookup("mousePressed");h.value()!=b.leftButton&&h.assign(b.leftButton,root.scope,Symbol.hciAgent,g),""==f&&""!=d&&(root.lookup("mouseDown").assign(void 0,root.scope,Symbol.hciAgent,g),root.lookup("mouseDownView").assign(void 0,root.scope,Symbol.hciAgent,g)),root.endAutocalcOff()}}}).on("mousemove",function(a){var b=root.lookup("mouseFollow").value();root.beginAutocalcOff();var d,e,f=root.lookup("mousePosition"),g=root.lookup("_view_"+m+"_scale").value(),h=root.lookup("_view_"+m+"_zoom").value(),i=g*h;if(c.mouseInfo.capturing){var j=f.value(),k=a.originalEvent;d=j.x+k.movementX/i,e=j.y+k.movementY/i}else{var l=$(this).offset();d=(a.pageX-Math.round(l.left))/i,e=(a.pageY-Math.round(l.top))/i}var n;n=new Point(d,e),root.lookup("mouseView").assign(m,root.scope,Symbol.hciAgent,b),f.assign(n,root.scope,Symbol.hciAgent,b);var p=o.value();if(void 0!==p){var q,r=c.findDrawableHit(m,p,d,e,!1,!1);q=void 0===r?void 0:r.name,root.lookup("mouseZone").assign(q,root.scope,Symbol.hciAgent,b)}root.endAutocalcOff()}).on("keyup",function(a){var b=a.which,c=!1;if(a.altKey&&!a.shiftKey&&!a.ctrlKey){var d=root.lookup("_view_"+m+"_zoom"),e=d.value();61==b||187==b?(e=1.25*e,c=!0):173==b||189==b?(e/=1.25,c=!0):48==b&&(e=1,c=!0),d.assign(e,root.scope,Symbol.hciAgent)}c&&(a.preventDefault(),a.stopPropagation())}),{initialWidth:E,initialHeight:F,code_entry:j,offsetSym:s,zoomSym:r,widthSym:t,heightSym:u,scaleSym:q,pictureSelectSym:o}},this.createEmbedded=function(b,d,e){var f=b,h=c.createCommon(b,d,e),i=(h.initialWidth,h.initialHeight,h.code_entry),j=h.offsetSym,k=h.zoomSym,l=h.widthSym,m=h.heightSym,n=h.scaleSym;c.setPictureObs(b,e);var o={code_entry:i,destroy:function(){console.log("DESTROY: "+f),delete canvases[f],delete contents[f],delete g[e][f],delete viewsToPictureObs[f]},resize:function(b,d){var g,h,i=j.value();i instanceof Point?(g=i.x,h=i.y):(g=0,h=0);var o,p,q=k.value(),r=document.getElementById(f+"-canvas"),s=!1,t=l.value();if(void 0===t?(o=q>1?Math.ceil(b*q):Math.floor(b),r.width!=o&&(r.width=o,s=!0)):t=Math.ceil(t*n.value()*q+g),void 0===m.value()){if(q>1)p=Math.ceil(d*q);else{p=d,void 0!==t&&t>p&&(p-=a.scrollBarSize);var p=Math.floor(p-1)}p!=r.height&&(r.height=p,s=!0)}s&&c.drawPicture(f,e)}};return o},this.createDialog=function(b,d,e){var h,i=b.slice(0,-7),j=c.createCommon(i,d,e),k=j.initialWidth,l=j.initialHeight,m=j.code_entry,n=j.offsetSym,o=j.zoomSym,p=j.widthSym,q=j.heightSym,r=j.scaleSym,s=j.pictureSelectSym;$('<div id="'+b+'"></div>').html(m).dialog({title:d,width:k+a.scrollBarSize,height:l+a.titleBarHeight,minHeight:120,minWidth:230,dialogClass:"canvas-dialog unpadded-dialog"}),h={confirmClose:!0,destroy:function(){var a=f[i];for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];$(e).detach()}delete canvases[i],delete contents[i];var h=s.value();void 0!==h&&delete g[h][i]},resize:function(b,d){var e,f,g=n.value();g instanceof Point?(e=g.x,f=g.y):(e=0,f=0);var h,j,k=o.value(),l=document.getElementById(i+"-canvas"),m=!1,s=p.value();if(void 0===s?(h=k>1?Math.ceil(b*k):Math.floor(b),l.width!=h&&(l.width=h,m=!0)):s=Math.ceil(s*r.value()*k+e),void 0===q.value()){if(k>1)j=Math.ceil(d*k);else{j=d,void 0!==s&&s>j&&(j-=a.scrollBarSize);var j=Math.floor(j-1)}j!=l.height&&(l.height=j,m=!0)}m&&c.drawPictureForView(i)}};var e=s.value();return void 0!==e&&a.plugins.Canvas2D.setPictureObs(i,e),h},root.lookup("mouseDownZone").addJSObserver("recordClick",function(a,b){if(eden.isValidIdentifier(b)){var c=root.lookup(b+"_click");c.value()===!1&&c.assign(!0,root.scope,Symbol.hciAgent)}}),this.endClick=function(){var a=root.lookup("mouseDownZone").value();if(eden.isValidIdentifier(a)){var b=root.lookup(a+"_click");b.value()===!0&&b.assign(!1,root.scope,Symbol.hciAgent)}},document.addEventListener("mouseup",function(b){var d=root.lookup("mouseFollow").value();root.beginAutocalcOff();var e=c.mouseInfo;if(!e.insideCanvas){var f;switch(b.button){case 0:e.leftButton=!1,f="Left";break;case 1:e.middleButton=!1,f="Middle";break;case 2:e.rightButton=!1,f="Right";break;case 3:e.button4=!1,f="Button4";break;case 4:e.button5=!1,f="Button5";break;default:f="Unknown"}e.buttonCount=e.leftButton+e.middleButton+e.rightButton+e.button4+e.button5;var g=root.lookup("mouseButtons");if(0==e.buttonCount&&""!=g.value()){var h=root.lookup("mousePressed"),i=h.value();root.lookup("mouseButton").assign(f+" up",root.scope,Symbol.hciAgent,d),g.assign("",root.scope,Symbol.hciAgent,d),root.lookup("mousePosition").assign(void 0,root.scope,Symbol.hciAgent,d),i&&h.assign(!1,root.scope,Symbol.hciAgent,d),root.lookup("mouseUp").assign(void 0,root.scope,Symbol.hciAgent,d),root.lookup("mouseView").assign(void 0,root.scope,Symbol.hciAgent,d),a.plugins.Canvas2D.endClick()}}root.endAutocalcOff()}),document.addEventListener("mousedown",function(a){var b=c.mouseInfo;if(!b.insideCanvas){switch(a.button){case 0:b.leftButton=!0;break;case 1:b.middleButton=!0;break;case 2:b.rightButton=!0;break;case 3:b.button4=!0;break;case 4:b.button5=!0}b.buttonCount=b.leftButton+b.middleButton+b.rightButton+b.button4+b.button5}}),document.addEventListener("pointerlockchange",function(a){var b=null!==document.pointerLockElement;c.mouseInfo.capturing=b;var d=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(b,root.scope,void 0,d)}),a.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:a.viewCategories.visualization,holdsContent:!0},a.eden.include("plugins/canvas-html5/jseden-canvas.min.js-e",b)},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Page=function(a,b){function c(a){if(!a)return"";if("icon"!=a[0])return"";var b=$("<div class='page-icon'>"+a[1]+"</div>");return b.css("font-size",a[2]+"px"),b.css("color",a[3]),b}function d(a){if(!a)return"";if("title"!=a[0])return"";var b=$("<div class='page-title "+l+"'><div class='page-title-block'><span class='page-title-text "+l+"'>"+a[1]+"</span><br/><span class='page-subtitle-text "+l+"'>"+a[2]+"</span></div></div>");if(void 0!==a[3]){var d=$("<div class='page-title-logo'></div>");switch(a[3][0]){case"icon":c(a[3]).appendTo(d)}d.appendTo(b)}return b}function e(a){if(!a)return"";if("header"!=a[0])return"";switch(a[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+a[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+a[1]+"</h2>")}}function f(a){if(!a)return"";if("p"!=a[0])return"";var b;return b=a[1]instanceof Array?a[1].join("&nbsp;"):a[1],$("<div class='page-paragraph'>"+b+"</div>")}function g(b){if(b&&"script"==b[0]){var c=b[1],d=b[2],e=b[3],f=b[4],g=b[5],h=b[6],i=b[7],j=b[8];if(0==c){var k;r[e]?(k=r[e],k.update(d)):(k=a.views.ScriptInput.embed(e,e,d,h),r[e]=k);var l;l=f?$("<div class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>");var m=EdenUI.plugins.ScriptInput.getRequiredHeight(g);return l.height(m),"none"!=i&&l.css("float",i),"50%"!=j&&("number"==typeof j?l.width(j):l.css("width",j)),k.contents.appendTo(l),l}var n;n=f?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>");var o,p=new EdenUI.Highlight(n.get(0));o=d instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(d):d;
var q=new Eden.AST(o);p.highlight(q,-1,-1),"none"!=i&&n.css("float",i),"50%"!=j&&("number"==typeof j?n.width(j):n.css("width",j));var m=EdenUI.plugins.ScriptInput.getRequiredHeight(g,!0);return n.height(m),n}}function h(b){var c,d=b[6];b[3],b[4];if(c=d?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>"),void 0===q[b[1]]){var e=a.views.Canvas2D.embedded(b[1],b[1],b[2]);q[b[1]]=e,c.append(e.code_entry),p.push(function(){e.resize(b[3],b[4])})}else q[b[1]].code_entry.appendTo(c),p.push(function(){q[b[1]].resize(b[3],b[4])});return"none"!=b[5]&&c.css("float",b[5]),c}function i(a){var b;if(b=a[1]?$("<ul></ul>"):$("<ol></ol>"),a[2]&&a[2]instanceof Array)for(var c=0;c<a[2].length;c++){var d=$("<li>"+a[2][c]+"</li>");b.append(d)}return b}function j(a,b){if(!a)return"";if(!(a instanceof Array))return"";for(var c=$("<div class='page-content "+l+"'></div>"),d=0;d<a.length;d++)if(void 0!==a[d])switch(a[d][0]){case"header":c.append(e(a[d]));break;case"p":c.append(f(a[d]));break;case"script":c.append(g(a[d]));break;case"canvas":c.append(h(a[d]));break;case"break":c.append($("<div class='clear'></div>"));break;case"list":c.append(i(a[d]))}return c}function k(a,b){if(b instanceof Array){for(var c in q)q[c].code_entry.detach();for(var e in r)r[e].contents.detach();l=b[2],"default"==l&&(l="page-theme-default"),o.html(""),o.append(d(b[1])),o.append(j(b[3],0));for(var f=0;f<p.length;f++)p[f]();p=[]}}var l,m=a.eden.root.lookup("page"),n=m.value(),o=$("<div class='main-page'></div>");$("body").append(o).addClass("page-body");var p=[],q={},r={};k(m,n),m.addJSObserver("pageGenerator",k),a.eden.include2("plugins/page/page.js-e",b)},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";var edenfunctions={};EdenUI.plugins.SymbolViewer=function(a,b){var c=this;$.ajax({url:"library/functions.json",dataType:"json",success:function(a){edenfunctions=a},cache:!1,async:!0}),this.instances=[];var d=function(a,b){for(var c='			<div class="symbollist-search-box-outer"> 				<input type="text" class="symbollist-search symbollist-control" /> 				<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> 				<select id="'+a+'-category-filter" class="symbollist-control"> 					<option value="user">Construal</option>',d=Eden.getSymbolCategories(b),e=0;e<d.length;e++)c=c+'<option value="'+d[e]+'">'+d[e]+"</option>";return c+='<option value="system">Complete Library</option> 					<option value="all">All Sources</option> 				</select>',"obs"==b&&(c=c+'				<select id="'+a+'-type-filter" class="symbollist-control symbollist-rightmost-control"> 					<option value="formulas">Dependencies</option>					<option value="vars">Base Observables</option>					<option value="all" selected="selected">All Kinds</option>				</select>'),c+='			</div> 			<div class="symbollist-results"></div>'};this.createDialog=function(b,e,f){function g(b,c){var d=a.regExpFromStr($(k),"",!1,c);j.search(d),"regexp"==c?$(k).attr("placeholder","search regular expression"):$(k).attr("placeholder","search")}var h=b.slice(0,-7),i=$('<div class="symbollist-outer"></div>');i.html(d(b,f));var j=new EdenUI.plugins.SymbolViewer.SymbolList(a.eden.root,i.find(".symbollist-results")[0],f);$dialog=$('<div id="'+b+'"></div>').append(i).dialog({title:e,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"symbollist-dialog"}),c.instances.push(j),j.search(new RegExp(""));var k=i.find(".symbollist-search-box-outer > .symbollist-search"),l=k.get(0);k.keyup(function(){var b=a.regExpFromStr($(this));j.search(b)}),i.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var b,c="edit_"+h,d=["## Selection: "+l.value];for(var e in j.symbols)b=a.eden.root.lookup(e),d.push(b),d.push("");a.createView(c,"ScriptInput",void 0).update(d),a.eden.root.lookup("_view_"+c+"_title").assign("Script for "+h,eden.root.scope,Symbol.hciAgent)});var k=i.find(".symbollist-search-box-outer > .symbollist-search"),m=root.lookup("_view_"+h+"_search_lang");g(m,m.value()),m.addJSObserver("refreshView",g),k.keyup(function(){var b=m.value(),c=a.regExpFromStr($(this),"",!1,b);j.search(c)}),document.getElementById(b+"-category-filter").addEventListener("change",function(b){var c=m.value(),d=a.regExpFromStr($(k),"",!1,c);j.search(d,b.target.value)}),"obs"==f&&document.getElementById(b+"-type-filter").addEventListener("change",function(b){var c=m.value(),d=a.regExpFromStr($(k),"",!1,c);j.search(d,void 0,b.target.value)})},this.createObservableDialog=function(a,b){return c.createDialog(a,b,"obs")},this.createFunctionDialog=function(a,b){return c.createDialog(a,b,"func")},this.createAgentDialog=function(a,b){return c.createDialog(a,b,"agent")},this.createSymbolDialog=function(a,b){return c.createDialog(a,b,"all")};var e={},f={},g=!1;this.delay=40;var h=function(){for(x in c.instances){var a,b,d,h=c.instances[x];void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(a=$(h.symresults),b=a.parent(),d=a.scrollTop(),a.detach());for(var i in f){var j=f[i];h.addSymbol(j,i)}for(var i in e)h.updateSymbol(i);void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(a.appendTo(b),a.scrollTop(d))}e={},f={},g=!1},i=function(a,b){var d=a.name.substr(1);b?f[d]=a:e[d]=a,g||(g=!0,setTimeout(h,c.delay))};a.eden.root.addGlobal(i),a.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:a.viewCategories.comprehension,menuPriority:0},a.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:a.viewCategories.comprehension,menuPriority:0},a.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:a.viewCategories.comprehension,menuPriority:0},a.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:a.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),b()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(a,b,c){this.root=a,this.regExp=new RegExp(""),this.type=c,this.category="user",this.customCategory=!1,this.subtypes="all",this.symresults=b,this.symbols={}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(a,b,c){this.regExp=a,void 0!==b&&(this.category=b,this.customCategory="user"!=b&&"system"!=b&&"all"!=b),void 0!==c&&(this.subtypes=c),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};var d,e;for(d in this.root.symbols)e=this.root.symbols[d],this.addSymbol(e,d)},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(a){void 0!==this.symbols[a]&&this.symbols[a].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(a,b){if(this.regExp.test(b)){if(this.customCategory){if(!Eden.isitCategory(b,this.category,this.type))return}else if(Eden.isitSystemSymbol(b)){if("user"==this.category)return}else if("system"==this.category)return;if(void 0!==a.eden_definition&&void 0!==a.definition){if("vars"==this.subtypes)return}else if("formulas"==this.subtypes)return;var c="obs";if(a.definition&&a.eden_definition){var d=a.eden_definition;c=/^proc\s/.test(d)?"agent":/^func\s/.test(d)?"func":"function"==typeof a.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(a.cache.value.toString())?"func":"agent":"obs"}else c="function"==typeof a.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(a.cache.value.toString())?"func":"agent":"obs";var e="all"==this.type||this.type==c;if(e){var f=new EdenUI.plugins.SymbolViewer.Symbol(a,b,c);f.element.appendTo(this.symresults),this.symbols[b]=f}}},EdenUI.plugins.SymbolViewer.Symbol=function(a,b,c){function d(){e.element.removeClass("symbollist-inline-editor"),e.update(),e.element.scrollLeft(0)}switch(this.symbol=a,this.name=b,this.type=c,this.element=$('<div class="symbollist-result-element"></div>'),this.details=void 0,this.update=void 0,c){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var e=this,f=!1;this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||f||(f=!0,setTimeout(function(){if(!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&f){f=!1;var b="edit_"+e.name;edenUI.createView(b,"ScriptInput",void 0).update([a]),edenUI.eden.root.lookup("_view_"+b+"_title").assign("Script for "+e.name,edenUI.eden.root.scope,Symbol.hciAgent)}},350))}),"obs"==c&&this.element.dblclick(function(){function a(){var a=l.get(0).value,b=o.value;";"!=b.slice(-1)&&(b+=";"),eden.execute2(e.name+" "+a+" "+b),d(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0}function c(b){var c=b.which;13==c?a():27==c&&(d(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}if(f=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==e){var g=e.symbol.cache.value;if(void 0!==e.symbol.eden_definition||"boolean"!=typeof g){EdenUI.plugins.SymbolViewer.inlineEditorSymbol=e,e.element.addClass("symbollist-inline-editor");var h=e.element.find(".result_value"),i=e.element.find(".result_separator");h.html("");var j,k;void 0!==e.symbol.eden_definition?(j=e.symbol.eden_definition.replace(new RegExp("^\\s*"+b+"\\s+is\\s+"),""),k="is"):(j=Eden.edenCodeForValue(g),k="=");var l=$("<select></select>");"="==k?(l.append('<option value="is">is</option>'),l.append('<option value="=" selected="selected">=</option>')):(l.append('<option value="is" selected="selected">is</option>'),l.append('<option value="=">=</option>')),i.html(" "),i.append(l);var m=Eden.htmlEscape(j,!0),n=$('<input type="text" value="'+m+'" spellcheck="false" style="width: 100%"/>'),o=n.get(0);n.on("keyup",c),n.on("blur",function(){setTimeout(function(){l.is(document.activeElement)||(d(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===e&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),l.on("keydown",c),l.on("blur",function(){setTimeout(function(){n.is(document.activeElement)||(d(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===e&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),h.append(n);var p=e.element.find(".symbollist-result-inner");p.length>0&&(p.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),o.focus(),o.select();var q=j.slice(0,1);('"'==q||"'"==q||"["==q||"{"==q)&&(o.selectionStart=1,o.selectionEnd=j.length-1)}else g===!0?e.symbol.assign(!1,eden.root.scope,Symbol.hciAgent,!0):e.symbol.assign(!0,eden.root.scope,Symbol.hciAgent,!0)}}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var a,b,c=this.symbol.eden_definition;if(a=void 0===c||/^func\s/.test(c)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name]){this.details=edenfunctions.functions[this.name];var d=Object.keys(this.details.parameters||{});b="<span class='result_value'> ( "+d.join(", ")+" )</span>"}else b="";var e="<span class='result_name'>"+a+"</span>"+b;if(void 0!==c&&!/^func\s/.test(this.symbol.eden_definition)){var f=Eden.htmlEscape(c,!1,!0);f=Eden.htmlEscape("<pre>"+f+";</pre>"),e="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+f+"\")' onmouseleave='EdenUI.closeTooltip()'>"+e+"</span>"}this.element.html(e)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var a,b=this.symbol.value(),c=_formatVal(b);a=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name;var d="<span class='result_name'>"+a+"</span><span class='result_separator'> = </span> <span class='result_value'>"+c+"</span>";if(void 0!==this.symbol.definition){var e=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);e=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+e+";</pre>"),d="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+e+"\")' onmouseleave='EdenUI.closeTooltip()'>"+d+"</span>"}this.element.html(d)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var a,b,c=this.symbol.eden_definition;if(a=void 0===c||/^proc\s/.test(c)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name]){this.details=edenfunctions.procedures[this.name];var d=Object.keys(this.details.parameters||{});b="<span class='result_value'> ( "+d.join(", ")+" )</span>"}else b="";var e="<span class='result_name'>"+a+"</span>"+b;if(void 0!==c&&!/^proc\s/.test(this.symbol.eden_definition)){var f=Eden.htmlEscape(c,!1,!0);f=Eden.htmlEscape("<pre>"+f+";</pre>"),e="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+f+"\")' onmouseleave='EdenUI.closeTooltip()'>"+e+"</span>"}this.element.html(e)},EdenUI.plugins.HTMLContent=function(a,b){this.html=function(b,c){b in a.viewInstances||a.createView(b,"HTMLContent"),$("#"+b+"-dialog-content").html(c)},this.createDialog=function(a,b){var c=$('<div id="'+a+'-content" class="htmlviews-content"></div>');return $('<div id="'+a+'"></div>').html(c).dialog({title:b,width:600,height:450,minHeight:120,minWidth:230}),{confirmClose:!0}},a.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:a.viewCategories.visualization,holdsContent:!0},a.eden.include("plugins/html-views/html.js-e",b)},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(a,b){var c=this;this.createDialog=function(a,b){var c='<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>';$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:300,height:450,minHeight:120,minWidth:230})};var d=function(a,b,c,d,e){var f=function(g,h,i){if(!g.hasOwnProperty("children"))return g.name;var j,k,l,m=g.name,n=g.children;if(b.hasOwnProperty(m)&&2==n.length){j=b[m],k=j.precedence;var o=j.associativity,p=f(n[0],k,j.text),q=f(n[1],k,j.text);if("left"==o){var r=n[1].name;n[1].hasOwnProperty("children")&&2==n[1].children.length&&b.hasOwnProperty(r)&&k==b[r].precedence&&(q="("+q+")")}else{var s=n[0].name;n[0].hasOwnProperty("children")&&2==n[0].children.length&&b.hasOwnProperty(s)&&k==b[s].precedence&&(p="("+p+")")}l=j.whitespace?p+" "+j.text+" "+q:p+j.text+q}else if(a.hasOwnProperty(m))j=a[m],k=j.precedence,l=j.text+f(n[0],k,j.text);else if(c.hasOwnProperty(m))j=c[m],k=j.precedence,l=f(n[0],k,j.text)+j.text;else if(d.hasOwnProperty(m))j=d[m],this.precedence=j.precedence,l=j.code(n,i);else{k=e;for(var t=[],u=0;u<n.length;u++)t.push(f(n[u],0,void 0));l=m+"("+t.join(", ")+")"}return h>k&&(l="("+l+")"),l};return function(a){return f(a,0,void 0)}},e={};e["="]={precedence:1,associativity:"right",text:"=",whitespace:!0},e["+="]={precedence:1,associativity:"right",text:"+=",whitespace:!0},e["-="]={precedence:1,associativity:"right",text:"-=",whitespace:!0},e["||"]={precedence:3,associativity:"left",text:"||",whitespace:!0},e.or={precedence:3,associativity:"left",text:"or",whitespace:!0},e["&&"]={precedence:4,associativity:"left",text:"&&",whitespace:!0},e.and={precedence:4,associativity:"left",text:"and",whitespace:!0},e["=="]={precedence:5,associativity:"left",text:"==",whitespace:!0},e["!="]={precedence:5,associativity:"left",text:"!=",whitespace:!0},e["<"]={precedence:6,associativity:"left",text:"<",whitespace:!0},e["<="]={precedence:6,associativity:"left",text:"<=",whitespace:!0},e[">"]={precedence:6,associativity:"left",text:">=",whitespace:!0},e[">="]={precedence:6,associativity:"left",text:">",whitespace:!0},e["=~"]={precedence:6,associativity:"left",text:"=~",whitespace:!0},e["!~"]={precedence:6,associativity:"left",text:"!=",whitespace:!0},e["//"]={precedence:7,associativity:"left",text:"//",whitespace:!0},e["+"]={precedence:8,associativity:"left",text:"+",whitespace:!0},e["-"]={precedence:8,associativity:"left",text:"-",whitespace:!0},e["*"]={precedence:9,associativity:"left",text:"*",whitespace:!0},e["/"]={precedence:9,associativity:"left",text:"/",whitespace:!0},e["%"]={precedence:9,associativity:"left",text:"%",whitespace:!0},e["^"]={precedence:11,associativity:"right",text:".",whitespace:!1},e["."]={precedence:14,associativity:"left",text:".",whitespace:!1};var f={};f["-"]={precedence:10,text:"-"},f["!"]={precedence:10,text:"!"},f["&"]={precedence:10,text:"&"},f.not={precedence:10,text:"!"},f["++."]={precedence:11,text:"++"},f["--."]={precedence:11,text:"--"},f["*"]={precedence:12,text:"*"};var g={};g["#"]={precedence:11,text:"#"},g[".++"]={precedence:11,text:"++"},g[".--"]={precedence:11,text:"--"};var h={},i=13;this.convertTreeToEden=d(f,e,g,h,i),h["?"]={precedence:2,code:function(a){var b=c.convertTreeToEden(a[0]),d=c.convertTreeToEden(a[1]),e=c.convertTreeToEden(a[2]);return b+"? "+d+" : "+e}},h["`...`"]={precedence:13,code:function(a){var b=c.convertTreeToEden(a[0]);return"`"+b+"`"}},h["${{...}}$"]={precedence:13,code:function(a){var b=a[0].name;return"${{ "+b+" }}$"}},h["(...)"]={precedence:13,code:function(a){for(var b=c.convertTreeToEden(a[0]),d=[],e=1;e<a.length;e++)d.push(c.convertTreeToEden(a[e]));return"("+b+")("+d.join(", ")+")"}},h["[...]"]={precedence:13,code:function(a){for(var b=[],d=0;d<a.length;d++)b.push(c.convertTreeToEden(a[d]));return"["+b.join(", ")+"]"}},h["[n]"]={precedence:13,code:function(a){var b=c.convertTreeToEden(a[0]),d=c.convertTreeToEden(a[1]);return b+"["+d+"]"}},h["{...}"]={precedence:13,code:function(a){for(var b=[],d=0;d<a.length-1;d+=2)b.push(a[d].name+": "+c.convertTreeToEden(a[d+1]));return"{"+b.join(", ")+"}"}},h.Point={precedence:13,code:function(a,b){if("."==b){for(var d=[],e=0;e<a.length;e++)d.push(c.convertTreeToEden(a[e]));return"Point("+d.join(", ")+")"}var f=c.convertTreeToEden(a[0]),g=c.convertTreeToEden(a[1]);return"{"+f+", "+g+"}"}},a.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:a.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_observable","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","radiansPerUnit","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelSpeed:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,radiansPerUnit:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showObservables:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0},Eden.systemFunctionNames={Arc:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,FillPattern:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,"char":!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,generate_function:!0,hsl2colour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,"int":!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgb2colour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_observable:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelDir:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,radiansPerUnit:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,FillPattern:!0,GreyPixelList:!0,hsl2colour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgb2colour:!0,rotatePoint:!0,RoundedRectangle:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,radiansPerUnit:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.isitSystemSymbol=function(a){return Eden.isitSystemObservable(a)||Eden.isitSystemAgent(a)||Eden.isitSystemFunction(a)},Eden.isitSystemObservable=function(a){return/^_view_/.test(a)?!0:a in Eden.systemObservableNames},Eden.isitSystemAgent=function(a){return/^_View_/.test(a)?!0:a in Eden.systemAgentNames},Eden.isitSystemFunction=function(a){return a in Eden.systemFunctionNames},Eden.isitCategory=function(a,b,c){var d=Eden.symbolCategories[b];return"all"==c?"obs"in d&&a in d.obs||"agent"in d&&a in d.agent||"func"in d&&a in d.func:c in d&&a in d[c]},Eden.getSymbolCategories=function(a){if("all"==a)return Object.keys(Eden.symbolCategories);var b=[];for(var c in Eden.symbolCategories)a in Eden.symbolCategories[c]&&b.push(c);return b},EdenUI.plugins.SymbolLookUpTable=function(a,b){this.createDialog=function(a,b){code_entry=$('<div id="'+a+'-content" class="symbol-lookup-table-content">'+c(a)+"</div>"),$dialog=$('<div id="'+a+'"></div>').html(code_entry).dialog({title:b,width:600,height:450,minHeight:120,minWidth:230})},a.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:a.viewCategories.comprehension,menuPriority:3},this.search=function(b){var c=$("#"+b+"-regexp"),e=a.regExpFromStr(c);document.getElementById(b+"-table-div").innerHTML=d(e,b)};var c=function(a){var b="<input id='"+a+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+a+"')\" placeholder='search' onload='setFocus()' />",c="<div class='upper'>"+b+"</div><div id='"+a+"-table-div' class='lower'>"+d(new RegExp(""),a)+"</div>";return c},d=function(a,b){var c='<tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower"><b>Definition</b></td><td class="lower"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>';tableBodyHTML="";var d,h=[],i={};for(var j in root.symbols)if(d=root.symbols[j],a.test(j)){var k,l,m;if(void 0===d.eden_definition)l="-",k="function"==typeof d.cache.value?"Function":"Observable",m=Eden.htmlEscape(Eden.edenCodeForValue(d.cache.value));else if(l=Eden.htmlEscape(d.eden_definition),0==l.indexOf("proc")){if(Eden.isitSystemAgent(j)&&!new RegExp("\\b"+j+"\\b").test(a.source))continue;k="Agent",m=""}else if(0==l.indexOf("func")){if(Eden.isitSystemFunction(j)&&!new RegExp("\\b"+j+"\\b").test(a.source))continue;k="Function",m=""}else k="Dependency",m=Eden.htmlEscape(Eden.edenCodeForValue(d.cache.value));h.push([d,j,k,l,m]),i[j]=!0}for(var n=0;n<h.length;n++){var o=h[n];d=o[0];var p=e(d.observees,i,b),q=e(d.dependencies,i,b),r=p;""!=p&&""!=q&&(r+=", "),r+=q;var s=e(d.observers,i,b),t=e(d.subscribers,i,b),u=s;""!=s&&""!=t&&(u+=", "),u+=t;var v=f(d.dynamicDependencyTable,i,b),w=d.last_modified_by?d.last_modified_by:"Not yet defined";w=g(w,i,b);var x=Object.keys(d.jsObservers).join(", "),y="<tr id='"+b+"-symbol-"+o[1]+'\'><td class="lower"><p>'+o[1]+'</p></td><td class="lower"><p>'+o[2]+'</p></td><td class="lower"><p>'+o[3]+'</p></td><td class="lower"><p>'+o[4]+'</p></td><td class="lower"><p>'+r+'</p></td><td class="lower"><p>'+u+'</p></td><td class="lower"><p>'+v+'</p></td><td class="lower"><p>'+w+'</p></td><td class="lower"><p>'+x+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(o[1])?tableBodyHTML+=y:tableBodyHTML=y+tableBodyHTML}return"<table>"+c+tableBodyHTML+"</table>"},e=function(a,b,c){var d=[];for(var e in a){var f=e.slice(1);d.push(g(f,b,c))}return d.join(", ")},f=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];void 0===f&&(f=""),d.push(g(f,b,c))}return d.join(", ")},g=function(a,b,c){return"*"==a[0]||"include"==a||"Not yet defined"==a?a:a in b?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+c+"-symbol-"+a+"')\">"+a+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+c+"', '"+a+"')\">"+a+"</a>"};this.addSymbolToSearch=function(b,c){var d,e=document.getElementById(b+"-regexp");d="false"==a.getOptionValue("optSimpleWildcards")?e.value+"|^"+c+"$":e.value+" "+Language.ui.search.disjunction+" "+c,e.value=d,this.search(b)},this.jump=function(a){var b=location.href;location.href="#"+a,history.replaceState(null,null,b)},b()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";var edenfunctions={};SymbolMeta=function(a){this.symbol=a,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(a){var b=0,c=0,d=.1;for(var e in this.symbol.dependencies){b++,d+=(1-d)*SymbolMeta.DependencyComplexityRate;var f=e.substr(1);void 0!==a.meta[f]&&a.meta[f].interestingness>=a.minInteresting()&&c++}return d-=b*SymbolMeta.DependencyChangeProbability,0!=b&&(d=.5*d+.5*(c/b)),0>d?0:d},SymbolMeta.prototype.subscriberInterestingness=function(a){var b=0,c=0,d=0;for(var e in this.symbol.subscribers){b++,d+=(1-d)*SymbolMeta.SubscriberRate;var f=e.substr(1);void 0!==a.meta[f]&&a.meta[f].interestingness>=a.minInteresting()&&c++}return d=1-d,0!=b&&(d=.5*d+.5*(c/b)),d},SymbolMeta.prototype.nameInterestingness=function(){var a=this.symbol.name.substr(1);return"_"==a[0]?.5:/\d/.test(a)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(a){var b=0;b=this.dependencyInterestingness(a)*this.subscriberInterestingness(a)*this.nameInterestingness()*this.significance,this.interestingness=b},EdenUI.plugins.ObservableMining=function(a,b){var c=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];var d=function(a){var b='<div class="symbolframer-results"></div>';return b};this.createDialog=function(a,b){var e=(a.slice(0,-7),$("<div></div>"));e.html(d(a)),c.symresults=e.find(".symbolframer-results")[0],$dialog=$('<div id="'+a+'"></div>').html(e).dialog({title:b,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var e=void 0,f=function(){if(void 0!==c.symresults){var a=$(c.symresults).parent();$(c.symresults).detach();for(var b=0;b<c.symbolsui.length;b++)if(c.symbolsui[b].meta.dodelete)c.symbolsui.splice(b,1);else if(0==c.symbolsui[b].meta.isinteresting){var d=c.symbolsui[b].element;c.symbolsui[b].element.hide("drop",{direction:"right"},"slow",function(){d.remove()}),c.symbolsui.splice(b,1)}for(var g=c.minInteresting(),h=c.maxInteresting(),b=0;b<c.interesting.length;b++){for(var i=!1,j=0;j<c.symbolsui.length;j++)if(c.symbolsui[j].meta==c.interesting[b]){i=!0;break}if(!i){var k=new EdenUI.plugins.ObservableMining.Symbol;c.symbolsui.push(k),k.element.appendTo(c.symresults),k.symbol=c.interesting[b].symbol;var l=k.symbol.name.substr(1);k.name=l,k.meta=c.interesting[b],k.outofdate=!0,k.symbolChanged=e}}for(var b=0;b<c.symbolsui.length;b++)c.symbolsui[b].update(g,h);$(c.symresults).appendTo(a)}for(var b=0;b<c.interesting.length;b++)c.interesting[b].interestingness*=SymbolMeta.DecayRate;setTimeout(f,c.delay)};f(),e=function(a,b){var d=a.name.substr(1),e=c.meta[d];if(void 0!==c.symresults){if(a.definition&&a.eden_definition){var f=a.eden_definition;if(/^proc\s/.test(f))return;if(/^func\s/.test(f))return;if("function"==typeof a.cache.value)return}else if("function"==typeof a.cache.value)return;if((b||void 0===e)&&(c.meta[d]=new SymbolMeta(a),e=c.meta[d]),e.update(c),0==e.isinteresting&&(c.interesting.sort(function(a,b){return b.interestingness-a.interestingness}),e.interestingness>=c.minInteresting())){c.interesting.length;if(c.interesting.length==c.limitInteresting){
var g=c.interesting[c.interesting.length-1];g.isinteresting=!1,c.interesting.pop()}c.interesting.push(e),e.isinteresting=!0,e.significance*=SymbolMeta.SigInterestingRate,c.interesting.sort(function(a,b){return b.interestingness-a.interestingness})}}},a.eden.root.addGlobal(e),a.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:a.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),b()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return this.interesting.length>0?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return this.interesting.length>0?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var a=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==a.editing&&(a.editing=!1,a.element.find("textarea").remove(),a.element.animate({height:"20px"},"fast"))}).click(function(){if(!a.editing){var b;b="function"==typeof a.symbol.value()&&void 0!==a.symbol.eden_definition?a.symbol.eden_definition:a.symbol.definition?a.symbol.eden_definition+";":a.name+" = "+Eden.edenCodeForValue(a.symbol.value())+";",a.element.animate({height:"60px"},{duration:200,complete:function(){var c=$('<textarea class="mine_edit_box" style="display: none"></textarea>');c.val(b),c.appendTo(a.element),c.show("fast")}}),a.editing=!0}}).draggable({distance:40,axis:"x",scroll:!1,drag:function(b,c){c.position.left>150?a.dodelete=!0:a.dodelete=!1},revert:function(b,c){return!a.dodelete},stop:function(b,c){a.dodelete&&(a.meta.significance*=SymbolMeta.SigDeleteRate,a.symbolChanged(a.symbol,!1),a.element.hide("drop",{direction:"right"},"slow",function(){a.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(a,b){if(void 0!==this.symbol){0==b&&(b=1);var c,d=(this.meta.interestingness-a)*(1/(b-a)),e=Math.round(8+12*d),f=this.symbol.value(),g=_formatFramerVal(f);c=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name;var h="<span>"+c+"</span><span class='result_separator'> = </span> <span class='result_value'>"+g+"</span>";if(void 0!==this.symbol.definition){var i=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);i=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+i+";</pre>"),h="<span onmouseenter='EdenUI.showTooltip(event, \""+i+"\")' onmouseleave='EdenUI.closeTooltip()'>"+h+"</span>"}var j=this.element.find(".observable");j.html(h),j.css({"font-size":e+"px"})}},EdenUI.plugins.ScriptGenerator=function(a,b){function c(a,b){for(var c=a.length;b>c;c++)a+=" ";return a}var d=this;this.createDialog=function(b,c){var d,f=b.slice(0,-7),g=$('<div class="script-generator"></div>'),h=$("<div></div>");g.append(h);var i=$('<div class="script-generator-controls"></div>');h.append(i);var j=$('<div class="script-generator-controls" style="float: right"></div>');h.append(j);var k=$('<textarea class="script-generator-code" readonly="readonly" spellcheck="false"></textarea>');g.append(k);var l=$("<select></select>");i.append(l);var m=$('<input placeholder="excluded symbols"/>');i.append(m);var n=$('<input type="checkbox" />');d=$("<label>Unicode strings</label>"),d.prepend(n),j.append(d);var o=n.get(0);o.checked="false"!==a.getOptionValue("optUnicode");var p=$('<input type="checkbox" />');d=$("<label>Preserve screen layout</label>"),d.prepend(p),j.append(d);var q=p.get(0),r=$("<button>Regenerate Script</button>");j.append(r);var s=function(){l.html('<option value="">Working Script</option>');for(var b=a.eden.getAllIncludedURLs(),c=0;c<b.length;c++){var d,e=b[c],f=/([^/]+)\.(js)?(-?e)?$/.exec(e);null===f&&(f=/([^/]*)\/?$/.exec(e)),d=f[1],"run"==d&&(f=/(^|\/)([^/]*)\/[^/]*$/.exec(e),null!==f&&(d=f[2]+"/run"));var g=$('<option value="'+e+'">'+d+"</option>");l.append(g)}},t=function(){var b=a.regExpFromStr(m);k.html(e(b,o.checked,q.checked,f))};l.on("change",function(a){var b=a.target.value;return""==b?void t():void $.ajax({url:b,dataType:"text",success:function(a){k.html(a)}})}),m.on("keyup",t),n.on("change",function(b){a.setOptionValue("optUnicode",b.target.checked),t(b)}),p.on("change",t),r.click(function(){s(),t()}),s(),t(),$('<div id="'+b+'"></div>').html(g).dialog({title:c,width:790,height:700,minHeight:120,minWidth:230})};var e=function(a,b,c,e){for(var f=d.generateScriptLines(a,b,c,e),g="",h=0;h<f.length;h++)g=g+Eden.htmlEscape(f[h],!0)+"\n";return g},f={header1:"## This is a JS-EDEN script automatically generated using the environment's script generator feature.",header2:"## JS-EDEN is an open source environment for making construuals based on research, principles and",header3:"## work conducted at University of Warwick.",homePage:"## Web site: https://github.com/EMGroup/js-eden",include:"## Include Files:",autocalcOff:"## Turn off automatic calculation until the construal is fully loaded.",assignments:"## Observable Assignments:",definitions:"## Observable Definitions:",procedures:"## Action Definitions:",functions:"## Function Definitions:",picture:"## Picture Definition:",views:"## View Configuration:",autocalcOn:"## Turn on automatic calculation and execute any triggered actions pending.",impliedByExecute:"## Definitions implied by loading the original script (execute procedure):",impliedOther:"## Definitions implied by loading the original script (other):",end:"## End of automatically generated script."};this.generateScriptLines=function(b,d,e,g){var h=new RegExp("^_view_"+g+"_"),i=["input","picture","projects"],j=[],k=[],l=[],m=[],n=[],o=[],p=[],q="autocalc = 1;",r="autocalc = 0;",s=32,t=Symbol.hciAgent.name,u=root.lookup("picture").eden_definition;if(void 0===u?u="picture is [];":u+=";",void 0===b||!b.test("_views_list")){var v=[];if(e)for(var w in a.activeDialogs)w!=g&&v.push(w);else for(var w in a.activeDialogs)a.views[a.activeDialogs[w]].holdsContent&&v.push(w);for(var x=0;x<i.length;x++){var w=i[x];-1===v.indexOf(w)&&v.push(w)}v.length!=i.length&&p.push('_views_list = ["'+v.join('", "')+'"];')}for(var y in root.symbols){var z=!1;if(void 0===b||!b.test(y)){var A=root.symbols[y],B=!1;if("include"!=A.last_modified_by&&"system"!=A.last_modified_by&&"createView"!=A.last_modified_by&&!/^(autocalc|picture|randomIndex|randomGeneratorState|screenWidth|screenHeight)$/.test(y)&&!(/^(mouse|touch)[A-Z]/.test(y)&&A.last_modified_by===t||/_click(ed)?$/.test(y)&&void 0===A.eden_definition||/^_(View|views)_/.test(y))){if(/^_view_/.test(y)){if(h.test(y))continue;if(!e){if(/_(x|y|width|height|title|zoom)$/.test(y))continue;z=!0;for(var x=0;x<v.length;x++){var w=v[x];if(new RegExp("^_view_"+w+"_").test(y)){z=!1;break}}if(z)continue}B=!0}if(y in this.baseConstrualSymbols){var C=this.baseConstrualSymbols[y];if(A.last_modified_by==C.last_modified_by){var D=void 0;if(void 0!==C.eden_definition?A.eden_definition==C.eden_definition&&void 0!==A.definition&&(D=A.eden_definition+";"):A.cached_value===C.cached_value&&(D=y+" = "+Eden.edenCodeForValue(A.cached_value)+";"),void 0!==D){"execute"==A.last_modified_by?(D="  "+D.replace(/\n/g,"\n"),n.push(D)):(D=c("  "+D.replace(/\n/g,"\n  "),s)+"  ## Set by "+A.last_modified_by+".",o.push(D));continue}}}if(void 0!==A.last_modified_by)if(B)void 0!==A.eden_definition&&void 0!==A.definition?p.push(A.eden_definition+";"):p.push(y+" = "+Eden.edenCodeForValue(A.cached_value)+";");else if(void 0!==A.eden_definition&&void 0!==A.definition)/^func\s/.test(A.eden_definition)?m.push(A.eden_definition):/^proc\s/.test(A.eden_definition)?l.push(A.eden_definition):j.push(A.eden_definition+";");else{var E,F=A.cached_value;if(!d&&"string"==typeof F&&/[^ -~\t\n]/.test(F)){var G=F.replace(/[^ -~\t\n]/g,function(a){return"&#"+a.charCodeAt(0)+";"});E="decodeHTML("+Eden.edenCodeForValue(G)+")"}else E=Eden.edenCodeForValue(F);k.push(y+" = "+E+";")}else o.push(c("  "+y+" = @;",s)+"  ## Referenced but not defined.")}}}void 0===root.lookup("randomSeed").value()||void 0!==b&&b.test("randomIndex")||k.push("randomIndex = "+root.lookup("randomIndex").value()+";");var H=[];H.push(f.header1),H.push(""),H.push(f.header2),H.push(f.header3),H.push(f.homePage),H.push("");var I=eden.getIncludedURLs();if(I.length>0){H.push(f.include);for(var x=0;x<I.length;x++)H.push('include("'+I[x]+'");');H.push("")}H.push(f.autocalcOff),H.push(r),H.push(""),H.push(f.functions);for(var x=0;x<m.length;x++)H.push(m[x]),x!==m.length-1&&H.push("");H.push(""),H.push(f.assignments);for(var x=0;x<k.length;x++)H.push(k[x]);H.push(""),H.push(f.definitions);for(var x=0;x<j.length;x++)H.push(j[x]);H.push(""),H.push(f.procedures);for(var x=0;x<l.length;x++)H.push(l[x]),x!==l.length-1&&H.push("");if(H.push(""),void 0!==b&&b.test("picture")||(H.push(f.picture),H.push(u),H.push("")),p.length>0){H.push(f.views);for(var x=0;x<p.length;x++)H.push(p[x]);H.push("")}if(H.push(f.autocalcOn),H.push(q),H.push(""),n.length>0||o.length>0){if(H.push(f.impliedByExecute),n.length>0){H.push("/*");for(var x=0;x<n.length;x++)H.push(n[x]);H.push("*/")}if(H.push(""),o.length>0){H.push(f.impliedOther),H.push("/*");for(var x=0;x<o.length;x++)H.push(o[x]);H.push("*/"),H.push("")}}return H.push(f.end),H},this.baseConstrualSymbols={},this.changeListener=function(a,b){var c=a.last_modified_by;if(!b&&"include"!=c){var e=a.name.slice(1);void 0!==a.eden_definition&&void 0!==a.definition?d.baseConstrualSymbols[e]={eden_definition:a.eden_definition,last_modified_by:c}:d.baseConstrualSymbols[e]={cached_value:a.cached_value,last_modified_by:c}}},a.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(a,b){root.removeGlobal(d.changeListener)}),this.baseConstrualURL="",a.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:a.viewCategories.history},b()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(a){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(a,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=a)})},function(){"use strict";var a,b=this;a="undefined"!=typeof exports?exports:b.Springy={};var c=a.Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]},d=a.Node=function(a,b){this.id=a,this.data=void 0!==b?b:{}},e=a.Edge=function(a,b,c,d){this.id=a,this.source=b,this.target=c,this.data=void 0!==d?d:{}};c.prototype.addNode=function(a){return a.id in this.nodeSet||this.nodes.push(a),this.nodeSet[a.id]=a,this.notify(),a},c.prototype.addNodes=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=new d(b,{label:b});this.addNode(c)}},c.prototype.addEdge=function(a){var b=!1;return this.edges.forEach(function(c){a.id===c.id&&(b=!0)}),b||this.edges.push(a),a.source.id in this.adjacency||(this.adjacency[a.source.id]={}),a.target.id in this.adjacency[a.source.id]||(this.adjacency[a.source.id][a.target.id]=[]),b=!1,this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===c.id&&(b=!0)}),b||this.adjacency[a.source.id][a.target.id].push(a),this.notify(),a},c.prototype.addEdges=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=this.nodeSet[b[0]];if(void 0==c)throw new TypeError("invalid node name: "+b[0]);var d=this.nodeSet[b[1]];if(void 0==d)throw new TypeError("invalid node name: "+b[1]);var e=b[2];this.newEdge(c,d,e)}},c.prototype.newNode=function(a){var b=new d(this.nextNodeId++,a);return this.addNode(b),b},c.prototype.newEdge=function(a,b,c){var d=new e(this.nextEdgeId++,a,b,c);return this.addEdge(d),d},c.prototype.loadJSON=function(a){("string"==typeof a||a instanceof String)&&(a=JSON.parse(a)),("nodes"in a||"edges"in a)&&(this.addNodes.apply(this,a.nodes),this.addEdges.apply(this,a.edges))},c.prototype.getEdges=function(a,b){return a.id in this.adjacency&&b.id in this.adjacency[a.id]?this.adjacency[a.id][b.id]:[]},c.prototype.removeNode=function(a){a.id in this.nodeSet&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;b>=0;b--)this.nodes[b].id===a.id&&this.nodes.splice(b,1);this.detachNode(a)},c.prototype.detachNode=function(a){var b=this.edges.slice();b.forEach(function(b){try{(b.source.id===a.id||b.target.id===a.id)&&this.removeEdge(b)}catch(c){}},this),this.notify()},c.prototype.removeEdge=function(a){for(var b=this.edges.length-1;b>=0;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency){for(var d in this.adjacency[c]){for(var e=this.adjacency[c][d],f=e.length-1;f>=0;f--)this.adjacency[c][d][f].id===a.id&&this.adjacency[c][d].splice(f,1);0==this.adjacency[c][d].length&&delete this.adjacency[c][d]}j(this.adjacency[c])&&delete this.adjacency[c]}this.notify()},c.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new d(a.id,a.data)))},this),a.edges.forEach(function(a){var c=b[a.from],d=b[a.to],f=a.directed?f=a.type+"-"+c.id+"-"+d.id:c.id<d.id?a.type+"-"+c.id+"-"+d.id:a.type+"-"+d.id+"-"+c.id,g=this.addEdge(new e(f,c,d,a.data));g.data.type=a.type},this)},c.prototype.filterNodes=function(a){var b=this.nodes.slice();b.forEach(function(b){a(b)||this.removeNode(b)},this)},c.prototype.filterEdges=function(a){var b=this.edges.slice();b.forEach(function(b){a(b)||this.removeEdge(b)},this)},c.prototype.addGraphListener=function(a){this.eventListeners.push(a)},c.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var f=a.Layout={};f.ForceDirected=function(a,b,c,d){this.graph=a,this.stiffness=b,this.repulsion=c,this.damping=d,this.nodePoints={},this.edgeSprings={}},f.ForceDirected.prototype.point=function(a){if(!(a.id in this.nodePoints)){var b=void 0!==a.data.mass?a.data.mass:1;this.nodePoints[a.id]=new f.ForceDirected.Point(h.random(),b)}return this.nodePoints[a.id]},f.ForceDirected.prototype.spring=function(a){if(!(a.id in this.edgeSprings)){var b=void 0!==a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);if(d.forEach(function(a){c===!1&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this),c!==!1)return new f.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);if(d.forEach(function(a){c===!1&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this),c!==!1)return new f.ForceDirected.Spring(c.point2,c.point1,0,0);this.edgeSprings[a.id]=new f.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,this.stiffness)}return this.edgeSprings[a.id]},f.ForceDirected.prototype.eachNode=function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})},f.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})},f.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})},f.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,c){if(b!==c){var d=b.p.subtract(c.p),e=d.magnitude()+.1,f=d.normalise();b.applyForce(f.multiply(this.repulsion).divide(e*e*.5)),c.applyForce(f.multiply(this.repulsion).divide(e*e*-.5))}})})},f.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),d=b.normalise();a.point1.applyForce(d.multiply(a.k*c*-.5)),a.point2.applyForce(d.multiply(a.k*c*.5))})},f.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(this.repulsion/50))})},f.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping),c.a=new h(0,0)})},f.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})},f.ForceDirected.prototype.totalEnergy=function(a){var b=0;return this.eachNode(function(a,c){var d=c.v.magnitude();b+=.5*c.m*d*d}),b};var g=function(a,b){return function(){return a.apply(b,arguments)}};a.requestAnimationFrame=g(b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a,c){b.setTimeout(a,10)},b),f.ForceDirected.prototype.start=function(b,c){var d=this;this._started||(this._started=!0,this._stop=!1,a.requestAnimationFrame(function e(){d.applyCoulombsLaw(),d.applyHookesLaw(),d.attractToCentre(),d.updateVelocity(.03),d.updatePosition(.03),void 0!==b&&b(),d._stop||d.totalEnergy()<.01?(d._started=!1,void 0!==c&&c()):a.requestAnimationFrame(e)}))},f.ForceDirected.prototype.stop=function(){this._stop=!0},f.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;return this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();(null===b.distance||f<b.distance)&&(b={node:d,point:e,distance:f})}),b},f.ForceDirected.prototype.getBoundingBox=function(){var a=new h(-2,-2),b=new h(2,2);this.eachNode(function(c,d){d.p.x<a.x&&(a.x=d.p.x),d.p.y<a.y&&(a.y=d.p.y),d.p.x>b.x&&(b.x=d.p.x),d.p.y>b.y&&(b.y=d.p.y)});var c=b.subtract(a).multiply(.07);return{bottomleft:a.subtract(c),topright:b.add(c)}};var h=a.Vector=function(a,b){this.x=a,this.y=b};h.random=function(){return new h(10*(Math.random()-.5),10*(Math.random()-.5))},h.prototype.add=function(a){return new h(this.x+a.x,this.y+a.y)},h.prototype.subtract=function(a){return new h(this.x-a.x,this.y-a.y)},h.prototype.multiply=function(a){return new h(this.x*a,this.y*a)},h.prototype.divide=function(a){return new h(this.x/a||0,this.y/a||0)},h.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},h.prototype.normal=function(){return new h(-this.y,this.x)},h.prototype.normalise=function(){return this.divide(this.magnitude())},f.ForceDirected.Point=function(a,b){this.p=a,this.m=b,this.v=new h(0,0),this.a=new h(0,0)},f.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))},f.ForceDirected.Spring=function(a,b,c,d){this.point1=a,this.point2=b,this.length=c,this.k=d};var i=a.Renderer=function(a,b,c,d){this.layout=a,this.clear=b,this.drawEdge=c,this.drawNode=d,this.layout.graph.addGraphListener(this)};i.prototype.graphChanged=function(a){this.start()},i.prototype.start=function(){var a=this;this.layout.start(function(){a.clear(),a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)}),a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})},i.prototype.stop=function(){this.layout.stop()},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}});var j=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}}.call(this),function(){jQuery.fn.springy=function(a){function b(a,b,c,d){var e=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0===e)return!1;var f=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/e,g=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/e;return 0>f||f>1||0>g||g>1?!1:new Springy.Vector(a.x+f*(b.x-a.x),a.y+f*(b.y-a.y))}function c(a,c,d,e,f){var g,h={x:d.x,y:d.y},i={x:d.x+e,y:d.y},j={x:d.x,y:d.y+f},k={x:d.x+e,y:d.y+f};return(g=b(a,c,h,i))?g:(g=b(a,c,i,k))?g:(g=b(a,c,k,j))?g:(g=b(a,c,j,h))?g:!1}var d=this.graph=a.graph||new Springy.Graph,e=a.stiffness||100,f=a.repulsion||5e3,g=a.damping||.5,h=a.nodeSelected||null,i=this[0],j=i.getContext("2d"),k=this.layout=new Springy.Layout.ForceDirected(d,e,f,g),l=k.getBoundingBox(),m={bottomleft:new Springy.Vector(-2,-2),topright:new Springy.Vector(2,2)};Springy.requestAnimationFrame(function t(){m=k.getBoundingBox(),l={bottomleft:l.bottomleft.add(m.bottomleft.subtract(l.bottomleft).divide(10)),topright:l.topright.add(m.topright.subtract(l.topright).divide(10))},Springy.requestAnimationFrame(t)});var n=function(a){var b=l.topright.subtract(l.bottomleft),c=a.subtract(l.bottomleft).divide(b.x).x*i.width,d=a.subtract(l.bottomleft).divide(b.y).y*i.height;return new Springy.Vector(c,d)},o=function(a){var b=l.topright.subtract(l.bottomleft),c=a.x/i.width*b.x+l.bottomleft.x,d=a.y/i.height*b.y+l.bottomleft.y;return new Springy.Vector(c,d)},p=null,q=null,r=null;jQuery(i).mousedown(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});p=q=r=k.nearest(c),null!==p.node&&(r.point.m=1e4,h&&h(p.node)),s.start()}),jQuery(i).dblclick(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});p=k.nearest(c),node=p.node,node&&node.data&&node.data.ondoubleclick&&node.data.ondoubleclick()}),jQuery(i).mousemove(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});q=k.nearest(c),null!==r&&null!==r.node&&(r.point.p.x=c.x,r.point.p.y=c.y),s.start()}),jQuery(window).bind("mouseup",function(a){r=null}),Springy.Node.prototype.getWidth=function(){var a=void 0!==this.data.label?this.data.label:this.id;if(this._width&&this._width[a])return this._width[a];j.save(),j.font="16px Verdana, sans-serif";var b=j.measureText(a).width+10;return j.restore(),this._width||(this._width={}),this._width[a]=b,b},Springy.Node.prototype.getHeight=function(){return 20};var s=this.renderer=new Springy.Renderer(k,function(){var a=i.parentNode;null!==a&&(i.height=a.clientHeight,i.width=a.clientWidth),j.clearRect(0,0,i.width,i.height)},function(a,b,e){for(var f=n(b).x,g=n(b).y,h=n(e).x,i=n(e).y,k=new Springy.Vector(h-f,i-g),l=k.normal().normalise(),m=d.getEdges(a.source,a.target),o=d.getEdges(a.target,a.source),p=m.length+o.length,q=0,r=0;r<m.length;r++)m[r].id===a.id&&(q=r);var s=0,t=l.multiply(-((p-1)*s)/2+q*s),u=n(b).add(t),v=n(e).add(t),w=a.target.getWidth(),x=a.target.getHeight(),y=c(u,v,{x:h-w/2,y:i-x/2},w,x);y||(y=v);var z,A=void 0!==a.data.color?a.data.color:"#C0C0C0";z="dashes"in a.data?a.data.dashes:[];var B,C,D=void 0!==a.data.weight?a.data.weight:1;j.lineWidth=Math.max(3*D,.1),B=1+j.lineWidth,C=8;var E,F=void 0!==a.data.directional?a.data.directional:!0;E=F?y.subtract(k.normalise().multiply(.5*C)):v,j.strokeStyle=A,j.setLineDash(z),j.beginPath(),j.moveTo(u.x,u.y),j.lineTo(E.x,E.y),j.stroke(),F&&(j.save(),j.fillStyle=A,j.translate(y.x,y.y),j.rotate(Math.atan2(i-g,h-f)),j.beginPath(),j.moveTo(-C,B),j.lineTo(0,0),j.lineTo(-C,-B),j.lineTo(.8*-C,-0),j.closePath(),j.fill(),j.restore()),void 0!==a.data.label&&(text=a.data.label,j.save(),j.textAlign="center",j.textBaseline="top",j.font="10px Helvetica, sans-serif",j.fillStyle="#5BA6EC",j.fillText(text,(f+h)/2,(g+i)/2),j.restore())},function(a,b){var c=n(b);j.save();var e=a.getWidth();a.getHeight();j.fillStyle="#FFFFFF",j.fillRect(c.x-e/2,c.y-10,e,20),j.setLineDash([]),j.textAlign="left",j.textBaseline="top",j.font="16px Verdana, sans-serif";var f=void 0!==a.data.label?a.data.label:a.id,g=root.lookup(f).eden_definition;void 0==g?j.fillStyle="#0000FF":0==g.toString().indexOf("proc")?j.fillStyle="#FF0000":0==g.toString().indexOf("func")?j.fillStyle="#336600":j.fillStyle="#0000FF",d.re.test(f)&&(j.lineWidth=1,j.strokeStyle="#000000",j.strokeRect(c.x-e/2,c.y-10,e,20)),j.fillText(f,c.x-e/2+5,c.y-8),j.restore()});return s.start(),this}}(),EdenUI.plugins.DependencyMap=function(a,b){var c=this;this.createDialog=function(b,d){function e(){var b;b=""==k.value?/^$/:a.regExpFromStr(j,"",m.checked),c.updateGraph(f,b)}var f=void 0;f=new Springy.Graph,f.previousNodes=[],f.previousEdges=[],f.newNodes=[],f.newEdges=[];var g=$('<div id="'+b+'" style="overflow: hidden"></div>'),h=$("<canvas></canvas>").springy({graph:f,nodeSelected:function(a){}});g.append(h);var i=$('<div class="dependency-map-controls"></div>');g.append(i);var j=$('<input type="text" placeholder="search"/>'),k=j.get(0),l=$('<input type="checkbox" checked="checked"/>'),m=l.get(0);i.append(j),i.append($("<label>Exact matches only </label>").append(l)),j.on("input",e),l.on("change",e),g.on("mouseenter",e),g.dialog({title:d,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(a,b){a.re=b,a.newNodes=[],a.newEdges=[];for(var c in root.symbols){var d=root.symbols[c],e=d.name.slice(1);if(b.test(e)){-1==a.newNodes.indexOf(e)&&a.newNodes.push(e);var f=d.dependencies;for(var g in f){var h=f[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!1])}f=d.dynamicDependencies;for(var g in f){var h=f[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!0])}f=d.observees;for(var g in f){var h=f[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!1])}var i=d.subscribers;for(var g in i){var j=i[g],h=j.name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h);var k=d.name in j.dynamicDependencies;a.newEdges.push([e,h,k])}i=d.observers;for(var g in i){var h=i[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([e,h,!1])}}}if(!arrayCompare(a.previousNodes,a.newNodes)||!arrayCompare(a.previousEdges,a.newEdges)){a.previousNodes=a.newNodes,a.previousEdges=a.newEdges,a.filterEdges(function(a){return!1}),a.filterNodes(function(a){return!1}),a.nodeObjectsStore={};for(var c in a.previousNodes){var l=a.previousNodes[c];a.nodeObjectsStore[l]=a.newNode({label:l},{color:"#6A4A3C"})}for(var g in a.previousEdges){var m=a.previousEdges[g][0],n=a.previousEdges[g][1],o={};a.previousEdges[g][2]&&(o.dashes=[10,10]),a.newEdge(a.nodeObjectsStore[m],a.nodeObjectsStore[n],o)}}},a.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:a.viewCategories.comprehension,menuPriority:2},b()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler",EdenUI.plugins.StateTimeLine=function(a,b){var c=this;this.createDialog=function(b,e){c.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+b+'-content" class="st-content"></div>').append($('<input id="'+b+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){c.ST.states.push(d("partial"));var e=document.getElementById(b+"-regex").value;""==e&&(e="State "+c.ST.nextBlankState),$("#"+b+"-content-states").append("<div id='stdiv"+a.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+e+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+a.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+a.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(b+"-regex").value="",a.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+b+'-content-states"></div>')),$dialog=$('<div id="'+b+'"></div>').html(code_entry).dialog({title:e,width:300,height:450,minHeight:120,minWidth:230})},c.ST={},c.ST.states=[],c.ST.nextBlankState=0,this.deleteState=function(a){$(document.getElementById("stdiv"+a)).remove()},this.changeState=function(b){for(var c in root.symbols)Eden.isitSystemSymbol(root.symbols[c].name.substring(1,root.symbols[c].name.length))||a.plugins.StateTimeLine.ignoreRE.test(root.symbols[c].name.substring(1,root.symbols[c].name.length))||delete root.symbols[c];a.plugins.ScriptInput.submitEdenCode(a.plugins.StateTimeLine.ST.states[b])};var d=function(b){var c=[],d=[],e=[],f=[],g="autocalc = 1;",h="autocalc = 0;",i=root.lookup("picture").eden_definition;void 0==i?i="picture is [];":i+=";";for(var j in root.symbols){var k="@",l="",m=5,n=root.symbols[j],o=n.eden_definition;if(void 0==o&&(o=k),0==o.indexOf("proc")){if(l="(Action)",m=2,"partial"==b&&Eden.isitSystemAgent(j))continue}else if(0==o.indexOf("func")){if(l="(Function)",m=1,"partial"==b&&Eden.isitSystemFunction(j))continue}else if(l="(Observable)",m=0,"partial"==b&&Eden.isitSystemObservable(j))continue;var p=Eden.edenCodeForValue(n.cached_value);if(!a.plugins.StateTimeLine.ignoreRE.test(j))if(1==m)f.push(o);else if(0==m){if(p==k&&o==k)continue;o==k?d.push(j+" = "+p+";"):c.push(o+";")}else 2==m?e.push(o):console.log("oh dear error")}var q=[];q.push(h);for(var r=0;r<d.length;r++)q.push(d[r]);for(var r=0;r<c.length;r++)q.push(c[r]);for(var r=0;r<e.length;r++)q.push(e[r]),q.push("");for(var r=0;r<f.length;r++)q.push(f[r]),q.push("");return q.push(i),q.push(g),q.join("\n")};a.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:a.viewCategories.history},b()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(a,b){this.createDialog=function(b,c){var d={confirmClose:!1},e='<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>';return $dialog=$('<div id="'+b+'"></div>').html(e).dialog({title:c,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){function b(b){var c=a.eden.root,d=c.lookup("definitionOf").definition(c)(b);e.send(d)}if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void console.log("WebSockets not supported");var c="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",e=new WebSocket(c);eden.listenTo("executeBegin",this,function(a,b){"net"!=a&&e.send(b)}),eden.listenTo("beforeAssign",this,function(a,b,c){"net"!=c&&e.send(a.name.slice(1)+"="+Eden.edenCodeForValue(b)+";")}),$("#sl-status").html("<p>Connected to: "+c+"</p>"),e.onerror=function(a){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+c+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),d.confirmClose=!1},e.onmessage=function(a){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(a.data)+"</p>"),eden.execute(a.data,"net","",{name:"/execute"},noop)},e.onopen=function(){d.confirmClose=!0,randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):b("randomSeed"),b("randomGenerator")}}),d},a.views.StateListener={dialog:this.createDialog,title:"State Listener",category:a.viewCategories.extension},a.eden.include("plugins/state-listener/state-listener.js-e",b)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(a,b){var c,d=this,e=!1,f=!1;this.createDialog=function(b,d){function e(){
f=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")}function g(){function b(b){var c=a.eden.root,d=c.lookup("definitionOf").definition(c)(b);e.send(JSON.stringify({code:d}))}if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void console.log("WebSockets not supported");var d="ws://"+$("#nr-ipaddr").val()+":"+$("#nr-port").val()+"/",e=new WebSocket(d);Eden.Agent.listenTo("execute",this,function(a,b,c){a&&e.send(JSON.stringify({name:a.name,line:c,code:b}))}),Eden.Agent.listenTo("owned",this,function(a,b){"net"!=b&&e.send(JSON.stringify({name:a.name,owned:a.owned}))}),eden.listenTo("beforeAssign",this,function(a,b,c){"net"!=c&&e.send(JSON.stringify({name:void 0,code:a.name.slice(1)+"="+Eden.edenCodeForValue(b)+";"}))}),$("#nr-status").html("<p>Connected to: "+d+"</p>"),e.onopen=function(c){e.send($("#nr-key").val()),h.confirmClose=!0,randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):b("randomSeed"),b("randomGenerator"),f=!0,$("#connectBtn").attr("value","Disconnect"),$("#nr-ipaddr").attr("disabled","disabled"),$("#nr-port").attr("disabled","disabled"),$("#nr-key").attr("disabled","disabled")},e.onerror=function(a){f=!1,$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled"),$("#connectBtn").attr("value","Connect"),$("#nr-status").html("<p>Error connecting to server - please verify server is running at "+d+". For usage instructions please read the comments in the <a href='plugins/network-remote/network-remote-server.js'>network-remote-server.js</a> file.</p>")},e.onmessage=function(a){c=JSON.parse(a.data);for(var b=0;b<c.length;b++)if(line=c[b].code,line.code){$("#nr-status").html("<p>Received: "+line.code+"</p>");var d=new EdenAST(line.code);Eden.Agent.agents[line.name]?d.script.execute(eden.root,void 0,Eden.Agent.agents[line.name].ast):d.script.execute(eden.root,void 0,d)}else void 0!==line.owned&&(console.log("OWNED BY OTHER: "+line.name+" = "+line.owned),Eden.Agent.agents[line.name]&&Eden.Agent.agents[line.name].setOwned(line.owned,"net"))}}var h={confirmClose:!1},i='<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>';return $dialog=$('<div id="'+b+'"></div>').html(i).dialog({title:d,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){f?e():g()}),h},this.playCode=function(a){if(void 0===c[a])return void $("#nr-status").html("<p>Replay finished</p>");var b=c[a].time/$("#nr-speedrange").val();b>1e3?($("#nr-status").html("<p>Next line in "+b+" milliseconds</p>"),e=!0):e&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(c[a].code,"net","",{name:"/execute"},noop),d.playCode(a+1)},b)},a.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:a.viewCategories.extension},a.eden.include("plugins/network-remote/network-remote.js-e",b)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(a,b){var c="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");var d=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(d);var d=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(d),this.name="window_name",this.createDialog=function(b,d){""==c&&(c=b);var e=[];viewlayoutstr="View Layout";var f=5*a.gridSizeY,g=3*a.gridSizeX,h=[],i=root.lookup("_views_list").value(),j=this.name;i.forEach(function(b){if(b!=j){var c=root.lookup("_view_"+b+"_x").value(),d=root.lookup("_view_"+b+"_y").value();c="undefined"!=typeof c?c:0,d="undefined"!=typeof d?d:0,h=[b,c,d,root.lookup("_view_"+b+"_width").value()+a.scrollBarSize,root.lookup("_view_"+b+"_height").value()+a.titleBarHeight,root.lookup("_view_"+b+"_title").value()],console.log(h),e.push(h)}});var k="";e.forEach(function(a,b){k+='<li data-row="'+Math.round(a[2]/f)+'" data-col="'+Math.round(a[1]/g)+'" data-sizex="'+Math.round(a[3]/(1*g))+'" data-sizey="'+Math.round(a[4]/(1*f))+'" data-name="'+a[0]+'" data-num="'+b+'">'+a[5]+" ["+a[0]+"]</li>"});var l='<a class="vl-update">Update</a><div class="gridster"><ul>'+k+"</ul></div>";$dialog=$('<div id="'+b+'"></div>').html(l).dialog({title:d,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[g,f],widget_margins:[0,0],min_cols:Math.round($(window).width()/g),max_cols:Math.round($(window).width()/g),helper:"clone",resize:{enabled:!0},serialize_params:function(a,b){return{col:b.col,row:b.row,size_x:b.size_x,size_y:b.size_y,name:b.name,name:$(b.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var b=gridster.serialize(),c=1,d=1;b.forEach(function(a,b){a.col<c&&(c=a.col),a.row<d&&(d=a.row)}),b.forEach(function(b,e){var h="_view_"+b.name+"_y = "+(b.row-d)*f+";_view_"+b.name+"_x = "+(b.col-c)*g+";_view_"+b.name+"_width = "+(b.size_x*g-a.dialogFrameWidth)+";_view_"+b.name+"_height = "+(b.size_y*f-a.dialogFrameHeight)+";";console.log(h),eden.execute(h)})})},a.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:a.viewCategories.environment},b()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(a,b){function c(a,b,c){this.edenVar=a,this.guard=b,this.actions=c}function d(a,b,c,d){this.name=a,this.parameters=b,this.definitions=c,this.actionsArr=d}function e(a,b,c){this.name=a,this.definitions=b,this.actionsArr=c,this.queuedActions=new Array}var f=this;this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(a,b,c,d,e){G(a)}}),c.prototype.toString=function(){return this.guard+" --> "+this.actions},d.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};var g=function(a,b){for(var d=new Array,e=0;e<b.length;e++){var f=new String(b[e]),g=f.split("-->");if(2==g.length){var h="this_g"+d.length;d.push(new c(h,g[0],g[1]))}}return d},h=function(a){var b,c=new Array;a.split("(").length<2?b=a:(c=a.split("(")[1].split(")")[0].split(","),b=a.split("(")[0]);var d=document.getElementById("adm-definitions"),e=[];d.value.length>0&&(e=d.value.split("\n"));var d=document.getElementById("adm-actions"),f=d.value.split("\n"),h=g(b,f);return F(b,c,e,h),0},i=function(){for(var a=document.getElementById("adm-name"),b=a.value.split("(")[0],c=!0,d=0;d<f.templates.length;d++){var e=f.templates[d];e.name==b&&(c=!1)}if(b&&c){var g=h(a.value);-1!=g&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",f.currIndex=-1)}else alert("Please enter a unique name for this template."),a.focus()},j=function(a){if(-1>a?a=f.templates.length-1:a>=f.templates.length&&(a=-1),-1==a)document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="";else{var b=f.templates[a];document.getElementById("adm-name").value=b.name,document.getElementById("adm-definitions").value=b.definitions.join("\n"),document.getElementById("adm-actions").value=b.actionsArr.join("\n")}f.currIndex=a},k=function(a){a>-1&&(alert("Deleting template "+f.templates[a].name),f.templates.splice(a),f.currIndex=a-1,j(f.currIndex))},l=function(a){return'<div id="'+a+'-input" class="adm-input-code">			<div>Name:</div>			<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>			<div>Definitions:</div>			<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>			<div>Actions:</div>			<div><textarea id="adm-actions" class="adm-actions"></textarea></div>		</div>		<div id="adm-results" class="entitylist-results">			<ul id="results"> </ul>		</div>'};this.createTemplateCreator=function(a,b){var c=$("<div></div>");c.html(l(a)),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){i()}},{id:"btn-delete",text:"Delete Template",click:function(){k(f.currIndex)}},{text:"Previous",click:function(){j(f.currIndex-1)}},{text:"Next",click:function(){j(f.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};var m=function(a,b){var c=new Array;for(x in b){var d=b[x];c.push(d.replace(/this/g,a))}return c},n=function(a,b){var d=new Array;for(x in b){var e=b[x],f=e.guard.replace(/this/g,a),g=e.actions.replace(/this/g,a),h=e.edenVar.replace(/this/g,a);d.push(new c(h,f,g))}return d},o=function(a,b){a.value="";for(x in b)b[x].value=""},p=function(a){var b;for(x in f.templates)if(f.templates[x].name==a){b=f.templates[x];break}return b},q=function(){for(var a=document.getElementById("template-menu"),b=a.options[a.selectedIndex].value,c=p(b),d=document.getElementById("entity-name"),e=d.value,g=!0,h=0;h<f.entities.length;h++){var i=f.entities[h];i.name==e&&(g=!1)}if(0==g)return void alert("please enter a unique name for this instantiation");var j=$("#instantiate-params"),k=j.find("input"),l=0,n=new Array;for(x in k){var q=k[x];if("text"==q.type){var s=D(c.parameters[l]),t=D(q.value);n.push(q),eden.executeEden(e+"_"+s+" is "+t+";"),l++}}var v=m(e,c.definitions),w=r(e,v);-1!=w&&(u(e,v,c.actionsArr),alert("Successfully added instantiation of "+b+" as "+e),o(d,n))},r=function(a,b){a=D(a);for(var c=0;c<b.length;c++){var d=D(b[c]);eden.executeEden(a+"_"+d),f.definitions.push(a+"_"+d)}};this.createInstantiator=function(a,b){var c=$("<div></div>");c=$('<div id="template-instantiator">					<div>Templates:</div>					<div>						<select id="template-menu">						</select>					</div>					<div>Entity name:</div>					<div>						<textarea id="entity-name"></textarea>					</div>					<div>Parameters:</div>					<div id="instantiate-params"></div>				</div>'),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){q()}}]}),f.templateList=new EdenUI.plugins.ADM.TemplateList;for(x in f.templates){var d=f.templates[x];f.templateList.addTemplate(d.name,d.parameters)}};var s=function(a){var b,c;for(x in f.entities)if(f.entities[x].name==a){b=f.entities[x],c=x;break}if(null==b)return void alert(a+" doesn't exist to delete.");f.entities.splice(c,1);for(x in f.actionLists)if(f.actionLists[x].entityName==a){c=x,f.actionLists[x].remove();break}null!=f.actionLists&&f.actionLists.splice(c,1),null!=f.entityList&&f.entityList.removeEntity(a)},t=function(a,b,c){var d=p(a);if(null==d)return alert("no template with name "+a),-1;for(x in f.entities)if(f.entities[x].name==c)return alert("Please enter a unique entity name"),-1;if(""==b)var e=[];else if(-1==b.indexOf(","))var e=[b];else var e=b.split(",");if(e.length!=d.parameters.length)return alert("not enough parameters to instantiate "+d),-1;for(x in e){var g=D(d.parameters[x]),h=D(e[x]);eden.executeEden(c+"_"+g+" is "+h+";")}var i=m(c,d.definitions),j=r(c,i);return-1!=j&&u(c,i,d.actionsArr),j},u=function(a,b,c){var d=n(a,c),g=new e(a,b,d);f.entities.push(g);for(x in d){var h=d[x],i=h.edenVar+" is "+h.guard+";";eden.executeEden(i)}if(null!=f.actionLists){var j=new EdenUI.plugins.ADM.ActionsList(a);f.actionLists.push(j),w(g,j)}null!=f.entityList&&f.entityList.addEntity(a,b,d)},v=function(){for(x in f.selectedActions){var b=f.selectedActions[x];if(b=D(b),945==b.charCodeAt(0))if("r"==b[2]){var c=b.split("(")[1];c=c.substring(0,c.length-1),s(c)}else if("i"==b[2]){var d=b.split("(")[1],e=b.split("(")[2].split(")")[0],c=b.split("as")[1],g=t(d,e,c);if(-1==g)break}else alert("Action on another entity must one of α_remove(entity_name), α_r, α_instantiate(template(param_value) as entity_name) or α_i");else eden.executeEden(b+";")}f.selectedActions=new Array,a.plugins.ADM.refreshHumanPerspective()};this.actionPush=function(a){f.selectedActions.push(a)},this.actionRemove=function(a){var b=new Array;for(x in f.selectedActions){var c=f.selectedActions[x];c!=a&&b.push(c)}f.selectedActions=b},this.refreshHumanPerspective=function(){for(x in f.entities){var a,b=f.entities[x];for(y in f.actionLists){var c=f.actionLists[y];if(c.entityName==b.name){a=c;break}}a.clear();var d=[];for(x in b.queuedActions){var e=b.queuedActions[x].split(";"),g=e[0];if(g.length>0){e.splice(0,1);var h=!0;e[0].length>0&&(d.push(e.join(";")),h=!1),a.addAction(g,h)}}b.queuedActions=d,w(b,a)}};var w=function(a,b){for(var c=0;c<a.actionsArr.length;c++){var d=a.actionsArr[c],e=eden.root.lookup(d.edenVar).value();if(e===!0){var f=d.actions.split(";"),g=f[0],h=!0;f.splice(0,1),f[0].length>0&&(a.queuedActions.push(f.join(";")),h=!1),b.addAction(g,h)}}};this.createHumanPerspective=function(b,c){var d=$("<div></div>");d=$('<div id="human-perspective" class="actionlist"></div>'),$dialog=$('<div id="'+b+'"></div>').html(d).dialog({title:c,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){a.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){v()}}]}),f.actionLists=new Array;for(x in f.entities){var b=f.entities[x].name;f.actionLists.push(new EdenUI.plugins.ADM.ActionsList(b))}a.plugins.ADM.refreshHumanPerspective()};var z=function(){for(x in f.selectedEntities)s(f.selectedEntities[x]);alert("Entities successfully deleted."),f.selectedEntities=new Array};this.entityPush=function(a){f.selectedEntities.push(a)},this.entityRemove=function(a){var b=new Array;for(x in f.selectedEntities){var c=f.selectedEntities[x];c!=a&&b.push(c)}f.selectedEntities=b};var A=function(){return'<div id="entity-list" class="instance-list"></div>'};this.createInstanceList=function(a,b){var c=$("<div></div>");c.html(A()),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){z()}}]}),f.entityList=new EdenUI.plugins.ADM.EntityList;for(x in f.entities){var d=f.entities[x];f.entityList.addEntity(d.name,d.definitions.join("\n"),d.actionsArr.join("\n"))}};var B=function(a){var b=a.split(":")[1];return D(b.split("(")[0])},C=function(a){var b=a.split(":")[1].split("(")[1];return b.length>1?b.split(")")[0].split(","):[]},D=function(a){for(;32==a.charCodeAt(0)||9==a.charCodeAt(0);)a=a.substring(1,a.length);for(;32==a.charCodeAt(a.length-1)||9==a.charCodeAt(a.length-1);)a=E(a);return a},E=function(a){return a.substring(0,a.length-1)},F=function(a,b,c,e){for(x in f.templates)if(f.templates[x].name==a)return alert("Templates must have unique names."),-1;var h=g(a,e),i=new d(a,b,c,h);return f.templates.push(i),null!=f.templateList&&f.templateList.addTemplate(a,b),1},G=function(a){var b,c=a.split("\n"),d=new Array,e=new Array,f=new Array,g=!1,h=!1,i=!1;for(x in c){var j=c[x];if(j=D(j),""!=j)if(0==i)if("{"==j[0])i=!0,-1!=j.indexOf("name:")&&(b=B(j),d=C(j));else{var k=j.split("(")[0],l=j.split("(")[1].split(")")[0],m=E(D(j.split("as")[1])),n=t(k,l,m);if(-1==n)break}else if(1==g){var o=j.indexOf("}");-1!=o&&(j=E(j),g=!1),j.length>0&&e.push(j)}else if(1==h){var o=j.indexOf("}");-1!=o&&(j=E(j),h=!1),j.length>0&&f.push(j)}else if("}"==j[0]){i=!1;var n=F(b,d,e,f);if(b="",d=new Array,e=new Array,f=new Array,-1==n)return}else if(-1!=j.indexOf("name:"))b=B(j),d=C(j);else if(-1!=j.indexOf("definitions:")||-1!=j.indexOf("defs:")){if(g=!0,j=D(j),j.split("{").length>1){var p=D(j.split("{")[1]);-1!=p.indexOf("}")&&(p=E(p),g=!1),p.length>0&&e.push(p)}}else if(-1!=j.indexOf("actions:")&&(h=!0,j=D(j),j.split("{").length>1)){var p=D(j.split("{")[1]),o=p.indexOf("}");-1!=o&&(p=E(p),h=!1),p.length>0&&f.push(p)}}};this.createAdvancedInput=function(a,b){var c=document.createElement("textarea");c.style.boxSizing="border-box",c.style.width="100%",c.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(c),$dialog=$('<div id="'+a+'"></div>').html($code_entry).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var a=c.value;G(a),c.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},a.addViewCategory("adm","Abstract Definitive Machine"),a.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:a.viewCategories.adm},a.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:a.viewCategories.adm},a.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:a.viewCategories.adm},a.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:a.viewCategories.adm},a.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:a.viewCategories.adm},b()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(a,b){var c=new EdenUI.plugins.ADM.Template(a,b);c.element.appendTo(this.templateList),this.templates.push(c)},EdenUI.plugins.ADM.Template=function(a,b){this.template=a,this.element=$("<option value="+a+">"+a+"</option>");var c=this.showParamInput;this.element.click(function(){c(b)});var d=document.getElementById("instantiate-params");""==d.innerHTML&&c(b)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(a){var b=document.getElementById("instantiate-params");b.innerHTML="";for(x in a){var c=a[x],d=document.createElement("label");d.innerHTML=c+":",b.appendChild(d);var e=document.createElement("input");e.type="text",b.appendChild(e);var f=document.createElement("br");b.appendChild(f)}},EdenUI.plugins.ADM.ActionsList=function(a){var b=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+a),this.actionresults.innerHTML="<label><b>Actions for "+a+":</b></label>",b.appendChild(this.actionresults),this.actions=new Array,this.entityName=a},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(a,b){var c=new EdenUI.plugins.ADM.Action(a,b);c.element.appendTo(this.actionresults),this.actions.push(c)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){var a=document.getElementById("human-perspective");a.removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(a,b){var a=a;this.action=a,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var c=!1;this.element.hover(function(){0==c?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==c?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){0==c?(edenUI.plugins.ADM.actionPush(a),$(this).css("backgroundColor","#6666CC"),c=!0):(edenUI.plugins.ADM.actionRemove(a),$(this).css("backgroundColor","white"),c=!1)}),this.update(b)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(a){var b='<li class="type-function"><span class="result_name">';b=1==a?b+this.action+"</span></li>":b+this.action+" ... </span></li>",this.element.html(b)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(a,b,c){var d=new EdenUI.plugins.ADM.Entity(a,b,c);d.element.appendTo(this.entityList),this.entities.push(d)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(a){var b;for(x in this.entities)if(this.entities[x].entity==a){b=x;break}this.entities.splice(b,1);var c=document.getElementById("element-"+a);this.entityList.removeChild(c)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(a,b,c){this.entity=a,this.element=$('<div class="entitylist-element" id=element-'+a+"></div>");var d='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(d);var b=b,c=c,e=!1;this.element.hover(function(){0==e?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==e?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){if(this.innerHTML==d){var f=document.createElement("div");f.innerHTML="<label>Definitions:</label><br>					<textarea disabled>"+b+"</textarea><br>					<label>Actions:</label><br>					<textarea disabled>"+c+"</textarea><br>",this.appendChild(f),edenUI.plugins.ADM.entityPush(a),$(this).css("backgroundColor","#6666CC"),e=!0}else this.innerHTML=d,edenUI.plugins.ADM.entityRemove(a),$(this).css("backgroundColor","white"),e=!1})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var a='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(a)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.SpeechSynthesis=function(a,b){function c(){var a=window.speechSynthesis.paused;window.speechSynthesis.cancel(),a&&window.speechSynthesis.pause()}function d(a,b){if(f)return void(f=!1);var e,g=root.lookup("speak"),h=root.lookup("speakingList"),i=root.lookup("speakingIndex"),j=root.lookup("speaking"),k=root.lookup("speakingID"),l=root.lookup("speakingText"),m=root.lookup("speakingSpeech"),n=root.lookup("speakingCharIndex"),o=h.value(),p=i.value();if(c(),p||(p=1),""!=a){if("finished"==a){var q=l.value();"string"==typeof q&&n.assign(q.length+1,g)}else"interrupted"==a&&(f=!0);e=k.value(),eden.isValidIdentifier(e)&&root.lookup(e+"_status").assign(a,g)}if(b&&p++,n.assign(1,g),root.lookup("speakingTime").assign(0,g),Array.isArray(o)&&p<=o.length){j.value()||j.assign(!0,g);var r=o[p-1];if(!(r instanceof SpeakingWords)||r.cancelled)return void d("",!0);r.prepareUtterance();var s=r.utterance;e=r.id,k.assign(e,g),eden.isValidIdentifier(e)&&root.lookup(e+"_status").assign("speaking",g),l.assign(s.text,g),m.assign(r,g),b&&i.assign(p,g),r.hasBeenSpoken=!0,window.speechSynthesis.speak(s)}else j.assign(!1,g),k.assign("",g),l.assign("",g),m.assign(void 0,g),Array.isArray(o)&&i.assign(o.length+1,g)}function e(a,b){var c,d,e,f,g=window.speechSynthesis.getVoices();a&&(a=a.toLowerCase(),d=a.indexOf("-"),-1!=d?(e=a.slice(0,d),f=!0):(e=a,f=!1)),b&&(c=new RegExp("\\b"+b+"\\b","i"));for(var h=void 0,i=!1,j=!1,k=!1,l=!1,m=0;m<g.length;m++){var n=g[m],o=n.lang,p=!1,q=!1,r=!1;if(a&&o&&(o=o.toLowerCase(),a==o?(p=!0,q=!0):e==o?p=!0:(d=o.indexOf("-"),-1!=d&&o.slice(0,d)==e&&(p=!0))),b&&c.test(n.name)&&(r=!0),(!j&&!o&&!i||!j&&(!o||!a)&&n["default"]||p&&!j||f&&q&&!k||p&&!f&&n["default"]||q&&n["default"]||r&&!l&&(!a||!o&&!j||p))&&(!l||r||p&&!j)){if(i=!p,j=p,k=q,l=r,(!b||l)&&(k||j&&!f)&&n["default"])return n;h=n}}return void 0===h&&(h=g[0]),h}var f=!1;root.lookup("speakingList").addJSObserver("sendToTTS",function(a,b){var c=root.lookup("speak");if(Array.isArray(b)){var e=root.lookup("speakingIndex"),f=e.value();if(f>b.length+1)e.assign(b.length+1,c);else if(f<=b.length){for(var g=1>f?0:f-1;g<b.length;g++){var h=b[g];if(h instanceof SpeakingWords){h.prepareUtterance();var i=h.id;eden.isValidIdentifier(i)&&root.lookup(i+"_status").assign("waiting",c)}}root.lookup("speaking").value()?b[f-1]!==root.lookup("speakingSpeech").value()&&d("interrupted",!1):d("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(a,b){if("speak"!=a.last_modified_by){var c=root.lookup("speakingList").value();if(Array.isArray(c)&&b<=c.length){root.lookup("speaking").value()?d("interrupted",!1):d("",!1);for(var e=b;e<c.length;e++)c[e]instanceof SpeakingWords&&c[e].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(a,b){b?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(b,c,f,g,h,i,j){this.id=b,this.utterance=new window.SpeechSynthesisUtterance(String(c));var k,l,m,n,o,p,q;this.hasBeenSpoken=!1,void 0===g?(p=a.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===p&&(p="native"),m=!0):(p=g,m=!1),this.utterance.volume=h,void 0===i?(k=a.getOptionValue("speechSynthDefaultRate"),null!==k&&(this.utterance.rate=parseFloat(k)),n=!0):(this.utterance.rate=i,n=!1),void 0===j?(k=a.getOptionValue("speechSynthDefaultPitch"),null!==k&&(this.utterance.pitch=parseFloat(k)),o=!0):(this.utterance.pitch=j,o=!1);var r=this;if(Object.defineProperty(this,"text",{get:function(){return r.utterance.text},set:function(a){r.utterance.text=a},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return r.utterance.lang},set:function(a){if(a){var b=a.indexOf("-");-1!=b&&(a=a.slice(0,b+1)+a.slice(b+1).toUpperCase()),r.utterance.lang=a}else r.utterance.lang="";l=!1;var c=e(a,p);r.utterance.voiceURI=c.voiceURI,r.utterance.voice=c},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return p},set:function(a){p=a,m=!1;var b=e(this.utterance.lang,p);r.utterance.voiceURI=b.voiceURI,r.utterance.voice=b},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return r.utterance.volume},set:function(a){r.utterance.volume=a},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return r.utterance.rate},set:function(a){r.utterance.rate=a,n=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return r.utterance.pitch},set:function(a){r.utterance.text=a,o=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return q},set:function(a){q=a,q&&r.id&&root.lookup(r.id+"_status").assign("cancelled",{name:"/SpeakingWords"})},enumerable:!0}),this.toString=function(){var a="SpeakingWords("+Eden.edenCodeForValue(b)+', "'+r.utterance.text+'", ';return l?a+="@, ":a=a+'"'+r.utterance.lang+'", ',m?a+="@, ":a=a+Eden.edenCodeForValue(p)+", ",a=a+r.utterance.volume+", ",n?a+="@, ":a=a+this.utterance.rate+", ",o?a+="@)":a=a+this.utterance.pitch+")",a},void 0===f?(this.lang=a.getOptionValue("speechSynthDefaultLanguage"),l=!0):this.lang=f,eden.isValidIdentifier(b)){var s=root.lookup(b+"_status");void 0===s.value()&&s.assign("not queued",{name:"/speakingWords"})}this.prepareUtterance=function(){if(r.hasBeenSpoken&&!("chrome"in window)){var a=new window.SpeechSynthesisUtterance(r.utterance.text);a.lang=r.utterance.lang,a.volume=r.utterance.volume,a.rate=r.utterance.rate,a.pitch=r.utterance.pitch,a.voiceURI=r.utterance.voiceURI,a.voice=r.utterance.voice,a.onboundary=r.utterance.onboundary,a.onend=r.utterance.onend,a.onerror=r.utterance.onerror,r.utterance=a,r.hasBeenSpoken=!1}},this.utterance.onboundary=function(a){var b={name:"/speak"};root.lookup("speakingCharIndex").assign(a.charIndex+1,b);var c=a.elapsedTime;1e7>=c&&root.lookup("speakingTime").assign(c,b)},this.utterance.onend=function(){d("finished",!0)},this.utterance.onerror=function(){d("error",!0)}},a.eden.include("plugins/speech-synthesis/speech-synthesis.js-e",b)},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!";