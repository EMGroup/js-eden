function getCaretCharacterOffsetWithin(a){var b,c=0,d=a.ownerDocument||a.document,e=d.defaultView||d.parentWindow;if("undefined"!=typeof e.getSelection){if(b=e.getSelection(),b.rangeCount>0){var f=e.getSelection().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.endContainer,f.endOffset),c=g.toString().length}}else if((b=d.selection)&&"Control"!=b.type){var h=b.createRange(),i=d.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),c=i.text.length}return c}function getStartCaretCharacterOffsetWithin(a){var b,c=0,d=a.ownerDocument||a.document,e=d.defaultView||d.parentWindow;if("undefined"!=typeof e.getSelection){if(b=e.getSelection(),b.rangeCount>0){var f=e.getSelection().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.startContainer,f.startOffset),c=g.toString().length}}else if((b=d.selection)&&"Control"!=b.type){var h=b.createRange(),i=d.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),c=i.text.length}return c}function get_time_diff(a){var b=1e3*a,c=Date.now();if(isNaN(b))return"";if(c>b)var d=c-b;else var d=b-c;var e=Math.floor(d/1e3/60/1440),f=new Date(d);if(e>5)return"";var g="";if(e>0)g+=e,g+=e>1?" days ago":" day ago";else if(f.getHours()>0){var h=f.getHours();g+=h,g+=h>1?" hours ago":" hour ago"}else{var i=f.getMinutes();if(i>0)g+=i,g+=i>1?" minutes ago":" minute ago";else{var j=f.getSeconds();g+=j,g+=" seconds ago"}}return g}function changeClassString(a,b,c){var d=a.split(" "),e=d.indexOf(b);if(-1==e){if(c)return d.push(b),d.join(" ")}else if(!c)return d.splice(e,1),d.join(" ");return a}function changeClass(a,b,c){var d=changeClassString(a.className,b,c);d!=a.className&&(a.className=d)}function EdenScriptGutter(a,b){function c(a,b,c,d){"warning"==c?l.innerHTML="<div class='info-warnitem'><span>"+d+"</span></div>":"error"==c&&(l.innerHTML="<div class='info-erroritem'><span>"+d+"</span></div>"),$info=$(l),$info.css("top",""+b+"px"),$info.css("left",""+a+"px"),$(l).show("fast")}function d(){console.log("GUTTER HOLD"),f=void 0;for(var a=0;a<e.lines.length;a++)e.lines[a].selected&&(changeClass(e.gutter.childNodes[a],"select",!1),changeClass(e.gutter.childNodes[a],"live",!0),e.lines[a].selected=!1,e.lines[a].live=!0)}var e=this;this.$gutter=$('<div class="eden-gutter"></div>'),this.gutter=this.$gutter.get(0),a.insertBefore(this.gutter,a.firstChild),this.ast=void 0,this.lines=[],this.agents={};var f,g,h=!1,i=0,j=!1,k=!1,l=b;this.$gutter.on("mousedown",".eden-gutter-item",function(a){if(!e.ast.hasErrors()){var b=parseInt(a.target.getAttribute("data-line"));if(g=a.shiftKey,i=b,j=e.lines[b]?e.lines[b].selected:!1,h=!0,k=e.lines[b]&&e.lines[b].live,e.ast.lines[b]){var c=e.ast.getBlockLines(b);if(e.lines[b].live&&!g)if(e.lines[b].selected)for(var l=0;l<e.lines.length;l++)e.lines[l].selected&&(e.lines[l].live=!1,changeClass(e.gutter.childNodes[l],"live",!1));else for(var l=c[0];l<=c[1];l++)e.lines[l].live=!1,changeClass(e.gutter.childNodes[l],"live",!1);else for(var l=c[0];l<=c[1];l++)g?e.lines[l].selected=!e.lines[l].selected:e.lines[l].selected=!0,changeClass(e.gutter.childNodes[l],"select",e.lines[l].selected),changeClass(e.gutter.childNodes[l],"hover",!1)}f=setTimeout(d,1e3)}}).on("click",".eden-gutter-item",function(a){var b=parseInt(a.target.getAttribute("data-line"));if(e.ast.lines[b]&&e.ast.lines[b].errors.length>0){var d=e.ast.lines[b].errors[0];if(d.line==b+1||"runtime"==d.type){var f=35;console.error(d.prettyPrint()),c(a.target.offsetLeft+20,a.target.offsetTop-e.gutter.parentNode.scrollTop+25+f,"error",d.messageText())}}}).on("mouseup",".eden-gutter-item",function(a){if(!e.ast.hasErrors()&&!g){var b=parseInt(a.target.getAttribute("data-line"));if(!(e.ast.lines[b]&&e.ast.lines[b].errors.length>0||e.lines[b].live||k)&&(e.executeSelected(),!j&&e.ast.lines[i]))for(var c=e.ast.getBlockLines(i),d=c[0];d<=c[1];d++)e.lines[d].selected=!1,changeClass(e.gutter.childNodes[d],"select",!1)}clearTimeout(f),f=void 0,h=!1}).on("mouseenter",".eden-gutter-item",function(a){if(!e.ast.hasErrors()){var b=parseInt(a.target.getAttribute("data-line"));if(g&&h){if(e.ast.lines[b])for(var c=e.ast.getBlockLines(b),d=c[0];d<=c[1];d++)e.lines[d].selected=!j,changeClass(e.gutter.childNodes[d],"select",!j),changeClass(e.gutter.childNodes[d],"hover",!1)}else if(e.ast.lines[b]){e.lines[b].live||changeClass(e.gutter.childNodes[b],"play",!0);for(var c=e.ast.getBlockLines(b),d=c[0];d<=c[1];d++)changeClass(e.gutter.childNodes[d],"hover",!0)}}}).on("mouseleave",".eden-gutter-item",function(a){var b=parseInt(a.target.getAttribute("data-line"));if(h&&!g&&(e.lines[b].selected=!j,changeClass(e.gutter.childNodes[b],"select",!j),changeClass(e.gutter.childNodes[b],"hover",!1),changeClass(e.gutter.childNodes[b],"play",!1)),h&&(g=!0),clearTimeout(f),f=void 0,e.ast.lines[b])for(var c=e.ast.getBlockLines(b),d=c[0];d<=c[1];d++)changeClass(e.gutter.childNodes[d],"hover",!1),changeClass(e.gutter.childNodes[d],"play",!1)})}function _formatVal(a){var b=Eden.prettyPrintValue("",a,200,!1,!1);switch(typeof a){case"boolean":return"<span class='special_text'>"+b+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+b+"</span>";case"number":return"<span class='numeric_text'>"+b+"</span>";default:return b}}function _formatFramerVal(a){var b=Eden.prettyPrintValue("",a,200,!1,!1);switch(typeof a){case"boolean":return"<span class='special_text'>"+b+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+b+"</span>";case"number":return"<span class='numeric_text'>"+b+"</span>";default:return b}}CSSUtil={},CSSUtil.setStyle=function(a,b){function c(a,b){return"-"+b.toLowerCase()}var d=a.style;if(void 0===b)d.cssText="";else if("object"==typeof b){var e=/([A-Z])/g,f=/^\w*[A-Z]\w*$/,g="";for(var h in b)if("string"==typeof b[h]){var i;i=f.test(h)?h.replace(e,c):h,g=g+i+": "+b[h]+";\n"}d.cssText=g}else d.cssText=b},"time"in console||(console.time=function(a){},console.endTime=function(a){}),EdenUI.plugins.ScriptInput=function(a,b){function c(a,b){this.script=b,this.timestamp=Date.now(),this.agent=a}function d(a){for(var b="",c=0;c<f.length;c++)b+="/* Agent: "+f[c].agent+" at "+f[c].timestamp+" */\n",b+=f[c].script,b+="\n\n";var d=new Eden.AST(b),e=new EdenUI.Highlight(a);e.highlight(d,-1,-1),a.scrollTop=a.scrollHeight}EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var e=this,f=({name:Symbol.getInputAgentName()},[]),g=void 0;Eden.Agent.listenTo("executeline",this,function(a,b){if(a&&a.ast){var e=a.ast.lines[b];if(e){var h=a.ast.getBase(e);f.push(new c(a.name,a.ast.getSource(h))),g&&d(g)}}}),this.createHistory=function(a,b){historydialog=$('<div id="'+a+'"></div>').html('<div class="history readonly"></div>').dialog({title:b,width:500,height:500,minHeight:300,minWidth:300,dialogClass:"history-dialog",close:function(){g=void 0}}).find(".history"),g=historydialog.get(0),d(historydialog.get(0))},$(document.body).delegate(null,"drop",function(b){var c=b.originalEvent.dataTransfer.getData("agent");if(!c||""==c)return console.log(b.originalEvent.dataTransfer.files),void b.preventDefault();var d=c.split("/"),e=d.join("");eden.root.lookup("_view_"+e+"_tabs").assign([c],eden.root.scope),a.createView(e,"ScriptInput"),eden.root.lookup("_view_"+e+"_agent").assign(c,eden.root.scope)}).delegate(null,"dragover",function(a){a.preventDefault()}),this.createCommon=function(a,b,c,d){function e(a){var b=a.getAttribute("data-name");Eden.Agent.agents[b]&&(Eden.Agent.agents[b].execute(!0),s())}function f(a){var b=a.getAttribute("data-name");Eden.Agent.agents[b]&&(Eden.Agent.agents[b].executed=!1,s())}function g(a){var b=a.getAttribute("data-name"),c=kb.state[ib],d=c.indexOf(b);d>=0&&(c.splice(d,1),d--,0>d&&(d=0),d<c.length&&(kb.state[fb]=c[d]),kb.state[ib]=c),0==c.length&&(kb.state[fb]=void 0)}function h(a){var b=a.getAttribute("data-name");T("uploadAgent",function(a,c,d){Eden.Agent.agents[b]&&a&&(""==c&&(c=void 0),Eden.Agent.agents[b].upload(c,d))})}function i(a){var b=a.getAttribute("data-name");b&&Eden.Agent.importAgent(b,"default",["reload"],function(){})}function j(a,b,c){var d=$('<div class="options-menu-item"><span class="options-menu-icon">'+a+"</span><span>"+b+"</span></div>");Ia.append(d),d.click(c)}function k(){Ia.hide("slide",{direction:"down"},200)}function l(){for(;Ja.firstChild;)Ja.removeChild(Ja.firstChild);j(kb.state[gb]?"&#xf00c;":"&#xf00d;",Language.ui.input_window.show_tabs,function(a){kb.state[gb]=!kb.state[gb],l()}),j(kb.state[hb]?"&#xf00c;":"&#xf00d;",Language.ui.input_window.show_controls,function(a){kb.state[hb]=!kb.state[hb],l()}),j("&#xf0c0;",Language.ui.input_window.browse_agents,function(a){m(),k()}),j("&#xf21b;",Language.ui.input_window.hide_agent,function(a){var b=kb.state[ib],c=b.indexOf(La.name);c>=0&&(b.splice(c,1),c--,0>c&&(c=0),c<b.length&&(kb.state[fb]=b[c]),kb.state[ib]=b),0==b.length&&(kb.state[fb]=void 0),k()}),j("&#xf1da;",Language.ui.input_window.view_history,function(a){T("showHistory",function(a,b,c){a&&(c!=La.meta.saveID?La.changeVersion(c,function(){La.rollback(b),o()}):La.rollback(b))},La),k()}),j("&#xf0d0;",Language.ui.input_window.insert_temp,function(a){})}function m(){T("browseAgents",function(a,b){if(a){var c=kb.state[ib],d=La?La.name:void 0;for(var e in b)b[e]&&(d=e,Eden.Agent.importAgent(e,"default",["noexec"],function(){}),-1==c.indexOf(e)&&c.push(e));kb.state[ib]=c,kb.state[fb]=d}},kb.state[ib])}function n(){var a=Ga.find(".search-mode");$a?changeClass(a.get(0),"active",!0):changeClass(a.get(0),"active",!1)}function o(){var a=Ga.find(".next-input"),b=Ga.find(".fastforward-input"),c=Ga.find(".rewind-input"),d=Ga.find(".previous-input");Za||!La.canRedo()?(a.removeClass("control-enabled"),b.removeClass("control-enabled")):(a.addClass("control-enabled"),b.addClass("control-enabled")),Za||!La.canUndo()?(d.removeClass("control-enabled"),c.removeClass("control-enabled")):(d.addClass("control-enabled"),c.addClass("control-enabled"))}function p(a,b,c,d,e){var f=document.createElement("div");f.style.left=""+160*e+"px";var g="agent-tab noselect";g+=d?" agent-tab-current":" agent-tab-notcurrent";var h=b.split("/").pop();h.length>18&&(h="..."+h.slice(-15));var i;i=Eden.Agent.agents[b]?Eden.Agent.agents[b].hasErrors()?"tab-icon errored":Eden.Agent.agents[b].executed?"tab-icon executed":"tab-icon":"tab-icon noagent",f.className=g,f.innerHTML="<span class='"+i+"'>&#xf007;</span>"+h,f.draggable=!0,f.setAttribute("data-name",b),a.appendChild(f)}function q(a){a===La&&(u("[saved]"),o())}function r(a,b){if(La&&La.name==a)if(Ya>0&&Ya--,b)x(void 0,b);else{for(var c in Eden.Agent.agents)return void x(void 0,c);x(void 0,void 0)}}function s(){for(;Da.firstChild;)Da.removeChild(Da.firstChild);var a=document.createElement("div");a.className="agent-tableft noselect",Da.appendChild(a);var b=document.createElement("div");b.className="agent-tab-container",Da.appendChild(b);var c=kb.state[ib];if(c&&c instanceof Array){var d=-1;La&&(d=c.indexOf(La.name)),d>Ya+(_a-1)&&(Ya=d-(_a-1)),Ya>d&&(Ya=d);for(var e=0;e<c.length;e++){var f=c[e];Eden.Agent.agents[c[e]]&&(f=Eden.Agent.agents[c[e]].title),e>=Ya&&p(b,c[e],f,La&&c[e]==La.name,e)}}var g=document.createElement("div");g.className="agent-newtab noselect",g.style.left=""+(160*c.length+20)+"px",b.appendChild(g);var h=document.createElement("div");h.className="agent-tabright noselect",Da.appendChild(h)}function t(a){La&&(La.setTitle(a),s());var b=va.get(0).parentNode;b&&(b=b.parentNode,b&&$(b).find(".ui-dialog-title").html(a))}function u(a){if(!d){var b=va.get(0).parentNode;if(b&&(b=b.parentNode)){var c=$(b).find(".ui-dialog-subtitle").get(0);void 0===c&&(c=document.createElement("span"),c.className="ui-dialog-subtitle",$(b).find(".ui-dialog-title").get(0).parentNode.appendChild(c)),La?c.textContent=La.name+" "+a:c.textContent=a}}}function v(b,c){var d="";c&&Eden.Agent.importAgent("view/script/"+a,"default",["noexec","create"],function(b,e){if(void 0===b)return void console.error("Could not create agent: view/script/"+a+"@default: "+e);if(c instanceof Array)for(var f=0;f<c.length;f++)"string"==typeof c[f]?d+=c[f]+"\n":"object"==typeof c[f]&&(d+=c[f].eden_definition+"\n");b.setSource(d,!1,-1),kb.state[fb]="view/script/"+a})}function w(a,b){$.get(b,function(a){ya.value=a,I(La.executed)},"text")}function x(a,b){if(b&&Eden.Agent.agents[b]){if(La&&b==La.name)return;0==Za&&La.setOwned(!1),La=Eden.Agent.agents[b],t(La.title),0==Eden.Agent.agents[b].owned?(La.setOwned(!0),Za=!1,u(""),changeClass(za,"readonly",!1),za.contentEditable=!0):(Za=!0,u("[readonly]"),changeClass(za,"readonly",!0),za.contentEditable=!1),La.ast?(ya.value=La.ast.stream.code,N(La.ast,-1,0),ya.focus()):(ya.value="",ya.focus(),I()),X(),o(),Fa.setAgent(b);var c=kb.state[ib];-1==c.indexOf(b)?(c.push(b),kb.state[ib]=c):s()}else La&&0==Za&&La.setOwned(!1),ya.value="",Za=!0,za.className="outputcontent readonly",za.contentEditable=!1,za.innerHTML="",La=void 0,t(Language.ui.input_window.title),u("[No Agents]"),Fa.clear(),b&&void 0===Eden.Agent.agents[b]&&Eden.Agent.importAgent(b,"default",["noexec"],function(a){a&&x(void 0,b)})}function y(a,b){b?xa.style.top="35px":xa.style.top="0"}function z(a,b){b?(Ha.style.display="inherit",xa.style.bottom="30px"):(Ha.style.display="none",xa.style.bottom="0")}function A(a,b){if(void 0===b||0==b)va.find(".outputcontent, .eden-gutter").css("transform","");else{var c,d,e;0>b?(c=(1/(1+Math.abs(b)/10)).toFixed(2),d=((c-1)/2*100).toFixed(2),e=20*(c-1)):(c=(1+Math.abs(b)/10).toFixed(2),d=((c-1)/2*100).toFixed(2),e=20*(c-1)),va.find(".outputcontent").css("transform","translate("+d+"%,"+d+"%) translate("+e+"px) scale("+c+","+c+")"),va.find(".eden-gutter").css("transform","translate("+d+"%,"+d+"%) scale("+c+","+c+")")}}function B(a,b){La&&La.name==a.name&&"net"==b&&(a.owned?(Za=!0,u("[readonly]"),changeClass(za,"readonly",!0),za.contentEditable=!1):(a.setOwned(!0),Za=!1,changeClass(za,"readonly",!1),za.contentEditable=!0,u("")))}function C(a){kb&&void 0!==kb.state[fb]&&(a.name!=kb.state[fb]||void 0!==La&&a.name==La.name||x(void 0,a.name))}function D(a){kb&&void 0!==kb.state[fb]&&(a.name!=kb.state[fb]||void 0!==La&&a.name==La.name?La&&a.name==La.name&&(ya.value=a.getSource(),N(La.ast,-1,0),o()):x(void 0,a.name))}function E(a){a===La&&(ya.value=La.snapshot,I(!0),o())}function F(a,b,c){a&&La&&a.name===La.name&&Za&&(ya.value=a.snapshot,Ua.ast=La.ast,N(Ua.ast,c,-1))}function G(){var a=-1,b=-1;document.activeElement===ya&&(b=ya.selectionEnd,a=O(ya)),La.setSource(ya.value,!1,a),Ua.ast=La.ast,S(a),N(La.ast,a,b)}function H(){var a=-1,b=-1;document.activeElement===ya&&(b=ya.selectionEnd,a=O(ya)),N(Ua.ast,a,b)}function I(a){if(void 0!==La){La.setSource(ya.value,!1,-1),Ua.ast=La.ast;var b=-1;document.activeElement===ya&&(b=ya.selectionEnd),a&&S(0),N(La.ast,-1,b)}}function J(){$(Aa).hide("fast")}function K(a,b){var c=ya.value.split("\n");c[a]=b,ya.value=c.join("\n")}function L(a){for(var b=a;b.parentNode!==za;)b=b.parentNode;for(var c=0;c<za.childNodes.length;c++)if(za.childNodes[c]===b)return c;return-1}function M(){var a=$(za).find(".fake-caret").get(0);if(void 0!==a){for(var b=wa.get(0),c=a.offsetLeft-b.scrollLeft+25,d=b.clientWidth+b.scrollLeft-a.offsetLeft-25;a.parentNode!=za;)a=a.parentNode;var e=a.offsetTop-b.scrollTop+15,f=b.clientHeight+b.scrollTop-a.offsetTop-15;80>c&&(b.scrollLeft=b.scrollLeft-(80-c)),80>d&&(b.scrollLeft=b.scrollLeft+(80-d)),40>e&&(b.scrollTop=b.scrollTop-(40-e)),40>f&&(b.scrollTop=b.scrollTop+(40-f))}}function N(a,b,c){if(Ua.highlight(a,b,c),Fa.generate(a,b),a.mainDoxyComment&&(-1==b||b>=1&&b<=a.mainDoxyComment.endline)){var d=a.mainDoxyComment.content.match(/@[a-z]+.*\n/gi);if(d)for(var e=0;e<d.length;e++){var f=d[e].search(/\s/);if(f>=0){var g=d[e].substring(0,f),h=d[e].substr(f).trim();"@title"==g&&t(h)}}}document.activeElement!==ya&&$(za).find(".fake-caret").addClass("fake-blur-caret"),Za||$(za).find(".eden-number").draggable({helper:function(a){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(a,b){if(!Za){var c;if(Qa?c=Math.round(Na+(b.position.left-Ma)/2):(c=Na+.005*(b.position.left-Ma),c=c.toFixed(4)),c!=Oa){Oa=c,a.target.innerHTML=""+c;var d=a.target.parentNode.textContent;"\n"==d.charAt(d.length-1)&&(d=d.slice(0,-1)),K(Pa,d),La.setSource(ya.value,!1,Pa),Ua.ast=La.ast,Fa.lines[Pa]&&Fa.lines[Pa].live&&!La.hasErrors()&&La.executeLine(Pa),N(La.ast,Pa,-1)}}},start:function(a,b){if(!Za){Wa=!0,Pa=L(a.target),Ma=b.position.left;var c=a.target.textContent;-1==c.indexOf(".")?(Na=parseInt(c),Qa=!0):(Na=parseFloat(c),Qa=!1),Oa=Na,$(a.target).addClass("eden-select"),$(za).css("cursor","ew-resize")}},stop:function(a,b){Za||($(a.target).removeClass("eden-select"),$(za).css("cursor","text"),Pa=-1)},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})}function O(a){var b=a.value.substr(0,a.selectionStart).split("\n");return Sa=b.length,Ta=b[b.length-1].length,Sa}function P(){var a=$(za).find(".fake-caret").get(0),b=document.createRange(),c=window.getSelection();a.nextSibling&&(a=a.nextSibling),b.setStart(a,0),b.collapse(!0),c.removeAllRanges(),c.addRange(b),$(za).remove(".fake-caret")}function Q(){var a=document.createRange();a.selectNodeContents(za);var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}function R(){Va?(I(),Va=!1):G(),M(),Xa=!1}function S(a){Fa.lines[a-1]&&Fa.lines[a-1].live&&!La.hasErrors()&&La.executeLine(a-1)}function T(a,b,c){EdenUI.plugins.ScriptInput.dialogs[a]&&EdenUI.plugins.ScriptInput.dialogs[a](va,b,c)}function U(){Wa=!0,La.isSaved()&&u(""),clearTimeout(Ka),Ka=setTimeout(R,Ra)}function V(a){Xa=!0,U()}function W(){za.contentEditable=!1,changeClass(za,"inspect",!0),$a=!0,n(),u("[inspecting]")}function X(){changeClass(za,"inspect",!1),$a=!1,I(),ya.focus(),n(),Za?u("[readonly]"):(u(""),za.contentEditable=!0)}function Y(a){if(a.altKey&&73==a.keyCode)W();else if(a.altKey)187==a.keyCode||61==a.keyCode?(kb.state[jb]++,a.preventDefault()):189==a.keyCode||173==a.keyCode?(kb.state[jb]--,a.preventDefault()):48==a.keyCode&&(kb.state[jb]=0,a.preventDefault());else{if($a)return void a.preventDefault();if(a.ctrlKey||17==a.keyCode||16==a.keyCode){if(a.ctrlKey)if(a.shiftKey){if(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||36==a.keyCode||35==a.keyCode)return P(),void za.focus()}else 38===a.keyCode?ha():40===a.keyCode?ia():86===a.keyCode||65===a.keyCode&&(a.preventDefault(),za.focus(),Q())}else if(9==a.keyCode){a.preventDefault();var b=ya.selectionStart,c=ya.selectionEnd;ya.value=ya.value.substring(0,b)+"	"+ya.value.substring(c),ya.selectionStart=ya.selectionEnd=b+1,U()}else if(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||36==a.keyCode||35==a.keyCode){if(a.shiftKey)return P(),void za.focus();H(),M()}else(13==a.keyCode||8==a.keyCode&&10==ya.value.charCodeAt(ya.selectionStart-1))&&(Va=!0)}}function Z(a){Va=!0}function _(a){18==a.keyCode||a.altKey&&73==a.keyCode?(X(),a.preventDefault()):a.altKey||(a.ctrlKey||37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&36!=a.keyCode&&35!=a.keyCode?U():(H(),(36==a.keyCode||35==a.keyCode)&&M()))}function aa(a){if(a.altKey&&73==a.keyCode)W();else if(!a.altKey)if("pointer"==za.style.cursor&&(za.style.cursor="initial"),16==a.keyCode||17==a.keyCode||a.ctrlKey&&67==a.keyCode);else if(!a.shiftKey||37!=a.keyCode&&38!=a.keyCode&&39!=a.keyCode&&40!=a.keyCode&&35!=a.keyCode&&36!=a.keyCode){var b=getCaretCharacterOffsetWithin(za),c=getStartCaretCharacterOffsetWithin(za);ya.focus(),ya.selectionEnd=b,ya.selectionStart=c,c!=b&&(Va=!0)}}function ba(a){ya.focus(),setTimeout(I,0)}function ca(a){(18==a.keyCode||a.altKey&&73==a.keyCode)&&(X(),a.preventDefault())}function da(a){$(za).find(".fake-caret").remove(),J()}function ea(a){}function fa(a){Eden.Agent.importAgent(a,"default",["noexec","create"],function(b){var c=kb.state[ib];-1==c.indexOf(a)&&(c.push(a),kb.state[ib]=c),kb.state[fb]=a,ya.focus()})}function ga(a){if(J(),k(),$a){var b=a.target;if(""==b.className&&"SPAN"==b.parentNode.nodeName&&(b=b.parentNode),"eden-path"==b.className)X(),fa(b.parentNode.textContent);else if("eden-observable"==b.className){var c=b.getAttribute("data-observable");b.textContent=Eden.edenCodeForValue(eden.root.lookup(c).value()),b.className+=" select"}else if("eden-observable select"==b.className){var c=b.getAttribute("data-observable");b.textContent=c,b.className="eden-observable"}a.preventDefault()}else if(document.activeElement===za){var d=getCaretCharacterOffsetWithin(za),e=getStartCaretCharacterOffsetWithin(za);if(e!=d)Va=!0;else{var f=Sa;ya.focus(),ya.selectionEnd=d,ya.selectionStart=d,Ua.ast&&(Ua.highlight(Ua.ast,f,d),H())}}}function ha(){1==kb[db]?(kb[cb]=!0,kb[cb]=!1):!Za&&La.canUndo()&&(La.undo(),ya.value=La.snapshot,I(!0),o())}function ia(){1==kb[db]?(kb[bb]=!0,kb[bb]=!1):!Za&&La.canRedo()&&(La.redo(),ya.value=La.snapshot,I(!0),o())}function ja(){if(1==kb[db]);else if(!Za&&La.canRedo()){for(;La.canRedo();)La.redo();ya.value=La.snapshot,I(!0),o()}}function ka(){if(1==kb[db]);else if(!Za&&La.canUndo()){for(;La.canUndo();)La.undo();ya.value=La.snapshot,I(!0),o()}}function la(a){var b=a.currentTarget.getAttribute("data-name");console.log(b),kb.state[fb]=b,ya.focus(),o()}function ma(){if(void 0!==La){var a=kb.state[ib],b=a.indexOf(La.name);b--,b>=0&&(kb.state[fb]=a[b])}}function na(){if(void 0!==La){var a=kb.state[ib],b=a.indexOf(La.name);b++,b<a.length&&(kb.state[fb]=a[b])}}function oa(){Ia.toggle("slide",{direction:"down"},200)}function pa(){T("newAgent",function(a,b){a?Eden.Agent.importAgent(b,"default",["noexec","create"],function(a){kb.state[fb]=b}):b&&m()})}function qa(a){var b=a.target.getAttribute("data-name");a.originalEvent.dataTransfer.setData("agent",b),La.name==b&&(La.setOwned(!1),La=void 0,Za=!0,u("[readonly]"),changeClass(za,"readonly",!0),za.contentEditable=!1)}function ra(a){a.preventDefault()}function sa(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer.getData("agent");if(b&&""!=b){var c=kb.state[ib];-1==c.indexOf(b)&&(c.push(b),kb.state[ib]=c),kb.state[fb]=b}else if(window.FileReader)for(var d=a.originalEvent.dataTransfer.files,e=0;e<d.length;e++){var f=d[e];if(f.name.match(/.*\.jse|.*\.js-e/)){var g=f.name.slice(0,-4);g=g.replace(/[\.\-\/\s]/g,""),g="local/file/"+g;var h=new FileReader;h.onload=function(a){var b=new Eden.Agent(void 0,g);b.setSource(a.target.result,!1,-1),kb.state[fb]=g},h.readAsText(f)}}}function ta(a){var b=a.target.getAttribute("data-name");if("none"!=a.originalEvent.dataTransfer.dropEffect){var c=kb.state[ib],d=c.indexOf(b);d>=0&&(c.splice(d,1),d--,0>d&&(d=0),d<c.length&&(kb.state[fb]=c[d]),kb.state[ib]=c),0==c.length&&(kb.state[fb]=void 0)}else kb.state[fb]=b}function ua(a){$a?X():W()}var va=$('<div class="inputdialogcontent"><div class="inputhider"><textarea autofocus tabindex="1" class="hidden-textarea"></textarea><div class="agent-tabs"></div><div class="inputCodeArea"><div class="eden_suggestions"></div><div spellcheck="false" tabindex="2" contenteditable class="outputcontent"></div></div></div><div class="info-bar"></div><div class="outputbox"></div></div></div>'),wa=va.find(".inputCodeArea"),xa=wa.get(0),ya=va.find(".hidden-textarea").get(0),za=va.find(".outputcontent").get(0),Aa=va.find(".info-bar").get(0),Ba=(va.find(".outputbox").get(0),va.find(".eden_suggestions")),Ca=va.find(".agent-tabs"),Da=Ca.get(0);Ba.hide(),$(Aa).hide();var Ea=new EdenUI.ContextMenu(Da);Ea.addItem("&#xf04b;",Language.ui.input_window.run,!0,e),Ea.addItem("&#xf04d;",Language.ui.input_window.stop,function(a){var b=a.getAttribute("data-name");return Eden.Agent.agents[b]&&Eden.Agent.agents[b].executed},f),Ea.addSeparator(),Ea.addItem("&#xf24d;",Language.ui.input_window.clone,!1),Ea.addItem("&#xf021;",Language.ui.input_window.reload,!0,i),Ea.addItem("&#xf093;",Language.ui.input_window.upload,!0,h),Ea.addItem("&#xf21b;",Language.ui.input_window.hide,!0,g);var Fa=new EdenScriptGutter(wa.get(0),Aa),Ga=$('<div class="control-bar noselect"><div class="buttonsDivLeft"><!--button class="control-button run-force control-enabled" title="Run (force)">&#xf04b;</button--></div><div class="buttonsDiv"><button class="control-button search-mode control-enabled" title="'+Language.ui.input_window.inspect+'">&#xf002;</button><button class="control-button rewind-input" title="'+Language.ui.input_window.rewind+'">&#xf122;</button><button class="control-button previous-input" title="'+Language.ui.input_window.undo+'">&#xf112;</button><button class="control-button next-input" title="'+Language.ui.input_window.redo+'">&#xf064;</button><button class="control-button fa-flip-horizontal fastforward-input" title="'+Language.ui.input_window.fast_forward+'">&#xf122;</button><button class="control-button control-enabled menu-input">&#xf142;</button></div>');Ga.appendTo(va);var Ha=Ga.get(0),Ia=$('<div class="options-menu noselect"></div>'),Ja=Ia.get(0);Ia.appendTo(va);var Ka,La,Ma=0,Na=0,Oa=0,Pa=-1,Qa=!1,Ra=10,Sa=1,Ta=0,Ua=new EdenUI.Highlight(za),Va=!1,Wa=!1,Xa=!1,Ya=0,Za=!0,$a=!1,_a=3;o(),setTimeout(function(){void 0===La&&u("[No Agents]")},0);var ab="_view_"+a+"_script",bb="_view_"+a+"_next",cb="_view_"+a+"_prev",db="_view_"+a+"_override",eb="_view_"+a+"_file",fb="_view_"+a+"_agent",gb="_view_"+a+"_showtabs",hb="_view_"+a+"_showbuttons",ib="_view_"+a+"_tabs",jb="_view_"+a+"_zoom",kb=new Eden.Agent(void 0,"view/script/"+a+"/config");kb.declare(fb),kb.declare(gb),kb.declare(ab),kb.declare(eb),kb.declare(db),kb.declare(bb),kb.declare(cb),kb.declare(hb),kb.declare(ib),kb.declare(jb),kb.on(ab,v),kb.on(eb,w),kb.on(fb,x),kb.on(gb,y),kb.on(hb,z),kb.on(ib,s),kb.on(jb,A),void 0===kb.state[gb]&&(kb.state[gb]=!d),void 0===kb.state[hb]&&(kb.state[hb]=!0),void 0===kb.state[ib]&&(kb.state[ib]=[]),void 0===kb.state[jb]&&(kb.state[jb]=0),c&&void 0===kb.state[fb]?kb.state[ab]=c:kb.state[fb]?x(void 0,kb.state[fb]):(za.className="outputcontent readonly",za.contentEditable=!1,za.innerHTML=""),kb.setSource("## "+a+"\n_view_"+a+"_script = "+Eden.edenCodeForValue(kb.state[ab])+";\n_view_"+a+"_next = "+Eden.edenCodeForValue(kb.state[bb])+";\n_view_"+a+"_prev = "+Eden.edenCodeForValue(kb.state[cb])+";\n_view_"+a+"_override = "+Eden.edenCodeForValue(kb.state[db])+";\n_view_"+a+"_agent = "+Eden.edenCodeForValue(kb.state[fb])+";\n_view_"+a+"_showtabs = "+Eden.edenCodeForValue(kb.state[gb])+";\n_view_"+a+"_showbuttons = "+Eden.edenCodeForValue(kb.state[hb])+";\n_view_"+a+"_tabs = "+Eden.edenCodeForValue(kb.state[ib])+";\n_view_"+a+"_zoom = "+Eden.edenCodeForValue(kb.state[jb])+";\n",!1,-1),Eden.Agent.listenTo("create",kb,C),Eden.Agent.listenTo("loaded",kb,D),Eden.Agent.listenTo("rollback",kb,E),Eden.Agent.listenTo("owned",kb,B),Eden.Agent.listenTo("remove",kb,r),Eden.Agent.listenTo("autosave",kb,q),Eden.Agent.listenTo("execute",kb,s),Eden.Agent.listenTo("error",kb,s),Eden.Agent.listenTo("fixed",kb,s),Eden.Agent.listenTo("patched",kb,F),Eden.Agent.listenTo("changed",kb,F);var lb=setInterval(function(){void 0!==La&&(Fa.generate(La.ast,-1),La.clearExecutedState())},50);l(),va.on("input",".hidden-textarea",V).on("keydown",".hidden-textarea",Y).on("keyup",".hidden-textarea",_).on("paste",".hidden-textarea",Z).on("keydown",".outputcontent",aa).on("keyup",".outputcontent",ca).on("paste",".outputcontent",ba).on("blur",".hidden-textarea",da).on("focus",".hidden-textarea",ea).on("mouseup",".outputcontent",ga).on("click",".previous-input",ha).on("click",".next-input",ia).on("click",".rewind-input",ka).on("click",".fastforward-input",ja).on("click",".menu-input",oa).on("click",".search-mode",ua).on("click",".agent-tab",la).on("click",".agent-tableft",ma).on("click",".agent-tabright",na).on("click",".agent-newtab",pa).on("dragstart",".agent-tab",qa).on("dragend",".agent-tab",ta).on("dragover",ra).on("drop",sa);var mb={contents:va,update:function(b){if(void 0===kb.state[fb]){var c="view/script/"+a;Eden.Agent.importAgent(c,"default",["noexec","create"],function(a){kb.state[fb]=c,b instanceof Symbol?(kb.setScope(b.getValueScope(eden.root.scope)),ya.value=EdenUI.plugins.ScriptInput.buildScriptFromList(kb.code),I()):b instanceof Array?(ya.value=EdenUI.plugins.ScriptInput.buildScriptFromList(b),I()):"string"==typeof b&&(ya.value=b,I())})}},destroy:function(){console.log("CLOSE SCRIPT"),clearInterval(lb),Eden.Agent.unlisten(kb),La&&La.setOwned(!1),La=void 0,Eden.Agent.remove(kb),kb=void 0},resize:function(a,b){b&&b.size&&(_a=Math.floor((b.size.width-90)/160))},setValue:function(a){ya.value=a,I()}};return I(),mb},this.createDialog=function(b,c,d){var f=b.slice(0,-7),g=e.createCommon(f,c,d,!1,!1),h=305;if(d){var i=g.contents.find("textarea").val().split("\n").length;h=EdenUI.plugins.ScriptInput.getRequiredHeight(i+1)}return $dialog=$('<div id="'+b+'"></div>').html(g.contents).dialog({title:c,width:500,height:h,minHeight:203,minWidth:300,dialogClass:"input-dialog",resizeStop:g.resize}),g.confirmClose=!("MenuBar"in a.plugins),g},this.createEmbedded=function(a,b,c){var d=e.createCommon(a,b,c,!0);return d},a.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:a.viewCategories.interpretation,menuPriority:0},a.views.History={dialog:this.createHistory,title:"Execution History",category:a.viewCategories.history},a.history=this.history,b()},EdenUI.plugins.ScriptInput.buildScriptFromList=function(a){var b="";if(a instanceof Array)for(var c=0;c<a.length;c++)if("string"==typeof a[c])b+=a[c]+"\n";else if("object"==typeof a[c])if(void 0!==a[c].definition)b+=a[c].eden_definition+"\n";else{var d=a[c].name.slice(1);b+=d+" = "+Eden.edenCodeForValue(a[c].value())+";\n"}return b},EdenUI.plugins.ScriptInput.getRequiredHeight=function(a,b){return b?55+20*a+20:45+20*a+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(a,b){var c=$('<div class="script-obscurer noselect"></div>'),d=$('<div class="script-subdialog-newagent noselect"><span class="script-subdialog-title">Create or import agent:</span><br/><input class="script-subdialog-text" type="text" spellcheck="false" list="agentlist" placeholder="model/component/agent"></input><datalist id="agentlist"></datalist><span class="status missing"></span><br><button class="button-icon-green button-add">Add</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button><button style="position: absolute; right: 100px;" class="button-icon-silver button-agents">Browse</button></div>'),e=d.find(".script-subdialog-text"),f=e.get(0).nextSibling.nextSibling,g=d.find("#agentlist"),h=!1;g.empty();for(var i in Eden.Agent.agents){var j=$("<option>"+i+"</option>");g.append(j)}d.on("input blur",".script-subdialog-text",function(){var a=e.get(0).value;""==a?(h=!1,f.className="missing"):/^[a-z][a-z0-9\/]+$/i.test(a)?void 0===Eden.Agent.agents[a]?Eden.DB.getMeta(a,function(a,b){b?(f.className="download",h=!0):(f.className="addnew",h=!0)}):(Eden.Agent.agents[a].owned?f.className="readonly":f.className="edit",h=!0):(f.className="invalid",h=!1)}).on("click",".button-add",function(){h&&(a.get(0).removeChild(c.get(0)),b(!0,e.get(0).value))}).on("click",".button-agents",function(){a.get(0).removeChild(c.get(0)),b(!1,!0)}).on("click",".button-cancel",function(){a.get(0).removeChild(c.get(0)),b(!1)}),c.append(d),a.append(c)},EdenUI.plugins.ScriptInput.dialogs.uploadAgent=function(a,b){var c=$('<div class="script-obscurer noselect"></div>'),d=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload agent. Give an optional version name:</span><br/><input class="script-subdialog-text tagname" type="text" spellcheck="false"></input><span class="status missing"></span><br><input class="script-subdialog-check makepublic" type="checkbox">Public</input><br><br><button class="button-icon-green button-upload">Upload</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>'),e=d.find(".tagname"),f=d.find(".makepublic"),g=e.get(0).nextSibling,h=!0;
d.on("input blur",".script-subdialog-text",function(){var a=e.get(0).value;console.log(a),""==a?(h=!0,g.className="addnew"):/^[a-z][a-z0-9]+$/i.test(a)?(g.className="addnew",h=!0):(g.className="invalid",h=!1)}).on("click",".button-upload",function(){h&&(a.get(0).removeChild(c.get(0)),b(!0,e.get(0).value,f.get(0).checked))}).on("click",".button-cancel",function(){a.get(0).removeChild(c.get(0)),b(!1)}),c.append(d),a.append(c)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(a,b,c){function d(){for(var a=j.get(0);a.firstChild;)a.removeChild(a.firstChild);g=void 0}function e(a){if(c.history[a])for(var b=c.history[a].length-1;b>=0;b--){var d=$('<div class="script-history-item"></div>');l==b&&(d.addClass("current"),d.addClass("original"),g=d),d.get(0).setAttribute("data-index",""+b);var e=$('<div class="script-history-bookmark"></div>'),f=$('<div class="script-history-time"></div>'),h=$('<div class="script-history-content"></div>');f.html(get_time_diff(c.history[a][b].time)),f.get(0).title=c.history[a][b].time,c.history[a][b].bookmark&&e.addClass("bookmarked"),c.history[a][b].title?h.html(c.history[a][b].title):h.html("[Autosave]"),d.append(e),d.append(h),d.append(f),j.append(d)}}function f(a){if(Eden.DB.getVersions(c.name,function(b){if(null!=b)for(var c=0;c<b.length;c++){var d=$('<div class="script-history-item"></div>');b[c].saveID==m&&(d.addClass("original"),-1==l&&(d.addClass("current"),g=d)),d.get(0).setAttribute("data-version",""+b[c].saveID);var f="script-history-stored";f+=0==b[c]["public"]?" private":b[c].mine?" mine":" public";var h=$('<div class="'+f+'"></div>'),i=b[c].date.split(/[- :]/),k=$('<div class="script-history-time">'+get_time_diff(new Date(i[0],i[1]-1,i[2],i[3],i[4],i[5]).getTime()/1e3)+"</div>"),n=b[c].tag;null==b[c].tag&&(n=b[c].saveID);var o=$('<div class="script-history-content">'+n+" by "+b[c].name+"</div>");d.append(h),d.append(o),d.append(k),j.append(d),b[c].saveID==m&&e(a)}}),c.history.origin){var b=$('<div class="script-history-item"></div>');"origin"==m&&(b.addClass("original"),-1==l&&(b.addClass("current"),g=b)),b.get(0).setAttribute("data-version","origin");var d="script-history-bookmark",f=$('<div class="'+d+'"></div>'),h="origin";c.meta&&c.meta.file&&(h=c.meta.file);var i=$('<div class="script-history-content">'+h+"</div>");b.append(f),b.append(i),j.append(b),"origin"==m&&e("origin")}}var g,h=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),j=i.find(".script-history-list"),k=!0,l=c.index,m=c.meta.saveID;f(c.meta.saveID),i.on("input",".script-history-content",function(a){var b=parseInt(a.target.parentNode.getAttribute("data-index"));c.history[c.meta.saveID][b].title=a.target.textContent,c.saveHistory(),c.makeSnapshot(b)}).on("click",".script-history-item",function(a){var b=a.currentTarget.getAttribute("data-version");if(b)"origin"!=b&&(b=parseInt(b)),m=b,d(),l=-1,f(m);else{var c=parseInt(a.currentTarget.getAttribute("data-index"));l=c,g&&g.removeClass("current"),g=$(a.currentTarget),g.addClass("current")}}).on("click",".script-history-bookmark",function(a){var b=parseInt(a.target.parentNode.getAttribute("data-index"));void 0===c.history[c.meta.saveID][b].bookmark?c.history[c.meta.saveID][b].bookmark=!0:c.history[c.meta.saveID][b].bookmark=!c.history[c.meta.saveID][b].bookmark,c.saveHistory(),c.history[c.meta.saveID][b].bookmark?a.target.className="script-history-bookmark bookmarked":a.target.className="script-history-bookmark"}).on("click",".button-ok",function(){k&&(a.get(0).removeChild(h.get(0)),console.log("Rollback to: "+l+"@"+m),b(!0,l,m))}).on("click",".button-cancel",function(){a.get(0).removeChild(h.get(0)),b(!1)}),h.append(i),a.append(h)},EdenUI.plugins.ScriptInput.dialogs.browseAgents=function(a,b,c){function d(a,b,d){Eden.DB.getDirectory(d,function(e){if(void 0!==e)for(var f in e){var g=""==d?f:d+"/"+f,i=$('<div class="script-agents-item"></div>'),j=$('<div class="script-agents-expand" style="width: '+(27+15*b)+'px"></div>'),k=$('<div class="script-agents-content"></div>'),l=$('<div class="script-agents-cbcont"></div>');(function(a,b,d,e){Eden.DB.getMeta(b,function(b,f){if(f){var g=$('<input type="checkbox"></input>');a.html(d+' <span class="script-agents-title">'+f.title+"</span>"),e.append(g),c.indexOf(b)>=0&&(g.get(0).checked=!0)}else a.html(d),e.html("&nbsp;")})}).call(this,k,g,f,l),Eden.Agent.agents[g]&&i.addClass("loaded"),i.get(0).setAttribute("data-path",g),i.get(0).setAttribute("data-depth",""+(b+1)),0==e[f].missing&&e[f].children&&0==Object.keys(e[f].children).length&&j.addClass("noexpand"),i.append(j),i.append(l),i.append(k),void 0===a||void 0===a.nextSibling?h.append(i):h.get(0).insertBefore(i.get(0),a.nextSibling)}})}function e(a){for(var b=parseInt(a.getAttribute("data-depth")),c=a.nextSibling;c;){var d=parseInt(c.getAttribute("data-depth"));if(!(d>b))break;var e=c.nextSibling;h.get(0).removeChild(c),c=e}}var f=$('<div class="script-obscurer noselect"></div>'),g=$('<div class="script-subdialog-agents noselect"><span class="script-subdialog-title">Browse Agents:</span><br/><div class="script-agents-list"></div><div class="script-agents-buttons"><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),h=g.find(".script-agents-list"),i={};d(void 0,0,""),g.on("click",".script-agents-item",function(a){}).on("click",".script-agents-expand",function(a){var b=a.currentTarget.parentNode.getAttribute("data-path"),c=parseInt(a.currentTarget.parentNode.getAttribute("data-depth"));a.currentTarget.className.indexOf("expanded")<0?(d(a.currentTarget.parentNode,c,b),changeClass(a.currentTarget,"expanded",!0)):(e(a.currentTarget.parentNode),changeClass(a.currentTarget,"expanded",!1))}).on("change",".script-agents-cbcont input",function(a){var b=a.currentTarget.parentNode.parentNode.getAttribute("data-path");a.currentTarget.checked?i[b]=!0:i[b]=!1}).on("click",".button-add",function(){a.get(0).removeChild(f.get(0)),b(!0,i)}).on("click",".button-cancel",function(){a.get(0).removeChild(f.get(0)),b(!1)}),f.append(g),a.append(f)},EdenScriptGutter.prototype.clear=function(){for(this.ast=void 0,this.lines=[];this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild)},EdenScriptGutter.prototype.setAgent=function(a){for(void 0===this.agents[a]&&(this.agents[a]=[]);this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);this.lines=this.agents[a],this.agent=Eden.Agent.agents[a]},EdenScriptGutter.prototype.executeSelected=function(){if(void 0!==this.agent){console.log("Execute Selected");for(var a=0;a<this.lines.length;a++)if(this.lines[a].selected){var b=this.ast.getBlockLines(a);this.agent.executeLine(a),a=b[1]}}},EdenScriptGutter.prototype.generate=function(a,b){this.ast=a;var c=!1;if(a.lines.length!=this.gutter.childNodes.length){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(var d=0;d<a.lines.length;d++){var e=document.createElement("div");e.className="eden-gutter-item",e.setAttribute("data-line",""+d),this.gutter.appendChild(e),void 0===this.lines[d]&&(this.lines[d]={selected:!1,live:!1})}c=!0}for(var d=0;d<a.lines.length;d++){var f="eden-gutter-item",g="",h=!1,i=c;if(a.lines[d]){var j=a.lines[d];j.errors.length>0?(f+=" errorblock",j.errors[0].line==d+1?(f+=" error",g="&#xf06a"):"runtime"==j.errors[0].type&&(f+=" error",g="&#xf06a"),i=!0):("assignment"==j.type&&void 0===j.value&&j.compiled&&(f+=" warning",g="&#xf071",i=!0),1==j.executed?(f+=" executed",h=!0):2==j.executed?(f+=" guarded",i=!0):3==j.executed&&(f+=" errorblock",i=!0),this.gutter.childNodes[d].className.indexOf("error")>=0&&(i=!0)),this.lines&&this.lines[d]&&(this.lines[d].selected&&(f+=" select"),this.lines[d].live&&(f+=" live"))}if(h)if(""==g){var k=document.createElement("div");k.className=f,k.innerHTML="",k.setAttribute("data-line",""+d),this.gutter.replaceChild(k,this.gutter.childNodes[d])}else this.gutter.childNodes[d].className=f,this.gutter.childNodes[d].innerHTML=g;else i&&(this.gutter.childNodes[d].className.indexOf("hover")>=0&&(f+=" hover"),this.gutter.childNodes[d].innerHTML=g,this.gutter.childNodes[d].className=f)}},EdenUI.plugins.ProjectList=function(a,b){function c(){this.json={projects:[]},this.rootURL=void 0,this.atRoot=!0}function d(b){EdenUI.plugins.ScriptGenerator.loadBaseConstrual(b),a.plugins.ScriptInput&&a.plugins.ScriptInput.addHistory('include("'+b+'");')}function e(b,c){a.createView(b,"ScriptInput"),a.eden.root.lookup("_view_"+b+"_title").assign(b,root.scope),a.eden.root.lookup("_view_"+b+"_script").assign([c],root.scope),a.showView(b),a.brieflyHighlightView(b)}var f=Date.UTC(2015,8,5),g=getParameterByName("projects"),h="";"projectList"in a.branding&&("prologue"in a.branding.projectList&&(h='<div class="projectlist-prologue">'+a.branding.projectList.prologue.html+"</div>","href"in a.branding.projectList.prologue&&(h='<a href="'+a.branding.projectList.prologue.href+'" target="project-listing-link" style="text-decoration: none">'+h+"</a>")),""==g&&"data"in a.branding.projectList&&(g=a.branding.projectList.data)),""==g&&(g="models/projects.json");var i,j,k;this.loadCrossDomain=function(a){if(a.success)if("string"==typeof i)e(i,a.success);else{var b=JSON.parse(a.success);i.populateProjectData(b,j,k)}},c.prototype.loadProjectData=function(a,b){var c=this;/^[a-zA-Z][a-zA-Z\d+.-]*:\/\//.test(a)?(i=this,j=a,k=b,$.ajax({url:rt.config.proxyBaseURL+"?url="+a+"&callback=edenUI.plugins.ProjectList.loadCrossDomain",dataType:"script"})):$.ajax({url:a,dataType:"json",success:function(d){c.populateProjectData(d,a,b)},cache:!1})},c.prototype.loadProjectCode=function(a){var b=this;/^[a-zA-Z][a-zA-Z\d+.-]*:\/\//.test(a)?(i=this.json.target,j=a,$.ajax({url:rt.config.proxyBaseURL+"?url="+a+"&callback=edenUI.plugins.ProjectList.loadCrossDomain",dataType:"script"})):$.ajax({url:a,dataType:"text",success:function(a){e(b.json.target,a)},cache:!1})},c.prototype.populateProjectData=function(a,b,c){if(this.json=a,c)this.rootURL=b,this.atRoot=!0;else if(this.atRoot=b==this.rootURL,!this.atRoot){var d={name:"Return to main list",projects:this.rootURL};this.json.projects.push(d)}this.updateCollection("")},c.prototype.projectClick=function(b){var c=b.runfile;void 0!==c&&(void 0!==this.json.target?this.loadProjectCode(c):a.eden.isInInitialState()?(a.newProject(),d(c)):a.modalDialog("Open Project Action","<p>The work space contains an existing construal.</p>					<p>You can either abandon the existing construal or choose to merge the project with the existing definitions.</p>					<p>Which would you like to do?</p>",["Open Project","Merge"],0,function(b){2!=b&&(0==b&&a.newProject(),d(c))}));var e=b.projects;void 0!==e&&this.loadProjectData(e,!1)},c.prototype.makeProject=function(a){var b=this,c=$('<div class="projectlist-result-element"></div>'),d="";return void 0!==a.screenshot&&(d=d+'<img src="'+a.screenshot+'" class="projectlist-result-screenshot"/>'),d=d+'<div class="projectlist-result-name">'+a.name+"</div>",void 0!==a.description&&(d=d+'<div class="projectlist-result-metadata">'+a.description+"</div>"),(void 0!==a.author||void 0!==a.year)&&(d+='<div class="projectlist-result-metadata">',void 0!==a.author&&(d=d+"By "+a.author),void 0!==a.year&&(d=d+" ("+a.year+")"),d+="</div>"),c.html(d),c.click(function(){b.projectClick(a)}),c},c.prototype.updateCollection=function(b){this.element.parentElement.scrollTop=0;var c=$(this.element).find(".projectlist-results");c.html("");var d=void 0!==this.json.target;if(void 0!==this.json.projects)for(var e=new RegExp("(^|\\s)"+b,"im"),h=!1,i=0;i<this.json.projects.length;i++)if(e.test(this.json.projects[i].name)||e.test(this.json.projects[i].description)||e.test(this.json.projects[i].author)||e.test(this.json.projects[i].year)){h=!0;var j=this.json.projects[i],k=this.makeProject(j);c.append(k)}if(!d&&this.rootURL==g&&this.atRoot&&(""==b||e.test("Feature of The Day"))){var l,m=a.getOptionValue("fotdLastVisited");l=null===m||parseInt(m)<f?'<img id="fotd-sticker" src="images/new-sticker.png" width="24" height="14" style="vertical-align: 5%" />':"";var k=this.makeProject({name:"Feature of The Day "+l,description:"Learn about the latest features added to JS-EDEN.",author:"JS-EDEN Development Team",runfile:"models/guides/feature-of-the-day.js-e"});c.prepend(k)}if(!d&&(!h||e.test("New Project"))){var n=$('<div class="projectlist-result-element"><div class="projectlist-result-name">New Project</div><div class="projectlist-result-metadata">An empty work space.</div><div class="projectlist-result-metadata">By JS-EDEN Development Team</div></div>').click(function(){eden.isInInitialState()?a.newProject():a.modalDialog("Reset Work Space","<p>This action will discard the current script. Your work will not be saved.</p>						<p>Are you sure you wish to continue?</p>",["Reset Work Space"],1,function(b){0==b&&a.newProject()})});c.prepend(n)}},this.createDialog=function(b,d){function e(a,b){i.loadProjectData(b,!0)}var f=b.slice(0,-7),i=new c,j=$('<div class="projectlist-listing"></div>');j.append(h);var k=$('<div class="projectlist-search-box-outer"></div>'),l=$('<input type="text" class="projectlist-search" placeholder="search" />').on("keyup",function(a){i.updateCollection(a.target.value)});k.append(l),j.append(k),j.append('<div class="projectlist-results noselect"></div>'),$('<div id="'+b+'"></div>').html(j).dialog({title:d,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"}),i.element=j.get(0);var m=a.eden.root.lookup("_view_"+f+"_source");void 0==m.value()&&m.assign(g,root.scope,a.eden.root.lookup("createView")),m.addJSObserver("reload",e),e(m,m.value())},a.views.ProjectList={dialog:this.createDialog,title:"Project List",category:a.viewCategories.interpretation},a.eden.include("plugins/project-listing/project-listing.js-e",b)},EdenUI.plugins.ProjectList.title="Project List",EdenUI.plugins.ProjectList.description="Displays a list of construals.",EdenUI.plugins.PluginManager=function(a,b){this.createDialog=function(b,c){var d,e,f,g=$('<div class="projectlist-results noselect"></div>'),h=function(b){return a.plugins[b]?"(loaded)":"(not loaded)"};pluginNames=Object.keys(EdenUI.plugins).sort(function(b,c){var d=a.plugins[b],e=a.plugins[c];return d&&!e?1:e&&!d?-1:c>b?-1:b==c?0:1});for(var i=0;i<pluginNames.length;i++){e=pluginNames[i],d=EdenUI.plugins[e];var j=e in a.plugins?" pluginmanager-loaded":"",k='<div class="projectlist-result-element'+j+'"><div class="projectlist-result-name">'+d.title+"</div><div class='projectlist-result-metadata'>"+d.description+"</div>";void 0!==d.originalAuthor&&(k=k+"<div class='projectlist-result-metadata'>Original version by "+d.originalAuthor+"</div>"),void 0!==d.author&&(f=void 0===d.originalAuthor?"By ":"Built on by ",k=k+"<div class='projectlist-result-metadata'>"+f+d.author+"</div>"),k=k+'<div class="pluginlist-loaded projectlist-result-metadata">'+h(e)+"</div></div>",$(k).click(function(b){return function(){var c=$(this);a.loadPlugin(b,function(){a.plugins[b]&&(c.find(".pluginlist-loaded").html(h(b)),c.addClass("pluginmanager-loaded",100)),a.plugins.MenuBar.updateViewsMenu()})}}(e)).appendTo(g)}var l=$('<div class="projectlist-listing"></div>');l.append(g),$dialog=$('<div id="'+b+'"></div>').html(l).dialog({title:c,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},a.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:a.viewCategories.environment,name:"plugins"},b()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.MenuBar=function(a,b){function c(){$(".menubar-menu").hide(),w=!1;var a=$("#menubar-mainitem-views");a.children().css("display",""),document.getElementById("menubar-view-type-search").value=""}function d(a){var b=$("#menubar-mainitem-"+a);b.show(),w=!0}function e(){var a=$("<div></div>");return a.appendTo(t),a.menuGroupWidth=0,a}function f(a,b,e){var f=$('<div class="menubar-mainitem"></div>');x++,f.attr("tabindex",x),f.html(b),f.appendTo(e);var g=f[0].clientWidth+10;e.menuGroupWidth=e.menuGroupWidth+g+10,f[0].style.width=g+"px",f.html(b+'<div id="menubar-mainitem-'+a+'" class="menubar-menu"></div>'),$("#menubar-mainitem-"+a).hide();var h=function(b){w?b.target===this&&c():(c(),d(a)),b.stopPropagation()};return f.on("mousedown",h),f.on("mouseenter",function(){w&&(c(),d(a))}),f}function g(){var b=$("#menubar-mainitem-existing-views");Object.keys&&0===Object.keys(a.activeDialogs).length&&b.html('<div class="menubar-item-fullwidth">Use the "New Window" menu to create windows.</div>')}function h(b){c();var d=a.eden.root,e=d.lookup("mouseFollow").value(),f=d.lookup("_views_number_created"),g=f.value()+1;f.assign(g,d.scope,Symbol.hciAgent,!0);var h=this.view,i=h.slice(0,1).toLowerCase()+h.slice(1)+g;e?a.eden.execute('createView("'+i+'", "'+h+'");'):a.createView(i,h),q.updateViewsMenu()}function i(b){var d=this.parentNode.viewname;a.viewInstances[d].confirmClose&&c(),a.closeView(d),g()}function j(b){var c=b.currentTarget.children[0],d=this.parentNode.viewname;a.viewInstances[d].pinned?(a.unpinView(d),c.src=s):(a.pinView(d),c.src=r)}function k(a){for(var b=$("<div class='menubar-item'></div>"),c=0;c<a.length;++c)b.append(a[c]);return b}function l(a,b){return $('<div class="'+a+' menubar-item-clickable">'+b+"</div>")}function m(a){return $("<div class='menubar-item menubar-nonselectable'><div class='menubar-item-fullwidth menubar-item-separator'>"+a+"</div></div>")}function n(b){return{mouseover:function(c){a.highlightView(b,!0)},mouseout:function(c){a.stopHighlightingView(b,!0,!1)},click:function(d){a.stopHighlightingView(b,!0,!0),c()}}}function o(a){return a&&"false"!=a?'checked="checked"':""}function p(){function b(b,c,d,f){var g=a.getOptionValue(b);null===g&&(g=d);var h=l("menubar-item-input",'<input id="menu-'+b+'" type="checkbox"'+o(g)+" />"),i=h.get(0).children[0],j=l("menubar-item-label",c),m=k([h,j]);m.click(function(c){c.target!=i&&(i.checked=!i.checked),a.setOptionValue(b,i.checked)}),a.listenTo("optionChange",void 0,function(a,c){if(a==b){var d="true"===c;i.checked=d,f&&f(b,d)}}),m.appendTo(e)}var d=f("views",Language.ui.menu_bar.main_views,y);d.on("keypress",function(a){var b=document.getElementById("menubar-view-type-search");b!==a.target&&(b.value=b.value+String.fromCharCode(a.which),b.search())}),d.on("keyup",null,"backspace",function(a){var b=document.getElementById("menubar-view-type-search");b!==a.target&&(b.value=b.value.slice(0,-1),b.search())}),f("existing-views",Language.ui.menu_bar.main_existing,y),q.updateViewsMenu(),f("options",Language.ui.menu_bar.main_options,y);var e=$("#menubar-mainitem-options");b("optConfirmUnload",Language.ui.menu_bar.opt_confirm,!0,function(a,b){b?window.addEventListener("beforeunload",confirmUnload):window.removeEventListener("beforeunload",confirmUnload)}),b("optSimpleWildcards",Language.ui.menu_bar.opt_simple_search,!0),b("optHideOnMinimize",Language.ui.menu_bar.opt_hide,!1),b("optCollapseToTitleBar",Language.ui.menu_bar.opt_collapse,!1,function(a,b){var c;c=b?"collapse":"maximize",$(".ui-dialog-content").each(function(){$(this).dialogExtend("option","dblclick",c)})}),b("developer",Language.ui.menu_bar.opt_debug,!1,function(b,d){var e;e=d?"/index-dev.html":"/index.html";var f=document.location.pathname;e=f.slice(0,f.lastIndexOf("/"))+e,e!=document.location.pathname?(c(),a.modalDialog("Restart Required","<p>JS-EDEN must be restarted for this change to fully take effect.  Would you like to restart JS-EDEN now?</p>",["Restart Now","Restart Later"],1,function(b){if(0==b)window.onbeforeunload=void 0,document.location.pathname=e;else if(1==b)root.lookup("debug").mutate(root.scope,function(a){a.cache.value.jsExceptions=d},Symbol.hciAgent);else{var c=document.getElementById("menu-developer");c.checked=!c.checked,a.setOptionValue("developer",c.checked)}})):root.lookup("debug").mutate(root.scope,function(a){a.cache.value.jsExceptions=d},Symbol.hciAgent)})}EdenUI.plugins.MenuBar.title=Language.ui.menu_bar.title,EdenUI.plugins.MenuBar.description=Language.ui.menu_bar.description;var q=this;this.itemViews={},a.listenTo("createView",this,function(a,b){this.updateViewsMenu()}),a.listenTo("destroyView",this,function(a){$(this.itemViews[a]).remove(),delete this.itemViews[a],g()}),a.listenTo("loadPlugin",this,function(a,b){this.updateViewsMenu()});var r="images/pin.png",s="images/pin-greyed.png",t=$('<div id="menubar-main"></div>'),u=$('<div id="menubar-status"></div>');u.appendTo(t),t.appendTo("body"),$('<div id="menubar-bottom"></div>').appendTo("body");var v=getStyleBySelector(".menubar-menu");v.maxHeight="calc(100vh - "+String(30+a.scrollBarSize2)+"px)",this.updateStatus=function(a){u.html(Eden.htmlEscape(a,!0,!0))},this.appendStatus=function(a){u.html(u.html()+Eden.htmlEscape(a,!0,!0))};var w=!1;$(document.body).on("mousedown",function(){c()});var x=0;this.updateViewsMenu=function(){var b=$("#menubar-mainitem-views"),c=$("#menubar-mainitem-existing-views");b.html("");var d=$('<input id="menubar-view-type-search" class="menubar-search-box" type="text" placeholder="search"/>'),e=d[0],f=$('<div class="menubar-item-fullwidth"></div>');f.append(d);var o=$("<div class='menubar-item-search'></div>");o.append(f),e.search=function(){var a,c=e.value,d=new RegExp("(^|\\s)"+c,"i"),f=!1;b.children().each(function(b,e){if(!e.classList.contains("menubar-item-search")){var g=e.children[0],h=g.innerHTML,i=g.classList.contains("menubar-item-separator");i?(c.length>1&&(f=d.test(h)),a=e,f?e.style.display="":e.style.display="none"):f?e.style.display="":d.test(h)?(e.style.display="",a.style.display=""):e.style.display="none"}})},d.on("input",e.search);var p,t,u,v,w,x,y=[];for(t in a.views){var z=a.views[t],A=z.title,B=z.category.getLabel(),C=z.category.getMenuPriority(),D=z.menuPriority;v=l("menubar-item-fullwidth menubar-view",A),u=k([v]),u[0].view=t,u.click(h),y.push({title:A,viewEntry:u,categoryLabel:B,categoryPriority:C,itemPriority:D})}y=y.sort(function(a,b){if(a.categoryPriority!=b.categoryPriority)return a.categoryPriority-b.categoryPriority;if(void 0!==a.itemPriority){if(void 0===b.itemPriority)return-1;if(a.itemPriority!=b.itemPriority)return a.itemPriority-b.itemPriority}else if(void 0!==b.itemPriority)return 1;return a.title>b.title?1:a.title<b.title?-1:0});for(var E,F=0;F<y.length;++F){var G=y[F],H=G.categoryLabel;if(E!=H){var I=m(H);I.appendTo(b),E=H}G.viewEntry.appendTo(b)}b.append(o),c.html(""),q.itemViews={},g();for(p in a.activeDialogs){var J=n(p),A=a.eden.root.lookup("_view_"+p+"_title").value();v=l("menubar-item-label",A+' <span class="menubar-view-name">['+p+"]</span>"),v.click(J.click);var K;K=a.viewInstances[p].pinned?r:s,w=l("menubar-item-pin",'<img src="'+K+'" width="18" height="18" class="menubar-item-pin-icon"/>'),w.click(j),x=l("menubar-item-close",'<div class="menubar-item-close-icon">X</div>'),x.click(i),u=k([v,w,x]),u.bind("mouseover",J.mouseover),u.bind("mouseout",J.mouseout),u[0].viewname=p,u.appendTo(c),q.itemViews[p]=u[0]}};var y=e();p(),$.ajax({url:"version.json",dataType:"json",success:function(a){var b="";a.tag&&(document.title=document.title+" "+a.tag),b=a.sha?'Version <a href="https://github.com/EMgroup/js-eden/commit/'+a.sha+'">'+a.tag+"</a>":"Version "+a.tag,$('<div id="menubar-version-number"></div>').html(b).appendTo($("#menubar-main"))},cache:!1});var z=$('<div id="menubar-login"><span class="icon">&#xf05e;</span>Not Connected</div>');z.appendTo($("#menubar-main")),Eden.DB.listenTo("connected",this,function(a){$("#menubar-login").html('<a href="'+a+'/login" target="logintarget"><span class="icon">&#xf090;</span>Login</a>')}),Eden.DB.listenTo("disconnected",this,function(){$("#menubar-login").html('<span class="icon">&#xf05e;</span>Not Connected')}),Eden.DB.listenTo("login",this,function(a){a&&(setTimeout(function(){$("#menubar-obscurer").remove()},1e3),$("#menubar-login").html('<span class="icon">&#xf007;</span>'+a))}),$("#menubar-login").click(function(){if(Eden.DB.isConnected()&&!Eden.DB.isLoggedIn()){var a=$('<div id="menubar-obscurer"></div>');a.html('<div class="login-subdialog"><iframe frameborder="0" name="logintarget" width="460" height="300" class="menubar-login-iframe"></iframe><br/><button class="button-icon-silver button-cancel">Cancel</button></div>'),$(document.body).append(a),a.on("click",".button-cancel",function(){a.remove()})}});var A=e();a.eden.root.lookup("menus").addJSObserver("updateMenus",function(a,b){A.menuGroupWidth=0;var c=A.children();if(c.detach(),Array.isArray(b))for(var d=0;d<b.length;d++){var e=b[d];if(void 0===e.element){var g="construal-"+d;f(g,e.text,A);var h=$("#menubar-mainitem-"+g);e.generate(h)}else A.append(e.element),A.menuGroupWidth=A.menuGroupWidth+e.element.clientWidth}var i=u[0].style,j=20+y.menuGroupWidth+A.menuGroupWidth;i.left=j+"px",i.minWidth="calc(100% - "+2*j+"px)"}),this.Menu=function(a,b){this.text=a,this.items=b},this.Menu.prototype.generate=function(a){if(void 0===this.element){for(var b=0;b<this.items.length;b++){var c=this.items[b];c.generate(),a.append(c.element)}this.element=a.parent().get(0)}},this.Menu.prototype.toString=function(){return"Menu("+Eden.edenCodeForValues(this.text,this.items)+")"},this.Menu.prototype.getEdenCode=this.Menu.prototype.toString,this.SimpleMenuItem=function(a,b){this.name=a,this.text=b},this.SimpleMenuItem.prototype.generate=function(){if(void 0===this.element){var a=l("menubar-item-fullwidth",this.text),b=k([a]),d=this.name;b.bind("click",function(a){c();var b=root.lookup(d+"_clicked");b.assign(!0,root.scope),b.assign(!1,root.scope)}),this.element=b.get(0)}},this.SimpleMenuItem.prototype.toString=function(){return"MenuItem("+Eden.edenCodeForValues(this.name,this.text)+")"},this.SimpleMenuItem.prototype.getEdenCode=this.SimpleMenuItem.prototype.toString,a.eden.include("plugins/menu-bar/menu-bar.js-e",b)},EdenUI.plugins.Canvas2D=function(a,b){var c=this;this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx,this.defaultLineWidth=2;var d=600,e=500;canvases={},contents={};var f={},g={},h=40;this.destroyViews=function(b){var c=b.match(/^_view_(.*)_observable$/);if(null!==c){var d=c[1];a.destroyView(d,!0)}};var i=function(a,b){var c;for(c in b)if(b[c].togarbage)for(var d=b[c],e=0;e<d.length;e++)null!==d[e].parentElement&&a.removeChild(d[e])};this.setPictureObs=function(a,b){if(a in canvases){var d=canvases[a].pictureObs;void 0!==d&&delete g[d][a],b in g||(g[b]={}),g[b][a]=!0,canvases[a].pictureObs=b,root.lookup(b).addJSObserver("repaintView",function(a,d){c.drawPictures(b)}),this.drawPicture(a,b)}},this.drawPictures=function(a){for(var b in g[a])this.drawPicture(b,a)},this.drawPictureForView=function(a){var b=root.lookup("_view_"+a+"_observable").value();this.drawPicture(a,b)},this.drawPicture=function(a,b){var d=canvases[a];if(void 0!==d&&!d.drawingQueued&&(d.drawingQueued=!0,!d.drawingInProgress)){var e=function(){d.drawingInProgress=!0,d.drawingQueued=!1;var b=f[a],g={},j=d.pictureObs,k=root.lookup(j).value(),l=d.getContext("2d"),m=contents[a];if(void 0!==m){var n=root.lookup("_view_"+a+"_background_colour").value();void 0===n&&(n="white"),l.setTransform(1,0,0,1,0,0),c.setFillStyle(l,n),m.style.backgroundColor=n,l.fillRect(0,0,d.width,d.height);var o=root.lookup("_view_"+a+"_scale").value();"number"!=typeof o&&(o=1);var p=root.lookup("_view_"+a+"_zoom").value();"number"!=typeof p&&(p=1);var q=o*p,r=root.lookup("_view_"+a+"_offset").value();r instanceof Point?l.translate(r.x,r.y):r=new Point(0,0),l.scale(q,q),c.configureContextDefaults(l,o);var s;for(s in b)b[s].togarbage=!0;if(Array.isArray(k))for(var t=[k],u=[0];t.length>0;){var v=t.pop(),w=u.pop();for(w>0&&v[w-1]instanceof EdenUI.plugins.Canvas2D.Transform&&l.restore();w<v.length;){var x=v[w];if(x instanceof Object)if(Array.isArray(x))t.push(v),u.push(w+1),v=x,w=0;else if(x instanceof EdenUI.plugins.Canvas2D.Transform)t.push(v),u.push(w+1),l.save(),x.transform(l),v=x.items,Array.isArray(v)||(v=[v]),w=0;else{var y=x.hash&&x.hash(),z=y&&b[y];if(z)x.elements=z;else{l.save();try{var A=c.configureContext(l,o,p,x.drawingOptions);A&&x.draw(l,o,j)}catch(B){if(void 0!==x){console.log(B);var C=root.lookup("debug").value();"object"==typeof C&&C.jsExceptions}}l.restore()}if(void 0!==x.elements){var D=x.elements[0].parentElement;if(D&&D!=m){for(var E=[],F=0;F<x.elements.length;F++)E.push($(x.elements[F]).clone(!0,!0).get(0));x.elements=E,x.scale(q,p,r)}else(!z||d.rescale)&&x.scale(q,p,r)}var G=x.elements;G&&(G.togarbage=!1),G&&!z&&$(m).append(G),G&&(g[y]=G),w++}else w++}}i(m,b),f[a]=g,d.drawingInProgress=!1,d.drawingQueued&&setTimeout(e,h)}};setTimeout(e,h)}},this.configureContextDefaults=function(a,b){a.lineJoin="bevel",a.miterLimit=429496656,a.lineWidth=this.defaultLineWidth/b},this.configureContext=function(a,b,c,d){if("object"!=typeof d)return!0;if(d.visible===!1)return!1;if(Array.isArray(d.dashes)&&(a.setLineDash(d.dashes),"dashOffset"in d&&(a.lineDashOffset=d.dashOffset)),"cap"in d&&(a.lineCap=d.cap),"join"in d&&(a.lineJoin=d.join),"miterLimit"in d&&(a.miterLimit=d.miterLimit),"lineWidth"in d&&(a.lineWidth=d.lineWidth/b),"opacity"in d&&(a.globalAlpha=d.opacity),"object"==typeof d.shadow)if(a.shadowColor=d.shadow.colour,d.shadow.scale){var e=c*b;a.shadowBlur=d.shadow.blur*e,a.shadowOffsetX=d.shadow.xOffset*e,a.shadowOffsetY=d.shadow.yOffset*e}else a.shadowBlur=d.shadow.blur*c,a.shadowOffsetX=d.shadow.xOffset*c,a.shadowOffsetY=d.shadow.yOffset*c;return!0},this.setFillStyle=function(a,b){b instanceof EdenUI.plugins.Canvas2D.FillStyle?a.fillStyle=b.getColour(a):a.fillStyle=b},this.initZoneFromDrawingOpts=function(b,c){var d;if(!(b instanceof Object))return void 0;if(b.zone===!1)return void 0;if(d=b.name,void 0===d&&b.zone===!0)return root.currentObservableName();if(a.eden.isValidIdentifier(d)){var e=root.lookup(d+"_click");void 0===e.value()&&e.assign(!1,root.scope,root.lookup(c))}return d},this.initZoneFromName=function(b,c){if(a.eden.isValidIdentifier(b)){var d=root.lookup(b+"_click");void 0===d.value()&&d.assign(!1,root.scope,root.lookup(c))}return b},this.findDrawableHit=function(a,b,c,d,e,f){var g=root.lookup(b).value();if(!Array.isArray(g))return void 0;var h,i,j=canvases[a],k=j.getContext("2d"),l=root.lookup("_view_"+a+"_scale").value();e?(h=0,i=1):(h=g.length-1,i=-1);for(var m=h;e?m<g.length:m>=0;m+=i){var n=g[m];if("object"==typeof n){var o=n.name;if(f||void 0!==o){var p=n.isHit;if(void 0!==p){k.save();var q=n.isHit(k,l,c,d);if(k.restore(),q)return n}}}}return void 0},this.findDrawableHit2=function(a,b,c,d,e){var f,h;if(a instanceof Symbol){h=a.name.slice(1);for(var i in g[h]){f=i;break}}else{if(f=a,!(f in canvases))return void 0;h=canvases[f].pictureObs}return this.findDrawableHit(f,h,b,c,d,e)},this.findAllDrawablesHit=function(a,b,c,d){var e,f,h;if(a instanceof Symbol){f=a.name.slice(1);for(var i in g[f]){e=i;break}h=a.value()}else{if(e=a,!(e in canvases))return void 0;f=canvases[e].pictureObs,h=root.lookup(f).value()}if(!Array.isArray(h))return[];for(var j=canvases[e],k=j.getContext("2d"),l=root.lookup("_view_"+e+"_scale").value(),m=[],n=0;n<h.length;n++){var o=h[n];if("object"==typeof o){var p=o.name;if(d||void 0!==p){var q=o.isHit;if(void 0!==q){k.save();var r=o.isHit(k,l,b,c);k.restore(),r&&m.push(o)}}}}return m};var j={leftButton:!1,middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1};this.createCommon=function(b,g){function h(){var b,d,e=t.value();e instanceof Point?(b=e.x,d=e.y):(b=0,d=0);var f=s.value(),g=u.value();void 0!==g?(g=Math.ceil(u.value()*r.value()*f+b),o.width=g):f>1?o.width=Math.ceil(w.value()*f):o.width=Math.floor(w.value());var h;void 0!==v.value()?h=Math.ceil(v.value()*r.value()*f+d):f>1?h=Math.ceil(x.value()*f):(h=x.value(),
void 0!==g&&g>Math.floor(w.value())&&(h-=a.scrollBarSize),h=Math.floor(h-1)),o.height=h,o.rescale=!0,c.drawPictureForView(n)}function i(){y?(y=!1,o.rescale=!0,c.drawPictureForView(n),B||(B=!0,setTimeout(i,1e3))):(h(),B=!1)}var k,l,m=root.lookup("createView"),n=b,o=canvases[b];void 0===o?(k=$('<div id="'+b+'-canvascontent" class="canvashtml-content"></div>'),k.html('<canvas class="canvashtml-canvas" id="'+b+'-canvas" tabindex="1"></canvas>'),l=k.find(".canvashtml-canvas"),o=l[0],canvases[b]=o,contents[b]=k[0],f[b]={},o.drawingQueued=!1,o.drawingInProgress=!1,o.rescale=!1):(k=$("#"+b+"-canvascontent"),l=k.find(".canvashtml-canvas"));var p=root.lookup("_view_"+n+"_observable");p.addJSObserver("refreshView",function(b,c){a.plugins.Canvas2D.setPictureObs(n,c)});var q=root.lookup("_view_"+n+"_background_colour");void 0===q.value()&&q.assign("white",root.scope,m),q.addJSObserver("repaintView",function(a,b){c.drawPictureForView(n)});var r=root.lookup("_view_"+n+"_scale"),s=root.lookup("_view_"+n+"_zoom"),t=root.lookup("_view_"+n+"_offset"),u=root.lookup("_view_"+n+"_canvas_right"),v=root.lookup("_view_"+n+"_canvas_bottom"),w=root.lookup("_view_"+n+"_width"),x=root.lookup("_view_"+n+"_height"),y=!1,z=r.value();void 0===z&&(r.assign(1,root.scope,m),z=1),r.addJSObserver("repaintView",h);var A=s.value();void 0===A&&(s.assign(1,root.scope,m),A=1);var B=!1;s.addJSObserver("repaintView",function(a,b){Math.round(100*b);y=!0,i()});var C,D,E=t.value();E instanceof Point?(C=E.x,D=E.y):(t.assign(new Point(0,0),root.scope,m),C=0,D=0),t.addJSObserver("repaintView",h),void 0==u.value()&&u.assign(void 0,root.scope,m),u.addJSObserver("repaintView",h),void 0==v.value()&&v.assign(void 0,root.scope,m),v.addJSObserver("repaintView",h);var F=u.value();F=void 0===F?d:F*z+C;var G=v.value();return G=void 0===G?e:G*z+D,l.on("mousedown",function(a){var b=root.lookup("mouseFollow").value();root.beginAutocalcOff(),j.insideCanvas=!0;var c;switch(a.button){case 0:j.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,Symbol.hciAgent,b),c="Left";break;case 1:j.middleButton=!0,c="Middle";break;case 2:j.rightButton=!0,c="Right";break;case 3:j.button4=!0,c="Button4";break;case 4:j.button5=!0,c="Button5";break;default:c="Unknown"}j.buttonCount=j.leftButton+j.middleButton+j.rightButton+j.button4+j.button5;var d="|";if(j.leftButton&&(d+="Left|"),j.middleButton&&(d+="Middle|"),j.rightButton&&(d+="Right|"),j.button4&&(d+="Button4|"),j.button5&&(d+="Button5|"),root.lookup("mouseButtons").assign(d,root.scope,Symbol.hciAgent,b),root.lookup("mouseButton").assign(c+" down",root.scope,Symbol.hciAgent,b),1==j.buttonCount){var e=root.lookup("mousePosition").value();root.lookup("mouseDownView").assign(n,root.scope,Symbol.hciAgent,b),root.lookup("mouseDown").assign(e,root.scope,Symbol.hciAgent,b);var f=root.lookup("mouseZone").value();root.lookup("mouseDownZone").assign(f,root.scope,Symbol.hciAgent,b)}root.endAutocalcOff()}).on("mouseup",function(b){var c=root.lookup("mouseFollow").value();root.beginAutocalcOff(),j.insideCanvas=!0;var d;switch(b.button){case 0:j.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,Symbol.hciAgent,c),d="Left";break;case 1:j.middleButton=!1,d="Middle";break;case 2:j.rightButton=!1,d="Right";break;case 3:j.button4=!1,d="Button4";break;case 4:j.button5=!1,d="Button5";break;default:d="Unknown"}if(j.buttonCount=j.leftButton+j.middleButton+j.rightButton+j.button4+j.button5,root.lookup("mouseButton").assign(d+" up",root.scope,Symbol.hciAgent,c),0==j.buttonCount){var e=root.lookup("mousePosition").value();root.lookup("mouseButtons").assign("",root.scope,Symbol.hciAgent,c),root.lookup("mouseUp").assign(e,root.scope,Symbol.hciAgent,c),a.plugins.Canvas2D.endClick()}else{var f="|";j.leftButton&&(f+="Left|"),j.middleButton&&(f+="Middle|"),j.rightButton&&(f+="Right|"),j.button4&&(f+="Button4|"),j.button5&&(f+="Button5|"),root.lookup("mouseButtons").assign(f,root.scope,Symbol.hciAgent,c)}root.endAutocalcOff()}).on("contextmenu",function(a){root.lookup("mouseContextMenuEnabled").value()||(a.preventDefault(),a.stopPropagation())}).on("click",function(a){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(a){var b=root.lookup("mouseFollow").value(),c=root.lookup("mouseDoubleClicks"),d=c.value();c.assign(d+1,root.scope,Symbol.hciAgent,b)}).on("wheel",function(a){var b,d=a.originalEvent,e=x.value();b=d.deltaMode==WheelEvent.DOM_DELTA_LINE?c.defaultLineHeight:d.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=d.deltaX?u.value():e:1;var f=root.lookup("mouseFollow").value();if(0!=d.deltaY&&a.ctrlKey&&!a.altKey&&!a.metaKey&&!a.shiftKey){a.preventDefault(),a.stopPropagation(),root.beginAutocalcOff();var g=-d.deltaY*b;if(root.lookup("touchPinchEnabled").value()){var h=root.lookup("touchPinch"),i=h.value();i+=g,h.assign(i,root.scope,Symbol.hciAgent,f)}else{var j=s.value();j=j*(e+2*g)/e,.05>j&&(j=.05),s.assign(j,root.scope,Symbol.hciAgent,f)}return void root.endAutocalcOff()}if(root.lookup("mouseWheelEnabled").value()){if(root.beginAutocalcOff(),0!==d.deltaY&&(!a.ctrlKey||a.altKey||a.metaKey||a.shiftKey)){a.preventDefault(),a.stopPropagation();var k=root.lookup("mouseWheel"),l=k.value(),g=d.deltaY*b;l+=g,k.assign(l,root.scope,Symbol.hciAgent,f),root.lookup("mouseWheelSpeed").assign(g,root.scope,Symbol.hciAgent,f)}if(0!==d.deltaX){a.preventDefault(),a.stopPropagation();var m=root.lookup("touchPanX"),n=m.value(),o=d.deltaX*b;n+=o,m.assign(n,root.scope,Symbol.hciAgent,f),root.lookup("touchPanXSpeed").assign(o,root.scope,Symbol.hciAgent,f)}root.endAutocalcOff()}}).on("mouseout",function(a){j.insideCanvas=!1;var b=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,Symbol.hciAgent,b)}).on("mouseenter",function(a){if(!j.insideCanvas){j.insideCanvas=!0;var b;0==j.buttonCount?b="":(b="|",j.leftButton&&(b+="Left|"),j.middleButton&&(b+="Middle|"),j.rightButton&&(b+="Right|"),j.button4&&(b+="Button4|"),j.button5&&(b+="Button5|"));var c=root.lookup("mouseButtons"),d=c.value();if(b!=d){var e=root.lookup("mouseFollow").value();root.beginAutocalcOff(),c.assign(b,root.scope,Symbol.hciAgent,e),root.lookup("mouseButton").assign("Enter window",root.scope,Symbol.hciAgent,e);var f=root.lookup("mousePressed");f.value()!=j.leftButton&&f.assign(j.leftButton,root.scope,Symbol.hciAgent,e),""==d&&""!=b&&(root.lookup("mouseDown").assign(void 0,root.scope,Symbol.hciAgent,e),root.lookup("mouseDownView").assign(void 0,root.scope,Symbol.hciAgent,e)),root.endAutocalcOff()}}}).on("mousemove",function(a){var b=root.lookup("mouseFollow").value();root.beginAutocalcOff();var d,e,f=root.lookup("mousePosition"),g=root.lookup("_view_"+n+"_scale").value(),h=root.lookup("_view_"+n+"_zoom").value(),i=g*h;if(j.capturing){var k=f.value(),l=a.originalEvent;d=k.x+l.movementX/i,e=k.y+l.movementY/i}else{var m=$(this).offset();d=(a.pageX-Math.round(m.left))/i,e=(a.pageY-Math.round(m.top))/i}var o;o=new Point(d,e),root.lookup("mouseView").assign(n,root.scope,Symbol.hciAgent,b),f.assign(o,root.scope,Symbol.hciAgent,b);var q=p.value();if(void 0!==q){var r,s=c.findDrawableHit(n,q,d,e,!1,!1);r=void 0===s?void 0:s.name,root.lookup("mouseZone").assign(r,root.scope,Symbol.hciAgent,b)}root.endAutocalcOff()}).on("keyup",function(a){var b=a.which,c=!1;if(a.altKey&&!a.shiftKey&&!a.ctrlKey){var d=root.lookup("_view_"+n+"_zoom"),e=d.value();61==b||187==b?(e=1.25*e,c=!0):173==b||189==b?(e/=1.25,c=!0):48==b&&(e=1,c=!0),d.assign(e,root.scope,Symbol.hciAgent)}c&&(a.preventDefault(),a.stopPropagation())}),{initialWidth:F,initialHeight:G,code_entry:k,offsetSym:t,zoomSym:s,widthSym:u,heightSym:v,scaleSym:r,pictureSelectSym:p}},this.createEmbedded=function(b,d,e){var f=b,h=c.createCommon(b,d,e),i=(h.initialWidth,h.initialHeight,h.code_entry),j=h.offsetSym,k=h.zoomSym,l=h.widthSym,m=h.heightSym,n=h.scaleSym;c.setPictureObs(b,e);var o={code_entry:i,destroy:function(){console.log("DESTROY: "+f),delete canvases[f],delete contents[f],delete g[e][f],delete viewsToPictureObs[f]},resize:function(b,d){var g,h,i=j.value();i instanceof Point?(g=i.x,h=i.y):(g=0,h=0);var o,p,q=k.value(),r=document.getElementById(f+"-canvas"),s=!1,t=l.value();if(void 0===t?(o=q>1?Math.ceil(b*q):Math.floor(b),r.width!=o&&(r.width=o,s=!0)):t=Math.ceil(t*n.value()*q+g),void 0===m.value()){if(q>1)p=Math.ceil(d*q);else{p=d,void 0!==t&&t>p&&(p-=a.scrollBarSize);var p=Math.floor(p-1)}p!=r.height&&(r.height=p,s=!0)}s&&c.drawPicture(f,e)}};return o},this.createDialog=function(b,d,e){var h,i=b.slice(0,-7),j=c.createCommon(i,d,e),k=j.initialWidth,l=j.initialHeight,m=j.code_entry,n=j.offsetSym,o=j.zoomSym,p=j.widthSym,q=j.heightSym,r=j.scaleSym,s=j.pictureSelectSym;$('<div id="'+b+'"></div>').html(m).dialog({title:d,width:k+a.scrollBarSize,height:l+a.titleBarHeight,minHeight:120,minWidth:230,dialogClass:"canvas-dialog unpadded-dialog"}),h={confirmClose:!0,destroy:function(){var a=f[i];for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];$(e).detach()}delete canvases[i],delete contents[i];var h=s.value();void 0!==h&&delete g[h][i]},resize:function(b,d){var e,f,g=n.value();g instanceof Point?(e=g.x,f=g.y):(e=0,f=0);var h,j,k=o.value(),l=document.getElementById(i+"-canvas"),m=!1,s=p.value();if(void 0===s?(h=k>1?Math.ceil(b*k):Math.floor(b),l.width!=h&&(l.width=h,m=!0)):s=Math.ceil(s*r.value()*k+e),void 0===q.value()){if(k>1)j=Math.ceil(d*k);else{j=d,void 0!==s&&s>j&&(j-=a.scrollBarSize);var j=Math.floor(j-1)}j!=l.height&&(l.height=j,m=!0)}m&&c.drawPictureForView(i)}};var e=s.value();return void 0!==e&&a.plugins.Canvas2D.setPictureObs(i,e),h},root.lookup("mouseDownZone").addJSObserver("recordClick",function(a,b){if(eden.isValidIdentifier(b)){var c=root.lookup(b+"_click");c.value()===!1&&c.assign(!0,root.scope,Symbol.hciAgent,!0)}}),this.endClick=function(){var a=root.lookup("mouseDownZone").value();if(eden.isValidIdentifier(a)){var b=root.lookup(a+"_click");b.value()===!0&&b.assign(!1,root.scope,Symbol.hciAgent,!0)}},this.canvasNameFromElement=function(a){for(;a;){var b=a.id;if("-canvascontent"==b.slice(-14))return b.slice(0,-14);a=a.parentElement}return null},document.addEventListener("mouseup",function(b){var c=root.lookup("mouseFollow").value();if(root.beginAutocalcOff(),!j.insideCanvas){var d;switch(b.button){case 0:j.leftButton=!1,d="Left";break;case 1:j.middleButton=!1,d="Middle";break;case 2:j.rightButton=!1,d="Right";break;case 3:j.button4=!1,d="Button4";break;case 4:j.button5=!1,d="Button5";break;default:d="Unknown"}j.buttonCount=j.leftButton+j.middleButton+j.rightButton+j.button4+j.button5;var e=root.lookup("mouseButtons");if(0==j.buttonCount&&""!=e.value()){var f=root.lookup("mousePressed"),g=f.value();root.lookup("mouseButton").assign(d+" up",root.scope,Symbol.hciAgent,c),e.assign("",root.scope,Symbol.hciAgent,c),root.lookup("mousePosition").assign(void 0,root.scope,Symbol.hciAgent,c),g&&f.assign(!1,root.scope,Symbol.hciAgent,c),root.lookup("mouseUp").assign(void 0,root.scope,Symbol.hciAgent,c),root.lookup("mouseView").assign(void 0,root.scope,Symbol.hciAgent,c),a.plugins.Canvas2D.endClick()}}root.endAutocalcOff()}),document.addEventListener("mousedown",function(a){if(!j.insideCanvas){switch(a.button){case 0:j.leftButton=!0;break;case 1:j.middleButton=!0;break;case 2:j.rightButton=!0;break;case 3:j.button4=!0;break;case 4:j.button5=!0}j.buttonCount=j.leftButton+j.middleButton+j.rightButton+j.button4+j.button5}}),document.addEventListener("pointerlockchange",function(a){var b=null!==document.pointerLockElement;j.capturing=b;var c=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(b,root.scope,void 0,c)}),a.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:a.viewCategories.visualization,holdsContent:!0};var k;k="/index-dev.html"==document.location.pathname.slice(-15)?"canvas.js-e":"jseden-canvas.min.js-e",a.eden.include("plugins/canvas-html5/"+k,b)},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Page=function(a,b){function c(a){if(!a)return"";if("title"!=a[0])return"";var b,c=$("<div class='page-title "+r+"'></div>"),d=$("<div class='page-title-block'></div>");a[6]&&c.css("height",""+a[6]+"px"),b=a[1]?$("<span class='page-title-text "+r+"'>"+a[1]+"</span>"):$('<img border=0 src="'+a[5]+'"></img>');var e=$("<br/><span class='page-subtitle-text "+r+"'>"+a[2]+"</span>");return d.append(b),d.append(e),c.append(d),void 0!==a[3],c}function d(a){if(!a)return"";if("header"!=a[0])return"";switch(a[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+a[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+a[1]+"</h2>")}}function e(a){var b=typeof a;switch(b){case"string":return a;case"number":return""+a+"px";default:return""}}function f(a,b){for(var c=0;c<b.length;c++)void 0!==b[c]&&A[c]&&(a.style[A[c]]=e(b[c]))}function g(a){var b={};if(void 0===a||""==a)return b;var c=a.split(" "),d=0;"-"==c[0].charAt(0)&&(d=1,b.tagType=c[0].substr(1));for(var e=d;e<c.length;e++){var f=c[e].split("=");f.length>1?('"'==f[1].charAt(0)?f[1]=f[1].slice(1,-1):f[1]=parseInt(f[1]),b[f[0]]=f[1]):b[f[0]]=!0}return b}function h(a){var b=[],c=[];a=a.replace(/\"jseden:([\s\S]*?)\"/g,function(a,b){return"\"javascript: eden.execute2('"+b+"');\""}),a=a.replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden[\S]*>/g,function(a,d,e,f,h){return b.push(e),c.push(g(d)),"$$$$"});var d=a.split("$$$$");if(1==d.length)return a;for(var e=$("<div></div>"),f=0;f<d.length-1;f++)if(e.append($("<div class='page-paragraph'>"+d[f]+"</div>")),void 0===c[f]||void 0===c[f].tagType){var h=b[f].split("\n").length;void 0===c[f].lines&&(c[f].lines=h),void 0===c[f].width&&(c[f].width="50%"),void 0===c[f].box&&(c[f].box=!0);var i=l(["script",c[f]["static"],[b[f]],c[f].name,c[f].box,c[f].lines,!1,c[f]["float"],c[f].width]);e.append(i)}else if(c[f]&&(console.log("Some other view: "+c[f].tagType),"canvas"==c[f].tagType)){var j=m(["canvas",c[f].name,c[f].source,c[f].width,c[f].height,c[f]["float"],c[f].box]);e.append(j)}return e.append($("<div class='page-paragraph'>"+d[d.length-1]+"</div>")),e.get(0)}function i(a){if(a&&"element"==a[0]){var b=a[1],c=a[2],d=a[3],e=a[4],g=a[5],i=a[6],k=(a[7],a[8],a[9],a[10],a[11],a[12]),l=a[13];console.log("Element: "+b);var m;switch(b){case"div":case"span":case"button":case"img":case"p":case"ul":case"ol":case"li":case"br":case"pre":case"h1":case"h2":case"h3":case"a":case"input":m=document.createElement(b);break;default:return void console.error("Invalid element type: "+b)}if(c&&(m.id=c),d&&(m.className=d),e&&"string"==typeof e){var n=h(e);"string"==typeof n?m.innerHTML=n:m.appendChild(n)}return e&&e instanceof Array&&j(m,e),g&&"string"==typeof g&&(m.cssText=g),g&&g instanceof Array&&f(m,g),i&&c&&(m.onclick=function(a){var b=eden.root.lookup(c+"_click");console.log("ELEMENT CLICK"),b.assign(!0,eden.root.scope)}),"img"==b&&k&&(m.src=k),"a"==b&&l&&(m.href=l),m}}function j(a,b){if("string"==typeof b[0]){var c=i(b);return void(c&&a.appendChild(c))}for(var d=0;d<b.length;d++){var c=i(b[d]);c&&a.appendChild(c)}}function k(a){if(!a)return"";if("p"!=a[0])return"";var b;b=a[1]instanceof Array?a[1].join("&nbsp;"):a[1];var c=[];b=b.replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden>/g,function(a,b,d,e,f){return console.log("ATTRIBS: "+b),c.push(d),"$$$$"});var d=b.split("$$$$");if(1==d.length)return $("<div class='page-paragraph'>"+b+"</div>");for(var e=$("<div></div"),f=0;f<d.length-1;f++){e.append($("<div class='page-paragraph'>"+d[f]+"</div>"));var g=c[f].split("\n").length,h=l(["script",!1,[c[f]],void 0,!0,g,!1,!1,"50%"]);e.append(h)}return e.append($("<div class='page-paragraph'>"+d[d.length-1]+"</div>")),e}function l(b){if(b&&"script"==b[0]){var c=b[1],d=b[2],e=b[3],f=b[4],g=b[5],h=b[6],i=b[7],j=b[8];if(void 0===e&&(e="embedded"+z,z++),c){var k;k=f?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>");var l,m=new EdenUI.Highlight(k.get(0));l=d instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(d):d;var n=new Eden.AST(l);m.highlight(n,-1,-1),i&&"none"!=i&&k.css("float",i),"50%"!=j&&("number"==typeof j?k.width(j):k.css("width",j));var o=EdenUI.plugins.ScriptInput.getRequiredHeight(g,!0);return k.height(o),k}var p;y[e]?(p=y[e],p.update(d)):(p=a.views.ScriptInput.embed(e,e,d,h),y[e]=p);var q;q=f?$("<div id='"+e+"-dialog' class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>");var o=EdenUI.plugins.ScriptInput.getRequiredHeight(g,!0);return q.height(o),i&&"none"!=i&&q.css("float",i),"50%"!=j&&("number"==typeof j?q.width(j):q.css("width",j)),p.contents.appendTo(q),q.resizable(),q}}function m(b){var c,d=b[6],f=b[3],g=b[4];if(c=d?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>"),console.log("CREATE CANVAS: "+b[1]+" width="+b[3]+", height="+b[4]),f&&c.css("width",e(f)),g&&c.css("height",e(g)),void 0===x[b[1]]){var h=a.views.Canvas2D.embedded(b[1],b[1],b[2]);x[b[1]]=h,c.append(h.code_entry),w.push(function(){h.resize(b[3],b[4])})}else x[b[1]].code_entry.appendTo(c),w.push(function(){x[b[1]].resize(b[3],b[4])});return"none"!=b[5]&&c.css("float",b[5]),c}function n(a){var b;if(b=a[1]?$("<ul></ul>"):$("<ol></ol>"),a[2]&&a[2]instanceof Array)for(var c=0;c<a[2].length;c++){var d=$("<li>"+a[2][c]+"</li>");b.append(d)}return b}function o(a,b){if(!a)return"";if(!(a instanceof Array))return"";for(var c=$("<div class='page-content "+r+"'></div>"),e=0;e<a.length;e++)if(void 0!==a[e])switch(a[e][0]){case"header":c.append(d(a[e]));break;case"p":c.append(k(a[e]));break;case"script":c.append(l(a[e]));break;case"canvas":c.append(m(a[e]));break;case"break":c.append($("<div class='clear'></div>"));break;case"list":c.append(n(a[e]))}return c}function p(a,b){if(void 0!==b&&b instanceof Array){for(var c in x)x[c].code_entry.detach();for(var d in y)y[d].contents.detach();v.html(""),j(v.get(0),b);for(var e=0;e<w.length;e++)w[e]();w=[]}}function q(a,b){if(void 0!==b&&b instanceof Array){z=0;for(var d in x)x[d].code_entry.detach();for(var e in y)y[e].contents.detach();r=b[2],"default"==r&&(r="page-theme-default"),v.html(""),v.append(c(b[1])),v.append(o(b[3],0));for(var f=0;f<w.length;f++)w[f]();w=[]}}var r,s=a.eden.root.lookup("page"),t=a.eden.root.lookup("document"),u=s.value(),v=$("<div class='main-page page'></div>");$("body").append(v).addClass("page-body");var w=[],x={},y={},z=0,A=["top","bottom","left","right","width","height","background","position","color","border","font","fontSize","fontFamily","fontWeight","borderBottom","borderLeft","borderRight","borderTop","overflow","padding","paddingTop","paddingLeft","paddingRight","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","textShadow"];q(s,u),s.addJSObserver("pageGenerator",q),t.addJSObserver("pageGenerator",p),Eden.Agent.importAgent("plugins/page","default",["enabled"],b)},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";var edenfunctions={};EdenUI.plugins.SymbolViewer=function(a,b){var c=this;$.ajax({url:"library/functions.json",dataType:"json",success:function(a){edenfunctions=a},cache:!1,async:!0}),this.instances=[];var d=function(a,b){for(var c='			<div class="symbollist-search-box-outer"> 				<input type="text" class="symbollist-search symbollist-control" /> 				<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> 				<select id="'+a+'-category-filter" class="symbollist-control"> 					<option value="user">Construal</option>',d=Eden.getSymbolCategories(b),e=0;e<d.length;e++)c=c+'<option value="'+d[e]+'">'+d[e]+"</option>";return c+='<option value="system">Complete Library</option> 					<option value="all">All Sources</option> 				</select>',"obs"==b&&(c=c+'				<select id="'+a+'-type-filter" class="symbollist-control symbollist-rightmost-control"> 					<option value="formulas">Dependencies</option>					<option value="vars">Base Observables</option>					<option value="all" selected="selected">All Kinds</option>				</select>'),c+='			</div> 			<div class="symbollist-results"></div>'};this.createDialog=function(b,e,f){function g(){var b=n.value();return a.regExpFromStr(l,"",!1,b)}function h(a,b){k.search(m.value,g()),"regexp"==b?l.attr("placeholder","search regular expression"):"simple"==b?l.attr("placeholder","simple search"):l.attr("placeholder","search")}var i=b.slice(0,-7),j=$('<div class="symbollist-outer"></div>');j.html(d(b,f));var k=new EdenUI.plugins.SymbolViewer.SymbolList(a.eden.root,j.find(".symbollist-results")[0],f);$dialog=$('<div id="'+b+'"></div>').append(j).dialog({title:e,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"symbollist-dialog"}),c.instances.push(k),k.search("",new RegExp("")),j.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var b,c="edit_"+i,d=["## Selection: "+m.value];for(var e in k.symbols)b=a.eden.root.lookup(e),d.push(b),d.push("");a.createView(c,"ScriptInput",void 0).update(d),a.eden.root.lookup("_view_"+c+"_title").assign("Script for "+i,eden.root.scope,Symbol.hciAgent)});var l=j.find(".symbollist-search-box-outer > .symbollist-search"),m=l[0],n=root.lookup("_view_"+i+"_search_lang");h(n,n.value()),n.addJSObserver("refreshView",h),l.keyup(function(){k.search(m.value,g())}),document.getElementById(b+"-category-filter").addEventListener("change",function(a){k.search(m.value,g(),a.target.value)}),"obs"==f&&document.getElementById(b+"-type-filter").addEventListener("change",function(a){k.search(m.value,g(),void 0,a.target.value)})},this.createObservableDialog=function(a,b){return c.createDialog(a,b,"obs")},this.createFunctionDialog=function(a,b){return c.createDialog(a,b,"func")},this.createAgentDialog=function(a,b){return c.createDialog(a,b,"agent")},this.createSymbolDialog=function(a,b){return c.createDialog(a,b,"all")};var e={},f={},g=!1;this.delay=40;var h=function(){for(x in c.instances){var a,b,d,h=c.instances[x];void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(a=$(h.symresults),b=a.parent(),d=a.scrollTop(),a.detach());for(var i in f){var j=f[i];h.addSymbol(j,i)}for(var i in e)h.updateSymbol(i);void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(a.appendTo(b),a.scrollTop(d))}e={},f={},g=!1},i=function(a,b){var d=a.name.substr(1);b?f[d]=a:e[d]=a,g||(g=!0,setTimeout(h,c.delay))};a.eden.root.addGlobal(i),a.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:a.viewCategories.comprehension,menuPriority:0},a.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:a.viewCategories.comprehension,menuPriority:0},a.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:a.viewCategories.comprehension,menuPriority:0},a.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:a.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),b()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(a,b,c){this.root=a,this.regExp=new RegExp(""),this.type=c,this.category="user",this.customCategory=!1,this.subtypes="all",this.symresults=b,this.symbols={}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(a,b,c,d){this.regExp=b,void 0!==c&&(this.category=c,this.customCategory="user"!=c&&"system"!=c&&"all"!=c),void 0!==d&&(this.subtypes=d),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};var e,f;a in this.root.symbols&&(f=this.root.symbols[a],this.addSymbol(f,a));for(e in this.root.symbols)e!==a&&(f=this.root.symbols[e],this.addSymbol(f,e))},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(a){void 0!==this.symbols[a]&&this.symbols[a].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(a,b){if(this.regExp.test(b)){if(this.customCategory){if(!Eden.isitCategory(b,this.category,this.type))return}else if(Eden.isitSystemSymbol(b)){if("user"==this.category)return}else if("system"==this.category)return;if(void 0!==a.eden_definition&&void 0!==a.definition){if("vars"==this.subtypes)return}else if("formulas"==this.subtypes)return;var c="obs";if(a.definition&&a.eden_definition){var d=a.eden_definition;c=/^proc\s/.test(d)?"agent":/^func\s/.test(d)?"func":"function"==typeof a.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(a.cache.value.toString())?"func":"agent":"obs"}else c="function"==typeof a.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(a.cache.value.toString())?"func":"agent":"obs";var e="all"==this.type||this.type==c;if(e){var f=new EdenUI.plugins.SymbolViewer.Symbol(a,b,c);f.element.appendTo(this.symresults),this.symbols[b]=f}}},EdenUI.plugins.SymbolViewer.Symbol=function(a,b,c){function d(){e.element.removeClass("symbollist-inline-editor"),e.update(),e.element.scrollLeft(0)}switch(this.symbol=a,this.name=b,this.type=c,this.element=$('<div class="symbollist-result-element"></div>'),this.details=void 0,this.update=void 0,c){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var e=this,f=!1;this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||f||(f=!0,setTimeout(function(){if(!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&f){f=!1;var b="edit_"+e.name;edenUI.createView(b,"ScriptInput",void 0).update([a]),edenUI.eden.root.lookup("_view_"+b+"_title").assign("Script for "+e.name,edenUI.eden.root.scope,Symbol.hciAgent)}},350))}),"obs"==c&&this.element.dblclick(function(){function a(){var a=l.get(0).value,b=o.value;";"!=b.slice(-1)&&(b+=";"),eden.execute2(e.name+" "+a+" "+b),d(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0}function c(b){var c=b.which;13==c?a():27==c&&(d(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}if(f=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==e){var g=e.symbol.cache.value;if(void 0!==e.symbol.eden_definition||"boolean"!=typeof g){EdenUI.plugins.SymbolViewer.inlineEditorSymbol=e,e.element.addClass("symbollist-inline-editor");var h=e.element.find(".result_value"),i=e.element.find(".result_separator");h.html("");var j,k;void 0!==e.symbol.eden_definition?(j=e.symbol.eden_definition.replace(new RegExp("^\\s*"+b+"\\s+is\\s+"),""),k="is"):(j=Eden.edenCodeForValue(g),k="=");var l=$("<select></select>");"="==k?(l.append('<option value="is">is</option>'),l.append('<option value="=" selected="selected">=</option>')):(l.append('<option value="is" selected="selected">is</option>'),l.append('<option value="=">=</option>')),i.html(" "),i.append(l);var m=Eden.htmlEscape(j,!0),n=$('<input type="text" value="'+m+'" spellcheck="false" style="width: 100%"/>'),o=n.get(0);n.on("keyup",c),n.on("blur",function(){setTimeout(function(){l.is(document.activeElement)||(d(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===e&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),l.on("keydown",c),l.on("blur",function(){setTimeout(function(){n.is(document.activeElement)||(d(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===e&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),h.append(n);var p=e.element.find(".symbollist-result-inner");p.length>0&&(p.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),o.focus(),o.select();var q=j.slice(0,1);('"'==q||"'"==q||"["==q||"{"==q)&&(o.selectionStart=1,o.selectionEnd=j.length-1)}else g===!0?e.symbol.assign(!1,eden.root.scope,Symbol.hciAgent,!0):e.symbol.assign(!0,eden.root.scope,Symbol.hciAgent,!0)}}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var a,b,c=this.symbol.eden_definition;if(a=void 0===c||/^func\s/.test(c)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name]){this.details=edenfunctions.functions[this.name];var d=Object.keys(this.details.parameters||{});b="<span class='result_value'> ( "+d.join(", ")+" )</span>"}else b="";var e="<span class='result_name'>"+a+"</span>"+b;if(void 0!==c&&!/^func\s/.test(this.symbol.eden_definition)){var f=Eden.htmlEscape(c,!1,!0);f=Eden.htmlEscape("<pre>"+f+";</pre>"),e="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+f+"\")' onmouseleave='EdenUI.closeTooltip()'>"+e+"</span>"}this.element.html(e)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var a,b=this.symbol.value(),c=_formatVal(b);a=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name;var d="<span class='result_name'>"+a+"</span><span class='result_separator'> = </span> <span class='result_value'>"+c+"</span>";if(void 0!==this.symbol.definition){var e=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);e=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+e+";</pre>"),d="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+e+"\")' onmouseleave='EdenUI.closeTooltip()'>"+d+"</span>"}this.element.html(d)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var a,b,c=this.symbol.eden_definition;if(a=void 0===c||/^proc\s/.test(c)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name]){this.details=edenfunctions.procedures[this.name];var d=Object.keys(this.details.parameters||{});b="<span class='result_value'> ( "+d.join(", ")+" )</span>"}else b="";var e="<span class='result_name'>"+a+"</span>"+b;if(void 0!==c&&!/^proc\s/.test(this.symbol.eden_definition)){var f=Eden.htmlEscape(c,!1,!0);f=Eden.htmlEscape("<pre>"+f+";</pre>"),e="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+f+"\")' onmouseleave='EdenUI.closeTooltip()'>"+e+"</span>"}this.element.html(e)},EdenUI.plugins.HTMLContent=function(a,b){this.html=function(b,c){b in a.viewInstances||a.createView(b,"HTMLContent"),$("#"+b+"-dialog-content").html(c)},this.createDialog=function(a,b){var c=$('<div id="'+a+'-content" class="htmlviews-content"></div>');return $('<div id="'+a+'"></div>').html(c).dialog({title:b,width:600,height:450,minHeight:120,minWidth:230}),{confirmClose:!0}},a.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:a.viewCategories.visualization,holdsContent:!0},a.eden.include("plugins/html-views/html.js-e",b)},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(a,b){var c=this;this.createDialog=function(a,b){var c='<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>';$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:300,height:450,minHeight:120,minWidth:230})};var d=function(a,b,c,d,e){var f=function(g,h,i){if(!g.hasOwnProperty("children"))return g.name;var j,k,l,m=g.name,n=g.children;if(b.hasOwnProperty(m)&&2==n.length){j=b[m],k=j.precedence;var o=j.associativity,p=f(n[0],k,j.text),q=f(n[1],k,j.text);if("left"==o){var r=n[1].name;n[1].hasOwnProperty("children")&&2==n[1].children.length&&b.hasOwnProperty(r)&&k==b[r].precedence&&(q="("+q+")")}else{var s=n[0].name;n[0].hasOwnProperty("children")&&2==n[0].children.length&&b.hasOwnProperty(s)&&k==b[s].precedence&&(p="("+p+")")}l=j.whitespace?p+" "+j.text+" "+q:p+j.text+q}else if(a.hasOwnProperty(m))j=a[m],k=j.precedence,l=j.text+f(n[0],k,j.text);else if(c.hasOwnProperty(m))j=c[m],k=j.precedence,l=f(n[0],k,j.text)+j.text;else if(d.hasOwnProperty(m))j=d[m],this.precedence=j.precedence,l=j.code(n,i);else{k=e;for(var t=[],u=0;u<n.length;u++)t.push(f(n[u],0,void 0));
l=m+"("+t.join(", ")+")"}return h>k&&(l="("+l+")"),l};return function(a){return f(a,0,void 0)}},e={};e["="]={precedence:1,associativity:"right",text:"=",whitespace:!0},e["+="]={precedence:1,associativity:"right",text:"+=",whitespace:!0},e["-="]={precedence:1,associativity:"right",text:"-=",whitespace:!0},e["||"]={precedence:3,associativity:"left",text:"||",whitespace:!0},e.or={precedence:3,associativity:"left",text:"or",whitespace:!0},e["&&"]={precedence:4,associativity:"left",text:"&&",whitespace:!0},e.and={precedence:4,associativity:"left",text:"and",whitespace:!0},e["=="]={precedence:5,associativity:"left",text:"==",whitespace:!0},e["!="]={precedence:5,associativity:"left",text:"!=",whitespace:!0},e["<"]={precedence:6,associativity:"left",text:"<",whitespace:!0},e["<="]={precedence:6,associativity:"left",text:"<=",whitespace:!0},e[">"]={precedence:6,associativity:"left",text:">=",whitespace:!0},e[">="]={precedence:6,associativity:"left",text:">",whitespace:!0},e["=~"]={precedence:6,associativity:"left",text:"=~",whitespace:!0},e["!~"]={precedence:6,associativity:"left",text:"!=",whitespace:!0},e["//"]={precedence:7,associativity:"left",text:"//",whitespace:!0},e["+"]={precedence:8,associativity:"left",text:"+",whitespace:!0},e["-"]={precedence:8,associativity:"left",text:"-",whitespace:!0},e["*"]={precedence:9,associativity:"left",text:"*",whitespace:!0},e["/"]={precedence:9,associativity:"left",text:"/",whitespace:!0},e["%"]={precedence:9,associativity:"left",text:"%",whitespace:!0},e["^"]={precedence:11,associativity:"right",text:".",whitespace:!1},e["."]={precedence:14,associativity:"left",text:".",whitespace:!1};var f={};f["-"]={precedence:10,text:"-"},f["!"]={precedence:10,text:"!"},f["&"]={precedence:10,text:"&"},f.not={precedence:10,text:"!"},f["++."]={precedence:11,text:"++"},f["--."]={precedence:11,text:"--"},f["*"]={precedence:12,text:"*"};var g={};g["#"]={precedence:11,text:"#"},g[".++"]={precedence:11,text:"++"},g[".--"]={precedence:11,text:"--"};var h={},i=13;this.convertTreeToEden=d(f,e,g,h,i),h["?"]={precedence:2,code:function(a){var b=c.convertTreeToEden(a[0]),d=c.convertTreeToEden(a[1]),e=c.convertTreeToEden(a[2]);return b+"? "+d+" : "+e}},h["`...`"]={precedence:13,code:function(a){var b=c.convertTreeToEden(a[0]);return"`"+b+"`"}},h["${{...}}$"]={precedence:13,code:function(a){var b=a[0].name;return"${{ "+b+" }}$"}},h["(...)"]={precedence:13,code:function(a){for(var b=c.convertTreeToEden(a[0]),d=[],e=1;e<a.length;e++)d.push(c.convertTreeToEden(a[e]));return"("+b+")("+d.join(", ")+")"}},h["[...]"]={precedence:13,code:function(a){for(var b=[],d=0;d<a.length;d++)b.push(c.convertTreeToEden(a[d]));return"["+b.join(", ")+"]"}},h["[n]"]={precedence:13,code:function(a){var b=c.convertTreeToEden(a[0]),d=c.convertTreeToEden(a[1]);return b+"["+d+"]"}},h["{...}"]={precedence:13,code:function(a){for(var b=[],d=0;d<a.length-1;d+=2)b.push(a[d].name+": "+c.convertTreeToEden(a[d+1]));return"{"+b.join(", ")+"}"}},h.Point={precedence:13,code:function(a,b){if("."==b){for(var d=[],e=0;e<a.length;e++)d.push(c.convertTreeToEden(a[e]));return"Point("+d.join(", ")+")"}var f=c.convertTreeToEden(a[0]),g=c.convertTreeToEden(a[1]);return"{"+f+", "+g+"}"}},a.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:a.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_observable","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","radiansPerUnit","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelSpeed:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,radiansPerUnit:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showObservables:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0},Eden.systemFunctionNames={Arc:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Object:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,"char":!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,"int":!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_observable:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelDir:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,radiansPerUnit:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,GreyPixelList:!0,hslColour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgbColour:!0,rotatePoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,radiansPerUnit:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.isitSystemSymbol=function(a){return Eden.isitSystemObservable(a)||Eden.isitSystemAgent(a)||Eden.isitSystemFunction(a)},Eden.isitSystemObservable=function(a){return/^_view_/.test(a)?!0:a in Eden.systemObservableNames},Eden.isitSystemAgent=function(a){return/^_View_/.test(a)?!0:a in Eden.systemAgentNames},Eden.isitSystemFunction=function(a){return a in Eden.systemFunctionNames},Eden.isitCategory=function(a,b,c){var d=Eden.symbolCategories[b];return"all"==c?"obs"in d&&a in d.obs||"agent"in d&&a in d.agent||"func"in d&&a in d.func:c in d&&a in d[c]},Eden.getSymbolCategories=function(a){if("all"==a)return Object.keys(Eden.symbolCategories);var b=[];for(var c in Eden.symbolCategories)a in Eden.symbolCategories[c]&&b.push(c);return b},EdenUI.plugins.SymbolLookUpTable=function(a,b){this.createDialog=function(a,b){code_entry=$('<div id="'+a+'-content" class="symbol-lookup-table-content">'+c(a)+"</div>"),$dialog=$('<div id="'+a+'"></div>').html(code_entry).dialog({title:b,width:600,height:450,minHeight:120,minWidth:230})},a.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:a.viewCategories.comprehension,menuPriority:3},this.search=function(b){var c=$("#"+b+"-regexp"),e=a.regExpFromStr(c);document.getElementById(b+"-table-div").innerHTML=d(e,b)};var c=function(a){var b="<input id='"+a+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+a+"')\" placeholder='search' onload='setFocus()' />",c="<div class='upper'>"+b+"</div><div id='"+a+"-table-div' class='lower'>"+d(new RegExp(""),a)+"</div>";return c},d=function(a,b){var c='<tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower"><b>Definition</b></td><td class="lower"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>';tableBodyHTML="";var d,h=[],i={};for(var j in root.symbols)if(d=root.symbols[j],a.test(j)){var k,l,m;if(void 0===d.eden_definition)l="-",k="function"==typeof d.cache.value?"Function":"Observable",m=Eden.htmlEscape(Eden.edenCodeForValue(d.cache.value));else if(l=Eden.htmlEscape(d.eden_definition),0==l.indexOf("proc")){if(Eden.isitSystemAgent(j)&&!new RegExp("\\b"+j+"\\b").test(a.source))continue;k="Agent",m=""}else if(0==l.indexOf("func")){if(Eden.isitSystemFunction(j)&&!new RegExp("\\b"+j+"\\b").test(a.source))continue;k="Function",m=""}else k="Dependency",m=Eden.htmlEscape(Eden.edenCodeForValue(d.cache.value));h.push([d,j,k,l,m]),i[j]=!0}for(var n=0;n<h.length;n++){var o=h[n];d=o[0];var p=e(d.observees,i,b),q=e(d.dependencies,i,b),r=p;""!=p&&""!=q&&(r+=", "),r+=q;var s=e(d.observers,i,b),t=e(d.subscribers,i,b),u=s;""!=s&&""!=t&&(u+=", "),u+=t;var v=f(d.dynamicDependencyTable,i,b),w=d.last_modified_by?d.last_modified_by:"Not yet defined";w=g(w,i,b);var x=Object.keys(d.jsObservers).join(", "),y="<tr id='"+b+"-symbol-"+o[1]+'\'><td class="lower"><p>'+o[1]+'</p></td><td class="lower"><p>'+o[2]+'</p></td><td class="lower"><p>'+o[3]+'</p></td><td class="lower"><p>'+o[4]+'</p></td><td class="lower"><p>'+r+'</p></td><td class="lower"><p>'+u+'</p></td><td class="lower"><p>'+v+'</p></td><td class="lower"><p>'+w+'</p></td><td class="lower"><p>'+x+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(o[1])?tableBodyHTML+=y:tableBodyHTML=y+tableBodyHTML}return"<table>"+c+tableBodyHTML+"</table>"},e=function(a,b,c){var d=[];for(var e in a){var f=e.slice(1);d.push(g(f,b,c))}return d.join(", ")},f=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];void 0===f&&(f=""),d.push(g(f,b,c))}return d.join(", ")},g=function(a,b,c){return"*"==a[0]||"include"==a||"Not yet defined"==a?a:a in b?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+c+"-symbol-"+a+"')\">"+a+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+c+"', '"+a+"')\">"+a+"</a>"};this.addSymbolToSearch=function(b,c){var d,e=document.getElementById(b+"-regexp");d="false"==a.getOptionValue("optSimpleWildcards")?e.value+"|^"+c+"$":e.value+" "+Language.ui.search.disjunction+" "+c,e.value=d,this.search(b)},this.jump=function(a){var b=location.href;location.href="#"+a,history.replaceState(null,null,b)},b()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";var edenfunctions={};SymbolMeta=function(a){this.symbol=a,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(a){var b=0,c=0,d=.1;for(var e in this.symbol.dependencies){b++,d+=(1-d)*SymbolMeta.DependencyComplexityRate;var f=e.substr(1);void 0!==a.meta[f]&&a.meta[f].interestingness>=a.minInteresting()&&c++}return d-=b*SymbolMeta.DependencyChangeProbability,0!=b&&(d=.5*d+.5*(c/b)),0>d?0:d},SymbolMeta.prototype.subscriberInterestingness=function(a){var b=0,c=0,d=0;for(var e in this.symbol.subscribers){b++,d+=(1-d)*SymbolMeta.SubscriberRate;var f=e.substr(1);void 0!==a.meta[f]&&a.meta[f].interestingness>=a.minInteresting()&&c++}return d=1-d,0!=b&&(d=.5*d+.5*(c/b)),d},SymbolMeta.prototype.nameInterestingness=function(){var a=this.symbol.name.substr(1);return"_"==a[0]?.5:/\d/.test(a)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(a){var b=0;b=this.dependencyInterestingness(a)*this.subscriberInterestingness(a)*this.nameInterestingness()*this.significance,this.interestingness=b},EdenUI.plugins.ObservableMining=function(a,b){var c=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];var d=function(a){var b='<div class="symbolframer-results"></div>';return b};this.createDialog=function(a,b){var e=(a.slice(0,-7),$("<div></div>"));e.html(d(a)),c.symresults=e.find(".symbolframer-results")[0],$dialog=$('<div id="'+a+'"></div>').html(e).dialog({title:b,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var e=void 0,f=function(){if(void 0!==c.symresults){var a=$(c.symresults).parent();$(c.symresults).detach();for(var b=0;b<c.symbolsui.length;b++)if(c.symbolsui[b].meta.dodelete)c.symbolsui.splice(b,1);else if(0==c.symbolsui[b].meta.isinteresting){var d=c.symbolsui[b].element;c.symbolsui[b].element.hide("drop",{direction:"right"},"slow",function(){d.remove()}),c.symbolsui.splice(b,1)}for(var g=c.minInteresting(),h=c.maxInteresting(),b=0;b<c.interesting.length;b++){for(var i=!1,j=0;j<c.symbolsui.length;j++)if(c.symbolsui[j].meta==c.interesting[b]){i=!0;break}if(!i){var k=new EdenUI.plugins.ObservableMining.Symbol;c.symbolsui.push(k),k.element.appendTo(c.symresults),k.symbol=c.interesting[b].symbol;var l=k.symbol.name.substr(1);k.name=l,k.meta=c.interesting[b],k.outofdate=!0,k.symbolChanged=e}}for(var b=0;b<c.symbolsui.length;b++)c.symbolsui[b].update(g,h);$(c.symresults).appendTo(a)}for(var b=0;b<c.interesting.length;b++)c.interesting[b].interestingness*=SymbolMeta.DecayRate;setTimeout(f,c.delay)};f(),e=function(a,b){var d=a.name.substr(1),e=c.meta[d];if(void 0!==c.symresults){if(a.definition&&a.eden_definition){var f=a.eden_definition;if(/^proc\s/.test(f))return;if(/^func\s/.test(f))return;if("function"==typeof a.cache.value)return}else if("function"==typeof a.cache.value)return;if((b||void 0===e)&&(c.meta[d]=new SymbolMeta(a),e=c.meta[d]),e.update(c),0==e.isinteresting&&(c.interesting.sort(function(a,b){return b.interestingness-a.interestingness}),e.interestingness>=c.minInteresting())){c.interesting.length;if(c.interesting.length==c.limitInteresting){var g=c.interesting[c.interesting.length-1];g.isinteresting=!1,c.interesting.pop()}c.interesting.push(e),e.isinteresting=!0,e.significance*=SymbolMeta.SigInterestingRate,c.interesting.sort(function(a,b){return b.interestingness-a.interestingness})}}},a.eden.root.addGlobal(e),a.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:a.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),b()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return this.interesting.length>0?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return this.interesting.length>0?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var a=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==a.editing&&(a.editing=!1,a.element.find("textarea").remove(),a.element.animate({height:"20px"},"fast"))}).click(function(){if(!a.editing){var b;b="function"==typeof a.symbol.value()&&void 0!==a.symbol.eden_definition?a.symbol.eden_definition:a.symbol.definition?a.symbol.eden_definition+";":a.name+" = "+Eden.edenCodeForValue(a.symbol.value())+";",a.element.animate({height:"60px"},{duration:200,complete:function(){var c=$('<textarea class="mine_edit_box" style="display: none"></textarea>');c.val(b),c.appendTo(a.element),c.show("fast")}}),a.editing=!0}}).draggable({distance:40,axis:"x",scroll:!1,drag:function(b,c){c.position.left>150?a.dodelete=!0:a.dodelete=!1},revert:function(b,c){return!a.dodelete},stop:function(b,c){a.dodelete&&(a.meta.significance*=SymbolMeta.SigDeleteRate,a.symbolChanged(a.symbol,!1),a.element.hide("drop",{direction:"right"},"slow",function(){a.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(a,b){if(void 0!==this.symbol){0==b&&(b=1);var c,d=(this.meta.interestingness-a)*(1/(b-a)),e=Math.round(8+12*d),f=this.symbol.value(),g=_formatFramerVal(f);c=void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name;var h="<span>"+c+"</span><span class='result_separator'> = </span> <span class='result_value'>"+g+"</span>";if(void 0!==this.symbol.definition){var i=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);i=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+i+";</pre>"),h="<span onmouseenter='EdenUI.showTooltip(event, \""+i+"\")' onmouseleave='EdenUI.closeTooltip()'>"+h+"</span>"}var j=this.element.find(".observable");j.html(h),j.css({"font-size":e+"px"})}},EdenUI.plugins.ScriptGenerator=function(a,b){function c(a,b){for(var c=a.length;b>c;c++)a+=" ";return a}var d=this;this.createDialog=function(b,c){var d,f=b.slice(0,-7),g=$('<div class="script-generator"></div>'),h=$("<div></div>");g.append(h);var i=$('<div class="script-generator-controls"></div>');h.append(i);var j=$('<div class="script-generator-controls" style="float: right"></div>');h.append(j);var k=$('<textarea class="script-generator-code" readonly="readonly" spellcheck="false"></textarea>');g.append(k);var l=$("<select></select>");i.append(l);var m=$('<input placeholder="excluded symbols"/>');i.append(m);var n=$('<input type="checkbox" />');d=$("<label>Unicode strings</label>"),d.prepend(n),j.append(d);var o=n.get(0);o.checked="false"!==a.getOptionValue("optUnicode");var p=$('<input type="checkbox" />');d=$("<label>Preserve screen layout</label>"),d.prepend(p),j.append(d);var q=p.get(0),r=$("<button>Regenerate Script</button>");j.append(r);var s=function(){l.html('<option value="">Working Script</option>');for(var b=a.eden.getAllIncludedURLs(),c=0;c<b.length;c++){var d,e=b[c],f=/([^/]+)\.(js)?(-?e)?$/.exec(e);null===f&&(f=/([^/]*)\/?$/.exec(e)),d=f[1],"run"==d&&(f=/(^|\/)([^/]*)\/[^/]*$/.exec(e),null!==f&&(d=f[2]+"/run"));var g=$('<option value="'+e+'">'+d+"</option>");l.append(g)}},t=function(){var b;""!=m[0].value&&(b=a.regExpFromStr(m)),k.html(e(b,o.checked,q.checked,f))};l.on("change",function(a){var b=a.target.value;return""==b?void t():void $.ajax({url:b,dataType:"text",success:function(a){k.html(a)}})}),m.on("keyup",t),n.on("change",function(b){a.setOptionValue("optUnicode",b.target.checked),t(b)}),p.on("change",t),r.click(function(){s(),t()}),s(),t(),$('<div id="'+b+'"></div>').html(g).dialog({title:c,width:790,height:700,minHeight:120,minWidth:230})};var e=function(a,b,c,e){for(var f=d.generateScriptLines(a,b,c,e),g="",h=0;h<f.length;h++)g=g+Eden.htmlEscape(f[h],!0)+"\n";return g},f={header1:"## This is a JS-EDEN script automatically generated using the environment's script generator feature.",header2:"## JS-EDEN is an open source environment for making construuals based on research, principles and",header3:"## work conducted at University of Warwick.",homePage:"## Web site: https://github.com/EMGroup/js-eden",include:"## Include Files:",autocalcOff:"## Turn off automatic calculation until the construal is fully loaded.",assignments:"## Observable Assignments:",definitions:"## Observable Definitions:",procedures:"## Action Definitions:",functions:"## Function Definitions:",picture:"## Picture Definition:",views:"## View Configuration:",autocalcOn:"## Turn on automatic calculation and execute any triggered actions pending.",impliedByExecute:"## Definitions implied by loading the original script (execute procedure):",impliedOther:"## Definitions implied by loading the original script (other):",end:"## End of automatically generated script."};this.generateScriptLines=function(b,d,e,g){var h=new RegExp("^_view_"+g+"_"),i=["input","picture","projects"],j=[],k=[],l=[],m=[],n=[],o=[],p=[],q="autocalc = 1;",r="autocalc = 0;",s=32,t=Symbol.hciAgent.name,u=root.lookup("picture").eden_definition;if(void 0===u?u="picture is [];":u+=";",void 0===b||!b.test("_views_list")){var v=[];if(e)for(var w in a.activeDialogs)w!=g&&v.push(w);else for(var w in a.activeDialogs)a.views[a.activeDialogs[w]].holdsContent&&v.push(w);for(var x=0;x<i.length;x++){var w=i[x];-1===v.indexOf(w)&&v.push(w)}v.length!=i.length&&p.push('_views_list = ["'+v.join('", "')+'"];')}for(var y in root.symbols){var z=!1;if(void 0===b||!b.test(y)){var A=root.symbols[y],B=!1;if("include"!=A.last_modified_by&&"system"!=A.last_modified_by&&"createView"!=A.last_modified_by&&!/^(autocalc|picture|randomIndex|randomGeneratorState|screenWidth|screenHeight)$/.test(y)&&!(/^(mouse|touch)[A-Z]/.test(y)&&A.last_modified_by===t||/_click(ed)?$/.test(y)&&void 0===A.eden_definition||/^_(View|views)_/.test(y))){if(/^_view_/.test(y)){if(h.test(y))continue;if(!e){if(/_(x|y|width|height|title|zoom)$/.test(y))continue;z=!0;for(var x=0;x<v.length;x++){var w=v[x];if(new RegExp("^_view_"+w+"_").test(y)){z=!1;break}}if(z)continue}B=!0}if(y in this.baseConstrualSymbols){var C=this.baseConstrualSymbols[y];if(A.last_modified_by==C.last_modified_by){var D=void 0;if(void 0!==C.eden_definition?A.eden_definition==C.eden_definition&&void 0!==A.definition&&(D=A.eden_definition+";"):A.cached_value===C.cached_value&&(D=y+" = "+Eden.edenCodeForValue(A.cached_value)+";"),void 0!==D){"execute"==A.last_modified_by?(D="  "+D.replace(/\n/g,"\n"),n.push(D)):(D=c("  "+D.replace(/\n/g,"\n  "),s)+"  ## Set by "+A.last_modified_by+".",o.push(D));continue}}}if(void 0!==A.last_modified_by)if(B)void 0!==A.eden_definition&&void 0!==A.definition?p.push(A.eden_definition+";"):p.push(y+" = "+Eden.edenCodeForValue(A.cached_value)+";");else if(void 0!==A.eden_definition&&void 0!==A.definition)/^func\s/.test(A.eden_definition)?m.push(A.eden_definition):/^proc\s/.test(A.eden_definition)?l.push(A.eden_definition):j.push(A.eden_definition+";");else{var E,F=A.cached_value;if(!d&&"string"==typeof F&&/[^ -~\t\n]/.test(F)){var G=F.replace(/[^ -~\t\n]/g,function(a){return"&#"+a.charCodeAt(0)+";"});E="decodeHTML("+Eden.edenCodeForValue(G)+")"}else E=Eden.edenCodeForValue(F);k.push(y+" = "+E+";")}else o.push(c("  "+y+" = @;",s)+"  ## Referenced but not defined.")}}}void 0===root.lookup("randomSeed").value()||void 0!==b&&b.test("randomIndex")||k.push("randomIndex = "+root.lookup("randomIndex").value()+";");var H=[];H.push(f.header1),H.push(""),H.push(f.header2),H.push(f.header3),H.push(f.homePage),H.push("");var I=eden.getIncludedURLs();if(I.length>0){H.push(f.include);for(var x=0;x<I.length;x++)H.push('include("'+I[x]+'");');H.push("")}H.push(f.autocalcOff),H.push(r),H.push(""),H.push(f.functions);for(var x=0;x<m.length;x++)H.push(m[x]),x!==m.length-1&&H.push("");H.push(""),H.push(f.assignments);for(var x=0;x<k.length;x++)H.push(k[x]);H.push(""),H.push(f.definitions);for(var x=0;x<j.length;x++)H.push(j[x]);H.push(""),H.push(f.procedures);for(var x=0;x<l.length;x++)H.push(l[x]),x!==l.length-1&&H.push("");if(H.push(""),void 0!==b&&b.test("picture")||(H.push(f.picture),H.push(u),H.push("")),p.length>0){H.push(f.views);for(var x=0;x<p.length;x++)H.push(p[x]);H.push("")}if(H.push(f.autocalcOn),H.push(q),H.push(""),n.length>0||o.length>0){if(H.push(f.impliedByExecute),n.length>0){H.push("/*");for(var x=0;x<n.length;x++)H.push(n[x]);H.push("*/")}if(H.push(""),o.length>0){H.push(f.impliedOther),H.push("/*");for(var x=0;x<o.length;x++)H.push(o[x]);H.push("*/"),H.push("")}}return H.push(f.end),H},this.baseConstrualSymbols={},this.changeListener=function(a,b){var c=a.last_modified_by;if(!b&&"include"!=c){var e=a.name.slice(1);void 0!==a.eden_definition&&void 0!==a.definition?d.baseConstrualSymbols[e]={eden_definition:a.eden_definition,last_modified_by:c}:d.baseConstrualSymbols[e]={cached_value:a.cached_value,last_modified_by:c}}},a.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(a,b){root.removeGlobal(d.changeListener)}),this.baseConstrualURL="",a.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:a.viewCategories.history},b()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(a){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(a,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=a)})},function(){"use strict";var a,b=this;a="undefined"!=typeof exports?exports:b.Springy={};var c=a.Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]},d=a.Node=function(a,b){this.id=a,this.data=void 0!==b?b:{}},e=a.Edge=function(a,b,c,d){this.id=a,this.source=b,this.target=c,this.data=void 0!==d?d:{}};c.prototype.addNode=function(a){return a.id in this.nodeSet||this.nodes.push(a),this.nodeSet[a.id]=a,this.notify(),a},c.prototype.addNodes=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=new d(b,{label:b});this.addNode(c)}},c.prototype.addEdge=function(a){var b=!1;return this.edges.forEach(function(c){a.id===c.id&&(b=!0)}),b||this.edges.push(a),a.source.id in this.adjacency||(this.adjacency[a.source.id]={}),a.target.id in this.adjacency[a.source.id]||(this.adjacency[a.source.id][a.target.id]=[]),b=!1,this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===c.id&&(b=!0)}),b||this.adjacency[a.source.id][a.target.id].push(a),this.notify(),a},c.prototype.addEdges=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=this.nodeSet[b[0]];if(void 0==c)throw new TypeError("invalid node name: "+b[0]);var d=this.nodeSet[b[1]];if(void 0==d)throw new TypeError("invalid node name: "+b[1]);var e=b[2];this.newEdge(c,d,e)}},c.prototype.newNode=function(a){var b=new d(this.nextNodeId++,a);return this.addNode(b),b},c.prototype.newEdge=function(a,b,c){var d=new e(this.nextEdgeId++,a,b,c);return this.addEdge(d),d},c.prototype.loadJSON=function(a){("string"==typeof a||a instanceof String)&&(a=JSON.parse(a)),("nodes"in a||"edges"in a)&&(this.addNodes.apply(this,a.nodes),this.addEdges.apply(this,a.edges))},c.prototype.getEdges=function(a,b){return a.id in this.adjacency&&b.id in this.adjacency[a.id]?this.adjacency[a.id][b.id]:[]},c.prototype.removeNode=function(a){a.id in this.nodeSet&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;b>=0;b--)this.nodes[b].id===a.id&&this.nodes.splice(b,1);this.detachNode(a)},c.prototype.detachNode=function(a){var b=this.edges.slice();b.forEach(function(b){try{(b.source.id===a.id||b.target.id===a.id)&&this.removeEdge(b)}catch(c){}},this),this.notify()},c.prototype.removeEdge=function(a){for(var b=this.edges.length-1;b>=0;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency){for(var d in this.adjacency[c]){for(var e=this.adjacency[c][d],f=e.length-1;f>=0;f--)this.adjacency[c][d][f].id===a.id&&this.adjacency[c][d].splice(f,1);0==this.adjacency[c][d].length&&delete this.adjacency[c][d]}j(this.adjacency[c])&&delete this.adjacency[c]}this.notify()},c.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new d(a.id,a.data)))},this),a.edges.forEach(function(a){var c=b[a.from],d=b[a.to],f=a.directed?f=a.type+"-"+c.id+"-"+d.id:c.id<d.id?a.type+"-"+c.id+"-"+d.id:a.type+"-"+d.id+"-"+c.id,g=this.addEdge(new e(f,c,d,a.data));g.data.type=a.type},this)},c.prototype.filterNodes=function(a){var b=this.nodes.slice();b.forEach(function(b){a(b)||this.removeNode(b)},this)},c.prototype.filterEdges=function(a){var b=this.edges.slice();b.forEach(function(b){a(b)||this.removeEdge(b)},this)},c.prototype.addGraphListener=function(a){this.eventListeners.push(a)},c.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var f=a.Layout={};f.ForceDirected=function(a,b,c,d){this.graph=a,this.stiffness=b,this.repulsion=c,this.damping=d,this.nodePoints={},this.edgeSprings={}},f.ForceDirected.prototype.point=function(a){if(!(a.id in this.nodePoints)){var b=void 0!==a.data.mass?a.data.mass:1;this.nodePoints[a.id]=new f.ForceDirected.Point(h.random(),b);
}return this.nodePoints[a.id]},f.ForceDirected.prototype.spring=function(a){if(!(a.id in this.edgeSprings)){var b=void 0!==a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);if(d.forEach(function(a){c===!1&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this),c!==!1)return new f.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);if(d.forEach(function(a){c===!1&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this),c!==!1)return new f.ForceDirected.Spring(c.point2,c.point1,0,0);this.edgeSprings[a.id]=new f.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,this.stiffness)}return this.edgeSprings[a.id]},f.ForceDirected.prototype.eachNode=function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})},f.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})},f.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})},f.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,c){if(b!==c){var d=b.p.subtract(c.p),e=d.magnitude()+.1,f=d.normalise();b.applyForce(f.multiply(this.repulsion).divide(e*e*.5)),c.applyForce(f.multiply(this.repulsion).divide(e*e*-.5))}})})},f.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),d=b.normalise();a.point1.applyForce(d.multiply(a.k*c*-.5)),a.point2.applyForce(d.multiply(a.k*c*.5))})},f.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(this.repulsion/50))})},f.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping),c.a=new h(0,0)})},f.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})},f.ForceDirected.prototype.totalEnergy=function(a){var b=0;return this.eachNode(function(a,c){var d=c.v.magnitude();b+=.5*c.m*d*d}),b};var g=function(a,b){return function(){return a.apply(b,arguments)}};a.requestAnimationFrame=g(b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a,c){b.setTimeout(a,10)},b),f.ForceDirected.prototype.start=function(b,c){var d=this;this._started||(this._started=!0,this._stop=!1,a.requestAnimationFrame(function e(){d.applyCoulombsLaw(),d.applyHookesLaw(),d.attractToCentre(),d.updateVelocity(.03),d.updatePosition(.03),void 0!==b&&b(),d._stop||d.totalEnergy()<.01?(d._started=!1,void 0!==c&&c()):a.requestAnimationFrame(e)}))},f.ForceDirected.prototype.stop=function(){this._stop=!0},f.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;return this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();(null===b.distance||f<b.distance)&&(b={node:d,point:e,distance:f})}),b},f.ForceDirected.prototype.getBoundingBox=function(){var a=new h(-2,-2),b=new h(2,2);this.eachNode(function(c,d){d.p.x<a.x&&(a.x=d.p.x),d.p.y<a.y&&(a.y=d.p.y),d.p.x>b.x&&(b.x=d.p.x),d.p.y>b.y&&(b.y=d.p.y)});var c=b.subtract(a).multiply(.07);return{bottomleft:a.subtract(c),topright:b.add(c)}};var h=a.Vector=function(a,b){this.x=a,this.y=b};h.random=function(){return new h(10*(Math.random()-.5),10*(Math.random()-.5))},h.prototype.add=function(a){return new h(this.x+a.x,this.y+a.y)},h.prototype.subtract=function(a){return new h(this.x-a.x,this.y-a.y)},h.prototype.multiply=function(a){return new h(this.x*a,this.y*a)},h.prototype.divide=function(a){return new h(this.x/a||0,this.y/a||0)},h.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},h.prototype.normal=function(){return new h(-this.y,this.x)},h.prototype.normalise=function(){return this.divide(this.magnitude())},f.ForceDirected.Point=function(a,b){this.p=a,this.m=b,this.v=new h(0,0),this.a=new h(0,0)},f.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))},f.ForceDirected.Spring=function(a,b,c,d){this.point1=a,this.point2=b,this.length=c,this.k=d};var i=a.Renderer=function(a,b,c,d){this.layout=a,this.clear=b,this.drawEdge=c,this.drawNode=d,this.layout.graph.addGraphListener(this)};i.prototype.graphChanged=function(a){this.start()},i.prototype.start=function(){var a=this;this.layout.start(function(){a.clear(),a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)}),a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})},i.prototype.stop=function(){this.layout.stop()},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}});var j=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}}.call(this),function(){jQuery.fn.springy=function(a){function b(a,b,c,d){var e=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0===e)return!1;var f=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/e,g=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/e;return 0>f||f>1||0>g||g>1?!1:new Springy.Vector(a.x+f*(b.x-a.x),a.y+f*(b.y-a.y))}function c(a,c,d,e,f){var g,h={x:d.x,y:d.y},i={x:d.x+e,y:d.y},j={x:d.x,y:d.y+f},k={x:d.x+e,y:d.y+f};return(g=b(a,c,h,i))?g:(g=b(a,c,i,k))?g:(g=b(a,c,k,j))?g:(g=b(a,c,j,h))?g:!1}var d=this.graph=a.graph||new Springy.Graph,e=a.stiffness||100,f=a.repulsion||5e3,g=a.damping||.5,h=a.nodeSelected||null,i=this[0],j=i.getContext("2d"),k=this.layout=new Springy.Layout.ForceDirected(d,e,f,g),l=k.getBoundingBox(),m={bottomleft:new Springy.Vector(-2,-2),topright:new Springy.Vector(2,2)};Springy.requestAnimationFrame(function t(){m=k.getBoundingBox(),l={bottomleft:l.bottomleft.add(m.bottomleft.subtract(l.bottomleft).divide(10)),topright:l.topright.add(m.topright.subtract(l.topright).divide(10))},Springy.requestAnimationFrame(t)});var n=function(a){var b=l.topright.subtract(l.bottomleft),c=a.subtract(l.bottomleft).divide(b.x).x*i.width,d=a.subtract(l.bottomleft).divide(b.y).y*i.height;return new Springy.Vector(c,d)},o=function(a){var b=l.topright.subtract(l.bottomleft),c=a.x/i.width*b.x+l.bottomleft.x,d=a.y/i.height*b.y+l.bottomleft.y;return new Springy.Vector(c,d)},p=null,q=null,r=null;jQuery(i).mousedown(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});p=q=r=k.nearest(c),null!==p.node&&(r.point.m=1e4,h&&h(p.node)),s.start()}),jQuery(i).dblclick(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});p=k.nearest(c),node=p.node,node&&node.data&&node.data.ondoubleclick&&node.data.ondoubleclick()}),jQuery(i).mousemove(function(a){var b=jQuery(this).offset(),c=o({x:a.pageX-b.left,y:a.pageY-b.top});q=k.nearest(c),null!==r&&null!==r.node&&(r.point.p.x=c.x,r.point.p.y=c.y),s.start()}),jQuery(window).bind("mouseup",function(a){r=null}),Springy.Node.prototype.getWidth=function(){var a=void 0!==this.data.label?this.data.label:this.id;if(this._width&&this._width[a])return this._width[a];j.save(),j.font="16px Verdana, sans-serif";var b=j.measureText(a).width+10;return j.restore(),this._width||(this._width={}),this._width[a]=b,b},Springy.Node.prototype.getHeight=function(){return 20};var s=this.renderer=new Springy.Renderer(k,function(){var a=i.parentNode;null!==a&&(i.height=a.clientHeight,i.width=a.clientWidth),j.clearRect(0,0,i.width,i.height)},function(a,b,e){for(var f=n(b).x,g=n(b).y,h=n(e).x,i=n(e).y,k=new Springy.Vector(h-f,i-g),l=k.normal().normalise(),m=d.getEdges(a.source,a.target),o=d.getEdges(a.target,a.source),p=m.length+o.length,q=0,r=0;r<m.length;r++)m[r].id===a.id&&(q=r);var s=0,t=l.multiply(-((p-1)*s)/2+q*s),u=n(b).add(t),v=n(e).add(t),w=a.target.getWidth(),x=a.target.getHeight(),y=c(u,v,{x:h-w/2,y:i-x/2},w,x);y||(y=v);var z,A=void 0!==a.data.color?a.data.color:"#C0C0C0";z="dashes"in a.data?a.data.dashes:[];var B,C,D=void 0!==a.data.weight?a.data.weight:1;j.lineWidth=Math.max(3*D,.1),B=1+j.lineWidth,C=8;var E,F=void 0!==a.data.directional?a.data.directional:!0;E=F?y.subtract(k.normalise().multiply(.5*C)):v,j.strokeStyle=A,j.setLineDash(z),j.beginPath(),j.moveTo(u.x,u.y),j.lineTo(E.x,E.y),j.stroke(),F&&(j.save(),j.fillStyle=A,j.translate(y.x,y.y),j.rotate(Math.atan2(i-g,h-f)),j.beginPath(),j.moveTo(-C,B),j.lineTo(0,0),j.lineTo(-C,-B),j.lineTo(.8*-C,-0),j.closePath(),j.fill(),j.restore()),void 0!==a.data.label&&(text=a.data.label,j.save(),j.textAlign="center",j.textBaseline="top",j.font="10px Helvetica, sans-serif",j.fillStyle="#5BA6EC",j.fillText(text,(f+h)/2,(g+i)/2),j.restore())},function(a,b){var c=n(b);j.save();var e=a.getWidth();a.getHeight();j.fillStyle="#FFFFFF",j.fillRect(c.x-e/2,c.y-10,e,20),j.setLineDash([]),j.textAlign="left",j.textBaseline="top",j.font="16px Verdana, sans-serif";var f=void 0!==a.data.label?a.data.label:a.id,g=root.lookup(f).eden_definition;void 0==g?j.fillStyle="#0000FF":0==g.toString().indexOf("proc")?j.fillStyle="#FF0000":0==g.toString().indexOf("func")?j.fillStyle="#336600":j.fillStyle="#0000FF",d.re.test(f)&&(j.lineWidth=1,j.strokeStyle="#000000",j.strokeRect(c.x-e/2,c.y-10,e,20)),j.fillText(f,c.x-e/2+5,c.y-8),j.restore()});return s.start(),this}}(),EdenUI.plugins.DependencyMap=function(a,b){var c=this;this.createDialog=function(b,d){function e(){var b;b=""==k.value?/^$/:a.regExpFromStr(j,"",m.checked),c.updateGraph(f,b)}var f=void 0;f=new Springy.Graph,f.previousNodes=[],f.previousEdges=[],f.newNodes=[],f.newEdges=[];var g=$('<div id="'+b+'" style="overflow: hidden"></div>'),h=$("<canvas></canvas>").springy({graph:f,nodeSelected:function(a){}});g.append(h);var i=$('<div class="dependency-map-controls"></div>');g.append(i);var j=$('<input type="text" placeholder="search"/>'),k=j.get(0),l=$('<input type="checkbox" checked="checked"/>'),m=l.get(0);i.append(j),i.append($("<label>Exact matches only </label>").append(l)),j.on("input",e),l.on("change",e),g.on("mouseenter",e),g.dialog({title:d,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(a,b){a.re=b,a.newNodes=[],a.newEdges=[];for(var c in root.symbols){var d=root.symbols[c],e=d.name.slice(1);if(b.test(e)){-1==a.newNodes.indexOf(e)&&a.newNodes.push(e);var f=d.dependencies;for(var g in f){var h=f[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!1])}f=d.dynamicDependencies;for(var g in f){var h=f[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!0])}f=d.observees;for(var g in f){var h=f[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([h,e,!1])}var i=d.subscribers;for(var g in i){var j=i[g],h=j.name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h);var k=d.name in j.dynamicDependencies;a.newEdges.push([e,h,k])}i=d.observers;for(var g in i){var h=i[g].name.slice(1);-1==a.newNodes.indexOf(h)&&a.newNodes.push(h),a.newEdges.push([e,h,!1])}}}if(!arrayCompare(a.previousNodes,a.newNodes)||!arrayCompare(a.previousEdges,a.newEdges)){a.previousNodes=a.newNodes,a.previousEdges=a.newEdges,a.filterEdges(function(a){return!1}),a.filterNodes(function(a){return!1}),a.nodeObjectsStore={};for(var c in a.previousNodes){var l=a.previousNodes[c];a.nodeObjectsStore[l]=a.newNode({label:l},{color:"#6A4A3C"})}for(var g in a.previousEdges){var m=a.previousEdges[g][0],n=a.previousEdges[g][1],o={};a.previousEdges[g][2]&&(o.dashes=[10,10]),a.newEdge(a.nodeObjectsStore[m],a.nodeObjectsStore[n],o)}}},a.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:a.viewCategories.comprehension,menuPriority:2},b()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler",EdenUI.plugins.StateTimeLine=function(a,b){var c=this;this.createDialog=function(b,e){c.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+b+'-content" class="st-content"></div>').append($('<input id="'+b+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){c.ST.states.push(d("partial"));var e=document.getElementById(b+"-regex").value;""==e&&(e="State "+c.ST.nextBlankState),$("#"+b+"-content-states").append("<div id='stdiv"+a.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+e+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+a.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+a.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(b+"-regex").value="",a.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+b+'-content-states"></div>')),$dialog=$('<div id="'+b+'"></div>').html(code_entry).dialog({title:e,width:300,height:450,minHeight:120,minWidth:230})},c.ST={},c.ST.states=[],c.ST.nextBlankState=0,this.deleteState=function(a){$(document.getElementById("stdiv"+a)).remove()},this.changeState=function(b){for(var c in root.symbols)Eden.isitSystemSymbol(root.symbols[c].name.substring(1,root.symbols[c].name.length))||a.plugins.StateTimeLine.ignoreRE.test(root.symbols[c].name.substring(1,root.symbols[c].name.length))||delete root.symbols[c];a.plugins.ScriptInput.submitEdenCode(a.plugins.StateTimeLine.ST.states[b])};var d=function(b){var c=[],d=[],e=[],f=[],g="autocalc = 1;",h="autocalc = 0;",i=root.lookup("picture").eden_definition;void 0==i?i="picture is [];":i+=";";for(var j in root.symbols){var k="@",l="",m=5,n=root.symbols[j],o=n.eden_definition;if(void 0==o&&(o=k),0==o.indexOf("proc")){if(l="(Action)",m=2,"partial"==b&&Eden.isitSystemAgent(j))continue}else if(0==o.indexOf("func")){if(l="(Function)",m=1,"partial"==b&&Eden.isitSystemFunction(j))continue}else if(l="(Observable)",m=0,"partial"==b&&Eden.isitSystemObservable(j))continue;var p=Eden.edenCodeForValue(n.cached_value);if(!a.plugins.StateTimeLine.ignoreRE.test(j))if(1==m)f.push(o);else if(0==m){if(p==k&&o==k)continue;o==k?d.push(j+" = "+p+";"):c.push(o+";")}else 2==m?e.push(o):console.log("oh dear error")}var q=[];q.push(h);for(var r=0;r<d.length;r++)q.push(d[r]);for(var r=0;r<c.length;r++)q.push(c[r]);for(var r=0;r<e.length;r++)q.push(e[r]),q.push("");for(var r=0;r<f.length;r++)q.push(f[r]),q.push("");return q.push(i),q.push(g),q.join("\n")};a.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:a.viewCategories.history},b()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(a,b){this.createDialog=function(b,c){var d={confirmClose:!1},e='<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>';return $dialog=$('<div id="'+b+'"></div>').html(e).dialog({title:c,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){function b(b){var c=a.eden.root,d=c.lookup("definitionOf").definition(c)(b);e.send(d)}if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void console.log("WebSockets not supported");var c="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",e=new WebSocket(c);eden.listenTo("executeBegin",this,function(a,b){"net"!=a&&e.send(b)}),eden.listenTo("beforeAssign",this,function(a,b,c){"net"!=c&&e.send(a.name.slice(1)+"="+Eden.edenCodeForValue(b)+";")}),$("#sl-status").html("<p>Connected to: "+c+"</p>"),e.onerror=function(a){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+c+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),d.confirmClose=!1},e.onmessage=function(a){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(a.data)+"</p>"),eden.execute(a.data,"net","",{name:"/execute"},noop)},e.onopen=function(){d.confirmClose=!0,randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):b("randomSeed"),b("randomGenerator")}}),d},a.views.StateListener={dialog:this.createDialog,title:"State Listener",category:a.viewCategories.extension},a.eden.include("plugins/state-listener/state-listener.js-e",b)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(a,b){var c,d=this,e=!1,f=!1;Eden.Agent.importAgent("lib/dynamic","default",void 0,function(){}),this.createDialog=function(b,e){function g(){f=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")}function h(){function b(b){var c=a.eden.root,d=c.lookup("definitionOf").definition(c)(b);g.send(JSON.stringify({code:d}))}if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void console.log("WebSockets not supported");var e="ws://"+$("#nr-ipaddr").val()+":"+$("#nr-port").val()+"/",g=new WebSocket(e);Eden.Agent.listenTo("executeline",this,function(a,b){if(a){var c=JSON.stringify({action:"executeline",name:a.name,lineno:b});g.send(c)}}),Eden.Agent.listenTo("patch",this,function(a,b,c){if(a){var d=JSON.stringify({action:"patch",name:a.name,patch:b,lineno:c});g.send(d)}}),Eden.Agent.listenTo("owned",this,function(a,b){"net"!=b&&g.send(JSON.stringify({action:"ownership",name:a.name,owned:a.owned}))}),eden.listenTo("beforeAssign",this,function(a,b,c){"net"!=c&&(console.log("ASSIGN: "+a.name+" = "+Eden.edenCodeForValue(b)),g.send(JSON.stringify({action:"assign",symbol:a.name.slice(1),value:b})))}),$("#nr-status").html("<p>Connected to: "+e+"</p>"),g.onopen=function(c){g.send($("#nr-key").val()),i.confirmClose=!0,randomSeedSym=a.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):b("randomSeed"),b("randomGenerator"),f=!0,$("#connectBtn").attr("value","Disconnect"),$("#nr-ipaddr").attr("disabled","disabled"),$("#nr-port").attr("disabled","disabled"),$("#nr-key").attr("disabled","disabled");for(var d in Eden.Agent.agents)Eden.Agent.agents[d].owned&&g.send(JSON.stringify({action:"ownership",name:d,owned:!0}))},g.onerror=function(a){f=!1,$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled"),$("#connectBtn").attr("value","Connect"),$("#nr-status").html("<p>Error connecting to server - please verify server is running at "+e+". For usage instructions please read the comments in the <a href='plugins/network-remote/network-remote-server.js'>network-remote-server.js</a> file.</p>")},d.sendControl=function(a,b){console.log("Send Control: "+a+"= "+b),console.log(b),g.send(JSON.stringify({action:"control",key:a,value:b}))},g.onmessage=function(a){c=JSON.parse(a.data);for(var b=0;b<c.length;b++)switch(line=c[b].code,line.action){case"patch":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(a){a.applyPatch(line.patch,line.lineno)});break;case"ownership":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(a){a.setOwned(line.owned,"net")});break;case"executeline":Eden.Agent.importAgent(line.name,"default",["noexec"],function(a){a.executeLine(line.lineno,!0)});break;case"assign":eden.root.lookup(line.symbol).assign(line.value,eden.root.scope)}}}var i={confirmClose:!1},j='<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>';return $dialog=$('<div id="'+b+'"></div>').html(j).dialog({title:e,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){f?g():h()}),i},this.playCode=function(a){if(void 0===c[a])return void $("#nr-status").html("<p>Replay finished</p>");var b=c[a].time/$("#nr-speedrange").val();b>1e3?($("#nr-status").html("<p>Next line in "+b+" milliseconds</p>"),e=!0):e&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(c[a].code,"net","",{name:"/execute"},noop),d.playCode(a+1)},b)},a.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:a.viewCategories.extension},a.eden.include("plugins/network-remote/network-remote.js-e",b)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(a,b){var c="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");var d=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(d);var d=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(d),this.name="window_name",this.createDialog=function(b,d){""==c&&(c=b);var e=[];viewlayoutstr="View Layout";var f=5*a.gridSizeY,g=3*a.gridSizeX,h=[],i=root.lookup("_views_list").value(),j=this.name;i.forEach(function(b){if(b!=j){var c=root.lookup("_view_"+b+"_x").value(),d=root.lookup("_view_"+b+"_y").value();c="undefined"!=typeof c?c:0,d="undefined"!=typeof d?d:0,h=[b,c,d,root.lookup("_view_"+b+"_width").value()+a.scrollBarSize,root.lookup("_view_"+b+"_height").value()+a.titleBarHeight,root.lookup("_view_"+b+"_title").value()],console.log(h),e.push(h)}});var k="";e.forEach(function(a,b){k+='<li data-row="'+Math.round(a[2]/f)+'" data-col="'+Math.round(a[1]/g)+'" data-sizex="'+Math.round(a[3]/(1*g))+'" data-sizey="'+Math.round(a[4]/(1*f))+'" data-name="'+a[0]+'" data-num="'+b+'">'+a[5]+" ["+a[0]+"]</li>"});var l='<a class="vl-update">Update</a><div class="gridster"><ul>'+k+"</ul></div>";$dialog=$('<div id="'+b+'"></div>').html(l).dialog({title:d,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[g,f],widget_margins:[0,0],min_cols:Math.round($(window).width()/g),max_cols:Math.round($(window).width()/g),helper:"clone",resize:{enabled:!0},serialize_params:function(a,b){return{col:b.col,row:b.row,size_x:b.size_x,size_y:b.size_y,name:b.name,name:$(b.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var b=gridster.serialize(),c=1,d=1;b.forEach(function(a,b){a.col<c&&(c=a.col),a.row<d&&(d=a.row)}),b.forEach(function(b,e){var h="_view_"+b.name+"_y = "+(b.row-d)*f+";_view_"+b.name+"_x = "+(b.col-c)*g+";_view_"+b.name+"_width = "+(b.size_x*g-a.dialogFrameWidth)+";_view_"+b.name+"_height = "+(b.size_y*f-a.dialogFrameHeight)+";";console.log(h),eden.execute(h)})})},a.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:a.viewCategories.environment},b()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(a,b){function c(a,b,c){this.edenVar=a,this.guard=b,this.actions=c}function d(a,b,c,d){this.name=a,this.parameters=b,this.definitions=c,this.actionsArr=d}function e(a,b,c){this.name=a,this.definitions=b,this.actionsArr=c,this.queuedActions=new Array}var f=this;this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(a,b,c,d,e){G(a)}}),c.prototype.toString=function(){return this.guard+" --> "+this.actions},d.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};var g=function(a,b){for(var d=new Array,e=0;e<b.length;e++){var f=new String(b[e]),g=f.split("-->");if(2==g.length){var h="this_g"+d.length;d.push(new c(h,g[0],g[1]))}}return d},h=function(a){var b,c=new Array;a.split("(").length<2?b=a:(c=a.split("(")[1].split(")")[0].split(","),b=a.split("(")[0]);var d=document.getElementById("adm-definitions"),e=[];d.value.length>0&&(e=d.value.split("\n"));var d=document.getElementById("adm-actions"),f=d.value.split("\n"),h=g(b,f);return F(b,c,e,h),0},i=function(){for(var a=document.getElementById("adm-name"),b=a.value.split("(")[0],c=!0,d=0;d<f.templates.length;d++){var e=f.templates[d];e.name==b&&(c=!1)}if(b&&c){var g=h(a.value);-1!=g&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",f.currIndex=-1)}else alert("Please enter a unique name for this template."),a.focus()},j=function(a){if(-1>a?a=f.templates.length-1:a>=f.templates.length&&(a=-1),-1==a)document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="";else{var b=f.templates[a];document.getElementById("adm-name").value=b.name,document.getElementById("adm-definitions").value=b.definitions.join("\n"),document.getElementById("adm-actions").value=b.actionsArr.join("\n")}f.currIndex=a},k=function(a){a>-1&&(alert("Deleting template "+f.templates[a].name),f.templates.splice(a),f.currIndex=a-1,j(f.currIndex))},l=function(a){return'<div id="'+a+'-input" class="adm-input-code">			<div>Name:</div>			<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>			<div>Definitions:</div>			<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>			<div>Actions:</div>			<div><textarea id="adm-actions" class="adm-actions"></textarea></div>		</div>		<div id="adm-results" class="entitylist-results">			<ul id="results"> </ul>		</div>'};this.createTemplateCreator=function(a,b){var c=$("<div></div>");c.html(l(a)),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){i()}},{id:"btn-delete",text:"Delete Template",click:function(){k(f.currIndex)}},{text:"Previous",click:function(){j(f.currIndex-1)}},{text:"Next",click:function(){j(f.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};var m=function(a,b){var c=new Array;for(x in b){var d=b[x];c.push(d.replace(/this/g,a))}return c},n=function(a,b){var d=new Array;for(x in b){var e=b[x],f=e.guard.replace(/this/g,a),g=e.actions.replace(/this/g,a),h=e.edenVar.replace(/this/g,a);d.push(new c(h,f,g))}return d},o=function(a,b){a.value="";for(x in b)b[x].value=""},p=function(a){var b;for(x in f.templates)if(f.templates[x].name==a){b=f.templates[x];break}return b},q=function(){for(var a=document.getElementById("template-menu"),b=a.options[a.selectedIndex].value,c=p(b),d=document.getElementById("entity-name"),e=d.value,g=!0,h=0;h<f.entities.length;h++){var i=f.entities[h];i.name==e&&(g=!1)}if(0==g)return void alert("please enter a unique name for this instantiation");var j=$("#instantiate-params"),k=j.find("input"),l=0,n=new Array;for(x in k){var q=k[x];if("text"==q.type){var s=D(c.parameters[l]),t=D(q.value);n.push(q),eden.executeEden(e+"_"+s+" is "+t+";"),l++}}var v=m(e,c.definitions),w=r(e,v);-1!=w&&(u(e,v,c.actionsArr),alert("Successfully added instantiation of "+b+" as "+e),o(d,n))},r=function(a,b){a=D(a);for(var c=0;c<b.length;c++){var d=D(b[c]);eden.executeEden(a+"_"+d),f.definitions.push(a+"_"+d)}};this.createInstantiator=function(a,b){var c=$("<div></div>");c=$('<div id="template-instantiator">					<div>Templates:</div>					<div>						<select id="template-menu">						</select>					</div>					<div>Entity name:</div>					<div>						<textarea id="entity-name"></textarea>					</div>					<div>Parameters:</div>					<div id="instantiate-params"></div>				</div>'),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){q()}}]}),f.templateList=new EdenUI.plugins.ADM.TemplateList;for(x in f.templates){var d=f.templates[x];f.templateList.addTemplate(d.name,d.parameters)}};var s=function(a){var b,c;for(x in f.entities)if(f.entities[x].name==a){b=f.entities[x],c=x;break}if(null==b)return void alert(a+" doesn't exist to delete.");f.entities.splice(c,1);for(x in f.actionLists)if(f.actionLists[x].entityName==a){c=x,f.actionLists[x].remove();break}null!=f.actionLists&&f.actionLists.splice(c,1),null!=f.entityList&&f.entityList.removeEntity(a)},t=function(a,b,c){var d=p(a);if(null==d)return alert("no template with name "+a),-1;for(x in f.entities)if(f.entities[x].name==c)return alert("Please enter a unique entity name"),-1;if(""==b)var e=[];else if(-1==b.indexOf(","))var e=[b];else var e=b.split(",");if(e.length!=d.parameters.length)return alert("not enough parameters to instantiate "+d),-1;for(x in e){var g=D(d.parameters[x]),h=D(e[x]);eden.executeEden(c+"_"+g+" is "+h+";")}var i=m(c,d.definitions),j=r(c,i);return-1!=j&&u(c,i,d.actionsArr),j},u=function(a,b,c){var d=n(a,c),g=new e(a,b,d);f.entities.push(g);for(x in d){var h=d[x],i=h.edenVar+" is "+h.guard+";";eden.executeEden(i)}if(null!=f.actionLists){var j=new EdenUI.plugins.ADM.ActionsList(a);f.actionLists.push(j),w(g,j)}null!=f.entityList&&f.entityList.addEntity(a,b,d)},v=function(){for(x in f.selectedActions){var b=f.selectedActions[x];if(b=D(b),945==b.charCodeAt(0))if("r"==b[2]){var c=b.split("(")[1];c=c.substring(0,c.length-1),s(c)}else if("i"==b[2]){var d=b.split("(")[1],e=b.split("(")[2].split(")")[0],c=b.split("as")[1],g=t(d,e,c);if(-1==g)break}else alert("Action on another entity must one of α_remove(entity_name), α_r, α_instantiate(template(param_value) as entity_name) or α_i");else eden.executeEden(b+";")}f.selectedActions=new Array,a.plugins.ADM.refreshHumanPerspective()};this.actionPush=function(a){f.selectedActions.push(a)},this.actionRemove=function(a){var b=new Array;for(x in f.selectedActions){var c=f.selectedActions[x];c!=a&&b.push(c)}f.selectedActions=b},this.refreshHumanPerspective=function(){for(x in f.entities){var a,b=f.entities[x];for(y in f.actionLists){var c=f.actionLists[y];if(c.entityName==b.name){a=c;break}}a.clear();var d=[];for(x in b.queuedActions){var e=b.queuedActions[x].split(";"),g=e[0];if(g.length>0){e.splice(0,1);var h=!0;e[0].length>0&&(d.push(e.join(";")),h=!1),a.addAction(g,h)}}b.queuedActions=d,w(b,a)}};var w=function(a,b){for(var c=0;c<a.actionsArr.length;c++){var d=a.actionsArr[c],e=eden.root.lookup(d.edenVar).value();if(e===!0){var f=d.actions.split(";"),g=f[0],h=!0;f.splice(0,1),f[0].length>0&&(a.queuedActions.push(f.join(";")),
h=!1),b.addAction(g,h)}}};this.createHumanPerspective=function(b,c){var d=$("<div></div>");d=$('<div id="human-perspective" class="actionlist"></div>'),$dialog=$('<div id="'+b+'"></div>').html(d).dialog({title:c,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){a.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){v()}}]}),f.actionLists=new Array;for(x in f.entities){var b=f.entities[x].name;f.actionLists.push(new EdenUI.plugins.ADM.ActionsList(b))}a.plugins.ADM.refreshHumanPerspective()};var z=function(){for(x in f.selectedEntities)s(f.selectedEntities[x]);alert("Entities successfully deleted."),f.selectedEntities=new Array};this.entityPush=function(a){f.selectedEntities.push(a)},this.entityRemove=function(a){var b=new Array;for(x in f.selectedEntities){var c=f.selectedEntities[x];c!=a&&b.push(c)}f.selectedEntities=b};var A=function(){return'<div id="entity-list" class="instance-list"></div>'};this.createInstanceList=function(a,b){var c=$("<div></div>");c.html(A()),$dialog=$('<div id="'+a+'"></div>').html(c).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){z()}}]}),f.entityList=new EdenUI.plugins.ADM.EntityList;for(x in f.entities){var d=f.entities[x];f.entityList.addEntity(d.name,d.definitions.join("\n"),d.actionsArr.join("\n"))}};var B=function(a){var b=a.split(":")[1];return D(b.split("(")[0])},C=function(a){var b=a.split(":")[1].split("(")[1];return b.length>1?b.split(")")[0].split(","):[]},D=function(a){for(;32==a.charCodeAt(0)||9==a.charCodeAt(0);)a=a.substring(1,a.length);for(;32==a.charCodeAt(a.length-1)||9==a.charCodeAt(a.length-1);)a=E(a);return a},E=function(a){return a.substring(0,a.length-1)},F=function(a,b,c,e){for(x in f.templates)if(f.templates[x].name==a)return alert("Templates must have unique names."),-1;var h=g(a,e),i=new d(a,b,c,h);return f.templates.push(i),null!=f.templateList&&f.templateList.addTemplate(a,b),1},G=function(a){var b,c=a.split("\n"),d=new Array,e=new Array,f=new Array,g=!1,h=!1,i=!1;for(x in c){var j=c[x];if(j=D(j),""!=j)if(0==i)if("{"==j[0])i=!0,-1!=j.indexOf("name:")&&(b=B(j),d=C(j));else{var k=j.split("(")[0],l=j.split("(")[1].split(")")[0],m=E(D(j.split("as")[1])),n=t(k,l,m);if(-1==n)break}else if(1==g){var o=j.indexOf("}");-1!=o&&(j=E(j),g=!1),j.length>0&&e.push(j)}else if(1==h){var o=j.indexOf("}");-1!=o&&(j=E(j),h=!1),j.length>0&&f.push(j)}else if("}"==j[0]){i=!1;var n=F(b,d,e,f);if(b="",d=new Array,e=new Array,f=new Array,-1==n)return}else if(-1!=j.indexOf("name:"))b=B(j),d=C(j);else if(-1!=j.indexOf("definitions:")||-1!=j.indexOf("defs:")){if(g=!0,j=D(j),j.split("{").length>1){var p=D(j.split("{")[1]);-1!=p.indexOf("}")&&(p=E(p),g=!1),p.length>0&&e.push(p)}}else if(-1!=j.indexOf("actions:")&&(h=!0,j=D(j),j.split("{").length>1)){var p=D(j.split("{")[1]),o=p.indexOf("}");-1!=o&&(p=E(p),h=!1),p.length>0&&f.push(p)}}};this.createAdvancedInput=function(a,b){var c=document.createElement("textarea");c.style.boxSizing="border-box",c.style.width="100%",c.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(c),$dialog=$('<div id="'+a+'"></div>').html($code_entry).dialog({title:b,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var a=c.value;G(a),c.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},a.addViewCategory("adm","Abstract Definitive Machine"),a.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:a.viewCategories.adm},a.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:a.viewCategories.adm},a.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:a.viewCategories.adm},a.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:a.viewCategories.adm},a.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:a.viewCategories.adm},b()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(a,b){var c=new EdenUI.plugins.ADM.Template(a,b);c.element.appendTo(this.templateList),this.templates.push(c)},EdenUI.plugins.ADM.Template=function(a,b){this.template=a,this.element=$("<option value="+a+">"+a+"</option>");var c=this.showParamInput;this.element.click(function(){c(b)});var d=document.getElementById("instantiate-params");""==d.innerHTML&&c(b)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(a){var b=document.getElementById("instantiate-params");b.innerHTML="";for(x in a){var c=a[x],d=document.createElement("label");d.innerHTML=c+":",b.appendChild(d);var e=document.createElement("input");e.type="text",b.appendChild(e);var f=document.createElement("br");b.appendChild(f)}},EdenUI.plugins.ADM.ActionsList=function(a){var b=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+a),this.actionresults.innerHTML="<label><b>Actions for "+a+":</b></label>",b.appendChild(this.actionresults),this.actions=new Array,this.entityName=a},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(a,b){var c=new EdenUI.plugins.ADM.Action(a,b);c.element.appendTo(this.actionresults),this.actions.push(c)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){var a=document.getElementById("human-perspective");a.removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(a,b){var a=a;this.action=a,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var c=!1;this.element.hover(function(){0==c?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==c?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){0==c?(edenUI.plugins.ADM.actionPush(a),$(this).css("backgroundColor","#6666CC"),c=!0):(edenUI.plugins.ADM.actionRemove(a),$(this).css("backgroundColor","white"),c=!1)}),this.update(b)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(a){var b='<li class="type-function"><span class="result_name">';b=1==a?b+this.action+"</span></li>":b+this.action+" ... </span></li>",this.element.html(b)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(a,b,c){var d=new EdenUI.plugins.ADM.Entity(a,b,c);d.element.appendTo(this.entityList),this.entities.push(d)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(a){var b;for(x in this.entities)if(this.entities[x].entity==a){b=x;break}this.entities.splice(b,1);var c=document.getElementById("element-"+a);this.entityList.removeChild(c)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(a,b,c){this.entity=a,this.element=$('<div class="entitylist-element" id=element-'+a+"></div>");var d='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(d);var b=b,c=c,e=!1;this.element.hover(function(){0==e?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==e?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){if(this.innerHTML==d){var f=document.createElement("div");f.innerHTML="<label>Definitions:</label><br>					<textarea disabled>"+b+"</textarea><br>					<label>Actions:</label><br>					<textarea disabled>"+c+"</textarea><br>",this.appendChild(f),edenUI.plugins.ADM.entityPush(a),$(this).css("backgroundColor","#6666CC"),e=!0}else this.innerHTML=d,edenUI.plugins.ADM.entityRemove(a),$(this).css("backgroundColor","white"),e=!1})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var a='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(a)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.SpeechSynthesis=function(a,b){function c(){var a=window.speechSynthesis.paused;window.speechSynthesis.cancel(),a&&window.speechSynthesis.pause()}function d(a,b){if(f)return void(f=!1);var e,g=root.lookup("speak"),h=root.lookup("speakingList"),i=root.lookup("speakingIndex"),j=root.lookup("speaking"),k=root.lookup("speakingID"),l=root.lookup("speakingText"),m=root.lookup("speakingSpeech"),n=root.lookup("speakingCharIndex"),o=h.value(),p=i.value();if(c(),p||(p=1),""!=a){if("finished"==a){var q=l.value();"string"==typeof q&&n.assign(q.length+1,g)}else"interrupted"==a&&(f=!0);e=k.value(),eden.isValidIdentifier(e)&&root.lookup(e+"_status").assign(a,g)}if(b&&p++,n.assign(1,g),root.lookup("speakingTime").assign(0,g),Array.isArray(o)&&p<=o.length){j.value()||j.assign(!0,g);var r=o[p-1];if(!(r instanceof SpeakingWords)||r.cancelled)return void d("",!0);r.prepareUtterance();var s=r.utterance;e=r.id,k.assign(e,g),eden.isValidIdentifier(e)&&root.lookup(e+"_status").assign("speaking",g),l.assign(s.text,g),m.assign(r,g),b&&i.assign(p,g),r.hasBeenSpoken=!0,window.speechSynthesis.speak(s)}else j.assign(!1,g),k.assign("",g),l.assign("",g),m.assign(void 0,g),Array.isArray(o)&&i.assign(o.length+1,g)}function e(a,b){var c,d,e,f,g=window.speechSynthesis.getVoices();a&&(a=a.toLowerCase(),d=a.indexOf("-"),-1!=d?(e=a.slice(0,d),f=!0):(e=a,f=!1)),b&&(c=new RegExp("\\b"+b+"\\b","i"));for(var h=void 0,i=!1,j=!1,k=!1,l=!1,m=0;m<g.length;m++){var n=g[m],o=n.lang,p=!1,q=!1,r=!1;if(a&&o&&(o=o.toLowerCase(),a==o?(p=!0,q=!0):e==o?p=!0:(d=o.indexOf("-"),-1!=d&&o.slice(0,d)==e&&(p=!0))),b&&c.test(n.name)&&(r=!0),(!j&&!o&&!i||!j&&(!o||!a)&&n["default"]||p&&!j||f&&q&&!k||p&&!f&&n["default"]||q&&n["default"]||r&&!l&&(!a||!o&&!j||p))&&(!l||r||p&&!j)){if(i=!p,j=p,k=q,l=r,(!b||l)&&(k||j&&!f)&&n["default"])return n;h=n}}return void 0===h&&(h=g[0]),h}var f=!1;root.lookup("speakingList").addJSObserver("sendToTTS",function(a,b){var c=root.lookup("speak");if(Array.isArray(b)){var e=root.lookup("speakingIndex"),f=e.value();if(f>b.length+1)e.assign(b.length+1,c);else if(f<=b.length){for(var g=1>f?0:f-1;g<b.length;g++){var h=b[g];if(h instanceof SpeakingWords){h.prepareUtterance();var i=h.id;eden.isValidIdentifier(i)&&root.lookup(i+"_status").assign("waiting",c)}}root.lookup("speaking").value()?b[f-1]!==root.lookup("speakingSpeech").value()&&d("interrupted",!1):d("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(a,b){if("speak"!=a.last_modified_by){var c=root.lookup("speakingList").value();if(Array.isArray(c)&&b<=c.length){root.lookup("speaking").value()?d("interrupted",!1):d("",!1);for(var e=b;e<c.length;e++)c[e]instanceof SpeakingWords&&c[e].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(a,b){b?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(b,c,f,g,h,i,j){this.id=b,this.utterance=new window.SpeechSynthesisUtterance(String(c));var k,l,m,n,o,p,q;this.hasBeenSpoken=!1,void 0===g?(p=a.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===p&&(p="native"),m=!0):(p=g,m=!1),this.utterance.volume=h,void 0===i?(k=a.getOptionValue("speechSynthDefaultRate"),null!==k&&(this.utterance.rate=parseFloat(k)),n=!0):(this.utterance.rate=i,n=!1),void 0===j?(k=a.getOptionValue("speechSynthDefaultPitch"),null!==k&&(this.utterance.pitch=parseFloat(k)),o=!0):(this.utterance.pitch=j,o=!1);var r=this;if(Object.defineProperty(this,"text",{get:function(){return r.utterance.text},set:function(a){r.utterance.text=a},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return r.utterance.lang},set:function(a){if(a){var b=a.indexOf("-");-1!=b&&(a=a.slice(0,b+1)+a.slice(b+1).toUpperCase()),r.utterance.lang=a}else r.utterance.lang="";l=!1;var c=e(a,p);r.utterance.voiceURI=c.voiceURI,r.utterance.voice=c},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return p},set:function(a){p=a,m=!1;var b=e(this.utterance.lang,p);r.utterance.voiceURI=b.voiceURI,r.utterance.voice=b},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return r.utterance.volume},set:function(a){r.utterance.volume=a},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return r.utterance.rate},set:function(a){r.utterance.rate=a,n=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return r.utterance.pitch},set:function(a){r.utterance.text=a,o=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return q},set:function(a){q=a,q&&r.id&&root.lookup(r.id+"_status").assign("cancelled",{name:"/SpeakingWords"})},enumerable:!0}),this.toString=function(){var a="SpeakingWords("+Eden.edenCodeForValue(b)+', "'+r.utterance.text+'", ';return l?a+="@, ":a=a+'"'+r.utterance.lang+'", ',m?a+="@, ":a=a+Eden.edenCodeForValue(p)+", ",a=a+r.utterance.volume+", ",n?a+="@, ":a=a+this.utterance.rate+", ",o?a+="@)":a=a+this.utterance.pitch+")",a},void 0===f?(this.lang=a.getOptionValue("speechSynthDefaultLanguage"),l=!0):this.lang=f,eden.isValidIdentifier(b)){var s=root.lookup(b+"_status");void 0===s.value()&&s.assign("not queued",{name:"/speakingWords"})}this.prepareUtterance=function(){if(r.hasBeenSpoken&&!("chrome"in window)){var a=new window.SpeechSynthesisUtterance(r.utterance.text);a.lang=r.utterance.lang,a.volume=r.utterance.volume,a.rate=r.utterance.rate,a.pitch=r.utterance.pitch,a.voiceURI=r.utterance.voiceURI,a.voice=r.utterance.voice,a.onboundary=r.utterance.onboundary,a.onend=r.utterance.onend,a.onerror=r.utterance.onerror,r.utterance=a,r.hasBeenSpoken=!1}},this.utterance.onboundary=function(a){var b={name:"/speak"};root.lookup("speakingCharIndex").assign(a.charIndex+1,b);var c=a.elapsedTime;1e7>=c&&root.lookup("speakingTime").assign(c,b)},this.utterance.onend=function(){d("finished",!0)},this.utterance.onerror=function(){d("error",!0)}},a.eden.include("plugins/speech-synthesis/speech-synthesis.js-e",b)},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!";