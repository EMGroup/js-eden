function getCaretCharacterOffsetWithin(e){var t,n=0,i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var a=o.getSelection().getRangeAt(0),r=a.cloneRange();r.selectNodeContents(e),r.setEnd(a.endContainer,a.endOffset),n=r.toString().length}}else if((t=i.selection)&&"Control"!=t.type){var s=t.createRange(),l=i.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",s),n=l.text.length}return n}function getStartCaretCharacterOffsetWithin(e){var t,n=0,i=e.ownerDocument||e.document,o=i.defaultView||i.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var a=o.getSelection().getRangeAt(0),r=a.cloneRange();r.selectNodeContents(e),r.setEnd(a.startContainer,a.startOffset),n=r.toString().length}}else if((t=i.selection)&&"Control"!=t.type){var s=t.createRange(),l=i.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",s),n=l.text.length}return n}function get_time_diff(e){var t=1e3*e,n=Date.now();if(t-=6e4*(new Date).getTimezoneOffset(),isNaN(t))return"";if(t<n)var i=n-t;else i=t-n;var o=Math.floor(i/1e3/60/1440),a=new Date(i);if(o>5)return new Date(t).toDateString();var r="";if(o>0)r+=o,r+=o>1?" days ago":" day ago";else if(a.getUTCHours()>0){var s=a.getUTCHours();r+=s,r+=s>1?" hours ago":" hour ago"}else{var l=a.getUTCMinutes();if(l>0)r+=l,r+=l>1?" minutes ago":" minute ago";else{var d=a.getUTCSeconds();r+=d,r+=" seconds ago"}}return r}function changeClassString(e,t,n){var i=e.split(" "),o=i.indexOf(t);if(-1==o){if(n)return i.push(t),i.join(" ")}else if(!n)return i.splice(o,1),i.join(" ");return e}function changeClass(e,t,n){if(e){var i=changeClassString(e.className,t,n);i!=e.className&&(e.className=i)}}function makeCurlyBrace(e,t,n,i,o,a){var r=e-n,s=t-i,l=Math.sqrt(r*r+s*s),d=e-.5*l*(r/=l)+o*(s/=l),c=t-.5*l*s-o*r;return"M "+e+" "+t+" Q "+(e+a*o*s)+" "+(t-a*o*r)+" "+(e-.25*l*r+(1-a)*o*s)+" "+(t-.25*l*s-(1-a)*o*r)+" T "+d+" "+c+" M "+n+" "+i+" Q "+(n+a*o*s)+" "+(i-a*o*r)+" "+(e-.75*l*r+(1-a)*o*s)+" "+(t-.75*l*s-(1-a)*o*r)+" T "+d+" "+c}function EdenScriptGutter(e,t,n){var i=this;this.lineelements=n,this.$gutter=$('<div class="eden-gutter"></div>');var o="http://www.w3.org/2000/svg";this.brace=document.createElementNS(o,"svg"),this.brace.style.position="absolute",this.brace.style.display="none",this.brace.setAttribute("width","22"),this.brace.style.left="10px",this.bracepath=document.createElementNS(o,"path"),this.bracepath.setAttribute("style","stroke: #444; fill: none; stroke-width: 3px"),this.brace.appendChild(this.bracepath),this.gutter=this.$gutter.get(0),e.insertBefore(this.gutter,e.firstChild),e.insertBefore(this.brace,e.firstChild),this.ast=void 0,this.lines=[],this.errors=[],this.agents={},this.hovering=!1,this.ctx=void 0,this.edits=void 0;var a,r,s=!1,l=0,d=!1,c=!1;function u(){console.log("GUTTER HOLD"),a=void 0;for(var e=0;e<i.lines.length;e++)i.lines[e].selected&&(changeClass(i.gutter.childNodes[e],"select",!1),changeClass(i.gutter.childNodes[e],"live",!0),i.lines[e].selected=!1,i.lines[e].live=!0)}function p(e,t){var n;if(t&&s){if(n=i.ast.getStatementByLine(e)){(a=n.getRange())[0]<a[1]&&i.showBrace(a[0],a[1]);for(var o=a[0];o<=a[1];o++)i.lines[o].selected=!d,changeClass(i.gutter.childNodes[o],"select",!d),changeClass(i.gutter.childNodes[o],"hover",!1)}}else if(n=i.ast.getStatementByLine(e)){var a=n.getRange();i.lines[e].live||t||changeClass(i.gutter.childNodes[e],"play",!0),i.selectLine(e+1,!0),i.hovering=!0}}function h(e,t){s&&!t&&(i.lines[e].selected=!d,changeClass(i.gutter.childNodes[e],"select",!d),changeClass(i.gutter.childNodes[e],"hover",!1),changeClass(i.gutter.childNodes[e],"play",!1)),s&&(t=!0),i.hovering=!1,clearTimeout(a),a=void 0;var n=i.ast.getStatementByLine(e);if(n){var o=n.getRange();i.hideBrace();for(var r=o[0];r<=o[1];r++)changeClass(i.gutter.childNodes[r],"hover",!1),changeClass(i.gutter.childNodes[r],"play",!1)}}this.curline=-1,this.textwidth=getTextWidth("M","14px/20px Roboto Mono,monospace"),i.startHover=p,i.endHover=h,this.$gutter.on("mousedown",".eden-gutter-item",function(e){if(!this.edits&&!i.ast.hasErrors()){var t=parseInt(e.target.getAttribute("data-line"));r=e.shiftKey,l=t,d=!!i.lines[t]&&i.lines[t].selected,s=e.shiftKey,c=i.lines[t]&&i.lines[t].live;var n=i.ast.getStatementByLine(t);if(n){var o=n.getRange();if(i.lines[t].live&&!r)if(i.lines[t].selected)for(p=0;p<i.lines.length;p++)i.lines[p].selected&&(i.lines[p].live=!1,changeClass(i.gutter.childNodes[p],"live",!1));else for(var p=o[0];p<=o[1];p++)i.lines[p].live=!1,changeClass(i.gutter.childNodes[p],"live",!1);else for(p=o[0];p<=o[1];p++)i.lines[p].selected=!r||!i.lines[p].selected,changeClass(i.gutter.childNodes[p],"select",i.lines[p].selected),changeClass(i.gutter.childNodes[p],"hover",!1)}a=setTimeout(u,1e3)}}).on("click",".eden-gutter-item",function(e){if(!this.edits){var t=parseInt(e.target.getAttribute("data-line"));i.ast.getStatementByLine(t)}}).on("mouseup",".eden-gutter-item",function(e){if(!this.edits){if(!i.ast.hasErrors()&&!r){var t,n=parseInt(e.target.getAttribute("data-line"));if(!((t=i.ast.getStatementByLine(n))&&t.hasErrors()||i.lines[n].live||c))if(i.executeSelected(),!d)if(t=i.ast.getStatementByLine(l))for(var o=t.getRange(),u=o[0];u<=o[1];u++)i.lines[u].selected=!1,changeClass(i.gutter.childNodes[u],"select",!1)}clearTimeout(a),a=void 0,s=!1}}).on("mouseenter",".eden-gutter-item",function(e){i.ast.hasErrors()||p(parseInt(e.target.getAttribute("data-line")),e.shiftKey)}).on("mouseleave",".eden-gutter-item",function(e){h(parseInt(e.target.getAttribute("data-line")),e.shiftKey)})}function SNVertex(e,t,n,i){this.id=e,this.vec=[t,n,i],this.faces=[],this.normal=vec3.create(),vec3.set(this.normal,0,0,0),this.collapse=null,this.cost=1e6,this.deleted=!1}function SNFace(e,t,n,i){this.id=e,this.v1=t,this.v2=n,this.v3=i;var o=Point3D.normal(t.vec,n.vec,i.vec);this.normal=[o.x,o.y,o.z],vec3.normalize(this.normal,this.normal),this.adj=[],this.deleted=!1,t.addFace(this),n.addFace(this),i.addFace(this)}CSSUtil={},CSSUtil.setStyle=function(e,t){var n=e.style;if(void 0===t)n.cssText="";else if("object"==typeof t){var i=/([A-Z])/g;function o(e,t){return"-"+t.toLowerCase()}var a=/^\w*[A-Z]\w*$/,r="";for(var s in t){if("string"==typeof t[s])r=r+(a.test(s)?s.replace(i,o):s)+": "+t[s]+";\n"}n.cssText=r}else n.cssText=t},CSSUtil.getStyle=function(e){for(var t=document.styleSheets,n=t.length-1;n>=0;n--)for(var i=t[n].cssRules,o=i.length-1;o>=0;o--)if(i[o].type==CSSRule.STYLE_RULE&&i[o].selectorText==e)return i[o].style;var a=document.getElementById("javascript-injected-styles");if(null===a){var r=document.getElementsByTagName("body")[0];(a=document.createElement("style")).id="javascript-injected-styles",r.appendChild(a)}var s=a.sheet;return s.insertRule(e+"{ }",s.cssRules.length),s.cssRules[0].style},EdenUI.plugins.ScriptInput=function(e,t){EdenUI.plugins.ScriptInput.title=Language.ui.input_window.title,EdenUI.plugins.ScriptInput.description=Language.ui.input_window.description;var n=this;$(document.body).delegate(null,"drop",function(t){if(void 0!==t.originalEvent.dataTransfer){var n=t.originalEvent.dataTransfer.getData("selector");if(!n||""==n)return console.log(t.originalEvent.dataTransfer.files),Eden.Project.loadFromFile(t.originalEvent.dataTransfer.files[0]),void t.preventDefault();n.sp;var i=n.replace(/[^a-zA-Z0-9]+/g,"");eden.root.lookup("view_"+i+"_tabs").assign([n],eden.root.scope,EdenSymbol.hciAgent),e.createView(i,"ScriptInput"),eden.root.lookup("view_"+i+"_current").assign(0,eden.root.scope,EdenSymbol.hciAgent)}}).delegate(null,"dragover",function(e){e.preventDefault()}),this.createCommon=function(e,t,n,i){console.log("CREATING",e);var o=$('<div class="inputdialogcontent"><div class="agent-tabs handle"></div><div class="scriptsubcontent">\t<div class="inputhider">\t\t<div class="control-bar noselect">\t\t</div>\t</div></div><div class="info-bar"></div></div></div>'),a=o.find(".inputhider").get(0),r=o.find(".info-bar").get(0),s=o.find(".agent-tabs"),l=o.find(".control-bar"),d=s.get(0),c=l.get(0);$(r).hide();var u=new EdenUI.ScriptArea;a.appendChild(u.contents);var p=0,h=void 0;a.addEventListener("scroll",function(e){void 0!==h&&clearTimeout(h),document.activeElement!==u.outdiv&&(h=setTimeout(function(){h=void 0;var e=a.scrollTop;(e=Math.floor((e-50)/20))<0&&(e=0),Math.abs(e-p)>=50&&(console.log("FORCE RE HIGHLIGHT",e),u.highlighter.setScrollTop(e),p=e,u.updateCachedHighlight(),u.gutter.clear())},100))});var g=-1,v=[],f=[],m="view_"+e+"_current",b="view_"+e+"_showtabs",y="view_"+e+"_showbuttons",w="view_"+e+"_tabs",S="view_"+e+"_zoom",x="view_"+e+"_readonly",E=eden.root.lookup(w),I=(eden.root.lookup(S),eden.root.lookup(m)),k=eden.root.lookup(b),C=eden.root.lookup(y),A=eden.root.lookup(x),_=0,T=3,D=1;function L(e,t){t?(d.style.display="flex",a.parentNode.style.top="35px"):(d.style.display="none",a.parentNode.style.top="0")}function M(e,t){t?(c.style.display="flex",u.codearea.style.top="30px"):(c.style.display="none",u.codearea.style.top="0")}function U(e,t){u.setReadonly(t)}function N(t,n){"number"==typeof n&&n>=0&&n<f.length?(g!=n&&(g=n,u.setFragment(f[g]),u.fragment.originast&&u.fragment.originast.doxyComment&&u.fragment.originast.doxyComment.getProperty("nobuttons")&&(C.assign(!1,eden.root.scope,EdenSymbol.localJSAgent),console.log("DISABLE BUTTONS"))),B()):(B(),-1==n&&(g=-1,u.setFragment(void 0),function(t){""==t&&(t="*");var n=eden.root.lookup("view_"+e+"_query").value();void 0===n&&(n=".type(script).name");var i=Eden.Selectors.query(n,"path,name,remote,executed,type");u.outdiv.innerHTML="";for(var o=0;o<i.length;o++){var a,r=i[o][1],s="";if(r==eden.project.name)s=" project",a="&#xf0f6;";else if("ACTIVE"==r)s=" root",a="&#xf0e7;";else if(i[o][2])a="&#xf08e;";else{switch(i[o][4]){case"script":a="&#xf0f6;";break;case"when":a="&#xf1ae;";break;default:a="&#xf128;"}s=i[o][3]?" executed":""}var l=$('<div class="browse-entry" data-path="'+i[o][0]+'"><div class="browse-icon'+s+'">'+a+"</div>"+r+"</div>");u.outdiv.appendChild(l.get(0))}}(""))),O()}function P(e,t){if(Array.isArray(t)){var n=v;v=edenCopy(t);for(var i=f,o=i.filter(function(e){return-1==t.indexOf(e.selector)}),a=0;a<o.length;a++)o[a].destroy(),console.log("REMOVE FRAG",o[a].selector);f=[];for(a=0;a<t.length;a++){var r=n.indexOf(t[a]);r>=0?f.push(i[r]):f.push(new Eden.Fragment(t[a]))}g=-2,N(0,I.value())}}function O(){if(g>=0){var e='<button class="script-button script-run" title="Run the entire script"><span class="explorer-control-icon">&#xf04b;</span>Run</button>',t=f[g];t&&t.scratch&&!t.edited?e+='<span class="scratchsearch"><input type="text" class="scratchsearch" placeholder="Populate..."></input></span>':t&&t.scratch&&(e+='<span class="editname"><input type="text" class="editname" placeholder="Enter a name..."></input></span>'),l.html(e)}else l.html("")}function V(e,t,n,i,o){var a=document.createElement("div");a.style.left=160*o+"px";var r="agent-tab noselect";r+=i?" agent-tab-current handle":" agent-tab-notcurrent";var s,l=f[t].getTitle();l.length>18&&(l="..."+l.slice(-15)),s=f[t]&&f[t].ast?f[t].ast.errors&&f[t].ast.errors.length>0?"tab-icon errored":f[t].originast&&f[t].originast.executed?"tab-icon executed":"tab-icon":"tab-icon noagent";var d="&#xf1ae;";f[t].remote?d="&#xf08e;":void 0===f[t].origin?d="&#xf0c3;":f[t].locked&&(d="&#xf023;"),a.className=r,a.innerHTML="<span class='"+s+"'>"+d+"</span>"+l+"<span class='close'>&#xf00d;</span>",a.draggable=!0,a.setAttribute("data-index",t),e.appendChild(a)}function B(){for(;d.firstChild;)d.removeChild(d.firstChild);var e=I.value(),t=document.createElement("div");if(t.className="agent-tab-more",t.innerHTML="<span class='tab-icon2'>&#xf0c9;</span>",d.appendChild(t),f.length>3&&0!=e){var n=document.createElement("div");n.className="agent-tableft noselect",d.appendChild(n)}var i=document.createElement("div");i.className="agent-tab-container",d.appendChild(i),e>_+(T-1)&&(_=e-(T-1)),e<_&&(_=e);for(var o=0;o<f.length;o++){f[o].getTitle();_<=o&&V(i,o,0,o==e,o)}var a=document.createElement("div");if(a.className="agent-newtab noselect",a.style.left=160*f.length+20+"px",i.appendChild(a),f.length>3&&e!=f.length-1){var r=document.createElement("div");r.className="agent-tabright noselect",d.appendChild(r)}var s=document.createElement("div");s.className="script-input-windowcontrols",s.innerHTML="<span class='windowcontrol'>&#xf00d;</span>",d.appendChild(s)}function F(t){return"view_"+e+"_"+t}void 0===k.value()&&void 0===k.definition&&k.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),k.addJSObserver("scriptview_"+e,L),L(0,k.value()),void 0===C.value()&&void 0===C.definition&&C.assign(!0,eden.root.scope,EdenSymbol.defaultAgent),C.addJSObserver("scriptview_"+e,M),M(0,C.value()),A.addJSObserver("scriptview_"+e,U),U(0,A.value()),I.addJSObserver("scriptview_"+e,N),E.addJSObserver("scriptview_"+e,P),P(0,E.value()),void 0===E.value()&&void 0===E.definition&&E.assign([],eden.root.scope,EdenSymbol.defaultAgent),void 0===I.value()&&void 0===I.definition&&I.assign(-1,eden.root.scope,EdenSymbol.defaultAgent),Eden.Fragment.listenTo("changed",u,function(e){e===f[g]&&(B(),O(),u.refresh())}),Eden.Fragment.listenTo("locked",u,function(e){e===f[g]&&(console.log("LOCKED",e),N(0,I.value()))}),Eden.Fragment.listenTo("unlocked",u,function(e){e===f[g]&&N(0,I.value())}),Eden.Fragment.listenTo("errored",u,function(e){}),Eden.Fragment.listenTo("status",u,function(e){e===f[g]&&(B(),O())}),Eden.Fragment.listenTo("gotoline",u,function(e,t){for(var n=0;n<f.length;n++)if(e===f[n]){console.log("I have the goto frag"),g!=n&&I.assign(n,eden.root.scope,EdenSymbol.localJSAgent),u.gotoLine(t);var i=50+20*(t-5);i<0&&(i=0),a.scrollTop=i;break}}),void 0===eden.root.lookup("view_"+e+"_query").definition&&eden.execute("view_"+e+"_query is jseden_script_query;");var H=[F("tabs"),F("current"),F("showtabs"),F("showbuttons"),F("zoom")];o.get(0).setAttribute("data-observables",H.join(",")),l.on("keyup","input.editname",function(e){f[g].name=e.target.value,B()}).on("change","input.editname",function(e){console.log("FINISH NAME",e.target.value),f[g].makeReal(e.target.value);var t=E.value();t[g]=f[g].selector,E.assign(t,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".script-run",function(){g>=0&&f[g]&&(f[g].originast?(console.log("ONRUN",f[g].originast),f[g].ast.executeStatement(f[g].originast,0,f[g])):f[g].ast.execute(f[g]),B())}).on("click",".script-changes",function(e){u.gutter.edits?(u.gutter.setDiffs(void 0),u.cachedhlopt=void 0,u.updateCachedHighlight()):u.makeDiff()}).on("click",".script-details",function(e){u.details.toggle()}).on("keyup","input.scratchsearch",function(e){var t=e.target.value;console.log("SCRATCH SEARCH",t),Eden.Selectors.query(t,"innersource",{minimum:1},function(e){u.intextarea.value=e.join("\n"),f[g].setSourceInitial(u.intextarea.value),u.highlighter.ast=u.fragment.ast,u.updateCachedHighlight()})}),o.on("click","button,.executable,a",function(e){var t=e.currentTarget.getAttribute("data-jseden");t&&""!=t&&(console.log(t),eden.execute2(t,{name:"execute"}))}).on("input","textarea,input",function(e){var t=e.currentTarget.getAttribute("name");t&&""!=t&&eden.root.lookup(t).assign(e.currentTarget.value,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".close",function(e){var t=parseInt(e.currentTarget.parentNode.getAttribute("data-index"));if(t>=0&&t<f.length){var n=E.value();n.splice(t,1),E.assign(n,eden.root.scope,EdenSymbol.localJSAgent);var i=I.value();i>=n.length&&I.assign(i-1,eden.root.scope,EdenSymbol.localJSAgent)}e.stopPropagation()}).on("click",".agent-tab-more",function(){I.assign(-1,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".browse-entry",function(e){var t=e.currentTarget.getAttribute("data-path"),n=E.value(),i=n.indexOf(t);-1==i?(n.push(t),E.assign(n,eden.root.scope,EdenSymbol.localJSAgent),I.assign(n.length-1,eden.root.scope,EdenSymbol.localJSAgent)):I.assign(i,eden.root.scope,EdenSymbol.localJSAgent)}).on("click",".agent-tab",function(e){var t=e.currentTarget.getAttribute("data-index");I.assign(parseInt(t),eden.root.scope,EdenSymbol.hciAgent),u.intextarea.focus()}).on("click",".agent-tableft",function(){var e=g;--e>=0&&I.assign(e,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".agent-tabright",function(){var e=g;++e<f.length&&I.assign(e,eden.root.scope,EdenSymbol.hciAgent)}).on("click",".agent-newtab",function(){var e=E.value();e.push("scratch"+D),D++,E.assign(e,eden.root.scope,EdenSymbol.localJSAgent),I.assign(e.length-1,eden.root.scope,EdenSymbol.localJSAgent)}).on("dragstart",".agent-tab",function(e){var t=parseInt(e.target.getAttribute("data-index")),n=f[t].selector;e.originalEvent.dataTransfer.setData("selector",n),e.originalEvent.offsetX,e.originalEvent.offsetY}).on("dragend",".agent-tab",function(e){var t=parseInt(e.target.getAttribute("data-index")),n=f[t].selector;if("none"!=e.originalEvent.dataTransfer.dropEffect){console.log("DRAGEND: "+n),console.log(e);var i=E.value(),o=i.indexOf(n);o>=0&&(i.splice(o,1),--o<0&&(o=0),i.length,E.assign(i,eden.root.scope,EdenSymbol.hciAgent)),i.length}}).on("dragover",function(e){e.preventDefault()}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.getData("selector");if(console.log("DROP"),console.log(e),t&&""!=t){var n=E.value();-1==n.indexOf(t)&&(n.push(t),E.assign(n,eden.root.scope,EdenSymbol.hciAgent))}else if(window.FileReader)for(var i=e.originalEvent.dataTransfer.files,o=0;o<i.length;o++){var a=i[o];if(a.name.match(/.*\.jse|.*\.js-e/)){var r=a.name.slice(0,-4);r="local/file/"+(r=r.replace(/[\.\-\/\s]/g,""));var s=new FileReader;s.onload=function(e){new Eden.Agent(void 0,r).setSource(e.target.result,!1,-1),agent.state[obs_agent]=r},s.readAsText(a)}}});var R={contents:o,update:function(t){if(void 0===I.value()){var n="view/script/"+e;Eden.Agent.importAgent(n,"default",["noexec","create"],function(e){agent.state[obs_agent]=n,t instanceof EdenSymbol?(agent.setScope(t.getValueScope(eden.root.scope)),intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(agent.code),updateEntireHighlight()):t instanceof Array?(intextarea.value=EdenUI.plugins.ScriptInput.buildScriptFromList(t),updateEntireHighlight()):"string"==typeof t&&(intextarea.value=t,updateEntireHighlight())})}},destroy:function(){console.log("CLOSE SCRIPT"),clearInterval(u.gutterinterval);for(var t=0;t<f.length;t++)f[t].unlock(),f[t].ast&&f[t].ast.destroy();scriptast=void 0,f=void 0,Eden.Fragment.unListen(u),u=void 0,I.removeJSObserver("scriptview_"+e),E.removeJSObserver("scriptview_"+e)},resize:function(e,t){t&&t.size&&(T=Math.floor((t.size.width-90)/160))},setValue:function(e){intextarea.value=e,updateEntireHighlight()}};return u.updateEntireHighlight(),R},this.createDialog=function(t,i,o){var a=t.slice(0,-7),r=n.createCommon(a,i,o,!1,!1),s=405;if(o){var l=r.contents.find("textarea").val().split("\n").length;s=EdenUI.plugins.ScriptInput.getRequiredHeight(l+1)}function d(e,t){return root.lookup("view_"+e+"_"+t)}return r.contents.on("click",".windowcontrol",function(){e.hideView(a,!0)}),$dialog=$('<div id="'+t+'"></div>').html(r.contents).dialog({appendTo:"#jseden-views",title:i,width:600,height:s,minHeight:203,minWidth:300,classes:{"ui-dialog":"input-dialog ui-front no-print"},resizeStop:r.resize,draggable:!1}),$dialog.parent().draggable({handle:".handle",cancel:".agent-tab-notcurrent",stop:function(e,t){var n=eden.root;n.beginAutocalcOff(),d(a,"x").assign(t.position.left,eden.root.scope,EdenSymbol.hciAgent),d(a,"y").assign(t.position.top,eden.root.scope,EdenSymbol.hciAgent),n.endAutocalcOff()},start:function(e,t){if(d(a,"x").eden_definition||d(a,"y").definition)return!1}}),r.confirmClose=!1,r},this.createEmbedded=function(e,t,i){return n.createCommon(e,t,i,!0)},e.views.ScriptInput={dialog:this.createDialog,embed:this.createEmbedded,title:Language.ui.input_window.title,category:e.viewCategories.interpretation,menuPriority:0},e.history=this.history,t()},EdenUI.plugins.ScriptInput.getRequiredHeight=function(e,t){return t?55+20*e+20:45+20*e+20},EdenUI.plugins.ScriptInput.dialogs={},EdenUI.plugins.ScriptInput.dialogs.newAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog script-subdialog-newagent noselect"><span class="script-subdialog-title">Create Tab:</span><div class="script-subdialog-panel"><button>Scratch</button></div><div class="script-subdialog-panel"><input class="namebox" type="text" spellcheck="false" placeholder="New Tab"></input><button class="button-new">New</button></div><div class="script-subdialog-panel"><input type="text" class="searchbox" spellcheck="false" placeholder="Search"></input><button class="button-search">Load</button><br/></div></div>'),o=i.find(".searchbox").get(0),a=i.find(".namebox").get(0);i.on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),i.on("click",".button-search",function(){e.get(0).removeChild(n.get(0)),t(!0,o.value)}),i.on("click",".button-new",function(){eden.project.addAction(a.value),e.get(0).removeChild(n.get(0)),t(!0,"."+a.value)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.localChanges=function(e,t,n){EdenUI.plugins.ScriptInput.dialogs.hide&&EdenUI.plugins.ScriptInput.dialogs.hide();var i=$('<div class="script-obscurer noselect"></div>'),o=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-text">You have local changes to '+n.name+', use these?</span><br><br><button class="button-icon-green button-ok">Yes</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">No</button></div>');o.on("click",".button-ok",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(i.get(0)),EdenUI.plugins.ScriptInput.dialogs.hide=void 0,t(!1)}),i.append(o),e.append(i),EdenUI.plugins.ScriptInput.dialogs.hide=function(){EdenUI.plugins.ScriptInput.dialogs.hide=void 0,e.get(0).removeChild(i.get(0)),t(!1)}},EdenUI.plugins.ScriptInput.dialogs.uploadFailed=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload Failed! Try again...</span><br><br><button class="button-icon-green button-upload">Retry</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>');i.on("click",".button-upload",function(){e.get(0).removeChild(n.get(0)),t(!0)}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.uploadAgent=function(e,t){var n=$('<div class="script-obscurer noselect"></div>'),i=$('<div class="script-subdialog-uploadagent noselect"><span class="script-subdialog-title">Upload agent. Give an optional version name:</span><br/><input class="script-subdialog-text tagname" type="text" spellcheck="false"></input><span class="status missing"></span><br><input class="script-subdialog-check makepublic" type="checkbox">Public</input><br><br><button class="button-icon-green button-upload">Upload</button><button style="position: absolute; right: 20px" class="button-icon-silver button-cancel">Cancel</button></div>'),o=i.find(".tagname"),a=i.find(".makepublic"),r=o.get(0).nextSibling,s=!0;i.on("input blur",".script-subdialog-text",function(){var e=o.get(0).value;console.log(e),""==e?(s=!0,r.className="addnew"):/^[a-z][a-z0-9]+$/i.test(e)?(r.className="addnew",s=!0):(r.className="invalid",s=!1)}).on("click",".button-upload",function(){s&&(e.get(0).removeChild(n.get(0)),t(!0,o.get(0).value,a.get(0).checked))}).on("click",".button-cancel",function(){e.get(0).removeChild(n.get(0)),t(!1)}),n.append(i),e.append(n)},EdenUI.plugins.ScriptInput.dialogs.showHistory=function(e,t,n){var i,o=$('<div class="script-obscurer noselect"></div>'),a=$('<div class="script-subdialog-history noselect"><span class="script-subdialog-title">Agent History:</span><br/><div class="script-history-list"></div><div class="script-history-buttons"><button class="button-icon-green button-ok">Load</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),r=a.find(".script-history-list"),s=n.index,l=n.meta.saveID;function d(e){if(n.history[e])for(var t=n.history[e].length-1;t>=0;t--){var o=$('<div class="script-history-item"></div>');s==t&&(o.addClass("current"),o.addClass("original"),i=o),o.get(0).setAttribute("data-index",""+t);var a=$('<div class="script-history-bookmark"></div>'),l=$('<div class="script-history-time"></div>'),d=$('<div class="script-history-content"></div>');l.html(get_time_diff(n.history[e][t].time)),l.get(0).title=n.history[e][t].time,n.history[e][t].bookmark&&a.addClass("bookmarked"),n.history[e][t].title?d.html(n.history[e][t].title):d.html("[Autosave]"),o.append(a),o.append(d),o.append(l),r.append(o)}}function c(e){if(Eden.DB.getVersions(n.name,function(t){if(null!=t)for(var n=0;n<t.length;n++){var o=$('<div class="script-history-item"></div>');t[n].saveID==l&&(o.addClass("original"),-1==s&&(o.addClass("current"),i=o)),o.get(0).setAttribute("data-version",""+t[n].saveID);var a="script-history-stored";0==t[n].public?a+=" private":t[n].mine?a+=" mine":a+=" public";var c=$('<div class="'+a+'"></div>'),u=t[n].date.split(/[- :]/),p=$('<div class="script-history-time">'+get_time_diff(new Date(u[0],u[1]-1,u[2],u[3],u[4],u[5]).getTime()/1e3)+"</div>"),h=t[n].tag;null==t[n].tag&&(h=t[n].saveID);var g=$('<div class="script-history-content">'+h+" ("+t[n].saveID+") by "+t[n].name+"</div>");o.append(c),o.append(g),o.append(p),r.append(o),t[n].saveID==l&&d(e)}}),n.history.origin){var t=$('<div class="script-history-item"></div>');"origin"==l&&(t.addClass("original"),-1==s&&(t.addClass("current"),i=t)),t.get(0).setAttribute("data-version","origin");var o=$('<div class="script-history-bookmark"></div>'),a="origin";n.meta&&n.meta.file&&(a=n.meta.file);var c=$('<div class="script-history-content">'+a+"</div>");t.append(o),t.append(c),r.append(t),"origin"==l&&d("origin")}}c(n.meta.saveID),a.on("input",".script-history-content",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));n.history[n.meta.saveID][t].title=e.target.textContent,n.saveHistory(),n.makeSnapshot(t)}).on("click",".script-history-item",function(e){var t=e.currentTarget.getAttribute("data-version");if(t)"origin"!=t&&(t=parseInt(t)),l=t,function(){for(var e=r.get(0);e.firstChild;)e.removeChild(e.firstChild);i=void 0}(),s=-1,c(l);else{var n=parseInt(e.currentTarget.getAttribute("data-index"));s=n,i&&i.removeClass("current"),(i=$(e.currentTarget)).addClass("current")}}).on("click",".script-history-bookmark",function(e){var t=parseInt(e.target.parentNode.getAttribute("data-index"));void 0===n.history[n.meta.saveID][t].bookmark?n.history[n.meta.saveID][t].bookmark=!0:n.history[n.meta.saveID][t].bookmark=!n.history[n.meta.saveID][t].bookmark,n.saveHistory(),n.history[n.meta.saveID][t].bookmark?e.target.className="script-history-bookmark bookmarked":e.target.className="script-history-bookmark"}).on("click",".button-ok",function(){e.get(0).removeChild(o.get(0)),console.log("Rollback to: "+s+"@"+l),t(!0,s,l)}).on("click",".button-cancel",function(){e.get(0).removeChild(o.get(0)),t(!1)}),o.append(a),e.append(o)},EdenUI.plugins.ScriptInput.dialogs.browseAgents=function(e,t,n){var i=$('<div class="script-obscurer noselect"></div>'),o=$('<div class="script-subdialog-agents noselect"><span class="script-subdialog-title">'+Language.ui.input_window.browse_agents+':</span><br/><div class="script-agents-list"></div><div class="script-agents-buttons"><button class="button-icon-green button-add">Add</button><button style="float: right;" class="button-icon-silver button-cancel">Cancel</button></div></div>'),a=o.find(".script-agents-list"),r=0,s={};function l(e,t,i){Eden.DB.getDirectory(i,function(o){if(void 0!==o){var r=[];for(var s in o)r.push(s);r.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});for(var l=0;l<r.length;l++){var d=""==i?r[l]:i+"/"+r[l],c=r[l],u=$('<div class="script-agents-item"></div>'),p=$('<div class="script-agents-expand" style="width: '+(27+15*t)+'px"></div>'),h=$('<div class="script-agents-content"></div>'),g=$('<div class="script-agents-cbcont"></div>');(function(e,t,i,o,a){Eden.DB.getMeta(t,function(t,a){if(a){var r="";if(a.date){var s=a.date.split(/[- :]/);r=get_time_diff(new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]).getTime()/1e3)}var l=a.title;if("Script View"!=l&&void 0!==l||(l=""),e.html(i+' <span class="script-agents-title">'+l+'</span><span class="script-agents-date">'+r+"</span>"),a.remote&&-1==a.defaultID&&-1==a.latestID)o.html("&nbsp;");else{var d=$('<input type="checkbox"></input>');o.append(d),n.indexOf(t)>=0&&(d.get(0).checked=!0)}}else e.html(i),o.html("&nbsp;")})}).call(this,h,d,c,g,p),Eden.Agent.agents[d]&&u.addClass("loaded"),u.get(0).setAttribute("data-path",d),u.get(0).setAttribute("data-depth",""+(t+1)),u.append(p),u.append(g),u.append(h),void 0===e||void 0===e.nextSibling?a.append(u):a.get(0).insertBefore(u.get(0),e.nextSibling)}}})}return l(void 0,0,""),o.on("click",".script-agents-item",function(e){}).on("click",".script-agents-expand",function(e){var t=e.currentTarget.parentNode.getAttribute("data-path"),n=parseInt(e.currentTarget.parentNode.getAttribute("data-depth"));e.currentTarget.className.indexOf("expanded")<0?(l(e.currentTarget.parentNode,n,t),changeClass(e.currentTarget,"expanded",!0)):(!function(e){for(var t=parseInt(e.getAttribute("data-depth")),n=e.nextSibling;n&&parseInt(n.getAttribute("data-depth"))>t;){var i=n.nextSibling;a.get(0).removeChild(n),n=i}}(e.currentTarget.parentNode),changeClass(e.currentTarget,"expanded",!1))}).on("change",".script-agents-cbcont input",function(e){var t=e.currentTarget.parentNode.parentNode.getAttribute("data-path");e.currentTarget.checked?s[t]=!0:s[t]=!1}).on("click",".button-add",function(){r=a.scrollTop(),e.get(0).removeChild(i.get(0)),t(!0,s)}).on("click",".button-cancel",function(){r=a.scrollTop(),e.get(0).removeChild(i.get(0)),t(!1)}),i.append(o),{show:function(){e.append(i),a.scrollTop(r)}}},EdenScriptGutter.prototype.clear=function(){for(this.ast=void 0,this.lines=[],this.curline=-1,this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild)},EdenScriptGutter.prototype.setBaseAST=function(e,t){for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);this.ast=e,this.errors=t,this.lines=[],this.edits=void 0,this.hideBrace()},EdenScriptGutter.prototype.executeSelected=function(){if(void 0!==this.ast)for(var e=0;e<this.lines.length;e++)if(this.lines[e].selected){var t=this.ast.getStatementByLine(e),n=this.ast.getStatementByLine(e).getRange();eden.project.ast.executeStatement(t,e,eden.project),e=n[1],eden.root.lookup("jseden_fragment_executed").assign(".id("+t.id+")",eden.root.scope,EdenSymbol.hciAgent)}},EdenScriptGutter.prototype.showBrace=function(e,t){this.brace.style.display="block";var n=this.lineelements.childNodes[e].offsetTop;this.brace.style.top=n+"px";var i=this.lineelements.childNodes[t].offsetTop+this.lineelements.childNodes[t].clientHeight;i-=n,this.brace.setAttribute("height",""+i),this.bracepath.setAttribute("d",makeCurlyBrace(20,4,20,i-4,20,.52))},EdenScriptGutter.prototype.hideBrace=function(){this.brace.style.display="none"},EdenScriptGutter.prototype.selectLine=function(e,t){if(!(this.edits||this.ast.errors.length>0)){var n;if(this.curline>=0)if(n=this.ast.getStatementByLine(this.curline)){var i=n.getRange(),o=Math.floor((i[1]-i[0])/2)+i[0];t||(changeClass(this.gutter.childNodes[o],"play",!1),changeClass(this.gutter.childNodes[o],"current",!1))}if(this.curline=e-1,n=this.ast.getStatementByLine(e-1))if(n.getRange||console.error("NO GETRANGE",n),(i=n.getRange())[0]<i[1])this.showBrace(i[0],i[1]);else if(this.hideBrace(),n){o=Math.floor((i[1]-i[0])/2)+i[0];changeClass(this.gutter.childNodes[o],"play","true"),t||changeClass(this.gutter.childNodes[o],"current","true")}}},EdenScriptGutter.prototype.setDiffs=function(e){this.edits=e;for(;this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);if(void 0!==e){this.hideBrace();for(var t=0,n=0,i=this.ast.lines.length+Object.keys(e.remove).length,o=!1,a=0;a<i;a++){if(e.remove[n]&&e.remove[n].nline<=t){var r="eden-gutter-item removed";(d=document.createElement("div")).className=r,d.textContent=e.remove[n].rline,this.gutter.appendChild(d);for(var s=e.remove[n].chars,l=0;l<s.length;l++){(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(255,0,0,0.3)",u.style.height="20px",u.style.width=s[l].length*this.textwidth+"px",u.style.top="0px",u.style.left=s[l].start*this.textwidth+43+"px",d.appendChild(u)}if(!e.remove[n].partial){n++;continue}n++,o=!0}var d=document.createElement("div");r="eden-gutter-item";if(o||e.insert[t]){r+=" inserted";var c=!1;if(e.insert[t])for(s=e.insert[t].chars,l=0;l<s.length;l++){var u;(u=document.createElement("div")).style.position="absolute",u.style.background="rgba(0,255,0,0.3)",u.style.height="20px",u.style.width=s[l].length*this.textwidth+"px",c=c||0==s[l].length&&!e.insert[t].partial,u.style.top="0px",u.style.left=s[l].start*this.textwidth+43+"px",d.appendChild(u)}e.insert[t]&&e.insert[t].partial&&!o&&n++}else n++;o=!1,d.className=r,d.setAttribute("data-line",""+t),this.gutter.appendChild(d),t++,void 0===this.lines[t]&&(this.lines[t]={selected:!1,live:!1})}}},EdenScriptGutter.prototype.updateLine=function(e,t){var n="eden-gutter-item",i=this.ast,o="",a=t,r=void 0,s=i.getStatementByLine(e);s?(s.errors.length>0?(s.errors[0].line==e+1?(n+=" error",o="&#xf06a",r=s.errors[0].messageText(),e):"runtime"==s.errors[0].type&&(n+=" error",o="&#xf06a",r=s.errors[0].messageText()),this.lines[e].errored=!0,a=!0):(i.errors.length>0&&i.errors[0].line==e+1&&(this.lines[e].errored=!0,n+=" error",o="&#xf06a",r=i.errors[0].messageText()),this.lines[e].errored&&(a=!0,this.lines[e].errored=!1),s.warning&&(n+=" warning",o="&#xf071",a=!0,s.warning&&(r=s.warning.messageText())),1==s.executed?(n+=" executed",a=!0,this.lines[e].executed=!0):2==s.executed?(n+=" guarded",a=!0,this.lines[e].executed=!0):3==s.executed&&(n+=" errorblock",a=!0)),this.lines&&this.lines[e]&&(this.lines[e].executed&&s.executed<=0&&(a=!0,this.lines[e].executed=!1),this.lines[e].selected&&(n+=" select"),this.lines[e].live&&(n+=" live"))):(this.errors&&this.errors.length>0&&this.errors[0].line==e+1?this.lines[e].errored||(n+=" error",o="&#xf06a",r=this.errors[0].messageText(),e,this.lines[e].errored=!0,a=!0):this.lines[e].errored&&(a=!0,this.lines[e].errored=!1,r=""),this.lines[e].executed&&(a=!0,this.lines[e].executed=!0)),a&&(this.gutter.childNodes[e].className.indexOf("hover")>=0&&(n+=" hover"),this.gutter.childNodes[e].className.indexOf("play")>=0&&(n+=" play"),this.gutter.childNodes[e].className.indexOf("current")>=0&&(n+=" current"),this.gutter.childNodes[e].innerHTML=o,this.gutter.childNodes[e].className=n,r&&(this.gutter.childNodes[e].title=r))},EdenScriptGutter.prototype.generate=function(e,t){if(this.ast=e,!this.edits){var n=!1,i=e.getNumberOfLines()+1;if(i>this.lineelements.childNodes.length&&(i=this.lineelements.childNodes.length),i!=this.gutter.childNodes.length){for(this.hideBrace();this.gutter.firstChild;)this.gutter.removeChild(this.gutter.firstChild);for(var o=0;o<i;o++){var a=document.createElement("div");a.className="eden-gutter-item",a.setAttribute("data-line",""+o),a.style.height=this.lineelements.childNodes[o].clientHeight+"px",this.gutter.appendChild(a),void 0===this.lines[o]&&(this.lines[o]={selected:!1,live:!1,executed:!1,errored:!1})}n=!0}for(o=0;o<i;o++)this.updateLine(o,n);this.ast.errors.length>0?this.hideBrace():this.hovering||this.selectLine(t)}},EdenUI.ScriptArea=function(){this.contents=document.createElement("div"),this.intextarea=document.createElement("textarea"),this.intextarea.autofocus=!0,this.intextarea.tabIndex=1,this.intextarea.className="hidden-textarea2",this.contents.appendChild(this.intextarea),this.codearea=document.createElement("div"),this.codearea.className="inputCodeArea",this.contents.appendChild(this.codearea),this.outdiv=document.createElement("div"),this.outdiv.contenteditable=!0,this.outdiv.className="outputcontent",this.outdiv.spellcheck=!1,this.outdiv.tabIndex=2,this.codearea.appendChild(this.outdiv),this.fragment=void 0,this.readonly=!1,this.alwaysreadonly=!1,this.currentlineno=-1,this.currentcharno=-1,this.gotomode=!1,this.highlighter=new EdenUI.Highlight(this.outdiv),this.gutter=new EdenScriptGutter(this.codearea,this.infobox,this.outdiv),this.details=new EdenUI.ScriptArea.Details(this),this.cachedhlopt=void 0,this.disablehl=!1,this.highlighter.setScrollTop(0);var e=this;this.gutterinterval=setInterval(function(){if(void 0!==e.fragment&&void 0!==e.fragment.ast)for(var t in e.gutter.generate(e.fragment.ast.script,e.currentlineno),e.highlighter.metrics)if(e.currentlineno!=t){var n=e.highlighter.metrics[t];if(n.query)for(var i=0;i<n.qelements.length;i++){var o=n.qelements[i].getAttribute("data-query"),a=n.qelements[i].getAttribute("data-attribs"),r=Eden.Selectors.query(o,null!==a&&a.length>0?a:"value");r=1==r.length?r[0]:r.length>1?r.join(", "):"",n.qelements[i].setAttribute("data-result",r)}n.squery&&e.highlightContent(t,e.intextarea.selectionEnd)}},300);new EdenUI.ScriptArea.Keyboard(this),new EdenUI.ScriptArea.Mouse(this);this.rebuildinterval=400},EdenUI.ScriptArea.prototype.setReadonly=function(e){this.alwaysreadonly=e,!0===e?(this.readonly=!0,this.outdiv.contentEditable=!1):(this.readonly=!!this.fragment&&this.fragment.locked,this.outdiv.contentEditable=!this.readonly,"comment"==e&&this.updateEntireHighlight())},EdenUI.ScriptArea.prototype.setFragment=function(e){if(this.fragment&&this.fragment!==e&&(this.fragment.unlock(),this.currentlineno=-1),this.details.hide(),this.fragment=e,void 0===e)return this.gutter.clear(),changeClass(this.outdiv,"browser",!0),this.outdiv.contentEditable=!1,void(this.readonly=!0);var t=this;e.reset(function(){changeClass(t.outdiv,"browser",!1),t.intextarea.value=e.getSource(),e.ast&&(t.highlightContent(-1,0),t.intextarea.focus(),t.checkScroll(),t.gutter.setBaseAST(e.ast.script)),e.locked?(t.readonly=!0,t.outdiv.contentEditable=!1):(t.readonly=!0===t.alwaysreadonly,t.outdiv.contentEditable=!t.readonly)})},EdenUI.ScriptArea.prototype.refresh=function(){this.intextarea.value=this.fragment.getSource(),this.fragment.ast&&this.highlightContent(-1,0)},EdenUI.ScriptArea.prototype.updateSource=function(e,t){this.fragment.setSource(e),this.gutter.errors=this.fragment.ast.errors,this.highlighter.ast=this.fragment.ast},EdenUI.ScriptArea.prototype.updateLineHighlight=function(){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.updateSource(this.intextarea.value,e),this.runScript(e),this.highlightContent(e,t)},EdenUI.ScriptArea.prototype.runScript=function(e){if(this.gutter.lines[e-1]&&this.gutter.lines[e-1].live&&!this.fragment.ast.hasErrors()){var t=this.fragment.ast.script.getStatementByLine(e-1);this.fragment.ast.executeStatement(t,e,this.fragment)}},EdenUI.ScriptArea.prototype.hideInfoBox=function(){},EdenUI.ScriptArea.prototype.updateLineCachedHighlight=function(){if(this.fragment){var e=-1,t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd,e=this.getLineNumber(this.intextarea)),this.highlightContent(e,t)}},EdenUI.ScriptArea.prototype.updateEntireHighlight=function(e,t){if(void 0!==this.fragment){this.cachedhlopt=t,this.updateSource(this.intextarea.value,-1);var n=-1;document.activeElement===this.intextarea&&(n=this.intextarea.selectionEnd),e&&runScript(0),this.highlightContent(-1,n,t)}},EdenUI.ScriptArea.prototype.updateCachedHighlight=function(e){var t=-1;document.activeElement===this.intextarea&&(t=this.intextarea.selectionEnd),this.highlightContent(-1,t,e||this.cachedhlopt)},EdenUI.ScriptArea.prototype.findElementLineNumber=function(e){for(var t=e;t.parentNode!==this.outdiv;)t=t.parentNode;return parseInt(t.getAttribute("data-line"))},EdenUI.ScriptArea.prototype.replaceLine=function(e,t){var n=this.intextarea.value.split("\n");n[e]=t,this.intextarea.value=n.join("\n")},EdenUI.ScriptArea.prototype.focusOutput=function(){this.setCaretToFakeCaret(),this.outdiv.focus()},EdenUI.ScriptArea.prototype.focusText=function(){if(!this.readonly){var e=getCaretCharacterOffsetWithin(this.outdiv),t=getStartCaretCharacterOffsetWithin(this.outdiv);this.intextarea.focus(),this.intextarea.selectionEnd=e,this.intextarea.selectionStart=t,t!=e&&(this.refreshentire=!0)}},EdenUI.ScriptArea.prototype.toggleHighlighting=function(){this.disablehl=!this.disablehl,this.updateEntireHighlight(),this.gutter.clear()},EdenUI.ScriptArea.prototype.highlightContent=function(e,t,n){if(this.fragment){var i=this.fragment.ast;if(i){if(void 0===n&&this.disablehl&&(n={}),this.disablehl&&(n.disabled=!0),this.highlighter.highlight(i,e,t,n),document.activeElement!==this.intextarea&&$(this.outdiv).find(".fake-caret").addClass("fake-blur-caret"),"comment"==this.alwaysreadonly)for(var o=$(this.outdiv).find(".eden-comment-line"),a=0;a<o.length;a++)o[a].contentEditable=!1;this.delayRebuild()}}},EdenUI.ScriptArea.prototype.moveCaret=function(){this.updateLineCachedHighlight(),this.checkScroll()},EdenUI.ScriptArea.prototype.selectAll=function(){this.outdiv.focus();var e=document.createRange();e.selectNodeContents(this.outdiv);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},EdenUI.ScriptArea.prototype.makeNumbersDrag=function(){var e=this;this.readonly||$(this.outdiv).find(".eden-number").draggable({helper:function(e){return $("<div class='eden-drag-helper'></div>")},axis:"x",distance:5,drag:function(t,n){var i;if(!e.readonly&&(i=e.dragint?Math.round(e.dragvalue+(n.position.left-e.dragstart)/2):(i=e.dragvalue+.005*(n.position.left-e.dragstart)).toFixed(4))!=e.draglast){e.draglast=i,t.target.innerHTML=""+i;var o=t.target.parentNode.textContent;"\n"==o.charAt(o.length-1)&&(o=o.slice(0,-1)),e.replaceLine(e.dragline,o),e.updateSource(e.intextarea.value,e.dragline),e.runScript(e.dragline+1),e.highlightContent(e.dragline,-1)}},start:function(t,n){if(!e.readonly){e.edited=!0,e.dragline=e.findElementLineNumber(t.target),e.dragstart=n.position.left;var i=t.target.textContent;-1==i.indexOf(".")?(e.dragvalue=parseInt(i),e.dragint=!0):(e.dragvalue=parseFloat(i),e.dragint=!1),e.draglast=e.dragvalue,$(t.target).addClass("eden-select"),$(e.outdiv).css("cursor","ew-resize")}},stop:function(t,n){e.readonly||($(t.target).removeClass("eden-select"),$(e.outdiv).css("cursor","text"),e.dragline=-1)},cursor:"move",cursorAt:{top:-5,left:-5}}).click(function(){$(this).draggable({disabled:!0})}).blur(function(){$(this).draggable({disabled:!1})})},EdenUI.ScriptArea.prototype.getLineNumber=function(){var e=this.intextarea.value.substr(0,this.intextarea.selectionStart).split("\n");return this.currentlineno=e.length,this.currentcharno=e[e.length-1].length,this.currentlineno},EdenUI.ScriptArea.prototype.gotoLine=function(e){var t=this.intextarea.value.split("\n");t.length=e+1;var n=t.join("\n").length;this.intextarea.focus(),this.intextarea.selectionEnd=n,this.intextarea.selectionStart=n,this.updateLineCachedHighlight()},EdenUI.ScriptArea.prototype.checkScroll=function(){var e=$(this.outdiv.childNodes[this.currentlineno-1]).find(".fake-caret").get(0);if(void 0!==e){for(var t=this.contents.parentNode,n=e.offsetLeft-t.scrollLeft+25,i=t.clientWidth+t.scrollLeft-e.offsetLeft-25;e.parentNode!=this.outdiv;)e=e.parentNode;var o=e.offsetTop-t.scrollTop+15,a=t.clientHeight+t.scrollTop-e.offsetTop-15;n<80&&(t.scrollLeft=t.scrollLeft-(80-n)),i<80&&(t.scrollLeft=t.scrollLeft+(80-i)),o<40&&(t.scrollTop=t.scrollTop-(40-o)),a<40&&(t.scrollTop=t.scrollTop+(40-a))}},EdenUI.ScriptArea.prototype.setCaretToFakeCaret=function(){var e=$(this.outdiv).find(".fake-caret").get(0);if(e){var t=document.createRange(),n=window.getSelection();e.nextSibling&&(e=e.nextSibling),t.setStart(e,0),t.collapse(!0),n.removeAllRanges(),n.addRange(t),$(this.outdiv).remove(".fake-caret")}},EdenUI.ScriptArea.prototype.makeDiff=function(){var e={},t=this.fragment.diff();for(var n in t.remove)if(!t.remove[n].consecutive){var i=parseInt(n),o=0,a=20;do{a+=20,o++}while(t.remove[i+o]&&t.remove[i+o].consecutive);e[t.remove[n].nline+0]=a}this.gutter.setDiffs(t),this.cachedhlopt={spacing:e},this.updateCachedHighlight()},EdenUI.ScriptArea.prototype.doRebuild=function(){this.makeNumbersDrag()},EdenUI.ScriptArea.prototype.delayRebuild=function(){var e=this;clearTimeout(this.rebuildtimer),this.rebuildtimer=setTimeout(function(){e.doRebuild()},this.rebuildinterval)},EdenUI.ScriptArea.prototype.rebuild=function(){this.gutter.edits?(this.updateSource(this.intextarea.value,-1),this.gutter.ast=this.fragment.ast,this.makeDiff()):(this.edited=!0,this.refreshentire?(this.updateEntireHighlight(),this.refreshentire=!1):this.updateLineHighlight(),this.checkScroll(),this.dirty=!1)},EdenUI.ScriptArea.prototype.enableGotoMode=function(){this.gotomode||(this.outdiv.contentEditable=!1,changeClass(this.outdiv,"goto",!0),this.gotomode=!0)},EdenUI.ScriptArea.prototype.disableGotoMode=function(){this.gotomode&&(this.outdiv.contentEditable=!0,changeClass(this.outdiv,"goto",!1),this.gotomode=!1)},EdenUI.ScriptArea.prototype.insertTab=function(){var e=this.intextarea.selectionStart,t=this.intextarea.selectionEnd;this.intextarea.value=this.intextarea.value.substring(0,e)+"\t"+this.intextarea.value.substring(t),this.intextarea.selectionStart=this.intextarea.selectionEnd=e+1,this.rebuild()},EdenUI.ScriptArea.Details=function(e){this.scriptarea=e,this.contents=document.createElement("div"),this.contents.className="script-details",this.contents.addEventListener("keyup",function(e){var t=e.target.parentNode.getAttribute("data-name"),n=e.target.value;console.log("CHANGE PROP",t,n)}),this.visible=!1},EdenUI.ScriptArea.Details.prototype.addProperty=function(e,t,n,i){var o=document.createElement("div");o.className="script-details-prop",o.setAttribute("data-name",e);var a=document.createElement("div");a.className="script-details-label",a.textContent=t,o.appendChild(a);var r=document.createElement("input");r.className="script-details-value",r.value=n||"",r.setAttribute("type","text"),i&&i.readonly&&(r.className+=" script-details-readonly",r.setAttribute("readonly","true")),o.appendChild(r);var s=document.createElement("div");return s.className="script-details-status",i&&i.readonly?s.innerHTML="&#xf023;":s.innerHTML="&#xf00c;",o.appendChild(s),this.contents.appendChild(o),o},EdenUI.ScriptArea.Details.prototype.clear=function(){for(;this.contents.lastChild;)this.contents.removeChild(this.contents.lastChild)},EdenUI.ScriptArea.Details.prototype.addButtons=function(){var e=document.createElement("div");e.className="script-details-buttons";var t=document.createElement("button");t.className="script-button",t.innerHTML='<span class="explorer-control-icon">&#xf00d;</span>Close',e.appendChild(t),this.contents.appendChild(e)},EdenUI.ScriptArea.Details.prototype.show=function(){this.clear(),this.addProperty("name","Name",this.scriptarea.fragment.name),this.addProperty("selector","Path",this.scriptarea.fragment.selector,{readonly:!0}),this.scriptarea.fragment.originast&&this.addProperty("id","Full Name",Eden.Selectors.getID(this.scriptarea.fragment.originast),{readonly:!0});var e=this.scriptarea.fragment.doxy;if(e){this.addProperty("desc","Description",e.stripped()),this.addProperty("tags","Tags",e.getHashTags().join(" "));var t=e.getControls();for(var n in t)this.addProperty(n,n.substring(1),t[n])}this.addButtons(),this.scriptarea.codearea.appendChild(this.contents),changeClass(this.scriptarea.outdiv,"blur",!0),this.visible=!0},EdenUI.ScriptArea.Details.prototype.hide=function(){this.visible&&(this.scriptarea.codearea.removeChild(this.contents),this.visible=!1,changeClass(this.scriptarea.outdiv,"blur",!1))},EdenUI.ScriptArea.Details.prototype.toggle=function(){this.visible?this.hide():this.show()},EdenUI.ScriptArea.Keyboard=function(e){function t(e){var t=e.key;return e.shiftKey&&(t="Shift-"+t),e.altKey&&(t="Alt-"+t),(e.ctrlKey||e.metaKey)&&(t="Ctrl-"+t),t}e.intextarea.addEventListener("input",function(t){e.dirty=!0,e.rebuild()}),e.intextarea.addEventListener("keydown",function(n){switch(t(n)){case"Tab":n.preventDefault(),e.insertTab();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":e.moveCaret();break;case"Ctrl-a":e.selectAll(),n.preventDefault();break;case"Ctrl-h":e.toggleHighlighting(),n.preventDefault();break;case"Ctrl-Shift-ArrowLeft":case"Ctrl-Shift-ArrowRight":case"Ctrl-Shift-ArrowUp":case"Ctrl-Shift-ArrowDown":case"Ctrl-Shift-Home":case"Ctrl-Shift-End":case"Shift-ArrowLeft":case"Shift-ArrowRight":case"Shift-ArrowUp":case"Shift-ArrowDown":case"Shift-Home":case"Shift-End":e.focusOutput();break;case"Backspace":e.refreshentire=10==e.intextarea.value.charCodeAt(e.intextarea.selectionStart-1);break;case"Enter":e.refreshentire=!0;break;case"Ctrl-Control":e.enableGotoMode()}}),e.intextarea.addEventListener("keyup",function(n){var i=t(n);switch(n.ctrlKey||e.disableGotoMode(),i){case"Ctrl-Control":e.disableGotoMode();break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Home":case"End":e.updateLineCachedHighlight(),e.gutter&&e.gutter.selectLine(e.currentlineno),e.checkScroll()}}),e.intextarea.addEventListener("paste",function(t){e.refreshentire=!0}),e.outdiv.addEventListener("keydown",function(t){"INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(!t.shiftKey||37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode&&35!=t.keyCode&&36!=t.keyCode)&&"Control"!=t.key&&"Shift"!=t.key&&"c"!=t.key&&e.focusText()}),e.outdiv.addEventListener("keyup",function(t){"INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(17!=t.keyCode&&91!=t.keyCode&&92!=t.keyCode||e.disableGotoMode())}),e.outdiv.addEventListener("paste",function(t){e.intextarea.focus(),setTimeout(function(){e.updateEntireHighlight()},0)}),e.intextarea.addEventListener("blur",function(t){$(e.outdiv).find(".fake-caret").remove()}),e.intextarea.addEventListener("focus",function(e){})},EdenUI.ScriptArea.Mouse=function(e){e.outdiv.addEventListener("mouseup",function(t){if("INPUT"!=t.target.nodeName&&"textarea"!=t.target.nodeName&&(e.hideInfoBox(),!e.readonly&&0!=t.target.isContentEditable))if(e.gotomode){var n=t.target;if(""==n.className&&"SPAN"==n.parentNode.nodeName&&(n=n.parentNode),"eden-selector"==n.className||"eden-selector2"==n.className){e.disableGotoMode();var i=n.parentNode.textContent;Eden.Selectors.goto(i)}else if("eden-observable"==n.className){var o=n.getAttribute("data-observable");Eden.Selectors.goto(o+":active")}t.preventDefault()}else if(document.activeElement===e.outdiv){var a=getCaretCharacterOffsetWithin(e.outdiv);getStartCaretCharacterOffsetWithin(e.outdiv)!=a?e.refreshentire=!0:(e.intextarea.focus(),e.intextarea.selectionEnd=a,e.intextarea.selectionStart=a,e.currentlineno,e.updateLineCachedHighlight())}}),e.outdiv.addEventListener("mousedown",function(t){e.readonly})},EdenUI.plugins.PluginManager=function(e,t){this.createDialog=function(t,n){var i,o,a=$('<div class="projectlist-results noselect"></div>'),r=function(t){return e.plugins[t]?"(loaded)":"(not loaded)"};pluginNames=Object.keys(EdenUI.plugins).sort(function(t,n){var i=e.plugins[t],o=e.plugins[n];return i&&!o?1:o&&!i?-1:t<n?-1:t==n?0:1});for(var s=0;s<pluginNames.length;s++){o=pluginNames[s],i=EdenUI.plugins[o];var l='<div class="projectlist-result-element'+(o in e.plugins?" pluginmanager-loaded":"")+'"><div class="projectlist-result-name">'+i.title+"</div><div class='projectlist-result-metadata'>"+i.description+"</div>";void 0!==i.originalAuthor&&(l=l+"<div class='projectlist-result-metadata'>Original version by "+i.originalAuthor+"</div>"),void 0!==i.author&&(l=l+"<div class='projectlist-result-metadata'>"+(void 0===i.originalAuthor?"By ":"Built on by ")+i.author+"</div>"),l=l+'<div class="pluginlist-loaded projectlist-result-metadata">'+r(o)+"</div></div>",$(l).click(function(t){return function(){var n=$(this);e.loadPlugin(t,function(){e.plugins[t]&&(n.find(".pluginlist-loaded").html(r(t)),n.addClass("pluginmanager-loaded",100)),e.menu.updateViewsMenu()})}}(o)).appendTo(a)}var d=$('<div class="projectlist-listing"></div>');d.append(a),$dialog=$('<div id="'+t+'"></div>').html(d).dialog({title:n,width:310,height:400,minHeight:120,minWidth:230,dialogClass:"unpadded-dialog"})},e.views.PluginManager={dialog:this.createDialog,title:"Plug-in Manager",category:e.viewCategories.environment,name:"plugins"},t()},EdenUI.plugins.PluginManager.title="Plug-in Manager",EdenUI.plugins.PluginManager.description="Provides the ability to load plug-ins.",EdenUI.plugins.Canvas2D=function(e,t){var n=this;eden.root.lookup("jseden_webgl").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),this.defaultFontSizePx=13.3,this.defaultLineHeight=1.75*this.defaultFontSizePx,this.defaultLineWidth=2;canvases={},contents={};var i,o,a,r={},s=!1,l=!1;Object.defineProperty(this,"mouseIdleTimeout",{set:function(e){clearInterval(o),o=setInterval(function(){if(s)l=!1,s=!1;else if(!l){var e=root.lookup("mouseFollow").value();root.lookup("mouseVelocity").assign(new Point(0,0),root.scope,EdenSymbol.hciAgent,e),l=!0,a=void 0}},e/2),i=e},get:function(){return i},enumerable:!0}),this.mouseVelocitySampleTime=100,this.mouseVelocityDampening=.3,this.mouseIdleTimeout=300;this.drawPicture=function(e){var t=canvases[e];if(void 0!==t&&!t.drawingQueued&&(t.drawingQueued=!0,!t.drawingInProgress)){var i=function(){t.drawingInProgress=!0,t.drawingQueued=!1;var o=r[e],a={},s="view_"+e+"_content",l=root.lookup(s),d=l.value(),c=t.getContext("experimental-webgl"),u=contents[e],p=0;if(void 0!==u){var h=0,g=0,v=0,f=0,m=0,b=root.lookup("view_"+e+"_camera_position").value(),y=root.lookup("view_"+e+"_camera_angle").value();b&&(h=b.x,g=b.y,v=b.z),y&&(f=y.x,m=y.y);var w=root.lookup("view_"+e+"_background_colour").value();void 0===w&&(w="white"),EdenUI.plugins.Canvas2D.setBackground(c,w);var S=root.lookup("view_"+e+"_ambient_colour").value();void 0===S&&(S="white"),EdenUI.plugins.Canvas2D.setAmbient(c,t.shader,S),u.style.backgroundColor=w;var x=root.lookup("view_"+e+"_scale").value();"number"!=typeof x&&(x=1);var E=root.lookup("view_"+e+"_zoom").value();"number"!=typeof E&&(E=1);var I=mat4.create(),k=mat4.create(),C=mat4.create();console.log("Viewport: ",t.width,t.height),c.viewport(0,0,t.width,t.height),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),mat4.ortho(C,-1,1,-t.height/t.width,t.height/t.width,.1,100);var A=root.lookup("view_"+e+"_camera_fov").value();A||(A=45),mat4.perspective(k,A,t.width/t.height,.1,100),root.lookup("view_"+e+"_camera_orthographic").value()&&(k=C),c.uniformMatrix4fv(t.shader.pMatrixUniform,!1,k),t.oMatrix=C,t.pMatrix=k,mat4.identity(I);var _=vec3.create();vec3.set(_,1,0,0),mat4.rotate(I,I,-f*Math.PI/180,_),vec3.set(_,0,1,0),mat4.rotate(I,I,-m*Math.PI/180,_);var T,D=vec3.create();for(T in vec3.set(D,-h,-g,-v),mat4.translate(I,I,D),c.uniform1i(t.shader.useLightingUniform,!1),eden.root.lookup("view_"+e+"_visibleobjects").assign([],eden.root.scope,EdenSymbol.defaultAgent),o)o[T][0].setAttribute("data-garbage",!0);if(Array.isArray(d)){var L,M,U=x*E;x<0?(c.scale(-U,U),U=-U,M=-x,L=!0):(M=x,L=!1);var N=root.lookup("view_"+e+"_offset").value();if(N instanceof Point){if(L){var P=t.height/U-N.y;c.translate(N.x,-P),N=new Point(N.x,P)}}else N=new Point(0,0);n.configureContextDefaults(c,M);for(var O=[d],V=[0],B=[],F="";O.length>0;){var H=O.pop(),R=V.pop();for(R>0&&H[R-1]instanceof EdenUI.plugins.Canvas2D.Transform&&(c.restore(),B.pop(),F=B.join(" "));R<H.length;){var j=H[R];if(j instanceof Object)if(Array.isArray(j))O.push(H),V.push(R+1),H=j,R=0;else if(j instanceof EdenUI.plugins.Canvas2D.Transform){O.push(H),V.push(R+1),c.save(),j.transform(c);var W=j.getCSS(U);F=F+W+" ",B.push(W),H=j.items,Array.isArray(H)||(H=[H]),R=0}else{var z=j.hash&&j.hash(),G=z&&o[z];if(G)j.elements=G;else try{if(n.configureContext(c,M,E,j.drawingOptions)){var J=mat4.clone(I);j.draw(c,x,e,J,t.shader,k,t,R)}}catch(e){void 0!==j&&console.log(e)}if(void 0!==j.elements){var q=j.elements[0].parentElement;if(q&&q!=u){for(var K=[],X=0;X<j.elements.length;X++)K.push($(j.elements[X]).clone(!0,!0).get(0));j.elements=K,j.scale(U,E,N)}else G&&!t.rescale||j.scale(U,E,N)}var Y=j.elements;Y&&(Y[0].setAttribute("data-garbage",!1),G||(u.length<=p?u.appendChild(Y[0]):u.insertBefore(Y[0],u.childNodes[p])),a[z]=Y,p++),R++}else R++}}if(1==root.lookup("view_"+e+"_grid_visible").value()){var Q,Z,ee=root.lookup("view_"+e+"_grid_spacing").value(),te=-N.x,ne=t.width/U-N.x;L?(Q=N.y-t.height/U,Z=N.y):(Q=-N.y,Z=t.height/U-N.y),c.save(),c.lineWidth=1/U,c.strokeStyle="thistle",n.drawGridLines(N,U,ee,te,Q,ne,Z,c),c.strokeStyle="magenta",n.drawGridLines(N,U,3*ee,te,Q,ne,Z,c),c.beginPath(),c.strokeStyle="blue",c.fillStyle="blue",c.arc(0,0,9/U,0,2*Math.PI,!1),c.fill(),c.beginPath(),c.moveTo(3*ee,0),c.lineTo(2*ee,.4*ee),c.lineTo(2*ee,-.4*ee),c.moveTo(0,3*ee),c.lineTo(.4*ee,2*ee),c.lineTo(-.4*ee,2*ee),c.fill(),c.beginPath(),c.lineWidth=4/U,c.moveTo(2*ee,0),c.lineTo(0,0),c.lineTo(0,3*ee),c.stroke(),c.restore()}}else{var ie=l.eden_definition;if(ie){var oe=new RegExp("^"+s+"\\s+is\\s+([a-zA-Z0-9_]+)(;)?$"),ae=ie.match(oe);null!==ae&&ae[1]}}!function(e,t){var n;for(n in t)if("false"!=t[n][0].getAttribute("data-garbage"))for(var i=t[n],o=0;o<i.length;o++)null!==i[o].parentElement&&e.removeChild(i[o])}(u,o),r[e]=a,t.drawingInProgress=!1,t.drawingQueued&&setTimeout(i,40)}};setTimeout(i,40)}},this.drawGridLines=function(e,t,n,i,o,a,r,s){s.beginPath();for(var l=0==e.x?n:0;l<=a;l+=n){var d=(Math.round(l*t)-.5)/t;s.moveTo(d,o),s.lineTo(d,r),s.stroke()}for(l=-n;l>=i;l-=n){d=(Math.round(l*t)-.5)/t;s.moveTo(d,o),s.lineTo(d,r),s.stroke()}for(var c=0==e.y?n:0;c<=r;c+=n){var u=(Math.round(c*t)-.5)/t;s.moveTo(i,u),s.lineTo(a,u),s.stroke()}for(c=-n;c>=o;c-=n){u=(Math.round(c*t)-.5)/t;s.moveTo(i,u),s.lineTo(a,u),s.stroke()}},this.configureContextDefaults=function(e,t){e.lineJoin="bevel",e.miterLimit=429496656,e.lineWidth=this.defaultLineWidth/t},this.configureContext=function(e,t,n,i){if("object"!=typeof i)return!0;if(!1===i.visible)return!1;if(Array.isArray(i.dashes)&&(e.setLineDash(i.dashes),"dashOffset"in i&&(e.lineDashOffset=i.dashOffset)),"cap"in i&&(e.lineCap=i.cap),"join"in i&&(e.lineJoin=i.join),"miterLimit"in i&&(e.miterLimit=i.miterLimit),"lineWidth"in i&&(e.lineWidth=i.lineWidth/t),"opacity"in i&&(e.globalAlpha=i.opacity),"object"==typeof i.shadow)if(e.shadowColor=i.shadow.colour,i.shadow.scale){var o=n*t;e.shadowBlur=i.shadow.blur*o,e.shadowOffsetX=i.shadow.xOffset*o,e.shadowOffsetY=i.shadow.yOffset*o}else e.shadowBlur=i.shadow.blur*n,e.shadowOffsetX=i.shadow.xOffset*n,e.shadowOffsetY=i.shadow.yOffset*n;return!0},this.setFillStyle=function(e,t){if(t instanceof CanvasImage){var n=e.createPattern(t.image,"repeat");e.fillStyle=n}else t instanceof EdenUI.plugins.Canvas2D.FillStyle?e.fillStyle=t.getColour(e):e.fillStyle=t},this.initZoneFromDrawingOpts=function(t,n){var i;if(t instanceof Object&&!1!==t.zone){if(void 0===(i=t.name)&&!0===t.zone)return root.currentObservableName();if(e.eden.isValidIdentifier(i)){var o=root.lookup(i+"_click");void 0===o.value()&&o.assign(!1,root.scope,root.lookup(n))}return i}},this.initZoneFromName=function(t,n){if(e.eden.isValidIdentifier(t)){var i=root.lookup(t+"_click");void 0===i.value()&&i.assign(!1,root.scope,root.lookup(n))}return t},this.findDrawableHit=function(e,t,n,i,o){var a=root.lookup("view_"+e+"_content").value(),r=canvases[e];if(r){var s=r.getContext("2d"),l=root.lookup("view_"+e+"_scale").value();return this.findDrawableHitInList(a,s,l,t,n,i,o)}},this.findDrawableHitInList=function(e,t,n,i,o,a,r){if(Array.isArray(e)){var s,l;a?(s=0,l=1):(s=e.length-1,l=-1);for(var d=s;a?d<e.length:d>=0;d+=l){var c=e[d];if("object"==typeof c)if(Array.isArray(c)){if(p=this.findDrawableHitInList(c,t,n,i,o,a,r))return p}else if(void 0!==c.isHit){if(!r&&void 0===c.name)continue;t.save();var u=c.isHit(t,n,i,o);if(t.restore(),!0===u)return c}else if(c.inverse){var p,h=c.inverse(i,o);if(void 0!==(p=this.findDrawableHitInList(c.items,t,n,h.x,h.y,a,r)))return p}}}},this.findAllDrawablesHit=function(e,t,n,i){var o=root.lookup("view_"+e+"_content").value(),a=canvases[e].getContext("2d"),r=root.lookup("view_"+e+"_scale").value();return this.findAllDrawablesHitInList(o,a,r,t,n,i)},this.findAllDrawablesHitInList=function(e,t,n,i,o,a){if(!Array.isArray(e))return[];for(var r=[],s=0;s<e.length;s++){var l=e[s];if("object"==typeof l)if(void 0!==l.isHit){if(!a&&void 0===l.name)continue;t.save();var d=l.isHit(t,n,i,o);t.restore(),!0===d&&r.push(l)}else if(l.inverse){var c=l.inverse(i,o),u=this.findAllDrawablesHitInList(l.items,t,n,c.x,c.y,a);u.length>0&&(r=r.concat(u))}}return r};var d={leftButton:!1,middleButton:!1,rightButton:!1,button4:!1,button5:!1,buttonCount:0,insideCanvas:!1,capturing:!1};this.createCommon=function(t,i){var o,l,c=t,u=canvases[t];function p(){n.drawPicture(c)}function h(e){return"view_"+t+"_"+e}void 0===u?((o=$('<div id="'+t+'-canvascontent" class="canvashtml-content"></div>')).html('<canvas class="canvashtml-canvas noselect" id="'+t+'-canvas" tabindex="1"></canvas>'),l=o.find(".canvashtml-canvas"),u=l[0],canvases[t]=u,contents[t]=o[0],r[t]={},u.drawingQueued=!1,u.drawingInProgress=!1,u.rescale=!1,EdenUI.plugins.Canvas2D.initGL(u)):l=(o=$("#"+t+"-canvascontent")).find(".canvashtml-canvas");var g=[h("content"),h("background_colour"),h("scale"),h("zoom"),h("offset"),h("canvas_right"),h("canvas_bottom"),"mousePosition","mouseButton","mouseButtons","mouseCapture","mouseCaptured","mouseDown","mouseDownView","mouseFollow","mousePressed","mouseUp","mouseWheel","mouseWheelEnabled","mouseWheelVelocity","mouseView","mouseZone","mouseVelocity"];u.setAttribute("data-observables",g.join(",")),root.lookup("view_"+c+"_content").addJSObserver("repaintView",p);var v=root.lookup("view_"+c+"_background_colour");void 0===v.value()&&v.assign("white",root.scope,EdenSymbol.defaultAgent),v.addJSObserver("refreshView",p),root.lookup("view_"+c+"_camera_position").addJSObserver("refreshView",p),root.lookup("view_"+c+"_camera_angle").addJSObserver("refreshView",p),root.lookup("view_"+c+"_camera_orthographic").addJSObserver("refreshView",p),root.lookup("view_"+c+"_ambient_colour").addJSObserver("refreshView",p);var f=root.lookup("view_"+c+"_scale"),m=root.lookup("view_"+c+"_zoom"),b=root.lookup("view_"+c+"_offset"),y=root.lookup("view_"+c+"_canvas_right"),w=root.lookup("view_"+c+"_canvas_bottom"),S=root.lookup("view_"+c+"_width"),x=root.lookup("view_"+c+"_height"),E=!1;function I(){var t,i,o=f.value(),a=m.value(),r=o*a,s=b.value();s instanceof Point?(t=s.x,i=s.y):(t=0,i=0);var l,d=y.value();void 0!==d?(d=Math.ceil((y.value()+t)*r),u.width=d):u.width=a>1?Math.ceil(S.value()*a):Math.floor(S.value()),void 0!==w.value()?l=Math.ceil((w.value()+i)*r):a>1?l=Math.ceil(x.value()*a):(l=x.value(),void 0!==d&&d>Math.floor(S.value())&&(l-=e.scrollBarSize),l=Math.floor(l-1)),u.height=l,u.rescale=!0,n.drawPicture(c)}var k=f.value();void 0===k&&(f.assign(1,root.scope,EdenSymbol.defaultAgent),k=1),f.addJSObserver("refreshView",I);var C=m.value();void 0===C&&(m.assign(1,root.scope,EdenSymbol.defaultAgent),C=1);var A=!1;function _(){E?(E=!1,u.rescale=!0,n.drawPicture(c),A||(A=!0,setTimeout(_,1e3))):(I(),A=!1)}m.addJSObserver("refreshView",function(e,t){Math.round(100*t);E=!0,_()});var T,D,L=b.value();L instanceof Point?(T=L.x,D=L.y):(b.assign(new Point(0,0),root.scope,EdenSymbol.defaultAgent),T=0,D=0),b.addJSObserver("refreshView",I),void 0==y.value()&&y.assign(void 0,root.scope,EdenSymbol.defaultAgent),y.addJSObserver("repaintView",I),void 0==w.value()&&w.assign(void 0,root.scope,EdenSymbol.defaultAgent),w.addJSObserver("repaintView",I);var M=y.value();M=void 0===M?600:M*k+T;var U=w.value();U=void 0===U?500:U*k+D;var N=root.lookup("view_"+c+"_grid_visible");void 0===N.value()&&N.assign(!1,root.scope,EdenSymbol.defaultAgent),N.addJSObserver("refreshView",p);var P=root.lookup("view_"+c+"_grid_spacing");function O(e){var t,i=root.lookup("mouseFollow").value();switch(root.beginAutocalcOff(),d.insideCanvas=!0,e.button){case 0:d.leftButton=!0,root.lookup("mousePressed").assign(!0,root.scope,EdenSymbol.hciAgent,i),t="Left";break;case 1:d.middleButton=!0,t="Middle";break;case 2:d.rightButton=!0,t="Right";break;case 3:d.button4=!0,t="Button4";break;case 4:d.button5=!0,t="Button5";break;default:t="Unknown"}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5;var o="|";if(d.leftButton&&(o+="Left|"),d.middleButton&&(o+="Middle|"),d.rightButton&&(o+="Right|"),d.button4&&(o+="Button4|"),d.button5&&(o+="Button5|"),root.lookup("mouseButtons").assign(o,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseButton").assign(t+" down",root.scope,EdenSymbol.hciAgent,i),1==d.buttonCount){var a=root.lookup("mousePosition").value();root.lookup("mouseDownView").assign(c,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseDown").assign(a,root.scope,EdenSymbol.hciAgent,i);var r=root.lookup("view_"+c+"_scale").value()*root.lookup("view_"+c+"_zoom").value(),s=$(this).offset(),l=(e.pageX-Math.round(s.left))/r,u=(e.pageY-Math.round(s.top))/r,p=root.lookup("view_"+c+"_offset").value();p instanceof Point&&(l-=p.x,u-=p.y);var h,g=n.findDrawableHit(c,l,u,!1,!1);h=void 0===g?void 0:g.name;var v=root.lookup("mouseZone");h!==v.value()&&v.assign(h,root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseDownZone").assign(h,root.scope,EdenSymbol.hciAgent,i)}root.endAutocalcOff()}return void 0===P.value()&&P.assign(20,root.scope,EdenSymbol.defaultAgent),P.addJSObserver("refreshView",p),l.on("mousedown",O),l.on("mouseup",function(t){var n,i=root.lookup("mouseFollow").value();switch(root.beginAutocalcOff(),d.insideCanvas=!0,navigator.platform.toUpperCase().indexOf("MAC")>=0&&t.ctrlKey&&(t.button=2),t.button){case 0:d.leftButton=!1,root.lookup("mousePressed").assign(!1,root.scope,EdenSymbol.hciAgent,i),n="Left";break;case 1:d.middleButton=!1,n="Middle";break;case 2:d.rightButton=!1,n="Right";break;case 3:d.button4=!1,n="Button4";break;case 4:d.button5=!1,n="Button5";break;default:n="Unknown"}if(d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5,root.lookup("mouseButton").assign(n+" up",root.scope,EdenSymbol.hciAgent,i),0==d.buttonCount){var o=root.lookup("mousePosition").value();root.lookup("mouseButtons").assign("",root.scope,EdenSymbol.hciAgent,i),root.lookup("mouseUp").assign(o,root.scope,EdenSymbol.hciAgent,i),e.plugins.Canvas2D.endClick()}else{var a="|";d.leftButton&&(a+="Left|"),d.middleButton&&(a+="Middle|"),d.rightButton&&(a+="Right|"),d.button4&&(a+="Button4|"),d.button5&&(a+="Button5|"),root.lookup("mouseButtons").assign(a,root.scope,EdenSymbol.hciAgent,i)}root.endAutocalcOff()}).on("contextmenu",function(e){navigator.platform.toUpperCase().indexOf("MAC")>=0&&e.ctrlKey&&(e.button=2,O(e)),root.lookup("mouseContextMenuEnabled").value()||(e.preventDefault(),e.stopPropagation())}).on("click",function(e){root.lookup("mouseCapture").value()&&this.requestPointerLock()}).on("dblclick",function(e){var t=root.lookup("mouseFollow").value(),n=root.lookup("mouseDoubleClicks"),i=n.value();n.assign(i+1,root.scope,EdenSymbol.hciAgent,t)}).on("wheel",function(e){var t,i=e.originalEvent,o=x.value();t=i.deltaMode==WheelEvent.DOM_DELTA_LINE?n.defaultLineHeight:i.deltaMode==WheelEvent.DOM_DELTA_PAGE?0!=i.deltaX?S.value():o:1;var a=root.lookup("mouseFollow").value();if(0==i.deltaY||!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey){if(root.lookup("mouseWheelEnabled").value()){if(root.beginAutocalcOff(),0!==i.deltaY&&(!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey)){e.preventDefault(),e.stopPropagation();var r=root.lookup("mouseWheel"),s=r.value();s+=u=i.deltaY*t,r.assign(s,root.scope,EdenSymbol.hciAgent,a),root.lookup("mouseWheelVelocity").assign(u,root.scope,EdenSymbol.hciAgent,a)}if(0!==i.deltaX){e.preventDefault(),e.stopPropagation();var l=root.lookup("touchPanX"),d=l.value(),c=i.deltaX*t;d+=c,l.assign(d,root.scope,EdenSymbol.hciAgent,a),root.lookup("touchPanXSpeed").assign(c,root.scope,EdenSymbol.hciAgent,a)}root.endAutocalcOff()}}else{e.preventDefault(),e.stopPropagation(),root.beginAutocalcOff();var u=-i.deltaY*t;if(root.lookup("touchPinchEnabled").value()){var p=root.lookup("touchPinch"),h=p.value();h+=u,p.assign(h,root.scope,EdenSymbol.hciAgent,a)}else{var g=m.value();(g=g*(o+2*u)/o)<.05&&(g=.05),m.assign(g,root.scope,EdenSymbol.hciAgent,a)}root.endAutocalcOff()}}).on("mouseout",function(e){d.insideCanvas=!1;var t=root.lookup("mouseFollow").value();root.lookup("mouseZone").assign(void 0,root.scope,EdenSymbol.hciAgent,t)}).on("mouseenter",function(e){if(!d.insideCanvas){var t;d.insideCanvas=!0,0==d.buttonCount?t="":(t="|",d.leftButton&&(t+="Left|"),d.middleButton&&(t+="Middle|"),d.rightButton&&(t+="Right|"),d.button4&&(t+="Button4|"),d.button5&&(t+="Button5|"));var n=root.lookup("mouseButtons"),i=n.value();if(t!=i){var o=root.lookup("mouseFollow").value();root.beginAutocalcOff(),n.assign(t,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseButton").assign("Enter window",root.scope,EdenSymbol.hciAgent,o);var a=root.lookup("mousePressed");a.value()!=d.leftButton&&a.assign(d.leftButton,root.scope,EdenSymbol.hciAgent,o),""==i&&""!=t&&(root.lookup("mouseDown").assign(void 0,root.scope,EdenSymbol.hciAgent,o),root.lookup("mouseDownView").assign(void 0,root.scope,EdenSymbol.hciAgent,o)),root.endAutocalcOff()}}}).on("mousemove",function(e){s=!0;var t=root.lookup("mouseFollow").value();root.beginAutocalcOff();var i,o,r,l,u=root.lookup("mouseView"),p=root.lookup("mousePosition"),h=u.value(),g=p.value();g&&(r=g.x,l=g.y);var v=root.lookup("view_"+c+"_scale").value()*root.lookup("view_"+c+"_zoom").value();if(d.capturing){var f=e.originalEvent;i=r+f.movementX/v,o=l+f.movementY/v}else{var m=$(this).offset();i=(e.pageX-Math.round(m.left))/v,o=(e.pageY-Math.round(m.top))/v;var b=root.lookup("view_"+c+"_offset").value();b instanceof Point&&(i-=b.x,o-=b.y)}u.assign(c,root.scope,EdenSymbol.hciAgent,t);var y,w=new Point(i,o);p.assign(w,root.scope,EdenSymbol.hciAgent,t);var S=Date.now();if(h==c&&void 0!==a){if((y=S-a)>=n.mouseVelocitySampleTime){var x=root.lookup("mouseVelocity"),E=x.value(),I=1e3*(i-r)/y,k=1e3*(o-l)/y;if(E){var C=n.mouseVelocityDampening,A=E.x;(I>0&&A>0||I<0&&A<0)&&(I=C*A+(1-C)*I);var _=E.y;(k>0&&_>0||k<0&&_<0)&&(k=C*_+(1-C)*k)}I=Math.ceil(I*v)/v,k=Math.ceil(k*v)/v;var T=new Point(I,k);x.assign(T,root.scope,EdenSymbol.hciAgent,t),a=S}}else a=S;var D,L=n.findDrawableHit(c,i,o,!1,!1);D=void 0===L?void 0:L.name;var M=root.lookup("mouseZone");D!==M.value()&&M.assign(D,root.scope,EdenSymbol.hciAgent,t),root.endAutocalcOff()}).on("keyup",function(e){var t=e.which,n=!1;if(e.altKey&&!e.shiftKey&&!e.ctrlKey){var i=root.lookup("view_"+c+"_zoom"),o=i.value();61==t||187==t?(o*=1.25,n=!0):173==t||189==t?(o/=1.25,n=!0):48==t&&(o=1,n=!0),i.assign(o,root.scope,EdenSymbol.hciAgent)}n&&(e.preventDefault(),e.stopPropagation())}),{initialWidth:M,initialHeight:U,code_entry:o,offsetSym:b,zoomSym:m,widthSym:y,heightSym:w,scaleSym:f}},this.createEmbedded=function(t,i,o){var a=t;eden.execute2("view_"+a+"_content is "+o+";");var r=n.createCommon(t,i),s=(r.initialWidth,r.initialHeight,r.code_entry),l=r.offsetSym,d=r.zoomSym,c=r.widthSym,u=r.heightSym,p=r.scaleSym;return{code_entry:s,contents:s,destroy:function(){delete canvases[a],delete contents[a]},resize:function(t,i){var o,r=l.value();r instanceof Point?(o=r.x,r.y):o=0;var s,h=d.value(),g=document.getElementById(a+"-canvas"),v=!1,f=c.value();if(void 0===f?(s=h>1?Math.ceil(t*h):Math.floor(t),g.width!=s&&(g.width=s,v=!0)):f=Math.ceil(f*p.value()*h+o),void 0===u.value()){if(h>1)m=Math.ceil(i*h);else{m=i,void 0!==f&&f>m&&(m-=e.scrollBarSize);var m=Math.floor(m-1)}m!=g.height&&(g.height=m,v=!0)}v&&n.drawPicture(a)}}},this.createDialog=function(t,i){var o,a=t.slice(0,-7),s=n.createCommon(a,i),l=s.initialWidth,d=s.initialHeight,c=s.code_entry,u=s.offsetSym,p=s.zoomSym,h=s.widthSym,g=s.heightSym,v=s.scaleSym;return $('<div id="'+t+'"></div>').html(c).dialog({appendTo:"#jseden-views",title:i,width:l+e.scrollBarSize,height:d+e.titleBarHeight,minHeight:120,minWidth:230,classes:{"ui-dialog":"canvas-dialog unpadded-dialog ui-front"}}),o={confirmClose:!0,destroy:function(){var e=r[a];for(var t in e)for(var n=e[t],i=0;i<n.length;i++){var o=n[i];$(o).detach()}delete canvases[a],delete contents[a]},resize:function(t,i){var o,r=u.value();r instanceof Point?(o=r.x,r.y):o=0;var s,l=p.value(),d=document.getElementById(a+"-canvas"),c=!1,f=h.value();if(void 0===f?(s=l>1?Math.ceil(t*l):Math.floor(t),d.width!=s&&(d.width=s,c=!0)):f=Math.ceil(f*v.value()*l+o),void 0===g.value()){if(l>1)m=Math.ceil(i*l);else{m=i,void 0!==f&&f>m&&(m-=e.scrollBarSize);var m=Math.floor(m-1)}m!=d.height&&(d.height=m,c=!0)}c&&n.drawPicture(a)}},n.drawPicture(a),o},root.lookup("mouseDownZone").addJSObserver("recordClick",function(e,t){if(eden.isValidIdentifier(t)){var n=root.lookup(t+"_click");!1===n.value()&&n.assign(!0,root.scope,EdenSymbol.hciAgent,!0)}}),this.endClick=function(){var e=root.lookup("mouseDownZone").value();if(eden.isValidIdentifier(e)){var t=root.lookup(e+"_click");!0===t.value()&&t.assign(!1,root.scope,EdenSymbol.hciAgent,!0)}},this.canvasNameFromElement=function(e){for(;e;){var t=e.id;if("-canvascontent"==t.slice(-14))return t.slice(0,-14);e=e.parentElement}return null},document.addEventListener("mouseup",function(t){var n=root.lookup("mouseFollow").value();if(root.beginAutocalcOff(),!d.insideCanvas){var i;switch(t.button){case 0:d.leftButton=!1,i="Left";break;case 1:d.middleButton=!1,i="Middle";break;case 2:d.rightButton=!1,i="Right";break;case 3:d.button4=!1,i="Button4";break;case 4:d.button5=!1,i="Button5";break;default:i="Unknown"}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5;var o=root.lookup("mouseButtons");if(0==d.buttonCount&&""!=o.value()){var a=root.lookup("mousePressed"),r=a.value();root.lookup("mouseButton").assign(i+" up",root.scope,EdenSymbol.hciAgent,n),o.assign("",root.scope,EdenSymbol.hciAgent,n),root.lookup("mousePosition").assign(void 0,root.scope,EdenSymbol.hciAgent,n),r&&a.assign(!1,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseUp").assign(void 0,root.scope,EdenSymbol.hciAgent,n),root.lookup("mouseView").assign(void 0,root.scope,EdenSymbol.hciAgent,n),e.plugins.Canvas2D.endClick()}}root.endAutocalcOff()}),document.addEventListener("mousedown",function(e){if(!d.insideCanvas){switch(e.button){case 0:d.leftButton=!0;break;case 1:d.middleButton=!0;break;case 2:d.rightButton=!0;break;case 3:d.button4=!0;break;case 4:d.button5=!0}d.buttonCount=d.leftButton+d.middleButton+d.rightButton+d.button4+d.button5}}),document.addEventListener("pointerlockchange",function(e){var t=null!==document.pointerLockElement;d.capturing=t;var n=root.lookup("mouseFollow").value();root.lookup("mouseCaptured").assign(t,root.scope,void 0,n)}),e.views.Canvas2D={dialog:this.createDialog,embedded:this.createEmbedded,title:"Canvas 2D",category:e.viewCategories.visualization,holdsContent:!0},document.location.pathname.slice(-15),Eden.Selectors.execute("plugins > canvas_merged",function(){eden.root.lookup("plugins_canvas_loaded").assign(!0,eden.root.scope),t&&t()})},EdenUI.plugins.Canvas2D.FillStyle=function(){},EdenUI.plugins.Canvas2D.Transform=function(){},EdenUI.plugins.Canvas2D.Transform.CSSInfo=function(e,t,n){this.css=e,this.scaleX=t,this.scaleY=n},EdenUI.plugins.Canvas2D.title="Canvas 2D",EdenUI.plugins.Canvas2D.description="Provides the ability to draw two-dimensional shapes, images, text and user interface controls using EDEN dependencies.",EdenUI.plugins.Canvas2D.initGL=function(e){var t=e.getContext("experimental-webgl");t.clearColor(1,1,1,1),t.enable(t.DEPTH_TEST),t.viewportWidth=e.width,t.viewportHeight=e.height,e.shader=EdenUI.plugins.Canvas2D.initShaders(t);var n=jQuery.Color("#555"),i=n.red()/255,o=n.green()/255,a=n.blue()/255;t.uniform3f(e.shader.ambientColorUniform,i,o,a)},EdenUI.plugins.Canvas2D.setBackground=function(e,t){var n=jQuery.Color(t),i=n.red()/255,o=n.green()/255,a=n.blue()/255;e.clearColor(i,o,a,1)},EdenUI.plugins.Canvas2D.setAmbient=function(e,t,n){var i=jQuery.Color(n),o=i.red()/255,a=i.green()/255,r=i.blue()/255;e.uniform3f(t.ambientColorUniform,o,a,r)},EdenUI.plugins.Canvas2D.getShader=function(e,t,n){var i;if("fragment"==n)i=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=n)return null;i=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},vec3.unproject=function(e,t,n,i){var o=n[0],a=n[1],r=n[2],s=n[3],l=t[0],d=t[1],c=t[2];l-=o,d=s-d-1,d-=a;var u=vec3.create();return vec3.set(u,2*l/r-1,2*d/s-1,2*c-1),vec3.project(e,u,i)},vec3.project=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=n,s=r[0],l=r[1],d=r[2],c=r[3],u=r[4],p=r[5],h=r[6],g=r[7],v=r[8],f=r[9],m=r[10],b=r[11],y=r[12],w=r[13],S=r[14],x=1/(i*c+o*g+a*b+r[15]);return vec3.set(e,(i*s+o*u+a*v+y)*x,(i*l+o*p+a*f+w)*x,(i*d+o*h+a*m+S)*x),e},EdenUI.plugins.Canvas2D.shapeAtCentre=function(e){},EdenUI.plugins.Canvas2D.initShaders=function(e){var t=EdenUI.plugins.Canvas2D.getShader(e,"precision mediump float;\n\n  varying vec2 vTextureCoord;\n  varying vec3 vLightWeighting;\n\n  uniform sampler2D uSampler;\n\n  void main(void) {\n     vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n\t\t//if (vTextureCoord.s < 0.01 || vTextureCoord.t < 0.01 || vTextureCoord.s > 0.99 || vTextureCoord.t > 0.99) {\n\t\t//\tgl_FragColor = vec4(0.945,0.49,0,1);\n\t\t//} else {\n     \t\tgl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n\t\t//}\n  }","fragment"),n=EdenUI.plugins.Canvas2D.getShader(e,"attribute vec3 aVertexPosition;\n  attribute vec3 aVertexNormal;\n  attribute vec2 aTextureCoord;\n\n  uniform mat4 uMVMatrix;\n  uniform mat4 uPMatrix;\n  uniform mat3 uNMatrix;\n\n  uniform vec3 uAmbientColor;\n\n  uniform vec3 uLightingDirection;\n  uniform vec3 uDirectionalColor;\n  uniform vec3 uPointLightingLocation;\n  uniform vec3 uPointLightingColor;\n\n  uniform bool uUseLighting;\n\n  varying vec2 vTextureCoord;\n  varying vec3 vLightWeighting;\n\n  void main(void) {\n    vec4 mvPosition = uMVMatrix * vec4(aVertexPosition, 1.0);\n\tvec4 mvLightLocation = uMVMatrix*vec4(uPointLightingLocation,1.0);\n    gl_Position = uPMatrix * mvPosition;\n\n    vTextureCoord = aTextureCoord;\n\n    if (!uUseLighting) {\n      vLightWeighting = vec3(1.0, 1.0, 1.0);\n    } else {\n      vec3 lightDirection = normalize(mvLightLocation.xyz - aVertexPosition.xyz);\n      vec4 transformedNormal = normalize(uMVMatrix* vec4(aVertexNormal,1.0));\n      float directionalLightWeighting = max(dot(transformedNormal.xyz, uLightingDirection), 0.0);\n      float pointLightWeighting = max(dot(transformedNormal.xyz, lightDirection), 0.0);\n      vLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting + uPointLightingColor * pointLightWeighting;\n    }\n  }","vertex");return t=EdenUI.plugins.Canvas2D.getShader(e,"\n\tprecision mediump float;\n\n  varying vec2 vTextureCoord;\n  varying vec3 vTransformedNormal;\n  varying vec4 vPosition;\n\n  uniform bool uUseLighting;\n  uniform bool uUseTextures;\n\n  uniform vec3 uAmbientColor;\n\n  uniform vec3 uPointLightingLocation;\n  uniform vec3 uPointLightingColor;\n  uniform vec3 uLightingDirection;\n  uniform vec3 uDirectionalColor;\n\n\n  uniform sampler2D uSampler;\n\n  void main(void) {\n    vec3 lightWeighting;\n    if (!uUseLighting) {\n      lightWeighting = vec3(1.0, 1.0, 1.0);\n    } else {\n      vec3 lightDirection = normalize(uPointLightingLocation - vPosition.xyz);\n\n      float directionalLightWeighting = max(dot(normalize(vTransformedNormal), lightDirection), 0.0);\n      lightWeighting = uAmbientColor + uPointLightingColor * directionalLightWeighting;\n    }\n\n    vec4 fragmentColor;\n    //if (uUseTextures) {\n      fragmentColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n    //} else {\n    //  fragmentColor = vec4(1.0, 1.0, 1.0, 1.0);\n    //}\n    gl_FragColor = vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);\n  }\n","fragment"),n=EdenUI.plugins.Canvas2D.getShader(e,"\n\tattribute vec3 aVertexPosition;\n  attribute vec3 aVertexNormal;\n  attribute vec2 aTextureCoord;\n\n  uniform mat4 uMVMatrix;\n  uniform mat4 uPMatrix;\n  uniform mat3 uNMatrix;\n\n  varying vec2 vTextureCoord;\n  varying vec3 vTransformedNormal;\n  varying vec4 vPosition;\n\n  void main(void) {\n    vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);\n    gl_Position = uPMatrix * vPosition;\n    vTextureCoord = aTextureCoord;\n    vTransformedNormal = uNMatrix * aVertexNormal;\n  }\n","vertex"),shaderProgram=e.createProgram(),e.attachShader(shaderProgram,n),e.attachShader(shaderProgram,t),e.linkProgram(shaderProgram),e.getProgramParameter(shaderProgram,e.LINK_STATUS)||alert("Could not initialise shaders"),e.useProgram(shaderProgram),shaderProgram.vertexPositionAttribute=e.getAttribLocation(shaderProgram,"aVertexPosition"),e.enableVertexAttribArray(shaderProgram.vertexPositionAttribute),shaderProgram.vertexNormalAttribute=e.getAttribLocation(shaderProgram,"aVertexNormal"),e.enableVertexAttribArray(shaderProgram.vertexNormalAttribute),shaderProgram.textureCoordAttribute=e.getAttribLocation(shaderProgram,"aTextureCoord"),e.enableVertexAttribArray(shaderProgram.textureCoordAttribute),shaderProgram.pMatrixUniform=e.getUniformLocation(shaderProgram,"uPMatrix"),shaderProgram.mvMatrixUniform=e.getUniformLocation(shaderProgram,"uMVMatrix"),shaderProgram.nMatrixUniform=e.getUniformLocation(shaderProgram,"uNMatrix"),shaderProgram.samplerUniform=e.getUniformLocation(shaderProgram,"uSampler"),shaderProgram.useLightingUniform=e.getUniformLocation(shaderProgram,"uUseLighting"),shaderProgram.ambientColorUniform=e.getUniformLocation(shaderProgram,"uAmbientColor"),shaderProgram.lightingDirectionUniform=e.getUniformLocation(shaderProgram,"uLightingDirection"),shaderProgram.directionalColorUniform=e.getUniformLocation(shaderProgram,"uDirectionalColor"),shaderProgram.pointLightingLocationUniform=e.getUniformLocation(shaderProgram,"uPointLightingLocation"),shaderProgram.pointLightingColorUniform=e.getUniformLocation(shaderProgram,"uPointLightingColor"),shaderProgram},SNVertex.prototype.removeFace=function(e){for(var t=0;t<this.faces.length;t++)if(this.faces[t]===e){this.faces.splice(t,1);break}},SNVertex.prototype.addFace=function(e){for(var t=0;t<this.faces.length;t++)this.faces[t].addAdj(e);this.faces.push(e),vec3.add(this.normal,this.normal,e.normal)},SNVertex.computeEdgeCollapseCost=function(e,t){for(var n=vec3.distance(t.vec,e.vec),i=0,o=[],a=0;a<e.faces.length;a++)e.faces[a].deleted||e.faces[a].hasVertex(t)&&o.push(e.faces[a]);for(a=0;a<e.faces.length;a++)if(!e.faces[a].deleted){for(var r=1,s=0;s<o.length;s++)if(e.faces[a]!==o[s]&&!o[s].deleted&&!e.faces[a].deleted){var l=vec3.dot(e.faces[a].normal,o[s].normal);r=Math.min(r,(1-l)/2)}i=Math.max(i,r)}return n*i},SNVertex.prototype.adjacentVertices=function(){for(var e={},t=0;t<this.faces.length;t++)this.faces[t].deleted||(e[this.faces[t].v1.id]=this.faces[t].v1,e[this.faces[t].v2.id]=this.faces[t].v2,e[this.faces[t].v3.id]=this.faces[t].v3);var n=[];for(var i in e)i!=this.id&&n.push(e[i]);return n},SNVertex.prototype.computeEdgeCostAtVertex=function(){if(0==this.faces.length)return this.collapse=null,void(this.cost=-.01);this.cost=1e6,this.collapse=null;for(var e=this.adjacentVertices(),t=0;t<e.length;t++){var n;(n=SNVertex.computeEdgeCollapseCost(this,e[t]))<this.cost&&(this.collapse=e[t],this.cost=n)}return this.cost},SNFace.prototype.hasVertex=function(e){return this.v1===e||this.v2===e||this.v3===e},SNFace.prototype.addAdj=function(e){this.adj.push(e)},SNFace.prototype.replace=function(e,t){if(this.hasVertex(e)&&this.hasVertex(t))this.deleted=!0;else{if(this.v1===e)this.v1=t;else if(this.v2===e)this.v2=t;else{if(this.v3!==e)return;this.v3=t}var n=Point3D.normal(this.v1.vec,this.v2.vec,this.v3.vec);this.normal=[n.x,n.y,n.z],vec3.normalize(this.normal,this.normal),t.addFace(this)}};var SNcube_edges=new Int32Array(24),SNedge_table=new Int32Array(256);!function(){for(var e=0,t=0;t<8;++t)for(var n=1;n<=4;n<<=1){var i=t^n;t<=i&&(SNcube_edges[e++]=t,SNcube_edges[e++]=i)}for(t=0;t<256;++t){var o=0;for(n=0;n<24;n+=2){o|=!!(t&1<<SNcube_edges[n])!==!!(t&1<<SNcube_edges[n+1])?1<<(n>>1):0}SNedge_table[t]=o}}();var SNbuffer=new Array(4096);!function(){for(var e=0;e<SNbuffer.length;++e)SNbuffer[e]=0}(),surfaceNets=function(e,t,n,i){for(var o=[e,e,e],a=e*e,r=[[n,n,n],[n+i,n+i,n+i]],s=[0,0,0],l=[0,0,0],d=0;d<3;++d)s[d]=(r[1][d]-r[0][d])/o[d],l[d]=r[0][d];var c=[],u=[],p=[0,0,0],h=[1,o[0]+1,(o[0]+1)*(o[1]+1)],g=[0,0,0,0,0,0,0,0],v=1;if(2*h[2]>SNbuffer.length){var f=SNbuffer.length;for(SNbuffer.length=2*h[2];f<SNbuffer.length;)SNbuffer[f++]=0}for(p[2]=0;p[2]<o[2]-1;++p[2],o[0],v^=1,h[2]=-h[2]){var m=1+(o[0]+1)*(1+v*(o[1]+1));for(p[1]=0;p[1]<o[1]-1;++p[1],0,m+=2)for(p[0]=0;p[0]<o[0]-1;++p[0],0,++m){for(var b=0,y=0,w=0;w<2;++w)for(var S=0;S<2;++S)for(d=0;d<2;++d,++y){var x=t[p[0]+d+(p[1]+S)*e+(p[2]+w)*a];g[y]=x,b|=x<0?1<<y:0}if(0!==b&&255!==b){var E=SNedge_table[b],I=[0,0,0],k=0;for(d=0;d<12;++d)if(E&1<<d){++k;var C=SNcube_edges[d<<1],A=SNcube_edges[1+(d<<1)],_=g[C],T=_-g[A];if(Math.abs(T)>1e-6){T=_/T;for(S=0,w=1;S<3;++S,w<<=1){var D=C&w,L=A&w;I[S]+=D!==L?D?1-T:T:D?1:0}}}var M=1/k;for(d=0;d<3;++d)I[d]=s[d]*(p[d]+M*I[d])+l[d];SNbuffer[m]=c.length,c.push(new SNVertex(SNbuffer[m],I[0],I[1],I[2]));for(d=0;d<3;++d)if(E&1<<d){var U=(d+1)%3,N=(d+2)%3;if(0!==p[U]&&0!==p[N]){var P=h[U],$=h[N];1&b?(u.push(new SNFace(u.length,c[SNbuffer[m]],c[SNbuffer[m-P]],c[SNbuffer[m-$]])),u.push(new SNFace(u.length,c[SNbuffer[m-$]],c[SNbuffer[m-P]],c[SNbuffer[m-P-$]]))):(u.push(new SNFace(u.length,c[SNbuffer[m]],c[SNbuffer[m-$]],c[SNbuffer[m-P]])),u.push(new SNFace(u.length,c[SNbuffer[m-P]],c[SNbuffer[m-$]],c[SNbuffer[m-P-$]])))}}}}}console.log("We have "+u.length+" faces");var O=0,V=new Array,B=new Array,F=0;for(d=0;d<c.length;d++)vec3.normalize(c[d].normal,c[d].normal);for(d=0;d<u.length;d++)u[d].deleted?O++:(V[F]=u[d].v1.vec[0],V[F+1]=u[d].v1.vec[1],V[F+2]=u[d].v1.vec[2],B[F]=u[d].normal[0],B[F+1]=u[d].normal[1],B[F+2]=u[d].normal[2],V[F+=3]=u[d].v2.vec[0],V[F+1]=u[d].v2.vec[1],V[F+2]=u[d].v2.vec[2],B[F]=u[d].normal[0],B[F+1]=u[d].normal[1],B[F+2]=u[d].normal[2],V[F+=3]=u[d].v3.vec[0],V[F+1]=u[d].v3.vec[1],V[F+2]=u[d].v3.vec[2],B[F]=u[d].normal[0],B[F+1]=u[d].normal[1],B[F+2]=u[d].normal[2],F+=3);return console.log("Removed "+O+" faces",u),{positions:V,normals:B}},EdenUI.plugins.Page=function(e,t){var n,i=e.eden.root.lookup("page"),o=e.eden.root.lookup("document"),a=i.value(),r=$("<div class='main-page page'></div>");$("#jseden-views").append(r).addClass("page-body");var s=[],l={},d={},c={},u=0;function p(e){if(!e)return"";if("header"!=e[0])return"";switch(e[3]){case 0:return $("<div class='clear'/><h1 class='page-header'>"+e[1]+"</h1>");case 1:return $("<h2 class='page-header'>"+e[1]+"</h2>")}}var h=["top","bottom","left","right","width","height","background","position","color","border","font","fontSize","fontFamily","fontWeight","borderBottom","borderLeft","borderRight","borderTop","overflow","padding","paddingTop","paddingLeft","paddingRight","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","textShadow"];function g(e){switch(typeof e){case"string":return e;case"number":return e+"px";default:return""}}function v(e){var t=[],n=[],i=(e=(e=(e=e.replace(/"jseden:([^"]*)"/g,"\"javascript:eden.execute2('$1;')\"")).replace(/'jseden:([^']*)'/g,"'javascript:eden.execute2(\"$1;\")'")).replace(/<jseden(-([\w\-]+))?(\s+(?:[^"'/>]*(?:"[^"]*")*(?:'[^']*')*)*)?(?:\/|(?:>((?:[^<]*(?:<(?!\/jseden\1>))*)*)<\/jseden\1))>/g,function(e,i,o,a,r,s,l){return void 0===r&&(r=""),t.push(r),n.push(function(e,t){var n={};if(n.tagType=e,void 0===t)return n;for(var i,o=/([^\s=]+)(?:\s*=\s*((?:"[^"]*")|(?:'[^']*')|\S*))?/g;null!==(i=o.exec(t));)if(void 0===i[2]||""==i[2])n[i[1]]=!0;else{var a,r=i[2][0];a='"'==r||"'"==r?i[2].slice(1,-1):i[2],/^\d+$/.test(a)&&(a=parseInt(a)),n[i[1]]=a}return n}(o,a)),"\0\0"})).split("\0\0");if(1==i.length)return e;for(var o=$("<div></div>"),a=0;a<i.length-1;a++)if(o.append($("<div class='page-paragraph'>"+i[a]+"</div>")),void 0===n[a].tagType){var r=t[a].split("\n").length;void 0===n[a].lines&&(n[a].lines=r),void 0===n[a].width&&(n[a].width="50%"),void 0===n[a].box&&(n[a].box=!0);var s=y(["script",n[a].static,[t[a]],n[a].name,n[a].box,n[a].lines,!1,n[a].float,n[a].width]);o.append(s)}else if(n[a])if("canvas"==n[a].tagType){var l=S(["canvas",n[a].name,n[a].source,n[a].width,n[a].height,n[a].float,n[a].box]);o.append(l)}else if("veden"==n[a].tagType){var d=w(["veden",n[a].name,n[a].width,n[a].height,n[a].float,t[a]]);o.append(d)}return o.append($("<div class='page-paragraph'>"+i[i.length-1]+"</div>")),o.get(0)}function f(e){if(e&&"element"==e[0]){var t,n=e[1],i=e[2],o=e[3],a=e[4],r=e[5],s=e[6],l=(e[7],e[8],e[9],e[10],e[11],e[12]),d=e[13];switch(n){case"div":case"span":case"button":case"img":case"p":case"ul":case"ol":case"li":case"br":case"pre":case"h1":case"h2":case"h3":case"a":case"input":t=document.createElement(n);break;default:return void console.error("Invalid element type: "+n)}if(i&&(t.id=i),o&&(t.className=o),a&&"string"==typeof a){var c=v(a);"string"==typeof c?t.innerHTML=c:t.appendChild(c)}return a&&a instanceof Array&&m(t,a),r&&"string"==typeof r&&(t.cssText=r),r&&r instanceof Array&&function(e,t){for(var n=0;n<t.length;n++)void 0!==t[n]&&h[n]&&(e.style[h[n]]=g(t[n]))}(t,r),s&&i&&(t.onclick=function(e){var t=eden.root.lookup(i+"_click");console.log("ELEMENT CLICK"),t.assign(!0,eden.root.scope)}),"img"==n&&l&&(t.src=l),"a"==n&&d&&(t.href=d),t}}function m(e,t){if("string"!=typeof t[0])for(var n=0;n<t.length;n++){var i;(i=f(t[n]))&&e.appendChild(i)}else(i=f(t))&&e.appendChild(i)}function b(e){if(!e)return"";if("p"!=e[0])return"";var t,n=[],i=(t=(t=e[1]instanceof Array?e[1].join("&nbsp;"):e[1]).replace(/<jseden([\s\S]*?)>([\s\S]*?)<\/jseden>/g,function(e,t,i,o,a){return console.log("ATTRIBS: "+t),n.push(i),"\0\0"})).split("\0\0");if(1==i.length)return $("<div class='page-paragraph'>"+t+"</div>");for(var o=$("<div></div"),a=0;a<i.length-1;a++){o.append($("<div class='page-paragraph'>"+i[a]+"</div>"));var r=n[a].split("\n").length,s=y(["script",!1,[n[a]],void 0,!0,r,!1,!1,"50%"]);o.append(s)}return o.append($("<div class='page-paragraph'>"+i[i.length-1]+"</div>")),o}function y(t){if(t&&"script"==t[0]){var n,i,o=t[1],a=t[2],r=t[3],s=t[4],l=t[5],c=t[6],p=t[7],h=t[8];if(void 0===r&&(r="embedded"+u,u++),o){var g;g=s?$("<div class='page-script-static page-script-live-box'></div>"):$("<div class='page-script-static'></div>");var v,f=new EdenUI.Highlight(g.get(0));v=a instanceof Array?EdenUI.plugins.ScriptInput.buildScriptFromList(a):a;var m=new Eden.AST(v);f.highlight(m,-1,-1),p&&"none"!=p&&g.css("float",p),"50%"!=h&&("number"==typeof h?g.width(h):g.css("width",h));b=EdenUI.plugins.ScriptInput.getRequiredHeight(l,!0);return g.height(b),g}d[r]?(n=d[r]).update(a):(n=e.views.ScriptInput.embed(r,r,a,c),d[r]=n),i=s?$("<div id='"+r+"-dialog' class='page-script-live page-script-live-box'></div>"):$("<div class='page-script-live'></div>");var b=EdenUI.plugins.ScriptInput.getRequiredHeight(l,!0);return i.height(b),p&&"none"!=p&&i.css("float",p),"50%"!=h&&("number"==typeof h?i.width(h):i.css("width",h)),n.contents.appendTo(i),i.resizable(),i}}function w(t){if(t&&"veden"==t[0]){var n,i,o=t[1],a=t[2],r=t[3],s=t[4],l=t[5];return c[o]?n=c[o]:(n=e.views.Veden.embed(o,o,l),c[o]=n),(i=$("<div id='"+o+"-dialog' class='page-script-live page-script-live-box'></div>")).height(r),s&&"none"!=s&&i.css("float",s),"50%"!=a&&("number"==typeof a?i.width(a):i.css("width",a)),n.contents.appendTo(i),i.resizable(),i}}function S(t){var n,i=t[6],o=t[3],a=t[4];if(n=i?$("<div class='page-canvas page-script-live-box'></div>"):$("<div class='page-canvas'></div>"),o&&n.css("width",g(o)),a&&n.css("height",g(a)),void 0===l[t[1]]){var r=e.views.Canvas2D.embedded(t[1],t[1],t[2]);l[t[1]]=r,n.append(r.code_entry),s.push(function(){r.resize(t[3],t[4])})}else l[t[1]].code_entry.appendTo(n),s.push(function(){l[t[1]].resize(t[3],t[4])});return"none"!=t[5]&&n.css("float",t[5]),n}function x(e){var t;if(t=e[1]?$("<ul></ul>"):$("<ol></ol>"),e[2]&&e[2]instanceof Array)for(var n=0;n<e[2].length;n++){var i=$("<li>"+e[2][n]+"</li>");t.append(i)}return t}function E(e,t){if(void 0!==t&&t instanceof Array){for(var i in u=0,l)l[i].code_entry.detach();for(var o in d)d[o].contents.detach();"default"==(n=t[2])&&(n="page-theme-default"),r.html(""),r.append(function(e){if(!e)return"";if("title"!=e[0])return"";var t,i=$("<div class='page-title "+n+"'></div>"),o=$("<div class='page-title-block'></div>");e[6]&&i.css("height",e[6]+"px"),t=e[1]?$("<span class='page-title-text "+n+"'>"+e[1]+"</span>"):$('<img border=0 src="'+e[5]+'"></img>');var a=$("<br/><span class='page-subtitle-text "+n+"'>"+e[2]+"</span>");return o.append(t),o.append(a),i.append(o),e[3],i}(t[1])),r.append(function(e,t){if(!e)return"";if(!(e instanceof Array))return"";for(var i=$("<div class='page-content "+n+"'></div>"),o=0;o<e.length;o++)if(void 0!==e[o])switch(e[o][0]){case"header":i.append(p(e[o]));break;case"p":i.append(b(e[o]));break;case"script":i.append(y(e[o]));break;case"canvas":i.append(S(e[o]));break;case"break":i.append($("<div class='clear'></div>"));break;case"list":i.append(x(e[o]))}return i}(t[3]));for(var a=0;a<s.length;a++)s[a]();s=[]}}E(0,a),i.addJSObserver("pageGenerator",E),o.addJSObserver("pageGenerator",function(e,t){if(void 0!==t&&t instanceof Array){for(var n in l)l[n].code_entry.detach();for(var i in d)d[i].contents.detach();r.html(""),m(r.get(0),t);for(var o=0;o<s.length;o++)s[o]();s=[]}}),Eden.Selectors.execute("plugins > page > page",function(){eden.root.lookup("plugins_page_loaded").assign(!0,eden.root.scope),t&&t()})},EdenUI.plugins.Page.title="Page",EdenUI.plugins.Page.description="Generate web content from scripts.";var edenfunctions={};function _formatVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}EdenUI.plugins.SymbolViewer=function(e,t){var n=this;this.instances=[];var i=0;this.createDialog=function(t,o,a){var r,s=t.slice(0,-7),d=root.lookup("createView"),c=$('<div class="symbollist-outer"></div>');c.html((r='\t\t\t<div class="symbollist-search-box-outer"> \t\t\t\t<input type="text" class="symbollist-search symbollist-control" /> \t\t\t\t<a class="symbollist-edit symbollist-control symbollist-rightmost-control">Edit Listed</a><br/> \t\t\t\t',r+='\t\t\t</div> \t\t\t<div class="symbollist-results"></div>'));var u=new EdenUI.plugins.SymbolViewer.SymbolList(e.eden.root,c.find(".symbollist-results")[0],a);$dialog=$('<div id="'+t+'"></div>').append(c).dialog({appendTo:"#jseden-views",title:o,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"symbollist-dialog ui-front"}}),n.instances.push(u),1==++i&&e.eden.root.addGlobal(l),c.find(".symbollist-search-box-outer > .symbollist-edit").click(function(){var t="edit_"+s;if(h.value.startsWith("select: ")){e.createView(t,"ScriptInput",void 0);var n=eden.root.lookup("view_"+t+"_tabs").value();Array.isArray(n)||(n=[]),n.push(h.value.substring(8)),eden.root.lookup("view_"+t+"_tabs").assign(n,eden.root.scope,EdenSymbol.hciAgent),eden.root.lookup("view_"+t+"_current").assign(n.length-1,eden.root.scope,EdenSymbol.hciAgent)}});var p=c.find(".symbollist-search-box-outer > .symbollist-search"),h=p[0],g=root.lookup("view_"+s+"_search_language");function v(){var t=g.value();return p.val().startsWith("select: ")?e.regExpFromStr("","",!1,t):e.regExpFromStr(p,"",!1,t)}function f(e,t){u.search(h.value,v()),"regexp"==t?p.attr("placeholder","search regular expression"):"simple"==t?p.attr("placeholder","simple search"):p.attr("placeholder","search")}f(0,g.value()),g.addJSObserver("refreshView",f);var m=root.lookup("view_"+s+"_search_string"),b=function(e,t){void 0!==t&&(t!==h.value&&(h.value=t),u.search(t,v()))},y=m.value();return void 0===y?(m.assign("",root.scope,d),u.search("",new RegExp(""))):b(0,y),m.addJSObserver("refreshView",b),p.keyup(function(){m.assign(h.value,root.scope,EdenSymbol.hciAgent)}),{destroy:function(){var t=n.instances.indexOf(u);n.instances.splice(t,1),0==--i&&e.eden.root.removeGlobal(l)}}},this.createObservableDialog=function(e,t){return n.createDialog(e,t,"obs")},this.createFunctionDialog=function(e,t){return n.createDialog(e,t,"func")},this.createAgentDialog=function(e,t){return n.createDialog(e,t,"agent")},this.createSymbolDialog=function(e,t){return n.createDialog(e,t,"all")};var o={},a={},r=!1;this.isCreationPending=function(e){return e in a},this.delay=40;var s=function(){for(x in n.instances){var e,t,i,s=n.instances[x];for(var l in void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(t=(e=$(s.symresults)).parent(),i=e.scrollTop(),e.detach()),a){var d=a[l];s.filter?s.filter.indexOf(l)>=0&&s.addSymbol(d,l):s.addSymbol(d,l)}for(var l in o)s.updateSymbol(l);void 0===EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&(e.appendTo(t),e.scrollTop(i))}o={},a={},r=!1},l=function(e,t){var i=e.name;if(1==t)a[i]=e;else{if(i in a)return;o[i]=e}r||(r=!0,setTimeout(s,n.delay))};e.views.ObservableList={dialog:this.createObservableDialog,title:"Observable List",category:e.viewCategories.comprehension,menuPriority:0},e.views.FunctionList={dialog:this.createFunctionDialog,title:"Function List",category:e.viewCategories.comprehension,menuPriority:0},e.views.AgentList={dialog:this.createAgentDialog,title:"Agent List",category:e.viewCategories.comprehension,menuPriority:0},e.views.SymbolList={dialog:this.createSymbolDialog,title:"Symbol List",category:e.viewCategories.comprehension,menuPriority:1},eden.root.lookup("plugins_symbolviewer_loaded").assign(!0,eden.root.scope),t()},EdenUI.plugins.SymbolViewer.title="Symbol Viewer",EdenUI.plugins.SymbolViewer.description="Provide various views of the symbol table.",EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0,EdenUI.plugins.SymbolViewer.SymbolList=function(e,t,n){this.root=e,this.regExp=new RegExp(""),this.type=n,this.category="all",this.customCategory=!1,this.subtypes="all",this.symresults=t,this.symbols={},this.filter=void 0},EdenUI.plugins.SymbolViewer.SymbolList.prototype.search=function(e,t,n,i){if(void 0!==e)if(e.startsWith("select: ")){var o=Eden.Selectors.query(e.substr(8),"symbol");console.log(o),this.filter=o,this.regExp=t,this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={};for(var a=0;a<o.length;a++){var r=o[a],s=this.root.symbols[r];s&&this.addSymbol(s,r)}}else{var l,d;for(l in this.searchStr=e,this.searchStrLowerCase=e.toLowerCase(),this.regExp=t,void 0!==i&&(this.subtypes=i),EdenUI.closeTooltip(),this.symresults.innerHTML="",this.symbols={},this.root.symbols)edenUI.plugins.SymbolViewer.isCreationPending(l)||(d=this.root.symbols[l],this.addSymbol(d,l))}},EdenUI.plugins.SymbolViewer.SymbolList.prototype.updateSymbol=function(e){void 0!==this.symbols[e]&&this.symbols[e].update()},EdenUI.plugins.SymbolViewer.SymbolList.prototype.addSymbol=function(e,t){var n,i=!1;if(t.toLowerCase()==this.searchStrLowerCase)i=!0,n="exact-match";else if(!this.regExp.test(t))return;var o=!0;if(this.customCategory?Eden.isitCategory(t,this.category,this.type)||(o=!1):Eden.isitSystemSymbol(t)?"user"==this.category&&(o=!1):"system"==this.category&&(o=!1),void 0!==e.definition?"vars"==this.subtypes&&(o=!1):"formulas"==this.subtypes&&(o=!1),!o){if(!i)return;n="dirty-match"}var a="obs";if(e.definition){var r=e.getSource();a=/^proc\s/.test(r)?"agent":/^func\s/.test(r)?"func":"function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs"}else a="function"==typeof e.cache.value?/\breturn\s+([^\/;]|(\/[^*\/]))/.test(e.cache.value.toString())?"func":"agent":"obs";if("all"==this.type||this.type==a){var s=new EdenUI.plugins.SymbolViewer.Symbol(e,t,a,n);i?s.element.prependTo(this.symresults):s.element.appendTo(this.symresults),this.symbols[t]=s}},EdenUI.plugins.SymbolViewer.Symbol=function(e,t,n,i){switch(this.symbol=e,this.name=t,this.type=n,this.details=void 0,this.update=void 0,this.element=$('<div class="symbollist-result-element"></div>'),i&&this.element.addClass("symbollist-"+i+"-result"),n){case"func":this.update=this.updateFunction;break;case"agent":this.update=this.updateProcedure;break;case"obs":this.update=this.updateObservable}var o=this,a=!1;function r(){o.element.removeClass("symbollist-inline-editor"),o.update(),o.element.scrollLeft(0)}this.element.click(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol||a||(a=!0,setTimeout(function(){if(!EdenUI.plugins.SymbolViewer.inlineEditorSymbol&&a){a=!1;o.name;Eden.Selectors.goto("> :not(ACTIVE) >> "+e.name)}},350))}),"obs"==n&&this.element.dblclick(function(){if(a=!1,EdenUI.plugins.SymbolViewer.inlineEditorSymbol!==o){var e=o.symbol.cache.value;if(void 0!==o.symbol.definition||"boolean"!=typeof e){EdenUI.plugins.SymbolViewer.inlineEditorSymbol=o,o.element.addClass("symbollist-inline-editor");var n,i,s=o.element.find(".result_value"),l=o.element.find(".result_separator");s.html(""),void 0!==o.symbol.definition?(n=o.symbol.getSource().replace(new RegExp("^\\s*"+t+"\\s+is\\s+"),""),i="is"):(n=Eden.edenCodeForValue(e),i="=");var d=$("<select></select>");"="==i?(d.append('<option value="is">is</option>'),d.append('<option value="=" selected="selected">=</option>')):(d.append('<option value="is" selected="selected">is</option>'),d.append('<option value="=">=</option>')),l.html(" "),l.append(d);var c=Eden.htmlEscape(n,!0),u=$('<input type="text" value="'+c+'" spellcheck="false" style="width: 100%"/>'),p=u.get(0);function h(e){var t,n,i=e.which;13==i?(t=d.get(0).value,";"!=(n=p.value).slice(-1)&&(n+=";"),eden.execute2(o.name+" "+t+" "+n),r(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0):27==i&&(r(),EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)}u.on("keyup",h),u.on("blur",function(){setTimeout(function(){d.is(document.activeElement)||(r(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===o&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),d.on("keydown",h),d.on("blur",function(){setTimeout(function(){u.is(document.activeElement)||(r(),setTimeout(function(){EdenUI.plugins.SymbolViewer.inlineEditorSymbol===o&&(EdenUI.plugins.SymbolViewer.inlineEditorSymbol=void 0)},500))},0)}),s.append(u);var g=o.element.find(".symbollist-result-inner");g.length>0&&(g.get(0).onmouseenter=void 0),EdenUI.closeTooltip(),p.focus(),p.select();var v=n.slice(0,1);'"'!=v&&"'"!=v&&"["!=v&&"{"!=v||(p.selectionStart=1,p.selectionEnd=n.length-1)}else!0===e?o.symbol.assign(!1,eden.root.scope,EdenSymbol.hciAgent,!0):o.symbol.assign(!0,eden.root.scope,EdenSymbol.hciAgent,!0)}}),this.update()},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateFunction=function(){var e,t,n=this.symbol.getSource();(e=void 0===this.symbol.definition||/^func\s/.test(n)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.functions[this.name])?(this.details=edenfunctions.functions[this.name],t="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):t="";var i="<span class='result_name'>"+e+"</span>"+t;if(void 0!==this.symbol.definition&&!/^func\s/.test(this.symbol.eden_definition)){var o=Eden.htmlEscape(n,!1,!0);i="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(o=Eden.htmlEscape("<pre>"+o+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+i+"</span>"}this.element.html(i)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateObservable=function(){var e=_formatVal(this.symbol.value()),t="<span class='result_name'>"+(void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+e+"</span>";if(void 0!==this.symbol.definition){var n=Eden.htmlEscape(this.symbol.getSource(),!1,!0);t="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(n=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+n+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+t+"</span>"}this.element.html(t)},EdenUI.plugins.SymbolViewer.Symbol.prototype.updateProcedure=function(){var e,t,n=this.symbol.getSource();(e=void 0===this.symbol.definition||/^proc\s/.test(n)?this.name:"<span class='hasdef_text'>"+this.name+"</span>",void 0!=edenfunctions.functions&&void 0!==edenfunctions.procedures[this.name])?(this.details=edenfunctions.procedures[this.name],t="<span class='result_parameters'>( "+Object.keys(this.details.parameters||{}).join(", ")+" )</span>"):t="";var i="<span class='result_name'>"+e+"</span>"+t;if(void 0!==this.symbol.definition&&!/^proc\s/.test(n)){var o=Eden.htmlEscape(n,!1,!0);i="<span class='symbollist-result-inner' onmouseenter='EdenUI.showTooltip(event, \""+(o=Eden.htmlEscape("<pre>"+o+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+i+"</span>"}this.element.html(i)};edenfunctions={};EdenUI.plugins.VersionViewer=function(e,t){var n=this;this.instances=[];var i=0;this.createDialog=function(t,o,a){var r=t.slice(0,-7),s=(root.lookup("createView"),$('<div class="versionviewer-outer"></div>'));s.html('<table class="version-viewer-list"></table>'),$dialog=$('<div id="'+t+'"></div>').append(s).dialog({appendTo:"#jseden-views",title:o,width:360,height:400,minHeight:200,minWidth:200,classes:{"ui-dialog":"versionviewer-dialog ui-front"}});var l;root.lookup("view_"+r+"_search_string");return l=URLUtil.getParameterByName("load"),$.get(Eden.DB.remoteURL+"/project/versions",{projectID:l},function(e){var t=s.find(".version-viewer-list").html(""),n=$("<tr><th>Vid</th><th>Date</th><th>ParentDiff</th></tr>");t.append(n),$(e).each(function(e,n){var i=$('<tr><td><a href="?load='+l+"&vid="+n.saveID+'">'+n.saveID+"</td><td>"+n.date+"</td><td>"+n.parentDiff+"</td></tr>");t.append(i)})}),{destroy:function(){var t=n.instances.indexOf(symbollist);n.instances.splice(t,1),0==--i&&e.eden.root.removeGlobal(symbolChanged)}}},this.createVersionListDialog=function(e,t){return n.createDialog(e,t,"all")},e.views.VersionList={dialog:this.createVersionListDialog,title:"Version List",category:e.viewCategories.history,menuPriority:1},eden.root.lookup("plugins_VersionViewer_loaded").assign(!0,eden.root.scope),t()},EdenUI.plugins.VersionViewer.title="Version Viewer",EdenUI.plugins.VersionViewer.description="Show version details for a specified project.",EdenUI.plugins.VersionViewer.inlineEditorSymbol=void 0,EdenUI.plugins.ExternalHTMLContent=function(e,t){var n=!1,i=!1;function o(){n=!1}this.createDialog=function(t,a){i||(""==document.location.hash&&window.history.pushState({},"","#noNavigateAway"),window.addEventListener("popstate",function(){""==document.location.hash&&(n?window.history.forward(1):e.modalDialog("Leave Environment?","<p>Leaving this page will discard the current script. Your work will not be saved.</p><p>Are you sure you want to close JS-EDEN?</p>",["Close JS-EDEN","Return to Construal"],1,function(e){0==e?(doingNavigateAway=!0,window.history.back(1)):window.history.forward(1)}))}),i=!0);var r=t.slice(0,-7),s=root.lookup("createView"),l=$('<iframe marginwidth="13" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts" allowfullscreen="true" name="'+t+'"></iframe>'),d=root.lookup("_view_"+r+"_url"),c=l[0];function u(e,t){c.src=void 0===t?"plugins/external-html-content/undefined-url.html?view="+encodeURI(r):"plugins/external-html-content/redirect.html?view="+encodeURI(r)+"&url="+encodeURI(t)}u(0,d.value()),d.addJSObserver("refreshView",u);var p=$('<div id="'+t+'"></div>').html(l).dialog({title:a,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"external-html-content"}),h=$('<div class="external-html-content-toolbar">');p.append(h);var g=root.lookup("_view_"+r+"_toolbar_visible"),v=root.lookup("_view_"+r+"_toolbar_pinned");function f(e,t){t?(v.value()&&l.addClass("external-html-content-pinned"),h.css("display","block")):(l.removeClass("external-html-content-pinned"),h.css("display","none"))}void 0===g.value()&&g.assign(!0,root.scope,s),void 0===v.value()&&v.assign(!1,root.scope,s),f(0,g.value()),g.addJSObserver("refreshView",f),v.addJSObserver("refreshView",function(e,t){g.value()&&l.toggleClass("external-html-content-pinned",t)});var m=$('<input type="image" src="images/pin.png" width="28" height="28" alt="Pin toolbar" title="Click to pin the toolbar in place"/>');m.on("click",function(){v.assign(!v.value(),root.scope,Symbol.hciAgent),c.focus()}),h.append(m);var b=$('<input type="image" src="images/back-button.svg" width="28" height="28" alt="Back" title="Click to go back"/>');b.on("click",function(){n||setTimeout(o,1e3),n=!0,window.history.back(1),c.focus()}),h.append(b);var y=$('<input type="image" src="images/forward-button.svg" width="28" height="28" alt="Forward" title="Click to go forward"/>');y.on("click",function(){window.history.forward(1),c.focus()}),h.append(y);var w=$('<input type="image" src="images/refresh-button.png" height="28" alt="Refresh" title="Click to reload the page specified by _view_'+r+'_url"/>');return w.on("click",function(){u(0,d.value()),c.focus()}),h.append(w),{confirmClose:!0}},e.views.ExternalHTMLContent={dialog:this.createDialog,title:"External HTML Content",category:e.viewCategories.visualization,holdsContent:!0},e.eden.include("plugins/external-html-content/external-html-content.js-e",t)},EdenUI.plugins.ExternalHTMLContent.title="External HTML Content",EdenUI.plugins.ExternalHTMLContent.description="Allows construals to display web pages created outside of JS-EDEN.",EdenUI.plugins.HTMLContent=function(e,t){this.createDialog=function(e,t){var n=e.slice(0,-7);function i(e){return"view_"+n+"_"+e}var o=[i("background_colour"),i("content")],a=$('<div id="'+e+'-content" class="htmlviews-content" data-observables="'+o.join(",")+'"></div>');a.on("mousedown","button",function(e){var t=e.currentTarget.name,n=e.currentTarget.getAttribute("data-value");null!==n&&null!==n.charAt(0).match(/[0-9]?/)&&(n=parseInt(n)),eden.root.lookup(t).assign(null===n||n,eden.root.scope,EdenSymbol.hciAgent)}),a.on("mouseup","button",function(e){var t=e.currentTarget.name;null===e.currentTarget.getAttribute("data-value")&&eden.root.lookup(t).assign(!1,eden.root.scope,EdenSymbol.hciAgent)}),a.on("click",function(e){var t=e.srcElement.getAttribute("data-jseden");t&&""!=t&&(console.log(t),eden.execute2(t,{name:"execute"}))});var r=root.lookup("view_"+n+"_content"),s=function(e,t){void 0===t?a.html('<div class="htmlviews-undefined">Give view_'+n+"_content a value to display HTML formatted text here.</div>"):a.html(t)};s(0,r.value()),r.addJSObserver("repaintView",s);var l=root.lookup("view_"+n+"_background_colour");function d(e,t){c.get(0).parentNode.style.background=t}l.addJSObserver("changeColour",d);var c=$('<div id="'+e+'"></div>').html(a).dialog({appendTo:"#jseden-views",title:t,width:600,height:450,minHeight:120,minWidth:230,classes:{"ui-dialog":"htmlviews-dialog ui-front"}}),u=l.value();return u&&d(0,u),{confirmClose:!0}},e.views.HTMLContent={dialog:this.createDialog,title:"HTML Content",category:e.viewCategories.visualization,holdsContent:!0},Eden.Selectors.execute("plugins > html > html",function(){eden.root.lookup("plugins_html_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t()})},EdenUI.plugins.HTMLContent.title="HTML Content",EdenUI.plugins.HTMLContent.description="Provides construals with the ability to create windows dedicated to displaying HTML content created using EDEN code.",EdenUI.plugins.ExpressionTree=function(e,t){var n=this;this.createDialog=function(e,t){$dialog=$('<div id="'+e+'"></div>').html('<div style="width: 300px; height: 450px" class="etdiv"><div id="infovis" style="width: 300px; height: 450px"></div></div>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230})};var i,o,a,r,s,l,d={"=":{precedence:1,associativity:"right",text:"=",whitespace:!0},"+=":{precedence:1,associativity:"right",text:"+=",whitespace:!0},"-=":{precedence:1,associativity:"right",text:"-=",whitespace:!0},"||":{precedence:3,associativity:"left",text:"||",whitespace:!0},or:{precedence:3,associativity:"left",text:"or",whitespace:!0},"&&":{precedence:4,associativity:"left",text:"&&",whitespace:!0},and:{precedence:4,associativity:"left",text:"and",whitespace:!0},"==":{precedence:5,associativity:"left",text:"==",whitespace:!0},"!=":{precedence:5,associativity:"left",text:"!=",whitespace:!0},"<":{precedence:6,associativity:"left",text:"<",whitespace:!0},"<=":{precedence:6,associativity:"left",text:"<=",whitespace:!0},">":{precedence:6,associativity:"left",text:">=",whitespace:!0},">=":{precedence:6,associativity:"left",text:">",whitespace:!0},"=~":{precedence:6,associativity:"left",text:"=~",whitespace:!0},"!~":{precedence:6,associativity:"left",text:"!=",whitespace:!0},"//":{precedence:7,associativity:"left",text:"//",whitespace:!0},"+":{precedence:8,associativity:"left",text:"+",whitespace:!0},"-":{precedence:8,associativity:"left",text:"-",whitespace:!0},"*":{precedence:9,associativity:"left",text:"*",whitespace:!0},"/":{precedence:9,associativity:"left",text:"/",whitespace:!0},"%":{precedence:9,associativity:"left",text:"%",whitespace:!0},"^":{precedence:11,associativity:"right",text:".",whitespace:!1},".":{precedence:14,associativity:"left",text:".",whitespace:!1}},c={"-":{precedence:10,text:"-"},"!":{precedence:10,text:"!"},"&":{precedence:10,text:"&"},not:{precedence:10,text:"!"},"++.":{precedence:11,text:"++"},"--.":{precedence:11,text:"--"},"*":{precedence:12,text:"*"}},u={"#":{precedence:11,text:"#"},".++":{precedence:11,text:"++"},".--":{precedence:11,text:"--"}},p={};this.convertTreeToEden=(i=c,o=d,a=u,r=p,s=13,l=function(e,t,n){if(!e.hasOwnProperty("children"))return e.name;var d,c,u,p=e.name,h=e.children;if(o.hasOwnProperty(p)&&2==h.length){c=(d=o[p]).precedence;var g=d.associativity,v=l(h[0],c,d.text),f=l(h[1],c,d.text);if("left"==g){var m=h[1].name;h[1].hasOwnProperty("children")&&2==h[1].children.length&&o.hasOwnProperty(m)&&c==o[m].precedence&&(f="("+f+")")}else{var b=h[0].name;h[0].hasOwnProperty("children")&&2==h[0].children.length&&o.hasOwnProperty(b)&&c==o[b].precedence&&(v="("+v+")")}u=d.whitespace?v+" "+d.text+" "+f:v+d.text+f}else if(i.hasOwnProperty(p))c=(d=i[p]).precedence,u=d.text+l(h[0],c,d.text);else if(a.hasOwnProperty(p))c=(d=a[p]).precedence,u=l(h[0],c,d.text)+d.text;else if(r.hasOwnProperty(p))d=r[p],this.precedence=d.precedence,u=d.code(h,n);else{c=s;for(var y=[],w=0;w<h.length;w++)y.push(l(h[w],0,void 0));u=p+"("+y.join(", ")+")"}return c<t&&(u="("+u+")"),u},function(e){return l(e,0,void 0)}),p["?"]={precedence:2,code:function(e){return n.convertTreeToEden(e[0])+"? "+n.convertTreeToEden(e[1])+" : "+n.convertTreeToEden(e[2])}},p["`...`"]={precedence:13,code:function(e){return"`"+n.convertTreeToEden(e[0])+"`"}},p["${{...}}$"]={precedence:13,code:function(e){return"${{ "+e[0].name+" }}$"}},p["(...)"]={precedence:13,code:function(e){for(var t=n.convertTreeToEden(e[0]),i=[],o=1;o<e.length;o++)i.push(n.convertTreeToEden(e[o]));return"("+t+")("+i.join(", ")+")"}},p["[...]"]={precedence:13,code:function(e){for(var t=[],i=0;i<e.length;i++)t.push(n.convertTreeToEden(e[i]));return"["+t.join(", ")+"]"}},p["[n]"]={precedence:13,code:function(e){return n.convertTreeToEden(e[0])+"["+n.convertTreeToEden(e[1])+"]"}},p["{...}"]={precedence:13,code:function(e){for(var t=[],i=0;i<e.length-1;i+=2)t.push(e[i].name+": "+n.convertTreeToEden(e[i+1]));return"{"+t.join(", ")+"}"}},p.Point={precedence:13,code:function(e,t){if("."==t){for(var i=[],o=0;o<e.length;o++)i.push(n.convertTreeToEden(e[o]));return"Point("+i.join(", ")+")"}return"{"+n.convertTreeToEden(e[0])+", "+n.convertTreeToEden(e[1])+"}"}},e.views.ExpressionTree={dialog:this.createDialog,title:"Expression Tree",category:e.viewCategories.interpretation,menuPriority:0}},EdenUI.plugins.ExpressionTree.title="Expression Tree",EdenUI.plugins.ExpressionTree.description="Provides a graphical user interface for creating dependencies.",Eden.initiallyDefined=["_view_picture_background_colour","_view_picture_content","_view_picture_offset","_view_picture_scale","edenclocks","edenclocks_paused","menus","mouseCapture","mouseContextMenuEnabled","mouseFollow","mouseWheelEnabled","picture","pixel","semicircleAngle","randomGenerator","randomSeed","touchPinchEnabled"],Eden.systemObservableNames={_option_global_css:!0,_menubar_status:!0,PI:!0,autocalc:!0,background_audio:!0,debug:!0,edenclocks:!0,edenclocks_paused:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,pixel:!0,randomGenerator:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,screenHeight:!0,screenWidth:!0,semicircleAngle:!0,touchPanX:!0,touchPanXSpeed:!0,touchPinch:!0,touchPinchEnabled:!0,_views_frame_width:!0,_views_frame_height:!0,_views_list:!0,_views_number_created:!0,_views_unit_x:!0,_views_unit_y:!0},Eden.systemAgentNames={alias:!0,arrangeWindows:!0,attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,createExternalHTMLView:!0,createHTMLView:!0,createProjectList:!0,createView:!0,destroyView:!0,eager:!0,error:!0,hideView:!0,highlightView:!0,html:!0,loadTextFileIntoObservable:!0,moveView:!0,patch:!0,removeedenclock:!0,resizeView:!0,setedenclock:!0,showAgents:!0,showFunctions:!0,showObservables:!0,showSymbols:!0,showView:!0,stopHighlightingView:!0,todo:!0,touch:!0,unbind:!0,withAppendedItem:!0,writeln:!0,bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0},Eden.systemFunctionNames={Arc:!0,Arrowhead:!0,Audio:!0,BulletSlide:!0,Button:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,HTMLImage:!0,Image:!0,Line:!0,LinearGradient:!0,LineSequence:!0,List:!0,Menu:!0,MenuItem:!0,Object:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,RE:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,Sector:!0,Shadow:!0,Slide:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,TitledSlide:!0,TitleSlide:!0,Translate:!0,Video:!0,abs:!0,acos:!0,angleTurned:!0,apply:!0,array:!0,asin:!0,atan:!0,canvasURL:!0,ceil:!0,centroid:!0,char:!0,charCode:!0,choose:!0,compose:!0,concat:!0,cos:!0,curry:!0,decodeHTML:!0,definitionOf:!0,definitionRHS:!0,distanceMoved:!0,doDefault:!0,edenCode:!0,escapeRE:!0,execute:!0,exp:!0,floor:!0,foldl:!0,foldr:!0,forget:!0,forgetAll:!0,hslColour:!0,htmlBulletList:!0,htmlNumberedList:!0,imageWithZones:!0,include:!0,include_css:!0,int:!0,isBoolean:!0,isCallable:!0,isChar:!0,isDefined:!0,isDependency:!0,isDependent:!0,isFunc:!0,isInt:!0,isList:!0,isNaN:!0,isNumber:!0,isObject:!0,isPoint:!0,isPointer:!0,isProc:!0,isString:!0,isValue:!0,ln:!0,log:!0,lookup:!0,lowercase:!0,map:!0,mapPartial:!0,max:!0,min:!0,mod:!0,nameof:!0,partApply:!0,positionInList:!0,positionOfRE:!0,pow:!0,rand:!0,random:!0,randomBoolean:!0,randomFloat:!0,randomInteger:!0,replaceFirst:!0,require:!0,reverse:!0,rgbColour:!0,rotatePoint:!0,round:!0,roundDown:!0,roundMultiple:!0,roundUp:!0,scalePoint:!0,search:!0,sequenceItoJ:!0,sequenceN:!0,sequenceArithmetic:!0,sequenceArithmeticN:!0,sequenceList:!0,sequencePrevious:!0,sin:!0,sort:!0,sqrt:!0,str:!0,sublist:!0,substitute:!0,substr:!0,substringPosition:!0,sum:!0,tail:!0,tan:!0,textWidth:!0,textHeight:!0,time:!0,trim:!0,type:!0,uppercase:!0,xorshiftRandomGenerator:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0},Eden.symbolCategories={},Eden.symbolCategories["Canvas 2D"]={obs:{_view_picture_background_colour:!0,_view_picture_canvas_bottom:!0,_view_picture_canvas_right:!0,_view_picture_offset:!0,_view_picture_scale:!0,_view_picture_title:!0,_view_picture_width:!0,_view_picture_height:!0,menus:!0,mouseButton:!0,mouseButtons:!0,mouseCapture:!0,mouseCaptured:!0,mouseContextMenuEnabled:!0,mouseDoubleClicks:!0,mouseDown:!0,mouseDownView:!0,mouseDownZone:!0,mouseFollow:!0,mousePosition:!0,mousePressed:!0,mouseUp:!0,mouseWheel:!0,mouseWheelEnabled:!0,mouseWheelVelocity:!0,mouseVelocity:!0,mouseView:!0,mouseX:!0,mouseY:!0,mouseZone:!0,picture:!0,pixel:!0,semicircleAngle:!0,touchScrollX:!0,touchScrollXDir:!0},agent:{attemptMouseCapture:!0,bindCSSNumericProperty:!0,bindCSSProperty:!0,bindCSSRule:!0,createCanvas:!0,destroyView:!0,include_css:!0,unbind:!0},func:{angleTurned:!0,Arc:!0,Arrowhead:!0,Audio:!0,Button:!0,canvasURL:!0,centroid:!0,Checkbox:!0,Circle:!0,CombinedRotation:!0,Combobox:!0,ContourData:!0,ContourLine:!0,Curve:!0,distanceMoved:!0,Div:!0,DropDownList:!0,Ellipse:!0,EuclideanSpace:!0,FillPattern:!0,FlowLayout:!0,GreyPixelList:!0,hslColour:!0,HTMLImage:!0,Image:!0,imageWithZones:!0,Line:!0,LinearGradient:!0,LineSequence:!0,Menu:!0,MenuItem:!0,Pixel:!0,PixelList:!0,Point:!0,Polygon:!0,RadialGradient:!0,RadioButtons:!0,Rectangle:!0,RegularPolygon:!0,RotateAboutCentre:!0,RotateAboutPoint:!0,rgbColour:!0,rotatePoint:!0,RoundedRectangle:!0,ScalarField2D:!0,Scale:!0,scalePoint:!0,Sector:!0,Shadow:!0,Slider:!0,TableLayout:!0,Text:!0,Textbox:!0,textWidth:!0,textHeight:!0,Translate:!0,Video:!0,observableForShape:!0,observableOnBottomAt:!0,shapeOnBottomAt:!0,zoneOnBottomAt:!0,observableOnTopAt:!0,shapeOnTopAt:!0,zoneOnTopAt:!0,observablesAt:!0,shapesAt:!0,zonesAt:!0}},Eden.symbolCategories.Math={obs:{PI:!0,randomGeneratorState:!0,randomIndex:!0,randomSeed:!0,semicircleAngle:!0},func:{abs:!0,angleTurned:!0,acos:!0,asin:!0,atan:!0,ceil:!0,cos:!0,distanceMoved:!0,exp:!0,floor:!0,length:!0,ln:!0,log:!0,max:!0,min:!0,mod:!0,pow:!0,random:!0,randomBoolean:!0,randomInteger:!0,randomFloat:!0,rotatePoint:!0,round:!0,roundDown:!0,roundUp:!0,roundMultiple:!0,scalePoint:!0,sin:!0,sqrt:!0,sum:!0,tan:!0}},Eden.symbolCategories["Sound and Video"]={agent:{bindMIDIControl:!0,bindMIDINote:!0,bindMIDIPrograms:!0,clearMIDIMessages:!0,fetchMIDIMessage:!0,loadMIDIPrograms:!0,startMIDIInput:!0,initializeMIDI:!0,playMIDI:!0,unbind:!0},obs:{background_audio:!0,background_audio_url:!0,background_audio_paused:!0,background_audio_chapter:!0,background_audio_chapters:!0,background_audio_looping:!0,background_audio_speed:!0,background_audio_time:!0,background_audio_volume:!0,midiInputDevice:!0,midiInputMessage:!0,midiInputMessageCount:!0,midiInputTimestamp:!0,midiNumberOfInputs:!0,midiNumberOfOutputs:!0},func:{Audio:!0,Video:!0,mergeMIDIMessages:!0,midiMessagesForTune:!0,midiInputs:!0,midiOutputs:!0,pianoKeyNumber:!0,tuneFromText:!0}},Eden.isitSystemSymbol=function(e){return Eden.isitSystemObservable(e)||Eden.isitSystemAgent(e)||Eden.isitSystemFunction(e)},Eden.isitSystemObservable=function(e){return!!/^(_view|background_audio)_/.test(e)||e in Eden.systemObservableNames},Eden.isitSystemAgent=function(e){return!!/^_View_/.test(e)||e in Eden.systemAgentNames},Eden.isitSystemFunction=function(e){return e in Eden.systemFunctionNames},Eden.isitCategory=function(e,t,n){var i=Eden.symbolCategories[t];return"all"==n?"obs"in i&&e in i.obs||"agent"in i&&e in i.agent||"func"in i&&e in i.func:n in i&&e in i[n]},Eden.getSymbolCategories=function(e){if("all"==e)return Object.keys(Eden.symbolCategories);var t=[];for(var n in Eden.symbolCategories)e in Eden.symbolCategories[n]&&t.push(n);return t},EdenUI.plugins.SymbolLookUpTable=function(e,t){this.createDialog=function(e,t){code_entry=$('<div id="'+e+'-content" class="symbol-lookup-table-content">'+n(e)+"</div>"),$dialog=$('<div id="'+e+'"></div>').html(code_entry).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230})},e.views.SymbolLookUpTable={dialog:this.createDialog,title:"Symbol Look-Up Table",category:e.viewCategories.comprehension,menuPriority:3},this.search=function(t){var n=$("#"+t+"-regexp"),o=e.regExpFromStr(n);document.getElementById(t+"-table-div").innerHTML=i(o,t)};var n=function(e){return"<div class='upper'>"+("<input id='"+e+"-regexp' class='SLTregex' type='text' onkeyUp=\"edenUI.plugins.SymbolLookUpTable.search('"+e+"')\" placeholder='search' onload='setFocus()' />")+"</div><div id='"+e+"-table-div' class='lower'>"+i(new RegExp(""),e)+"</div>"},i=function(e,t){tableBodyHTML="";var n,i=[],s={};for(var l in root.symbols)if(n=root.symbols[l],e.test(l)){var d,c,u;if(void 0===n.eden_definition)c="-",d="function"==typeof n.cache.value?"Function":"Observable",u=Eden.htmlEscape(Eden.edenCodeForValue(n.cache.value));else if(0==(c=Eden.htmlEscape(n.eden_definition)).indexOf("proc")){if(Eden.isitSystemAgent(l)&&!new RegExp("\\b"+l+"\\b").test(e.source))continue;d="Agent",u=""}else if(0==c.indexOf("func")){if(Eden.isitSystemFunction(l)&&!new RegExp("\\b"+l+"\\b").test(e.source))continue;d="Function",u=""}else d="Dependency",u=Eden.htmlEscape(Eden.edenCodeForValue(n.cache.value));i.push([n,l,d,c,u]),s[l]=!0}for(var p=0;p<i.length;p++){var h=i[p];n=h[0];var g=o(n.observees,s,t),v=o(n.dependencies,s,t),f=g;""!=g&&""!=v&&(f+=", "),f+=v;var m=o(n.observers,s,t),b=o(n.subscribers,s,t),y=m;""!=m&&""!=b&&(y+=", "),y+=b;var w=a(n.dynamicDependencyTable,s,t),S=n.last_modified_by?n.last_modified_by:"Not yet defined";S=r(S,s,t);var x=Object.keys(n.jsObservers).join(", "),E="<tr id='"+t+"-symbol-"+h[1]+'\'><td class="lower"><p>'+h[1]+'</p></td><td class="lower"><p>'+h[2]+'</p></td><td class="lower"><p>'+h[3]+'</p></td><td class="lower"><p>'+h[4]+'</p></td><td class="lower"><p>'+f+'</p></td><td class="lower"><p>'+y+'</p></td><td class="lower"><p>'+w+'</p></td><td class="lower"><p>'+S+'</p></td><td class="lower"><p>'+x+"</p></td></tr>";/^((_view_.*)|mousePosition|mouseView)$/.test(h[1])?tableBodyHTML+=E:tableBodyHTML=E+tableBodyHTML}return'<table><tr><td class="lower"><b>Name</b></td><td class="lower"><b>Type</b></td><td class="lower"><b>Definition</b></td><td class="lower"><b>Current Value</b></td><td class="lower"><b>Watches</b></td><td class="lower"><b>Updates</b><td class="lower"><b>Backticks</b><td class="lower"><b>Last Modified By</b></td><td class="lower"><b>JavaScript Actions</b></td></tr>'+tableBodyHTML+"</table>"},o=function(e,t,n){var i=[];for(var o in e){var a=o.slice(1);i.push(r(a,t,n))}return i.join(", ")},a=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var a=e[o];void 0===a&&(a=""),i.push(r(a,t,n))}return i.join(", ")},r=function(e,t,n){return"*"==e[0]||"include"==e||"Not yet defined"==e?e:e in t?"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.jump('"+n+"-symbol-"+e+"')\">"+e+"</a>":"<a href=\"javascript:edenUI.plugins.SymbolLookUpTable.addSymbolToSearch('"+n+"', '"+e+"')\">"+e+"</a>"};this.addSymbolToSearch=function(t,n){var i,o=document.getElementById(t+"-regexp");i="false"==e.getOptionValue("optSimpleWildcards")?o.value+"|^"+n+"$":o.value+" "+Language.ui.search.disjunction+" "+n,o.value=i,this.search(t)},this.jump=function(e){var t=location.href;location.href="#"+e,history.replaceState(null,null,t)},t()},EdenUI.plugins.SymbolLookUpTable.title="Symbol Look-Up Table",EdenUI.plugins.SymbolLookUpTable.description="Displays detailed information about symbols.",EdenUI.plugins.SymbolLookUpTable.originalAuthor="Joe Butler";edenfunctions={};function _formatFramerVal(e){var t=Eden.prettyPrintValue("",e,200,!1,!1);switch(typeof e){case"boolean":return"<span class='special_text'>"+t+"</span>";case"undefined":return"<span class='error_text'>@</span>";case"string":return"<span class='string_text'>"+t+"</span>";case"number":return"<span class='numeric_text'>"+t+"</span>";default:return t}}SymbolMeta=function(e){this.symbol=e,this.interestingness=0,this.significance=.5,this.index=0,this.isinteresting=!1,this.oldstr=""},SymbolMeta.DependencyComplexityRate=.4,SymbolMeta.DependencyChangeProbability=.01,SymbolMeta.SubscriberRate=.1,SymbolMeta.DecayRate=.9999,SymbolMeta.DependencyPercentage=.5,SymbolMeta.SubscriberPercentage=.5,SymbolMeta.SigDeleteRate=.1,SymbolMeta.SigInterestingRate=1.01,SymbolMeta.prototype.dependencyInterestingness=function(e){var t=0,n=0,i=.1;for(var o in this.symbol.dependencies){t++,i+=(1-i)*SymbolMeta.DependencyComplexityRate;var a=o.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&n++}return i-=t*SymbolMeta.DependencyChangeProbability,0!=t&&(i=.5*i+n/t*.5),i<0?0:i},SymbolMeta.prototype.subscriberInterestingness=function(e){var t=0,n=0,i=0;for(var o in this.symbol.subscribers){t++,i+=(1-i)*SymbolMeta.SubscriberRate;var a=o.substr(1);void 0!==e.meta[a]&&e.meta[a].interestingness>=e.minInteresting()&&n++}return i=1-i,0!=t&&(i=.5*i+n/t*.5),i},SymbolMeta.prototype.nameInterestingness=function(){var e=this.symbol.name.substr(1);return"_"==e[0]?.5:/\d/.test(e)?.9:1},SymbolMeta.prototype.frequencyInterestingness=function(){},SymbolMeta.prototype.update=function(e){var t;t=this.dependencyInterestingness(e)*this.subscriberInterestingness(e)*this.nameInterestingness()*this.significance,this.interestingness=t},EdenUI.plugins.ObservableMining=function(e,t){var n=this;this.meta={},this.interesting=[],this.limitInteresting=15,this.symresults=void 0,this.symbolsui=[];this.createDialog=function(e,t){e.slice(0,-7);var i=$("<div></div>");i.html('<div class="symbolframer-results"></div>'),n.symresults=i.find(".symbolframer-results")[0],$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:200,dialogClass:"unpadded-dialog"})},this.delay=100;var i=void 0,o=function(){if(void 0!==n.symresults){var e=$(n.symresults).parent();$(n.symresults).detach();for(var t=0;t<n.symbolsui.length;t++)if(n.symbolsui[t].meta.dodelete)n.symbolsui.splice(t,1);else if(0==n.symbolsui[t].meta.isinteresting){var a=n.symbolsui[t].element;n.symbolsui[t].element.hide("drop",{direction:"right"},"slow",function(){a.remove()}),n.symbolsui.splice(t,1)}var r=n.minInteresting(),s=n.maxInteresting();for(t=0;t<n.interesting.length;t++){for(var l=!1,d=0;d<n.symbolsui.length;d++)if(n.symbolsui[d].meta==n.interesting[t]){l=!0;break}if(!l){var c=new EdenUI.plugins.ObservableMining.Symbol;n.symbolsui.push(c),c.element.appendTo(n.symresults),c.symbol=n.interesting[t].symbol;var u=c.symbol.name.substr(1);c.name=u,c.meta=n.interesting[t],c.outofdate=!0,c.symbolChanged=i}}for(t=0;t<n.symbolsui.length;t++)n.symbolsui[t].update(r,s);$(n.symresults).appendTo(e)}for(t=0;t<n.interesting.length;t++)n.interesting[t].interestingness*=SymbolMeta.DecayRate;setTimeout(o,n.delay)};o(),i=function(e,t){var i=e.name.substr(1),o=n.meta[i];if(void 0!==n.symresults){if(e.definition&&e.eden_definition){var a=e.eden_definition;if(/^proc\s/.test(a))return;if(/^func\s/.test(a))return;if("function"==typeof e.cache.value)return}else if("function"==typeof e.cache.value)return;if((t||void 0===o)&&(n.meta[i]=new SymbolMeta(e),o=n.meta[i]),o.update(n),0==o.isinteresting&&(n.interesting.sort(function(e,t){return t.interestingness-e.interestingness}),o.interestingness>=n.minInteresting())){n.interesting.length;if(n.interesting.length==n.limitInteresting)n.interesting[n.interesting.length-1].isinteresting=!1,n.interesting.pop();n.interesting.push(o),o.isinteresting=!0,o.significance*=SymbolMeta.SigInterestingRate,n.interesting.sort(function(e,t){return t.interestingness-e.interestingness})}}},e.eden.root.addGlobal(i),e.views.ObservableMining={dialog:this.createDialog,title:"Observable Mining",category:e.viewCategories.comprehension,menuPriority:1},$(document).tooltip(),t()},EdenUI.plugins.ObservableMining.prototype.minInteresting=function(){return this.interesting.length>0?this.interesting[this.interesting.length-1].interestingness:0},EdenUI.plugins.ObservableMining.prototype.maxInteresting=function(){return this.interesting.length>0?this.interesting[0].interestingness:0},EdenUI.plugins.ObservableMining.title="Observable Mining",EdenUI.plugins.ObservableMining.description="Automatically generate search for interesting observables",EdenUI.plugins.ObservableMining.Symbol=function(){this.symbol=void 0,this.name=void 0,this.meta=void 0,this.element=$('<div class="symbolframer-result-element"><div class="observable"></div></div>'),this.details=void 0,this.update=void 0,this.outofdate=!1,this.dodelete=!1,this.symbolChanged=void 0,this.editing=!1,this.update=this.updateObservable;var e=this;this.element.hover(function(){$(this).animate({backgroundColor:"#eaeaea"},100)},function(){$(this).animate({backgroundColor:"#fafafa"},100),1==e.editing&&(e.editing=!1,e.element.find("textarea").remove(),e.element.animate({height:"20px"},"fast"))}).click(function(){var t;e.editing||(t="function"==typeof e.symbol.value()&&void 0!==e.symbol.eden_definition?e.symbol.eden_definition:e.symbol.definition?e.symbol.eden_definition+";":e.name+" = "+Eden.edenCodeForValue(e.symbol.value())+";",e.element.animate({height:"60px"},{duration:200,complete:function(){var n=$('<textarea class="mine_edit_box" style="display: none"></textarea>');n.val(t),n.appendTo(e.element),n.show("fast")}}),e.editing=!0)}).draggable({distance:40,axis:"x",scroll:!1,drag:function(t,n){n.position.left>150?e.dodelete=!0:e.dodelete=!1},revert:function(t,n){return!e.dodelete},stop:function(t,n){e.dodelete&&(e.meta.significance*=SymbolMeta.SigDeleteRate,e.symbolChanged(e.symbol,!1),e.element.hide("drop",{direction:"right"},"slow",function(){e.element.remove()}))}})},EdenUI.plugins.ObservableMining.Symbol.prototype.updateObservable=function(e,t){if(void 0!==this.symbol){0==t&&(t=1);var n=(this.meta.interestingness-e)*(1/(t-e)),i=Math.round(8+12*n),o=_formatFramerVal(this.symbol.value()),a="<span>"+(void 0!==this.symbol.definition?"<span class='hasdef_text'>"+this.name+"</span>":this.name)+"</span><span class='result_separator'> = </span> <span class='result_value'>"+o+"</span>";if(void 0!==this.symbol.definition){var r=Eden.htmlEscape(this.symbol.eden_definition,!1,!0);a="<span onmouseenter='EdenUI.showTooltip(event, \""+(r=Eden.htmlEscape("<pre class='symbollist-tooltip'>"+r+";</pre>"))+"\")' onmouseleave='EdenUI.closeTooltip()'>"+a+"</span>"}var s=this.element.find(".observable");s.html(a),s.css({"font-size":i+"px"})}},EdenUI.plugins.ObservablePalette=function(e,t){var n=0,i={};function o(e){var t=e.value();return"function"!=typeof t||!/\breturn\s+([^\/;]|(\/[^\/*]))/.test(t.toString())}function a(e,t){var n=e.term,a=i[n];if(void 0===a){var r=new RegExp("^"+n);for(var s in a=[],root.symbols)r.test(s)&&o(root.symbols[s])&&a.push(s);i[n]=a}t(a)}function r(){var e=n;return n++,e}function s(e,t){e.target.style.minWidth=t.size.width+"px"}root.addGlobal(function(e,t,n){if(n&&o(t)){var a=t.name.slice(1);for(var r in i)new RegExp("^"+r).test(a)&&i[r].push(a)}}),this.createDialog=function(t,n){var i=t.slice(0,-7),o=root.lookup("createView"),l=$('<div class="observable-palette" id="'+t+'"></div>'),d={},c=$('<input type="text" class="observable-palette-search-box" placeholder="observable name"/>'),u=c[0];c.on("keyup",function(e){13==e.which&&(A(u.value,0,!1),u.value="")}),c.autocomplete({minLength:2,source:a});var p=$('<button type="button">+</button>');p.click(function(){A(u.value,0,!1),u.value=""});var h=$('<button type="button">-</button>');h.on("click",function(e){!function(e){var n=d[e];if(n){var i=t+"/"+e+"/",o=i.length,a=root.lookup(e);for(var r in a.jsObservers)r.slice(0,o)==i&&a.removeJSObserver(r);for(var s=[],c=0;c<n.length;c++){var u=n[c];u[0].parentNode.parentNode===l[0]?u.slideUp(400,"swing",function(){u.remove()}):s.push(u)}d[e]=s}}(u.value),u.value=""});var g=$("<label></label>"),v=$('<input type="checkbox"/>'),f=v[0];g.append(v),g.append(" Advanced");var m=root.lookup("_view_"+i+"_advanced"),b=m.value();void 0===b?(m.assign(!1,o),l.addClass("observable-palette-no-advanced")):b||l.addClass("observable-palette-no-advanced"),m.addJSObserver("repaintView",function(e,t){l.toggleClass("observable-palette-no-advanced",!t),f.checked=t}),v.on("change",function(e){m.assign(e.target.checked,o)});var y=$('<div class="observable-palette-toolbox"></div>');y.append(c),y.append(p),y.append(h),y.append(g);var w=[],S=7,x=root.lookup("_view_"+i+"_observables").value();Array.isArray(x)&&(x.length>0&&!Array.isArray(x[0])&&(x=[x]),x.length>S&&(S=x.length));for(var E=0;E<S;E++){var I=$('<div class="observable-palette-column"></div>');I.sortable({connectWith:".observable-palette-column, .observable-palette-dependencies",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",scroll:!1,tolerance:"pointer",receive:function(e,t){C(e.target,t.item)}}),E<S-1&&I.resizable({handles:"e",resize:s}),w.push(I),l.append(I)}w[0].append(y);var k={register:function(e,t){var n=d[e];void 0===n&&(n=[],d[e]=n);n.push(t)},remove:function(e,n,i){var o=d[e];if(void 0!==o)for(var a=0;a<o.length;a++)o[a]===n&&o.splice(a,1);root.lookup(e).removeJSObserver(t+"/"+e+"/"+i),n.slideUp(400,"swing",function(){n.remove()})},removeDuplicates:C};function C(e,t){for(var n=t.data("observable"),i=t[0],o=d[n],a=0;a<o.length;a++){var r=o[a],s=r[0];if(s!==i&&s.parentNode===e){r.removeFromDialog();break}}}function A(n,i,o){if(e.eden.isValidIdentifier(n)){var a,s=d[n];if(void 0===s)s=[],d[n]=s;else for(var l=0;l<s.length;l++){var c=s[l];if(c[0].parentNode===w[i][0]){a=c;break}}void 0===a?(a=function t(n,i,o,a,s,l){a?(a.hasClass("ui-accordion")&&a.accordion("destroy"),a.html("")):(a=$('<div class="observable-palette-obs-box observable-palette-visible" data-observable="'+i+'"></div>'),l&&a.data("editor","read-only"));var d,c=e.eden.root.lookup(i),u=c.value(),p=typeof u,h="string"==p,g=!l||h,v=c.eden_definition;if(!l&&void 0!==c.eden_definition){var f=v.match(/^\S+\s+is\s+(.*?);?$/);rhs=f[1],p="definition"}var m=$('<h3><span class="observable-palette-obs-heading">'+i+"</span> </h3>");l&&a.addClass("observable-palette-dependency-value-box");var b=$('<div class="observable-palette-heading-right"></div>');m.append(b),a.append(m);var y=Eden.prettyPrintValue("",u,128,!1,!1),w=$("<a>"+y+"</a>");b.append(w);var S=$("<select></select>");function x(e){var t,n=e.target.value;"hide"!=n?("boolean"==n?t=!1:"number"==n?t=0:"string"==n&&(t=""),c.assign(t,EdenSymbol.hciAgent,!0)):s.remove(i,a,o)}l?S.append('<option value="'+p+'">'+p[0].toUpperCase()+p.slice(1)+"</option>"):(S.append('<option value="number">Number</option>'),S.append('<option value="string">Text (String)</option>'),S.append('<option value="boolean">Yes/No (Boolean)</option>'),S.append('<option value="undefined">Undefined</option>')),S.append('<option value="hide">Hide</option>'),S[0].value=p,S.on("change",x),b.on("click",function(e){e.stopPropagation()}),w.on("click",function(e){w.detach(),b.append(S),S.focus()}),S.on("blur",function(e){S.detach(),b.append(w)});var E=$("<div></div>");if("definition"==p){var I=$('<div class="observable-palette-definition"></div>');I.append(i+" is "),rhsSpan=$('<span class="observable-palette-definition-rhs" contenteditable="true"></span>'),rhsSpan.append(Eden.htmlEscape(rhs)),I.append(rhsSpan),I.append(";"),I.on("click",function(e){rhsSpan.focus(),I.addClass("focussed")}),rhsSpan.on("blur",function(e){I.removeClass("focussed")}),E.append(I);var k=$('<div class="observable-palette-view-commands"> </div>');E.append(k);var C=$('<a onclick="">Expand</a>');C.click(function(){L.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",0)});var A=$('<a onclick="">Collapse</a>');A.click(function(){L.find(".observable-palette-obs-box.ui-accordion").accordion("option","active",!1)});var _=$('<a onclick="">Hide</a>');_.click(function(){var e=L.find(".observable-palette-obs-box");e.removeClass("observable-palette-visible"),e.slideUp()});var T=$('<a onclick="">Show</a>');T.click(function(){var e=L.find(".observable-palette-obs-box");e.addClass("observable-palette-visible"),e.slideDown()}),k.append(C),k.append(A),k.append(_),k.append(T);var D,L=$('<div class="observable-palette-dependencies"></div>');L.sortable({connectWith:".observable-palette-column",forcePlaceholderSize:!0,handle:"h3",items:">.observable-palette-obs-box",placeholder:"observable-palette-drag-placeholder",tolerance:"pointer",receive:function(e,t){var n=t.item,o=n.data("observable");(!c.isDependentOn("/"+o)||o==i&&"read-only"!=n.data("editor"))&&t.sender.sortable("cancel"),2==L.children(".observable-palette-visible").length&&k.slideDown(),s.removeDuplicates(e.target,n)},remove:function(e,t){L.children(".observable-palette-visible").length<2&&k.slideUp()}});var M=0;for(var U in c.dependencies){var N=c.dependencies[U];U=U.slice(1),void 0===N.eden_definition&&(D=t(n,U,r(),void 0,s,!1),s.register(U,D),L.append(D),M++)}if(M<2&&k.hide(),d=function(e,r){var l=e.eden_definition;void 0===l?t(n,i,o,a,s,!1):w.html(Eden.prettyPrintValue("",r,128,!1,!1))},E.append(L),h){var P=t(n,i,r(),void 0,s,!0);L.append(P)}}else if("number"==p){var O,V,B;if(B=1==u||-1==u||u!=Math.floor(u)?5e-4:1,0==u)O=0,V=10;else if(u>=-1&&u<=1)O=u>0?0:-1,V=1;else if(u<0){O=2*u;var F=Number((-u%B).toPrecision(14));0!=F&&F!=B&&(O=O+F-B),V=O+2*(u-O)}else O=0,V=2*Math.ceil((u/B).toPrecision(16))*B;var H=$('<input type="range" min="'+O+'" max="'+V+'" step="'+B+'" value="'+u+'" class="observable-palette-slider"/>'),R=H[0];H.on("input",function(e){c.assign(parseFloat(R.value),EdenSymbol.hciAgent,!0)});var j=$('<table class="observable-palette-number-controls"></table>'),W=$("<tr></tr>");j.append(W);var z=$('<td colspan="3" class="observable-palette-left-cell observable-palette-right-cell observable-palette-slider-cell"></td>');z.append(H),W.append(z);var G=$('<tr class="observable-palette-limits"></tr>');j.append(G);var J,q,K=$('<td class="observable-palette-advanced observable-palette-left-cell"></td>'),X=$('<input type="number" value="'+O+'" step='+B+'" title="Smallest value"/>'),Y=X[0];K.append(X),G.append(K),X.on("input",function(e){var t=e.target.value;if(""!=t){var n=parseFloat(t);R.min=t;var i=c.value();n>=0&&i<n&&c.assign(n,EdenSymbol.hciAgent,!0)}});var Q=!1;X.on("focus",function(e){J=e.target.value}),X.on("blur",function(e){var t=e.target.value;if(""==t)e.target.value=J,R.min=J;else{var n=parseFloat(t),i=parseFloat(R.max),o=parseFloat(R.step),a=n+Math.round((i-n)/o)*o;a<=n&&(a=n>0?n+Math.ceil((n/o).toPrecision(16))*o:Math.ceil((n/2/o).toPrecision(16))*o)<n+10*o&&(a=n+10*o),R.max=a,re.value=a,c.value()<n&&c.assign(n,EdenSymbol.hciAgent,!0)}});var Z=$('<td class="observable-palette-centre-cell"></td>');G.append(Z);var ee=$('<div class="observable-palette-number-centre"></div>');Z.append(ee);var te=$('<label><span class="observable-palette-label">Value&nbsp;</span></label>');ee.append(te);var ne=$('<input type="number" value="'+u+'" step='+B+'"/>'),ie=ne[0];te.append(ne),ne.on("input",function(e){var t=e.target.value;""!=t&&(R.value=t,c.assign(parseFloat(t),EdenSymbol.hciAgent,!0))}),ne.on("focus",function(e){Q=!0,q=e.target.value}),ne.on("blur",function(e){if(""==e.target.value)c.assign(parseFloat(q),EdenSymbol.hciAgent,!0);else{var t=c.value();t<parseFloat(R.min)&&(Y.value=t,R.min=t),R.value=t}Q=!1});var oe=$('<td  class="observable-palette-advanced observable-palette-right-cell"></td>'),ae=$('<input type="number" value="'+V+'" step='+B+'" title="Biggest value"/>'),re=ae[0];oe.append(ae),G.append(oe),ae.on("input",function(e){R.max=e.target.value});var se=$('<label class="observable-palette-advanced"><span class="observable-palette-label observable-palette-step-label">Step&nbsp;</span></label>');ee.append(se);var le=$('<input type="number" value="'+B+'" min="0" title="Slider step size"/>'),de=le[0];de.acceptedValue=B,se.append(le),le.on("input",function(e){var t=parseFloat(de.value);if(t>0){var n,i=Math.floor(t);if(t==i){var o=String(t).match(/(0*)$/);n=Math.pow(10,o[1].length)}else n=Math.pow(10,-((t-i).toPrecision(15).replace(/0*$/,"").length-2));t==n&&t<de.acceptedValue&&(n/=10),de.acceptedValue=t,de.step=n}}),le.on("blur",function(e){var t=parseFloat(de.value);0==t?(de.value=1,de.acceptedValue=1):t<0||isNaN(t)?de.value=de.acceptedValue:(R.step=t,Y.step=t,re.step=t,ie.step=t)}),d=function(e,r){if("number"!=typeof r||void 0!==e.eden_definition)t(n,i,o,a,s,l);else if(w.html(Eden.prettyPrintValue("",r,128,!1,!1)),!Q){var d,c,u,p=parseFloat(R.min),h=parseFloat(R.max),g=parseFloat(R.step);r<p?(0==r?d=0:r>0?(d=Math.ceil(r/2/g)*g-g,0!=(u=Number((r%g).toPrecision(14)))&&u!=g&&(d+=u)):(d=2*r,0!=(u=Number((-r%g).toPrecision(14)))&&u!=g&&(d=d+u-g)),R.min=d,Y.value=d,c=d+Math.round((h-d)/g)*g,R.max=c,re.value=c):r>h&&(c=p+2*Math.ceil(((r-p)/g).toPrecision(16))*g,R.max=c,re.value=c),R.value=r,ie.value=r}},E.append(j)}else if("boolean"==p){var ce=$('<input type="checkbox"/>'),ue=ce[0],pe=$('<span class="bool_text"></span>');function he(e){pe.fadeOut(250,"linear",function(){e?(pe.html("true"),pe.css("color","green")):(pe.html("false"),pe.css("color","red")),pe.fadeIn(400,"swing",function(){w.html(e?"true":"false")})})}ce.on("change",function(e){var t=ue.checked;c.assign(t,c.hciAgent,!0)}),d=function(e,r){!0!==r&&!1!==r||void 0!==e.eden_definition?t(n,i,o,a,s,l):(ue.checked=r,he(r))},he(u);var ge=$('<label class="observable-palette-bool"></label>');ge.append(ce),ge.append(pe),E.append(ge)}else if("string"==p){var ve=$('<textarea class="string-input">'+u+"</textarea>"),fe=ve[0];ve.on("input",function(e){var t=fe.value;c.assign(t,EdenSymbol.hciAgent,!0),fe.style.height="",fe.style.height=String(fe.scrollHeight+4)+"px"}),d=function(e,r){"string"!=typeof r||void 0!==e.eden_definition?t(n,i,o,a,s,l):(fe.value=r,fe.rows=r.split("\n").length,w.html(Eden.prettyPrintValue("",r,128,!1,!1)))},E.append($('<div class="quote left-quote">&ldquo;</div>')),E.append(ve),E.append($('<div class="quote right-quote">&rdquo;</div>'))}else if("undefined"==p){if(E.append($('<p><span class="result_name">'+i+"</span> is currently undefined.</p>")),!l){var me=S.clone();me[0].value="undefined",me.on("change",x);var be=$("<label>Choose type: </label>");be.append(me);var ye=$("<div></div>");ye.append(be),E.append(ye)}d=function(e,r){void 0===r&&void 0===e.eden_definition||t(n,i,o,a,s,l)}}else d=function(e,r){void 0===r&&void 0===e.eden_definition||t(n,i,o,a,s,l)};return c.addJSObserver(n+"/"+i+"/"+o,d),g?(l&&E.find("input, textarea").attr("readonly","readonly"),a.append(E),a.accordion({active:"undefined"!=p&&void 0,collapsible:!0,heightStyle:"content"})):m.addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all observable-palette-static-header"),a.removeFromDialog=function(){s.remove(i,a,o)},a}(t,n,r(),void 0,k,!1),s.push(a),u(a)):a.slideUp(400,"swing",function(){a.detach(),u(a)})}function u(e){o?w[i].append(e):(0==i?y.after(e):w[i].prepend(e),e.hide(0,"linear",function(){e.slideDown(400)}))}}if(Array.isArray(x)){for(var _=!1,T=root.lookup("_view_"+i+"_search_language").value(),D=[],L=0;L<x.length;L++){var M=x[L];if(D[L]=[],Array.isArray(M))for(var U=0;U<M.length;U++){var N=M[U];if(e.eden.isValidIdentifier(N)&&!/[\\*+?^$|({[]|(\s+or\s+)/i.test(N))A(N,L,!0);else{var P=e.regExpFromStr(N,"",!0,T);D[L].push(P),_=!0}}}if(_)for(name in root.symbols)for(L=0;L<D.length;L++){var O=D[L];for(U=0;U<O.length;U++){if((P=O[U]).test(name)){A(name,L,!0);break}}}}l.dialog({title:n,width:260,height:400+e.scrollBarSize})},e.views.ObservablePalette={dialog:this.createDialog,title:"Observable Palette",category:e.viewCategories.interpretation},t()},EdenUI.plugins.ObservablePalette.title="Observable Palette",EdenUI.plugins.ObservablePalette.description="Provides the ability to change observables using a simple form.",EdenUI.plugins.ScriptGenerator=function(e,t){var n=this;this.createDialog=function(e,t){e.slice(0,-7);var i=$('<div class="script-generator"></div>'),o=($("<div></div>"),$('<div class="script-generator-controls"></div>'),$('<div class="script-generator-controls" style="float: right"></div>'),$('<div class="script-generator-code readonly" spellcheck="false"></div>'));i.append(o);var a=$('<button class="script-generator-refresh">&#xf021;</button>');i.append(a);var r={};o.on("click",".scriptgen-importex",function(e){var t=e.currentTarget.getAttribute("data-agent");r[t]?r[t]=!1:r[t]=!0,s()});var s=function(){o.html("");for(var e=n.generateScriptLines(r),t=0;t<e.imports.length;t++)if(""!=e.imports[t]){var i=e.imports[t].split(" ")[1].split("@")[0],a=e.imports[t].split(" "),s='<span class="eden-keyword">'+a[0]+'</span> <span class="eden-path">'+a[1]+"</span>";if(a.length>2)for(var l=2;l<a.length;l++)s+=" "+a[l];var d=$('<div class="eden-line"><span class="scriptgen-importex" data-agent="'+i+'">'+(r[i]?"&#xf055;":"&#xf056;")+"</span><span>"+(r[i]?'<span class="eden-comment">## '+e.imports[t]+"</span>":s)+"</span></div>");o.append(d)}o.append($('<div class="eden-line"></div>'));var c=$("<div></div>");o.append(c);var u=e.definitions.join("\n")+"\n## When agents\n\n"+e.agents,p=new Eden.AST(u,void 0,{name:"*JavaScript"});new EdenUI.Highlight(c.get(0)).highlight(p,-1,-1)};a.click(function(){s()}),s(),$('<div id="'+e+'"></div>').html(i).dialog({appendTo:"#jseden-views",title:t,width:790,height:700,minHeight:120,minWidth:230,dialogClass:"scriptgen-dialog"})};this.generateScriptLines=function(e){var t={},n=Eden.Generator.importsScript().split("\n");t.imports=n;var i=Eden.Generator.symbolScript(e).split("\n");t.definitions=i;var o=Eden.Agent.getActiveAgents(e,!1);return t.agents=o,t},this.baseConstrualSymbols={},this.changeListener=function(e,t){var i=e.last_modified_by;if(!t&&"include"!=i){var o=e.name.slice(1);void 0!==e.eden_definition&&void 0!==e.definition?n.baseConstrualSymbols[o]={eden_definition:e.eden_definition,last_modified_by:i}:n.baseConstrualSymbols[o]={cached_value:e.cached_value,last_modified_by:i}}},e.eden.listenTo("executeError",EdenUI.plugins.ScriptGenerator,function(e,t){root.removeGlobal(n.changeListener)}),this.baseConstrualURL="",e.views.ScriptGenerator={dialog:this.createDialog,title:"Script Generator",category:e.viewCategories.history},t()},EdenUI.plugins.ScriptGenerator.title="Script Generator",EdenUI.plugins.ScriptGenerator.description="Generates a definitional script that can be used to recreate the current state of the environment at a later time.",EdenUI.plugins.ScriptGenerator.originalAuthor="Joe Butler",EdenUI.plugins.ScriptGenerator.loadBaseConstrual=function(e){"ScriptGenerator"in edenUI.plugins&&root.addGlobal(edenUI.plugins.ScriptGenerator.changeListener),eden.include(e,"",{name:Symbol.getInputAgentName()},function(){"ScriptGenerator"in edenUI.plugins&&(root.removeGlobal(edenUI.plugins.ScriptGenerator.changeListener),edenUI.plugins.ScriptGenerator.baseConstrualURL=e)})},function(){"use strict";var e,t=this,n=(e="undefined"!=typeof exports?exports:t.Springy={}).Graph=function(){this.nodeSet={},this.nodes=[],this.edges=[],this.adjacency={},this.nextNodeId=0,this.nextEdgeId=0,this.eventListeners=[]},i=e.Node=function(e,t){this.id=e,this.data=void 0!==t?t:{}},o=e.Edge=function(e,t,n,i){this.id=e,this.source=t,this.target=n,this.data=void 0!==i?i:{}};n.prototype.addNode=function(e){return e.id in this.nodeSet||this.nodes.push(e),this.nodeSet[e.id]=e,this.notify(),e},n.prototype.addNodes=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=new i(t,{label:t});this.addNode(n)}},n.prototype.addEdge=function(e){var t=!1;return this.edges.forEach(function(n){e.id===n.id&&(t=!0)}),t||this.edges.push(e),e.source.id in this.adjacency||(this.adjacency[e.source.id]={}),e.target.id in this.adjacency[e.source.id]||(this.adjacency[e.source.id][e.target.id]=[]),t=!1,this.adjacency[e.source.id][e.target.id].forEach(function(n){e.id===n.id&&(t=!0)}),t||this.adjacency[e.source.id][e.target.id].push(e),this.notify(),e},n.prototype.addEdges=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=this.nodeSet[t[0]];if(void 0==n)throw new TypeError("invalid node name: "+t[0]);var i=this.nodeSet[t[1]];if(void 0==i)throw new TypeError("invalid node name: "+t[1]);var o=t[2];this.newEdge(n,i,o)}},n.prototype.newNode=function(e){var t=new i(this.nextNodeId++,e);return this.addNode(t),t},n.prototype.newEdge=function(e,t,n){var i=new o(this.nextEdgeId++,e,t,n);return this.addEdge(i),i},n.prototype.loadJSON=function(e){("string"==typeof e||e instanceof String)&&(e=JSON.parse(e)),("nodes"in e||"edges"in e)&&(this.addNodes.apply(this,e.nodes),this.addEdges.apply(this,e.edges))},n.prototype.getEdges=function(e,t){return e.id in this.adjacency&&t.id in this.adjacency[e.id]?this.adjacency[e.id][t.id]:[]},n.prototype.removeNode=function(e){e.id in this.nodeSet&&delete this.nodeSet[e.id];for(var t=this.nodes.length-1;t>=0;t--)this.nodes[t].id===e.id&&this.nodes.splice(t,1);this.detachNode(e)},n.prototype.detachNode=function(e){this.edges.slice().forEach(function(t){try{t.source.id!==e.id&&t.target.id!==e.id||this.removeEdge(t)}catch(e){}},this),this.notify()},n.prototype.removeEdge=function(e){for(var t=this.edges.length-1;t>=0;t--)this.edges[t].id===e.id&&this.edges.splice(t,1);for(var n in this.adjacency){for(var i in this.adjacency[n]){for(var o=this.adjacency[n][i].length-1;o>=0;o--)this.adjacency[n][i][o].id===e.id&&this.adjacency[n][i].splice(o,1);0==this.adjacency[n][i].length&&delete this.adjacency[n][i]}c(this.adjacency[n])&&delete this.adjacency[n]}this.notify()},n.prototype.merge=function(e){var t=[];e.nodes.forEach(function(e){t.push(this.addNode(new i(e.id,e.data)))},this),e.edges.forEach(function(e){var n=t[e.from],i=t[e.to],a=e.directed?a=e.type+"-"+n.id+"-"+i.id:n.id<i.id?e.type+"-"+n.id+"-"+i.id:e.type+"-"+i.id+"-"+n.id;this.addEdge(new o(a,n,i,e.data)).data.type=e.type},this)},n.prototype.filterNodes=function(e){this.nodes.slice().forEach(function(t){e(t)||this.removeNode(t)},this)},n.prototype.filterEdges=function(e){this.edges.slice().forEach(function(t){e(t)||this.removeEdge(t)},this)},n.prototype.addGraphListener=function(e){this.eventListeners.push(e)},n.prototype.notify=function(){this.eventListeners.forEach(function(e){e.graphChanged()})};var a=e.Layout={};a.ForceDirected=function(e,t,n,i){this.graph=e,this.stiffness=t,this.repulsion=n,this.damping=i,this.nodePoints={},this.edgeSprings={}},a.ForceDirected.prototype.point=function(e){if(!(e.id in this.nodePoints)){var t=void 0!==e.data.mass?e.data.mass:1;this.nodePoints[e.id]=new a.ForceDirected.Point(l.random(),t)}return this.nodePoints[e.id]},a.ForceDirected.prototype.spring=function(e){if(!(e.id in this.edgeSprings)){var t=void 0!==e.data.length?e.data.length:1,n=!1,i=this.graph.getEdges(e.source,e.target);if(i.forEach(function(e){!1===n&&e.id in this.edgeSprings&&(n=this.edgeSprings[e.id])},this),!1!==n)return new a.ForceDirected.Spring(n.point1,n.point2,0,0);this.graph.getEdges(e.target,e.source);if(i.forEach(function(e){!1===n&&e.id in this.edgeSprings&&(n=this.edgeSprings[e.id])},this),!1!==n)return new a.ForceDirected.Spring(n.point2,n.point1,0,0);this.edgeSprings[e.id]=new a.ForceDirected.Spring(this.point(e.source),this.point(e.target),t,this.stiffness)}return this.edgeSprings[e.id]},a.ForceDirected.prototype.eachNode=function(e){var t=this;this.graph.nodes.forEach(function(n){e.call(t,n,t.point(n))})},a.ForceDirected.prototype.eachEdge=function(e){var t=this;this.graph.edges.forEach(function(n){e.call(t,n,t.spring(n))})},a.ForceDirected.prototype.eachSpring=function(e){var t=this;this.graph.edges.forEach(function(n){e.call(t,t.spring(n))})},a.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(e,t){this.eachNode(function(e,n){if(t!==n){var i=t.p.subtract(n.p),o=i.magnitude()+.1,a=i.normalise();t.applyForce(a.multiply(this.repulsion).divide(o*o*.5)),n.applyForce(a.multiply(this.repulsion).divide(o*o*-.5))}})})},a.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(e){var t=e.point2.p.subtract(e.point1.p),n=e.length-t.magnitude(),i=t.normalise();e.point1.applyForce(i.multiply(e.k*n*-.5)),e.point2.applyForce(i.multiply(e.k*n*.5))})},a.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(e,t){var n=t.p.multiply(-1);t.applyForce(n.multiply(this.repulsion/50))})},a.ForceDirected.prototype.updateVelocity=function(e){this.eachNode(function(t,n){n.v=n.v.add(n.a.multiply(e)).multiply(this.damping),n.a=new l(0,0)})},a.ForceDirected.prototype.updatePosition=function(e){this.eachNode(function(t,n){n.p=n.p.add(n.v.multiply(e))})},a.ForceDirected.prototype.totalEnergy=function(e){var t=0;return this.eachNode(function(e,n){var i=n.v.magnitude();t+=.5*n.m*i*i}),t};var r,s;e.requestAnimationFrame=(r=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,n){t.setTimeout(e,10)},s=t,function(){return r.apply(s,arguments)}),a.ForceDirected.prototype.start=function(t,n){var i=this;this._started||(this._started=!0,this._stop=!1,e.requestAnimationFrame(function o(){i.applyCoulombsLaw(),i.applyHookesLaw(),i.attractToCentre(),i.updateVelocity(.03),i.updatePosition(.03),void 0!==t&&t(),i._stop||i.totalEnergy()<.01?(i._started=!1,void 0!==n&&n()):e.requestAnimationFrame(o)}))},a.ForceDirected.prototype.stop=function(){this._stop=!0},a.ForceDirected.prototype.nearest=function(e){var t={node:null,point:null,distance:null},n=this;return this.graph.nodes.forEach(function(i){var o=n.point(i),a=o.p.subtract(e).magnitude();(null===t.distance||a<t.distance)&&(t={node:i,point:o,distance:a})}),t},a.ForceDirected.prototype.getBoundingBox=function(){var e=new l(-2,-2),t=new l(2,2);this.eachNode(function(n,i){i.p.x<e.x&&(e.x=i.p.x),i.p.y<e.y&&(e.y=i.p.y),i.p.x>t.x&&(t.x=i.p.x),i.p.y>t.y&&(t.y=i.p.y)});var n=t.subtract(e).multiply(.07);return{bottomleft:e.subtract(n),topright:t.add(n)}};var l=e.Vector=function(e,t){this.x=e,this.y=t};l.random=function(){return new l(10*(Math.random()-.5),10*(Math.random()-.5))},l.prototype.add=function(e){return new l(this.x+e.x,this.y+e.y)},l.prototype.subtract=function(e){return new l(this.x-e.x,this.y-e.y)},l.prototype.multiply=function(e){return new l(this.x*e,this.y*e)},l.prototype.divide=function(e){return new l(this.x/e||0,this.y/e||0)},l.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},l.prototype.normal=function(){return new l(-this.y,this.x)},l.prototype.normalise=function(){return this.divide(this.magnitude())},a.ForceDirected.Point=function(e,t){this.p=e,this.m=t,this.v=new l(0,0),this.a=new l(0,0)},a.ForceDirected.Point.prototype.applyForce=function(e){this.a=this.a.add(e.divide(this.m))},a.ForceDirected.Spring=function(e,t,n,i){this.point1=e,this.point2=t,this.length=n,this.k=i};var d=e.Renderer=function(e,t,n,i){this.layout=e,this.clear=t,this.drawEdge=n,this.drawNode=i,this.layout.graph.addGraphListener(this)};d.prototype.graphChanged=function(e){this.start()},d.prototype.start=function(){var e=this;this.layout.start(function(){e.clear(),e.layout.eachEdge(function(t,n){e.drawEdge(t,n.point1.p,n.point2.p)}),e.layout.eachNode(function(t,n){e.drawNode(t,n.p)})})},d.prototype.stop=function(){this.layout.stop()},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),a=o.length>>>0;if("[object Function]"!={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(n=t),i=0;i<a;){var r;i in o&&(r=o[i],e.call(n,r,i,o)),i++}});var c=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}.call(this),jQuery.fn.springy=function(e){var t=this.graph=e.graph||new Springy.Graph,n=e.stiffness||100,i=e.repulsion||5e3,o=e.damping||.5,a=e.nodeSelected||null,r=this[0],s=r.getContext("2d"),l=this.layout=new Springy.Layout.ForceDirected(t,n,i,o),d=l.getBoundingBox(),c={bottomleft:new Springy.Vector(-2,-2),topright:new Springy.Vector(2,2)};Springy.requestAnimationFrame(function e(){c=l.getBoundingBox(),d={bottomleft:d.bottomleft.add(c.bottomleft.subtract(d.bottomleft).divide(10)),topright:d.topright.add(c.topright.subtract(d.topright).divide(10))},Springy.requestAnimationFrame(e)});var u=function(e){var t=d.topright.subtract(d.bottomleft),n=e.subtract(d.bottomleft).divide(t.x).x*r.width,i=e.subtract(d.bottomleft).divide(t.y).y*r.height;return new Springy.Vector(n,i)},p=function(e){var t=d.topright.subtract(d.bottomleft),n=e.x/r.width*t.x+d.bottomleft.x,i=e.y/r.height*t.y+d.bottomleft.y;return new Springy.Vector(n,i)},h=null,g=null;jQuery(r).mousedown(function(e){var t=jQuery(this).offset(),n=p({x:e.pageX-t.left,y:e.pageY-t.top});null!==(h=g=l.nearest(n)).node&&(g.point.m=1e4,a&&a(h.node)),v.start()}),jQuery(r).dblclick(function(e){var t=jQuery(this).offset(),n=p({x:e.pageX-t.left,y:e.pageY-t.top});h=l.nearest(n),node=h.node,node&&node.data&&node.data.ondoubleclick&&node.data.ondoubleclick()}),jQuery(r).mousemove(function(e){var t=jQuery(this).offset(),n=p({x:e.pageX-t.left,y:e.pageY-t.top});l.nearest(n),null!==g&&null!==g.node&&(g.point.p.x=n.x,g.point.p.y=n.y),v.start()}),jQuery(window).bind("mouseup",function(e){g=null}),Springy.Node.prototype.getWidth=function(){var e=void 0!==this.data.label?this.data.label:this.id;if(this._width&&this._width[e])return this._width[e];s.save(),s.font="16px Verdana, sans-serif";var t=s.measureText(e).width+10;return s.restore(),this._width||(this._width={}),this._width[e]=t,t},Springy.Node.prototype.getHeight=function(){return 20};var v=this.renderer=new Springy.Renderer(l,function(){var e=r.parentNode;null!==e&&(r.height=e.clientHeight,r.width=e.clientWidth),s.clearRect(0,0,r.width,r.height)},function(e,n,i){for(var o=u(n).x,a=u(n).y,r=u(i).x,l=u(i).y,d=new Springy.Vector(r-o,l-a),c=d.normal().normalise(),p=t.getEdges(e.source,e.target),h=t.getEdges(e.target,e.source),g=p.length+h.length,v=0,m=0;m<p.length;m++)p[m].id===e.id&&(v=m);var b=c.multiply(-0*(g-1)/2+0*v),y=u(n).add(b),w=u(i).add(b),S=e.target.getWidth(),x=e.target.getHeight(),E=function(e,t,n,i,o){var a,r={x:n.x,y:n.y},s={x:n.x+i,y:n.y},l={x:n.x,y:n.y+o},d={x:n.x+i,y:n.y+o};return(a=f(e,t,r,s))?a:(a=f(e,t,s,d))?a:(a=f(e,t,d,l))?a:!!(a=f(e,t,l,r))&&a}(y,w,{x:r-S/2,y:l-x/2},S,x);E||(E=w);var I,k,C=void 0!==e.data.color?e.data.color:"#C0C0C0";I="dashes"in e.data?e.data.dashes:[];var A=void 0!==e.data.weight?e.data.weight:1;s.lineWidth=Math.max(3*A,.1),k=1+s.lineWidth;var _,T=void 0===e.data.directional||e.data.directional;_=T?E.subtract(d.normalise().multiply(4)):w,s.strokeStyle=C,s.setLineDash(I),s.beginPath(),s.moveTo(y.x,y.y),s.lineTo(_.x,_.y),s.stroke(),T&&(s.save(),s.fillStyle=C,s.translate(E.x,E.y),s.rotate(Math.atan2(l-a,r-o)),s.beginPath(),s.moveTo(-8,k),s.lineTo(0,0),s.lineTo(-8,-k),s.lineTo(-6.4,-0),s.closePath(),s.fill(),s.restore()),void 0!==e.data.label&&(text=e.data.label,s.save(),s.textAlign="center",s.textBaseline="top",s.font="10px Helvetica, sans-serif",s.fillStyle="#5BA6EC",s.fillText(text,(o+r)/2,(a+l)/2),s.restore())},function(e,n){var i=u(n);s.save();var o=e.getWidth();e.getHeight(),s.fillStyle="#FFFFFF",s.fillRect(i.x-o/2,i.y-10,o,20),s.setLineDash([]),s.textAlign="left",s.textBaseline="top",s.font="16px Verdana, sans-serif";var a=void 0!==e.data.label?e.data.label:e.id,r=root.lookup(a).eden_definition;void 0==r?s.fillStyle="#0000FF":0==r.toString().indexOf("proc")?s.fillStyle="#FF0000":0==r.toString().indexOf("func")?s.fillStyle="#336600":s.fillStyle="#0000FF",t.re.test(a)&&(s.lineWidth=1,s.strokeStyle="#000000",s.strokeRect(i.x-o/2,i.y-10,o,20)),s.fillText(a,i.x-o/2+5,i.y-8),s.restore()});function f(e,t,n,i){var o=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y);if(0===o)return!1;var a=((i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x))/o,r=((t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x))/o;return!(a<0||a>1||r<0||r>1)&&new Springy.Vector(e.x+a*(t.x-e.x),e.y+a*(t.y-e.y))}return v.start(),this},EdenUI.plugins.DependencyMap=function(e,t){var n=this;function i(e){var t=e.value(),n=typeof t,i=null;return i=void 0===t?{code:""}:"number"==n?{code:Math.round(t),face:"arial"}:"string"==n?{code:""}:"boolean"==n?{code:t?"":""}:"function"==n?{code:""}:Array.isArray(t)?{code:""}:t instanceof CanvasImage?{code:""}:t instanceof Text?{code:""}:{code:""},{id:e.name,label:e.name,shape:"icon",icon:i}}this.createDialog=function(t,i){var o=void 0,a={nodes:new vis.DataSet([]),edges:new vis.DataSet([])},r=$('<div id="'+t+'" style="overflow: hidden"></div>'),s=$('<div class="dependency-map-content"></div>');r.append(s);o=new vis.Network(s.get(0),a,{});var l=$('<div class="dependency-map-controls"></div>');r.append(l);var d=$('<input type="text" placeholder="search"/>'),c=d.get(0),u=$('<input type="checkbox" checked="checked"/>'),p=u.get(0);function h(){var t;t=""==c.value?/^$/:e.regExpFromStr(d,"",p.checked),n.updateGraph(o,t)}l.append(d),l.append($("<label>Exact matches only </label>").append(u)),d.on("input",h),u.on("change",h),r.on("mouseenter",h),r.dialog({appendTo:"#jseden-views",title:i,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dependency-map-dialog"})},this.updateGraph=function(e,t){e.re=t,e.newNodes=[],e.newEdges=[];var n,o={};for(var a in root.symbols){var r=root.symbols[a],s=r.name;if(t.test(s)){o[s]||(o[s]=!0,e.newNodes.push(i(r)));var l=r.dependencies;for(var d in l){o[p=l[d].name]||(o[p]=!0,e.newNodes.push(i(l[d]))),e.newEdges.push({from:p,to:s,arrows:"to"})}var c=r.subscribers;for(var d in c){var u=c[d];o[p=u.name]||(o[p]=!0,e.newNodes.push(i(c[d])));r.name,u.dynamicDependencies;e.newEdges.push({from:s,to:p,arrows:"to"})}for(var d in c=r.observers){var p;o[p=c[d].id]||(o[p]=!0,e.newNodes.push((n=c[d])instanceof EdenSymbol?i(n):{id:n.id,label:"when",shape:"icon",icon:{code:""}})),e.newEdges.push({from:s,to:p,arrows:"to"})}}}var h={nodes:new vis.DataSet(e.newNodes),edges:new vis.DataSet(e.newEdges)};e.setData(h)},e.views.DependencyMap={dialog:this.createDialog,title:"Dependency Map",category:e.viewCategories.comprehension,menuPriority:2},t()},EdenUI.plugins.DependencyMap.title="Dependency Map",EdenUI.plugins.DependencyMap.description="Displays a diagram showing the relationships between observables.",EdenUI.plugins.DependencyMap.author="Joe Butler",EdenUI.plugins.StateTimeLine=function(e,t){var n=this;this.createDialog=function(t,o){n.ignoreRE=new RegExp("((_view.*)|(_View.*)|(_status)|(mouse.*)|(picture))"),code_entry=$('<div id="'+t+'-content" class="st-content"></div>').append($('<input id="'+t+'-regex"></input>')).append($('<button style="margin-bottom:20px;">Generate State</button>').click(function(){n.ST.states.push(i("partial"));var o=document.getElementById(t+"-regex").value;""==o&&(o="State "+n.ST.nextBlankState),$("#"+t+"-content-states").append("<div id='stdiv"+e.plugins.StateTimeLine.ST.nextBlankState+"' class='stdiv'>"+o+": <a class='stlinkrestore' href='javascript:edenUI.plugins.StateTimeLine.changeState("+e.plugins.StateTimeLine.ST.nextBlankState+")'>Restore</a> "+(new Date).toLocaleTimeString()+" <a class='stlinkdelete' href='javascript:edenUI.plugins.StateTimeLine.deleteState("+e.plugins.StateTimeLine.ST.nextBlankState+")'> Delete</a></div>"),document.getElementById(t+"-regex").value="",e.plugins.StateTimeLine.ST.nextBlankState++})).append($('<div id="'+t+'-content-states"></div>')),$dialog=$('<div id="'+t+'"></div>').html(code_entry).dialog({title:o,width:300,height:450,minHeight:120,minWidth:230})},n.ST={},n.ST.states=[],n.ST.nextBlankState=0,this.deleteState=function(e){$(document.getElementById("stdiv"+e)).remove()},this.changeState=function(t){for(var n in root.symbols)Eden.isitSystemSymbol(root.symbols[n].name.substring(1,root.symbols[n].name.length))||e.plugins.StateTimeLine.ignoreRE.test(root.symbols[n].name.substring(1,root.symbols[n].name.length))||delete root.symbols[n];e.plugins.ScriptInput.submitEdenCode(e.plugins.StateTimeLine.ST.states[t])};var i=function(t){var n=[],i=[],o=[],a=[],r=root.lookup("picture").eden_definition;for(var s in void 0==r?r="picture is [];":r+=";",root.symbols){var l=5,d=root.symbols[s],c=d.eden_definition;if(void 0==c&&(c="@"),0==c.indexOf("proc")){if("(Action)",l=2,"partial"==t&&Eden.isitSystemAgent(s))continue}else if(0==c.indexOf("func")){if("(Function)",l=1,"partial"==t&&Eden.isitSystemFunction(s))continue}else if("(Observable)",l=0,"partial"==t&&Eden.isitSystemObservable(s))continue;var u=Eden.edenCodeForValue(d.cached_value);if(!e.plugins.StateTimeLine.ignoreRE.test(s))if(1==l)a.push(c);else if(0==l){if("@"==u&&"@"==c)continue;"@"==c?i.push(s+" = "+u+";"):n.push(c+";")}else 2==l?o.push(c):console.log("oh dear error")}var p=[];p.push("autocalc = 0;");for(var h=0;h<i.length;h++)p.push(i[h]);for(h=0;h<n.length;h++)p.push(n[h]);for(h=0;h<o.length;h++)p.push(o[h]),p.push("");for(h=0;h<a.length;h++)p.push(a[h]),p.push("");return p.push(r),p.push("autocalc = 1;"),p.join("\n")};e.views.StateTimeLine={dialog:this.createDialog,title:"State Time Line",category:e.viewCategories.history},t()},EdenUI.plugins.StateTimeLine.title="State Time Line",EdenUI.plugins.StateTimeLine.description="Provides the ability to save the current state, keep a history of saved states and go back to a saved state later.",EdenUI.plugins.StateTimeLine.author="Joe Butler",EdenUI.plugins.StateListener=function(e,t){this.createDialog=function(t,n){var i={confirmClose:!1};return $dialog=$('<div id="'+t+'"></div>').html('<div class="sldiv"><div><label for="sl-ipaddr">IP Address:</label><input type="text" id="sl-ipaddr" value="127.0.0.1"></input></div><div><label for="sl-port">Port:</label><input type="text" id="sl-port" value="8001"></input></div><div><input type="button" value="Connect" id="connectBtn"></input></div><p id="sl-status"></p>').dialog({title:n,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var t="ws://"+$("#sl-ipaddr").val()+":"+$("#sl-port").val()+"/",n=new WebSocket(t);eden.listenTo("executeBegin",this,function(e,t){"net"!=e&&n.send(t)}),eden.listenTo("beforeAssign",this,function(e,t,i){"net"!=i&&n.send(e.name.slice(1)+"="+Eden.edenCodeForValue(t)+";")}),$("#sl-status").html("<p>Connected to: "+t+"</p>"),n.onerror=function(e){$("#sl-status").html("<p>Error connecting to server - please verify server is running at "+t+". For usage instructions please read the comments in the <a href='plugins/state-listener/state-listener-server.js'>state-listener-server.js</a> file.</p>"),i.confirmClose=!1},n.onmessage=function(e){$("#sl-status").html("<p>Received: "+Eden.htmlEscape(e.data)+"</p>"),eden.execute(e.data,"net","",{name:"/execute"},noop)},n.onopen=function(){i.confirmClose=!0,randomSeedSym=e.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):o("randomSeed"),o("randomGenerator")}}else console.log("WebSockets not supported");function o(t){var i=e.eden.root,o=i.lookup("definitionOf").definition(i)(t);n.send(o)}}),i},e.views.StateListener={dialog:this.createDialog,title:"State Listener",category:e.viewCategories.extension},e.eden.include("plugins/state-listener/state-listener.js-e",t)},EdenUI.plugins.StateListener.title="State Listener",EdenUI.plugins.StateListener.description="Provides the ability to synchronize observables over the internet.",EdenUI.plugins.StateListener.author="Jonny Foss",EdenUI.plugins.NetworkRemote=function(e,t){var n,i=this,o=!1,a=!1;Eden.Agent.importAgent("lib/dynamic","default",void 0,function(){}),i.connect=function(){var t=eden.root.lookup("network_address").value(),o=eden.root.lookup("network_port").value(),r=eden.root.lookup("network_key").value();if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var s="ws://"+t+":"+o+"/",l=new WebSocket(s);Eden.Agent.listenTo("executeline",this,function(e,t){if(e){var n=JSON.stringify({action:"executeline",name:e.name,lineno:t});l.send(n)}}),Eden.Agent.listenTo("patch",this,function(e,t,n){if(e){var i=JSON.stringify({action:"patch",name:e.name,patch:t,lineno:n});l.send(i)}}),Eden.Agent.listenTo("owned",this,function(e,t){"net"!=t&&l.send(JSON.stringify({action:"ownership",name:e.name,owned:e.owned}))}),eden.listenTo("beforeAssign",this,function(e,t,n){"net"!=n&&(console.log("ASSIGN: "+e.name+" = "+Eden.edenCodeForValue(t)),l.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:t})))}),$("#nr-status").html("<p>Connected to: "+s+"</p>"),l.onopen=function(t){for(var n in l.send(r),randomSeedSym=e.eden.root.lookup("randomSeed"),randomSeed=randomSeedSym.value(),void 0===randomSeed?randomSeedSym.assign((new Date).getTime(),eden.root.scope,void 0,!0):d("randomSeed"),d("randomGenerator"),a=!0,Eden.Agent.agents)Eden.Agent.agents[n].owned&&l.send(JSON.stringify({action:"ownership",name:n,owned:!0}));eden.root.lookup("network_connected").assign(!0,eden.root.scope)},l.onerror=function(e){a=!1,eden.root.lookup("network_connected").assign(!1,eden.root.scope),eden.root.lookup("network_error").assign(e,eden.root.scope)},l.onclose=function(){eden.root.lookup("network_connected").assign(!1,eden.root.scope)},i.sendControl=function(e,t){console.log("Send Control: "+e+"= "+t),console.log(t),l.send(JSON.stringify({action:"control",key:e,value:t}))},i.sendAssign=function(e){"net"!=e.last_modified_by&&l.send(JSON.stringify({action:"assign",symbol:e.name.slice(1),value:e.value()}))},l.onmessage=function(e){n=JSON.parse(e.data);for(var t=0;t<n.length;t++)switch(line=n[t].code,line.action){case"patch":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.applyPatch(line.patch,line.lineno)});break;case"ownership":Eden.Agent.importAgent(line.name,"default",["noexec","create"],function(e){e.setOwned(line.owned,"net")});break;case"executeline":Eden.Agent.importAgent(line.name,"default",["noexec"],function(e){e.executeLine(line.lineno,!0)});break;case"assign":eden.root.lookup(line.symbol).assign(line.value,eden.root.scope,{name:"net"})}}}else console.log("WebSockets not supported");function d(t){var n=e.eden.root,i=n.lookup("definitionOf").definition(n)(t);l.send(JSON.stringify({code:i}))}},this.createDialog=function(e,t){return $dialog=$('<div id="'+e+'"></div>').html('<div class="nrdiv"><div><label for="nr-ipaddr">IP Address:</label><input type="text" name="nr-ipaddr" id="nr-ipaddr" value="127.0.0.1"></input></div><div><label for="nr-port">Port:</label><input type="text" name="nr-port" id="nr-port" value="8001"></input></div><div><label for="nr-key">Session Key:</label><input type="text" name="nr-key" id="nr-key" value="abcde"></input></div><div><input type="button" value="Connect" name="connectBtn" id="connectBtn"></input></div><div><label for="speedrange">Speed:</label><input type="range" name="speedrange" id="nr-speedrange" step="0.5" min="0.1" max="8" value="1"/></div><p id="nr-status"></p>').dialog({title:t,width:300,height:450,minHeight:120,minWidth:230}),$("#connectBtn").click(function(){a?(a=!1,$("#connectBtn").attr("value","Connect"),$("#nr-ipaddr").removeAttr("disabled"),$("#nr-port").removeAttr("disabled"),$("#nr-key").removeAttr("disabled")):(eden.root.lookup("network_address").assign($("#nr-ipaddr").val(),eden.root.scope),eden.root.lookup("network_port").assign($("#nr-port").val(),eden.root.scope),eden.root.lookup("network_key").assign($("#nr-key").val(),eden.root.scope),i.connect())}),{confirmClose:!1}},this.playCode=function(e){if(void 0!==n[e]){var t=n[e].time/$("#nr-speedrange").val();t>1e3?($("#nr-status").html("<p>Next line in "+t+" milliseconds</p>"),o=!0):o&&$("#nr-status").html("<p>Replaying...</p>"),setTimeout(function(){eden.execute(n[e].code,"net","",{name:"/execute"},noop),i.playCode(e+1)},t)}else $("#nr-status").html("<p>Replay finished</p>")},e.views.NetworkRemote={dialog:this.createDialog,title:"Network Remote",category:e.viewCategories.extension},e.eden.include("plugins/network-remote/network-remote.js-e",t),eden.root.lookup("plugins_network_loaded").assign(!0,eden.root.scope)},EdenUI.plugins.NetworkRemote.title="Network Remote",EdenUI.plugins.NetworkRemote.description="Method of syncronizing observables via TCP, and playing back scripts",EdenUI.plugins.NetworkRemote.author="Jonny Foss",EdenUI.plugins.WindowLayoutTool=function(e,t){var n="";$.getScript("plugins/view-layout/gridster/jquery.gridster.min.js");var i=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/gridster/jquery.gridster.min.css'>");$("head").append(i);i=$("<link rel='stylesheet' type='text/css' href='plugins/view-layout/view-layout.css'>");$("head").append(i),this.name="window_name",this.createDialog=function(t,i){""==n&&(n=t);var o=[];viewlayoutstr="View Layout";var a=5*e.gridSizeY,r=3*e.gridSizeX,s=[],l=root.lookup("_views_list").value(),d=this.name;l.forEach(function(t){if(t!=d){var n=root.lookup("_view_"+t+"_x").value(),i=root.lookup("_view_"+t+"_y").value();s=[t,n=void 0!==n?n:0,i=void 0!==i?i:0,root.lookup("_view_"+t+"_width").value()+e.scrollBarSize,root.lookup("_view_"+t+"_height").value()+e.titleBarHeight,root.lookup("_view_"+t+"_title").value()],console.log(s),o.push(s)}});var c="";o.forEach(function(e,t){c+='<li data-row="'+Math.round(e[2]/a)+'" data-col="'+Math.round(e[1]/r)+'" data-sizex="'+Math.round(e[3]/(1*r))+'" data-sizey="'+Math.round(e[4]/(1*a))+'" data-name="'+e[0]+'" data-num="'+t+'">'+e[5]+" ["+e[0]+"]</li>"});var u='<a class="vl-update">Update</a><div class="gridster"><ul>'+c+"</ul></div>";$dialog=$('<div id="'+t+'"></div>').html(u).dialog({title:i,width:$(window).width()/2,height:$(window).height()/2,minHeight:120,minWidth:230}),gridster=$(".gridster ul").gridster({widget_base_dimensions:[r,a],widget_margins:[0,0],min_cols:Math.round($(window).width()/r),max_cols:Math.round($(window).width()/r),helper:"clone",resize:{enabled:!0},serialize_params:function(e,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y,name:t.name,name:$(t.el.context).attr("data-name")}}}).data("gridster"),$(".vl-update").click(function(){var t=gridster.serialize(),n=1,i=1;t.forEach(function(e,t){e.col<n&&(n=e.col),e.row<i&&(i=e.row)}),t.forEach(function(t,o){var s="_view_"+t.name+"_y = "+(t.row-i)*a+";_view_"+t.name+"_x = "+(t.col-n)*r+";_view_"+t.name+"_width = "+(t.size_x*r-e.dialogFrameWidth)+";_view_"+t.name+"_height = "+(t.size_y*a-e.dialogFrameHeight)+";";console.log(s),eden.execute(s)})})},e.views.WindowLayoutTool={dialog:this.createDialog,title:"Window Layout",category:e.viewCategories.environment},t()},EdenUI.plugins.WindowLayoutTool.title="Window Layout Tool",EdenUI.plugins.WindowLayoutTool.description="Provides assistance with rearranging windows.",EdenUI.plugins.WindowLayoutTool.author="Jonny Foss",EdenUI.plugins.ADM=function(e,t){var n=this;function i(e,t,n){this.edenVar=e,this.guard=t,this.actions=n}function o(e,t,n,i){this.name=e,this.parameters=t,this.definitions=n,this.actionsArr=i}this.selectedActions=new Array,this.selectedEntities=new Array,this.templates=new Array,this.entities=new Array,this.definitions=new Array,this.currIndex=-1,this.actionLists,this.templateList,this.entityList,eden.polyglot.register("adm",{execute:function(e,t,n,i,o){E(e)}}),i.prototype.toString=function(){return this.guard+" --\x3e "+this.actions},o.prototype.toString=function(){return this.name+"("+this.parameters.join(",")+")\nDefinitions:\n"+this.definitions+"\nActions:\n"+this.actionsArr};var a=function(e,t){for(var n=new Array,o=0;o<t.length;o++){var a=new String(t[o]).split("--\x3e");if(2==a.length){var r="this_g"+n.length;n.push(new i(r,a[0],a[1]))}}return n},r=function(){for(var e=document.getElementById("adm-name"),t=e.value.split("(")[0],i=!0,o=0;o<n.templates.length;o++){n.templates[o].name==t&&(i=!1)}t&&i?-1!=function(e){var t,n=new Array;e.split("(").length<2?t=e:(n=e.split("(")[1].split(")")[0].split(","),t=e.split("(")[0]);var i=[];(o=document.getElementById("adm-definitions")).value.length>0&&(i=o.value.split("\n"));var o,r=(o=document.getElementById("adm-actions")).value.split("\n"),s=a(0,r);return S(t,n,i,s),0}(e.value)&&(alert("Template was successfully added!"),document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="",n.currIndex=-1):(alert("Please enter a unique name for this template."),e.focus())},s=function(e){if(e<-1?e=n.templates.length-1:e>=n.templates.length&&(e=-1),-1==e)document.getElementById("adm-name").value="",document.getElementById("adm-definitions").value="",document.getElementById("adm-actions").value="";else{var t=n.templates[e];document.getElementById("adm-name").value=t.name,document.getElementById("adm-definitions").value=t.definitions.join("\n"),document.getElementById("adm-actions").value=t.actionsArr.join("\n")}n.currIndex=e};this.createTemplateCreator=function(e,t){var i=$("<div></div>");i.html(function(e){return'<div id="'+e+'-input" class="adm-input-code">\t\t\t<div>Name:</div>\t\t\t<div><textarea id="adm-name" type="text" class="adm-name"></textarea></div>\t\t\t<div>Definitions:</div>\t\t\t<div><textarea id="adm-definitions" class="adm-definitions"></textarea></div>\t\t\t<div>Actions:</div>\t\t\t<div><textarea id="adm-actions" class="adm-actions"></textarea></div>\t\t</div>\t\t<div id="adm-results" class="entitylist-results">\t\t\t<ul id="results"> </ul>\t\t</div>'}(e)),$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-add",text:"Add Template",click:function(){r()}},{id:"btn-delete",text:"Delete Template",click:function(){var e;(e=n.currIndex)>-1&&(alert("Deleting template "+n.templates[e].name),n.templates.splice(e),n.currIndex=e-1,s(n.currIndex))}},{text:"Previous",click:function(){s(n.currIndex-1)}},{text:"Next",click:function(){s(n.currIndex+1)}}]}),input_dialog=$dialog,$("#btn-submit").css("margin-right","30px")};var l=function(e,t){var n=new Array;for(x in t){var i=t[x];n.push(i.replace(/this/g,e))}return n},d=function(e){var t;for(x in n.templates)if(n.templates[x].name==e){t=n.templates[x];break}return t},c=function(){for(var e=document.getElementById("template-menu"),t=e.options[e.selectedIndex].value,i=d(t),o=document.getElementById("entity-name"),a=o.value,r=!0,s=0;s<n.entities.length;s++){n.entities[s].name==a&&(r=!1)}if(0!=r){var c=$("#instantiate-params").find("input"),p=0,h=new Array;for(x in c){var v=c[x];if("text"==v.type){var f=b(i.parameters[p]),m=b(v.value);h.push(v),eden.executeEden(a+"_"+f+" is "+m+";"),p++}}var y=l(a,i.definitions);-1!=u(a,y)&&(g(a,y,i.actionsArr),alert("Successfully added instantiation of "+t+" as "+a),function(e,t){for(x in e.value="",t)t[x].value=""}(o,h))}else alert("please enter a unique name for this instantiation")},u=function(e,t){e=b(e);for(var i=0;i<t.length;i++){var o=b(t[i]);eden.executeEden(e+"_"+o),n.definitions.push(e+"_"+o)}};this.createInstantiator=function(e,t){var i=$("<div></div>");for(x in i=$('<div id="template-instantiator">\t\t\t\t\t<div>Templates:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<select id="template-menu">\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t\t<div>Entity name:</div>\t\t\t\t\t<div>\t\t\t\t\t\t<textarea id="entity-name"></textarea>\t\t\t\t\t</div>\t\t\t\t\t<div>Parameters:</div>\t\t\t\t\t<div id="instantiate-params"></div>\t\t\t\t</div>'),$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-instantiate",text:"Instantiate",click:function(){c()}}]}),n.templateList=new EdenUI.plugins.ADM.TemplateList,n.templates){var o=n.templates[x];n.templateList.addTemplate(o.name,o.parameters)}};var p=function(e){var t,i;for(x in n.entities)if(n.entities[x].name==e){t=n.entities[x],i=x;break}if(null!=t){for(x in n.entities.splice(i,1),n.actionLists)if(n.actionLists[x].entityName==e){i=x,n.actionLists[x].remove();break}null!=n.actionLists&&n.actionLists.splice(i,1),null!=n.entityList&&n.entityList.removeEntity(e)}else alert(e+" doesn't exist to delete.")},h=function(e,t,i){var o=d(e);if(null==o)return alert("no template with name "+e),-1;for(x in n.entities)if(n.entities[x].name==i)return alert("Please enter a unique entity name"),-1;if(""==t)var a=[];else if(-1==t.indexOf(","))a=[t];else a=t.split(",");if(a.length!=o.parameters.length)return alert("not enough parameters to instantiate "+o),-1;for(x in a){var r=b(o.parameters[x]),s=b(a[x]);eden.executeEden(i+"_"+r+" is "+s+";")}var c=l(i,o.definitions),p=u(i,c);return-1!=p&&g(i,c,o.actionsArr),p},g=function(e,t,o){var a=function(e,t){var n=new Array;for(x in t){var o=t[x],a=o.guard.replace(/this/g,e),r=o.actions.replace(/this/g,e),s=o.edenVar.replace(/this/g,e);n.push(new i(s,a,r))}return n}(e,o),r=new function(e,t,n){this.name=e,this.definitions=t,this.actionsArr=n,this.queuedActions=new Array}(e,t,a);for(x in n.entities.push(r),a){var s=a[x],l=s.edenVar+" is "+s.guard+";";eden.executeEden(l)}if(null!=n.actionLists){var d=new EdenUI.plugins.ADM.ActionsList(e);n.actionLists.push(d),v(r,d)}null!=n.entityList&&n.entityList.addEntity(e,t,a)};this.actionPush=function(e){n.selectedActions.push(e)},this.actionRemove=function(e){var t=new Array;for(x in n.selectedActions){var i=n.selectedActions[x];i!=e&&t.push(i)}n.selectedActions=t},this.refreshHumanPerspective=function(){for(x in n.entities){var e,t=n.entities[x];for(y in n.actionLists){var i=n.actionLists[y];if(i.entityName==t.name){e=i;break}}e.clear();var o=[];for(x in t.queuedActions){var a=t.queuedActions[x].split(";"),r=a[0];if(r.length>0){a.splice(0,1);var s=!0;a[0].length>0&&(o.push(a.join(";")),s=!1),e.addAction(r,s)}}t.queuedActions=o,v(t,e)}};var v=function(e,t){for(var n=0;n<e.actionsArr.length;n++){var i=e.actionsArr[n];if(!0===eden.root.lookup(i.edenVar).value()){var o=i.actions.split(";"),a=o[0],r=!0;o.splice(0,1),o[0].length>0&&(e.queuedActions.push(o.join(";")),r=!1),t.addAction(a,r)}}};this.createHumanPerspective=function(t,i){var o=$("<div></div>");for(x in o=$('<div id="human-perspective" class="actionlist"></div>'),$dialog=$('<div id="'+t+'"></div>').html(o).dialog({title:i,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-refresh",text:"Refresh actions",click:function(){e.plugins.ADM.refreshHumanPerspective()}},{id:"btn-step",text:"Step",click:function(){!function(){for(x in n.selectedActions){var t=n.selectedActions[x];if(945==(t=b(t)).charCodeAt(0))if("r"==t[2])a=(a=t.split("(")[1]).substring(0,a.length-1),p(a);else if("i"==t[2]){var i=t.split("(")[1],o=t.split("(")[2].split(")")[0],a=t.split("as")[1];if(-1==h(i,o,a))break}else alert("Action on another entity must one of α_remove(entity_name), α_r, α_instantiate(template(param_value) as entity_name) or α_i");else eden.executeEden(t+";")}n.selectedActions=new Array,e.plugins.ADM.refreshHumanPerspective()}()}}]}),n.actionLists=new Array,n.entities){t=n.entities[x].name;n.actionLists.push(new EdenUI.plugins.ADM.ActionsList(t))}e.plugins.ADM.refreshHumanPerspective()};this.entityPush=function(e){n.selectedEntities.push(e)},this.entityRemove=function(e){var t=new Array;for(x in n.selectedEntities){var i=n.selectedEntities[x];i!=e&&t.push(i)}n.selectedEntities=t};this.createInstanceList=function(e,t){var i=$("<div></div>");for(x in i.html('<div id="entity-list" class="instance-list"></div>'),$dialog=$('<div id="'+e+'"></div>').html(i).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-delete-entity",text:"Delete selected",click:function(){!function(){for(x in n.selectedEntities)p(n.selectedEntities[x]);alert("Entities successfully deleted."),n.selectedEntities=new Array}()}}]}),n.entityList=new EdenUI.plugins.ADM.EntityList,n.entities){var o=n.entities[x];n.entityList.addEntity(o.name,o.definitions.join("\n"),o.actionsArr.join("\n"))}};var f=function(e){var t=e.split(":")[1];return b(t.split("(")[0])},m=function(e){var t=e.split(":")[1].split("(")[1];return t.length>1?t.split(")")[0].split(","):[]},b=function(e){for(;32==e.charCodeAt(0)||9==e.charCodeAt(0);)e=e.substring(1,e.length);for(;32==e.charCodeAt(e.length-1)||9==e.charCodeAt(e.length-1);)e=w(e);return e},w=function(e){return e.substring(0,e.length-1)},S=function(e,t,i,r){for(x in n.templates)if(n.templates[x].name==e)return alert("Templates must have unique names."),-1;var s=new o(e,t,i,a(0,r));return n.templates.push(s),null!=n.templateList&&n.templateList.addTemplate(e,t),1},E=function(e){var t,n=e.split("\n"),i=new Array,o=new Array,a=new Array,r=!1,s=!1,l=!1;for(x in n){var d=n[x];if(""!=(d=b(d)))if(0==l)if("{"==d[0])l=!0,-1!=d.indexOf("name:")&&(t=f(d),i=m(d));else{var c=d.split("(")[0],u=d.split("(")[1].split(")")[0],p=w(b(d.split("as")[1]));if(-1==(g=h(c,u,p)))break}else if(1==r){-1!=d.indexOf("}")&&(d=w(d),r=!1),d.length>0&&o.push(d)}else if(1==s){-1!=d.indexOf("}")&&(d=w(d),s=!1),d.length>0&&a.push(d)}else if("}"==d[0]){l=!1;var g=S(t,i,o,a);if(t="",i=new Array,o=new Array,a=new Array,-1==g)return}else if(-1!=d.indexOf("name:"))t=f(d),i=m(d);else if(-1!=d.indexOf("definitions:")||-1!=d.indexOf("defs:")){if(r=!0,(d=b(d)).split("{").length>1)-1!=(v=b(d.split("{")[1])).indexOf("}")&&(v=w(v),r=!1),v.length>0&&o.push(v)}else if(-1!=d.indexOf("actions:")){var v;if(s=!0,(d=b(d)).split("{").length>1)-1!=(v=b(d.split("{")[1])).indexOf("}")&&(v=w(v),s=!1),v.length>0&&a.push(v)}}};this.createAdvancedInput=function(e,t){var n=document.createElement("textarea");n.style.boxSizing="border-box",n.style.width="100%",n.style.height="100%",$code_entry=$('<div id="advanced-input" class="adm-input-code" style="height: 100%"></div>'),$code_entry.append(n),$dialog=$('<div id="'+e+'"></div>').html($code_entry).dialog({title:t,width:360,height:400,minHeight:200,minWidth:360,buttons:[{id:"btn-submit-advanced",text:"Submit",click:function(){var e=n.value;E(e),n.value=""}}]}),input_dialog=$dialog,$("#btn-submit-advanced").css("margin-right","30px")},e.addViewCategory("adm","Abstract Definitive Machine"),e.views.AdmTemplateCreator={dialog:this.createTemplateCreator,title:"ADM Template Creator",category:e.viewCategories.adm},e.views.AdmInstantiator={dialog:this.createInstantiator,title:"ADM Template Instantiator",category:e.viewCategories.adm},e.views.AdmHumanPerspective={dialog:this.createHumanPerspective,title:"ADM Human Perspective",category:e.viewCategories.adm},e.views.AdmEntityList={dialog:this.createInstanceList,title:"ADM Entity List",category:e.viewCategories.adm},e.views.AdmAdvancedInput={dialog:this.createAdvancedInput,title:"ADM Advanced Input",category:e.viewCategories.adm},t()},EdenUI.plugins.ADM.TemplateList=function(){this.templateList=document.getElementById("template-menu"),this.templateList.style.minWidth="100px",this.templates=new Array},EdenUI.plugins.ADM.TemplateList.prototype.addTemplate=function(e,t){var n=new EdenUI.plugins.ADM.Template(e,t);n.element.appendTo(this.templateList),this.templates.push(n)},EdenUI.plugins.ADM.Template=function(e,t){this.template=e,this.element=$("<option value="+e+">"+e+"</option>");var n=this.showParamInput;this.element.click(function(){n(t)}),""==document.getElementById("instantiate-params").innerHTML&&n(t)},EdenUI.plugins.ADM.Template.prototype.showParamInput=function(e){var t=document.getElementById("instantiate-params");for(x in t.innerHTML="",e){var n=e[x],i=document.createElement("label");i.innerHTML=n+":",t.appendChild(i);var o=document.createElement("input");o.type="text",t.appendChild(o);var a=document.createElement("br");t.appendChild(a)}},EdenUI.plugins.ADM.ActionsList=function(e){var t=document.getElementById("human-perspective");this.actionresults=document.createElement("div"),this.actionresults.setAttribute("id","actions_"+e),this.actionresults.innerHTML="<label><b>Actions for "+e+":</b></label>",t.appendChild(this.actionresults),this.actions=new Array,this.entityName=e},EdenUI.plugins.ADM.ActionsList.prototype.addAction=function(e,t){var n=new EdenUI.plugins.ADM.Action(e,t);n.element.appendTo(this.actionresults),this.actions.push(n)},EdenUI.plugins.ADM.ActionsList.prototype.clear=function(){this.actions=new Array,this.actionresults.innerHTML="<label><b>Actions for "+this.entityName+"</b></label>"},EdenUI.plugins.ADM.ActionsList.prototype.remove=function(){document.getElementById("human-perspective").removeChild(document.getElementById("actions_"+this.entityName))},EdenUI.plugins.ADM.Action=function(e,t){e=e;this.action=e,this.element=$('<div class="entitylist-element"></div>'),this.update=this.updateAction;var n=!1;this.element.hover(function(){0==n?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==n?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){0==n?(edenUI.plugins.ADM.actionPush(e),$(this).css("backgroundColor","#6666CC"),n=!0):(edenUI.plugins.ADM.actionRemove(e),$(this).css("backgroundColor","white"),n=!1)}),this.update(t)},EdenUI.plugins.ADM.Action.prototype.updateAction=function(e){var t='<li class="type-function"><span class="result_name">';t=1==e?t+this.action+"</span></li>":t+this.action+" ... </span></li>",this.element.html(t)},EdenUI.plugins.ADM.EntityList=function(){this.entityList=document.getElementById("entity-list"),this.entities=new Array},EdenUI.plugins.ADM.EntityList.prototype.addEntity=function(e,t,n){var i=new EdenUI.plugins.ADM.Entity(e,t,n);i.element.appendTo(this.entityList),this.entities.push(i)},EdenUI.plugins.ADM.EntityList.prototype.removeEntity=function(e){var t;for(x in this.entities)if(this.entities[x].entity==e){t=x;break}this.entities.splice(t,1);var n=document.getElementById("element-"+e);this.entityList.removeChild(n)},EdenUI.plugins.ADM.EntityList.prototype.unselectAll=function(){for(x in this.entities)this.entities[x].unselect()},EdenUI.plugins.ADM.Entity=function(e,t,n){this.entity=e,this.element=$('<div class="entitylist-element" id=element-'+e+"></div>");var i='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(i);t=t,n=n;var o=!1;this.element.hover(function(){0==o?$(this).animate({backgroundColor:"#eaeaea"},100):$(this).animate({backgroundColor:"#66CCCC"},100)},function(){0==o?$(this).animate({backgroundColor:"white"},100):$(this).animate({backgroundColor:"#6666CC"},100)}).click(function(){if(this.innerHTML==i){var a=document.createElement("div");a.innerHTML="<label>Definitions:</label><br>\t\t\t\t\t<textarea disabled>"+t+"</textarea><br>\t\t\t\t\t<label>Actions:</label><br>\t\t\t\t\t<textarea disabled>"+n+"</textarea><br>",this.appendChild(a),edenUI.plugins.ADM.entityPush(e),$(this).css("backgroundColor","#6666CC"),o=!0}else this.innerHTML=i,edenUI.plugins.ADM.entityRemove(e),$(this).css("backgroundColor","white"),o=!1})},EdenUI.plugins.ADM.Entity.prototype.unselect=function(){var e='<li class="type-function"><span class="result_name">'+this.entity+"</span></li>";this.element.html(e)},EdenUI.plugins.ADM.title="Abstract Definitive Machine",EdenUI.plugins.ADM.description="Abstract Definitive Machine",EdenUI.plugins.ADM.author="Ruth King",EdenUI.plugins.DBView=function(e,t){this.createDialog=function(e,t){var n,i,o=$('<div id="'+e+'-content" class="dbview-content"><div class="dbview-controls"><div class="dbview-select"><span class="dbview-label">Query:</span><input class="dbview-select-text" type="text"></input></div></div></div>'),a=$('<table class="dbview-table"></table>');a.appendTo(o);var r=o.find(".dbview-select-text").get(0),s=void 0,l=e.slice(0,-7),d=new Eden.Agent(void 0,"view/db/"+l+"/config"),c="_view_"+l+"_source";function u(){0==Array.isArray(s)&&(s=[["Value"],[[s]]]);for(var e=a.get(0);e.firstChild;)e.removeChild(e.firstChild);if(n=s[0],i=s[1],Array.isArray(n)||(i=s,n=[["List"]]),Array.isArray(i)){for(var t=$("<tr></tr>"),o=0;o<n.length;o++){var r=$("<th></th>");r.html(n[o]),r.appendTo(t)}t.appendTo(a);for(var l=0;l<i.length;l++){var d=$("<tr></tr>");for(o=0;o<n.length;o++){var c;(c="scope"==n[o]?$('<td class="dbview-disabled"></td>'):$("<td contenteditable></td>")).appendTo(d);var u=Array.isArray(i[l])?i[l][o]:i[l];c.html("<div class='dbview-cellcontent'>"+Eden.edenCodeForValue(u)+"</div>")}d.appendTo(a)}}}return d.declare(c),a.on("input","td",function(e){var t=e.target.cellIndex,n=e.target.parentNode.rowIndex-1;if(!(t<0||n<0))e.target.textContent}).on("mouseenter","td",function(e){e.target.cellIndex,e.target.parentNode.rowIndex}).on("mouseleave","td",function(e){a.find(".dbview-dependant").removeClass("dbview-dependant"),a.find(".dbview-dependency").removeClass("dbview-dependency")}),o.on("input",".dbview-select-text",function(e){d.setSource("_view_"+l+"_source is "+r.value),d.execute(!0,!0)}),s=d.state[c],u(),d.on(c,function(e,t){s=t,u()}),$('<div id="'+e+'"></div>').html(o).dialog({title:t,width:600,height:450,minHeight:120,minWidth:230,dialogClass:"dbview-dialog"}),{confirmClose:!0}},e.views.DBView={dialog:this.createDialog,title:"Database Viewer",category:e.viewCategories.visualization},t()},EdenUI.plugins.DBView.title="DBView",EdenUI.plugins.DBView.description="Display a table showing entire database contents.",EdenUI.plugins.SpeechSynthesis=function(e,t){var n=!1;function i(e,t){if(n)n=!1;else{var o,a,r=root.lookup("speak"),s=root.lookup("speakingList"),l=root.lookup("speakingIndex"),d=root.lookup("speaking"),c=root.lookup("speakingID"),u=root.lookup("speakingText"),p=root.lookup("speakingSpeech"),h=root.lookup("speakingCharIndex"),g=s.value(),v=l.value();if(a=window.speechSynthesis.paused,window.speechSynthesis.cancel(),a&&window.speechSynthesis.pause(),v||(v=1),""!=e){if("finished"==e){var f=u.value();"string"==typeof f&&h.assign(f.length+1,r)}else"interrupted"==e&&(n=!0);o=c.value(),eden.isValidIdentifier(o)&&root.lookup(o+"_status").assign(e,r)}if(t&&v++,h.assign(1,r),root.lookup("speakingTime").assign(0,r),Array.isArray(g)&&v<=g.length){d.value()||d.assign(!0,r);var m=g[v-1];if(!(m instanceof SpeakingWords)||m.cancelled)return void i("",!0);m.prepareUtterance();var b=m.utterance;o=m.id,c.assign(o,r),eden.isValidIdentifier(o)&&root.lookup(o+"_status").assign("speaking",r),u.assign(b.text,r),p.assign(m,r),t&&l.assign(v,r),m.hasBeenSpoken=!0,window.speechSynthesis.speak(b)}else d.assign(!1,r),c.assign("",r),u.assign("",r),p.assign(void 0,r),Array.isArray(g)&&l.assign(g.length+1,r)}}function o(e,t){var n,i,o,a,r=window.speechSynthesis.getVoices();e&&(-1!=(i=(e=e.toLowerCase()).indexOf("-"))?(o=e.slice(0,i),a=!0):(o=e,a=!1)),t&&(n=new RegExp("\\b"+t+"\\b","i"));for(var s=void 0,l=!1,d=!1,c=!1,u=!1,p=0;p<r.length;p++){var h=r[p],g=h.lang,v=!1,f=!1,m=!1;if(e&&g&&(e==(g=g.toLowerCase())?(v=!0,f=!0):o==g?v=!0:-1!=(i=g.indexOf("-"))&&g.slice(0,i)==o&&(v=!0)),t&&n.test(h.name)&&(m=!0),(!d&&!g&&!l||!d&&(!g||!e)&&h.default||v&&!d||a&&f&&!c||v&&!a&&h.default||f&&h.default||m&&!u&&(!e||!g&&!d||v))&&(!u||m||v&&!d)){if(l=!v,d=v,c=f,u=m,(!t||u)&&(c||d&&!a)&&h.default)return h;s=h}}return void 0===s&&(s=r[0]),s}root.lookup("speakingList").addJSObserver("sendToTTS",function(e,t){var n=root.lookup("speak");if(Array.isArray(t)){var o=root.lookup("speakingIndex"),a=o.value();if(a>t.length+1)o.assign(t.length+1,n);else if(a<=t.length){for(var r=a<1?0:a-1;r<t.length;r++){var s=t[r];if(s instanceof SpeakingWords){s.prepareUtterance();var l=s.id;eden.isValidIdentifier(l)&&root.lookup(l+"_status").assign("waiting",n)}}root.lookup("speaking").value()?t[a-1]!==root.lookup("speakingSpeech").value()&&i("interrupted",!1):i("",!1)}}}),root.lookup("speakingIndex").addJSObserver("runTTS",function(e,t){if("speak"!=e.last_modified_by){var n=root.lookup("speakingList").value();if(Array.isArray(n)&&t<=n.length){root.lookup("speaking").value()?i("interrupted",!1):i("",!1);for(var o=t;o<n.length;o++)n[o]instanceof SpeakingWords&&n[o].prepareUtterance()}}}),root.lookup("speakingPaused").addJSObserver("controlTTS",function(e,t){t?window.speechSynthesis.pause():(window.speechSynthesis.resume(),window.speechSynthesis.resume())}),SpeakingWords=function(t,n,a,r,s,l,d){var c,u,p,h,g,v,f;this.id=t,this.utterance=new window.SpeechSynthesisUtterance(String(n)),this.hasBeenSpoken=!1,void 0===r?(v=e.getOptionValue("speechSynthDefaultGender"),"chrome"in window&&null===v&&(v="native"),p=!0):(v=r,p=!1),this.utterance.volume=s,void 0===l?(null!==(c=e.getOptionValue("speechSynthDefaultRate"))&&(this.utterance.rate=parseFloat(c)),h=!0):(this.utterance.rate=l,h=!1),void 0===d?(null!==(c=e.getOptionValue("speechSynthDefaultPitch"))&&(this.utterance.pitch=parseFloat(c)),g=!0):(this.utterance.pitch=d,g=!1);var m=this;if(Object.defineProperty(this,"text",{get:function(){return m.utterance.text},set:function(e){m.utterance.text=e},enumerable:!0}),Object.defineProperty(this,"lang",{get:function(){return m.utterance.lang},set:function(e){if(e){var t=e.indexOf("-");-1!=t&&(e=e.slice(0,t+1)+e.slice(t+1).toUpperCase()),m.utterance.lang=e}else m.utterance.lang="";u=!1;var n=o(e,v);m.utterance.voiceURI=n.voiceURI,m.utterance.voice=n},enumerable:!0}),Object.defineProperty(this,"gender",{get:function(){return v},set:function(e){v=e,p=!1;var t=o(this.utterance.lang,v);m.utterance.voiceURI=t.voiceURI,m.utterance.voice=t},enumerable:!0}),Object.defineProperty(this,"volume",{get:function(){return m.utterance.volume},set:function(e){m.utterance.volume=e},enumerable:!0}),Object.defineProperty(this,"rate",{get:function(){return m.utterance.rate},set:function(e){m.utterance.rate=e,h=!1},enumerable:!0}),Object.defineProperty(this,"pitch",{get:function(){return m.utterance.pitch},set:function(e){m.utterance.text=e,g=!1},enumerable:!0}),Object.defineProperty(this,"cancelled",{get:function(){return f},set:function(e){(f=e)&&m.id&&root.lookup(m.id+"_status").assign("cancelled",{name:"/SpeakingWords"})},enumerable:!0}),this.toString=function(){var e="SpeakingWords("+Eden.edenCodeForValue(t)+', "'+m.utterance.text+'", ';return u?e+="@, ":e=e+'"'+m.utterance.lang+'", ',p?e+="@, ":e=e+Eden.edenCodeForValue(v)+", ",e=e+m.utterance.volume+", ",h?e+="@, ":e=e+this.utterance.rate+", ",g?e+="@)":e=e+this.utterance.pitch+")",e},void 0===a?(this.lang=e.getOptionValue("speechSynthDefaultLanguage"),u=!0):this.lang=a,eden.isValidIdentifier(t)){var b=root.lookup(t+"_status");void 0===b.value()&&b.assign("not queued",{name:"/speakingWords"})}this.prepareUtterance=function(){if(m.hasBeenSpoken&&!("chrome"in window)){var e=new window.SpeechSynthesisUtterance(m.utterance.text);e.lang=m.utterance.lang,e.volume=m.utterance.volume,e.rate=m.utterance.rate,e.pitch=m.utterance.pitch,e.voiceURI=m.utterance.voiceURI,e.voice=m.utterance.voice,e.onboundary=m.utterance.onboundary,e.onend=m.utterance.onend,e.onerror=m.utterance.onerror,m.utterance=e,m.hasBeenSpoken=!1}},this.utterance.onboundary=function(e){var t={name:"/speak"};root.lookup("speakingCharIndex").assign(e.charIndex+1,t);var n=e.elapsedTime;n<=1e7&&root.lookup("speakingTime").assign(n,t)},this.utterance.onend=function(){i("finished",!0)},this.utterance.onerror=function(){i("error",!0)}},e.eden.include("plugins/speech-synthesis/speech-synthesis.js-e",t)},EdenUI.plugins.SpeechSynthesis.title="Speech Synthesis",EdenUI.plugins.SpeechSynthesis.description="Gives JS-EDEN the ability to speak sentences out loud!",EdenUI.plugins.MIDI=function(e,t){var n=this,o=!1;Object.defineProperty(this,"initialized",{get:function(){return o},enumerable:!0});var a=[];this.addSoftwareDriver=function(e){console.log("New JavaScript MIDI driver registered."),a.push(e),o&&e()};var r=[],s=[],l=root.lookup("midiNumberOfOutputs");l.assign(0,eden.root.scope);var d=root.lookup("midiNumberOfInputs");d.assign(0,eden.root.scope);var c={};function u(e,t){if(e<r.length){for(var n=r[e],i=0;i<t.length&&i<16;i++){var o=t[i];Number.isInteger(o)&&o>=1&&o<=128&&n.send([192+i,o-1])}t.length>16&&eden.error(new Error("MIDI programs list is too long."))}}this.addSoftSynth=function(e){if(r.push(e),l.assign(r.length,eden.root.scope),console.log('Added software synthesizer "'+e.name+'".'),o){var t=r.length-1,n=c[t];void 0!==n&&u(t,n.value())}},this.addSoftInput=function(e){s.push(e),d.assign(s.length,eden.root.scope),console.log('Added software input "'+e.name+'".')};var p=0,h=0;function g(e){if(void 0===e)return p;if(Number.isInteger(e)){if(e<1||o&&e>r.length)throw new Error("No MIDI output device exists with device number "+e);return e-1}if(o&&"string"==typeof e){for(var t=0;t<r.length;t++)if(e==r[t].name)return t;throw new Error("No MIDI output device exists with device name "+e)}throw new Error("The output device must be given as a positive integer.")}Object.defineProperty(this,"outputNames",{get:function(){for(var e=[],t=0;t<r.length;t++)e.push(r[t].name);return e},enumerable:!0}),Object.defineProperty(this,"inputNames",{get:function(){for(var e=[],t=0;t<s.length;t++)e.push(s[t].name);return e},enumerable:!0}),this.roundValue=function(e){return"number"==typeof e?e<=0?0:e<=1?1:e>=127?127:Math.round(e):void 0},this.isValidNote=function(e){return Number.isInteger(e)&&e>=-20&&e<=107},this.loadPrograms=function(e,t){e=g(e);var n=r[e];if(!Array.isArray(t))throw new Error("MIDI programs must be given as a list.");for(var i=t.length,o=new Array(i),a=0;a<i;a++){var s=t[a];if(!(Number.isInteger(s)&&s>=1&&s<=128))throw new Error("Item "+a+" must be an integer between 1 and 128.");o[a]=s-1}n.loadPrograms&&n.loadPrograms(o)},this.bindPrograms=function(e,t){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");t=g(t),Array.isArray(e.value())||void 0!==e.definition||e.assign([1],eden.root.scope);var n=function(e,n){Array.isArray(n)?o&&u(t,n):eden.error(new Error("Illegal MIDI programs list: "+Eden.edenCodeForValue(n)))};n(0,e.value()),e.addJSObserver("bind",n),c[t]=e},this.getInputs=function(){return s};var v=!1,f=[],m=[];this.initialize=function(e,n){var i=e.value();if(o)i.apply(null,n);else if(f.push(i),m.push(n),!v){v=!0;console.log("Initializing MIDI..."),window.navigator.requestMIDIAccess?window.navigator.requestMIDIAccess().then(function(e){if(e){var t,n;for((n=(t=e.outputs.values()).next()).done&&console.log("No MIDI output devices found.");!n.done;){var i=n.value;console.log("Found MIDI output device "+i.name+"."),r.push(i),n=t.next()}for((n=(t=e.inputs.values()).next()).done&&console.log("No MIDI input devices found.");!n.done;){var o=n.value;console.log("Found MIDI input device "+o.name+"."),s.push(o),n=t.next()}l.assign(r.length,eden.root.scope),d.assign(s.length,eden.root.scope)}p(0)},function(e){var t="Unable to access WebMIDI: "+e;console.log(t),eden.error(new Error(t)),p(0)}):(console.log("This browser does not support the WebMIDI API.  No access to hardware MIDI devices is possible."),p(0))}function p(e){if(e<a.length)0==e&&console.log("Found "+a.length+" MIDI drivers written in JavaScript."),a[e](p,[e+1]);else{for(var n in c)u(n,c[n].value());o=!0,v=!1,eden.root.lookup("plugins_midi_loaded").assign(!0,eden.root.scope,EdenSymbol.localJSAgent),t&&t(),console.log("Done.");for(var i=0;i<f.length;i++)f[i].apply(null,m[i])}}},this.mergeMessageLists=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(Array.isArray(i))t.push(i);else if(void 0!==i)throw new Error("Item "+n+" must be a list of MIDI messages.")}var o=t.length,a=new Array(o),r=0;for(n=0;n<o;n++)a[n]=0,r+=t[n].length;var s=new Array(r);for(n=0;n<r;n+=2){for(var l,d,c=1/0,u=0;u<o;u++){var p=a[u];if(p<t[u].length){var h=t[u],g=h[p],v=h[p+1];v<c&&(c=v,d=g,l=u)}}s[n]=d,s[n+1]=c,a[l]=a[l]+2}return s},this.playMIDI=function(e,t,n){if(e=g(e),void 0===t)t=0;else if("number"!=typeof t)throw new Error("The delay must be a number.");if(!Array.isArray(n))throw new Error("The message stream must be an array.");for(var i=r[e],o=window.performance.now()+t,a=0;a<n.length;a+=2)i.send(n[a],o+n[a+1])};var b={};this.alterNote=function(e,t,i,o,a,s){var l=b[e],d=r[g(t)];n.isValidNote(o)?o===l?a>0&&(s?d.send([144+i,o+20,n.roundValue(a)]):d.send([144+i,o+20,0])):(a>0?(void 0!==l&&d.send([144+i,l+20,0]),s&&d.send([144+i,o+20,n.roundValue(a)])):a<0?void 0!==l&&d.send([128+i,l+20,n.roundValue(-a)]):void 0!==l&&d.send([144+i,l+20,0]),b[e]=o):void 0!==l&&d.send([144+i,l+20,0])},this.alterVelocity=function(e,t,i,o,a){if(o===b[e]&&void 0!==o){var s=r[g(t)];a>0?s.send([160+i,o+20,n.roundValue(a)]):a<0?s.send([128+i,o+20,n.roundValue(-a)]):s.send([144+i,o+20,0])}};var y={volume:7};this.bindControlChange=function(e,t,i,o){if(!(e instanceof EdenSymbol))throw new Error("The first argument must be a Symbol.");var a,s=r[g(t)];if("string"==typeof o){if(void 0===(a=y[o.toLowerCase()]))throw new Error("Unknown control name "+o)}else{if(!(Number.isInteger(o)&&o>=0&&o<=127))throw new Error("The control must be specified either as a string or as an integer between 0 and 127 inclusive.");a=o}function l(e,t){var o=n.roundValue(t);void 0!==o&&s.send([176+i,a,o])}l(0,e.value()),e.addJSObserver("bind",l)};var w=16,S=new Array(w),x=root.lookup("midiInputDevice"),E=root.lookup("midiInputTimestamp"),I=root.lookup("midiInputMessage"),k=0,C=0,A=root.lookup("midiInputMessageCount");function _(e){root.lookup("startMIDIInput");if(k==C)S.length>w&&(S=new Array(w)),S[0]=e,k=1,C=0;else{var t,n=e.timeStamp;for(t=k-1;t>=C&&!(S[t].timeStamp<=n);t--);t==k-1?S[k]=e:S.splice(t+1,0,e),k++}A.assign(k-C,eden.root.scope)}this.startInput=function(e){if(void 0===e)for(i=0;i<s.length;i++)s[i].onmidimessage=_;else e=function(e){if(void 0===e)return h;if(Number.isInteger(e)){if(e<1||o&&e>s.length)throw new Error("No MIDI input device exists with device number "+e);return e-1}if(o&&"string"==typeof e){for(var t=0;t<s.length;t++)if(e==s[t].name)return t;throw new Error("No MIDI input device exists with device name "+e)}throw new Error("The input device must be given as a positive integer.")}(e),s[e].onmidimessage=_},this.fetchInputMessage=function(){if(C!=k){root.lookup("startMIDIInput");var e=S[C],t=S.length;C++,t>=2*w&&C>.8*t-1&&(S.splice(0,C),k-=C,C=0);var n,i=e.target;i&&(n=i.name),root.beginAutocalcOff(),x.assign(n,root.scope),E.assign(e.timeStamp,root.scope),I.assign(e.data,eden.root.scope),A.assign(k-C,eden.root.scope),root.endAutocalcOff()}},this.clearInputMessages=function(){S.length>w&&(S=new Array(w)),k=0,C=0,A.assign(0,eden.root.scope)},Eden.Selectors.execute("plugins > midi > midi",function(){})},EdenUI.plugins.MIDI.title="MIDI",EdenUI.plugins.MIDI.description="Adds musical capabilities to JS-EDEN.",EdenUI.plugins.Debugger=function(e,t){this.createDialog=function(e,t){e.slice(0,-7);var n=!1,i=void 0,o=500,a=$('<div class="debugger"></div>'),r=$('<div class="debugger-controls"><button title="Toggle capture all agents" style="margin-left: 20px; margin-right: 20px;" class="debugger-button debug">&#xf188;</button><button class="debugger-button play" title="Auto Play">&#xf04b;</button><button class="debugger-button stepforward">&#xf051;</button><button class="debugger-button autostep">&#xf050;</button><input type="range" class="debugger-speed" value="500" max="1000" min="50"></input></div>');a.append(r);var s=$('<div class="debugger-agents"></div>');a.append(s);var l={},d=1;function c(e){var t="";return"when"==e.type&&e.base&&e.base.origin?(t+="## "+e.base.origin.name,e.line&&(t+=":"+(e.line+1)),t+="\n"):e.name&&(t+="## "+e.name+"\n"),e.getSource&&(t+=e.getSource()),t}Eden.AST.debugstep_cb=function(e){var t=e.agent,i=c(t);if(l[t.id]){var a=l[t.id].html;if(l[t.id].data=e,!1,a){var r=new Eden.AST(i,void 0,t);if(new EdenUI.Highlight(a.get(0).childNodes[1]).highlight(r,-1,-1),e.statement){var s=e.statement.line-t.getLine(),d=a.get(0).childNodes[1].childNodes[s+1];d?d.className="eden-line debugger-line":console.error("Missing line: "+s)}}else console.error("Missing output")}n&&setTimeout(e.next,o)};Eden.AST.debug_begin_cb=function(e){var t=e.agent;void 0!==t.id&&(u(e),console.log("WHEN ALREADY LOGGED")),t.id=d,d++;var n=$('<div class="debugger-agent" data-agent="'+t.id+'"><div class="debugger-agent-controls"></div><div class="debugger-code"></div></div>');s.append(n),l[t.id]={html:n,data:e},void 0===i&&(i=l[t.id],n.get(0).className="debugger-agent active");var o=c(t),a=new Eden.AST(o,void 0,t);new EdenUI.Highlight(n.get(0).childNodes[1]).highlight(a,-1,-1)};var u=function(e){var t=e.agent;if(void 0!==t.id&&void 0!==l[t.id]){i===l[t.id]&&(!1,i=void 0);var n=c(t),o=l[t.id].html,a=new Eden.AST(n,void 0,t);new EdenUI.Highlight(o.get(0).childNodes[1]).highlight(a,-1,-1),l[t.id].html.remove(),delete l[t.id],t.id=void 0}};return Eden.AST.debug_end_cb=u,Eden.AST.debug=!0,Eden.AST.debugstep=!1,$('<div id="'+e+'"></div>').html(a).dialog({appendTo:"#jseden-views",title:t,width:590,height:500,minHeight:120,minWidth:230,dialogClass:"debugger-dialog"}),r.on("click",".play",function(e){(n=!n)?(e.currentTarget.innerHTML="&#xf04c;",e.currentTarget.className="debugger-button play active"):(e.currentTarget.innerHTML="&#xf04b;",e.currentTarget.className="debugger-button play")}).on("click",".stepforward",function(e){i&&i.data.next&&(i.data.next(),i&&(i.data.next=void 0))}).on("click",".debug",function(e){Eden.AST.debugstep=!Eden.AST.debugstep,Eden.AST.debugstep?e.currentTarget.className="debugger-button debug active":e.currentTarget.className="debugger-button debug"}).on("change",".debugger-speed",function(e){o=e.currentTarget.value,console.log("Change speed: "+o)}),s.on("click",".debugger-agent",function(e){i&&(i.html.get(0).className="debugger-agent"),(i=l[e.currentTarget.getAttribute("data-agent")]).html.get(0).className="debugger-agent active"}),{destroy:function(){Eden.AST.debug=!1}}},e.views.Debugger={dialog:this.createDialog,title:"Debugger",category:e.viewCategories.history},t()},EdenUI.plugins.Debugger.title="Debugger",EdenUI.plugins.Debugger.description="",EdenUI.plugins.Debugger.originalAuthor="Nicolas Pope",EdenUI.plugins.MIDIDotJS=function(e,t){var n="plugins/midi/emulation/soundfonts/FluidR3_GM/",i=new Array(127);function o(){e.plugins.MIDI.addSoftwareDriver(function(t,o){var a,r={name:"MIDI.js",loadPrograms:function(e){for(var t=0;t<e.length;t++)i[e[t]]=!0;a.loadPlugin({soundfontUrl:n,instrument:e})},send:function(e,t){var o=e[0],r=240&o,s=15&o,l=e[1],d=e[2];switch(void 0===t?t=0:t-=window.performance.now(),r){case 128:a.noteOff(s,l,t/1e3);break;case 144:0==d?a.noteOff(s,l,t/1e3):a.noteOn(s,l,d,t/1e3);break;case 176:switch(l){case 7:var c=d/127*(d/127)*64;MIDI.setVolume(s,c,t/1e3);break;default:console.log("Unable to change MIDI control number "+l+" using MIDI.js")}break;case 192:i[l]||(i[l]=!0,a.loadPlugin({soundfontUrl:n,instrument:l})),a.setInstrument(s,l,t);break;default:console.log("Unable to map MIDI command "+o.toString(16)+" to MIDI.js")}},clear:function(){}},s=["inc/shim/Base64binary.js"];"true"==e.getOptionValue("developer")?s.push("build/MIDI.js"):s.push("build/MIDI.min.js"),function i(l){l==s.length?(a=window.MIDI).loadPlugin({soundfontUrl:n,onsuccess:function(){e.plugins.MIDI.addSoftSynth(r),t&&t.apply(this,o)}}):$.ajax({url:"plugins/midi/emulation/lib/MIDI.js/"+s[l],success:function(){i(l+1)}})}(0)}),t()}e.plugins.MIDI?o():e.loadPlugin("MIDI",o)},EdenUI.plugins.MIDIDotJS.title="MIDI.JS",EdenUI.plugins.MIDIDotJS.description="Uses the MIDI.js JavaScript library to add a software synthesizer for users who cannot access a MIDI instrument via WebMIDI and the basic MIDI plug-in.",EdenUI.plugins.MIDIFileInput=function(e,t){var n={};function i(){e.plugins.MIDI.addSoftwareDriver(function(t,i){e.plugins.MIDI.addSoftInput(n),t&&t.apply(this,i)})}n.name="MIDI Input from MIDI File",this.queue=function(e){var t=window.performance.now(),i=e.length;function o(e){var t=new Uint8Array(e.slice(1));return new MIDIMessageEvent("midimessage",{target:n,data:t})}!function a(r){if(r!=i){var s=e[r],l=t+s[0]-window.performance.now();if(l>0)window.setTimeout(function(){var e=o(s);n.onmidimessage(e),a(r+1)},l);else{var d=o(s);n.onmidimessage(d),a(r+1)}}}(0)},e.plugins.MIDI?i():e.loadPlugin("MIDI",i)},EdenUI.plugins.MIDIFileInput.title="MIDI File Input",EdenUI.plugins.MIDIFileInput.description="Use a MIDI file to simulate MIDI file input.";